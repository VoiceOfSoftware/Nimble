const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BV4Ep9CS.js","./BvRhegKU.js","./Bz0RU7rj.js","./O5vdvBJg.js","./Cex1gn7C.js","./DminihEk.js"])))=>i.map(i=>d[i]);
import{f as Iae,e as KB,c as nn,a as bt,n as kae,t as hi,V as Dae,d as WQ}from"./BouYdsdf.js";import{m as or,a0 as Bd,aI as $V,i as Z0,aJ as Lae,ae as YB,aK as Dw,ac as $l,J as JB,M as WV,O as UM,N as HM,aL as $M,q as qQ,ak as KR,j as Td,al as sg,H as Fae,o as ul,aM as Nae,B as jQ,V as QQ,g as B,as as _h,$ as fp,aN as ZQ,aO as iF,T as XQ,Q as b_,aP as Bae,aQ as qV,aR as jV,aS as zae,a4 as Vae,aT as Gae,l as YR,aU as Uae,W as Fy,F as KQ,ai as Hae,aj as e3,_ as og,a1 as $ae,Y as YQ,a2 as Wae,Z as qae,E as JQ,aV as jae,am as mh,x as Og,an as wC,z as en,aW as Qae,aX as Zae,ah as Xae,aY as Kae,aZ as Yae,af as Jae,R as ele,a_ as tle,P as ile,a$ as nF,n as QV,b0 as nle,h as rt,b1 as eZ,K as Hc,p as Pi,aC as Ui,aD as Is,f as pi,a as Ei,aE as Gt,aG as xl,ao as rle,c as Di,r as _i,t as Gi,s as vi,v as On,d as Fn,k as to,aB as Xi,e as Vt,b as ks,aF as JR,b2 as sle,b3 as tZ,b4 as ole,u as as,b5 as ale}from"./Cex1gn7C.js";import{i as lle,a as cle,c as ule,d as Zg,b as hle,n as dle,f as fle,g as ple,j as ZV,s as zd,e as Tn,r as mle,u as gle,m as vle}from"./BdtGcvC5.js";import{h as yle,l as XV,i as Yi,a as ht,b as es,p as kn,s as dt,e as Lr,d as Hr,c as dl,j as xle,f as iZ,r as _C}from"./CROL48nE.js";import{i as ts}from"./BAWEuv6V.js";import{g as Mg,o as Xo,a as As,c as nZ,d as ga,w as gr,r as KV,b as ble,e as eP}from"./DminihEk.js";import{_ as rZ}from"./Bz0RU7rj.js";import{s as hs}from"./TXKh3AVt.js";function wle(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}const rF=0,v1=1,sF=2;function _le(t,e,i,n,r){or&&Bd();var s=t,o=$V(),a=qQ,l=YB,u,d,p,v=(o?$l:JB)(void 0),y=(o?$l:JB)(void 0),w=!1;function R(P,N){w=!0,N&&(UM(O),HM(O),$M(a));try{P===v1&&n&&(d?KR(d):d=Td(()=>n(s,v))),P!==rF&&u&&sg(u,()=>u=null),P!==v1&&d&&sg(d,()=>d=null),P!==sF&&p&&sg(p,()=>p=null)}finally{N&&($M(null),HM(null),UM(null),Fae())}}var O=Z0(()=>{if(l!==(l=e())){if(Lae(l)){var P=l;w=!1,P.then(N=>{P===l&&(Dw(v,N),R(v1,!0))},N=>{if(P===l)throw Dw(y,N),R(sF,!0),y.v}),or||WV(()=>{w||R(rF,!0)})}else Dw(v,l),R(v1,!1);return()=>l=YB}});or&&(s=ul)}function sZ(t,e,i){or&&Bd();var n=t,r=YB,s,o=$V()?Nae:jQ;Z0(()=>{o(r,r=e())&&(s&&sg(s),s=Td(()=>i(n)))}),or&&(n=ul)}function Sl(t,e){return e}function Cle(t,e,i,n){for(var r=[],s=e.length,o=0;o<s;o++)zae(e[o].e,r,!0);var a=s>0&&r.length===0&&i!==null;if(a){var l=i.parentNode;Vae(l),l.append(i),n.clear(),qf(t,e[0].prev,e[s-1].next)}Gae(r,()=>{for(var u=0;u<s;u++){var d=e[u];a||(n.delete(d.k),qf(t,d.prev,d.next)),YR(d.e,!a)}})}function Ur(t,e,i,n,r,s=null){var o=t,a={flags:e,items:new Map,first:null},l=(e&ZQ)!==0;if(l){var u=t;o=or?fp(Fy(u)):u.appendChild(QQ())}or&&Bd();var d=null,p=!1,v=_h(()=>{var y=i();return KQ(y)?y:y==null?[]:XQ(y)});Z0(()=>{var y=B(v),w=y.length;if(p&&w===0)return;p=w===0;let R=!1;if(or){var O=o.data===Hae;O!==(w===0)&&(o=e3(),fp(o),og(!1),R=!0)}if(or){for(var P=null,N,F=0;F<w;F++){if(ul.nodeType===8&&ul.data===$ae){o=ul,R=!0,og(!1);break}var k=y[F],$=n(k,F);N=oZ(ul,a,P,null,k,$,F,r,e,i),a.items.set($,N),P=N}w>0&&fp(e3())}or||Sle(y,a,o,r,e,n,i),s!==null&&(w===0?d?KR(d):d=Td(()=>s(o)):d!==null&&sg(d,()=>{d=null})),R&&og(!0),B(v)}),or&&(o=ul)}function Sle(t,e,i,n,r,s,o){var a=(r&Bae)!==0,l=(r&(qV|jV))!==0,u=t.length,d=e.items,p=e.first,v=p,y,w=null,R,O=[],P=[],N,F,k,$;if(a)for($=0;$<u;$+=1)N=t[$],F=s(N,$),k=d.get(F),k!==void 0&&(k.a?.measure(),(R??=new Set).add(k));for($=0;$<u;$+=1){if(N=t[$],F=s(N,$),k=d.get(F),k===void 0){var W=v?v.e.nodes_start:i;w=oZ(W,e,w,w===null?e.first:w.next,N,F,$,n,r,o),d.set(F,w),O=[],P=[],v=w.next;continue}if(l&&Ole(k,N,$,r),(k.e.f&iF)!==0&&(KR(k.e),a&&(k.a?.unfix(),(R??=new Set).delete(k))),k!==v){if(y!==void 0&&y.has(k)){if(O.length<P.length){var Q=P[0],Y;w=Q.prev;var M=O[0],D=O[O.length-1];for(Y=0;Y<O.length;Y+=1)y4(O[Y],Q,i);for(Y=0;Y<P.length;Y+=1)y.delete(P[Y]);qf(e,M.prev,D.next),qf(e,w,M),qf(e,D,Q),v=Q,w=D,$-=1,O=[],P=[]}else y.delete(k),y4(k,v,i),qf(e,k.prev,k.next),qf(e,k,w===null?e.first:w.next),qf(e,w,k),w=k;continue}for(O=[],P=[];v!==null&&v.k!==F;)(v.e.f&iF)===0&&(y??=new Set).add(v),P.push(v),v=v.next;if(v===null)continue;k=v}O.push(k),w=k,v=k.next}if(v!==null||y!==void 0){for(var G=y===void 0?[]:XQ(y);v!==null;)(v.e.f&iF)===0&&G.push(v),v=v.next;var j=G.length;if(j>0){var Z=(r&ZQ)!==0&&u===0?i:null;if(a){for($=0;$<j;$+=1)G[$].a?.measure();for($=0;$<j;$+=1)G[$].a?.fix()}Cle(e,G,Z,d)}}a&&WV(()=>{if(R!==void 0)for(k of R)k.a?.apply()}),b_.first=e.first&&e.first.e,b_.last=w&&w.e}function Ole(t,e,i,n){(n&qV)!==0&&Dw(t.v,e),(n&jV)!==0?Dw(t.i,i):t.i=i}function oZ(t,e,i,n,r,s,o,a,l,u){var d=(l&qV)!==0,p=(l&Uae)===0,v=d?p?JB(r):$l(r):r,y=(l&jV)===0?o:$l(o),w={i:y,v,k:s,a:null,e:null,prev:i,next:n};try{return w.e=Td(()=>a(t,v,y,u),or),w.e.prev=i&&i.e,w.e.next=n&&n.e,i===null?e.first=w:(i.next=w,i.e.next=w.e),n!==null&&(n.prev=w,n.e.prev=w.e),w}finally{}}function y4(t,e,i){for(var n=t.next?t.next.e.nodes_start:i,r=e?e.e.nodes_start:i,s=t.e.nodes_start;s!==n;){var o=YQ(s);r.before(s),s=o}}function qf(t,e,i){e===null?t.first=i:(e.next=i,e.e.next=i&&i.e),i!==null&&(i.prev=e,i.e.prev=e&&e.e)}function aZ(t,e,i,n,r){var s=t,o="",a;Z0(()=>{if(o===(o=e()??"")){or&&Bd();return}a!==void 0&&(YR(a),a=void 0),o!==""&&(a=Td(()=>{if(or){ul.data;for(var l=Bd(),u=l;l!==null&&(l.nodeType!==8||l.data!=="");)u=l,l=YQ(l);if(l===null)throw Wae(),qae;KB(ul,u),s=fp(l);return}var d=o+"";i&&(d=`<svg>${d}</svg>`);var p=Iae(d);if((i||n)&&(p=Fy(p)),KB(Fy(p),p.lastChild),i||n)for(;Fy(p);)s.before(Fy(p));else s.before(p)}))})}function c0(t,e,i,n,r){or&&Bd();var s=e.$$slots?.[i],o=!1;s===!0&&(s=e[i==="default"?"children":i],o=!0),s===void 0?r!==null&&r(t):s(t,o?()=>n:n)}function Mle(t,e,i,n,r,s){let o=or;or&&Bd();var a,l,u=null;or&&ul.nodeType===1&&(u=ul,Bd());var d=or?ul:t,p;Z0(()=>{const v=e()||null;var y=v==="svg"?jae:null;v!==a&&(p&&(v===null?sg(p,()=>{p=null,l=null}):v===l?KR(p):YR(p)),v&&v!==l&&(p=Td(()=>{if(u=or?u:y?document.createElementNS(y,v):document.createElement(v),KB(u,u),n){or&&lle(v)&&u.append(document.createComment(""));var w=or?Fy(u):u.appendChild(QQ());or&&(w===null?og(!1):fp(w)),n(u,w)}b_.nodes_end=u,d.before(u)})),a=v,a&&(l=a))},JQ),o&&(og(!0),fp(d))}function Us(t,e,i){mh(()=>{var n=Og(()=>e(t,i?.())||{});if(i&&n?.update){var r=!1,s={};wC(()=>{var o=i();en(o),r&&jQ(s,o)&&(s=o,n.update(o))}),r=!0}if(n?.destroy)return()=>n.destroy()})}function lZ(t){var e,i,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(i=lZ(t[e]))&&(n&&(n+=" "),n+=i)}else for(i in t)t[i]&&(n&&(n+=" "),n+=i);return n}function Tle(){for(var t,e,i=0,n="",r=arguments.length;i<r;i++)(t=arguments[i])&&(e=lZ(t))&&(n&&(n+=" "),n+=e);return n}function Ol(t){return typeof t=="object"?Tle(t):t??""}const x4=[...` 	
\r\fÂ \v\uFEFF`];function Rle(t,e,i){var n=t==null?"":""+t;if(e&&(n=n?n+" "+e:e),i){for(var r in i)if(i[r])n=n?n+" "+r:r;else if(n.length)for(var s=r.length,o=0;(o=n.indexOf(r,o))>=0;){var a=o+s;(o===0||x4.includes(n[o-1]))&&(a===n.length||x4.includes(n[a]))?n=(o===0?"":n.substring(0,o))+n.substring(a+1):o=a}}return n===""?null:n}function b4(t,e=!1){var i=e?" !important;":";",n="";for(var r in t){var s=t[r];s!=null&&s!==""&&(n+=" "+r+": "+s+i)}return n}function oF(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function Ple(t,e){if(e){var i="",n,r;if(Array.isArray(e)?(n=e[0],r=e[1]):n=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,o=0,a=!1,l=[];n&&l.push(...Object.keys(n).map(oF)),r&&l.push(...Object.keys(r).map(oF));var u=0,d=-1;const R=t.length;for(var p=0;p<R;p++){var v=t[p];if(a?v==="/"&&t[p-1]==="*"&&(a=!1):s?s===v&&(s=!1):v==="/"&&t[p+1]==="*"?a=!0:v==='"'||v==="'"?s=v:v==="("?o++:v===")"&&o--,!a&&s===!1&&o===0){if(v===":"&&d===-1)d=p;else if(v===";"||p===R-1){if(d!==-1){var y=oF(t.substring(u,d).trim());if(!l.includes(y)){v!==";"&&p++;var w=t.substring(u,p).trim();i+=" "+w+";"}}u=p+1,d=-1}}}}return n&&(i+=b4(n)),r&&(i+=b4(r,!0)),i=i.trim(),i===""?null:i}return t==null?null:String(t)}function xi(t,e,i,n,r,s){var o=t.__className;if(or||o!==i){var a=Rle(i,n,s);(!or||a!==t.getAttribute("class"))&&(a==null?t.removeAttribute("class"):e?t.className=a:t.setAttribute("class",a)),t.__className=i}else if(s&&r!==s)for(var l in s){var u=!!s[l];(r==null||u!==!!r[l])&&t.classList.toggle(l,u)}return s}function aF(t,e={},i,n){for(var r in i){var s=i[r];e[r]!==s&&(i[r]==null?t.style.removeProperty(r):t.style.setProperty(r,s,n))}}function Jd(t,e,i,n){var r=t.__style;if(or||r!==e){var s=Ple(e,n);(!or||s!==t.getAttribute("style"))&&(s==null?t.removeAttribute("style"):t.style.cssText=s),t.__style=e}else n&&(Array.isArray(n)?(aF(t,i?.[0],n[0]),aF(t,i?.[1],n[1],"important")):aF(t,i,n));return n}const Eb=Symbol("class"),Ab=Symbol("style"),cZ=Symbol("is custom element"),uZ=Symbol("is html");function Ny(t){if(or){var e=!1,i=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var n=t.value;yr(t,"value",null),t.value=n}if(t.hasAttribute("checked")){var r=t.checked;yr(t,"checked",null),t.checked=r}}};t.__on_r=i,Kae(i),fle()}}function lF(t,e){var i=YV(t);i.value===(i.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function hZ(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function yr(t,e,i,n){var r=YV(t);or&&(r[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||r[e]!==(r[e]=i)&&(e==="loading"&&(t[Qae]=i),i==null?t.removeAttribute(e):typeof i!="string"&&dZ(t).includes(e)?t[e]=i:t.setAttribute(e,i))}function Ch(t,e,i,n,r=!1){var s=YV(t),o=s[cZ],a=!s[uZ];let l=or&&o;l&&og(!1);var u=e||{},d=t.tagName==="OPTION";for(var p in e)p in i||(i[p]=null);i.class?i.class=Ol(i.class):i[Eb]&&(i.class=null),i[Ab]&&(i.style??=null);var v=dZ(t);for(const F in i){let k=i[F];if(d&&F==="value"&&k==null){t.value=t.__value="",u[F]=k;continue}if(F==="class"){var y=t.namespaceURI==="http://www.w3.org/1999/xhtml";xi(t,y,k,n,e?.[Eb],i[Eb]),u[F]=k,u[Eb]=i[Eb];continue}if(F==="style"){Jd(t,k,e?.[Ab],i[Ab]),u[F]=k,u[Ab]=i[Ab];continue}var w=u[F];if(k!==w){u[F]=k;var R=F[0]+F[1];if(R!=="$$")if(R==="on"){const $={},W="$$"+F;let Q=F.slice(2);var O=ple(Q);if(cle(Q)&&(Q=Q.slice(0,-7),$.capture=!0),!O&&w){if(k!=null)continue;t.removeEventListener(Q,u[W],$),u[W]=null}if(k!=null)if(O)t[`__${Q}`]=k,Zg([Q]);else{let Y=function(M){u[F].call(this,M)};u[W]=ule(Q,t,Y,$)}else O&&(t[`__${Q}`]=void 0)}else if(F==="style")yr(t,F,k);else if(F==="autofocus")hle(t,!!k);else if(!o&&(F==="__value"||F==="value"&&k!=null))t.value=t.__value=k;else if(F==="selected"&&d)hZ(t,k);else{var P=F;a||(P=dle(P));var N=P==="defaultValue"||P==="defaultChecked";if(k==null&&!o&&!N)if(s[F]=null,P==="value"||P==="checked"){let $=t;const W=e===void 0;if(P==="value"){let Q=$.defaultValue;$.removeAttribute(P),$.defaultValue=Q,$.value=$.__value=W?Q:null}else{let Q=$.defaultChecked;$.removeAttribute(P),$.defaultChecked=Q,$.checked=W?Q:!1}}else t.removeAttribute(F);else N||v.includes(P)&&(o||typeof k!="string")?t[P]=k:typeof k!="function"&&yr(t,P,k)}}}return l&&og(!0),u}function YV(t){return t.__attributes??={[cZ]:t.nodeName.includes("-"),[uZ]:t.namespaceURI===Zae}}var w4=new Map;function dZ(t){var e=w4.get(t.nodeName);if(e)return e;w4.set(t.nodeName,e=[]);for(var i,n=t,r=Element.prototype;r!==n;){i=Yae(n);for(var s in i)i[s].set&&e.push(s);n=Xae(n)}return e}const Ele=()=>performance.now(),Ia={tick:t=>requestAnimationFrame(t),now:()=>Ele(),tasks:new Set};function fZ(){const t=Ia.now();Ia.tasks.forEach(e=>{e.c(t)||(Ia.tasks.delete(e),e.f())}),Ia.tasks.size!==0&&Ia.tick(fZ)}function pZ(t){let e;return Ia.tasks.size===0&&Ia.tick(fZ),{promise:new Promise(i=>{Ia.tasks.add(e={c:t,f:i})}),abort(){Ia.tasks.delete(e)}}}function JV(t,e,i=e){var n=$V();ZV(t,"input",r=>{var s=r?t.defaultValue:t.value;if(s=cF(t)?uF(s):s,i(s),n&&s!==(s=e())){var o=t.selectionStart,a=t.selectionEnd;t.value=s??"",a!==null&&(t.selectionStart=o,t.selectionEnd=Math.min(a,t.value.length))}}),(or&&t.defaultValue!==t.value||Og(e)==null&&t.value)&&i(cF(t)?uF(t.value):t.value),wC(()=>{var r=e();cF(t)&&r===uF(t.value)||t.type==="date"&&!r&&!t.value||r!==t.value&&(t.value=r??"")})}function Mrt(t,e,i=e){ZV(t,"change",n=>{var r=n?t.defaultChecked:t.checked;i(r)}),(or&&t.defaultChecked!==t.checked||Og(e)==null)&&i(t.checked),wC(()=>{var n=e();t.checked=!!n})}function cF(t){var e=t.type;return e==="number"||e==="range"}function uF(t){return t===""?null:+t}function Ks(t,e,i){var n=Jae(t,e);n&&n.set&&(t[e]=i,ele(()=>{t[e]=null}))}function mZ(t,e,i){if(t.multiple)return kle(t,e);for(var n of t.options){var r=Lw(n);if(yle(r,e)){n.selected=!0;return}}(!i||e!==void 0)&&(t.selectedIndex=-1)}function Ale(t,e){mh(()=>{var i=new MutationObserver(()=>{var n=t.__value;mZ(t,n)});return i.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{i.disconnect()}})}function Ile(t,e,i=e){var n=!0;ZV(t,"change",r=>{var s=r?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(s),Lw);else{var a=t.querySelector(s)??t.querySelector("option:not([disabled])");o=a&&Lw(a)}i(o)}),mh(()=>{var r=e();if(mZ(t,r,n),n&&r===void 0){var s=t.querySelector(":checked");s!==null&&(r=Lw(s),i(r))}t.__value=r,n=!1}),Ale(t)}function kle(t,e){for(var i of t.options)i.selected=~e.indexOf(Lw(i))}function Lw(t){return"__value"in t?t.__value:t.value}function WM(t){return function(...e){var i=e[0];return i.stopPropagation(),t?.apply(this,e)}}function gZ(t,e){var i=t.$$events?.[e.type],n=KQ(i)?i.slice():i==null?[]:[i];for(var r of n)r.call(this,e)}function _4(t,e){var i=b_,n=ile,r=qQ;UM(t),HM(t),$M(t.ctx);try{e()}finally{UM(i),HM(n),$M(r)}}function Dle(t,e,i){var n=t,r;Z0(()=>{var s=b_,o=ul,a=!1;s.fn=l=>{var u=e.onerror;let d=e.failed;if(!u&&!d||a)throw l;var p=()=>{sg(r),_4(s,()=>{a=!1,r=Td(()=>i(n)),nF()})};u?.(l,p),r?YR(r):or&&(fp(o),QV(),fp(e3())),d&&WV(()=>{_4(s,()=>{a=!0;try{r=Td(()=>{d(n,()=>l,()=>p)})}catch(v){nle(v,s,null,s.ctx)}nF(),a=!1})})},or&&Bd(),r=Td(()=>i(n)),nF()},JQ|tle),or&&(n=ul)}function cM(t){rt(t,t.v+1)}function Lle(t){let e=0,i=$l(0),n;return()=>{eZ()&&(B(i),wC(()=>(e===0&&(n=Og(()=>t(()=>cM(i)))),e+=1,()=>{Hc().then(()=>{e-=1,e===0&&(n?.(),n=void 0)})})))}}function Fle(t){let e;const i=Lle(r=>{let s=!1;const o=t.subscribe(a=>{e=a,s&&r()});return s=!0,o});function n(){return eZ()?(i(),e):Mg(t)}return"set"in t?{get current(){return n()},set current(r){t.set(r)}}:{get current(){return n()}}}const t3=new Map;function Trt(t,e){t3.has(t)||t3.set(t,{component:e})}function Nle(t){return t3.get(t)}const Rrt=[{name:"class",type:"string",placeholder:""},{name:"draggable",type:"boolean"},{name:"dragData",type:"string",placeholder:"Text to be sent when you drop this item"},{name:"tooltip",type:"string",placeholder:"Show text when user hovers"},{name:"background",type:"string",placeholder:"URL of background image"}],vZ=/^[a-z0-9]+(-[a-z0-9]+)*$/,tP=(t,e,i,n="")=>{const r=t.split(":");if(t.slice(0,1)==="@"){if(r.length<2||r.length>3)return null;n=r.shift().slice(1)}if(r.length>3||!r.length)return null;if(r.length>1){const a=r.pop(),l=r.pop(),u={provider:r.length>0?r[0]:n,prefix:l,name:a};return e&&!uM(u)?null:u}const s=r[0],o=s.split("-");if(o.length>1){const a={provider:n,prefix:o.shift(),name:o.join("-")};return e&&!uM(a)?null:a}if(i&&n===""){const a={provider:n,prefix:"",name:s};return e&&!uM(a,i)?null:a}return null},uM=(t,e)=>t?!!((e&&t.prefix===""||t.prefix)&&t.name):!1,yZ=Object.freeze({left:0,top:0,width:16,height:16}),qM=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),iP=Object.freeze({...yZ,...qM}),i3=Object.freeze({...iP,body:"",hidden:!1});function Ble(t,e){const i={};!t.hFlip!=!e.hFlip&&(i.hFlip=!0),!t.vFlip!=!e.vFlip&&(i.vFlip=!0);const n=((t.rotate||0)+(e.rotate||0))%4;return n&&(i.rotate=n),i}function C4(t,e){const i=Ble(t,e);for(const n in i3)n in qM?n in t&&!(n in i)&&(i[n]=qM[n]):n in e?i[n]=e[n]:n in t&&(i[n]=t[n]);return i}function zle(t,e){const i=t.icons,n=t.aliases||Object.create(null),r=Object.create(null);function s(o){if(i[o])return r[o]=[];if(!(o in r)){r[o]=null;const a=n[o]&&n[o].parent,l=a&&s(a);l&&(r[o]=[a].concat(l))}return r[o]}return Object.keys(i).concat(Object.keys(n)).forEach(s),r}function Vle(t,e,i){const n=t.icons,r=t.aliases||Object.create(null);let s={};function o(a){s=C4(n[a]||r[a],s)}return o(e),i.forEach(o),C4(t,s)}function xZ(t,e){const i=[];if(typeof t!="object"||typeof t.icons!="object")return i;t.not_found instanceof Array&&t.not_found.forEach(r=>{e(r,null),i.push(r)});const n=zle(t);for(const r in n){const s=n[r];s&&(e(r,Vle(t,r,s)),i.push(r))}return i}const Gle={provider:"",aliases:{},not_found:{},...yZ};function hF(t,e){for(const i in e)if(i in t&&typeof t[i]!=typeof e[i])return!1;return!0}function bZ(t){if(typeof t!="object"||t===null)return null;const e=t;if(typeof e.prefix!="string"||!t.icons||typeof t.icons!="object"||!hF(t,Gle))return null;const i=e.icons;for(const r in i){const s=i[r];if(!r||typeof s.body!="string"||!hF(s,i3))return null}const n=e.aliases||Object.create(null);for(const r in n){const s=n[r],o=s.parent;if(!r||typeof o!="string"||!i[o]&&!n[o]||!hF(s,i3))return null}return e}const S4=Object.create(null);function Ule(t,e){return{provider:t,prefix:e,icons:Object.create(null),missing:new Set}}function u0(t,e){const i=S4[t]||(S4[t]=Object.create(null));return i[e]||(i[e]=Ule(t,e))}function wZ(t,e){return bZ(e)?xZ(e,(i,n)=>{n?t.icons[i]=n:t.missing.add(i)}):[]}function Hle(t,e,i){try{if(typeof i.body=="string")return t.icons[e]={...i},!0}catch{}return!1}let w_=!1;function _Z(t){return typeof t=="boolean"&&(w_=t),w_}function $le(t){const e=typeof t=="string"?tP(t,!0,w_):t;if(e){const i=u0(e.provider,e.prefix),n=e.name;return i.icons[n]||(i.missing.has(n)?null:void 0)}}function Wle(t,e){const i=tP(t,!0,w_);if(!i)return!1;const n=u0(i.provider,i.prefix);return e?Hle(n,i.name,e):(n.missing.add(i.name),!0)}function qle(t,e){if(typeof t!="object")return!1;if(typeof e!="string"&&(e=t.provider||""),w_&&!e&&!t.prefix){let r=!1;return bZ(t)&&(t.prefix="",xZ(t,(s,o)=>{Wle(s,o)&&(r=!0)})),r}const i=t.prefix;if(!uM({prefix:i,name:"a"}))return!1;const n=u0(e,i);return!!wZ(n,t)}const CZ=Object.freeze({width:null,height:null}),SZ=Object.freeze({...CZ,...qM}),jle=/(-?[0-9.]*[0-9]+[0-9.]*)/g,Qle=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function O4(t,e,i){if(e===1)return t;if(i=i||100,typeof t=="number")return Math.ceil(t*e*i)/i;if(typeof t!="string")return t;const n=t.split(jle);if(n===null||!n.length)return t;const r=[];let s=n.shift(),o=Qle.test(s);for(;;){if(o){const a=parseFloat(s);isNaN(a)?r.push(s):r.push(Math.ceil(a*e*i)/i)}else r.push(s);if(s=n.shift(),s===void 0)return r.join("");o=!o}}function Zle(t,e="defs"){let i="";const n=t.indexOf("<"+e);for(;n>=0;){const r=t.indexOf(">",n),s=t.indexOf("</"+e);if(r===-1||s===-1)break;const o=t.indexOf(">",s);if(o===-1)break;i+=t.slice(r+1,s).trim(),t=t.slice(0,n).trim()+t.slice(o+1)}return{defs:i,content:t}}function Xle(t,e){return t?"<defs>"+t+"</defs>"+e:e}function Kle(t,e,i){const n=Zle(t);return Xle(n.defs,e+n.content+i)}const Yle=t=>t==="unset"||t==="undefined"||t==="none";function Jle(t,e){const i={...iP,...t},n={...SZ,...e},r={left:i.left,top:i.top,width:i.width,height:i.height};let s=i.body;[i,n].forEach(R=>{const O=[],P=R.hFlip,N=R.vFlip;let F=R.rotate;P?N?F+=2:(O.push("translate("+(r.width+r.left).toString()+" "+(0-r.top).toString()+")"),O.push("scale(-1 1)"),r.top=r.left=0):N&&(O.push("translate("+(0-r.left).toString()+" "+(r.height+r.top).toString()+")"),O.push("scale(1 -1)"),r.top=r.left=0);let k;switch(F<0&&(F-=Math.floor(F/4)*4),F=F%4,F){case 1:k=r.height/2+r.top,O.unshift("rotate(90 "+k.toString()+" "+k.toString()+")");break;case 2:O.unshift("rotate(180 "+(r.width/2+r.left).toString()+" "+(r.height/2+r.top).toString()+")");break;case 3:k=r.width/2+r.left,O.unshift("rotate(-90 "+k.toString()+" "+k.toString()+")");break}F%2===1&&(r.left!==r.top&&(k=r.left,r.left=r.top,r.top=k),r.width!==r.height&&(k=r.width,r.width=r.height,r.height=k)),O.length&&(s=Kle(s,'<g transform="'+O.join(" ")+'">',"</g>"))});const o=n.width,a=n.height,l=r.width,u=r.height;let d,p;o===null?(p=a===null?"1em":a==="auto"?u:a,d=O4(p,l/u)):(d=o==="auto"?l:o,p=a===null?O4(d,u/l):a==="auto"?u:a);const v={},y=(R,O)=>{Yle(O)||(v[R]=O.toString())};y("width",d),y("height",p);const w=[r.left,r.top,l,u];return v.viewBox=w.join(" "),{attributes:v,viewBox:w,body:s}}const ece=/\sid="(\S+)"/g,tce="IconifyId"+Date.now().toString(16)+(Math.random()*16777216|0).toString(16);let ice=0;function nce(t,e=tce){const i=[];let n;for(;n=ece.exec(t);)i.push(n[1]);if(!i.length)return t;const r="suffix"+(Math.random()*16777216|Date.now()).toString(16);return i.forEach(s=>{const o=typeof e=="function"?e(s):e+(ice++).toString(),a=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");t=t.replace(new RegExp('([#;"])('+a+')([")]|\\.[a-z])',"g"),"$1"+o+r+"$3")}),t=t.replace(new RegExp(r,"g"),""),t}const n3=Object.create(null);function rce(t,e){n3[t]=e}function r3(t){return n3[t]||n3[""]}function eG(t){let e;if(typeof t.resources=="string")e=[t.resources];else if(e=t.resources,!(e instanceof Array)||!e.length)return null;return{resources:e,path:t.path||"/",maxURL:t.maxURL||500,rotate:t.rotate||750,timeout:t.timeout||5e3,random:t.random===!0,index:t.index||0,dataAfterTimeout:t.dataAfterTimeout!==!1}}const tG=Object.create(null),Ib=["https://api.simplesvg.com","https://api.unisvg.com"],hM=[];for(;Ib.length>0;)Ib.length===1||Math.random()>.5?hM.push(Ib.shift()):hM.push(Ib.pop());tG[""]=eG({resources:["https://api.iconify.design"].concat(hM)});function sce(t,e){const i=eG(e);return i===null?!1:(tG[t]=i,!0)}function iG(t){return tG[t]}const oce=()=>{let t;try{if(t=fetch,typeof t=="function")return t}catch{}};let M4=oce();function ace(t,e){const i=iG(t);if(!i)return 0;let n;if(!i.maxURL)n=0;else{let r=0;i.resources.forEach(o=>{r=Math.max(r,o.length)});const s=e+".json?icons=";n=i.maxURL-r-i.path.length-s.length}return n}function lce(t){return t===404}const cce=(t,e,i)=>{const n=[],r=ace(t,e),s="icons";let o={type:s,provider:t,prefix:e,icons:[]},a=0;return i.forEach((l,u)=>{a+=l.length+1,a>=r&&u>0&&(n.push(o),o={type:s,provider:t,prefix:e,icons:[]},a=l.length),o.icons.push(l)}),n.push(o),n};function uce(t){if(typeof t=="string"){const e=iG(t);if(e)return e.path}return"/"}const hce=(t,e,i)=>{if(!M4){i("abort",424);return}let n=uce(e.provider);switch(e.type){case"icons":{const s=e.prefix,a=e.icons.join(","),l=new URLSearchParams({icons:a});n+=s+".json?"+l.toString();break}case"custom":{const s=e.uri;n+=s.slice(0,1)==="/"?s.slice(1):s;break}default:i("abort",400);return}let r=503;M4(t+n).then(s=>{const o=s.status;if(o!==200){setTimeout(()=>{i(lce(o)?"abort":"next",o)});return}return r=501,s.json()}).then(s=>{if(typeof s!="object"||s===null){setTimeout(()=>{s===404?i("abort",s):i("next",r)});return}setTimeout(()=>{i("success",s)})}).catch(()=>{i("next",r)})},dce={prepare:cce,send:hce};function fce(t){const e={loaded:[],missing:[],pending:[]},i=Object.create(null);t.sort((r,s)=>r.provider!==s.provider?r.provider.localeCompare(s.provider):r.prefix!==s.prefix?r.prefix.localeCompare(s.prefix):r.name.localeCompare(s.name));let n={provider:"",prefix:"",name:""};return t.forEach(r=>{if(n.name===r.name&&n.prefix===r.prefix&&n.provider===r.provider)return;n=r;const s=r.provider,o=r.prefix,a=r.name,l=i[s]||(i[s]=Object.create(null)),u=l[o]||(l[o]=u0(s,o));let d;a in u.icons?d=e.loaded:o===""||u.missing.has(a)?d=e.missing:d=e.pending;const p={provider:s,prefix:o,name:a};d.push(p)}),e}function OZ(t,e){t.forEach(i=>{const n=i.loaderCallbacks;n&&(i.loaderCallbacks=n.filter(r=>r.id!==e))})}function pce(t){t.pendingCallbacksFlag||(t.pendingCallbacksFlag=!0,setTimeout(()=>{t.pendingCallbacksFlag=!1;const e=t.loaderCallbacks?t.loaderCallbacks.slice(0):[];if(!e.length)return;let i=!1;const n=t.provider,r=t.prefix;e.forEach(s=>{const o=s.icons,a=o.pending.length;o.pending=o.pending.filter(l=>{if(l.prefix!==r)return!0;const u=l.name;if(t.icons[u])o.loaded.push({provider:n,prefix:r,name:u});else if(t.missing.has(u))o.missing.push({provider:n,prefix:r,name:u});else return i=!0,!0;return!1}),o.pending.length!==a&&(i||OZ([t],s.id),s.callback(o.loaded.slice(0),o.missing.slice(0),o.pending.slice(0),s.abort))})}))}let mce=0;function gce(t,e,i){const n=mce++,r=OZ.bind(null,i,n);if(!e.pending.length)return r;const s={id:n,icons:e,callback:t,abort:r};return i.forEach(o=>{(o.loaderCallbacks||(o.loaderCallbacks=[])).push(s)}),r}function vce(t,e=!0,i=!1){const n=[];return t.forEach(r=>{const s=typeof r=="string"?tP(r,e,i):r;s&&n.push(s)}),n}var yce={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function xce(t,e,i,n){const r=t.resources.length,s=t.random?Math.floor(Math.random()*r):t.index;let o;if(t.random){let W=t.resources.slice(0);for(o=[];W.length>1;){const Q=Math.floor(Math.random()*W.length);o.push(W[Q]),W=W.slice(0,Q).concat(W.slice(Q+1))}o=o.concat(W)}else o=t.resources.slice(s).concat(t.resources.slice(0,s));const a=Date.now();let l="pending",u=0,d,p=null,v=[],y=[];typeof n=="function"&&y.push(n);function w(){p&&(clearTimeout(p),p=null)}function R(){l==="pending"&&(l="aborted"),w(),v.forEach(W=>{W.status==="pending"&&(W.status="aborted")}),v=[]}function O(W,Q){Q&&(y=[]),typeof W=="function"&&y.push(W)}function P(){return{startTime:a,payload:e,status:l,queriesSent:u,queriesPending:v.length,subscribe:O,abort:R}}function N(){l="failed",y.forEach(W=>{W(void 0,d)})}function F(){v.forEach(W=>{W.status==="pending"&&(W.status="aborted")}),v=[]}function k(W,Q,Y){const M=Q!=="success";switch(v=v.filter(D=>D!==W),l){case"pending":break;case"failed":if(M||!t.dataAfterTimeout)return;break;default:return}if(Q==="abort"){d=Y,N();return}if(M){d=Y,v.length||(o.length?$():N());return}if(w(),F(),!t.random){const D=t.resources.indexOf(W.resource);D!==-1&&D!==t.index&&(t.index=D)}l="completed",y.forEach(D=>{D(Y)})}function $(){if(l!=="pending")return;w();const W=o.shift();if(W===void 0){if(v.length){p=setTimeout(()=>{w(),l==="pending"&&(F(),N())},t.timeout);return}N();return}const Q={status:"pending",resource:W,callback:(Y,M)=>{k(Q,Y,M)}};v.push(Q),u++,p=setTimeout($,t.rotate),i(W,e,Q.callback)}return setTimeout($),P}function MZ(t){const e={...yce,...t};let i=[];function n(){i=i.filter(a=>a().status==="pending")}function r(a,l,u){const d=xce(e,a,l,(p,v)=>{n(),u&&u(p,v)});return i.push(d),d}function s(a){return i.find(l=>a(l))||null}return{query:r,find:s,setIndex:a=>{e.index=a},getIndex:()=>e.index,cleanup:n}}function T4(){}const dF=Object.create(null);function bce(t){if(!dF[t]){const e=iG(t);if(!e)return;const i=MZ(e),n={config:e,redundancy:i};dF[t]=n}return dF[t]}function wce(t,e,i){let n,r;if(typeof t=="string"){const s=r3(t);if(!s)return i(void 0,424),T4;r=s.send;const o=bce(t);o&&(n=o.redundancy)}else{const s=eG(t);if(s){n=MZ(s);const o=t.resources?t.resources[0]:"",a=r3(o);a&&(r=a.send)}}return!n||!r?(i(void 0,424),T4):n.query(e,r,i)().abort}function R4(){}function _ce(t){t.iconsLoaderFlag||(t.iconsLoaderFlag=!0,setTimeout(()=>{t.iconsLoaderFlag=!1,pce(t)}))}function Cce(t){const e=[],i=[];return t.forEach(n=>{(n.match(vZ)?e:i).push(n)}),{valid:e,invalid:i}}function kb(t,e,i){function n(){const r=t.pendingIcons;e.forEach(s=>{r&&r.delete(s),t.icons[s]||t.missing.add(s)})}if(i&&typeof i=="object")try{if(!wZ(t,i).length){n();return}}catch(r){console.error(r)}n(),_ce(t)}function P4(t,e){t instanceof Promise?t.then(i=>{e(i)}).catch(()=>{e(null)}):e(t)}function Sce(t,e){t.iconsToLoad?t.iconsToLoad=t.iconsToLoad.concat(e).sort():t.iconsToLoad=e,t.iconsQueueFlag||(t.iconsQueueFlag=!0,setTimeout(()=>{t.iconsQueueFlag=!1;const{provider:i,prefix:n}=t,r=t.iconsToLoad;if(delete t.iconsToLoad,!r||!r.length)return;const s=t.loadIcon;if(t.loadIcons&&(r.length>1||!s)){P4(t.loadIcons(r,n,i),d=>{kb(t,r,d)});return}if(s){r.forEach(d=>{const p=s(d,n,i);P4(p,v=>{const y=v?{prefix:n,icons:{[d]:v}}:null;kb(t,[d],y)})});return}const{valid:o,invalid:a}=Cce(r);if(a.length&&kb(t,a,null),!o.length)return;const l=n.match(vZ)?r3(i):null;if(!l){kb(t,o,null);return}l.prepare(i,n,o).forEach(d=>{wce(i,d,p=>{kb(t,d.icons,p)})})}))}const Oce=(t,e)=>{const i=vce(t,!0,_Z()),n=fce(i);if(!n.pending.length){let l=!0;return e&&setTimeout(()=>{l&&e(n.loaded,n.missing,n.pending,R4)}),()=>{l=!1}}const r=Object.create(null),s=[];let o,a;return n.pending.forEach(l=>{const{provider:u,prefix:d}=l;if(d===a&&u===o)return;o=u,a=d,s.push(u0(u,d));const p=r[u]||(r[u]=Object.create(null));p[d]||(p[d]=[])}),n.pending.forEach(l=>{const{provider:u,prefix:d,name:p}=l,v=u0(u,d),y=v.pendingIcons||(v.pendingIcons=new Set);y.has(p)||(y.add(p),r[u][d].push(p))}),s.forEach(l=>{const u=r[l.provider][l.prefix];u.length&&Sce(l,u)}),e?gce(e,n,s):R4};function Mce(t,e){const i={...t};for(const n in e){const r=e[n],s=typeof r;n in CZ?(r===null||r&&(s==="string"||s==="number"))&&(i[n]=r):s===typeof i[n]&&(i[n]=n==="rotate"?r%4:r)}return i}const Tce=/[\s,]+/;function Rce(t,e){e.split(Tce).forEach(i=>{switch(i.trim()){case"horizontal":t.hFlip=!0;break;case"vertical":t.vFlip=!0;break}})}function Pce(t,e=0){const i=t.replace(/^-?[0-9.]*/,"");function n(r){for(;r<0;)r+=4;return r%4}if(i===""){const r=parseInt(t);return isNaN(r)?0:n(r)}else if(i!==t){let r=0;switch(i){case"%":r=25;break;case"deg":r=90}if(r){let s=parseFloat(t.slice(0,t.length-i.length));return isNaN(s)?0:(s=s/r,s%1===0?n(s):0)}}return e}function Ece(t,e){let i=t.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const n in e)i+=" "+n+'="'+e[n]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+i+">"+t+"</svg>"}function Ace(t){return t.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function Ice(t){return"data:image/svg+xml,"+Ace(t)}function kce(t){return'url("'+Ice(t)+'")'}const E4={...SZ,inline:!1},Dce={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":!0,role:"img"},Lce={display:"inline-block"},s3={"background-color":"currentColor"},TZ={"background-color":"transparent"},A4={image:"var(--svg)",repeat:"no-repeat",size:"100% 100%"},I4={"-webkit-mask":s3,mask:s3,background:TZ};for(const t in I4){const e=I4[t];for(const i in A4)e[t+"-"+i]=A4[i]}function Fce(t){return t+(t.match(/^[-0-9.]+$/)?"px":"")}function Nce(t,e){const i=Mce(E4,e),n=e.mode||"svg",r=n==="svg"?{...Dce}:{};t.body.indexOf("xlink:")===-1&&delete r["xmlns:xlink"];let s=typeof e.style=="string"?e.style:"";for(let P in e){const N=e[P];if(N!==void 0)switch(P){case"icon":case"style":case"onLoad":case"mode":case"ssr":break;case"inline":case"hFlip":case"vFlip":i[P]=N===!0||N==="true"||N===1;break;case"flip":typeof N=="string"&&Rce(i,N);break;case"color":s=s+(s.length>0&&s.trim().slice(-1)!==";"?";":"")+"color: "+N+"; ";break;case"rotate":typeof N=="string"?i[P]=Pce(N):typeof N=="number"&&(i[P]=N);break;case"ariaHidden":case"aria-hidden":N!==!0&&N!=="true"&&delete r["aria-hidden"];break;default:if(P.slice(0,3)==="on:")break;E4[P]===void 0&&(r[P]=N)}}const o=Jle(t,i),a=o.attributes;if(i.inline&&(s="vertical-align: -0.125em; "+s),n==="svg"){Object.assign(r,a),s!==""&&(r.style=s);let P=0,N=e.id;return typeof N=="string"&&(N=N.replace(/-/g,"_")),{svg:!0,attributes:r,body:nce(o.body,N?()=>N+"ID"+P++:"iconifySvelte")}}const{body:l,width:u,height:d}=t,p=n==="mask"||(n==="bg"?!1:l.indexOf("currentColor")!==-1),v=Ece(l,{...a,width:u+"",height:d+""}),w={"--svg":kce(v)},R=P=>{const N=a[P];N&&(w[P]=Fce(N))};R("width"),R("height"),Object.assign(w,Lce,p?s3:TZ);let O="";for(const P in w)O+=P+": "+w[P]+";";return r.style=O+s,{svg:!1,attributes:r}}_Z(!0);rce("",dce);if(typeof document<"u"&&typeof window<"u"){const t=window;if(t.IconifyPreload!==void 0){const e=t.IconifyPreload,i="Invalid IconifyPreload syntax.";typeof e=="object"&&e!==null&&(e instanceof Array?e:[e]).forEach(n=>{try{(typeof n!="object"||n===null||n instanceof Array||typeof n.icons!="object"||typeof n.prefix!="string"||!qle(n))&&console.error(i)}catch{console.error(i)}})}if(t.IconifyProviders!==void 0){const e=t.IconifyProviders;if(typeof e=="object"&&e!==null)for(let i in e){const n="IconifyProviders["+i+"] is invalid.";try{const r=e[i];if(typeof r!="object"||!r||r.resources===void 0)continue;sce(i,r)||console.error(n)}catch{console.error(n)}}}}function Bce(t,e,i,n,r){function s(){e.loading&&(e.loading.abort(),e.loading=null)}if(typeof t=="object"&&t!==null&&typeof t.body=="string")return e.name="",s(),{data:{...iP,...t}};let o;if(typeof t!="string"||(o=tP(t,!1,!0))===null)return s(),null;const a=$le(o);if(!a)return i&&(!e.loading||e.loading.name!==t)&&(s(),e.name="",e.loading={name:t,abort:Oce([o],n)}),null;s(),e.name!==t&&(e.name=t,r&&!e.destroyed&&r(t));const l=["iconify"];return o.prefix!==""&&l.push("iconify--"+o.prefix),o.provider!==""&&l.push("iconify--"+o.provider),{data:a,classes:l}}function k4(t,e){return t?Nce({...iP,...t},e):null}var zce=kae("<svg><!></svg>"),Vce=hi("<span></span>");function jM(t,e){const i=XV(e,["children","$$slots","$$events","$$legacy"]);Pi(e,!1);const n=Gt({name:"",loading:null,destroyed:!1});let r=Gt(!1),s=Gt(0),o=Gt();const a=v=>{typeof i.onLoad=="function"&&i.onLoad(v),nZ()("load",{icon:v})};function l(){rle(s)}Xo(()=>{rt(r,!0)}),As(()=>{xl(n,B(n).destroyed=!0),B(n).loading&&(B(n).loading.abort(),xl(n,B(n).loading=null))}),Ui(()=>(B(s),en(i),B(r),B(n),B(o),k4),()=>{B(s);const v=!!i.ssr||B(r),y=Bce(i.icon,B(n),v,l,a);rt(o,y?k4(y.data,i):null),B(o)&&y.classes&&xl(o,B(o).attributes.class=(typeof i.class=="string"?i.class+" ":"")+y.classes.join(" "))}),Is(),ts();var u=nn(),d=pi(u);{var p=v=>{var y=nn(),w=pi(y);{var R=P=>{var N=zce();let F;var k=Di(N);aZ(k,()=>B(o).body,!0,!1),_i(N),Gi(()=>F=Ch(N,F,{...B(o).attributes})),bt(P,N)},O=P=>{var N=Vce();let F;Gi(()=>F=Ch(N,F,{...B(o).attributes})),bt(P,N)};Yi(w,P=>{B(o).svg?P(R):P(O,!1)})}bt(v,y)};Yi(d,v=>{B(o)&&v(p)})}bt(t,u),Ei()}let o3=[],RZ=[];(()=>{let t="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let e=0,i=0;e<t.length;e++)(e%2?RZ:o3).push(i=i+t[e])})();function Gce(t){if(t<768)return!1;for(let e=0,i=o3.length;;){let n=e+i>>1;if(t<o3[n])i=n;else if(t>=RZ[n])e=n+1;else return!0;if(e==i)return!1}}function D4(t){return t>=127462&&t<=127487}const L4=8205;function Uce(t,e,i=!0,n=!0){return(i?PZ:Hce)(t,e,n)}function PZ(t,e,i){if(e==t.length)return e;e&&EZ(t.charCodeAt(e))&&AZ(t.charCodeAt(e-1))&&e--;let n=fF(t,e);for(e+=F4(n);e<t.length;){let r=fF(t,e);if(n==L4||r==L4||i&&Gce(r))e+=F4(r),n=r;else if(D4(r)){let s=0,o=e-2;for(;o>=0&&D4(fF(t,o));)s++,o-=2;if(s%2==0)break;e+=2}else break}return e}function Hce(t,e,i){for(;e>0;){let n=PZ(t,e-2,i);if(n<e)return n;e--}return 0}function fF(t,e){let i=t.charCodeAt(e);if(!AZ(i)||e+1==t.length)return i;let n=t.charCodeAt(e+1);return EZ(n)?(i-55296<<10)+(n-56320)+65536:i}function EZ(t){return t>=56320&&t<57344}function AZ(t){return t>=55296&&t<56320}function F4(t){return t<65536?1:2}let fr=class IZ{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,i,n){[e,i]=h0(this,e,i);let r=[];return this.decompose(0,e,r,2),n.length&&n.decompose(0,n.length,r,3),this.decompose(i,this.length,r,1),dM.from(r,this.length-(i-e)+n.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,i=this.length){[e,i]=h0(this,e,i);let n=[];return this.decompose(e,i,n,0),dM.from(n,i-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let i=this.scanIdentical(e,1),n=this.length-this.scanIdentical(e,-1),r=new Fw(this),s=new Fw(e);for(let o=i,a=i;;){if(r.next(o),s.next(o),o=0,r.lineBreak!=s.lineBreak||r.done!=s.done||r.value!=s.value)return!1;if(a+=r.value.length,r.done||a>=n)return!0}}iter(e=1){return new Fw(this,e)}iterRange(e,i=this.length){return new kZ(this,e,i)}iterLines(e,i){let n;if(e==null)n=this.iter();else{i==null&&(i=this.lines+1);let r=this.line(e).from;n=this.iterRange(r,Math.max(r,i==this.lines+1?this.length:i<=1?0:this.line(i-1).to))}return new DZ(n)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?IZ.empty:e.length<=32?new Gs(e):dM.from(Gs.split(e,[]))}};class Gs extends fr{constructor(e,i=$ce(e)){super(),this.text=e,this.length=i}get lines(){return this.text.length}get children(){return null}lineInner(e,i,n,r){for(let s=0;;s++){let o=this.text[s],a=r+o.length;if((i?n:a)>=e)return new Wce(r,a,n,o);r=a+1,n++}}decompose(e,i,n,r){let s=e<=0&&i>=this.length?this:new Gs(N4(this.text,e,i),Math.min(i,this.length)-Math.max(0,e));if(r&1){let o=n.pop(),a=fM(s.text,o.text.slice(),0,s.length);if(a.length<=32)n.push(new Gs(a,o.length+s.length));else{let l=a.length>>1;n.push(new Gs(a.slice(0,l)),new Gs(a.slice(l)))}}else n.push(s)}replace(e,i,n){if(!(n instanceof Gs))return super.replace(e,i,n);[e,i]=h0(this,e,i);let r=fM(this.text,fM(n.text,N4(this.text,0,e)),i),s=this.length+n.length-(i-e);return r.length<=32?new Gs(r,s):dM.from(Gs.split(r,[]),s)}sliceString(e,i=this.length,n=`
`){[e,i]=h0(this,e,i);let r="";for(let s=0,o=0;s<=i&&o<this.text.length;o++){let a=this.text[o],l=s+a.length;s>e&&o&&(r+=n),e<l&&i>s&&(r+=a.slice(Math.max(0,e-s),i-s)),s=l+1}return r}flatten(e){for(let i of this.text)e.push(i)}scanIdentical(){return 0}static split(e,i){let n=[],r=-1;for(let s of e)n.push(s),r+=s.length+1,n.length==32&&(i.push(new Gs(n,r)),n=[],r=-1);return r>-1&&i.push(new Gs(n,r)),i}}let dM=class Py extends fr{constructor(e,i){super(),this.children=e,this.length=i,this.lines=0;for(let n of e)this.lines+=n.lines}lineInner(e,i,n,r){for(let s=0;;s++){let o=this.children[s],a=r+o.length,l=n+o.lines-1;if((i?l:a)>=e)return o.lineInner(e,i,n,r);r=a+1,n=l+1}}decompose(e,i,n,r){for(let s=0,o=0;o<=i&&s<this.children.length;s++){let a=this.children[s],l=o+a.length;if(e<=l&&i>=o){let u=r&((o<=e?1:0)|(l>=i?2:0));o>=e&&l<=i&&!u?n.push(a):a.decompose(e-o,i-o,n,u)}o=l+1}}replace(e,i,n){if([e,i]=h0(this,e,i),n.lines<this.lines)for(let r=0,s=0;r<this.children.length;r++){let o=this.children[r],a=s+o.length;if(e>=s&&i<=a){let l=o.replace(e-s,i-s,n),u=this.lines-o.lines+l.lines;if(l.lines<u>>4&&l.lines>u>>6){let d=this.children.slice();return d[r]=l,new Py(d,this.length-(i-e)+n.length)}return super.replace(s,a,l)}s=a+1}return super.replace(e,i,n)}sliceString(e,i=this.length,n=`
`){[e,i]=h0(this,e,i);let r="";for(let s=0,o=0;s<this.children.length&&o<=i;s++){let a=this.children[s],l=o+a.length;o>e&&s&&(r+=n),e<l&&i>o&&(r+=a.sliceString(e-o,i-o,n)),o=l+1}return r}flatten(e){for(let i of this.children)i.flatten(e)}scanIdentical(e,i){if(!(e instanceof Py))return 0;let n=0,[r,s,o,a]=i>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;r+=i,s+=i){if(r==o||s==a)return n;let l=this.children[r],u=e.children[s];if(l!=u)return n+l.scanIdentical(u,i);n+=l.length+1}}static from(e,i=e.reduce((n,r)=>n+r.length+1,-1)){let n=0;for(let y of e)n+=y.lines;if(n<32){let y=[];for(let w of e)w.flatten(y);return new Gs(y,i)}let r=Math.max(32,n>>5),s=r<<1,o=r>>1,a=[],l=0,u=-1,d=[];function p(y){let w;if(y.lines>s&&y instanceof Py)for(let R of y.children)p(R);else y.lines>o&&(l>o||!l)?(v(),a.push(y)):y instanceof Gs&&l&&(w=d[d.length-1])instanceof Gs&&y.lines+w.lines<=32?(l+=y.lines,u+=y.length+1,d[d.length-1]=new Gs(w.text.concat(y.text),w.length+1+y.length)):(l+y.lines>r&&v(),l+=y.lines,u+=y.length+1,d.push(y))}function v(){l!=0&&(a.push(d.length==1?d[0]:Py.from(d,u)),u=-1,l=d.length=0)}for(let y of e)p(y);return v(),a.length==1?a[0]:new Py(a,i)}};fr.empty=new Gs([""],0);function $ce(t){let e=-1;for(let i of t)e+=i.length+1;return e}function fM(t,e,i=0,n=1e9){for(let r=0,s=0,o=!0;s<t.length&&r<=n;s++){let a=t[s],l=r+a.length;l>=i&&(l>n&&(a=a.slice(0,n-r)),r<i&&(a=a.slice(i-r)),o?(e[e.length-1]+=a,o=!1):e.push(a)),r=l+1}return e}function N4(t,e,i){return fM(t,[""],e,i)}class Fw{constructor(e,i=1){this.dir=i,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[i>0?1:(e instanceof Gs?e.text.length:e.children.length)<<1]}nextInner(e,i){for(this.done=this.lineBreak=!1;;){let n=this.nodes.length-1,r=this.nodes[n],s=this.offsets[n],o=s>>1,a=r instanceof Gs?r.text.length:r.children.length;if(o==(i>0?a:0)){if(n==0)return this.done=!0,this.value="",this;i>0&&this.offsets[n-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(i>0?0:1)){if(this.offsets[n]+=i,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(r instanceof Gs){let l=r.text[o+(i<0?-1:0)];if(this.offsets[n]+=i,l.length>Math.max(0,e))return this.value=e==0?l:i>0?l.slice(e):l.slice(0,l.length-e),this;e-=l.length}else{let l=r.children[o+(i<0?-1:0)];e>l.length?(e-=l.length,this.offsets[n]+=i):(i<0&&this.offsets[n]--,this.nodes.push(l),this.offsets.push(i>0?1:(l instanceof Gs?l.text.length:l.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class kZ{constructor(e,i,n){this.value="",this.done=!1,this.cursor=new Fw(e,i>n?-1:1),this.pos=i>n?e.length:0,this.from=Math.min(i,n),this.to=Math.max(i,n)}nextInner(e,i){if(i<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,i<0?this.pos-this.to:this.from-this.pos);let n=i<0?this.pos-this.from:this.to-this.pos;e>n&&(e=n),n-=e;let{value:r}=this.cursor.next(e);return this.pos+=(r.length+e)*i,this.value=r.length<=n?r:i<0?r.slice(r.length-n):r.slice(0,n),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class DZ{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:i,lineBreak:n,value:r}=this.inner.next(e);return i&&this.afterBreak?(this.value="",this.afterBreak=!1):i?(this.done=!0,this.value=""):n?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=r,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(fr.prototype[Symbol.iterator]=function(){return this.iter()},Fw.prototype[Symbol.iterator]=kZ.prototype[Symbol.iterator]=DZ.prototype[Symbol.iterator]=function(){return this});let Wce=class{constructor(e,i,n,r){this.from=e,this.to=i,this.number=n,this.text=r}get length(){return this.to-this.from}};function h0(t,e,i){return e=Math.max(0,Math.min(t.length,e)),[e,Math.max(e,Math.min(t.length,i))]}function Qo(t,e,i=!0,n=!0){return Uce(t,e,i,n)}function qce(t){return t>=56320&&t<57344}function jce(t){return t>=55296&&t<56320}function al(t,e){let i=t.charCodeAt(e);if(!jce(i)||e+1==t.length)return i;let n=t.charCodeAt(e+1);return qce(n)?(i-55296<<10)+(n-56320)+65536:i}function nG(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10)+55296,(t&1023)+56320))}function sh(t){return t<65536?1:2}const a3=/\r\n?|\n/;var jo=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(jo||(jo={}));class gh{constructor(e){this.sections=e}get length(){let e=0;for(let i=0;i<this.sections.length;i+=2)e+=this.sections[i];return e}get newLength(){let e=0;for(let i=0;i<this.sections.length;i+=2){let n=this.sections[i+1];e+=n<0?this.sections[i]:n}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let i=0,n=0,r=0;i<this.sections.length;){let s=this.sections[i++],o=this.sections[i++];o<0?(e(n,r,s),r+=s):r+=o,n+=s}}iterChangedRanges(e,i=!1){l3(this,e,i)}get invertedDesc(){let e=[];for(let i=0;i<this.sections.length;){let n=this.sections[i++],r=this.sections[i++];r<0?e.push(n,r):e.push(r,n)}return new gh(e)}composeDesc(e){return this.empty?e:e.empty?this:LZ(this,e)}mapDesc(e,i=!1){return e.empty?this:c3(this,e,i)}mapPos(e,i=-1,n=jo.Simple){let r=0,s=0;for(let o=0;o<this.sections.length;){let a=this.sections[o++],l=this.sections[o++],u=r+a;if(l<0){if(u>e)return s+(e-r);s+=a}else{if(n!=jo.Simple&&u>=e&&(n==jo.TrackDel&&r<e&&u>e||n==jo.TrackBefore&&r<e||n==jo.TrackAfter&&u>e))return null;if(u>e||u==e&&i<0&&!a)return e==r||i<0?s:s+l;s+=l}r=u}if(e>r)throw new RangeError(`Position ${e} is out of range for changeset of length ${r}`);return s}touchesRange(e,i=e){for(let n=0,r=0;n<this.sections.length&&r<=i;){let s=this.sections[n++],o=this.sections[n++],a=r+s;if(o>=0&&r<=i&&a>=e)return r<e&&a>i?"cover":!0;r=a}return!1}toString(){let e="";for(let i=0;i<this.sections.length;){let n=this.sections[i++],r=this.sections[i++];e+=(e?" ":"")+n+(r>=0?":"+r:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(i=>typeof i!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new gh(e)}static create(e){return new gh(e)}}class ao extends gh{constructor(e,i){super(e),this.inserted=i}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return l3(this,(i,n,r,s,o)=>e=e.replace(r,r+(n-i),o),!1),e}mapDesc(e,i=!1){return c3(this,e,i,!0)}invert(e){let i=this.sections.slice(),n=[];for(let r=0,s=0;r<i.length;r+=2){let o=i[r],a=i[r+1];if(a>=0){i[r]=a,i[r+1]=o;let l=r>>1;for(;n.length<l;)n.push(fr.empty);n.push(o?e.slice(s,s+o):fr.empty)}s+=o}return new ao(i,n)}compose(e){return this.empty?e:e.empty?this:LZ(this,e,!0)}map(e,i=!1){return e.empty?this:c3(this,e,i,!0)}iterChanges(e,i=!1){l3(this,e,i)}get desc(){return gh.create(this.sections)}filter(e){let i=[],n=[],r=[],s=new __(this);e:for(let o=0,a=0;;){let l=o==e.length?1e9:e[o++];for(;a<l||a==l&&s.len==0;){if(s.done)break e;let d=Math.min(s.len,l-a);la(r,d,-1);let p=s.ins==-1?-1:s.off==0?s.ins:0;la(i,d,p),p>0&&sp(n,i,s.text),s.forward(d),a+=d}let u=e[o++];for(;a<u;){if(s.done)break e;let d=Math.min(s.len,u-a);la(i,d,-1),la(r,d,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(d),a+=d}}return{changes:new ao(i,n),filtered:gh.create(r)}}toJSON(){let e=[];for(let i=0;i<this.sections.length;i+=2){let n=this.sections[i],r=this.sections[i+1];r<0?e.push(n):r==0?e.push([n]):e.push([n].concat(this.inserted[i>>1].toJSON()))}return e}static of(e,i,n){let r=[],s=[],o=0,a=null;function l(d=!1){if(!d&&!r.length)return;o<i&&la(r,i-o,-1);let p=new ao(r,s);a=a?a.compose(p.map(a)):p,r=[],s=[],o=0}function u(d){if(Array.isArray(d))for(let p of d)u(p);else if(d instanceof ao){if(d.length!=i)throw new RangeError(`Mismatched change set length (got ${d.length}, expected ${i})`);l(),a=a?a.compose(d.map(a)):d}else{let{from:p,to:v=p,insert:y}=d;if(p>v||p<0||v>i)throw new RangeError(`Invalid change range ${p} to ${v} (in doc of length ${i})`);let w=y?typeof y=="string"?fr.of(y.split(n||a3)):y:fr.empty,R=w.length;if(p==v&&R==0)return;p<o&&l(),p>o&&la(r,p-o,-1),la(r,v-p,R),sp(s,r,w),o=v}}return u(e),l(!a),a}static empty(e){return new ao(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let i=[],n=[];for(let r=0;r<e.length;r++){let s=e[r];if(typeof s=="number")i.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((o,a)=>a&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)i.push(s[0],0);else{for(;n.length<r;)n.push(fr.empty);n[r]=fr.of(s.slice(1)),i.push(s[0],n[r].length)}}}return new ao(i,n)}static createSet(e,i){return new ao(e,i)}}function la(t,e,i,n=!1){if(e==0&&i<=0)return;let r=t.length-2;r>=0&&i<=0&&i==t[r+1]?t[r]+=e:r>=0&&e==0&&t[r]==0?t[r+1]+=i:n?(t[r]+=e,t[r+1]+=i):t.push(e,i)}function sp(t,e,i){if(i.length==0)return;let n=e.length-2>>1;if(n<t.length)t[t.length-1]=t[t.length-1].append(i);else{for(;t.length<n;)t.push(fr.empty);t.push(i)}}function l3(t,e,i){let n=t.inserted;for(let r=0,s=0,o=0;o<t.sections.length;){let a=t.sections[o++],l=t.sections[o++];if(l<0)r+=a,s+=a;else{let u=r,d=s,p=fr.empty;for(;u+=a,d+=l,l&&n&&(p=p.append(n[o-2>>1])),!(i||o==t.sections.length||t.sections[o+1]<0);)a=t.sections[o++],l=t.sections[o++];e(r,u,s,d,p),r=u,s=d}}}function c3(t,e,i,n=!1){let r=[],s=n?[]:null,o=new __(t),a=new __(e);for(let l=-1;;){if(o.done&&a.len||a.done&&o.len)throw new Error("Mismatched change set lengths");if(o.ins==-1&&a.ins==-1){let u=Math.min(o.len,a.len);la(r,u,-1),o.forward(u),a.forward(u)}else if(a.ins>=0&&(o.ins<0||l==o.i||o.off==0&&(a.len<o.len||a.len==o.len&&!i))){let u=a.len;for(la(r,a.ins,-1);u;){let d=Math.min(o.len,u);o.ins>=0&&l<o.i&&o.len<=d&&(la(r,0,o.ins),s&&sp(s,r,o.text),l=o.i),o.forward(d),u-=d}a.next()}else if(o.ins>=0){let u=0,d=o.len;for(;d;)if(a.ins==-1){let p=Math.min(d,a.len);u+=p,d-=p,a.forward(p)}else if(a.ins==0&&a.len<d)d-=a.len,a.next();else break;la(r,u,l<o.i?o.ins:0),s&&l<o.i&&sp(s,r,o.text),l=o.i,o.forward(o.len-d)}else{if(o.done&&a.done)return s?ao.createSet(r,s):gh.create(r);throw new Error("Mismatched change set lengths")}}}function LZ(t,e,i=!1){let n=[],r=i?[]:null,s=new __(t),o=new __(e);for(let a=!1;;){if(s.done&&o.done)return r?ao.createSet(n,r):gh.create(n);if(s.ins==0)la(n,s.len,0,a),s.next();else if(o.len==0&&!o.done)la(n,0,o.ins,a),r&&sp(r,n,o.text),o.next();else{if(s.done||o.done)throw new Error("Mismatched change set lengths");{let l=Math.min(s.len2,o.len),u=n.length;if(s.ins==-1){let d=o.ins==-1?-1:o.off?0:o.ins;la(n,l,d,a),r&&d&&sp(r,n,o.text)}else o.ins==-1?(la(n,s.off?0:s.len,l,a),r&&sp(r,n,s.textBit(l))):(la(n,s.off?0:s.len,o.off?0:o.ins,a),r&&!o.off&&sp(r,n,o.text));a=(s.ins>l||o.ins>=0&&o.len>l)&&(a||n.length>u),s.forward2(l),o.forward(l)}}}}class __{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length?fr.empty:e[i]}textBit(e){let{inserted:i}=this.set,n=this.i-2>>1;return n>=i.length&&!e?fr.empty:i[n].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}let y1=class u3{constructor(e,i,n){this.from=e,this.to=i,this.flags=n}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,i=-1){let n,r;return this.empty?n=r=e.mapPos(this.from,i):(n=e.mapPos(this.from,1),r=e.mapPos(this.to,-1)),n==this.from&&r==this.to?this:new u3(n,r,this.flags)}extend(e,i=e){if(e<=this.anchor&&i>=this.anchor)return Kt.range(e,i);let n=Math.abs(e-this.anchor)>Math.abs(i-this.anchor)?e:i;return Kt.range(this.anchor,n)}eq(e,i=!1){return this.anchor==e.anchor&&this.head==e.head&&(!i||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return Kt.range(e.anchor,e.head)}static create(e,i,n){return new u3(e,i,n)}};class Kt{constructor(e,i){this.ranges=e,this.mainIndex=i}map(e,i=-1){return e.empty?this:Kt.create(this.ranges.map(n=>n.map(e,i)),this.mainIndex)}eq(e,i=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let n=0;n<this.ranges.length;n++)if(!this.ranges[n].eq(e.ranges[n],i))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new Kt([this.main],0)}addRange(e,i=!0){return Kt.create([e].concat(this.ranges),i?0:this.mainIndex+1)}replaceRange(e,i=this.mainIndex){let n=this.ranges.slice();return n[i]=e,Kt.create(n,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new Kt(e.ranges.map(i=>y1.fromJSON(i)),e.main)}static single(e,i=e){return new Kt([Kt.range(e,i)],0)}static create(e,i=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let n=0,r=0;r<e.length;r++){let s=e[r];if(s.empty?s.from<=n:s.from<n)return Kt.normalized(e.slice(),i);n=s.to}return new Kt(e,i)}static cursor(e,i=0,n,r){return y1.create(e,e,(i==0?0:i<0?8:16)|(n==null?7:Math.min(6,n))|(r??16777215)<<6)}static range(e,i,n,r){let s=(n??16777215)<<6|(r==null?7:Math.min(6,r));return i<e?y1.create(i,e,48|s):y1.create(e,i,(i>e?8:0)|s)}static normalized(e,i=0){let n=e[i];e.sort((r,s)=>r.from-s.from),i=e.indexOf(n);for(let r=1;r<e.length;r++){let s=e[r],o=e[r-1];if(s.empty?s.from<=o.to:s.from<o.to){let a=o.from,l=Math.max(s.to,o.to);r<=i&&i--,e.splice(--r,2,s.anchor>s.head?Kt.range(l,a):Kt.range(a,l))}}return new Kt(e,i)}}function FZ(t,e){for(let i of t.ranges)if(i.to>e)throw new RangeError("Selection points outside of document")}let rG=0;class Fi{constructor(e,i,n,r,s){this.combine=e,this.compareInput=i,this.compare=n,this.isStatic=r,this.id=rG++,this.default=e([]),this.extensions=typeof s=="function"?s(this):s}get reader(){return this}static define(e={}){return new Fi(e.combine||(i=>i),e.compareInput||((i,n)=>i===n),e.compare||(e.combine?(i,n)=>i===n:sG),!!e.static,e.enables)}of(e){return new pM([],this,0,e)}compute(e,i){if(this.isStatic)throw new Error("Can't compute a static facet");return new pM(e,this,1,i)}computeN(e,i){if(this.isStatic)throw new Error("Can't compute a static facet");return new pM(e,this,2,i)}from(e,i){return i||(i=n=>n),this.compute([e],n=>i(n.field(e)))}}function sG(t,e){return t==e||t.length==e.length&&t.every((i,n)=>i===e[n])}class pM{constructor(e,i,n,r){this.dependencies=e,this.facet=i,this.type=n,this.value=r,this.id=rG++}dynamicSlot(e){var i;let n=this.value,r=this.facet.compareInput,s=this.id,o=e[s]>>1,a=this.type==2,l=!1,u=!1,d=[];for(let p of this.dependencies)p=="doc"?l=!0:p=="selection"?u=!0:(((i=e[p.id])!==null&&i!==void 0?i:1)&1)==0&&d.push(e[p.id]);return{create(p){return p.values[o]=n(p),1},update(p,v){if(l&&v.docChanged||u&&(v.docChanged||v.selection)||h3(p,d)){let y=n(p);if(a?!B4(y,p.values[o],r):!r(y,p.values[o]))return p.values[o]=y,1}return 0},reconfigure:(p,v)=>{let y,w=v.config.address[s];if(w!=null){let R=QM(v,w);if(this.dependencies.every(O=>O instanceof Fi?v.facet(O)===p.facet(O):O instanceof Do?v.field(O,!1)==p.field(O,!1):!0)||(a?B4(y=n(p),R,r):r(y=n(p),R)))return p.values[o]=R,0}else y=n(p);return p.values[o]=y,1}}}}function B4(t,e,i){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!i(t[n],e[n]))return!1;return!0}function h3(t,e){let i=!1;for(let n of e)Nw(t,n)&1&&(i=!0);return i}function Qce(t,e,i){let n=i.map(l=>t[l.id]),r=i.map(l=>l.type),s=n.filter(l=>!(l&1)),o=t[e.id]>>1;function a(l){let u=[];for(let d=0;d<n.length;d++){let p=QM(l,n[d]);if(r[d]==2)for(let v of p)u.push(v);else u.push(p)}return e.combine(u)}return{create(l){for(let u of n)Nw(l,u);return l.values[o]=a(l),1},update(l,u){if(!h3(l,s))return 0;let d=a(l);return e.compare(d,l.values[o])?0:(l.values[o]=d,1)},reconfigure(l,u){let d=h3(l,n),p=u.config.facets[e.id],v=u.facet(e);if(p&&!d&&sG(i,p))return l.values[o]=v,0;let y=a(l);return e.compare(y,v)?(l.values[o]=v,0):(l.values[o]=y,1)}}}const x1=Fi.define({static:!0});class Do{constructor(e,i,n,r,s){this.id=e,this.createF=i,this.updateF=n,this.compareF=r,this.spec=s,this.provides=void 0}static define(e){let i=new Do(rG++,e.create,e.update,e.compare||((n,r)=>n===r),e);return e.provide&&(i.provides=e.provide(i)),i}create(e){let i=e.facet(x1).find(n=>n.field==this);return(i?.create||this.createF)(e)}slot(e){let i=e[this.id]>>1;return{create:n=>(n.values[i]=this.create(n),1),update:(n,r)=>{let s=n.values[i],o=this.updateF(s,r);return this.compareF(s,o)?0:(n.values[i]=o,1)},reconfigure:(n,r)=>{let s=n.facet(x1),o=r.facet(x1),a;return(a=s.find(l=>l.field==this))&&a!=o.find(l=>l.field==this)?(n.values[i]=a.create(n),1):r.config.address[this.id]!=null?(n.values[i]=r.field(this),0):(n.values[i]=this.create(n),1)}}}init(e){return[this,x1.of({field:this,create:e})]}get extension(){return this}}const Hm={lowest:4,low:3,default:2,high:1,highest:0};function Db(t){return e=>new NZ(e,t)}const kp={highest:Db(Hm.highest),high:Db(Hm.high),default:Db(Hm.default),low:Db(Hm.low),lowest:Db(Hm.lowest)};class NZ{constructor(e,i){this.inner=e,this.prec=i}}class nP{of(e){return new d3(this,e)}reconfigure(e){return nP.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class d3{constructor(e,i){this.compartment=e,this.inner=i}}let z4=class BZ{constructor(e,i,n,r,s,o){for(this.base=e,this.compartments=i,this.dynamicSlots=n,this.address=r,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<n.length;)this.statusTemplate.push(0)}staticFacet(e){let i=this.address[e.id];return i==null?e.default:this.staticValues[i>>1]}static resolve(e,i,n){let r=[],s=Object.create(null),o=new Map;for(let v of Zce(e,i,o))v instanceof Do?r.push(v):(s[v.facet.id]||(s[v.facet.id]=[])).push(v);let a=Object.create(null),l=[],u=[];for(let v of r)a[v.id]=u.length<<1,u.push(y=>v.slot(y));let d=n?.config.facets;for(let v in s){let y=s[v],w=y[0].facet,R=d&&d[v]||[];if(y.every(O=>O.type==0))if(a[w.id]=l.length<<1|1,sG(R,y))l.push(n.facet(w));else{let O=w.combine(y.map(P=>P.value));l.push(n&&w.compare(O,n.facet(w))?n.facet(w):O)}else{for(let O of y)O.type==0?(a[O.id]=l.length<<1|1,l.push(O.value)):(a[O.id]=u.length<<1,u.push(P=>O.dynamicSlot(P)));a[w.id]=u.length<<1,u.push(O=>Qce(O,w,y))}}let p=u.map(v=>v(a));return new BZ(e,o,p,a,l,s)}};function Zce(t,e,i){let n=[[],[],[],[],[]],r=new Map;function s(o,a){let l=r.get(o);if(l!=null){if(l<=a)return;let u=n[l].indexOf(o);u>-1&&n[l].splice(u,1),o instanceof d3&&i.delete(o.compartment)}if(r.set(o,a),Array.isArray(o))for(let u of o)s(u,a);else if(o instanceof d3){if(i.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let u=e.get(o.compartment)||o.inner;i.set(o.compartment,u),s(u,a)}else if(o instanceof NZ)s(o.inner,o.prec);else if(o instanceof Do)n[a].push(o),o.provides&&s(o.provides,a);else if(o instanceof pM)n[a].push(o),o.facet.extensions&&s(o.facet.extensions,Hm.default);else{let u=o.extension;if(!u)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(u,a)}}return s(t,Hm.default),n.reduce((o,a)=>o.concat(a))}function Nw(t,e){if(e&1)return 2;let i=e>>1,n=t.status[i];if(n==4)throw new Error("Cyclic dependency between fields and/or facets");if(n&2)return n;t.status[i]=4;let r=t.computeSlot(t,t.config.dynamicSlots[i]);return t.status[i]=2|r}function QM(t,e){return e&1?t.config.staticValues[e>>1]:t.values[e>>1]}const zZ=Fi.define(),f3=Fi.define({combine:t=>t.some(e=>e),static:!0}),VZ=Fi.define({combine:t=>t.length?t[0]:void 0,static:!0}),GZ=Fi.define(),UZ=Fi.define(),HZ=Fi.define(),$Z=Fi.define({combine:t=>t.length?t[0]:!1});class ef{constructor(e,i){this.type=e,this.value=i}static define(){return new Xce}}class Xce{of(e){return new ef(this,e)}}class Kce{constructor(e){this.map=e}of(e){return new _n(this,e)}}class _n{constructor(e,i){this.type=e,this.value=i}map(e){let i=this.type.map(this.value,e);return i===void 0?void 0:i==this.value?this:new _n(this.type,i)}is(e){return this.type==e}static define(e={}){return new Kce(e.map||(i=>i))}static mapEffects(e,i){if(!e.length)return e;let n=[];for(let r of e){let s=r.map(i);s&&n.push(s)}return n}}_n.reconfigure=_n.define();_n.appendConfig=_n.define();let Va=class dw{constructor(e,i,n,r,s,o){this.startState=e,this.changes=i,this.selection=n,this.effects=r,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,n&&FZ(n,i.newLength),s.some(a=>a.type==dw.time)||(this.annotations=s.concat(dw.time.of(Date.now())))}static create(e,i,n,r,s,o){return new dw(e,i,n,r,s,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let i of this.annotations)if(i.type==e)return i.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let i=this.annotation(dw.userEvent);return!!(i&&(i==e||i.length>e.length&&i.slice(0,e.length)==e&&i[e.length]=="."))}};Va.time=ef.define();Va.userEvent=ef.define();Va.addToHistory=ef.define();Va.remote=ef.define();function Yce(t,e){let i=[];for(let n=0,r=0;;){let s,o;if(n<t.length&&(r==e.length||e[r]>=t[n]))s=t[n++],o=t[n++];else if(r<e.length)s=e[r++],o=e[r++];else return i;!i.length||i[i.length-1]<s?i.push(s,o):i[i.length-1]<o&&(i[i.length-1]=o)}}function WZ(t,e,i){var n;let r,s,o;return i?(r=e.changes,s=ao.empty(e.changes.length),o=t.changes.compose(e.changes)):(r=e.changes.map(t.changes),s=t.changes.mapDesc(e.changes,!0),o=t.changes.compose(r)),{changes:o,selection:e.selection?e.selection.map(s):(n=t.selection)===null||n===void 0?void 0:n.map(r),effects:_n.mapEffects(t.effects,r).concat(_n.mapEffects(e.effects,s)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function p3(t,e,i){let n=e.selection,r=jy(e.annotations);return e.userEvent&&(r=r.concat(Va.userEvent.of(e.userEvent))),{changes:e.changes instanceof ao?e.changes:ao.of(e.changes||[],i,t.facet(VZ)),selection:n&&(n instanceof Kt?n:Kt.single(n.anchor,n.head)),effects:jy(e.effects),annotations:r,scrollIntoView:!!e.scrollIntoView}}function qZ(t,e,i){let n=p3(t,e.length?e[0]:{},t.doc.length);e.length&&e[0].filter===!1&&(i=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(i=!1);let o=!!e[s].sequential;n=WZ(n,p3(t,e[s],o?n.changes.newLength:t.doc.length),o)}let r=Va.create(t,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return eue(i?Jce(r):r)}function Jce(t){let e=t.startState,i=!0;for(let r of e.facet(GZ)){let s=r(t);if(s===!1){i=!1;break}Array.isArray(s)&&(i=i===!0?s:Yce(i,s))}if(i!==!0){let r,s;if(i===!1)s=t.changes.invertedDesc,r=ao.empty(e.doc.length);else{let o=t.changes.filter(i);r=o.changes,s=o.filtered.mapDesc(o.changes).invertedDesc}t=Va.create(e,r,t.selection&&t.selection.map(s),_n.mapEffects(t.effects,s),t.annotations,t.scrollIntoView)}let n=e.facet(UZ);for(let r=n.length-1;r>=0;r--){let s=n[r](t);s instanceof Va?t=s:Array.isArray(s)&&s.length==1&&s[0]instanceof Va?t=s[0]:t=qZ(e,jy(s),!1)}return t}function eue(t){let e=t.startState,i=e.facet(HZ),n=t;for(let r=i.length-1;r>=0;r--){let s=i[r](t);s&&Object.keys(s).length&&(n=WZ(n,p3(e,s,t.changes.newLength),!0))}return n==t?t:Va.create(e,t.changes,t.selection,n.effects,n.annotations,n.scrollIntoView)}const tue=[];function jy(t){return t==null?tue:Array.isArray(t)?t:[t]}var cs=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(cs||(cs={}));const iue=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let m3;try{m3=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function nue(t){if(m3)return m3.test(t);for(let e=0;e<t.length;e++){let i=t[e];if(/\w/.test(i)||i>"Â"&&(i.toUpperCase()!=i.toLowerCase()||iue.test(i)))return!0}return!1}function rue(t){return e=>{if(!/\S/.test(e))return cs.Space;if(nue(e))return cs.Word;for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return cs.Word;return cs.Other}}let xs=class mu{constructor(e,i,n,r,s,o){this.config=e,this.doc=i,this.selection=n,this.values=r,this.status=e.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let a=0;a<this.config.dynamicSlots.length;a++)Nw(this,a<<1);this.computeSlot=null}field(e,i=!0){let n=this.config.address[e.id];if(n==null){if(i)throw new RangeError("Field is not present in this state");return}return Nw(this,n),QM(this,n)}update(...e){return qZ(this,e,!0)}applyTransaction(e){let i=this.config,{base:n,compartments:r}=i;for(let a of e.effects)a.is(nP.reconfigure)?(i&&(r=new Map,i.compartments.forEach((l,u)=>r.set(u,l)),i=null),r.set(a.value.compartment,a.value.extension)):a.is(_n.reconfigure)?(i=null,n=a.value):a.is(_n.appendConfig)&&(i=null,n=jy(n).concat(a.value));let s;i?s=e.startState.values.slice():(i=z4.resolve(n,r,this),s=new mu(i,this.doc,this.selection,i.dynamicSlots.map(()=>null),(l,u)=>u.reconfigure(l,this),null).values);let o=e.startState.facet(f3)?e.newSelection:e.newSelection.asSingle();new mu(i,e.newDoc,o,s,(a,l)=>l.update(a,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:e},range:Kt.cursor(i.from+e.length)}))}changeByRange(e){let i=this.selection,n=e(i.ranges[0]),r=this.changes(n.changes),s=[n.range],o=jy(n.effects);for(let a=1;a<i.ranges.length;a++){let l=e(i.ranges[a]),u=this.changes(l.changes),d=u.map(r);for(let v=0;v<a;v++)s[v]=s[v].map(d);let p=r.mapDesc(u,!0);s.push(l.range.map(p)),r=r.compose(d),o=_n.mapEffects(o,d).concat(_n.mapEffects(jy(l.effects),p))}return{changes:r,selection:Kt.create(s,i.mainIndex),effects:o}}changes(e=[]){return e instanceof ao?e:ao.of(e,this.doc.length,this.facet(mu.lineSeparator))}toText(e){return fr.of(e.split(this.facet(mu.lineSeparator)||a3))}sliceDoc(e=0,i=this.doc.length){return this.doc.sliceString(e,i,this.lineBreak)}facet(e){let i=this.config.address[e.id];return i==null?e.default:(Nw(this,i),QM(this,i))}toJSON(e){let i={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let n in e){let r=e[n];r instanceof Do&&this.config.address[r.id]!=null&&(i[n]=r.spec.toJSON(this.field(e[n]),this))}return i}static fromJSON(e,i={},n){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let r=[];if(n){for(let s in n)if(Object.prototype.hasOwnProperty.call(e,s)){let o=n[s],a=e[s];r.push(o.init(l=>o.spec.fromJSON(a,l)))}}return mu.create({doc:e.doc,selection:Kt.fromJSON(e.selection),extensions:i.extensions?r.concat([i.extensions]):r})}static create(e={}){let i=z4.resolve(e.extensions||[],new Map),n=e.doc instanceof fr?e.doc:fr.of((e.doc||"").split(i.staticFacet(mu.lineSeparator)||a3)),r=e.selection?e.selection instanceof Kt?e.selection:Kt.single(e.selection.anchor,e.selection.head):Kt.single(0);return FZ(r,n.length),i.staticFacet(f3)||(r=r.asSingle()),new mu(i,n,r,i.dynamicSlots.map(()=>null),(s,o)=>o.create(s),null)}get tabSize(){return this.facet(mu.tabSize)}get lineBreak(){return this.facet(mu.lineSeparator)||`
`}get readOnly(){return this.facet($Z)}phrase(e,...i){for(let n of this.facet(mu.phrases))if(Object.prototype.hasOwnProperty.call(n,e)){e=n[e];break}return i.length&&(e=e.replace(/\$(\$|\d*)/g,(n,r)=>{if(r=="$")return"$";let s=+(r||1);return!s||s>i.length?n:i[s-1]})),e}languageDataAt(e,i,n=-1){let r=[];for(let s of this.facet(zZ))for(let o of s(this,i,n))Object.prototype.hasOwnProperty.call(o,e)&&r.push(o[e]);return r}charCategorizer(e){return rue(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:i,from:n,length:r}=this.doc.lineAt(e),s=this.charCategorizer(e),o=e-n,a=e-n;for(;o>0;){let l=Qo(i,o,!1);if(s(i.slice(l,o))!=cs.Word)break;o=l}for(;a<r;){let l=Qo(i,a);if(s(i.slice(a,l))!=cs.Word)break;a=l}return o==a?null:Kt.range(o+n,a+n)}};xs.allowMultipleSelections=f3;xs.tabSize=Fi.define({combine:t=>t.length?t[0]:4});xs.lineSeparator=VZ;xs.readOnly=$Z;xs.phrases=Fi.define({compare(t,e){let i=Object.keys(t),n=Object.keys(e);return i.length==n.length&&i.every(r=>t[r]==e[r])}});xs.languageData=zZ;xs.changeFilter=GZ;xs.transactionFilter=UZ;xs.transactionExtender=HZ;nP.reconfigure=_n.define();function Fh(t,e,i={}){let n={};for(let r of t)for(let s of Object.keys(r)){let o=r[s],a=n[s];if(a===void 0)n[s]=o;else if(!(a===o||o===void 0))if(Object.hasOwnProperty.call(i,s))n[s]=i[s](a,o);else throw new Error("Config merge conflict for field "+s)}for(let r in e)n[r]===void 0&&(n[r]=e[r]);return n}class Tg{eq(e){return this==e}range(e,i=e){return g3.create(e,i,this)}}Tg.prototype.startSide=Tg.prototype.endSide=0;Tg.prototype.point=!1;Tg.prototype.mapMode=jo.TrackDel;let g3=class jZ{constructor(e,i,n){this.from=e,this.to=i,this.value=n}static create(e,i,n){return new jZ(e,i,n)}};function v3(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}class oG{constructor(e,i,n,r){this.from=e,this.to=i,this.value=n,this.maxPoint=r}get length(){return this.to[this.to.length-1]}findIndex(e,i,n,r=0){let s=n?this.to:this.from;for(let o=r,a=s.length;;){if(o==a)return o;let l=o+a>>1,u=s[l]-e||(n?this.value[l].endSide:this.value[l].startSide)-i;if(l==o)return u>=0?o:a;u>=0?a=l:o=l+1}}between(e,i,n,r){for(let s=this.findIndex(i,-1e9,!0),o=this.findIndex(n,1e9,!1,s);s<o;s++)if(r(this.from[s]+e,this.to[s]+e,this.value[s])===!1)return!1}map(e,i){let n=[],r=[],s=[],o=-1,a=-1;for(let l=0;l<this.value.length;l++){let u=this.value[l],d=this.from[l]+e,p=this.to[l]+e,v,y;if(d==p){let w=i.mapPos(d,u.startSide,u.mapMode);if(w==null||(v=y=w,u.startSide!=u.endSide&&(y=i.mapPos(d,u.endSide),y<v)))continue}else if(v=i.mapPos(d,u.startSide),y=i.mapPos(p,u.endSide),v>y||v==y&&u.startSide>0&&u.endSide<=0)continue;(y-v||u.endSide-u.startSide)<0||(o<0&&(o=v),u.point&&(a=Math.max(a,y-v)),n.push(u),r.push(v-o),s.push(y-o))}return{mapped:n.length?new oG(r,s,n,a):null,pos:o}}}class ur{constructor(e,i,n,r){this.chunkPos=e,this.chunk=i,this.nextLayer=n,this.maxPoint=r}static create(e,i,n,r){return new ur(e,i,n,r)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let i of this.chunk)e+=i.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:i=[],sort:n=!1,filterFrom:r=0,filterTo:s=this.length}=e,o=e.filter;if(i.length==0&&!o)return this;if(n&&(i=i.slice().sort(v3)),this.isEmpty)return i.length?ur.of(i):this;let a=new QZ(this,null,-1).goto(0),l=0,u=[],d=new Vd;for(;a.value||l<i.length;)if(l<i.length&&(a.from-i[l].from||a.startSide-i[l].value.startSide)>=0){let p=i[l++];d.addInner(p.from,p.to,p.value)||u.push(p)}else a.rangeIndex==1&&a.chunkIndex<this.chunk.length&&(l==i.length||this.chunkEnd(a.chunkIndex)<i[l].from)&&(!o||r>this.chunkEnd(a.chunkIndex)||s<this.chunkPos[a.chunkIndex])&&d.addChunk(this.chunkPos[a.chunkIndex],this.chunk[a.chunkIndex])?a.nextChunk():((!o||r>a.to||s<a.from||o(a.from,a.to,a.value))&&(d.addInner(a.from,a.to,a.value)||u.push(g3.create(a.from,a.to,a.value))),a.next());return d.finishInner(this.nextLayer.isEmpty&&!u.length?ur.empty:this.nextLayer.update({add:u,filter:o,filterFrom:r,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let i=[],n=[],r=-1;for(let o=0;o<this.chunk.length;o++){let a=this.chunkPos[o],l=this.chunk[o],u=e.touchesRange(a,a+l.length);if(u===!1)r=Math.max(r,l.maxPoint),i.push(l),n.push(e.mapPos(a));else if(u===!0){let{mapped:d,pos:p}=l.map(a,e);d&&(r=Math.max(r,d.maxPoint),i.push(d),n.push(p))}}let s=this.nextLayer.map(e);return i.length==0?s:new ur(n,i,s||ur.empty,r)}between(e,i,n){if(!this.isEmpty){for(let r=0;r<this.chunk.length;r++){let s=this.chunkPos[r],o=this.chunk[r];if(i>=s&&e<=s+o.length&&o.between(s,e-s,i-s,n)===!1)return}this.nextLayer.between(e,i,n)}}iter(e=0){return C_.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,i=0){return C_.from(e).goto(i)}static compare(e,i,n,r,s=-1){let o=e.filter(p=>p.maxPoint>0||!p.isEmpty&&p.maxPoint>=s),a=i.filter(p=>p.maxPoint>0||!p.isEmpty&&p.maxPoint>=s),l=V4(o,a,n),u=new Lb(o,l,s),d=new Lb(a,l,s);n.iterGaps((p,v,y)=>G4(u,p,d,v,y,r)),n.empty&&n.length==0&&G4(u,0,d,0,0,r)}static eq(e,i,n=0,r){r==null&&(r=999999999);let s=e.filter(d=>!d.isEmpty&&i.indexOf(d)<0),o=i.filter(d=>!d.isEmpty&&e.indexOf(d)<0);if(s.length!=o.length)return!1;if(!s.length)return!0;let a=V4(s,o),l=new Lb(s,a,0).goto(n),u=new Lb(o,a,0).goto(n);for(;;){if(l.to!=u.to||!y3(l.active,u.active)||l.point&&(!u.point||!l.point.eq(u.point)))return!1;if(l.to>r)return!0;l.next(),u.next()}}static spans(e,i,n,r,s=-1){let o=new Lb(e,null,s).goto(i),a=i,l=o.openStart;for(;;){let u=Math.min(o.to,n);if(o.point){let d=o.activeForPoint(o.to),p=o.pointFrom<i?d.length+1:o.point.startSide<0?d.length:Math.min(d.length,l);r.point(a,u,o.point,d,p,o.pointRank),l=Math.min(o.openEnd(u),d.length)}else u>a&&(r.span(a,u,o.active,l),l=o.openEnd(u));if(o.to>n)return l+(o.point&&o.to>n?1:0);a=o.to,o.next()}}static of(e,i=!1){let n=new Vd;for(let r of e instanceof g3?[e]:i?sue(e):e)n.add(r.from,r.to,r.value);return n.finish()}static join(e){if(!e.length)return ur.empty;let i=e[e.length-1];for(let n=e.length-2;n>=0;n--)for(let r=e[n];r!=ur.empty;r=r.nextLayer)i=new ur(r.chunkPos,r.chunk,i,Math.max(r.maxPoint,i.maxPoint));return i}}ur.empty=new ur([],[],null,-1);function sue(t){if(t.length>1)for(let e=t[0],i=1;i<t.length;i++){let n=t[i];if(v3(e,n)>0)return t.slice().sort(v3);e=n}return t}ur.empty.nextLayer=ur.empty;class Vd{finishChunk(e){this.chunks.push(new oG(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,i,n){this.addInner(e,i,n)||(this.nextLayer||(this.nextLayer=new Vd)).add(e,i,n)}addInner(e,i,n){let r=e-this.lastTo||n.startSide-this.last.endSide;if(r<=0&&(e-this.lastFrom||n.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return r<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(i-this.chunkStart),this.last=n,this.lastFrom=e,this.lastTo=i,this.value.push(n),n.point&&(this.maxPoint=Math.max(this.maxPoint,i-e)),!0)}addChunk(e,i){if((e-this.lastTo||i.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,i.maxPoint),this.chunks.push(i),this.chunkPos.push(e);let n=i.value.length-1;return this.last=i.value[n],this.lastFrom=i.from[n]+e,this.lastTo=i.to[n]+e,!0}finish(){return this.finishInner(ur.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let i=ur.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,i}}function V4(t,e,i){let n=new Map;for(let s of t)for(let o=0;o<s.chunk.length;o++)s.chunk[o].maxPoint<=0&&n.set(s.chunk[o],s.chunkPos[o]);let r=new Set;for(let s of e)for(let o=0;o<s.chunk.length;o++){let a=n.get(s.chunk[o]);a!=null&&(i?i.mapPos(a):a)==s.chunkPos[o]&&!i?.touchesRange(a,a+s.chunk[o].length)&&r.add(s.chunk[o])}return r}class QZ{constructor(e,i,n,r=0){this.layer=e,this.skip=i,this.minPoint=n,this.rank=r}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,i=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,i,!1),this}gotoInner(e,i,n){for(;this.chunkIndex<this.layer.chunk.length;){let r=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(r)||this.layer.chunkEnd(this.chunkIndex)<e||r.maxPoint<this.minPoint))break;this.chunkIndex++,n=!1}if(this.chunkIndex<this.layer.chunk.length){let r=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],i,!0);(!n||this.rangeIndex<r)&&this.setRangeIndex(r)}this.next()}forward(e,i){(this.to-e||this.endSide-i)<0&&this.gotoInner(e,i,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],i=this.layer.chunk[this.chunkIndex],n=e+i.from[this.rangeIndex];if(this.from=n,this.to=e+i.to[this.rangeIndex],this.value=i.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class C_{constructor(e){this.heap=e}static from(e,i=null,n=-1){let r=[];for(let s=0;s<e.length;s++)for(let o=e[s];!o.isEmpty;o=o.nextLayer)o.maxPoint>=n&&r.push(new QZ(o,i,n,s));return r.length==1?r[0]:new C_(r)}get startSide(){return this.value?this.value.startSide:0}goto(e,i=-1e9){for(let n of this.heap)n.goto(e,i);for(let n=this.heap.length>>1;n>=0;n--)pF(this.heap,n);return this.next(),this}forward(e,i){for(let n of this.heap)n.forward(e,i);for(let n=this.heap.length>>1;n>=0;n--)pF(this.heap,n);(this.to-e||this.value.endSide-i)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),pF(this.heap,0)}}}function pF(t,e){for(let i=t[e];;){let n=(e<<1)+1;if(n>=t.length)break;let r=t[n];if(n+1<t.length&&r.compare(t[n+1])>=0&&(r=t[n+1],n++),i.compare(r)<0)break;t[n]=i,t[e]=r,e=n}}class Lb{constructor(e,i,n){this.minPoint=n,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=C_.from(e,i,n)}goto(e,i=-1e9){return this.cursor.goto(e,i),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=i,this.openStart=-1,this.next(),this}forward(e,i){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-i)<0;)this.removeActive(this.minActive);this.cursor.forward(e,i)}removeActive(e){b1(this.active,e),b1(this.activeTo,e),b1(this.activeRank,e),this.minActive=U4(this.active,this.activeTo)}addActive(e){let i=0,{value:n,to:r,rank:s}=this.cursor;for(;i<this.activeRank.length&&(s-this.activeRank[i]||r-this.activeTo[i])>0;)i++;w1(this.active,i,n),w1(this.activeTo,i,r),w1(this.activeRank,i,s),e&&w1(e,i,this.cursor.from),this.minActive=U4(this.active,this.activeTo)}next(){let e=this.to,i=this.point;this.point=null;let n=this.openStart<0?[]:null;for(;;){let r=this.minActive;if(r>-1&&(this.activeTo[r]-this.cursor.from||this.active[r].endSide-this.cursor.startSide)<0){if(this.activeTo[r]>e){this.to=this.activeTo[r],this.endSide=this.active[r].endSide;break}this.removeActive(r),n&&b1(n,r)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let s=this.cursor.value;if(!s.point)this.addActive(n),this.cursor.next();else if(i&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=s,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=s.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(n){this.openStart=0;for(let r=n.length-1;r>=0&&n[r]<e;r--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let i=[];for(let n=this.active.length-1;n>=0&&!(this.activeRank[n]<this.pointRank);n--)(this.activeTo[n]>e||this.activeTo[n]==e&&this.active[n].endSide>=this.point.endSide)&&i.push(this.active[n]);return i.reverse()}openEnd(e){let i=0;for(let n=this.activeTo.length-1;n>=0&&this.activeTo[n]>e;n--)i++;return i}}function G4(t,e,i,n,r,s){t.goto(e),i.goto(n);let o=n+r,a=n,l=n-e;for(;;){let u=t.to+l-i.to,d=u||t.endSide-i.endSide,p=d<0?t.to+l:i.to,v=Math.min(p,o);if(t.point||i.point?t.point&&i.point&&(t.point==i.point||t.point.eq(i.point))&&y3(t.activeForPoint(t.to),i.activeForPoint(i.to))||s.comparePoint(a,v,t.point,i.point):v>a&&!y3(t.active,i.active)&&s.compareRange(a,v,t.active,i.active),p>o)break;(u||t.openEnd!=i.openEnd)&&s.boundChange&&s.boundChange(p),a=p,d<=0&&t.next(),d>=0&&i.next()}}function y3(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!=e[i]&&!t[i].eq(e[i]))return!1;return!0}function b1(t,e){for(let i=e,n=t.length-1;i<n;i++)t[i]=t[i+1];t.pop()}function w1(t,e,i){for(let n=t.length-1;n>=e;n--)t[n+1]=t[n];t[e]=i}function U4(t,e){let i=-1,n=1e9;for(let r=0;r<e.length;r++)(e[r]-n||t[r].endSide-t[i].endSide)<0&&(i=r,n=e[r]);return i}function X0(t,e,i=t.length){let n=0;for(let r=0;r<i&&r<t.length;)t.charCodeAt(r)==9?(n+=e-n%e,r++):(n++,r=Qo(t,r));return n}function x3(t,e,i,n){for(let r=0,s=0;;){if(s>=e)return r;if(r==t.length)break;s+=t.charCodeAt(r)==9?i-s%i:1,r=Qo(t,r)}return n===!0?-1:t.length}const b3="Í¼",H4=typeof Symbol>"u"?"__"+b3:Symbol.for(b3),w3=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),$4=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class _p{constructor(e,i){this.rules=[];let{finish:n}=i||{};function r(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function s(o,a,l,u){let d=[],p=/^@(\w+)\b/.exec(o[0]),v=p&&p[1]=="keyframes";if(p&&a==null)return l.push(o[0]+";");for(let y in a){let w=a[y];if(/&/.test(y))s(y.split(/,\s*/).map(R=>o.map(O=>R.replace(/&/,O))).reduce((R,O)=>R.concat(O)),w,l);else if(w&&typeof w=="object"){if(!p)throw new RangeError("The value of a property ("+y+") should be a primitive value.");s(r(y),w,d,v)}else w!=null&&d.push(y.replace(/_.*/,"").replace(/[A-Z]/g,R=>"-"+R.toLowerCase())+": "+w+";")}(d.length||v)&&l.push((n&&!p&&!u?o.map(n):o).join(", ")+" {"+d.join(" ")+"}")}for(let o in e)s(r(o),e[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=$4[H4]||1;return $4[H4]=e+1,b3+e.toString(36)}static mount(e,i,n){let r=e[w3],s=n&&n.nonce;r?s&&r.setNonce(s):r=new oue(e,s),r.mount(Array.isArray(i)?i:[i],e)}}let W4=new Map;class oue{constructor(e,i){let n=e.ownerDocument||e,r=n.defaultView;if(!e.head&&e.adoptedStyleSheets&&r.CSSStyleSheet){let s=W4.get(n);if(s)return e[w3]=s;this.sheet=new r.CSSStyleSheet,W4.set(n,this)}else this.styleTag=n.createElement("style"),i&&this.styleTag.setAttribute("nonce",i);this.modules=[],e[w3]=this}mount(e,i){let n=this.sheet,r=0,s=0;for(let o=0;o<e.length;o++){let a=e[o],l=this.modules.indexOf(a);if(l<s&&l>-1&&(this.modules.splice(l,1),s--,l=-1),l==-1){if(this.modules.splice(s++,0,a),n)for(let u=0;u<a.rules.length;u++)n.insertRule(a.rules[u],r++)}else{for(;s<l;)r+=this.modules[s++].rules.length;r+=a.rules.length,s++}}if(n)i.adoptedStyleSheets.indexOf(this.sheet)<0&&(i.adoptedStyleSheets=[this.sheet,...i.adoptedStyleSheets]);else{let o="";for(let l=0;l<this.modules.length;l++)o+=this.modules[l].getRules()+`
`;this.styleTag.textContent=o;let a=i.head||i;this.styleTag.parentNode!=a&&a.insertBefore(this.styleTag,a.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var Gd={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},S_={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},aue=typeof navigator<"u"&&/Mac/.test(navigator.platform),lue=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var $o=0;$o<10;$o++)Gd[48+$o]=Gd[96+$o]=String($o);for(var $o=1;$o<=24;$o++)Gd[$o+111]="F"+$o;for(var $o=65;$o<=90;$o++)Gd[$o]=String.fromCharCode($o+32),S_[$o]=String.fromCharCode($o);for(var mF in Gd)S_.hasOwnProperty(mF)||(S_[mF]=Gd[mF]);function ZZ(t){var e=aue&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||lue&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",i=!e&&t.key||(t.shiftKey?S_:Gd)[t.keyCode]||t.key||"Unidentified";return i=="Esc"&&(i="Escape"),i=="Del"&&(i="Delete"),i=="Left"&&(i="ArrowLeft"),i=="Up"&&(i="ArrowUp"),i=="Right"&&(i="ArrowRight"),i=="Down"&&(i="ArrowDown"),i}function O_(t){let e;return t.nodeType==11?e=t.getSelection?t:t.ownerDocument:e=t,e.getSelection()}function _3(t,e){return e?t==e||t.contains(e.nodeType!=1?e.parentNode:e):!1}function mM(t,e){if(!e.anchorNode)return!1;try{return _3(t,e.anchorNode)}catch{return!1}}function d0(t){return t.nodeType==3?Pg(t,0,t.nodeValue.length).getClientRects():t.nodeType==1?t.getClientRects():[]}function Bw(t,e,i,n){return i?q4(t,e,i,n,-1)||q4(t,e,i,n,1):!1}function Rg(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e}function ZM(t){return t.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}function q4(t,e,i,n,r){for(;;){if(t==i&&e==n)return!0;if(e==(r<0?0:Sh(t))){if(t.nodeName=="DIV")return!1;let s=t.parentNode;if(!s||s.nodeType!=1)return!1;e=Rg(t)+(r<0?0:1),t=s}else if(t.nodeType==1){if(t=t.childNodes[e+(r<0?-1:0)],t.nodeType==1&&t.contentEditable=="false")return!1;e=r<0?Sh(t):0}else return!1}}function Sh(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function CC(t,e){let i=e?t.left:t.right;return{left:i,right:i,top:t.top,bottom:t.bottom}}function cue(t){let e=t.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}function XZ(t,e){let i=e.width/t.offsetWidth,n=e.height/t.offsetHeight;return(i>.995&&i<1.005||!isFinite(i)||Math.abs(e.width-t.offsetWidth)<1)&&(i=1),(n>.995&&n<1.005||!isFinite(n)||Math.abs(e.height-t.offsetHeight)<1)&&(n=1),{scaleX:i,scaleY:n}}function uue(t,e,i,n,r,s,o,a){let l=t.ownerDocument,u=l.defaultView||window;for(let d=t,p=!1;d&&!p;)if(d.nodeType==1){let v,y=d==l.body,w=1,R=1;if(y)v=cue(u);else{if(/^(fixed|sticky)$/.test(getComputedStyle(d).position)&&(p=!0),d.scrollHeight<=d.clientHeight&&d.scrollWidth<=d.clientWidth){d=d.assignedSlot||d.parentNode;continue}let N=d.getBoundingClientRect();({scaleX:w,scaleY:R}=XZ(d,N)),v={left:N.left,right:N.left+d.clientWidth*w,top:N.top,bottom:N.top+d.clientHeight*R}}let O=0,P=0;if(r=="nearest")e.top<v.top?(P=e.top-(v.top+o),i>0&&e.bottom>v.bottom+P&&(P=e.bottom-v.bottom+o)):e.bottom>v.bottom&&(P=e.bottom-v.bottom+o,i<0&&e.top-P<v.top&&(P=e.top-(v.top+o)));else{let N=e.bottom-e.top,F=v.bottom-v.top;P=(r=="center"&&N<=F?e.top+N/2-F/2:r=="start"||r=="center"&&i<0?e.top-o:e.bottom-F+o)-v.top}if(n=="nearest"?e.left<v.left?(O=e.left-(v.left+s),i>0&&e.right>v.right+O&&(O=e.right-v.right+s)):e.right>v.right&&(O=e.right-v.right+s,i<0&&e.left<v.left+O&&(O=e.left-(v.left+s))):O=(n=="center"?e.left+(e.right-e.left)/2-(v.right-v.left)/2:n=="start"==a?e.left-s:e.right-(v.right-v.left)+s)-v.left,O||P)if(y)u.scrollBy(O,P);else{let N=0,F=0;if(P){let k=d.scrollTop;d.scrollTop+=P/R,F=(d.scrollTop-k)*R}if(O){let k=d.scrollLeft;d.scrollLeft+=O/w,N=(d.scrollLeft-k)*w}e={left:e.left-N,top:e.top-F,right:e.right-N,bottom:e.bottom-F},N&&Math.abs(N-O)<1&&(n="nearest"),F&&Math.abs(F-P)<1&&(r="nearest")}if(y)break;(e.top<v.top||e.bottom>v.bottom||e.left<v.left||e.right>v.right)&&(e={left:Math.max(e.left,v.left),right:Math.min(e.right,v.right),top:Math.max(e.top,v.top),bottom:Math.min(e.bottom,v.bottom)}),d=d.assignedSlot||d.parentNode}else if(d.nodeType==11)d=d.host;else break}function hue(t){let e=t.ownerDocument,i,n;for(let r=t.parentNode;r&&!(r==e.body||i&&n);)if(r.nodeType==1)!n&&r.scrollHeight>r.clientHeight&&(n=r),!i&&r.scrollWidth>r.clientWidth&&(i=r),r=r.assignedSlot||r.parentNode;else if(r.nodeType==11)r=r.host;else break;return{x:i,y:n}}class due{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:i,focusNode:n}=e;this.set(i,Math.min(e.anchorOffset,i?Sh(i):0),n,Math.min(e.focusOffset,n?Sh(n):0))}set(e,i,n,r){this.anchorNode=e,this.anchorOffset=i,this.focusNode=n,this.focusOffset=r}}let iy=null;function KZ(t){if(t.setActive)return t.setActive();if(iy)return t.focus(iy);let e=[];for(let i=t;i&&(e.push(i,i.scrollTop,i.scrollLeft),i!=i.ownerDocument);i=i.parentNode);if(t.focus(iy==null?{get preventScroll(){return iy={preventScroll:!0},!0}}:void 0),!iy){iy=!1;for(let i=0;i<e.length;){let n=e[i++],r=e[i++],s=e[i++];n.scrollTop!=r&&(n.scrollTop=r),n.scrollLeft!=s&&(n.scrollLeft=s)}}}let j4;function Pg(t,e,i=e){let n=j4||(j4=document.createRange());return n.setEnd(t,i),n.setStart(t,e),n}function Qy(t,e,i,n){let r={key:e,code:e,keyCode:i,which:i,cancelable:!0};n&&({altKey:r.altKey,ctrlKey:r.ctrlKey,shiftKey:r.shiftKey,metaKey:r.metaKey}=n);let s=new KeyboardEvent("keydown",r);s.synthetic=!0,t.dispatchEvent(s);let o=new KeyboardEvent("keyup",r);return o.synthetic=!0,t.dispatchEvent(o),s.defaultPrevented||o.defaultPrevented}function fue(t){for(;t;){if(t&&(t.nodeType==9||t.nodeType==11&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}function YZ(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}function pue(t,e){let i=e.focusNode,n=e.focusOffset;if(!i||e.anchorNode!=i||e.anchorOffset!=n)return!1;for(n=Math.min(n,Sh(i));;)if(n){if(i.nodeType!=1)return!1;let r=i.childNodes[n-1];r.contentEditable=="false"?n--:(i=r,n=Sh(i))}else{if(i==t)return!0;n=Rg(i),i=i.parentNode}}function JZ(t){return t.scrollTop>Math.max(1,t.scrollHeight-t.clientHeight-4)}function e7(t,e){for(let i=t,n=e;;){if(i.nodeType==3&&n>0)return{node:i,offset:n};if(i.nodeType==1&&n>0){if(i.contentEditable=="false")return null;i=i.childNodes[n-1],n=Sh(i)}else if(i.parentNode&&!ZM(i))n=Rg(i),i=i.parentNode;else return null}}function t7(t,e){for(let i=t,n=e;;){if(i.nodeType==3&&n<i.nodeValue.length)return{node:i,offset:n};if(i.nodeType==1&&n<i.childNodes.length){if(i.contentEditable=="false")return null;i=i.childNodes[n],n=0}else if(i.parentNode&&!ZM(i))n=Rg(i)+1,i=i.parentNode;else return null}}class ua{constructor(e,i,n=!0){this.node=e,this.offset=i,this.precise=n}static before(e,i){return new ua(e.parentNode,Rg(e),i)}static after(e,i){return new ua(e.parentNode,Rg(e)+1,i)}}const aG=[];class Br{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let i=this.posAtStart;for(let n of this.children){if(n==e)return i;i+=n.length+n.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,i){if(this.flags&2){let n=this.dom,r=null,s;for(let o of this.children){if(o.flags&7){if(!o.dom&&(s=r?r.nextSibling:n.firstChild)){let a=Br.get(s);(!a||!a.parent&&a.canReuseDOM(o))&&o.reuseDOM(s)}o.sync(e,i),o.flags&=-8}if(s=r?r.nextSibling:n.firstChild,i&&!i.written&&i.node==n&&s!=o.dom&&(i.written=!0),o.dom.parentNode==n)for(;s&&s!=o.dom;)s=Q4(s);else n.insertBefore(o.dom,s);r=o.dom}for(s=r?r.nextSibling:n.firstChild,s&&i&&i.node==n&&(i.written=!0);s;)s=Q4(s)}else if(this.flags&1)for(let n of this.children)n.flags&7&&(n.sync(e,i),n.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,i){let n;if(e==this.dom)n=this.dom.childNodes[i];else{let r=Sh(e)==0?0:i==0?-1:1;for(;;){let s=e.parentNode;if(s==this.dom)break;r==0&&s.firstChild!=s.lastChild&&(e==s.firstChild?r=-1:r=1),e=s}r<0?n=e:n=e.nextSibling}if(n==this.dom.firstChild)return 0;for(;n&&!Br.get(n);)n=n.nextSibling;if(!n)return this.length;for(let r=0,s=0;;r++){let o=this.children[r];if(o.dom==n)return s;s+=o.length+o.breakAfter}}domBoundsAround(e,i,n=0){let r=-1,s=-1,o=-1,a=-1;for(let l=0,u=n,d=n;l<this.children.length;l++){let p=this.children[l],v=u+p.length;if(u<e&&v>i)return p.domBoundsAround(e,i,u);if(v>=e&&r==-1&&(r=l,s=u),u>i&&p.dom.parentNode==this.dom){o=l,a=d;break}d=v,u=v+p.breakAfter}return{from:s,to:a<0?n+this.length:a,startDOM:(r?this.children[r-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let i=this.parent;i;i=i.parent){if(e&&(i.flags|=2),i.flags&1)return;i.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let i=e.parent;if(!i)return e;e=i}}replaceChildren(e,i,n=aG){this.markDirty();for(let r=e;r<i;r++){let s=this.children[r];s.parent==this&&n.indexOf(s)<0&&s.destroy()}n.length<250?this.children.splice(e,i-e,...n):this.children=[].concat(this.children.slice(0,e),n,this.children.slice(i));for(let r=0;r<n.length;r++)n[r].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new i7(this.children,e,this.children.length)}childPos(e,i=1){return this.childCursor().findPos(e,i)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,i,n,r,s,o){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}Br.prototype.breakAfter=0;function Q4(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class i7{constructor(e,i,n){this.children=e,this.pos=i,this.i=n,this.off=0}findPos(e,i=1){for(;;){if(e>this.pos||e==this.pos&&(i>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let n=this.children[--this.i];this.pos-=n.length+n.breakAfter}}}function n7(t,e,i,n,r,s,o,a,l){let{children:u}=t,d=u.length?u[e]:null,p=s.length?s[s.length-1]:null,v=p?p.breakAfter:o;if(!(e==n&&d&&!o&&!v&&s.length<2&&d.merge(i,r,s.length?p:null,i==0,a,l))){if(n<u.length){let y=u[n];y&&(r<y.length||y.breakAfter&&p?.breakAfter)?(e==n&&(y=y.split(r),r=0),!v&&p&&y.merge(0,r,p,!0,0,l)?s[s.length-1]=y:((r||y.children.length&&!y.children[0].length)&&y.merge(0,r,null,!1,0,l),s.push(y))):y?.breakAfter&&(p?p.breakAfter=1:o=1),n++}for(d&&(d.breakAfter=o,i>0&&(!o&&s.length&&d.merge(i,d.length,s[0],!1,a,0)?d.breakAfter=s.shift().breakAfter:(i<d.length||d.children.length&&d.children[d.children.length-1].length==0)&&d.merge(i,d.length,null,!1,a,0),e++));e<n&&s.length;)if(u[n-1].become(s[s.length-1]))n--,s.pop(),l=s.length?0:a;else if(u[e].become(s[0]))e++,s.shift(),a=s.length?0:l;else break;!s.length&&e&&n<u.length&&!u[e-1].breakAfter&&u[n].merge(0,0,u[e-1],!1,a,l)&&e--,(e<n||s.length)&&t.replaceChildren(e,n,s)}}function r7(t,e,i,n,r,s){let o=t.childCursor(),{i:a,off:l}=o.findPos(i,1),{i:u,off:d}=o.findPos(e,-1),p=e-i;for(let v of n)p+=v.length;t.length+=p,n7(t,u,d,a,l,n,0,r,s)}let ll=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},C3=typeof document<"u"?document:{documentElement:{style:{}}};const S3=/Edge\/(\d+)/.exec(ll.userAgent),s7=/MSIE \d/.test(ll.userAgent),O3=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ll.userAgent),rP=!!(s7||O3||S3),Z4=!rP&&/gecko\/(\d+)/i.test(ll.userAgent),gF=!rP&&/Chrome\/(\d+)/.exec(ll.userAgent),mue="webkitFontSmoothing"in C3.documentElement.style,o7=!rP&&/Apple Computer/.test(ll.vendor),X4=o7&&(/Mobile\/\w+/.test(ll.userAgent)||ll.maxTouchPoints>2);var Vi={mac:X4||/Mac/.test(ll.platform),windows:/Win/.test(ll.platform),linux:/Linux|X11/.test(ll.platform),ie:rP,ie_version:s7?C3.documentMode||6:O3?+O3[1]:S3?+S3[1]:0,gecko:Z4,gecko_version:Z4?+(/Firefox\/(\d+)/.exec(ll.userAgent)||[0,0])[1]:0,chrome:!!gF,chrome_version:gF?+gF[1]:0,ios:X4,android:/Android\b/.test(ll.userAgent),safari:o7,webkit_version:mue?+(/\bAppleWebKit\/(\d+)/.exec(ll.userAgent)||[0,0])[1]:0,tabSize:C3.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const gue=256;class Cu extends Br{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,i){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(i&&i.node==this.dom&&(i.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,i,n){return this.flags&8||n&&(!(n instanceof Cu)||this.length-(i-e)+n.length>gue||n.flags&8)?!1:(this.text=this.text.slice(0,e)+(n?n.text:"")+this.text.slice(i),this.markDirty(),!0)}split(e){let i=new Cu(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),i.flags|=this.flags&8,i}localPosFromDOM(e,i){return e==this.dom?i:i?this.text.length:0}domAtPos(e){return new ua(this.dom,e)}domBoundsAround(e,i,n){return{from:n,to:n+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,i){return vue(this.dom,e,i)}}class Ud extends Br{constructor(e,i=[],n=0){super(),this.mark=e,this.children=i,this.length=n;for(let r of i)r.setParent(this)}setAttrs(e){if(YZ(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let i in this.mark.attrs)e.setAttribute(i,this.mark.attrs[i]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,i){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,i)}merge(e,i,n,r,s,o){return n&&(!(n instanceof Ud&&n.mark.eq(this.mark))||e&&s<=0||i<this.length&&o<=0)?!1:(r7(this,e,i,n?n.children.slice():[],s-1,o-1),this.markDirty(),!0)}split(e){let i=[],n=0,r=-1,s=0;for(let a of this.children){let l=n+a.length;l>e&&i.push(n<e?a.split(e-n):a),r<0&&n>=e&&(r=s),n=l,s++}let o=this.length-e;return this.length=e,r>-1&&(this.children.length=r,this.markDirty()),new Ud(this.mark,i,o)}domAtPos(e){return a7(this,e)}coordsAt(e,i){return c7(this,e,i)}}function vue(t,e,i){let n=t.nodeValue.length;e>n&&(e=n);let r=e,s=e,o=0;e==0&&i<0||e==n&&i>=0?Vi.chrome||Vi.gecko||(e?(r--,o=1):s<n&&(s++,o=-1)):i<0?r--:s<n&&s++;let a=Pg(t,r,s).getClientRects();if(!a.length)return null;let l=a[(o?o<0:i>=0)?0:a.length-1];return Vi.safari&&!o&&l.width==0&&(l=Array.prototype.find.call(a,u=>u.width)||l),o?CC(l,o<0):l||null}class op extends Br{static create(e,i,n){return new op(e,i,n)}constructor(e,i,n){super(),this.widget=e,this.length=i,this.side=n,this.prevWidget=null}split(e){let i=op.create(this.widget,this.length-e,this.side);return this.length-=e,i}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,i,n,r,s,o){return n&&(!(n instanceof op)||!this.widget.compare(n.widget)||e>0&&s<=0||i<this.length&&o<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-i),!0)}become(e){return e instanceof op&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return fr.empty;let e=this;for(;e.parent;)e=e.parent;let{view:i}=e,n=i&&i.state.doc,r=this.posAtStart;return n?n.slice(r,r+this.length):fr.empty}domAtPos(e){return(this.length?e==0:this.side>0)?ua.before(this.dom):ua.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,i){let n=this.widget.coordsAt(this.dom,e,i);if(n)return n;let r=this.dom.getClientRects(),s=null;if(!r.length)return null;let o=this.side?this.side<0:e>0;for(let a=o?r.length-1:0;s=r[a],!(e>0?a==0:a==r.length-1||s.top<s.bottom);a+=o?-1:1);return CC(s,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class f0 extends Br{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof f0&&e.side==this.side}split(){return new f0(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?ua.before(this.dom):ua.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return fr.empty}get isHidden(){return!0}}Cu.prototype.children=op.prototype.children=f0.prototype.children=aG;function a7(t,e){let i=t.dom,{children:n}=t,r=0;for(let s=0;r<n.length;r++){let o=n[r],a=s+o.length;if(!(a==s&&o.getSide()<=0)){if(e>s&&e<a&&o.dom.parentNode==i)return o.domAtPos(e-s);if(e<=s)break;s=a}}for(let s=r;s>0;s--){let o=n[s-1];if(o.dom.parentNode==i)return o.domAtPos(o.length)}for(let s=r;s<n.length;s++){let o=n[s];if(o.dom.parentNode==i)return o.domAtPos(0)}return new ua(i,0)}function l7(t,e,i){let n,{children:r}=t;i>0&&e instanceof Ud&&r.length&&(n=r[r.length-1])instanceof Ud&&n.mark.eq(e.mark)?l7(n,e.children[0],i-1):(r.push(e),e.setParent(t)),t.length+=e.length}function c7(t,e,i){let n=null,r=-1,s=null,o=-1;function a(u,d){for(let p=0,v=0;p<u.children.length&&v<=d;p++){let y=u.children[p],w=v+y.length;w>=d&&(y.children.length?a(y,d-v):(!s||s.isHidden&&(i>0||xue(s,y)))&&(w>d||v==w&&y.getSide()>0)?(s=y,o=d-v):(v<d||v==w&&y.getSide()<0&&!y.isHidden)&&(n=y,r=d-v)),v=w}}a(t,e);let l=(i<0?n:s)||n||s;return l?l.coordsAt(Math.max(0,l==n?r:o),i):yue(t)}function yue(t){let e=t.dom.lastChild;if(!e)return t.dom.getBoundingClientRect();let i=d0(e);return i[i.length-1]||null}function xue(t,e){let i=t.coordsAt(0,1),n=e.coordsAt(0,1);return i&&n&&n.top<i.bottom}function M3(t,e){for(let i in t)i=="class"&&e.class?e.class+=" "+t.class:i=="style"&&e.style?e.style+=";"+t.style:e[i]=t[i];return e}const K4=Object.create(null);function XM(t,e,i){if(t==e)return!0;t||(t=K4),e||(e=K4);let n=Object.keys(t),r=Object.keys(e);if(n.length-(i&&n.indexOf(i)>-1?1:0)!=r.length-(i&&r.indexOf(i)>-1?1:0))return!1;for(let s of n)if(s!=i&&(r.indexOf(s)==-1||t[s]!==e[s]))return!1;return!0}function T3(t,e,i){let n=!1;if(e)for(let r in e)i&&r in i||(n=!0,r=="style"?t.style.cssText="":t.removeAttribute(r));if(i)for(let r in i)e&&e[r]==i[r]||(n=!0,r=="style"?t.style.cssText=i[r]:t.setAttribute(r,i[r]));return n}function bue(t){let e=Object.create(null);for(let i=0;i<t.attributes.length;i++){let n=t.attributes[i];e[n.name]=n.value}return e}let Nh=class{eq(e){return!1}updateDOM(e,i){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,i,n){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}};var Ga=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(Ga||(Ga={}));let an=class extends Tg{constructor(e,i,n,r){super(),this.startSide=e,this.endSide=i,this.widget=n,this.spec=r}get heightRelevant(){return!1}static mark(e){return new SC(e)}static widget(e){let i=Math.max(-1e4,Math.min(1e4,e.side||0)),n=!!e.block;return i+=n&&!e.inlineOrder?i>0?3e8:-4e8:i>0?1e8:-1e8,new Cp(e,i,i,n,e.widget||null,!1)}static replace(e){let i=!!e.block,n,r;if(e.isBlockGap)n=-5e8,r=4e8;else{let{start:s,end:o}=u7(e,i);n=(s?i?-3e8:-1:5e8)-1,r=(o?i?2e8:1:-6e8)+1}return new Cp(e,n,r,i,e.widget||null,!0)}static line(e){return new OC(e)}static set(e,i=!1){return ur.of(e,i)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}};an.none=ur.empty;class SC extends an{constructor(e){let{start:i,end:n}=u7(e);super(i?-1:5e8,n?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var i,n;return this==e||e instanceof SC&&this.tagName==e.tagName&&(this.class||((i=this.attrs)===null||i===void 0?void 0:i.class))==(e.class||((n=e.attrs)===null||n===void 0?void 0:n.class))&&XM(this.attrs,e.attrs,"class")}range(e,i=e){if(e>=i)throw new RangeError("Mark decorations may not be empty");return super.range(e,i)}}SC.prototype.point=!1;class OC extends an{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof OC&&this.spec.class==e.spec.class&&XM(this.spec.attributes,e.spec.attributes)}range(e,i=e){if(i!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,i)}}OC.prototype.mapMode=jo.TrackBefore;OC.prototype.point=!0;class Cp extends an{constructor(e,i,n,r,s,o){super(i,n,s,e),this.block=r,this.isReplace=o,this.mapMode=r?i<=0?jo.TrackBefore:jo.TrackAfter:jo.TrackDel}get type(){return this.startSide!=this.endSide?Ga.WidgetRange:this.startSide<=0?Ga.WidgetBefore:Ga.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof Cp&&wue(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,i=e){if(this.isReplace&&(e>i||e==i&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&i!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,i)}}Cp.prototype.point=!0;function u7(t,e=!1){let{inclusiveStart:i,inclusiveEnd:n}=t;return i==null&&(i=t.inclusive),n==null&&(n=t.inclusive),{start:i??e,end:n??e}}function wue(t,e){return t==e||!!(t&&e&&t.compare(e))}function gM(t,e,i,n=0){let r=i.length-1;r>=0&&i[r]+n>=t?i[r]=Math.max(i[r],e):i.push(t,e)}class Ys extends Br{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,i,n,r,s,o){if(n){if(!(n instanceof Ys))return!1;this.dom||n.transferDOM(this)}return r&&this.setDeco(n?n.attrs:null),r7(this,e,i,n?n.children.slice():[],s,o),!0}split(e){let i=new Ys;if(i.breakAfter=this.breakAfter,this.length==0)return i;let{i:n,off:r}=this.childPos(e);r&&(i.append(this.children[n].split(r),0),this.children[n].merge(r,this.children[n].length,null,!1,0,0),n++);for(let s=n;s<this.children.length;s++)i.append(this.children[s],0);for(;n>0&&this.children[n-1].length==0;)this.children[--n].destroy();return this.children.length=n,this.markDirty(),this.length=e,i}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){XM(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,i){l7(this,e,i)}addLineDeco(e){let i=e.spec.attributes,n=e.spec.class;i&&(this.attrs=M3(i,this.attrs||{})),n&&(this.attrs=M3({class:n},this.attrs||{}))}domAtPos(e){return a7(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,i){var n;this.dom?this.flags&4&&(YZ(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(T3(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,i);let r=this.dom.lastChild;for(;r&&Br.get(r)instanceof Ud;)r=r.lastChild;if(!r||!this.length||r.nodeName!="BR"&&((n=Br.get(r))===null||n===void 0?void 0:n.isEditable)==!1&&(!Vi.ios||!this.children.some(s=>s instanceof Cu))){let s=document.createElement("BR");s.cmIgnore=!0,this.dom.appendChild(s)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,i;for(let n of this.children){if(!(n instanceof Cu)||/[^ -~]/.test(n.text))return null;let r=d0(n.dom);if(r.length!=1)return null;e+=r[0].width,i=r[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:i}:null}coordsAt(e,i){let n=c7(this,e,i);if(!this.children.length&&n&&this.parent){let{heightOracle:r}=this.parent.view.viewState,s=n.bottom-n.top;if(Math.abs(s-r.lineHeight)<2&&r.textHeight<s){let o=(s-r.textHeight)/2;return{top:n.top+o,bottom:n.bottom-o,left:n.left,right:n.left}}}return n}become(e){return e instanceof Ys&&this.children.length==0&&e.children.length==0&&XM(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,i){for(let n=0,r=0;n<e.children.length;n++){let s=e.children[n],o=r+s.length;if(o>=i){if(s instanceof Ys)return s;if(o>i)break}r=o+s.breakAfter}return null}}class Rd extends Br{constructor(e,i,n){super(),this.widget=e,this.length=i,this.deco=n,this.breakAfter=0,this.prevWidget=null}merge(e,i,n,r,s,o){return n&&(!(n instanceof Rd)||!this.widget.compare(n.widget)||e>0&&s<=0||i<this.length&&o<=0)?!1:(this.length=e+(n?n.length:0)+(this.length-i),!0)}domAtPos(e){return e==0?ua.before(this.dom):ua.after(this.dom,e==this.length)}split(e){let i=this.length-e;this.length=e;let n=new Rd(this.widget,i,this.deco);return n.breakAfter=this.breakAfter,n}get children(){return aG}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):fr.empty}domBoundsAround(){return null}become(e){return e instanceof Rd&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,i){let n=this.widget.coordsAt(this.dom,e,i);return n||(this.widget instanceof R3?null:CC(this.dom.getBoundingClientRect(),this.length?e==0:i<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:i,endSide:n}=this.deco;return i==n?!1:e<0?i<0:n>0}}class R3 extends Nh{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class zw{constructor(e,i,n,r){this.doc=e,this.pos=i,this.end=n,this.disallowBlockEffectsFor=r,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=i}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof Rd&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new Ys),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(_1(new f0(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof Rd)&&this.getLine()}buildText(e,i,n){for(;e>0;){if(this.textOff==this.text.length){let{value:s,lineBreak:o,done:a}=this.cursor.next(this.skip);if(this.skip=0,a)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=s,this.textOff=0}let r=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(i.slice(i.length-n)),this.getLine().append(_1(new Cu(this.text.slice(this.textOff,this.textOff+r)),i),n),this.atCursorPos=!0,this.textOff+=r,e-=r,n=0}}span(e,i,n,r){this.buildText(i-e,n,r),this.pos=i,this.openStart<0&&(this.openStart=r)}point(e,i,n,r,s,o){if(this.disallowBlockEffectsFor[o]&&n instanceof Cp){if(n.block)throw new RangeError("Block decorations may not be specified via plugins");if(i>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let a=i-e;if(n instanceof Cp)if(n.block)n.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Rd(n.widget||p0.block,a,n));else{let l=op.create(n.widget||p0.inline,a,a?0:n.startSide),u=this.atCursorPos&&!l.isEditable&&s<=r.length&&(e<i||n.startSide>0),d=!l.isEditable&&(e<i||s>r.length||n.startSide<=0),p=this.getLine();this.pendingBuffer==2&&!u&&!l.isEditable&&(this.pendingBuffer=0),this.flushBuffer(r),u&&(p.append(_1(new f0(1),r),s),s=r.length+Math.max(0,s-r.length)),p.append(_1(l,r),s),this.atCursorPos=d,this.pendingBuffer=d?e<i||s>r.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=r.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(n);a&&(this.textOff+a<=this.text.length?this.textOff+=a:(this.skip+=a-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=i),this.openStart<0&&(this.openStart=s)}static build(e,i,n,r,s){let o=new zw(e,i,n,s);return o.openEnd=ur.spans(r,i,n,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function _1(t,e){for(let i of e)t=new Ud(i,[t],t.length);return t}class p0 extends Nh{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}p0.inline=new p0("span");p0.block=new p0("div");var Yr=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(Yr||(Yr={}));const Eg=Yr.LTR,lG=Yr.RTL;function h7(t){let e=[];for(let i=0;i<t.length;i++)e.push(1<<+t[i]);return e}const _ue=h7("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Cue=h7("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),P3=Object.create(null),Wu=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),i=t.charCodeAt(1);P3[e]=i,P3[i]=-e}function d7(t){return t<=247?_ue[t]:1424<=t&&t<=1524?2:1536<=t&&t<=1785?Cue[t-1536]:1774<=t&&t<=2220?4:8192<=t&&t<=8204?256:64336<=t&&t<=65023?4:1}const Sue=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class ap{get dir(){return this.level%2?lG:Eg}constructor(e,i,n){this.from=e,this.to=i,this.level=n}side(e,i){return this.dir==i==e?this.to:this.from}forward(e,i){return e==(this.dir==i)}static find(e,i,n,r){let s=-1;for(let o=0;o<e.length;o++){let a=e[o];if(a.from<=i&&a.to>=i){if(a.level==n)return o;(s<0||(r!=0?r<0?a.from<i:a.to>i:e[s].level>a.level))&&(s=o)}}if(s<0)throw new RangeError("Index out of range");return s}}function f7(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let n=t[i],r=e[i];if(n.from!=r.from||n.to!=r.to||n.direction!=r.direction||!f7(n.inner,r.inner))return!1}return!0}const Fr=[];function Oue(t,e,i,n,r){for(let s=0;s<=n.length;s++){let o=s?n[s-1].to:e,a=s<n.length?n[s].from:i,l=s?256:r;for(let u=o,d=l,p=l;u<a;u++){let v=d7(t.charCodeAt(u));v==512?v=d:v==8&&p==4&&(v=16),Fr[u]=v==4?2:v,v&7&&(p=v),d=v}for(let u=o,d=l,p=l;u<a;u++){let v=Fr[u];if(v==128)u<a-1&&d==Fr[u+1]&&d&24?v=Fr[u]=d:Fr[u]=256;else if(v==64){let y=u+1;for(;y<a&&Fr[y]==64;)y++;let w=u&&d==8||y<i&&Fr[y]==8?p==1?1:8:256;for(let R=u;R<y;R++)Fr[R]=w;u=y-1}else v==8&&p==1&&(Fr[u]=1);d=v,v&7&&(p=v)}}}function Mue(t,e,i,n,r){let s=r==1?2:1;for(let o=0,a=0,l=0;o<=n.length;o++){let u=o?n[o-1].to:e,d=o<n.length?n[o].from:i;for(let p=u,v,y,w;p<d;p++)if(y=P3[v=t.charCodeAt(p)])if(y<0){for(let R=a-3;R>=0;R-=3)if(Wu[R+1]==-y){let O=Wu[R+2],P=O&2?r:O&4?O&1?s:r:0;P&&(Fr[p]=Fr[Wu[R]]=P),a=R;break}}else{if(Wu.length==189)break;Wu[a++]=p,Wu[a++]=v,Wu[a++]=l}else if((w=Fr[p])==2||w==1){let R=w==r;l=R?0:1;for(let O=a-3;O>=0;O-=3){let P=Wu[O+2];if(P&2)break;if(R)Wu[O+2]|=2;else{if(P&4)break;Wu[O+2]|=4}}}}}function Tue(t,e,i,n){for(let r=0,s=n;r<=i.length;r++){let o=r?i[r-1].to:t,a=r<i.length?i[r].from:e;for(let l=o;l<a;){let u=Fr[l];if(u==256){let d=l+1;for(;;)if(d==a){if(r==i.length)break;d=i[r++].to,a=r<i.length?i[r].from:e}else if(Fr[d]==256)d++;else break;let p=s==1,v=(d<e?Fr[d]:n)==1,y=p==v?p?1:2:n;for(let w=d,R=r,O=R?i[R-1].to:t;w>l;)w==O&&(w=i[--R].from,O=R?i[R-1].to:t),Fr[--w]=y;l=d}else s=u,l++}}}function E3(t,e,i,n,r,s,o){let a=n%2?2:1;if(n%2==r%2)for(let l=e,u=0;l<i;){let d=!0,p=!1;if(u==s.length||l<s[u].from){let R=Fr[l];R!=a&&(d=!1,p=R==16)}let v=!d&&a==1?[]:null,y=d?n:n+1,w=l;e:for(;;)if(u<s.length&&w==s[u].from){if(p)break e;let R=s[u];if(!d)for(let O=R.to,P=u+1;;){if(O==i)break e;if(P<s.length&&s[P].from==O)O=s[P++].to;else{if(Fr[O]==a)break e;break}}if(u++,v)v.push(R);else{R.from>l&&o.push(new ap(l,R.from,y));let O=R.direction==Eg!=!(y%2);A3(t,O?n+1:n,r,R.inner,R.from,R.to,o),l=R.to}w=R.to}else{if(w==i||(d?Fr[w]!=a:Fr[w]==a))break;w++}v?E3(t,l,w,n+1,r,v,o):l<w&&o.push(new ap(l,w,y)),l=w}else for(let l=i,u=s.length;l>e;){let d=!0,p=!1;if(!u||l>s[u-1].to){let R=Fr[l-1];R!=a&&(d=!1,p=R==16)}let v=!d&&a==1?[]:null,y=d?n:n+1,w=l;e:for(;;)if(u&&w==s[u-1].to){if(p)break e;let R=s[--u];if(!d)for(let O=R.from,P=u;;){if(O==e)break e;if(P&&s[P-1].to==O)O=s[--P].from;else{if(Fr[O-1]==a)break e;break}}if(v)v.push(R);else{R.to<l&&o.push(new ap(R.to,l,y));let O=R.direction==Eg!=!(y%2);A3(t,O?n+1:n,r,R.inner,R.from,R.to,o),l=R.from}w=R.from}else{if(w==e||(d?Fr[w-1]!=a:Fr[w-1]==a))break;w--}v?E3(t,w,l,n+1,r,v,o):w<l&&o.push(new ap(w,l,y)),l=w}}function A3(t,e,i,n,r,s,o){let a=e%2?2:1;Oue(t,r,s,n,a),Mue(t,r,s,n,a),Tue(r,s,n,a),E3(t,r,s,e,i,n,o)}function Rue(t,e,i){if(!t)return[new ap(0,0,e==lG?1:0)];if(e==Eg&&!i.length&&!Sue.test(t))return p7(t.length);if(i.length)for(;t.length>Fr.length;)Fr[Fr.length]=256;let n=[],r=e==Eg?0:1;return A3(t,r,r,i,0,t.length,n),n}function p7(t){return[new ap(0,t,0)]}let m7="";function Pue(t,e,i,n,r){var s;let o=n.head-t.from,a=ap.find(e,o,(s=n.bidiLevel)!==null&&s!==void 0?s:-1,n.assoc),l=e[a],u=l.side(r,i);if(o==u){let v=a+=r?1:-1;if(v<0||v>=e.length)return null;l=e[a=v],o=l.side(!r,i),u=l.side(r,i)}let d=Qo(t.text,o,l.forward(r,i));(d<l.from||d>l.to)&&(d=u),m7=t.text.slice(Math.min(o,d),Math.max(o,d));let p=a==(r?e.length-1:0)?null:e[a+(r?1:-1)];return p&&d==u&&p.level+(r?0:1)<l.level?Kt.cursor(p.side(!r,i)+t.from,p.forward(r,i)?1:-1,p.level):Kt.cursor(d+t.from,l.forward(r,i)?-1:1,l.level)}function Eue(t,e,i){for(let n=e;n<i;n++){let r=d7(t.charCodeAt(n));if(r==1)return Eg;if(r==2||r==4)return lG}return Eg}const g7=Fi.define(),v7=Fi.define(),y7=Fi.define(),x7=Fi.define(),I3=Fi.define(),b7=Fi.define(),w7=Fi.define(),cG=Fi.define(),uG=Fi.define(),_7=Fi.define({combine:t=>t.some(e=>e)}),C7=Fi.define({combine:t=>t.some(e=>e)}),S7=Fi.define();class Zy{constructor(e,i="nearest",n="nearest",r=5,s=5,o=!1){this.range=e,this.y=i,this.x=n,this.yMargin=r,this.xMargin=s,this.isSnapshot=o}map(e){return e.empty?this:new Zy(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new Zy(Kt.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const C1=_n.define({map:(t,e)=>t.map(e)}),O7=_n.define();function fl(t,e,i){let n=t.facet(x7);n.length?n[0](e):window.onerror?window.onerror(String(e),i,void 0,void 0,e):i?console.error(i+":",e):console.error(e)}const xd=Fi.define({combine:t=>t.length?t[0]:!0});let Aue=0;const fw=Fi.define();class $s{constructor(e,i,n,r,s){this.id=e,this.create=i,this.domEventHandlers=n,this.domEventObservers=r,this.extension=s(this)}static define(e,i){const{eventHandlers:n,eventObservers:r,provide:s,decorations:o}=i||{};return new $s(Aue++,e,n,r,a=>{let l=[fw.of(a)];return o&&l.push(M_.of(u=>{let d=u.plugin(a);return d?o(d):an.none})),s&&l.push(s(a)),l})}static fromClass(e,i){return $s.define(n=>new e(n),i)}}class vF{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let i=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(i)}catch(n){if(fl(i.state,n,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(i){fl(e.state,i,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var i;if(!((i=this.value)===null||i===void 0)&&i.destroy)try{this.value.destroy()}catch(n){fl(e.state,n,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const M7=Fi.define(),hG=Fi.define(),M_=Fi.define(),T7=Fi.define(),dG=Fi.define(),R7=Fi.define();function Y4(t,e){let i=t.state.facet(R7);if(!i.length)return i;let n=i.map(s=>s instanceof Function?s(t):s),r=[];return ur.spans(n,e.from,e.to,{point(){},span(s,o,a,l){let u=s-e.from,d=o-e.from,p=r;for(let v=a.length-1;v>=0;v--,l--){let y=a[v].spec.bidiIsolate,w;if(y==null&&(y=Eue(e.text,u,d)),l>0&&p.length&&(w=p[p.length-1]).to==u&&w.direction==y)w.to=d,p=w.inner;else{let R={from:u,to:d,direction:y,inner:[]};p.push(R),p=R.inner}}}}),r}const P7=Fi.define();function fG(t){let e=0,i=0,n=0,r=0;for(let s of t.state.facet(P7)){let o=s(t);o&&(o.left!=null&&(e=Math.max(e,o.left)),o.right!=null&&(i=Math.max(i,o.right)),o.top!=null&&(n=Math.max(n,o.top)),o.bottom!=null&&(r=Math.max(r,o.bottom)))}return{left:e,right:i,top:n,bottom:r}}const pw=Fi.define();class Nc{constructor(e,i,n,r){this.fromA=e,this.toA=i,this.fromB=n,this.toB=r}join(e){return new Nc(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let i=e.length,n=this;for(;i>0;i--){let r=e[i-1];if(!(r.fromA>n.toA)){if(r.toA<n.fromA)break;n=n.join(r),e.splice(i-1,1)}}return e.splice(i,0,n),e}static extendWithRanges(e,i){if(i.length==0)return e;let n=[];for(let r=0,s=0,o=0,a=0;;r++){let l=r==e.length?null:e[r],u=o-a,d=l?l.fromB:1e9;for(;s<i.length&&i[s]<d;){let p=i[s],v=i[s+1],y=Math.max(a,p),w=Math.min(d,v);if(y<=w&&new Nc(y+u,w+u,y,w).addToSet(n),v>d)break;s+=2}if(!l)return n;new Nc(l.fromA,l.toA,l.fromB,l.toB).addToSet(n),o=l.toA,a=l.toB}}}class KM{constructor(e,i,n){this.view=e,this.state=i,this.transactions=n,this.flags=0,this.startState=e.state,this.changes=ao.empty(this.startState.doc.length);for(let s of n)this.changes=this.changes.compose(s.changes);let r=[];this.changes.iterChangedRanges((s,o,a,l)=>r.push(new Nc(s,o,a,l))),this.changedRanges=r}static create(e,i,n){return new KM(e,i,n)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class J4 extends Br{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=an.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new Ys],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Nc(0,0,0,e.state.doc.length)],0,null)}update(e){var i;let n=e.changedRanges;this.minWidth>0&&n.length&&(n.every(({fromA:u,toA:d})=>d<this.minWidthFrom||u>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let r=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((i=this.domChanged)===null||i===void 0)&&i.newSel?r=this.domChanged.newSel.head:!Bue(e.changes,this.hasComposition)&&!e.selectionSet&&(r=e.state.selection.main.head));let s=r>-1?kue(this.view,e.changes,r):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:u,to:d}=this.hasComposition;n=new Nc(u,d,e.changes.mapPos(u,-1),e.changes.mapPos(d,1)).addToSet(n.slice())}this.hasComposition=s?{from:s.range.fromB,to:s.range.toB}:null,(Vi.ie||Vi.chrome)&&!s&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,a=this.updateDeco(),l=Fue(o,a,e.changes);return n=Nc.extendWithRanges(n,l),!(this.flags&7)&&n.length==0?!1:(this.updateInner(n,e.startState.doc.length,s),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,i,n){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,i,n);let{observer:r}=this.view;r.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=Vi.chrome||Vi.ios?{node:r.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,o),this.flags&=-8,o&&(o.written||r.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(o=>o.flags&=-9);let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof Rd&&o.widget instanceof R3&&s.push(o.dom);r.updateGaps(s)}updateChildren(e,i,n){let r=n?n.range.addToSet(e.slice()):e,s=this.childCursor(i);for(let o=r.length-1;;o--){let a=o>=0?r[o]:null;if(!a)break;let{fromA:l,toA:u,fromB:d,toB:p}=a,v,y,w,R;if(n&&n.range.fromB<p&&n.range.toB>d){let k=zw.build(this.view.state.doc,d,n.range.fromB,this.decorations,this.dynamicDecorationMap),$=zw.build(this.view.state.doc,n.range.toB,p,this.decorations,this.dynamicDecorationMap);y=k.breakAtStart,w=k.openStart,R=$.openEnd;let W=this.compositionView(n);$.breakAtStart?W.breakAfter=1:$.content.length&&W.merge(W.length,W.length,$.content[0],!1,$.openStart,0)&&(W.breakAfter=$.content[0].breakAfter,$.content.shift()),k.content.length&&W.merge(0,0,k.content[k.content.length-1],!0,0,k.openEnd)&&k.content.pop(),v=k.content.concat(W).concat($.content)}else({content:v,breakAtStart:y,openStart:w,openEnd:R}=zw.build(this.view.state.doc,d,p,this.decorations,this.dynamicDecorationMap));let{i:O,off:P}=s.findPos(u,1),{i:N,off:F}=s.findPos(l,-1);n7(this,N,F,O,P,v,y,w,R)}n&&this.fixCompositionDOM(n)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let i of e.transactions)for(let n of i.effects)n.is(O7)&&(this.editContextFormatting=n.value)}compositionView(e){let i=new Cu(e.text.nodeValue);i.flags|=8;for(let{deco:r}of e.marks)i=new Ud(r,[i],i.length);let n=new Ys;return n.append(i,0),n}fixCompositionDOM(e){let i=(s,o)=>{o.flags|=8|(o.children.some(l=>l.flags&7)?1:0),this.markedForComposition.add(o);let a=Br.get(s);a&&a!=o&&(a.dom=null),o.setDOM(s)},n=this.childPos(e.range.fromB,1),r=this.children[n.i];i(e.line,r);for(let s=e.marks.length-1;s>=-1;s--)n=r.childPos(n.off,1),r=r.children[n.i],i(s>=0?e.marks[s].node:e.text,r)}updateSelection(e=!1,i=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let n=this.view.root.activeElement,r=n==this.dom,s=!r&&!(this.view.state.facet(xd)||this.dom.tabIndex>-1)&&mM(this.dom,this.view.observer.selectionRange)&&!(n&&this.dom.contains(n));if(!(r||i||s))return;let o=this.forceSelection;this.forceSelection=!1;let a=this.view.state.selection.main,l=this.moveToLine(this.domAtPos(a.anchor)),u=a.empty?l:this.moveToLine(this.domAtPos(a.head));if(Vi.gecko&&a.empty&&!this.hasComposition&&Iue(l)){let p=document.createTextNode("");this.view.observer.ignore(()=>l.node.insertBefore(p,l.node.childNodes[l.offset]||null)),l=u=new ua(p,0),o=!0}let d=this.view.observer.selectionRange;(o||!d.focusNode||(!Bw(l.node,l.offset,d.anchorNode,d.anchorOffset)||!Bw(u.node,u.offset,d.focusNode,d.focusOffset))&&!this.suppressWidgetCursorChange(d,a))&&(this.view.observer.ignore(()=>{Vi.android&&Vi.chrome&&this.dom.contains(d.focusNode)&&Nue(d.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let p=O_(this.view.root);if(p)if(a.empty){if(Vi.gecko){let v=Due(l.node,l.offset);if(v&&v!=3){let y=(v==1?e7:t7)(l.node,l.offset);y&&(l=new ua(y.node,y.offset))}}p.collapse(l.node,l.offset),a.bidiLevel!=null&&p.caretBidiLevel!==void 0&&(p.caretBidiLevel=a.bidiLevel)}else if(p.extend){p.collapse(l.node,l.offset);try{p.extend(u.node,u.offset)}catch{}}else{let v=document.createRange();a.anchor>a.head&&([l,u]=[u,l]),v.setEnd(u.node,u.offset),v.setStart(l.node,l.offset),p.removeAllRanges(),p.addRange(v)}s&&this.view.root.activeElement==this.dom&&(this.dom.blur(),n&&n.focus())}),this.view.observer.setSelectionRange(l,u)),this.impreciseAnchor=l.precise?null:new ua(d.anchorNode,d.anchorOffset),this.impreciseHead=u.precise?null:new ua(d.focusNode,d.focusOffset)}suppressWidgetCursorChange(e,i){return this.hasComposition&&i.empty&&Bw(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==i.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,i=e.state.selection.main,n=O_(e.root),{anchorNode:r,anchorOffset:s}=e.observer.selectionRange;if(!n||!i.empty||!i.assoc||!n.modify)return;let o=Ys.find(this,i.head);if(!o)return;let a=o.posAtStart;if(i.head==a||i.head==a+o.length)return;let l=this.coordsAt(i.head,-1),u=this.coordsAt(i.head,1);if(!l||!u||l.bottom>u.top)return;let d=this.domAtPos(i.head+i.assoc);n.collapse(d.node,d.offset),n.modify("move",i.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let p=e.observer.selectionRange;e.docView.posFromDOM(p.anchorNode,p.anchorOffset)!=i.from&&n.collapse(r,s)}moveToLine(e){let i=this.dom,n;if(e.node!=i)return e;for(let r=e.offset;!n&&r<i.childNodes.length;r++){let s=Br.get(i.childNodes[r]);s instanceof Ys&&(n=s.domAtPos(0))}for(let r=e.offset-1;!n&&r>=0;r--){let s=Br.get(i.childNodes[r]);s instanceof Ys&&(n=s.domAtPos(s.length))}return n?new ua(n.node,n.offset,!0):e}nearest(e){for(let i=e;i;){let n=Br.get(i);if(n&&n.rootView==this)return n;i=i.parentNode}return null}posFromDOM(e,i){let n=this.nearest(e);if(!n)throw new RangeError("Trying to find position for a DOM position outside of the document");return n.localPosFromDOM(e,i)+n.posAtStart}domAtPos(e){let{i,off:n}=this.childCursor().findPos(e,-1);for(;i<this.children.length-1;){let r=this.children[i];if(n<r.length||r instanceof Ys)break;i++,n=0}return this.children[i].domAtPos(n)}coordsAt(e,i){let n=null,r=0;for(let s=this.length,o=this.children.length-1;o>=0;o--){let a=this.children[o],l=s-a.breakAfter,u=l-a.length;if(l<e)break;if(u<=e&&(u<e||a.covers(-1))&&(l>e||a.covers(1))&&(!n||a instanceof Ys&&!(n instanceof Ys&&i>=0)))n=a,r=u;else if(n&&u==e&&l==e&&a instanceof Rd&&Math.abs(i)<2){if(a.deco.startSide<0)break;o&&(n=null)}s=u}return n?n.coordsAt(e-r,i):null}coordsForChar(e){let{i,off:n}=this.childPos(e,1),r=this.children[i];if(!(r instanceof Ys))return null;for(;r.children.length;){let{i:a,off:l}=r.childPos(n,1);for(;;a++){if(a==r.children.length)return null;if((r=r.children[a]).length)break}n=l}if(!(r instanceof Cu))return null;let s=Qo(r.text,n);if(s==n)return null;let o=Pg(r.dom,n,s).getClientRects();for(let a=0;a<o.length;a++){let l=o[a];if(a==o.length-1||l.top<l.bottom&&l.left<l.right)return l}return null}measureVisibleLineHeights(e){let i=[],{from:n,to:r}=e,s=this.view.contentDOM.clientWidth,o=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,a=-1,l=this.view.textDirection==Yr.LTR;for(let u=0,d=0;d<this.children.length;d++){let p=this.children[d],v=u+p.length;if(v>r)break;if(u>=n){let y=p.dom.getBoundingClientRect();if(i.push(y.height),o){let w=p.dom.lastChild,R=w?d0(w):[];if(R.length){let O=R[R.length-1],P=l?O.right-y.left:y.right-O.left;P>a&&(a=P,this.minWidth=s,this.minWidthFrom=u,this.minWidthTo=v)}}}u=v+p.breakAfter}return i}textDirectionAt(e){let{i}=this.childPos(e,1);return getComputedStyle(this.children[i].dom).direction=="rtl"?Yr.RTL:Yr.LTR}measureTextSize(){for(let s of this.children)if(s instanceof Ys){let o=s.measureTextSize();if(o)return o}let e=document.createElement("div"),i,n,r;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let s=d0(e.firstChild)[0];i=e.getBoundingClientRect().height,n=s?s.width/27:7,r=s?s.height:i,e.remove()}),{lineHeight:i,charWidth:n,textHeight:r}}childCursor(e=this.length){let i=this.children.length;return i&&(e-=this.children[--i].length),new i7(this.children,e,i)}computeBlockGapDeco(){let e=[],i=this.view.viewState;for(let n=0,r=0;;r++){let s=r==i.viewports.length?null:i.viewports[r],o=s?s.from-1:this.length;if(o>n){let a=(i.lineBlockAt(o).bottom-i.lineBlockAt(n).top)/this.view.scaleY;e.push(an.replace({widget:new R3(a),block:!0,inclusive:!0,isBlockGap:!0}).range(n,o))}if(!s)break;n=s.to+1}return an.set(e)}updateDeco(){let e=1,i=this.view.state.facet(M_).map(s=>(this.dynamicDecorationMap[e++]=typeof s=="function")?s(this.view):s),n=!1,r=this.view.state.facet(T7).map((s,o)=>{let a=typeof s=="function";return a&&(n=!0),a?s(this.view):s});for(r.length&&(this.dynamicDecorationMap[e++]=n,i.push(ur.join(r))),this.decorations=[this.editContextFormatting,...i,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let u=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=u.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let u of this.view.state.facet(S7))try{if(u(this.view,e.range,e))return!0}catch(d){fl(this.view.state,d,"scroll handler")}let{range:i}=e,n=this.coordsAt(i.head,i.empty?i.assoc:i.head>i.anchor?-1:1),r;if(!n)return;!i.empty&&(r=this.coordsAt(i.anchor,i.anchor>i.head?-1:1))&&(n={left:Math.min(n.left,r.left),top:Math.min(n.top,r.top),right:Math.max(n.right,r.right),bottom:Math.max(n.bottom,r.bottom)});let s=fG(this.view),o={left:n.left-s.left,top:n.top-s.top,right:n.right+s.right,bottom:n.bottom+s.bottom},{offsetWidth:a,offsetHeight:l}=this.view.scrollDOM;uue(this.view.scrollDOM,o,i.head<i.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,a),-a),Math.max(Math.min(e.yMargin,l),-l),this.view.textDirection==Yr.LTR)}}function Iue(t){return t.node.nodeType==1&&t.node.firstChild&&(t.offset==0||t.node.childNodes[t.offset-1].contentEditable=="false")&&(t.offset==t.node.childNodes.length||t.node.childNodes[t.offset].contentEditable=="false")}function E7(t,e){let i=t.observer.selectionRange;if(!i.focusNode)return null;let n=e7(i.focusNode,i.focusOffset),r=t7(i.focusNode,i.focusOffset),s=n||r;if(r&&n&&r.node!=n.node){let a=Br.get(r.node);if(!a||a instanceof Cu&&a.text!=r.node.nodeValue)s=r;else if(t.docView.lastCompositionAfterCursor){let l=Br.get(n.node);!l||l instanceof Cu&&l.text!=n.node.nodeValue||(s=r)}}if(t.docView.lastCompositionAfterCursor=s!=n,!s)return null;let o=e-s.offset;return{from:o,to:o+s.node.nodeValue.length,node:s.node}}function kue(t,e,i){let n=E7(t,i);if(!n)return null;let{node:r,from:s,to:o}=n,a=r.nodeValue;if(/[\n\r]/.test(a)||t.state.doc.sliceString(n.from,n.to)!=a)return null;let l=e.invertedDesc,u=new Nc(l.mapPos(s),l.mapPos(o),s,o),d=[];for(let p=r.parentNode;;p=p.parentNode){let v=Br.get(p);if(v instanceof Ud)d.push({node:p,deco:v.mark});else{if(v instanceof Ys||p.nodeName=="DIV"&&p.parentNode==t.contentDOM)return{range:u,text:r,marks:d,line:p};if(p!=t.contentDOM)d.push({node:p,deco:new SC({inclusive:!0,attributes:bue(p),tagName:p.tagName.toLowerCase()})});else return null}}}function Due(t,e){return t.nodeType!=1?0:(e&&t.childNodes[e-1].contentEditable=="false"?1:0)|(e<t.childNodes.length&&t.childNodes[e].contentEditable=="false"?2:0)}let Lue=class{constructor(){this.changes=[]}compareRange(e,i){gM(e,i,this.changes)}comparePoint(e,i){gM(e,i,this.changes)}boundChange(e){gM(e,e,this.changes)}};function Fue(t,e,i){let n=new Lue;return ur.compare(t,e,i,n),n.changes}function Nue(t,e){for(let i=t;i&&i!=e;i=i.assignedSlot||i.parentNode)if(i.nodeType==1&&i.contentEditable=="false")return!0;return!1}function Bue(t,e){let i=!1;return e&&t.iterChangedRanges((n,r)=>{n<e.to&&r>e.from&&(i=!0)}),i}function zue(t,e,i=1){let n=t.charCategorizer(e),r=t.doc.lineAt(e),s=e-r.from;if(r.length==0)return Kt.cursor(e);s==0?i=1:s==r.length&&(i=-1);let o=s,a=s;i<0?o=Qo(r.text,s,!1):a=Qo(r.text,s);let l=n(r.text.slice(o,a));for(;o>0;){let u=Qo(r.text,o,!1);if(n(r.text.slice(u,o))!=l)break;o=u}for(;a<r.length;){let u=Qo(r.text,a);if(n(r.text.slice(a,u))!=l)break;a=u}return Kt.range(o+r.from,a+r.from)}function Vue(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function Gue(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function yF(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function e$(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function t$(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function k3(t,e,i){let n,r,s,o,a=!1,l,u,d,p;for(let w=t.firstChild;w;w=w.nextSibling){let R=d0(w);for(let O=0;O<R.length;O++){let P=R[O];r&&yF(r,P)&&(P=e$(t$(P,r.bottom),r.top));let N=Vue(e,P),F=Gue(i,P);if(N==0&&F==0)return w.nodeType==3?i$(w,e,i):k3(w,e,i);if(!n||o>F||o==F&&s>N){n=w,r=P,s=N,o=F;let k=F?i<P.top?-1:1:N?e<P.left?-1:1:0;a=!k||(k>0?O<R.length-1:O>0)}N==0?i>P.bottom&&(!d||d.bottom<P.bottom)?(l=w,d=P):i<P.top&&(!p||p.top>P.top)&&(u=w,p=P):d&&yF(d,P)?d=t$(d,P.bottom):p&&yF(p,P)&&(p=e$(p,P.top))}}if(d&&d.bottom>=i?(n=l,r=d):p&&p.top<=i&&(n=u,r=p),!n)return{node:t,offset:0};let v=Math.max(r.left,Math.min(r.right,e));if(n.nodeType==3)return i$(n,v,i);if(a&&n.contentEditable!="false")return k3(n,v,i);let y=Array.prototype.indexOf.call(t.childNodes,n)+(e>=(r.left+r.right)/2?1:0);return{node:t,offset:y}}function i$(t,e,i){let n=t.nodeValue.length,r=-1,s=1e9,o=0;for(let a=0;a<n;a++){let l=Pg(t,a,a+1).getClientRects();for(let u=0;u<l.length;u++){let d=l[u];if(d.top==d.bottom)continue;o||(o=e-d.left);let p=(d.top>i?d.top-i:i-d.bottom)-1;if(d.left-1<=e&&d.right+1>=e&&p<s){let v=e>=(d.left+d.right)/2,y=v;if((Vi.chrome||Vi.gecko)&&Pg(t,a).getBoundingClientRect().left==d.right&&(y=!v),p<=0)return{node:t,offset:a+(y?1:0)};r=a+(y?1:0),s=p}}}return{node:t,offset:r>-1?r:o>0?t.nodeValue.length:0}}function A7(t,e,i,n=-1){var r,s;let o=t.contentDOM.getBoundingClientRect(),a=o.top+t.viewState.paddingTop,l,{docHeight:u}=t.viewState,{x:d,y:p}=e,v=p-a;if(v<0)return 0;if(v>u)return t.state.doc.length;for(let k=t.viewState.heightOracle.textHeight/2,$=!1;l=t.elementAtHeight(v),l.type!=Ga.Text;)for(;v=n>0?l.bottom+k:l.top-k,!(v>=0&&v<=u);){if($)return i?null:0;$=!0,n=-n}p=a+v;let y=l.from;if(y<t.viewport.from)return t.viewport.from==0?0:i?null:n$(t,o,l,d,p);if(y>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:i?null:n$(t,o,l,d,p);let w=t.dom.ownerDocument,R=t.root.elementFromPoint?t.root:w,O=R.elementFromPoint(d,p);O&&!t.contentDOM.contains(O)&&(O=null),O||(d=Math.max(o.left+1,Math.min(o.right-1,d)),O=R.elementFromPoint(d,p),O&&!t.contentDOM.contains(O)&&(O=null));let P,N=-1;if(O&&((r=t.docView.nearest(O))===null||r===void 0?void 0:r.isEditable)!=!1){if(w.caretPositionFromPoint){let k=w.caretPositionFromPoint(d,p);k&&({offsetNode:P,offset:N}=k)}else if(w.caretRangeFromPoint){let k=w.caretRangeFromPoint(d,p);k&&({startContainer:P,startOffset:N}=k,(!t.contentDOM.contains(P)||Vi.safari&&Uue(P,N,d)||Vi.chrome&&Hue(P,N,d))&&(P=void 0))}P&&(N=Math.min(Sh(P),N))}if(!P||!t.docView.dom.contains(P)){let k=Ys.find(t.docView,y);if(!k)return v>l.top+l.height/2?l.to:l.from;({node:P,offset:N}=k3(k.dom,d,p))}let F=t.docView.nearest(P);if(!F)return null;if(F.isWidget&&((s=F.dom)===null||s===void 0?void 0:s.nodeType)==1){let k=F.dom.getBoundingClientRect();return e.y<k.top||e.y<=k.bottom&&e.x<=(k.left+k.right)/2?F.posAtStart:F.posAtEnd}else return F.localPosFromDOM(P,N)+F.posAtStart}function n$(t,e,i,n,r){let s=Math.round((n-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&i.height>t.defaultLineHeight*1.5){let a=t.viewState.heightOracle.textHeight,l=Math.floor((r-i.top-(t.defaultLineHeight-a)*.5)/a);s+=l*t.viewState.heightOracle.lineLength}let o=t.state.sliceDoc(i.from,i.to);return i.from+x3(o,s,t.state.tabSize)}function Uue(t,e,i){let n;if(t.nodeType!=3||e!=(n=t.nodeValue.length))return!1;for(let r=t.nextSibling;r;r=r.nextSibling)if(r.nodeType!=1||r.nodeName!="BR")return!1;return Pg(t,n-1,n).getBoundingClientRect().left>i}function Hue(t,e,i){if(e!=0)return!1;for(let r=t;;){let s=r.parentNode;if(!s||s.nodeType!=1||s.firstChild!=r)return!1;if(s.classList.contains("cm-line"))break;r=s}let n=t.nodeType==1?t.getBoundingClientRect():Pg(t,0,Math.max(t.nodeValue.length,1)).getBoundingClientRect();return i-n.left>5}function D3(t,e){let i=t.lineBlockAt(e);if(Array.isArray(i.type)){for(let n of i.type)if(n.to>e||n.to==e&&(n.to==i.to||n.type==Ga.Text))return n}return i}function $ue(t,e,i,n){let r=D3(t,e.head),s=!n||r.type!=Ga.Text||!(t.lineWrapping||r.widgetLineBreaks)?null:t.coordsAtPos(e.assoc<0&&e.head>r.from?e.head-1:e.head);if(s){let o=t.dom.getBoundingClientRect(),a=t.textDirectionAt(r.from),l=t.posAtCoords({x:i==(a==Yr.LTR)?o.right-1:o.left+1,y:(s.top+s.bottom)/2});if(l!=null)return Kt.cursor(l,i?-1:1)}return Kt.cursor(i?r.to:r.from,i?-1:1)}function r$(t,e,i,n){let r=t.state.doc.lineAt(e.head),s=t.bidiSpans(r),o=t.textDirectionAt(r.from);for(let a=e,l=null;;){let u=Pue(r,s,o,a,i),d=m7;if(!u){if(r.number==(i?t.state.doc.lines:1))return a;d=`
`,r=t.state.doc.line(r.number+(i?1:-1)),s=t.bidiSpans(r),u=t.visualLineSide(r,!i)}if(l){if(!l(d))return a}else{if(!n)return u;l=n(d)}a=u}}function Wue(t,e,i){let n=t.state.charCategorizer(e),r=n(i);return s=>{let o=n(s);return r==cs.Space&&(r=o),r==o}}function que(t,e,i,n){let r=e.head,s=i?1:-1;if(r==(i?t.state.doc.length:0))return Kt.cursor(r,e.assoc);let o=e.goalColumn,a,l=t.contentDOM.getBoundingClientRect(),u=t.coordsAtPos(r,e.assoc||-1),d=t.documentTop;if(u)o==null&&(o=u.left-l.left),a=s<0?u.top:u.bottom;else{let y=t.viewState.lineBlockAt(r);o==null&&(o=Math.min(l.right-l.left,t.defaultCharacterWidth*(r-y.from))),a=(s<0?y.top:y.bottom)+d}let p=l.left+o,v=n??t.viewState.heightOracle.textHeight>>1;for(let y=0;;y+=10){let w=a+(v+y)*s,R=A7(t,{x:p,y:w},!1,s);if(w<l.top||w>l.bottom||(s<0?R<r:R>r)){let O=t.docView.coordsForChar(R),P=!O||w<O.top?-1:1;return Kt.cursor(R,P,void 0,o)}}}function vM(t,e,i){for(;;){let n=0;for(let r of t)r.between(e-1,e+1,(s,o,a)=>{if(e>s&&e<o){let l=n||i||(e-s<o-e?-1:1);e=l<0?s:o,n=l}});if(!n)return e}}function xF(t,e,i){let n=vM(t.state.facet(dG).map(r=>r(t)),i.from,e.head>i.from?-1:1);return n==i.from?i:Kt.cursor(n,n<i.from?1:-1)}const mw="ï¿¿";class jue{constructor(e,i){this.points=e,this.text="",this.lineSeparator=i.facet(xs.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=mw}readRange(e,i){if(!e)return this;let n=e.parentNode;for(let r=e;;){this.findPointBefore(n,r);let s=this.text.length;this.readNode(r);let o=r.nextSibling;if(o==i)break;let a=Br.get(r),l=Br.get(o);(a&&l?a.breakAfter:(a?a.breakAfter:ZM(r))||ZM(o)&&(r.nodeName!="BR"||r.cmIgnore)&&this.text.length>s)&&this.lineBreak(),r=o}return this.findPointBefore(n,i),this}readTextNode(e){let i=e.nodeValue;for(let n of this.points)n.node==e&&(n.pos=this.text.length+Math.min(n.offset,i.length));for(let n=0,r=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,o=1,a;if(this.lineSeparator?(s=i.indexOf(this.lineSeparator,n),o=this.lineSeparator.length):(a=r.exec(i))&&(s=a.index,o=a[0].length),this.append(i.slice(n,s<0?i.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let l of this.points)l.node==e&&l.pos>this.text.length&&(l.pos-=o-1);n=s+o}}readNode(e){if(e.cmIgnore)return;let i=Br.get(e),n=i&&i.overrideDOMText;if(n!=null){this.findPointInside(e,n.length);for(let r=n.iter();!r.next().done;)r.lineBreak?this.lineBreak():this.append(r.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,i){for(let n of this.points)n.node==e&&e.childNodes[n.offset]==i&&(n.pos=this.text.length)}findPointInside(e,i){for(let n of this.points)(e.nodeType==3?n.node==e:e.contains(n.node))&&(n.pos=this.text.length+(Que(e,n.node,n.offset)?i:0))}}function Que(t,e,i){for(;;){if(!e||i<Sh(e))return!1;if(e==t)return!0;i=Rg(e)+1,e=e.parentNode}}class s${constructor(e,i){this.node=e,this.offset=i,this.pos=-1}}class Zue{constructor(e,i,n,r){this.typeOver=r,this.bounds=null,this.text="",this.domChanged=i>-1;let{impreciseHead:s,impreciseAnchor:o}=e.docView;if(e.state.readOnly&&i>-1)this.newSel=null;else if(i>-1&&(this.bounds=e.docView.domBoundsAround(i,n,0))){let a=s||o?[]:Yue(e),l=new jue(a,e.state);l.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=l.text,this.newSel=Jue(a,this.bounds.from)}else{let a=e.observer.selectionRange,l=s&&s.node==a.focusNode&&s.offset==a.focusOffset||!_3(e.contentDOM,a.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(a.focusNode,a.focusOffset),u=o&&o.node==a.anchorNode&&o.offset==a.anchorOffset||!_3(e.contentDOM,a.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(a.anchorNode,a.anchorOffset),d=e.viewport;if((Vi.ios||Vi.chrome)&&e.state.selection.main.empty&&l!=u&&(d.from>0||d.to<e.state.doc.length)){let p=Math.min(l,u),v=Math.max(l,u),y=d.from-p,w=d.to-v;(y==0||y==1||p==0)&&(w==0||w==-1||v==e.state.doc.length)&&(l=0,u=e.state.doc.length)}this.newSel=Kt.single(u,l)}}}function I7(t,e){let i,{newSel:n}=e,r=t.state.selection.main,s=t.inputState.lastKeyTime>Date.now()-100?t.inputState.lastKeyCode:-1;if(e.bounds){let{from:o,to:a}=e.bounds,l=r.from,u=null;(s===8||Vi.android&&e.text.length<a-o)&&(l=r.to,u="end");let d=Kue(t.state.doc.sliceString(o,a,mw),e.text,l-o,u);d&&(Vi.chrome&&s==13&&d.toB==d.from+2&&e.text.slice(d.from,d.toB)==mw+mw&&d.toB--,i={from:o+d.from,to:o+d.toA,insert:fr.of(e.text.slice(d.from,d.toB).split(mw))})}else n&&(!t.hasFocus&&t.state.facet(xd)||n.main.eq(r))&&(n=null);if(!i&&!n)return!1;if(!i&&e.typeOver&&!r.empty&&n&&n.main.empty?i={from:r.from,to:r.to,insert:t.state.doc.slice(r.from,r.to)}:(Vi.mac||Vi.android)&&i&&i.from==i.to&&i.from==r.head-1&&/^\. ?$/.test(i.insert.toString())&&t.contentDOM.getAttribute("autocorrect")=="off"?(n&&i.insert.length==2&&(n=Kt.single(n.main.anchor-1,n.main.head-1)),i={from:i.from,to:i.to,insert:fr.of([i.insert.toString().replace("."," ")])}):i&&i.from>=r.from&&i.to<=r.to&&(i.from!=r.from||i.to!=r.to)&&r.to-r.from-(i.to-i.from)<=4?i={from:r.from,to:r.to,insert:t.state.doc.slice(r.from,i.from).append(i.insert).append(t.state.doc.slice(i.to,r.to))}:Vi.chrome&&i&&i.from==i.to&&i.from==r.head&&i.insert.toString()==`
 `&&t.lineWrapping&&(n&&(n=Kt.single(n.main.anchor-1,n.main.head-1)),i={from:r.from,to:r.to,insert:fr.of([" "])}),i)return pG(t,i,n,s);if(n&&!n.main.eq(r)){let o=!1,a="select";return t.inputState.lastSelectionTime>Date.now()-50&&(t.inputState.lastSelectionOrigin=="select"&&(o=!0),a=t.inputState.lastSelectionOrigin),t.dispatch({selection:n,scrollIntoView:o,userEvent:a}),!0}else return!1}function pG(t,e,i,n=-1){if(Vi.ios&&t.inputState.flushIOSKey(e))return!0;let r=t.state.selection.main;if(Vi.android&&(e.to==r.to&&(e.from==r.from||e.from==r.from-1&&t.state.sliceDoc(e.from,r.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&Qy(t.contentDOM,"Enter",13)||(e.from==r.from-1&&e.to==r.to&&e.insert.length==0||n==8&&e.insert.length<e.to-e.from&&e.to>r.head)&&Qy(t.contentDOM,"Backspace",8)||e.from==r.from&&e.to==r.to+1&&e.insert.length==0&&Qy(t.contentDOM,"Delete",46)))return!0;let s=e.insert.toString();t.inputState.composing>=0&&t.inputState.composing++;let o,a=()=>o||(o=Xue(t,e,i));return t.state.facet(b7).some(l=>l(t,e.from,e.to,s,a))||t.dispatch(a()),!0}function Xue(t,e,i){let n,r=t.state,s=r.selection.main;if(e.from>=s.from&&e.to<=s.to&&e.to-e.from>=(s.to-s.from)/3&&(!i||i.main.empty&&i.main.from==e.from+e.insert.length)&&t.inputState.composing<0){let a=s.from<e.from?r.sliceDoc(s.from,e.from):"",l=s.to>e.to?r.sliceDoc(e.to,s.to):"";n=r.replaceSelection(t.state.toText(a+e.insert.sliceString(0,void 0,t.state.lineBreak)+l))}else{let a=r.changes(e),l=i&&i.main.to<=a.newLength?i.main:void 0;if(r.selection.ranges.length>1&&t.inputState.composing>=0&&e.to<=s.to&&e.to>=s.to-10){let u=t.state.sliceDoc(e.from,e.to),d,p=i&&E7(t,i.main.head);if(p){let w=e.insert.length-(e.to-e.from);d={from:p.from,to:p.to-w}}else d=t.state.doc.lineAt(s.head);let v=s.to-e.to,y=s.to-s.from;n=r.changeByRange(w=>{if(w.from==s.from&&w.to==s.to)return{changes:a,range:l||w.map(a)};let R=w.to-v,O=R-u.length;if(w.to-w.from!=y||t.state.sliceDoc(O,R)!=u||w.to>=d.from&&w.from<=d.to)return{range:w};let P=r.changes({from:O,to:R,insert:e.insert}),N=w.to-s.to;return{changes:P,range:l?Kt.range(Math.max(0,l.anchor+N),Math.max(0,l.head+N)):w.map(P)}})}else n={changes:a,selection:l&&r.selection.replaceRange(l)}}let o="input.type";return(t.composing||t.inputState.compositionPendingChange&&t.inputState.compositionEndedAt>Date.now()-50)&&(t.inputState.compositionPendingChange=!1,o+=".compose",t.inputState.compositionFirstChange&&(o+=".start",t.inputState.compositionFirstChange=!1)),r.update(n,{userEvent:o,scrollIntoView:!0})}function Kue(t,e,i,n){let r=Math.min(t.length,e.length),s=0;for(;s<r&&t.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==r&&t.length==e.length)return null;let o=t.length,a=e.length;for(;o>0&&a>0&&t.charCodeAt(o-1)==e.charCodeAt(a-1);)o--,a--;if(n=="end"){let l=Math.max(0,s-Math.min(o,a));i-=o+l-s}if(o<s&&t.length<e.length){let l=i<=s&&i>=o?s-i:0;s-=l,a=s+(a-o),o=s}else if(a<s){let l=i<=s&&i>=a?s-i:0;s-=l,o=s+(o-a),a=s}return{from:s,toA:o,toB:a}}function Yue(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:s}=t.observer.selectionRange;return i&&(e.push(new s$(i,n)),(r!=i||s!=n)&&e.push(new s$(r,s))),e}function Jue(t,e){if(t.length==0)return null;let i=t[0].pos,n=t.length==2?t[1].pos:i;return i>-1&&n>-1?Kt.single(i+e,n+e):null}let ehe=class{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,Vi.safari&&e.contentDOM.addEventListener("input",()=>null),Vi.gecko&&ghe(e.contentDOM.ownerDocument)}handleEvent(e){!lhe(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e))}runHandlers(e,i){let n=this.handlers[e];if(n){for(let r of n.observers)r(this.view,i);for(let r of n.handlers){if(i.defaultPrevented)break;if(r(this.view,i)){i.preventDefault();break}}}}ensureHandlers(e){let i=the(e),n=this.handlers,r=this.view.contentDOM;for(let s in i)if(s!="scroll"){let o=!i[s].handlers.length,a=n[s];a&&o!=!a.handlers.length&&(r.removeEventListener(s,this.handleEvent),a=null),a||r.addEventListener(s,this.handleEvent,{passive:o})}for(let s in n)s!="scroll"&&!i[s]&&r.removeEventListener(s,this.handleEvent);this.handlers=i}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&D7.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),Vi.android&&Vi.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let i;return Vi.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((i=k7.find(n=>n.keyCode==e.keyCode))&&!e.ctrlKey||ihe.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=i||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let i=this.pendingIOSKey;return!i||i.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,Qy(this.view.contentDOM,i.key,i.keyCode,i instanceof KeyboardEvent?i:void 0))}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:Vi.safari&&!Vi.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}};function o$(t,e){return(i,n)=>{try{return e.call(t,n,i)}catch(r){fl(i.state,r)}}}function the(t){let e=Object.create(null);function i(n){return e[n]||(e[n]={observers:[],handlers:[]})}for(let n of t){let r=n.spec;if(r&&r.domEventHandlers)for(let s in r.domEventHandlers){let o=r.domEventHandlers[s];o&&i(s).handlers.push(o$(n.value,o))}if(r&&r.domEventObservers)for(let s in r.domEventObservers){let o=r.domEventObservers[s];o&&i(s).observers.push(o$(n.value,o))}}for(let n in Su)i(n).handlers.push(Su[n]);for(let n in $c)i(n).observers.push($c[n]);return e}const k7=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],ihe="dthko",D7=[16,17,18,20,91,92,224,225],S1=6;function O1(t){return Math.max(0,t)*.7+8}function nhe(t,e){return Math.max(Math.abs(t.clientX-e.clientX),Math.abs(t.clientY-e.clientY))}class rhe{constructor(e,i,n,r){this.view=e,this.startEvent=i,this.style=n,this.mustSelect=r,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=i,this.scrollParents=hue(e.contentDOM),this.atoms=e.state.facet(dG).map(o=>o(e));let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=i.shiftKey,this.multiple=e.state.facet(xs.allowMultipleSelections)&&she(e,i),this.dragging=ahe(e,i)&&N7(i)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&nhe(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let i=0,n=0,r=0,s=0,o=this.view.win.innerWidth,a=this.view.win.innerHeight;this.scrollParents.x&&({left:r,right:o}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:s,bottom:a}=this.scrollParents.y.getBoundingClientRect());let l=fG(this.view);e.clientX-l.left<=r+S1?i=-O1(r-e.clientX):e.clientX+l.right>=o-S1&&(i=O1(e.clientX-o)),e.clientY-l.top<=s+S1?n=-O1(s-e.clientY):e.clientY+l.bottom>=a-S1&&(n=O1(e.clientY-a)),this.setScrollSpeed(i,n)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,i){this.scrollSpeed={x:e,y:i},e||i?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:i}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),i&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=i,i=0),(e||i)&&this.view.win.scrollBy(e,i),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let i=null;for(let n=0;n<e.ranges.length;n++){let r=e.ranges[n],s=null;if(r.empty){let o=vM(this.atoms,r.from,0);o!=r.from&&(s=Kt.cursor(o,-1))}else{let o=vM(this.atoms,r.from,-1),a=vM(this.atoms,r.to,1);(o!=r.from||a!=r.to)&&(s=Kt.range(r.from==r.anchor?o:a,r.from==r.head?o:a))}s&&(i||(i=e.ranges.slice()),i[n]=s)}return i?Kt.create(i,e.mainIndex):e}select(e){let{view:i}=this,n=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!n.eq(i.state.selection,this.dragging===!1))&&this.view.dispatch({selection:n,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(i=>i.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function she(t,e){let i=t.state.facet(g7);return i.length?i[0](e):Vi.mac?e.metaKey:e.ctrlKey}function ohe(t,e){let i=t.state.facet(v7);return i.length?i[0](e):Vi.mac?!e.altKey:!e.ctrlKey}function ahe(t,e){let{main:i}=t.state.selection;if(i.empty)return!1;let n=O_(t.root);if(!n||n.rangeCount==0)return!0;let r=n.getRangeAt(0).getClientRects();for(let s=0;s<r.length;s++){let o=r[s];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function lhe(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i=e.target,n;i!=t.contentDOM;i=i.parentNode)if(!i||i.nodeType==11||(n=Br.get(i))&&n.ignoreEvent(e))return!1;return!0}const Su=Object.create(null),$c=Object.create(null),L7=Vi.ie&&Vi.ie_version<15||Vi.ios&&Vi.webkit_version<604;function che(t){let e=t.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus(),setTimeout(()=>{t.focus(),i.remove(),F7(t,i.value)},50)}function sP(t,e,i){for(let n of t.facet(e))i=n(i,t);return i}function F7(t,e){e=sP(t.state,cG,e);let{state:i}=t,n,r=1,s=i.toText(e),o=s.lines==i.selection.ranges.length;if(L3!=null&&i.selection.ranges.every(l=>l.empty)&&L3==s.toString()){let l=-1;n=i.changeByRange(u=>{let d=i.doc.lineAt(u.from);if(d.from==l)return{range:u};l=d.from;let p=i.toText((o?s.line(r++).text:e)+i.lineBreak);return{changes:{from:d.from,insert:p},range:Kt.cursor(u.from+p.length)}})}else o?n=i.changeByRange(l=>{let u=s.line(r++);return{changes:{from:l.from,to:l.to,insert:u.text},range:Kt.cursor(l.from+u.length)}}):n=i.replaceSelection(s);t.dispatch(n,{userEvent:"input.paste",scrollIntoView:!0})}$c.scroll=t=>{t.inputState.lastScrollTop=t.scrollDOM.scrollTop,t.inputState.lastScrollLeft=t.scrollDOM.scrollLeft};Su.keydown=(t,e)=>(t.inputState.setSelectionOrigin("select"),e.keyCode==27&&t.inputState.tabFocusMode!=0&&(t.inputState.tabFocusMode=Date.now()+2e3),!1);$c.touchstart=(t,e)=>{t.inputState.lastTouchTime=Date.now(),t.inputState.setSelectionOrigin("select.pointer")};$c.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")};Su.mousedown=(t,e)=>{if(t.observer.flush(),t.inputState.lastTouchTime>Date.now()-2e3)return!1;let i=null;for(let n of t.state.facet(y7))if(i=n(t,e),i)break;if(!i&&e.button==0&&(i=dhe(t,e)),i){let n=!t.hasFocus;t.inputState.startMouseSelection(new rhe(t,e,i,n)),n&&t.observer.ignore(()=>{KZ(t.contentDOM);let s=t.root.activeElement;s&&!s.contains(t.contentDOM)&&s.blur()});let r=t.inputState.mouseSelection;if(r)return r.start(e),r.dragging===!1}return!1};function a$(t,e,i,n){if(n==1)return Kt.cursor(e,i);if(n==2)return zue(t.state,e,i);{let r=Ys.find(t.docView,e),s=t.state.doc.lineAt(r?r.posAtEnd:e),o=r?r.posAtStart:s.from,a=r?r.posAtEnd:s.to;return a<t.state.doc.length&&a==s.to&&a++,Kt.range(o,a)}}let l$=(t,e,i)=>e>=i.top&&e<=i.bottom&&t>=i.left&&t<=i.right;function uhe(t,e,i,n){let r=Ys.find(t.docView,e);if(!r)return 1;let s=e-r.posAtStart;if(s==0)return 1;if(s==r.length)return-1;let o=r.coordsAt(s,-1);if(o&&l$(i,n,o))return-1;let a=r.coordsAt(s,1);return a&&l$(i,n,a)?1:o&&o.bottom>=n?-1:1}function c$(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:i,bias:uhe(t,i,e.clientX,e.clientY)}}const hhe=Vi.ie&&Vi.ie_version<=11;let u$=null,h$=0,d$=0;function N7(t){if(!hhe)return t.detail;let e=u$,i=d$;return u$=t,d$=Date.now(),h$=!e||i>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(h$+1)%3:1}function dhe(t,e){let i=c$(t,e),n=N7(e),r=t.state.selection;return{update(s){s.docChanged&&(i.pos=s.changes.mapPos(i.pos),r=r.map(s.changes))},get(s,o,a){let l=c$(t,s),u,d=a$(t,l.pos,l.bias,n);if(i.pos!=l.pos&&!o){let p=a$(t,i.pos,i.bias,n),v=Math.min(p.from,d.from),y=Math.max(p.to,d.to);d=v<d.from?Kt.range(v,y):Kt.range(y,v)}return o?r.replaceRange(r.main.extend(d.from,d.to)):a&&n==1&&r.ranges.length>1&&(u=fhe(r,l.pos))?u:a?r.addRange(d):Kt.create([d])}}}function fhe(t,e){for(let i=0;i<t.ranges.length;i++){let{from:n,to:r}=t.ranges[i];if(n<=e&&r>=e)return Kt.create(t.ranges.slice(0,i).concat(t.ranges.slice(i+1)),t.mainIndex==i?0:t.mainIndex-(t.mainIndex>i?1:0))}return null}Su.dragstart=(t,e)=>{let{selection:{main:i}}=t.state;if(e.target.draggable){let r=t.docView.nearest(e.target);if(r&&r.isWidget){let s=r.posAtStart,o=s+r.length;(s>=i.to||o<=i.from)&&(i=Kt.range(s,o))}}let{inputState:n}=t;return n.mouseSelection&&(n.mouseSelection.dragging=!0),n.draggedContent=i,e.dataTransfer&&(e.dataTransfer.setData("Text",sP(t.state,uG,t.state.sliceDoc(i.from,i.to))),e.dataTransfer.effectAllowed="copyMove"),!1};Su.dragend=t=>(t.inputState.draggedContent=null,!1);function f$(t,e,i,n){if(i=sP(t.state,cG,i),!i)return;let r=t.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:s}=t.inputState,o=n&&s&&ohe(t,e)?{from:s.from,to:s.to}:null,a={from:r,insert:i},l=t.state.changes(o?[o,a]:a);t.focus(),t.dispatch({changes:l,selection:{anchor:l.mapPos(r,-1),head:l.mapPos(r,1)},userEvent:o?"move.drop":"input.drop"}),t.inputState.draggedContent=null}Su.drop=(t,e)=>{if(!e.dataTransfer)return!1;if(t.state.readOnly)return!0;let i=e.dataTransfer.files;if(i&&i.length){let n=Array(i.length),r=0,s=()=>{++r==i.length&&f$(t,e,n.filter(o=>o!=null).join(t.state.lineBreak),!1)};for(let o=0;o<i.length;o++){let a=new FileReader;a.onerror=s,a.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(a.result)||(n[o]=a.result),s()},a.readAsText(i[o])}return!0}else{let n=e.dataTransfer.getData("Text");if(n)return f$(t,e,n,!0),!0}return!1};Su.paste=(t,e)=>{if(t.state.readOnly)return!0;t.observer.flush();let i=L7?null:e.clipboardData;return i?(F7(t,i.getData("text/plain")||i.getData("text/uri-list")),!0):(che(t),!1)};function phe(t,e){let i=t.dom.parentNode;if(!i)return;let n=i.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=e,n.focus(),n.selectionEnd=e.length,n.selectionStart=0,setTimeout(()=>{n.remove(),t.focus()},50)}function mhe(t){let e=[],i=[],n=!1;for(let r of t.selection.ranges)r.empty||(e.push(t.sliceDoc(r.from,r.to)),i.push(r));if(!e.length){let r=-1;for(let{from:s}of t.selection.ranges){let o=t.doc.lineAt(s);o.number>r&&(e.push(o.text),i.push({from:o.from,to:Math.min(t.doc.length,o.to+1)})),r=o.number}n=!0}return{text:sP(t,uG,e.join(t.lineBreak)),ranges:i,linewise:n}}let L3=null;Su.copy=Su.cut=(t,e)=>{let{text:i,ranges:n,linewise:r}=mhe(t.state);if(!i&&!r)return!1;L3=r?i:null,e.type=="cut"&&!t.state.readOnly&&t.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"});let s=L7?null:e.clipboardData;return s?(s.clearData(),s.setData("text/plain",i),!0):(phe(t,i),!1)};const B7=ef.define();function z7(t,e){let i=[];for(let n of t.facet(w7)){let r=n(t,e);r&&i.push(r)}return i?t.update({effects:i,annotations:B7.of(!0)}):null}function V7(t){setTimeout(()=>{let e=t.hasFocus;if(e!=t.inputState.notifiedFocused){let i=z7(t.state,e);i?t.dispatch(i):t.update([])}},10)}$c.focus=t=>{t.inputState.lastFocusTime=Date.now(),!t.scrollDOM.scrollTop&&(t.inputState.lastScrollTop||t.inputState.lastScrollLeft)&&(t.scrollDOM.scrollTop=t.inputState.lastScrollTop,t.scrollDOM.scrollLeft=t.inputState.lastScrollLeft),V7(t)};$c.blur=t=>{t.observer.clearSelectionRange(),V7(t)};$c.compositionstart=$c.compositionupdate=t=>{t.observer.editContext||(t.inputState.compositionFirstChange==null&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0))};$c.compositionend=t=>{t.observer.editContext||(t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionPendingKey=!0,t.inputState.compositionPendingChange=t.observer.pendingRecords().length>0,t.inputState.compositionFirstChange=null,Vi.chrome&&Vi.android?t.observer.flushSoon():t.inputState.compositionPendingChange?Promise.resolve().then(()=>t.observer.flush()):setTimeout(()=>{t.inputState.composing<0&&t.docView.hasComposition&&t.update([])},50))};$c.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()};Su.beforeinput=(t,e)=>{var i,n;if(e.inputType=="insertReplacementText"&&t.observer.editContext){let s=(i=e.dataTransfer)===null||i===void 0?void 0:i.getData("text/plain"),o=e.getTargetRanges();if(s&&o.length){let a=o[0],l=t.posAtDOM(a.startContainer,a.startOffset),u=t.posAtDOM(a.endContainer,a.endOffset);return pG(t,{from:l,to:u,insert:t.state.toText(s)},null),!0}}let r;if(Vi.chrome&&Vi.android&&(r=k7.find(s=>s.inputType==e.inputType))&&(t.observer.delayAndroidKey(r.key,r.keyCode),r.key=="Backspace"||r.key=="Delete")){let s=((n=window.visualViewport)===null||n===void 0?void 0:n.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>s+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())},100)}return Vi.ios&&e.inputType=="deleteContentForward"&&t.observer.flushSoon(),Vi.safari&&e.inputType=="insertText"&&t.inputState.composing>=0&&setTimeout(()=>$c.compositionend(t,e),20),!1};const p$=new Set;function ghe(t){p$.has(t)||(p$.add(t),t.addEventListener("copy",()=>{}),t.addEventListener("cut",()=>{}))}const m$=["pre-wrap","normal","pre-line","break-spaces"];let m0=!1;function g$(){m0=!1}class vhe{constructor(e){this.lineWrapping=e,this.doc=fr.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,i){let n=this.doc.lineAt(i).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(n+=Math.max(0,Math.ceil((i-e-n*this.lineLength*.5)/this.lineLength))),this.lineHeight*n}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return m$.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let i=!1;for(let n=0;n<e.length;n++){let r=e[n];r<0?n++:this.heightSamples[Math.floor(r*10)]||(i=!0,this.heightSamples[Math.floor(r*10)]=!0)}return i}refresh(e,i,n,r,s,o){let a=m$.indexOf(e)>-1,l=Math.round(i)!=Math.round(this.lineHeight)||this.lineWrapping!=a;if(this.lineWrapping=a,this.lineHeight=i,this.charWidth=n,this.textHeight=r,this.lineLength=s,l){this.heightSamples={};for(let u=0;u<o.length;u++){let d=o[u];d<0?u++:this.heightSamples[Math.floor(d*10)]=!0}}return l}}class yhe{constructor(e,i){this.from=e,this.heights=i,this.index=0}get more(){return this.index<this.heights.length}}class oh{constructor(e,i,n,r,s){this.from=e,this.length=i,this.top=n,this.height=r,this._content=s}get type(){return typeof this._content=="number"?Ga.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Cp?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let i=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new oh(this.from,this.length+e.length,this.top,this.height+e.height,i)}}var Zr=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(Zr||(Zr={}));const yM=.001;class Ua{constructor(e,i,n=2){this.length=e,this.height=i,this.flags=n}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>yM&&(m0=!0),this.height=e)}replace(e,i,n){return Ua.of(n)}decomposeLeft(e,i){i.push(this)}decomposeRight(e,i){i.push(this)}applyChanges(e,i,n,r){let s=this,o=n.doc;for(let a=r.length-1;a>=0;a--){let{fromA:l,toA:u,fromB:d,toB:p}=r[a],v=s.lineAt(l,Zr.ByPosNoHeight,n.setDoc(i),0,0),y=v.to>=u?v:s.lineAt(u,Zr.ByPosNoHeight,n,0,0);for(p+=y.to-u,u=y.to;a>0&&v.from<=r[a-1].toA;)l=r[a-1].fromA,d=r[a-1].fromB,a--,l<v.from&&(v=s.lineAt(l,Zr.ByPosNoHeight,n,0,0));d+=v.from-l,l=v.from;let w=mG.build(n.setDoc(o),e,d,p);s=YM(s,s.replace(l,u,w))}return s.updateHeight(n,0)}static empty(){return new Gl(0,0)}static of(e){if(e.length==1)return e[0];let i=0,n=e.length,r=0,s=0;for(;;)if(i==n)if(r>s*2){let a=e[i-1];a.break?e.splice(--i,1,a.left,null,a.right):e.splice(--i,1,a.left,a.right),n+=1+a.break,r-=a.size}else if(s>r*2){let a=e[n];a.break?e.splice(n,1,a.left,null,a.right):e.splice(n,1,a.left,a.right),n+=2+a.break,s-=a.size}else break;else if(r<s){let a=e[i++];a&&(r+=a.size)}else{let a=e[--n];a&&(s+=a.size)}let o=0;return e[i-1]==null?(o=1,i--):e[i]==null&&(o=1,n++),new xhe(Ua.of(e.slice(0,i)),o,Ua.of(e.slice(n)))}}function YM(t,e){return t==e?t:(t.constructor!=e.constructor&&(m0=!0),e)}Ua.prototype.size=1;class G7 extends Ua{constructor(e,i,n){super(e,i),this.deco=n}blockAt(e,i,n,r){return new oh(r,this.length,n,this.height,this.deco||0)}lineAt(e,i,n,r,s){return this.blockAt(0,n,r,s)}forEachLine(e,i,n,r,s,o){e<=s+this.length&&i>=s&&o(this.blockAt(0,n,r,s))}updateHeight(e,i=0,n=!1,r){return r&&r.from<=i&&r.more&&this.setHeight(r.heights[r.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Gl extends G7{constructor(e,i){super(e,i,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,i,n,r){return new oh(r,this.length,n,this.height,this.breaks)}replace(e,i,n){let r=n[0];return n.length==1&&(r instanceof Gl||r instanceof Ho&&r.flags&4)&&Math.abs(this.length-r.length)<10?(r instanceof Ho?r=new Gl(r.length,this.height):r.height=this.height,this.outdated||(r.outdated=!1),r):Ua.of(n)}updateHeight(e,i=0,n=!1,r){return r&&r.from<=i&&r.more?this.setHeight(r.heights[r.index++]):(n||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class Ho extends Ua{constructor(e){super(e,0)}heightMetrics(e,i){let n=e.doc.lineAt(i).number,r=e.doc.lineAt(i+this.length).number,s=r-n+1,o,a=0;if(e.lineWrapping){let l=Math.min(this.height,e.lineHeight*s);o=l/s,this.length>s+1&&(a=(this.height-l)/(this.length-s-1))}else o=this.height/s;return{firstLine:n,lastLine:r,perLine:o,perChar:a}}blockAt(e,i,n,r){let{firstLine:s,lastLine:o,perLine:a,perChar:l}=this.heightMetrics(i,r);if(i.lineWrapping){let u=r+(e<i.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-n)/this.height))*this.length)),d=i.doc.lineAt(u),p=a+d.length*l,v=Math.max(n,e-p/2);return new oh(d.from,d.length,v,p,0)}else{let u=Math.max(0,Math.min(o-s,Math.floor((e-n)/a))),{from:d,length:p}=i.doc.line(s+u);return new oh(d,p,n+a*u,a,0)}}lineAt(e,i,n,r,s){if(i==Zr.ByHeight)return this.blockAt(e,n,r,s);if(i==Zr.ByPosNoHeight){let{from:y,to:w}=n.doc.lineAt(e);return new oh(y,w-y,0,0,0)}let{firstLine:o,perLine:a,perChar:l}=this.heightMetrics(n,s),u=n.doc.lineAt(e),d=a+u.length*l,p=u.number-o,v=r+a*p+l*(u.from-s-p);return new oh(u.from,u.length,Math.max(r,Math.min(v,r+this.height-d)),d,0)}forEachLine(e,i,n,r,s,o){e=Math.max(e,s),i=Math.min(i,s+this.length);let{firstLine:a,perLine:l,perChar:u}=this.heightMetrics(n,s);for(let d=e,p=r;d<=i;){let v=n.doc.lineAt(d);if(d==e){let w=v.number-a;p+=l*w+u*(e-s-w)}let y=l+u*v.length;o(new oh(v.from,v.length,p,y,0)),p+=y,d=v.to+1}}replace(e,i,n){let r=this.length-i;if(r>0){let s=n[n.length-1];s instanceof Ho?n[n.length-1]=new Ho(s.length+r):n.push(null,new Ho(r-1))}if(e>0){let s=n[0];s instanceof Ho?n[0]=new Ho(e+s.length):n.unshift(new Ho(e-1),null)}return Ua.of(n)}decomposeLeft(e,i){i.push(new Ho(e-1),null)}decomposeRight(e,i){i.push(null,new Ho(this.length-e-1))}updateHeight(e,i=0,n=!1,r){let s=i+this.length;if(r&&r.from<=i+this.length&&r.more){let o=[],a=Math.max(i,r.from),l=-1;for(r.from>i&&o.push(new Ho(r.from-i-1).updateHeight(e,i));a<=s&&r.more;){let d=e.doc.lineAt(a).length;o.length&&o.push(null);let p=r.heights[r.index++];l==-1?l=p:Math.abs(p-l)>=yM&&(l=-2);let v=new Gl(d,p);v.outdated=!1,o.push(v),a+=d+1}a<=s&&o.push(null,new Ho(s-a).updateHeight(e,a));let u=Ua.of(o);return(l<0||Math.abs(u.height-this.height)>=yM||Math.abs(l-this.heightMetrics(e,i).perLine)>=yM)&&(m0=!0),YM(this,u)}else(n||this.outdated)&&(this.setHeight(e.heightForGap(i,i+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class xhe extends Ua{constructor(e,i,n){super(e.length+i+n.length,e.height+n.height,i|(e.outdated||n.outdated?2:0)),this.left=e,this.right=n,this.size=e.size+n.size}get break(){return this.flags&1}blockAt(e,i,n,r){let s=n+this.left.height;return e<s?this.left.blockAt(e,i,n,r):this.right.blockAt(e,i,s,r+this.left.length+this.break)}lineAt(e,i,n,r,s){let o=r+this.left.height,a=s+this.left.length+this.break,l=i==Zr.ByHeight?e<o:e<a,u=l?this.left.lineAt(e,i,n,r,s):this.right.lineAt(e,i,n,o,a);if(this.break||(l?u.to<a:u.from>a))return u;let d=i==Zr.ByPosNoHeight?Zr.ByPosNoHeight:Zr.ByPos;return l?u.join(this.right.lineAt(a,d,n,o,a)):this.left.lineAt(a,d,n,r,s).join(u)}forEachLine(e,i,n,r,s,o){let a=r+this.left.height,l=s+this.left.length+this.break;if(this.break)e<l&&this.left.forEachLine(e,i,n,r,s,o),i>=l&&this.right.forEachLine(e,i,n,a,l,o);else{let u=this.lineAt(l,Zr.ByPos,n,r,s);e<u.from&&this.left.forEachLine(e,u.from-1,n,r,s,o),u.to>=e&&u.from<=i&&o(u),i>u.to&&this.right.forEachLine(u.to+1,i,n,a,l,o)}}replace(e,i,n){let r=this.left.length+this.break;if(i<r)return this.balanced(this.left.replace(e,i,n),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-r,i-r,n));let s=[];e>0&&this.decomposeLeft(e,s);let o=s.length;for(let a of n)s.push(a);if(e>0&&v$(s,o-1),i<this.length){let a=s.length;this.decomposeRight(i,s),v$(s,a)}return Ua.of(s)}decomposeLeft(e,i){let n=this.left.length;if(e<=n)return this.left.decomposeLeft(e,i);i.push(this.left),this.break&&(n++,e>=n&&i.push(null)),e>n&&this.right.decomposeLeft(e-n,i)}decomposeRight(e,i){let n=this.left.length,r=n+this.break;if(e>=r)return this.right.decomposeRight(e-r,i);e<n&&this.left.decomposeRight(e,i),this.break&&e<r&&i.push(null),i.push(this.right)}balanced(e,i){return e.size>2*i.size||i.size>2*e.size?Ua.of(this.break?[e,null,i]:[e,i]):(this.left=YM(this.left,e),this.right=YM(this.right,i),this.setHeight(e.height+i.height),this.outdated=e.outdated||i.outdated,this.size=e.size+i.size,this.length=e.length+this.break+i.length,this)}updateHeight(e,i=0,n=!1,r){let{left:s,right:o}=this,a=i+s.length+this.break,l=null;return r&&r.from<=i+s.length&&r.more?l=s=s.updateHeight(e,i,n,r):s.updateHeight(e,i,n),r&&r.from<=a+o.length&&r.more?l=o=o.updateHeight(e,a,n,r):o.updateHeight(e,a,n),l?this.balanced(s,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function v$(t,e){let i,n;t[e]==null&&(i=t[e-1])instanceof Ho&&(n=t[e+1])instanceof Ho&&t.splice(e-1,3,new Ho(i.length+1+n.length))}const bhe=5;class mG{constructor(e,i){this.pos=e,this.oracle=i,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,i){if(this.lineStart>-1){let n=Math.min(i,this.lineEnd),r=this.nodes[this.nodes.length-1];r instanceof Gl?r.length+=n-this.pos:(n>this.pos||!this.isCovered)&&this.nodes.push(new Gl(n-this.pos,-1)),this.writtenTo=n,i>n&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=i}point(e,i,n){if(e<i||n.heightRelevant){let r=n.widget?n.widget.estimatedHeight:0,s=n.widget?n.widget.lineBreaks:0;r<0&&(r=this.oracle.lineHeight);let o=i-e;n.block?this.addBlock(new G7(o,r,n)):(o||s||r>=bhe)&&this.addLineDeco(r,s,o)}else i>e&&this.span(e,i);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:i}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=i,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new Gl(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,i){let n=new Ho(i-e);return this.oracle.doc.lineAt(e).to==i&&(n.flags|=4),n}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof Gl)return e;let i=new Gl(0,-1);return this.nodes.push(i),i}addBlock(e){this.enterLine();let i=e.deco;i&&i.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,i&&i.endSide>0&&(this.covering=e)}addLineDeco(e,i,n){let r=this.ensureLine();r.length+=n,r.collapsed+=n,r.widgetHeight=Math.max(r.widgetHeight,e),r.breaks+=i,this.writtenTo=this.pos=this.pos+n}finish(e){let i=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(i instanceof Gl)&&!this.isCovered?this.nodes.push(new Gl(0,-1)):(this.writtenTo<this.pos||i==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let n=e;for(let r of this.nodes)r instanceof Gl&&r.updateHeight(this.oracle,n),n+=r?r.length:1;return this.nodes}static build(e,i,n,r){let s=new mG(n,e);return ur.spans(i,n,r,s,0),s.finish(n)}}function whe(t,e,i){let n=new _he;return ur.compare(t,e,i,n,0),n.changes}class _he{constructor(){this.changes=[]}compareRange(){}comparePoint(e,i,n,r){(e<i||n&&n.heightRelevant||r&&r.heightRelevant)&&gM(e,i,this.changes,5)}}function Che(t,e){let i=t.getBoundingClientRect(),n=t.ownerDocument,r=n.defaultView||window,s=Math.max(0,i.left),o=Math.min(r.innerWidth,i.right),a=Math.max(0,i.top),l=Math.min(r.innerHeight,i.bottom);for(let u=t.parentNode;u&&u!=n.body;)if(u.nodeType==1){let d=u,p=window.getComputedStyle(d);if((d.scrollHeight>d.clientHeight||d.scrollWidth>d.clientWidth)&&p.overflow!="visible"){let v=d.getBoundingClientRect();s=Math.max(s,v.left),o=Math.min(o,v.right),a=Math.max(a,v.top),l=Math.min(u==t.parentNode?r.innerHeight:l,v.bottom)}u=p.position=="absolute"||p.position=="fixed"?d.offsetParent:d.parentNode}else if(u.nodeType==11)u=u.host;else break;return{left:s-i.left,right:Math.max(s,o)-i.left,top:a-(i.top+e),bottom:Math.max(a,l)-(i.top+e)}}function She(t){let e=t.getBoundingClientRect(),i=t.ownerDocument.defaultView||window;return e.left<i.innerWidth&&e.right>0&&e.top<i.innerHeight&&e.bottom>0}function Ohe(t,e){let i=t.getBoundingClientRect();return{left:0,right:i.right-i.left,top:e,bottom:i.bottom-(i.top+e)}}class bF{constructor(e,i,n,r){this.from=e,this.to=i,this.size=n,this.displaySize=r}static same(e,i){if(e.length!=i.length)return!1;for(let n=0;n<e.length;n++){let r=e[n],s=i[n];if(r.from!=s.from||r.to!=s.to||r.size!=s.size)return!1}return!0}draw(e,i){return an.replace({widget:new Mhe(this.displaySize*(i?e.scaleY:e.scaleX),i)}).range(this.from,this.to)}}class Mhe extends Nh{constructor(e,i){super(),this.size=e,this.vertical=i}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class y${constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=x$,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Yr.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let i=e.facet(hG).some(n=>typeof n!="function"&&n.class=="cm-lineWrapping");this.heightOracle=new vhe(i),this.stateDeco=e.facet(M_).filter(n=>typeof n!="function"),this.heightMap=Ua.empty().applyChanges(this.stateDeco,fr.empty,this.heightOracle.setDoc(e.doc),[new Nc(0,0,0,e.doc.length)]);for(let n=0;n<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());n++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=an.set(this.lineGaps.map(n=>n.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:i}=this.state.selection;for(let n=0;n<=1;n++){let r=n?i.head:i.anchor;if(!e.some(({from:s,to:o})=>r>=s&&r<=o)){let{from:s,to:o}=this.lineBlockAt(r);e.push(new M1(s,o))}}return this.viewports=e.sort((n,r)=>n.from-r.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?x$:new gG(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(gw(e,this.scaler))})}update(e,i=null){this.state=e.state;let n=this.stateDeco;this.stateDeco=this.state.facet(M_).filter(d=>typeof d!="function");let r=e.changedRanges,s=Nc.extendWithRanges(r,whe(n,this.stateDeco,e?e.changes:ao.empty(this.state.doc.length))),o=this.heightMap.height,a=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);g$(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),s),(this.heightMap.height!=o||m0)&&(e.flags|=2),a?(this.scrollAnchorPos=e.changes.mapPos(a.from,-1),this.scrollAnchorHeight=a.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let l=s.length?this.mapViewport(this.viewport,e.changes):this.viewport;(i&&(i.range.head<l.from||i.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,i));let u=l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,e.flags|=this.updateForViewport(),(u||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),i&&(this.scrollTarget=i),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(C7)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let i=e.contentDOM,n=window.getComputedStyle(i),r=this.heightOracle,s=n.whiteSpace;this.defaultTextDirection=n.direction=="rtl"?Yr.RTL:Yr.LTR;let o=this.heightOracle.mustRefreshForWrapping(s),a=i.getBoundingClientRect(),l=o||this.mustMeasureContent||this.contentDOMHeight!=a.height;this.contentDOMHeight=a.height,this.mustMeasureContent=!1;let u=0,d=0;if(a.width&&a.height){let{scaleX:k,scaleY:$}=XZ(i,a);(k>.005&&Math.abs(this.scaleX-k)>.005||$>.005&&Math.abs(this.scaleY-$)>.005)&&(this.scaleX=k,this.scaleY=$,u|=16,o=l=!0)}let p=(parseInt(n.paddingTop)||0)*this.scaleY,v=(parseInt(n.paddingBottom)||0)*this.scaleY;(this.paddingTop!=p||this.paddingBottom!=v)&&(this.paddingTop=p,this.paddingBottom=v,u|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(r.lineWrapping&&(l=!0),this.editorWidth=e.scrollDOM.clientWidth,u|=16);let y=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=y&&(this.scrollAnchorHeight=-1,this.scrollTop=y),this.scrolledToBottom=JZ(e.scrollDOM);let w=(this.printing?Ohe:Che)(i,this.paddingTop),R=w.top-this.pixelViewport.top,O=w.bottom-this.pixelViewport.bottom;this.pixelViewport=w;let P=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(P!=this.inView&&(this.inView=P,P&&(l=!0)),!this.inView&&!this.scrollTarget&&!She(e.dom))return 0;let N=a.width;if((this.contentDOMWidth!=N||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=a.width,this.editorHeight=e.scrollDOM.clientHeight,u|=16),l){let k=e.docView.measureVisibleLineHeights(this.viewport);if(r.mustRefreshForHeights(k)&&(o=!0),o||r.lineWrapping&&Math.abs(N-this.contentDOMWidth)>r.charWidth){let{lineHeight:$,charWidth:W,textHeight:Q}=e.docView.measureTextSize();o=$>0&&r.refresh(s,$,W,Q,N/W,k),o&&(e.docView.minWidth=0,u|=16)}R>0&&O>0?d=Math.max(R,O):R<0&&O<0&&(d=Math.min(R,O)),g$();for(let $ of this.viewports){let W=$.from==this.viewport.from?k:e.docView.measureVisibleLineHeights($);this.heightMap=(o?Ua.empty().applyChanges(this.stateDeco,fr.empty,this.heightOracle,[new Nc(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(r,0,o,new yhe($.from,W))}m0&&(u|=2)}let F=!this.viewportIsAppropriate(this.viewport,d)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return F&&(u&2&&(u|=this.updateScaler()),this.viewport=this.getViewport(d,this.scrollTarget),u|=this.updateForViewport()),(u&2||F)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,e)),u|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),u}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,i){let n=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),r=this.heightMap,s=this.heightOracle,{visibleTop:o,visibleBottom:a}=this,l=new M1(r.lineAt(o-n*1e3,Zr.ByHeight,s,0,0).from,r.lineAt(a+(1-n)*1e3,Zr.ByHeight,s,0,0).to);if(i){let{head:u}=i.range;if(u<l.from||u>l.to){let d=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),p=r.lineAt(u,Zr.ByPos,s,0,0),v;i.y=="center"?v=(p.top+p.bottom)/2-d/2:i.y=="start"||i.y=="nearest"&&u<l.from?v=p.top:v=p.bottom-d,l=new M1(r.lineAt(v-1e3/2,Zr.ByHeight,s,0,0).from,r.lineAt(v+d+1e3/2,Zr.ByHeight,s,0,0).to)}}return l}mapViewport(e,i){let n=i.mapPos(e.from,-1),r=i.mapPos(e.to,1);return new M1(this.heightMap.lineAt(n,Zr.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(r,Zr.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:i},n=0){if(!this.inView)return!0;let{top:r}=this.heightMap.lineAt(e,Zr.ByPos,this.heightOracle,0,0),{bottom:s}=this.heightMap.lineAt(i,Zr.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:a}=this;return(e==0||r<=o-Math.max(10,Math.min(-n,250)))&&(i==this.state.doc.length||s>=a+Math.max(10,Math.min(n,250)))&&r>o-2*1e3&&s<a+2*1e3}mapLineGaps(e,i){if(!e.length||i.empty)return e;let n=[];for(let r of e)i.touchesRange(r.from,r.to)||n.push(new bF(i.mapPos(r.from),i.mapPos(r.to),r.size,r.displaySize));return n}ensureLineGaps(e,i){let n=this.heightOracle.lineWrapping,r=n?1e4:2e3,s=r>>1,o=r<<1;if(this.defaultTextDirection!=Yr.LTR&&!n)return[];let a=[],l=(d,p,v,y)=>{if(p-d<s)return;let w=this.state.selection.main,R=[w.from];w.empty||R.push(w.to);for(let P of R)if(P>d&&P<p){l(d,P-10,v,y),l(P+10,p,v,y);return}let O=Rhe(e,P=>P.from>=v.from&&P.to<=v.to&&Math.abs(P.from-d)<s&&Math.abs(P.to-p)<s&&!R.some(N=>P.from<N&&P.to>N));if(!O){if(p<v.to&&i&&n&&i.visibleRanges.some(F=>F.from<=p&&F.to>=p)){let F=i.moveToLineBoundary(Kt.cursor(p),!1,!0).head;F>d&&(p=F)}let P=this.gapSize(v,d,p,y),N=n||P<2e6?P:2e6;O=new bF(d,p,P,N)}a.push(O)},u=d=>{if(d.length<o||d.type!=Ga.Text)return;let p=The(d.from,d.to,this.stateDeco);if(p.total<o)return;let v=this.scrollTarget?this.scrollTarget.range.head:null,y,w;if(n){let R=r/this.heightOracle.lineLength*this.heightOracle.lineHeight,O,P;if(v!=null){let N=R1(p,v),F=((this.visibleBottom-this.visibleTop)/2+R)/d.height;O=N-F,P=N+F}else O=(this.visibleTop-d.top-R)/d.height,P=(this.visibleBottom-d.top+R)/d.height;y=T1(p,O),w=T1(p,P)}else{let R=p.total*this.heightOracle.charWidth,O=r*this.heightOracle.charWidth,P=0;if(R>2e6)for(let W of e)W.from>=d.from&&W.from<d.to&&W.size!=W.displaySize&&W.from*this.heightOracle.charWidth+P<this.pixelViewport.left&&(P=W.size-W.displaySize);let N=this.pixelViewport.left+P,F=this.pixelViewport.right+P,k,$;if(v!=null){let W=R1(p,v),Q=((F-N)/2+O)/R;k=W-Q,$=W+Q}else k=(N-O)/R,$=(F+O)/R;y=T1(p,k),w=T1(p,$)}y>d.from&&l(d.from,y,d,p),w<d.to&&l(w,d.to,d,p)};for(let d of this.viewportLines)Array.isArray(d.type)?d.type.forEach(u):u(d);return a}gapSize(e,i,n,r){let s=R1(r,n)-R1(r,i);return this.heightOracle.lineWrapping?e.height*s:r.total*this.heightOracle.charWidth*s}updateLineGaps(e){bF.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=an.set(e.map(i=>i.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let i=this.stateDeco;this.lineGaps.length&&(i=i.concat(this.lineGapDeco));let n=[];ur.spans(i,this.viewport.from,this.viewport.to,{span(s,o){n.push({from:s,to:o})},point(){}},20);let r=0;if(n.length!=this.visibleRanges.length)r=12;else for(let s=0;s<n.length&&!(r&8);s++){let o=this.visibleRanges[s],a=n[s];(o.from!=a.from||o.to!=a.to)&&(r|=4,e&&e.mapPos(o.from,-1)==a.from&&e.mapPos(o.to,1)==a.to||(r|=8))}return this.visibleRanges=n,r}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(i=>i.from<=e&&i.to>=e)||gw(this.heightMap.lineAt(e,Zr.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(i=>i.top<=e&&i.bottom>=e)||gw(this.heightMap.lineAt(this.scaler.fromDOM(e),Zr.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let i=this.lineBlockAtHeight(e+8);return i.from>=this.viewport.from||this.viewportLines[0].top-e>200?i:this.viewportLines[0]}elementAtHeight(e){return gw(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class M1{constructor(e,i){this.from=e,this.to=i}}function The(t,e,i){let n=[],r=t,s=0;return ur.spans(i,t,e,{span(){},point(o,a){o>r&&(n.push({from:r,to:o}),s+=o-r),r=a}},20),r<e&&(n.push({from:r,to:e}),s+=e-r),{total:s,ranges:n}}function T1({total:t,ranges:e},i){if(i<=0)return e[0].from;if(i>=1)return e[e.length-1].to;let n=Math.floor(t*i);for(let r=0;;r++){let{from:s,to:o}=e[r],a=o-s;if(n<=a)return s+n;n-=a}}function R1(t,e){let i=0;for(let{from:n,to:r}of t.ranges){if(e<=r){i+=e-n;break}i+=r-n}return i/t.total}function Rhe(t,e){for(let i of t)if(e(i))return i}const x$={toDOM(t){return t},fromDOM(t){return t},scale:1,eq(t){return t==this}};class gG{constructor(e,i,n){let r=0,s=0,o=0;this.viewports=n.map(({from:a,to:l})=>{let u=i.lineAt(a,Zr.ByPos,e,0,0).top,d=i.lineAt(l,Zr.ByPos,e,0,0).bottom;return r+=d-u,{from:a,to:l,top:u,bottom:d,domTop:0,domBottom:0}}),this.scale=(7e6-r)/(i.height-r);for(let a of this.viewports)a.domTop=o+(a.top-s)*this.scale,o=a.domBottom=a.domTop+(a.bottom-a.top),s=a.bottom}toDOM(e){for(let i=0,n=0,r=0;;i++){let s=i<this.viewports.length?this.viewports[i]:null;if(!s||e<s.top)return r+(e-n)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);n=s.bottom,r=s.domBottom}}fromDOM(e){for(let i=0,n=0,r=0;;i++){let s=i<this.viewports.length?this.viewports[i]:null;if(!s||e<s.domTop)return n+(e-r)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);n=s.bottom,r=s.domBottom}}eq(e){return e instanceof gG?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((i,n)=>i.from==e.viewports[n].from&&i.to==e.viewports[n].to):!1}}function gw(t,e){if(e.scale==1)return t;let i=e.toDOM(t.top),n=e.toDOM(t.bottom);return new oh(t.from,t.length,i,n-i,Array.isArray(t._content)?t._content.map(r=>gw(r,e)):t._content)}const P1=Fi.define({combine:t=>t.join(" ")}),F3=Fi.define({combine:t=>t.indexOf(!0)>-1}),N3=_p.newName(),U7=_p.newName(),H7=_p.newName(),$7={"&light":"."+U7,"&dark":"."+H7};function B3(t,e,i){return new _p(e,{finish(n){return/&/.test(n)?n.replace(/&\w*/,r=>{if(r=="&")return t;if(!i||!i[r])throw new RangeError(`Unsupported selector: ${r}`);return i[r]}):t+" "+n}})}const Phe=B3("."+N3,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},$7),Ehe={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},wF=Vi.ie&&Vi.ie_version<=11;let Ahe=class{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new due,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(i=>{for(let n of i)this.queue.push(n);(Vi.ie&&Vi.ie_version<=11||Vi.ios&&e.composing)&&i.some(n=>n.type=="childList"&&n.removedNodes.length||n.type=="characterData"&&n.oldValue.length>n.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&e.constructor.EDIT_CONTEXT!==!1&&!(Vi.chrome&&Vi.chrome_version<126)&&(this.editContext=new khe(e),e.state.facet(xd)&&(e.contentDOM.editContext=this.editContext.editContext)),wF&&(this.onCharData=i=>{this.queue.push({target:i.target,type:"characterData",oldValue:i.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var i;((i=this.view.docView)===null||i===void 0?void 0:i.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(i=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),i.length>0&&i[i.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(i=>{i.length>0&&i[i.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((i,n)=>i!=e[n]))){this.gapIntersection.disconnect();for(let i of e)this.gapIntersection.observe(i);this.gaps=e}}onSelectionChange(e){let i=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:n}=this,r=this.selectionRange;if(n.state.facet(xd)?n.root.activeElement!=this.dom:!mM(this.dom,r))return;let s=r.anchorNode&&n.docView.nearest(r.anchorNode);if(s&&s.ignoreEvent(e)){i||(this.selectionChanged=!1);return}(Vi.ie&&Vi.ie_version<=11||Vi.android&&Vi.chrome)&&!n.state.selection.main.empty&&r.focusNode&&Bw(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,i=O_(e.root);if(!i)return!1;let n=Vi.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&Ihe(this.view,i)||i;if(!n||this.selectionRange.eq(n))return!1;let r=mM(this.dom,n);return r&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&pue(this.dom,n)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(n),r&&(this.selectionChanged=!0),!0)}setSelectionRange(e,i){this.selectionRange.set(e.node,e.offset,i.node,i.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,i=null;for(let n=this.dom;n;)if(n.nodeType==1)!i&&e<this.scrollTargets.length&&this.scrollTargets[e]==n?e++:i||(i=this.scrollTargets.slice(0,e)),i&&i.push(n),n=n.assignedSlot||n.parentNode;else if(n.nodeType==11)n=n.host;else break;if(e<this.scrollTargets.length&&!i&&(i=this.scrollTargets.slice(0,e)),i){for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);for(let n of this.scrollTargets=i)n.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Ehe),wF&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),wF&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,i){var n;if(!this.delayedAndroidKey){let r=()=>{let s=this.delayedAndroidKey;s&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=s.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&s.force&&Qy(this.dom,s.key,s.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(r)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:i,force:this.lastChange<Date.now()-50||!!(!((n=this.delayedAndroidKey)===null||n===void 0)&&n.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let i=-1,n=-1,r=!1;for(let s of e){let o=this.readMutation(s);o&&(o.typeOver&&(r=!0),i==-1?{from:i,to:n}=o:(i=Math.min(o.from,i),n=Math.max(o.to,n)))}return{from:i,to:n,typeOver:r}}readChange(){let{from:e,to:i,typeOver:n}=this.processRecords(),r=this.selectionChanged&&mM(this.dom,this.selectionRange);if(e<0&&!r)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let s=new Zue(this.view,e,i,n);return this.view.docView.domChanged={newSel:s.newSel?s.newSel.main:null},s}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let i=this.readChange();if(!i)return this.view.requestMeasure(),!1;let n=this.view.state,r=I7(this.view,i);return this.view.state==n&&(i.domChanged||i.newSel&&!i.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),r}readMutation(e){let i=this.view.docView.nearest(e.target);if(!i||i.ignoreMutation(e))return null;if(i.markDirty(e.type=="attributes"),e.type=="attributes"&&(i.flags|=4),e.type=="childList"){let n=b$(i,e.previousSibling||e.target.previousSibling,-1),r=b$(i,e.nextSibling||e.target.nextSibling,1);return{from:n?i.posAfter(n):i.posAtStart,to:r?i.posBefore(r):i.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:i.posAtStart,to:i.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(xd)!=e.state.facet(xd)&&(e.view.contentDOM.editContext=e.state.facet(xd)?this.editContext.editContext:null))}destroy(){var e,i,n;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(i=this.gapIntersection)===null||i===void 0||i.disconnect(),(n=this.resizeScroll)===null||n===void 0||n.disconnect();for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}};function b$(t,e,i){for(;e;){let n=Br.get(e);if(n&&n.parent==t)return n;let r=e.parentNode;e=r!=t.dom?r:i>0?e.nextSibling:e.previousSibling}return null}function w$(t,e){let i=e.startContainer,n=e.startOffset,r=e.endContainer,s=e.endOffset,o=t.docView.domAtPos(t.state.selection.main.anchor);return Bw(o.node,o.offset,r,s)&&([i,n,r,s]=[r,s,i,n]),{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:s}}function Ihe(t,e){if(e.getComposedRanges){let r=e.getComposedRanges(t.root)[0];if(r)return w$(t,r)}let i=null;function n(r){r.preventDefault(),r.stopImmediatePropagation(),i=r.getTargetRanges()[0]}return t.contentDOM.addEventListener("beforeinput",n,!0),t.dom.ownerDocument.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",n,!0),i?w$(t,i):null}class khe{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let i=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=n=>{let r=e.state.selection.main,{anchor:s,head:o}=r,a=this.toEditorPos(n.updateRangeStart),l=this.toEditorPos(n.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:n.updateRangeStart,editorBase:a,drifted:!1});let u={from:a,to:l,insert:fr.of(n.text.split(`
`))};if(u.from==this.from&&s<this.from?u.from=s:u.to==this.to&&s>this.to&&(u.to=s),u.from==u.to&&!u.insert.length){let d=Kt.single(this.toEditorPos(n.selectionStart),this.toEditorPos(n.selectionEnd));d.main.eq(r)||e.dispatch({selection:d,userEvent:"select"});return}if((Vi.mac||Vi.android)&&u.from==o-1&&/^\. ?$/.test(n.text)&&e.contentDOM.getAttribute("autocorrect")=="off"&&(u={from:a,to:l,insert:fr.of([n.text.replace("."," ")])}),this.pendingContextChange=u,!e.state.readOnly){let d=this.to-this.from+(u.to-u.from+u.insert.length);pG(e,u,Kt.single(this.toEditorPos(n.selectionStart,d),this.toEditorPos(n.selectionEnd,d)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state))},this.handlers.characterboundsupdate=n=>{let r=[],s=null;for(let o=this.toEditorPos(n.rangeStart),a=this.toEditorPos(n.rangeEnd);o<a;o++){let l=e.coordsForChar(o);s=l&&new DOMRect(l.left,l.top,l.right-l.left,l.bottom-l.top)||s||new DOMRect,r.push(s)}i.updateCharacterBounds(n.rangeStart,r)},this.handlers.textformatupdate=n=>{let r=[];for(let s of n.getTextFormats()){let o=s.underlineStyle,a=s.underlineThickness;if(o!="None"&&a!="None"){let l=this.toEditorPos(s.rangeStart),u=this.toEditorPos(s.rangeEnd);if(l<u){let d=`text-decoration: underline ${o=="Dashed"?"dashed ":o=="Squiggle"?"wavy ":""}${a=="Thin"?1:2}px`;r.push(an.mark({attributes:{style:d}}).range(l,u))}}}e.dispatch({effects:O7.of(an.set(r))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:n}=this.composing;this.composing=null,n&&this.reset(e.state)}};for(let n in this.handlers)i.addEventListener(n,this.handlers[n]);this.measureReq={read:n=>{this.editContext.updateControlBounds(n.contentDOM.getBoundingClientRect());let r=O_(n.root);r&&r.rangeCount&&this.editContext.updateSelectionBounds(r.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let i=0,n=!1,r=this.pendingContextChange;return e.changes.iterChanges((s,o,a,l,u)=>{if(n)return;let d=u.length-(o-s);if(r&&o>=r.to)if(r.from==s&&r.to==o&&r.insert.eq(u)){r=this.pendingContextChange=null,i+=d,this.to+=d;return}else r=null,this.revertPending(e.state);if(s+=i,o+=i,o<=this.from)this.from+=d,this.to+=d;else if(s<this.to){if(s<this.from||o>this.to||this.to-this.from+u.length>3e4){n=!0;return}this.editContext.updateText(this.toContextPos(s),this.toContextPos(o),u.toString()),this.to+=d}i+=d}),r&&!n&&this.revertPending(e.state),!n}update(e){let i=this.pendingContextChange,n=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(n.from,n.to)&&e.transactions.some(r=>!r.isUserEvent("input.type")&&r.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||i)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:i}=e.selection.main;this.from=Math.max(0,i-1e4),this.to=Math.min(e.doc.length,i+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let i=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(i.from),this.toContextPos(i.from+i.insert.length),e.doc.sliceString(i.from,i.to))}setSelection(e){let{main:i}=e.selection,n=this.toContextPos(Math.max(this.from,Math.min(this.to,i.anchor))),r=this.toContextPos(i.head);(this.editContext.selectionStart!=n||this.editContext.selectionEnd!=r)&&this.editContext.updateSelection(n,r)}rangeIsValid(e){let{head:i}=e.selection.main;return!(this.from>0&&i-this.from<500||this.to<e.doc.length&&this.to-i<500||this.to-this.from>1e4*3)}toEditorPos(e,i=this.to-this.from){e=Math.min(e,i);let n=this.composing;return n&&n.drifted?n.editorBase+(e-n.contextBase):e+this.from}toContextPos(e){let i=this.composing;return i&&i.drifted?i.contextBase+(e-i.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}let Li=class z3{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var i;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:n}=e;this.dispatchTransactions=e.dispatchTransactions||n&&(r=>r.forEach(s=>n(s,this)))||(r=>this.update(r)),this.dispatch=this.dispatch.bind(this),this._root=e.root||fue(e.parent)||document,this.viewState=new y$(e.state||xs.create(e)),e.scrollTo&&e.scrollTo.is(C1)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(fw).map(r=>new vF(r));for(let r of this.plugins)r.update(this);this.observer=new Ahe(this),this.inputState=new ehe(this),this.inputState.ensureHandlers(this.plugins),this.docView=new J4(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((i=document.fonts)===null||i===void 0)&&i.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...e){let i=e.length==1&&e[0]instanceof Va?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(i,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let i=!1,n=!1,r,s=this.state;for(let v of e){if(v.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=v.state}if(this.destroyed){this.viewState.state=s;return}let o=this.hasFocus,a=0,l=null;e.some(v=>v.annotation(B7))?(this.inputState.notifiedFocused=o,a=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,l=z7(s,o),l||(a=1));let u=this.observer.delayedAndroidKey,d=null;if(u?(this.observer.clearDelayedAndroidKey(),d=this.observer.readChange(),(d&&!this.state.doc.eq(s.doc)||!this.state.selection.eq(s.selection))&&(d=null)):this.observer.clear(),s.facet(xs.phrases)!=this.state.facet(xs.phrases))return this.setState(s);r=KM.create(this,s,e),r.flags|=a;let p=this.viewState.scrollTarget;try{this.updateState=2;for(let v of e){if(p&&(p=p.map(v.changes)),v.scrollIntoView){let{main:y}=v.state.selection;p=new Zy(y.empty?y:Kt.cursor(y.head,y.head>y.anchor?-1:1))}for(let y of v.effects)y.is(C1)&&(p=y.value.clip(this.state))}this.viewState.update(r,p),this.bidiCache=JM.update(this.bidiCache,r.changes),r.empty||(this.updatePlugins(r),this.inputState.update(r)),i=this.docView.update(r),this.state.facet(pw)!=this.styleModules&&this.mountStyles(),n=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(i,e.some(v=>v.isUserEvent("select.pointer")))}finally{this.updateState=0}if(r.startState.facet(P1)!=r.state.facet(P1)&&(this.viewState.mustMeasureContent=!0),(i||n||p||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),i&&this.docViewUpdate(),!r.empty)for(let v of this.state.facet(I3))try{v(r)}catch(y){fl(this.state,y,"update listener")}(l||d)&&Promise.resolve().then(()=>{l&&this.state==l.startState&&this.dispatch(l),d&&!I7(this,d)&&u.force&&Qy(this.contentDOM,u.key,u.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let i=this.hasFocus;try{for(let n of this.plugins)n.destroy(this);this.viewState=new y$(e),this.plugins=e.facet(fw).map(n=>new vF(n)),this.pluginMap.clear();for(let n of this.plugins)n.update(this);this.docView.destroy(),this.docView=new J4(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}i&&this.focus(),this.requestMeasure()}updatePlugins(e){let i=e.startState.facet(fw),n=e.state.facet(fw);if(i!=n){let r=[];for(let s of n){let o=i.indexOf(s);if(o<0)r.push(new vF(s));else{let a=this.plugins[o];a.mustUpdate=e,r.push(a)}}for(let s of this.plugins)s.mustUpdate!=e&&s.destroy(this);this.plugins=r,this.pluginMap.clear()}else for(let r of this.plugins)r.mustUpdate=e;for(let r=0;r<this.plugins.length;r++)this.plugins[r].update(this);i!=n&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let i=e.value;if(i&&i.docViewUpdate)try{i.docViewUpdate(this)}catch(n){fl(this.state,n,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let i=null,n=this.scrollDOM,r=n.scrollTop*this.scaleY,{scrollAnchorPos:s,scrollAnchorHeight:o}=this.viewState;Math.abs(r-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let a=0;;a++){if(o<0)if(JZ(n))s=-1,o=this.viewState.heightMap.height;else{let y=this.viewState.scrollAnchorAt(r);s=y.from,o=y.top}this.updateState=1;let l=this.viewState.measure(this);if(!l&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(a>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let u=[];l&4||([this.measureRequests,u]=[u,this.measureRequests]);let d=u.map(y=>{try{return y.read(this)}catch(w){return fl(this.state,w),_$}}),p=KM.create(this,this.state,[]),v=!1;p.flags|=l,i?i.flags|=l:i=p,this.updateState=2,p.empty||(this.updatePlugins(p),this.inputState.update(p),this.updateAttrs(),v=this.docView.update(p),v&&this.docViewUpdate());for(let y=0;y<u.length;y++)if(d[y]!=_$)try{let w=u[y];w.write&&w.write(d[y],this)}catch(w){fl(this.state,w)}if(v&&this.docView.updateSelection(!0),!p.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let w=(s<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(s).top)-o;if(w>1||w<-1){r=r+w,n.scrollTop=r/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(i&&!i.empty)for(let a of this.state.facet(I3))a(i)}get themeClasses(){return N3+" "+(this.state.facet(F3)?H7:U7)+" "+this.state.facet(P1)}updateAttrs(){let e=C$(this,M7,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),i={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(xd)?"true":"false",class:"cm-content",style:`${Vi.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(i["aria-readonly"]="true"),C$(this,hG,i);let n=this.observer.ignore(()=>{let r=T3(this.contentDOM,this.contentAttrs,i),s=T3(this.dom,this.editorAttrs,e);return r||s});return this.editorAttrs=e,this.contentAttrs=i,n}showAnnouncements(e){let i=!0;for(let n of e)for(let r of n.effects)if(r.is(z3.announce)){i&&(this.announceDOM.textContent=""),i=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=r.value}}mountStyles(){this.styleModules=this.state.facet(pw);let e=this.state.facet(z3.cspNonce);_p.mount(this.root,this.styleModules.concat(Phe).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let i=0;i<this.measureRequests.length;i++)if(this.measureRequests[i].key===e.key){this.measureRequests[i]=e;return}}this.measureRequests.push(e)}}plugin(e){let i=this.pluginMap.get(e);return(i===void 0||i&&i.spec!=e)&&this.pluginMap.set(e,i=this.plugins.find(n=>n.spec==e)||null),i&&i.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,i,n){return xF(this,e,r$(this,e,i,n))}moveByGroup(e,i){return xF(this,e,r$(this,e,i,n=>Wue(this,e.head,n)))}visualLineSide(e,i){let n=this.bidiSpans(e),r=this.textDirectionAt(e.from),s=n[i?n.length-1:0];return Kt.cursor(s.side(i,r)+e.from,s.forward(!i,r)?1:-1)}moveToLineBoundary(e,i,n=!0){return $ue(this,e,i,n)}moveVertically(e,i,n){return xF(this,e,que(this,e,i,n))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,i=0){return this.docView.posFromDOM(e,i)}posAtCoords(e,i=!0){return this.readMeasured(),A7(this,e,i)}coordsAtPos(e,i=1){this.readMeasured();let n=this.docView.coordsAt(e,i);if(!n||n.left==n.right)return n;let r=this.state.doc.lineAt(e),s=this.bidiSpans(r),o=s[ap.find(s,e-r.from,-1,i)];return CC(n,o.dir==Yr.LTR==i>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(_7)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>Dhe)return p7(e.length);let i=this.textDirectionAt(e.from),n;for(let s of this.bidiCache)if(s.from==e.from&&s.dir==i&&(s.fresh||f7(s.isolates,n=Y4(this,e))))return s.order;n||(n=Y4(this,e));let r=Rue(e.text,i,n);return this.bidiCache.push(new JM(e.from,e.to,i,n,!0,r)),r}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||Vi.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{KZ(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,i={}){return C1.of(new Zy(typeof e=="number"?Kt.cursor(e):e,i.y,i.x,i.yMargin,i.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:i}=this.scrollDOM,n=this.viewState.scrollAnchorAt(e);return C1.of(new Zy(Kt.cursor(n.from),"start","start",n.top-e,i,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return $s.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return $s.define(()=>({}),{eventObservers:e})}static theme(e,i){let n=_p.newName(),r=[P1.of(n),pw.of(B3(`.${n}`,e))];return i&&i.dark&&r.push(F3.of(!0)),r}static baseTheme(e){return kp.lowest(pw.of(B3("."+N3,e,$7)))}static findFromDOM(e){var i;let n=e.querySelector(".cm-content"),r=n&&Br.get(n)||Br.get(e);return((i=r?.rootView)===null||i===void 0?void 0:i.view)||null}};Li.styleModule=pw;Li.inputHandler=b7;Li.clipboardInputFilter=cG;Li.clipboardOutputFilter=uG;Li.scrollHandler=S7;Li.focusChangeEffect=w7;Li.perLineTextDirection=_7;Li.exceptionSink=x7;Li.updateListener=I3;Li.editable=xd;Li.mouseSelectionStyle=y7;Li.dragMovesSelection=v7;Li.clickAddsSelectionRange=g7;Li.decorations=M_;Li.outerDecorations=T7;Li.atomicRanges=dG;Li.bidiIsolatedRanges=R7;Li.scrollMargins=P7;Li.darkTheme=F3;Li.cspNonce=Fi.define({combine:t=>t.length?t[0]:""});Li.contentAttributes=hG;Li.editorAttributes=M7;Li.lineWrapping=Li.contentAttributes.of({class:"cm-lineWrapping"});Li.announce=_n.define();const Dhe=4096,_$={};class JM{constructor(e,i,n,r,s,o){this.from=e,this.to=i,this.dir=n,this.isolates=r,this.fresh=s,this.order=o}static update(e,i){if(i.empty&&!e.some(s=>s.fresh))return e;let n=[],r=e.length?e[e.length-1].dir:Yr.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let o=e[s];o.dir==r&&!i.touchesRange(o.from,o.to)&&n.push(new JM(i.mapPos(o.from,1),i.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return n}}function C$(t,e,i){for(let n=t.state.facet(e),r=n.length-1;r>=0;r--){let s=n[r],o=typeof s=="function"?s(t):s;o&&M3(o,i)}return i}const Lhe=Vi.mac?"mac":Vi.windows?"win":Vi.linux?"linux":"key";function Fhe(t,e){const i=t.split(/-(?!$)/);let n=i[i.length-1];n=="Space"&&(n=" ");let r,s,o,a;for(let l=0;l<i.length-1;++l){const u=i[l];if(/^(cmd|meta|m)$/i.test(u))a=!0;else if(/^a(lt)?$/i.test(u))r=!0;else if(/^(c|ctrl|control)$/i.test(u))s=!0;else if(/^s(hift)?$/i.test(u))o=!0;else if(/^mod$/i.test(u))e=="mac"?a=!0:s=!0;else throw new Error("Unrecognized modifier name: "+u)}return r&&(n="Alt-"+n),s&&(n="Ctrl-"+n),a&&(n="Meta-"+n),o&&(n="Shift-"+n),n}function E1(t,e,i){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),i!==!1&&e.shiftKey&&(t="Shift-"+t),t}const Nhe=kp.default(Li.domEventHandlers({keydown(t,e){return q7(W7(e.state),t,e,"editor")}})),MC=Fi.define({enables:Nhe}),S$=new WeakMap;function W7(t){let e=t.facet(MC),i=S$.get(e);return i||S$.set(e,i=Vhe(e.reduce((n,r)=>n.concat(r),[]))),i}function Bhe(t,e,i){return q7(W7(t.state),e,t,i)}let ip=null;const zhe=4e3;function Vhe(t,e=Lhe){let i=Object.create(null),n=Object.create(null),r=(o,a)=>{let l=n[o];if(l==null)n[o]=a;else if(l!=a)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},s=(o,a,l,u,d)=>{var p,v;let y=i[o]||(i[o]=Object.create(null)),w=a.split(/ (?!$)/).map(P=>Fhe(P,e));for(let P=1;P<w.length;P++){let N=w.slice(0,P).join(" ");r(N,!0),y[N]||(y[N]={preventDefault:!0,stopPropagation:!1,run:[F=>{let k=ip={view:F,prefix:N,scope:o};return setTimeout(()=>{ip==k&&(ip=null)},zhe),!0}]})}let R=w.join(" ");r(R,!1);let O=y[R]||(y[R]={preventDefault:!1,stopPropagation:!1,run:((v=(p=y._any)===null||p===void 0?void 0:p.run)===null||v===void 0?void 0:v.slice())||[]});l&&O.run.push(l),u&&(O.preventDefault=!0),d&&(O.stopPropagation=!0)};for(let o of t){let a=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let u of a){let d=i[u]||(i[u]=Object.create(null));d._any||(d._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:p}=o;for(let v in d)d[v].run.push(y=>p(y,V3))}let l=o[e]||o.key;if(l)for(let u of a)s(u,l,o.run,o.preventDefault,o.stopPropagation),o.shift&&s(u,"Shift-"+l,o.shift,o.preventDefault,o.stopPropagation)}return i}let V3=null;function q7(t,e,i,n){V3=e;let r=ZZ(e),s=al(r,0),o=sh(s)==r.length&&r!=" ",a="",l=!1,u=!1,d=!1;ip&&ip.view==i&&ip.scope==n&&(a=ip.prefix+" ",D7.indexOf(e.keyCode)<0&&(u=!0,ip=null));let p=new Set,v=O=>{if(O){for(let P of O.run)if(!p.has(P)&&(p.add(P),P(i)))return O.stopPropagation&&(d=!0),!0;O.preventDefault&&(O.stopPropagation&&(d=!0),u=!0)}return!1},y=t[n],w,R;return y&&(v(y[a+E1(r,e,!o)])?l=!0:o&&(e.altKey||e.metaKey||e.ctrlKey)&&!(Vi.windows&&e.ctrlKey&&e.altKey)&&(w=Gd[e.keyCode])&&w!=r?(v(y[a+E1(w,e,!0)])||e.shiftKey&&(R=S_[e.keyCode])!=r&&R!=w&&v(y[a+E1(R,e,!1)]))&&(l=!0):o&&e.shiftKey&&v(y[a+E1(r,e,!0)])&&(l=!0),!l&&v(y._any)&&(l=!0)),u&&(l=!0),l&&d&&e.stopPropagation(),V3=null,l}class TC{constructor(e,i,n,r,s){this.className=e,this.left=i,this.top=n,this.width=r,this.height=s}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,i){return i.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,i,n){if(n.empty){let r=e.coordsAtPos(n.head,n.assoc||1);if(!r)return[];let s=j7(e);return[new TC(i,r.left-s.left,r.top-s.top,null,r.bottom-r.top)]}else return Ghe(e,i,n)}}function j7(t){let e=t.scrollDOM.getBoundingClientRect();return{left:(t.textDirection==Yr.LTR?e.left:e.right-t.scrollDOM.clientWidth*t.scaleX)-t.scrollDOM.scrollLeft*t.scaleX,top:e.top-t.scrollDOM.scrollTop*t.scaleY}}function O$(t,e,i,n){let r=t.coordsAtPos(e,i*2);if(!r)return n;let s=t.dom.getBoundingClientRect(),o=(r.top+r.bottom)/2,a=t.posAtCoords({x:s.left+1,y:o}),l=t.posAtCoords({x:s.right-1,y:o});return a==null||l==null?n:{from:Math.max(n.from,Math.min(a,l)),to:Math.min(n.to,Math.max(a,l))}}function Ghe(t,e,i){if(i.to<=t.viewport.from||i.from>=t.viewport.to)return[];let n=Math.max(i.from,t.viewport.from),r=Math.min(i.to,t.viewport.to),s=t.textDirection==Yr.LTR,o=t.contentDOM,a=o.getBoundingClientRect(),l=j7(t),u=o.querySelector(".cm-line"),d=u&&window.getComputedStyle(u),p=a.left+(d?parseInt(d.paddingLeft)+Math.min(0,parseInt(d.textIndent)):0),v=a.right-(d?parseInt(d.paddingRight):0),y=D3(t,n),w=D3(t,r),R=y.type==Ga.Text?y:null,O=w.type==Ga.Text?w:null;if(R&&(t.lineWrapping||y.widgetLineBreaks)&&(R=O$(t,n,1,R)),O&&(t.lineWrapping||w.widgetLineBreaks)&&(O=O$(t,r,-1,O)),R&&O&&R.from==O.from&&R.to==O.to)return N(F(i.from,i.to,R));{let $=R?F(i.from,null,R):k(y,!1),W=O?F(null,i.to,O):k(w,!0),Q=[];return(R||y).to<(O||w).from-(R&&O?1:0)||y.widgetLineBreaks>1&&$.bottom+t.defaultLineHeight/2<W.top?Q.push(P(p,$.bottom,v,W.top)):$.bottom<W.top&&t.elementAtHeight(($.bottom+W.top)/2).type==Ga.Text&&($.bottom=W.top=($.bottom+W.top)/2),N($).concat(Q).concat(N(W))}function P($,W,Q,Y){return new TC(e,$-l.left,W-l.top,Q-$,Y-W)}function N({top:$,bottom:W,horizontal:Q}){let Y=[];for(let M=0;M<Q.length;M+=2)Y.push(P(Q[M],$,Q[M+1],W));return Y}function F($,W,Q){let Y=1e9,M=-1e9,D=[];function G(ie,le,me,be,fe){let Fe=t.coordsAtPos(ie,ie==Q.to?-2:2),He=t.coordsAtPos(me,me==Q.from?2:-2);!Fe||!He||(Y=Math.min(Fe.top,He.top,Y),M=Math.max(Fe.bottom,He.bottom,M),fe==Yr.LTR?D.push(s&&le?p:Fe.left,s&&be?v:He.right):D.push(!s&&be?p:He.left,!s&&le?v:Fe.right))}let j=$??Q.from,Z=W??Q.to;for(let ie of t.visibleRanges)if(ie.to>j&&ie.from<Z)for(let le=Math.max(ie.from,j),me=Math.min(ie.to,Z);;){let be=t.state.doc.lineAt(le);for(let fe of t.bidiSpans(be)){let Fe=fe.from+be.from,He=fe.to+be.from;if(Fe>=me)break;He>le&&G(Math.max(Fe,le),$==null&&Fe<=j,Math.min(He,me),W==null&&He>=Z,fe.dir)}if(le=be.to+1,le>=me)break}return D.length==0&&G(j,$==null,Z,W==null,t.textDirection),{top:Y,bottom:M,horizontal:D}}function k($,W){let Q=a.top+(W?$.top:$.bottom);return{top:Q,bottom:Q,horizontal:[]}}}function Uhe(t,e){return t.constructor==e.constructor&&t.eq(e)}class Hhe{constructor(e,i){this.view=e,this.layer=i,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),i.above&&this.dom.classList.add("cm-layer-above"),i.class&&this.dom.classList.add(i.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),i.mount&&i.mount(this.dom,e)}update(e){e.startState.facet(xM)!=e.state.facet(xM)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){this.layer.updateOnDocViewUpdate!==!1&&e.requestMeasure(this.measureReq)}setOrder(e){let i=0,n=e.facet(xM);for(;i<n.length&&n[i]!=this.layer;)i++;this.dom.style.zIndex=String((this.layer.above?150:-1)-i)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:i}=this.view;(e!=this.scaleX||i!=this.scaleY)&&(this.scaleX=e,this.scaleY=i,this.dom.style.transform=`scale(${1/e}, ${1/i})`)}draw(e){if(e.length!=this.drawn.length||e.some((i,n)=>!Uhe(i,this.drawn[n]))){let i=this.dom.firstChild,n=0;for(let r of e)r.update&&i&&r.constructor&&this.drawn[n].constructor&&r.update(i,this.drawn[n])?(i=i.nextSibling,n++):this.dom.insertBefore(r.draw(),i);for(;i;){let r=i.nextSibling;i.remove(),i=r}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const xM=Fi.define();function Q7(t){return[$s.define(e=>new Hhe(e,t)),xM.of(t)]}const T_=Fi.define({combine(t){return Fh(t,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,i)=>Math.min(e,i),drawRangeCursor:(e,i)=>e||i})}});function $he(t={}){return[T_.of(t),Whe,qhe,jhe,C7.of(!0)]}function Z7(t){return t.startState.facet(T_)!=t.state.facet(T_)}const Whe=Q7({above:!0,markers(t){let{state:e}=t,i=e.facet(T_),n=[];for(let r of e.selection.ranges){let s=r==e.selection.main;if(r.empty||i.drawRangeCursor){let o=s?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",a=r.empty?r:Kt.cursor(r.head,r.head>r.anchor?-1:1);for(let l of TC.forRange(t,o,a))n.push(l)}}return n},update(t,e){t.transactions.some(n=>n.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let i=Z7(t);return i&&M$(t.state,e),t.docChanged||t.selectionSet||i},mount(t,e){M$(e.state,t)},class:"cm-cursorLayer"});function M$(t,e){e.style.animationDuration=t.facet(T_).cursorBlinkRate+"ms"}const qhe=Q7({above:!1,markers(t){return t.state.selection.ranges.map(e=>e.empty?[]:TC.forRange(t,"cm-selectionBackground",e)).reduce((e,i)=>e.concat(i))},update(t,e){return t.docChanged||t.selectionSet||t.viewportChanged||Z7(t)},class:"cm-selectionLayer"}),jhe=kp.highest(Li.theme({".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-content":{caretColor:"transparent !important","& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}})),X7=_n.define({map(t,e){return t==null?null:e.mapPos(t)}}),vw=Do.define({create(){return null},update(t,e){return t!=null&&(t=e.changes.mapPos(t)),e.effects.reduce((i,n)=>n.is(X7)?n.value:i,t)}}),Qhe=$s.fromClass(class{constructor(t){this.view=t,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(t){var e;let i=t.state.field(vw);i==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(t.startState.field(vw)!=i||t.docChanged||t.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:t}=this,e=t.state.field(vw),i=e!=null&&t.coordsAtPos(e);if(!i)return null;let n=t.scrollDOM.getBoundingClientRect();return{left:i.left-n.left+t.scrollDOM.scrollLeft*t.scaleX,top:i.top-n.top+t.scrollDOM.scrollTop*t.scaleY,height:i.bottom-i.top}}drawCursor(t){if(this.cursor){let{scaleX:e,scaleY:i}=this.view;t?(this.cursor.style.left=t.left/e+"px",this.cursor.style.top=t.top/i+"px",this.cursor.style.height=t.height/i+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(t){this.view.state.field(vw)!=t&&this.view.dispatch({effects:X7.of(t)})}},{eventObservers:{dragover(t){this.setDropPos(this.view.posAtCoords({x:t.clientX,y:t.clientY}))},dragleave(t){(t.target==this.view.contentDOM||!this.view.contentDOM.contains(t.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function Zhe(){return[vw,Qhe]}function T$(t,e,i,n,r){e.lastIndex=0;for(let s=t.iterRange(i,n),o=i,a;!s.next().done;o+=s.value.length)if(!s.lineBreak)for(;a=e.exec(s.value);)r(o+a.index,a)}function Xhe(t,e){let i=t.visibleRanges;if(i.length==1&&i[0].from==t.viewport.from&&i[0].to==t.viewport.to)return i;let n=[];for(let{from:r,to:s}of i)r=Math.max(t.state.doc.lineAt(r).from,r-e),s=Math.min(t.state.doc.lineAt(s).to,s+e),n.length&&n[n.length-1].to>=r?n[n.length-1].to=s:n.push({from:r,to:s});return n}class Khe{constructor(e){const{regexp:i,decoration:n,decorate:r,boundary:s,maxLength:o=1e3}=e;if(!i.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=i,r)this.addMatch=(a,l,u,d)=>r(d,u,u+a[0].length,a,l);else if(typeof n=="function")this.addMatch=(a,l,u,d)=>{let p=n(a,l,u);p&&d(u,u+a[0].length,p)};else if(n)this.addMatch=(a,l,u,d)=>d(u,u+a[0].length,n);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=s,this.maxLength=o}createDeco(e){let i=new Vd,n=i.add.bind(i);for(let{from:r,to:s}of Xhe(e,this.maxLength))T$(e.state.doc,this.regexp,r,s,(o,a)=>this.addMatch(a,e,o,n));return i.finish()}updateDeco(e,i){let n=1e9,r=-1;return e.docChanged&&e.changes.iterChanges((s,o,a,l)=>{l>=e.view.viewport.from&&a<=e.view.viewport.to&&(n=Math.min(a,n),r=Math.max(l,r))}),e.viewportMoved||r-n>1e3?this.createDeco(e.view):r>-1?this.updateRange(e.view,i.map(e.changes),n,r):i}updateRange(e,i,n,r){for(let s of e.visibleRanges){let o=Math.max(s.from,n),a=Math.min(s.to,r);if(a>o){let l=e.state.doc.lineAt(o),u=l.to<a?e.state.doc.lineAt(a):l,d=Math.max(s.from,l.from),p=Math.min(s.to,u.to);if(this.boundary){for(;o>l.from;o--)if(this.boundary.test(l.text[o-1-l.from])){d=o;break}for(;a<u.to;a++)if(this.boundary.test(u.text[a-u.from])){p=a;break}}let v=[],y,w=(R,O,P)=>v.push(P.range(R,O));if(l==u)for(this.regexp.lastIndex=d-l.from;(y=this.regexp.exec(l.text))&&y.index<p-l.from;)this.addMatch(y,e,y.index+l.from,w);else T$(e.state.doc,this.regexp,d,p,(R,O)=>this.addMatch(O,e,R,w));i=i.update({filterFrom:d,filterTo:p,filter:(R,O)=>R<d||O>p,add:v})}}return i}}const G3=/x/.unicode!=null?"gu":"g",Yhe=new RegExp(`[\0-\b
--ÂÂ­Øâââ\u2028\u2029â­â®â¦â§â©\uFEFFï¿¹-ï¿¼]`,G3),Jhe={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let _F=null;function ede(){var t;if(_F==null&&typeof document<"u"&&document.body){let e=document.body.style;_F=((t=e.tabSize)!==null&&t!==void 0?t:e.MozTabSize)!=null}return _F||!1}const bM=Fi.define({combine(t){let e=Fh(t,{render:null,specialChars:Yhe,addSpecialChars:null});return(e.replaceTabs=!ede())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,G3)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,G3)),e}});function tde(t={}){return[bM.of(t),ide()]}let R$=null;function ide(){return R$||(R$=$s.fromClass(class{constructor(t){this.view=t,this.decorations=an.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(t.state.facet(bM)),this.decorations=this.decorator.createDeco(t)}makeDecorator(t){return new Khe({regexp:t.specialChars,decoration:(e,i,n)=>{let{doc:r}=i.state,s=al(e[0],0);if(s==9){let o=r.lineAt(n),a=i.state.tabSize,l=X0(o.text,a,n-o.from);return an.replace({widget:new ode((a-l%a)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[s]||(this.decorationCache[s]=an.replace({widget:new sde(t,s)}))},boundary:t.replaceTabs?void 0:/[^]/})}update(t){let e=t.state.facet(bM);t.startState.facet(bM)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(t.view)):this.decorations=this.decorator.updateDeco(t,this.decorations)}},{decorations:t=>t.decorations}))}const nde="â¢";function rde(t){return t>=32?nde:t==10?"â¤":String.fromCharCode(9216+t)}class sde extends Nh{constructor(e,i){super(),this.options=e,this.code=i}eq(e){return e.code==this.code}toDOM(e){let i=rde(this.code),n=e.state.phrase("Control character")+" "+(Jhe[this.code]||"0x"+this.code.toString(16)),r=this.options.render&&this.options.render(this.code,n,i);if(r)return r;let s=document.createElement("span");return s.textContent=i,s.title=n,s.setAttribute("aria-label",n),s.className="cm-specialChar",s}ignoreEvent(){return!1}}class ode extends Nh{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function ade(){return cde}const lde=an.line({class:"cm-activeLine"}),cde=$s.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.docChanged||t.selectionSet)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=-1,i=[];for(let n of t.state.selection.ranges){let r=t.lineBlockAt(n.head);r.from>e&&(i.push(lde.range(r.from)),e=r.from)}return an.set(i)}},{decorations:t=>t.decorations});class ude extends Nh{constructor(e){super(),this.content=e}toDOM(e){let i=document.createElement("span");return i.className="cm-placeholder",i.style.pointerEvents="none",i.appendChild(typeof this.content=="string"?document.createTextNode(this.content):typeof this.content=="function"?this.content(e):this.content.cloneNode(!0)),typeof this.content=="string"?i.setAttribute("aria-label","placeholder "+this.content):i.setAttribute("aria-hidden","true"),i}coordsAt(e){let i=e.firstChild?d0(e.firstChild):[];if(!i.length)return null;let n=window.getComputedStyle(e.parentNode),r=CC(i[0],n.direction!="rtl"),s=parseInt(n.lineHeight);return r.bottom-r.top>s*1.5?{left:r.left,right:r.right,top:r.top,bottom:r.top+s}:r}ignoreEvent(){return!1}}function hde(t){return $s.fromClass(class{constructor(e){this.view=e,this.placeholder=t?an.set([an.widget({widget:new ude(t),side:1}).range(0)]):an.none}get decorations(){return this.view.state.doc.length?an.none:this.placeholder}},{decorations:e=>e.decorations})}const U3=2e3;function dde(t,e,i){let n=Math.min(e.line,i.line),r=Math.max(e.line,i.line),s=[];if(e.off>U3||i.off>U3||e.col<0||i.col<0){let o=Math.min(e.off,i.off),a=Math.max(e.off,i.off);for(let l=n;l<=r;l++){let u=t.doc.line(l);u.length<=a&&s.push(Kt.range(u.from+o,u.to+a))}}else{let o=Math.min(e.col,i.col),a=Math.max(e.col,i.col);for(let l=n;l<=r;l++){let u=t.doc.line(l),d=x3(u.text,o,t.tabSize,!0);if(d<0)s.push(Kt.cursor(u.to));else{let p=x3(u.text,a,t.tabSize);s.push(Kt.range(u.from+d,u.from+p))}}}return s}function fde(t,e){let i=t.coordsAtPos(t.viewport.from);return i?Math.round(Math.abs((i.left-e)/t.defaultCharacterWidth)):-1}function P$(t,e){let i=t.posAtCoords({x:e.clientX,y:e.clientY},!1),n=t.state.doc.lineAt(i),r=i-n.from,s=r>U3?-1:r==n.length?fde(t,e.clientX):X0(n.text,t.state.tabSize,i-n.from);return{line:n.number,col:s,off:r}}function pde(t,e){let i=P$(t,e),n=t.state.selection;return i?{update(r){if(r.docChanged){let s=r.changes.mapPos(r.startState.doc.line(i.line).from),o=r.state.doc.lineAt(s);i={line:o.number,col:i.col,off:Math.min(i.off,o.length)},n=n.map(r.changes)}},get(r,s,o){let a=P$(t,r);if(!a)return n;let l=dde(t.state,i,a);return l.length?o?Kt.create(l.concat(n.ranges)):Kt.create(l):n}}:null}function mde(t){let e=i=>i.altKey&&i.button==0;return Li.mouseSelectionStyle.of((i,n)=>e(n)?pde(i,n):null)}const gde={Alt:[18,t=>!!t.altKey],Control:[17,t=>!!t.ctrlKey],Shift:[16,t=>!!t.shiftKey],Meta:[91,t=>!!t.metaKey]},vde={style:"cursor: crosshair"};function yde(t={}){let[e,i]=gde[t.key||"Alt"],n=$s.fromClass(class{constructor(r){this.view=r,this.isDown=!1}set(r){this.isDown!=r&&(this.isDown=r,this.view.update([]))}},{eventObservers:{keydown(r){this.set(r.keyCode==e||i(r))},keyup(r){(r.keyCode==e||!i(r))&&this.set(!1)},mousemove(r){this.set(i(r))}}});return[n,Li.contentAttributes.of(r=>{var s;return!((s=r.plugin(n))===null||s===void 0)&&s.isDown?vde:null})]}const Fb="-10000px";class K7{constructor(e,i,n,r){this.facet=i,this.createTooltipView=n,this.removeTooltipView=r,this.input=e.state.facet(i),this.tooltips=this.input.filter(o=>o);let s=null;this.tooltipViews=this.tooltips.map(o=>s=n(o,s))}update(e,i){var n;let r=e.state.facet(this.facet),s=r.filter(l=>l);if(r===this.input){for(let l of this.tooltipViews)l.update&&l.update(e);return!1}let o=[],a=i?[]:null;for(let l=0;l<s.length;l++){let u=s[l],d=-1;if(u){for(let p=0;p<this.tooltips.length;p++){let v=this.tooltips[p];v&&v.create==u.create&&(d=p)}if(d<0)o[l]=this.createTooltipView(u,l?o[l-1]:null),a&&(a[l]=!!u.above);else{let p=o[l]=this.tooltipViews[d];a&&(a[l]=i[d]),p.update&&p.update(e)}}}for(let l of this.tooltipViews)o.indexOf(l)<0&&(this.removeTooltipView(l),(n=l.destroy)===null||n===void 0||n.call(l));return i&&(a.forEach((l,u)=>i[u]=l),i.length=a.length),this.input=r,this.tooltips=s,this.tooltipViews=o,!0}}function xde(t){let e=t.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:e.clientHeight,right:e.clientWidth}}const CF=Fi.define({combine:t=>{var e,i,n;return{position:Vi.ios?"absolute":((e=t.find(r=>r.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((i=t.find(r=>r.parent))===null||i===void 0?void 0:i.parent)||null,tooltipSpace:((n=t.find(r=>r.tooltipSpace))===null||n===void 0?void 0:n.tooltipSpace)||xde}}}),E$=new WeakMap,vG=$s.fromClass(class{constructor(t){this.view=t,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=t.state.facet(CF);this.position=e.position,this.parent=e.parent,this.classes=t.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new K7(t,yG,(i,n)=>this.createTooltip(i,n),i=>{this.resizeObserver&&this.resizeObserver.unobserve(i.dom),i.dom.remove()}),this.above=this.manager.tooltips.map(i=>!!i.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(i=>{Date.now()>this.lastTransaction-50&&i.length>0&&i[i.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),t.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let t of this.manager.tooltipViews)this.intersectionObserver.observe(t.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(t){t.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(t,this.above);e&&this.observeIntersection();let i=e||t.geometryChanged,n=t.state.facet(CF);if(n.position!=this.position&&!this.madeAbsolute){this.position=n.position;for(let r of this.manager.tooltipViews)r.dom.style.position=this.position;i=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let r of this.manager.tooltipViews)this.container.appendChild(r.dom);i=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);i&&this.maybeMeasure()}createTooltip(t,e){let i=t.create(this.view),n=e?e.dom:null;if(i.dom.classList.add("cm-tooltip"),t.arrow&&!i.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let r=document.createElement("div");r.className="cm-tooltip-arrow",i.dom.appendChild(r)}return i.dom.style.position=this.position,i.dom.style.top=Fb,i.dom.style.left="0px",this.container.insertBefore(i.dom,n),i.mount&&i.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(i.dom),i}destroy(){var t,e,i;this.view.win.removeEventListener("resize",this.measureSoon);for(let n of this.manager.tooltipViews)n.dom.remove(),(t=n.destroy)===null||t===void 0||t.call(n);this.parent&&this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(i=this.intersectionObserver)===null||i===void 0||i.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let t=1,e=1,i=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:s}=this.manager.tooltipViews[0];if(Vi.gecko)i=s.offsetParent!=this.container.ownerDocument.body;else if(s.style.top==Fb&&s.style.left=="0px"){let o=s.getBoundingClientRect();i=Math.abs(o.top+1e4)>1||Math.abs(o.left)>1}}if(i||this.position=="absolute")if(this.parent){let s=this.parent.getBoundingClientRect();s.width&&s.height&&(t=s.width/this.parent.offsetWidth,e=s.height/this.parent.offsetHeight)}else({scaleX:t,scaleY:e}=this.view.viewState);let n=this.view.scrollDOM.getBoundingClientRect(),r=fG(this.view);return{visible:{left:n.left+r.left,top:n.top+r.top,right:n.right-r.right,bottom:n.bottom-r.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((s,o)=>{let a=this.manager.tooltipViews[o];return a.getCoords?a.getCoords(s.pos):this.view.coordsAtPos(s.pos)}),size:this.manager.tooltipViews.map(({dom:s})=>s.getBoundingClientRect()),space:this.view.state.facet(CF).tooltipSpace(this.view),scaleX:t,scaleY:e,makeAbsolute:i}}writeMeasure(t){var e;if(t.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let a of this.manager.tooltipViews)a.dom.style.position="absolute"}let{visible:i,space:n,scaleX:r,scaleY:s}=t,o=[];for(let a=0;a<this.manager.tooltips.length;a++){let l=this.manager.tooltips[a],u=this.manager.tooltipViews[a],{dom:d}=u,p=t.pos[a],v=t.size[a];if(!p||l.clip!==!1&&(p.bottom<=Math.max(i.top,n.top)||p.top>=Math.min(i.bottom,n.bottom)||p.right<Math.max(i.left,n.left)-.1||p.left>Math.min(i.right,n.right)+.1)){d.style.top=Fb;continue}let y=l.arrow?u.dom.querySelector(".cm-tooltip-arrow"):null,w=y?7:0,R=v.right-v.left,O=(e=E$.get(u))!==null&&e!==void 0?e:v.bottom-v.top,P=u.offset||wde,N=this.view.textDirection==Yr.LTR,F=v.width>n.right-n.left?N?n.left:n.right-v.width:N?Math.max(n.left,Math.min(p.left-(y?14:0)+P.x,n.right-R)):Math.min(Math.max(n.left,p.left-R+(y?14:0)-P.x),n.right-R),k=this.above[a];!l.strictSide&&(k?p.top-O-w-P.y<n.top:p.bottom+O+w+P.y>n.bottom)&&k==n.bottom-p.bottom>p.top-n.top&&(k=this.above[a]=!k);let $=(k?p.top-n.top:n.bottom-p.bottom)-w;if($<O&&u.resize!==!1){if($<this.view.defaultLineHeight){d.style.top=Fb;continue}E$.set(u,O),d.style.height=(O=$)/s+"px"}else d.style.height&&(d.style.height="");let W=k?p.top-O-w-P.y:p.bottom+w+P.y,Q=F+R;if(u.overlap!==!0)for(let Y of o)Y.left<Q&&Y.right>F&&Y.top<W+O&&Y.bottom>W&&(W=k?Y.top-O-2-w:Y.bottom+w+2);if(this.position=="absolute"?(d.style.top=(W-t.parent.top)/s+"px",A$(d,(F-t.parent.left)/r)):(d.style.top=W/s+"px",A$(d,F/r)),y){let Y=p.left+(N?P.x:-P.x)-(F+14-7);y.style.left=Y/r+"px"}u.overlap!==!0&&o.push({left:F,top:W,right:Q,bottom:W+O}),d.classList.toggle("cm-tooltip-above",k),d.classList.toggle("cm-tooltip-below",!k),u.positioned&&u.positioned(t.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let t of this.manager.tooltipViews)t.dom.style.top=Fb}},{eventObservers:{scroll(){this.maybeMeasure()}}});function A$(t,e){let i=parseInt(t.style.left,10);(isNaN(i)||Math.abs(e-i)>1)&&(t.style.left=e+"px")}const bde=Li.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),wde={x:0,y:0},yG=Fi.define({enables:[vG,bde]}),eT=Fi.define({combine:t=>t.reduce((e,i)=>e.concat(i),[])});class oP{static create(e){return new oP(e)}constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new K7(e,eT,(i,n)=>this.createHostedView(i,n),i=>i.dom.remove())}createHostedView(e,i){let n=e.create(this.view);return n.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(n.dom,i?i.dom.nextSibling:this.dom.firstChild),this.mounted&&n.mount&&n.mount(this.view),n}mount(e){for(let i of this.manager.tooltipViews)i.mount&&i.mount(e);this.mounted=!0}positioned(e){for(let i of this.manager.tooltipViews)i.positioned&&i.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let i of this.manager.tooltipViews)(e=i.destroy)===null||e===void 0||e.call(i)}passProp(e){let i;for(let n of this.manager.tooltipViews){let r=n[e];if(r!==void 0){if(i===void 0)i=r;else if(i!==r)return}}return i}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const _de=yG.compute([eT],t=>{let e=t.facet(eT);return e.length===0?null:{pos:Math.min(...e.map(i=>i.pos)),end:Math.max(...e.map(i=>{var n;return(n=i.end)!==null&&n!==void 0?n:i.pos})),create:oP.create,above:e[0].above,arrow:e.some(i=>i.arrow)}});class Cde{constructor(e,i,n,r,s){this.view=e,this.source=i,this.field=n,this.setHover=r,this.hoverTime=s,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:e,lastMove:i}=this,n=e.docView.nearest(i.target);if(!n)return;let r,s=1;if(n instanceof op)r=n.posAtStart;else{if(r=e.posAtCoords(i),r==null)return;let a=e.coordsAtPos(r);if(!a||i.y<a.top||i.y>a.bottom||i.x<a.left-e.defaultCharacterWidth||i.x>a.right+e.defaultCharacterWidth)return;let l=e.bidiSpans(e.state.doc.lineAt(r)).find(d=>d.from<=r&&d.to>=r),u=l&&l.dir==Yr.RTL?-1:1;s=i.x<a.left?-u:u}let o=this.source(e,r,s);if(o?.then){let a=this.pending={pos:r};o.then(l=>{this.pending==a&&(this.pending=null,l&&!(Array.isArray(l)&&!l.length)&&e.dispatch({effects:this.setHover.of(Array.isArray(l)?l:[l])}))},l=>fl(e.state,l,"hover tooltip"))}else o&&!(Array.isArray(o)&&!o.length)&&e.dispatch({effects:this.setHover.of(Array.isArray(o)?o:[o])})}get tooltip(){let e=this.view.plugin(vG),i=e?e.manager.tooltips.findIndex(n=>n.create==oP.create):-1;return i>-1?e.manager.tooltipViews[i]:null}mousemove(e){var i,n;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:r,tooltip:s}=this;if(r.length&&s&&!Sde(s.dom,e)||this.pending){let{pos:o}=r[0]||this.pending,a=(n=(i=r[0])===null||i===void 0?void 0:i.end)!==null&&n!==void 0?n:o;(o==a?this.view.posAtCoords(this.lastMove)!=o:!Ode(this.view,o,a,e.clientX,e.clientY))&&(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:i}=this;if(i.length){let{tooltip:n}=this;n&&n.dom.contains(e.relatedTarget)?this.watchTooltipLeave(n.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(e){let i=n=>{e.removeEventListener("mouseleave",i),this.active.length&&!this.view.dom.contains(n.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};e.addEventListener("mouseleave",i)}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const A1=4;function Sde(t,e){let{left:i,right:n,top:r,bottom:s}=t.getBoundingClientRect(),o;if(o=t.querySelector(".cm-tooltip-arrow")){let a=o.getBoundingClientRect();r=Math.min(a.top,r),s=Math.max(a.bottom,s)}return e.clientX>=i-A1&&e.clientX<=n+A1&&e.clientY>=r-A1&&e.clientY<=s+A1}function Ode(t,e,i,n,r,s){let o=t.scrollDOM.getBoundingClientRect(),a=t.documentTop+t.documentPadding.top+t.contentHeight;if(o.left>n||o.right<n||o.top>r||Math.min(o.bottom,a)<r)return!1;let l=t.posAtCoords({x:n,y:r},!1);return l>=e&&l<=i}function Mde(t,e={}){let i=_n.define(),n=Do.define({create(){return[]},update(r,s){if(r.length&&(e.hideOnChange&&(s.docChanged||s.selection)?r=[]:e.hideOn&&(r=r.filter(o=>!e.hideOn(s,o))),s.docChanged)){let o=[];for(let a of r){let l=s.changes.mapPos(a.pos,-1,jo.TrackDel);if(l!=null){let u=Object.assign(Object.create(null),a);u.pos=l,u.end!=null&&(u.end=s.changes.mapPos(u.end)),o.push(u)}}r=o}for(let o of s.effects)o.is(i)&&(r=o.value),o.is(Tde)&&(r=[]);return r},provide:r=>eT.from(r)});return{active:n,extension:[n,$s.define(r=>new Cde(r,t,n,i,e.hoverTime||300)),_de]}}function Y7(t,e){let i=t.plugin(vG);if(!i)return null;let n=i.manager.tooltips.indexOf(e);return n<0?null:i.manager.tooltipViews[n]}const Tde=_n.define(),I$=Fi.define({combine(t){let e,i;for(let n of t)e=e||n.topContainer,i=i||n.bottomContainer;return{topContainer:e,bottomContainer:i}}});function R_(t,e){let i=t.plugin(J7),n=i?i.specs.indexOf(e):-1;return n>-1?i.panels[n]:null}const J7=$s.fromClass(class{constructor(t){this.input=t.state.facet(P_),this.specs=this.input.filter(i=>i),this.panels=this.specs.map(i=>i(t));let e=t.state.facet(I$);this.top=new I1(t,!0,e.topContainer),this.bottom=new I1(t,!1,e.bottomContainer),this.top.sync(this.panels.filter(i=>i.top)),this.bottom.sync(this.panels.filter(i=>!i.top));for(let i of this.panels)i.dom.classList.add("cm-panel"),i.mount&&i.mount()}update(t){let e=t.state.facet(I$);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new I1(t.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new I1(t.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let i=t.state.facet(P_);if(i!=this.input){let n=i.filter(l=>l),r=[],s=[],o=[],a=[];for(let l of n){let u=this.specs.indexOf(l),d;u<0?(d=l(t.view),a.push(d)):(d=this.panels[u],d.update&&d.update(t)),r.push(d),(d.top?s:o).push(d)}this.specs=n,this.panels=r,this.top.sync(s),this.bottom.sync(o);for(let l of a)l.dom.classList.add("cm-panel"),l.mount&&l.mount()}else for(let n of this.panels)n.update&&n.update(t)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:t=>Li.scrollMargins.of(e=>{let i=e.plugin(t);return i&&{top:i.top.scrollMargin(),bottom:i.bottom.scrollMargin()}})});class I1{constructor(e,i,n){this.view=e,this.top=i,this.container=n,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let i of this.panels)i.destroy&&e.indexOf(i)<0&&i.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let i=this.container||this.view.dom;i.insertBefore(this.dom,this.top?i.firstChild:null)}let e=this.dom.firstChild;for(let i of this.panels)if(i.dom.parentNode==this.dom){for(;e!=i.dom;)e=k$(e);e=e.nextSibling}else this.dom.insertBefore(i.dom,e);for(;e;)e=k$(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function k$(t){let e=t.nextSibling;return t.remove(),e}const P_=Fi.define({enables:J7});class Hd extends Tg{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Hd.prototype.elementClass="";Hd.prototype.toDOM=void 0;Hd.prototype.mapMode=jo.TrackBefore;Hd.prototype.startSide=Hd.prototype.endSide=-1;Hd.prototype.point=!0;const wM=Fi.define(),Rde=Fi.define(),Pde={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>ur.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Vw=Fi.define();function Ede(t){return[eX(),Vw.of(Object.assign(Object.assign({},Pde),t))]}const D$=Fi.define({combine:t=>t.some(e=>e)});function eX(t){return[Ade]}const Ade=$s.fromClass(class{constructor(t){this.view=t,this.prevViewport=t.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=t.state.facet(Vw).map(e=>new F$(t,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!t.state.facet(D$),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),t.scrollDOM.insertBefore(this.dom,t.contentDOM)}update(t){if(this.updateGutters(t)){let e=this.prevViewport,i=t.view.viewport,n=Math.min(e.to,i.to)-Math.max(e.from,i.from);this.syncGutters(n<(i.to-i.from)*.8)}t.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px"),this.view.state.facet(D$)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=t.view.viewport}syncGutters(t){let e=this.dom.nextSibling;t&&this.dom.remove();let i=ur.iter(this.view.state.facet(wM),this.view.viewport.from),n=[],r=this.gutters.map(s=>new Ide(s,this.view.viewport,-this.view.documentPadding.top));for(let s of this.view.viewportLineBlocks)if(n.length&&(n=[]),Array.isArray(s.type)){let o=!0;for(let a of s.type)if(a.type==Ga.Text&&o){H3(i,n,a.from);for(let l of r)l.line(this.view,a,n);o=!1}else if(a.widget)for(let l of r)l.widget(this.view,a)}else if(s.type==Ga.Text){H3(i,n,s.from);for(let o of r)o.line(this.view,s,n)}else if(s.widget)for(let o of r)o.widget(this.view,s);for(let s of r)s.finish();t&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(t){let e=t.startState.facet(Vw),i=t.state.facet(Vw),n=t.docChanged||t.heightChanged||t.viewportChanged||!ur.eq(t.startState.facet(wM),t.state.facet(wM),t.view.viewport.from,t.view.viewport.to);if(e==i)for(let r of this.gutters)r.update(t)&&(n=!0);else{n=!0;let r=[];for(let s of i){let o=e.indexOf(s);o<0?r.push(new F$(this.view,s)):(this.gutters[o].update(t),r.push(this.gutters[o]))}for(let s of this.gutters)s.dom.remove(),r.indexOf(s)<0&&s.destroy();for(let s of r)this.dom.appendChild(s.dom);this.gutters=r}return n}destroy(){for(let t of this.gutters)t.destroy();this.dom.remove()}},{provide:t=>Li.scrollMargins.of(e=>{let i=e.plugin(t);return!i||i.gutters.length==0||!i.fixed?null:e.textDirection==Yr.LTR?{left:i.dom.offsetWidth*e.scaleX}:{right:i.dom.offsetWidth*e.scaleX}})});function L$(t){return Array.isArray(t)?t:[t]}function H3(t,e,i){for(;t.value&&t.from<=i;)t.from==i&&e.push(t.value),t.next()}class Ide{constructor(e,i,n){this.gutter=e,this.height=n,this.i=0,this.cursor=ur.iter(e.markers,i.from)}addElement(e,i,n){let{gutter:r}=this,s=(i.top-this.height)/e.scaleY,o=i.height/e.scaleY;if(this.i==r.elements.length){let a=new tX(e,o,s,n);r.elements.push(a),r.dom.appendChild(a.dom)}else r.elements[this.i].update(e,o,s,n);this.height=i.bottom,this.i++}line(e,i,n){let r=[];H3(this.cursor,r,i.from),n.length&&(r=r.concat(n));let s=this.gutter.config.lineMarker(e,i,r);s&&r.unshift(s);let o=this.gutter;r.length==0&&!o.config.renderEmptyElements||this.addElement(e,i,r)}widget(e,i){let n=this.gutter.config.widgetMarker(e,i.widget,i),r=n?[n]:null;for(let s of e.state.facet(Rde)){let o=s(e,i.widget,i);o&&(r||(r=[])).push(o)}r&&this.addElement(e,i,r)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let i=e.elements.pop();e.dom.removeChild(i.dom),i.destroy()}}}class F${constructor(e,i){this.view=e,this.config=i,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let n in i.domEventHandlers)this.dom.addEventListener(n,r=>{let s=r.target,o;if(s!=this.dom&&this.dom.contains(s)){for(;s.parentNode!=this.dom;)s=s.parentNode;let l=s.getBoundingClientRect();o=(l.top+l.bottom)/2}else o=r.clientY;let a=e.lineBlockAtHeight(o-e.documentTop);i.domEventHandlers[n](e,a,r)&&r.preventDefault()});this.markers=L$(i.markers(e)),i.initialSpacer&&(this.spacer=new tX(e,0,0,[i.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let i=this.markers;if(this.markers=L$(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let r=this.config.updateSpacer(this.spacer.markers[0],e);r!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[r])}let n=e.view.viewport;return!ur.eq(this.markers,i,n.from,n.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class tX{constructor(e,i,n,r){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,i,n,r)}update(e,i,n,r){this.height!=i&&(this.height=i,this.dom.style.height=i+"px"),this.above!=n&&(this.dom.style.marginTop=(this.above=n)?n+"px":""),kde(this.markers,r)||this.setMarkers(e,r)}setMarkers(e,i){let n="cm-gutterElement",r=this.dom.firstChild;for(let s=0,o=0;;){let a=o,l=s<i.length?i[s++]:null,u=!1;if(l){let d=l.elementClass;d&&(n+=" "+d);for(let p=o;p<this.markers.length;p++)if(this.markers[p].compare(l)){a=p,u=!0;break}}else a=this.markers.length;for(;o<a;){let d=this.markers[o++];if(d.toDOM){d.destroy(r);let p=r.nextSibling;r.remove(),r=p}}if(!l)break;l.toDOM&&(u?r=r.nextSibling:this.dom.insertBefore(l.toDOM(e),r)),u&&o++}this.dom.className=n,this.markers=i}destroy(){this.setMarkers(null,[])}}function kde(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(!t[i].compare(e[i]))return!1;return!0}const Dde=Fi.define(),Lde=Fi.define(),By=Fi.define({combine(t){return Fh(t,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,i){let n=Object.assign({},e);for(let r in i){let s=n[r],o=i[r];n[r]=s?(a,l,u)=>s(a,l,u)||o(a,l,u):o}return n}})}});class SF extends Hd{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function OF(t,e){return t.state.facet(By).formatNumber(e,t.state)}const Fde=Vw.compute([By],t=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(Dde)},lineMarker(e,i,n){return n.some(r=>r.toDOM)?null:new SF(OF(e,e.state.doc.lineAt(i.from).number))},widgetMarker:(e,i,n)=>{for(let r of e.state.facet(Lde)){let s=r(e,i,n);if(s)return s}return null},lineMarkerChange:e=>e.startState.facet(By)!=e.state.facet(By),initialSpacer(e){return new SF(OF(e,N$(e.state.doc.lines)))},updateSpacer(e,i){let n=OF(i.view,N$(i.view.state.doc.lines));return n==e.number?e:new SF(n)},domEventHandlers:t.facet(By).domEventHandlers}));function Nde(t={}){return[By.of(t),eX(),Fde]}function N$(t){let e=9;for(;e<t;)e=e*10+9;return e}const Bde=new class extends Hd{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},zde=wM.compute(["selection"],t=>{let e=[],i=-1;for(let n of t.selection.ranges){let r=t.doc.lineAt(n.head).from;r>i&&(i=r,e.push(Bde.range(r)))}return ur.of(e)});function Vde(){return zde}const iX=1024;let Gde=0;class MF{constructor(e,i){this.from=e,this.to=i}}class jn{constructor(e={}){this.id=Gde++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Wc.match(e)),i=>{let n=e(i);return n===void 0?null:[this,n]}}}jn.closedBy=new jn({deserialize:t=>t.split(" ")});jn.openedBy=new jn({deserialize:t=>t.split(" ")});jn.group=new jn({deserialize:t=>t.split(" ")});jn.isolate=new jn({deserialize:t=>{if(t&&t!="rtl"&&t!="ltr"&&t!="auto")throw new RangeError("Invalid value for isolate: "+t);return t||"auto"}});jn.contextHash=new jn({perNode:!0});jn.lookAhead=new jn({perNode:!0});jn.mounted=new jn({perNode:!0});class tT{constructor(e,i,n){this.tree=e,this.overlay=i,this.parser=n}static get(e){return e&&e.props&&e.props[jn.mounted.id]}}const Ude=Object.create(null);let Wc=class nX{constructor(e,i,n,r=0){this.name=e,this.props=i,this.id=n,this.flags=r}static define(e){let i=e.props&&e.props.length?Object.create(null):Ude,n=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),r=new nX(e.name||"",i,e.id,n);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(r)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");i[s[0].id]=s[1]}}return r}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let i=this.prop(jn.group);return i?i.indexOf(e)>-1:!1}return this.id==e}static match(e){let i=Object.create(null);for(let n in e)for(let r of n.split(" "))i[r]=e[n];return n=>{for(let r=n.prop(jn.group),s=-1;s<(r?r.length:0);s++){let o=i[s<0?n.name:r[s]];if(o)return o}}}};Wc.none=new Wc("",Object.create(null),0,8);class xG{constructor(e){this.types=e;for(let i=0;i<e.length;i++)if(e[i].id!=i)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let i=[];for(let n of this.types){let r=null;for(let s of e){let o=s(n);o&&(r||(r=Object.assign({},n.props)),r[o[0].id]=o[1])}i.push(r?new Wc(n.name,r,n.id,n.flags):n)}return new xG(i)}}const k1=new WeakMap,B$=new WeakMap;var uo;(function(t){t[t.ExcludeBuffers=1]="ExcludeBuffers",t[t.IncludeAnonymous=2]="IncludeAnonymous",t[t.IgnoreMounts=4]="IgnoreMounts",t[t.IgnoreOverlays=8]="IgnoreOverlays"})(uo||(uo={}));class Js{constructor(e,i,n,r,s){if(this.type=e,this.children=i,this.positions=n,this.length=r,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,a]of s)this.props[typeof o=="number"?o:o.id]=a}}toString(){let e=tT.get(this);if(e&&!e.overlay)return e.tree.toString();let i="";for(let n of this.children){let r=n.toString();r&&(i&&(i+=","),i+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(i.length?"("+i+")":""):i}cursor(e=0){return new W3(this.topNode,e)}cursorAt(e,i=0,n=0){let r=k1.get(this)||this.topNode,s=new W3(r);return s.moveTo(e,i),k1.set(this,s._tree),s}get topNode(){return new bl(this,0,0,null)}resolve(e,i=0){let n=E_(k1.get(this)||this.topNode,e,i,!1);return k1.set(this,n),n}resolveInner(e,i=0){let n=E_(B$.get(this)||this.topNode,e,i,!0);return B$.set(this,n),n}resolveStack(e,i=0){return Wde(this,e,i)}iterate(e){let{enter:i,leave:n,from:r=0,to:s=this.length}=e,o=e.mode||0,a=(o&uo.IncludeAnonymous)>0;for(let l=this.cursor(o|uo.IncludeAnonymous);;){let u=!1;if(l.from<=s&&l.to>=r&&(!a&&l.type.isAnonymous||i(l)!==!1)){if(l.firstChild())continue;u=!0}for(;u&&n&&(a||!l.type.isAnonymous)&&n(l),!l.nextSibling();){if(!l.parent())return;u=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let i in this.props)e.push([+i,this.props[i]]);return e}balance(e={}){return this.children.length<=8?this:_G(Wc.none,this.children,this.positions,0,this.children.length,0,this.length,(i,n,r)=>new Js(this.type,i,n,r,this.propValues),e.makeTree||((i,n,r)=>new Js(Wc.none,i,n,r)))}static build(e){return qde(e)}}Js.empty=new Js(Wc.none,[],[],0);class bG{constructor(e,i){this.buffer=e,this.index=i}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new bG(this.buffer,this.index)}}class Sp{constructor(e,i,n){this.buffer=e,this.length=i,this.set=n}get type(){return Wc.none}toString(){let e=[];for(let i=0;i<this.buffer.length;)e.push(this.childString(i)),i=this.buffer[i+3];return e.join(",")}childString(e){let i=this.buffer[e],n=this.buffer[e+3],r=this.set.types[i],s=r.name;if(/\W/.test(s)&&!r.isError&&(s=JSON.stringify(s)),e+=4,n==e)return s;let o=[];for(;e<n;)o.push(this.childString(e)),e=this.buffer[e+3];return s+"("+o.join(",")+")"}findChild(e,i,n,r,s){let{buffer:o}=this,a=-1;for(let l=e;l!=i&&!(rX(s,r,o[l+1],o[l+2])&&(a=l,n>0));l=o[l+3]);return a}slice(e,i,n){let r=this.buffer,s=new Uint16Array(i-e),o=0;for(let a=e,l=0;a<i;){s[l++]=r[a++],s[l++]=r[a++]-n;let u=s[l++]=r[a++]-n;s[l++]=r[a++]-e,o=Math.max(o,u)}return new Sp(s,o,this.set)}}function rX(t,e,i,n){switch(t){case-2:return i<e;case-1:return n>=e&&i<e;case 0:return i<e&&n>e;case 1:return i<=e&&n>e;case 2:return n>e;case 4:return!0}}function E_(t,e,i,n){for(var r;t.from==t.to||(i<1?t.from>=e:t.from>e)||(i>-1?t.to<=e:t.to<e);){let o=!n&&t instanceof bl&&t.index<0?null:t.parent;if(!o)return t;t=o}let s=n?0:uo.IgnoreOverlays;if(n)for(let o=t,a=o.parent;a;o=a,a=o.parent)o instanceof bl&&o.index<0&&((r=a.enter(e,i,s))===null||r===void 0?void 0:r.from)!=o.from&&(t=a);for(;;){let o=t.enter(e,i,s);if(!o)return t;t=o}}class sX{cursor(e=0){return new W3(this,e)}getChild(e,i=null,n=null){let r=z$(this,e,i,n);return r.length?r[0]:null}getChildren(e,i=null,n=null){return z$(this,e,i,n)}resolve(e,i=0){return E_(this,e,i,!1)}resolveInner(e,i=0){return E_(this,e,i,!0)}matchContext(e){return $3(this.parent,e)}enterUnfinishedNodesBefore(e){let i=this.childBefore(e),n=this;for(;i;){let r=i.lastChild;if(!r||r.to!=i.to)break;r.type.isError&&r.from==r.to?(n=i,i=r.prevSibling):i=r}return n}get node(){return this}get next(){return this.parent}}class bl extends sX{constructor(e,i,n,r){super(),this._tree=e,this.from=i,this.index=n,this._parent=r}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,i,n,r,s=0){for(let o=this;;){for(let{children:a,positions:l}=o._tree,u=i>0?a.length:-1;e!=u;e+=i){let d=a[e],p=l[e]+o.from;if(rX(r,n,p,p+d.length)){if(d instanceof Sp){if(s&uo.ExcludeBuffers)continue;let v=d.findChild(0,d.buffer.length,i,n-p,r);if(v>-1)return new ch(new Hde(o,d,e,p),null,v)}else if(s&uo.IncludeAnonymous||!d.type.isAnonymous||wG(d)){let v;if(!(s&uo.IgnoreMounts)&&(v=tT.get(d))&&!v.overlay)return new bl(v.tree,p,e,o);let y=new bl(d,p,e,o);return s&uo.IncludeAnonymous||!y.type.isAnonymous?y:y.nextChild(i<0?d.children.length-1:0,i,n,r)}}}if(s&uo.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?e=o.index+i:e=i<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,i,n=0){let r;if(!(n&uo.IgnoreOverlays)&&(r=tT.get(this._tree))&&r.overlay){let s=e-this.from;for(let{from:o,to:a}of r.overlay)if((i>0?o<=s:o<s)&&(i<0?a>=s:a>s))return new bl(r.tree,r.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,i,n)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function z$(t,e,i,n){let r=t.cursor(),s=[];if(!r.firstChild())return s;if(i!=null){for(let o=!1;!o;)if(o=r.type.is(i),!r.nextSibling())return s}for(;;){if(n!=null&&r.type.is(n))return s;if(r.type.is(e)&&s.push(r.node),!r.nextSibling())return n==null?s:[]}}function $3(t,e,i=e.length-1){for(let n=t;i>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(e[i]&&e[i]!=n.name)return!1;i--}}return!0}class Hde{constructor(e,i,n,r){this.parent=e,this.buffer=i,this.index=n,this.start=r}}class ch extends sX{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,i,n){super(),this.context=e,this._parent=i,this.index=n,this.type=e.buffer.set.types[e.buffer.buffer[n]]}child(e,i,n){let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],e,i-this.context.start,n);return s<0?null:new ch(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,i,n=0){if(n&uo.ExcludeBuffers)return null;let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],i>0?1:-1,e-this.context.start,i);return s<0?null:new ch(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,i=e.buffer[this.index+3];return i<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new ch(this.context,this._parent,i):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,i=this._parent?this._parent.index+4:0;return this.index==i?this.externalSibling(-1):new ch(this.context,this._parent,e.findChild(i,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],i=[],{buffer:n}=this.context,r=this.index+4,s=n.buffer[this.index+3];if(s>r){let o=n.buffer[this.index+1];e.push(n.slice(r,s,o)),i.push(0)}return new Js(this.type,e,i,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function oX(t){if(!t.length)return null;let e=0,i=t[0];for(let s=1;s<t.length;s++){let o=t[s];(o.from>i.from||o.to<i.to)&&(i=o,e=s)}let n=i instanceof bl&&i.index<0?null:i.parent,r=t.slice();return n?r[e]=n:r.splice(e,1),new $de(r,i)}class $de{constructor(e,i){this.heads=e,this.node=i}get next(){return oX(this.heads)}}function Wde(t,e,i){let n=t.resolveInner(e,i),r=null;for(let s=n instanceof bl?n:n.context.parent;s;s=s.parent)if(s.index<0){let o=s.parent;(r||(r=[n])).push(o.resolve(e,i)),s=o}else{let o=tT.get(s.tree);if(o&&o.overlay&&o.overlay[0].from<=e&&o.overlay[o.overlay.length-1].to>=e){let a=new bl(o.tree,o.overlay[0].from+s.from,-1,s);(r||(r=[n])).push(E_(a,e,i,!1))}}return r?oX(r):n}class W3{get name(){return this.type.name}constructor(e,i=0){if(this.mode=i,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof bl)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let n=e._parent;n;n=n._parent)this.stack.unshift(n.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,i){this.index=e;let{start:n,buffer:r}=this.buffer;return this.type=i||r.set.types[r.buffer[e]],this.from=n+r.buffer[e+1],this.to=n+r.buffer[e+2],!0}yield(e){return e?e instanceof bl?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,i,n){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,i,n,this.mode));let{buffer:r}=this.buffer,s=r.findChild(this.index+4,r.buffer[this.index+3],e,i-this.buffer.start,n);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,i,n=this.mode){return this.buffer?n&uo.ExcludeBuffers?!1:this.enterChild(1,e,i):this.yield(this._tree.enter(e,i,n))}parent(){if(!this.buffer)return this.yieldNode(this.mode&uo.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&uo.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:i}=this.buffer,n=this.stack.length-1;if(e<0){let r=n<0?0:this.stack[n]+4;if(this.index!=r)return this.yieldBuf(i.findChild(r,this.index,-1,0,4))}else{let r=i.buffer[this.index+3];if(r<(n<0?i.buffer.length:i.buffer[this.stack[n]+3]))return this.yieldBuf(r)}return n<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let i,n,{buffer:r}=this;if(r){if(e>0){if(this.index<r.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(r.buffer.buffer[s+3]<this.index)return!1;({index:i,parent:n}=r)}else({index:i,_parent:n}=this._tree);for(;n;{index:i,_parent:n}=n)if(i>-1)for(let s=i+e,o=e<0?-1:n._tree.children.length;s!=o;s+=e){let a=n._tree.children[s];if(this.mode&uo.IncludeAnonymous||a instanceof Sp||!a.type.isAnonymous||wG(a))return!1}return!0}move(e,i){if(i&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,i=0){for(;(this.from==this.to||(i<1?this.from>=e:this.from>e)||(i>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,i););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,i=null,n=0;if(e&&e.context==this.buffer)e:for(let r=this.index,s=this.stack.length;s>=0;){for(let o=e;o;o=o._parent)if(o.index==r){if(r==this.index)return o;i=o,n=s+1;break e}r=this.stack[--s]}for(let r=n;r<this.stack.length;r++)i=new ch(this.buffer,i,this.stack[r]);return this.bufferNode=new ch(this.buffer,i,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,i){for(let n=0;;){let r=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){n++;continue}this.type.isAnonymous||(r=!0)}for(;;){if(r&&i&&i(this),r=this.type.isAnonymous,!n)return;if(this.nextSibling())break;this.parent(),n--,r=!0}}}matchContext(e){if(!this.buffer)return $3(this.node.parent,e);let{buffer:i}=this.buffer,{types:n}=i.set;for(let r=e.length-1,s=this.stack.length-1;r>=0;s--){if(s<0)return $3(this._tree,e,r);let o=n[i.buffer[this.stack[s]]];if(!o.isAnonymous){if(e[r]&&e[r]!=o.name)return!1;r--}}return!0}}function wG(t){return t.children.some(e=>e instanceof Sp||!e.type.isAnonymous||wG(e))}function qde(t){var e;let{buffer:i,nodeSet:n,maxBufferLength:r=iX,reused:s=[],minRepeatType:o=n.types.length}=t,a=Array.isArray(i)?new bG(i,i.length):i,l=n.types,u=0,d=0;function p($,W,Q,Y,M,D){let{id:G,start:j,end:Z,size:ie}=a,le=d,me=u;for(;ie<0;)if(a.next(),ie==-1){let je=s[G];Q.push(je),Y.push(j-$);return}else if(ie==-3){u=G;return}else if(ie==-4){d=G;return}else throw new RangeError(`Unrecognized record size: ${ie}`);let be=l[G],fe,Fe,He=j-$;if(Z-j<=r&&(Fe=O(a.pos-W,M))){let je=new Uint16Array(Fe.size-Fe.skip),qe=a.pos-Fe.size,ct=je.length;for(;a.pos>qe;)ct=P(Fe.start,je,ct);fe=new Sp(je,Z-Fe.start,n),He=Fe.start-$}else{let je=a.pos-ie;a.next();let qe=[],ct=[],Ge=G>=o?G:-1,Je=0,mt=Z;for(;a.pos>je;)Ge>=0&&a.id==Ge&&a.size>=0?(a.end<=mt-r&&(w(qe,ct,j,Je,a.end,mt,Ge,le,me),Je=qe.length,mt=a.end),a.next()):D>2500?v(j,je,qe,ct):p(j,je,qe,ct,Ge,D+1);if(Ge>=0&&Je>0&&Je<qe.length&&w(qe,ct,j,Je,j,mt,Ge,le,me),qe.reverse(),ct.reverse(),Ge>-1&&Je>0){let wt=y(be,me);fe=_G(be,qe,ct,0,qe.length,0,Z-j,wt,wt)}else fe=R(be,qe,ct,Z-j,le-Z,me)}Q.push(fe),Y.push(He)}function v($,W,Q,Y){let M=[],D=0,G=-1;for(;a.pos>W;){let{id:j,start:Z,end:ie,size:le}=a;if(le>4)a.next();else{if(G>-1&&Z<G)break;G<0&&(G=ie-r),M.push(j,Z,ie),D++,a.next()}}if(D){let j=new Uint16Array(D*4),Z=M[M.length-2];for(let ie=M.length-3,le=0;ie>=0;ie-=3)j[le++]=M[ie],j[le++]=M[ie+1]-Z,j[le++]=M[ie+2]-Z,j[le++]=le;Q.push(new Sp(j,M[2]-Z,n)),Y.push(Z-$)}}function y($,W){return(Q,Y,M)=>{let D=0,G=Q.length-1,j,Z;if(G>=0&&(j=Q[G])instanceof Js){if(!G&&j.type==$&&j.length==M)return j;(Z=j.prop(jn.lookAhead))&&(D=Y[G]+j.length+Z)}return R($,Q,Y,M,D,W)}}function w($,W,Q,Y,M,D,G,j,Z){let ie=[],le=[];for(;$.length>Y;)ie.push($.pop()),le.push(W.pop()+Q-M);$.push(R(n.types[G],ie,le,D-M,j-D,Z)),W.push(M-Q)}function R($,W,Q,Y,M,D,G){if(D){let j=[jn.contextHash,D];G=G?[j].concat(G):[j]}if(M>25){let j=[jn.lookAhead,M];G=G?[j].concat(G):[j]}return new Js($,W,Q,Y,G)}function O($,W){let Q=a.fork(),Y=0,M=0,D=0,G=Q.end-r,j={size:0,start:0,skip:0};e:for(let Z=Q.pos-$;Q.pos>Z;){let ie=Q.size;if(Q.id==W&&ie>=0){j.size=Y,j.start=M,j.skip=D,D+=4,Y+=4,Q.next();continue}let le=Q.pos-ie;if(ie<0||le<Z||Q.start<G)break;let me=Q.id>=o?4:0,be=Q.start;for(Q.next();Q.pos>le;){if(Q.size<0)if(Q.size==-3)me+=4;else break e;else Q.id>=o&&(me+=4);Q.next()}M=be,Y+=ie,D+=me}return(W<0||Y==$)&&(j.size=Y,j.start=M,j.skip=D),j.size>4?j:void 0}function P($,W,Q){let{id:Y,start:M,end:D,size:G}=a;if(a.next(),G>=0&&Y<o){let j=Q;if(G>4){let Z=a.pos-(G-4);for(;a.pos>Z;)Q=P($,W,Q)}W[--Q]=j,W[--Q]=D-$,W[--Q]=M-$,W[--Q]=Y}else G==-3?u=Y:G==-4&&(d=Y);return Q}let N=[],F=[];for(;a.pos>0;)p(t.start||0,t.bufferStart||0,N,F,-1,0);let k=(e=t.length)!==null&&e!==void 0?e:N.length?F[0]+N[0].length:0;return new Js(l[t.topID],N.reverse(),F.reverse(),k)}const V$=new WeakMap;function _M(t,e){if(!t.isAnonymous||e instanceof Sp||e.type!=t)return 1;let i=V$.get(e);if(i==null){i=1;for(let n of e.children){if(n.type!=t||!(n instanceof Js)){i=1;break}i+=_M(t,n)}V$.set(e,i)}return i}function _G(t,e,i,n,r,s,o,a,l){let u=0;for(let w=n;w<r;w++)u+=_M(t,e[w]);let d=Math.ceil(u*1.5/8),p=[],v=[];function y(w,R,O,P,N){for(let F=O;F<P;){let k=F,$=R[F],W=_M(t,w[F]);for(F++;F<P;F++){let Q=_M(t,w[F]);if(W+Q>=d)break;W+=Q}if(F==k+1){if(W>d){let Q=w[k];y(Q.children,Q.positions,0,Q.children.length,R[k]+N);continue}p.push(w[k])}else{let Q=R[F-1]+w[F-1].length-$;p.push(_G(t,w,R,k,F,$,Q,null,l))}v.push($+N-s)}}return y(e,i,n,r,0),(a||l)(p,v,o)}class jde{constructor(){this.map=new WeakMap}setBuffer(e,i,n){let r=this.map.get(e);r||this.map.set(e,r=new Map),r.set(i,n)}getBuffer(e,i){let n=this.map.get(e);return n&&n.get(i)}set(e,i){e instanceof ch?this.setBuffer(e.context.buffer,e.index,i):e instanceof bl&&this.map.set(e.tree,i)}get(e){return e instanceof ch?this.getBuffer(e.context.buffer,e.index):e instanceof bl?this.map.get(e.tree):void 0}cursorSet(e,i){e.buffer?this.setBuffer(e.buffer.buffer,e.index,i):this.map.set(e.tree,i)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class ag{constructor(e,i,n,r,s=!1,o=!1){this.from=e,this.to=i,this.tree=n,this.offset=r,this.open=(s?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,i=[],n=!1){let r=[new ag(0,e.length,e,0,!1,n)];for(let s of i)s.to>e.length&&r.push(s);return r}static applyChanges(e,i,n=128){if(!i.length)return e;let r=[],s=1,o=e.length?e[0]:null;for(let a=0,l=0,u=0;;a++){let d=a<i.length?i[a]:null,p=d?d.fromA:1e9;if(p-l>=n)for(;o&&o.from<p;){let v=o;if(l>=v.from||p<=v.to||u){let y=Math.max(v.from,l)-u,w=Math.min(v.to,p)-u;v=y>=w?null:new ag(y,w,v.tree,v.offset+u,a>0,!!d)}if(v&&r.push(v),o.to>p)break;o=s<e.length?e[s++]:null}if(!d)break;l=d.toA,u=d.toA-d.toB}return r}}let aX=class{startParse(e,i,n){return typeof e=="string"&&(e=new Qde(e)),n=n?n.length?n.map(r=>new MF(r.from,r.to)):[new MF(0,0)]:[new MF(0,e.length)],this.createParse(e,i||[],n)}parse(e,i,n){let r=this.startParse(e,i,n);for(;;){let s=r.advance();if(s)return s}}};class Qde{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,i){return this.string.slice(e,i)}}new jn({perNode:!0});let Zde=0;class Cc{constructor(e,i,n,r){this.name=e,this.set=i,this.base=n,this.modified=r,this.id=Zde++}toString(){let{name:e}=this;for(let i of this.modified)i.name&&(e=`${i.name}(${e})`);return e}static define(e,i){let n=typeof e=="string"?e:"?";if(e instanceof Cc&&(i=e),i?.base)throw new Error("Can not derive from a modified tag");let r=new Cc(n,[],null,[]);if(r.set.push(r),i)for(let s of i.set)r.set.push(s);return r}static defineModifier(e){let i=new iT(e);return n=>n.modified.indexOf(i)>-1?n:iT.get(n.base||n,n.modified.concat(i).sort((r,s)=>r.id-s.id))}}let Xde=0;class iT{constructor(e){this.name=e,this.instances=[],this.id=Xde++}static get(e,i){if(!i.length)return e;let n=i[0].instances.find(a=>a.base==e&&Kde(i,a.modified));if(n)return n;let r=[],s=new Cc(e.name,r,e,i);for(let a of i)a.instances.push(s);let o=Yde(i);for(let a of e.set)if(!a.modified.length)for(let l of o)r.push(iT.get(a,l));return s}}function Kde(t,e){return t.length==e.length&&t.every((i,n)=>i==e[n])}function Yde(t){let e=[[]];for(let i=0;i<t.length;i++)for(let n=0,r=e.length;n<r;n++)e.push(e[n].concat(t[i]));return e.sort((i,n)=>n.length-i.length)}function lX(t){let e=Object.create(null);for(let i in t){let n=t[i];Array.isArray(n)||(n=[n]);for(let r of i.split(" "))if(r){let s=[],o=2,a=r;for(let p=0;;){if(a=="..."&&p>0&&p+3==r.length){o=1;break}let v=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(a);if(!v)throw new RangeError("Invalid path: "+r);if(s.push(v[0]=="*"?"":v[0][0]=='"'?JSON.parse(v[0]):v[0]),p+=v[0].length,p==r.length)break;let y=r[p++];if(p==r.length&&y=="!"){o=0;break}if(y!="/")throw new RangeError("Invalid path: "+r);a=r.slice(p)}let l=s.length-1,u=s[l];if(!u)throw new RangeError("Invalid path: "+r);let d=new nT(n,o,l>0?s.slice(0,l):null);e[u]=d.sort(e[u])}}return cX.add(e)}const cX=new jn;class nT{constructor(e,i,n,r){this.tags=e,this.mode=i,this.context=n,this.next=r}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}nT.empty=new nT([],2,null);function uX(t,e){let i=Object.create(null);for(let s of t)if(!Array.isArray(s.tag))i[s.tag.id]=s.class;else for(let o of s.tag)i[o.id]=s.class;let{scope:n,all:r=null}=e||{};return{style:s=>{let o=r;for(let a of s)for(let l of a.set){let u=i[l.id];if(u){o=o?o+" "+u:u;break}}return o},scope:n}}function Jde(t,e){let i=null;for(let n of t){let r=n.style(e);r&&(i=i?i+" "+r:r)}return i}function efe(t,e,i,n=0,r=t.length){let s=new tfe(n,Array.isArray(e)?e:[e],i);s.highlightRange(t.cursor(),n,r,"",s.highlighters),s.flush(r)}class tfe{constructor(e,i,n){this.at=e,this.highlighters=i,this.span=n,this.class=""}startSpan(e,i){i!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=i)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,i,n,r,s){let{type:o,from:a,to:l}=e;if(a>=n||l<=i)return;o.isTop&&(s=this.highlighters.filter(y=>!y.scope||y.scope(o)));let u=r,d=ife(e)||nT.empty,p=Jde(s,d.tags);if(p&&(u&&(u+=" "),u+=p,d.mode==1&&(r+=(r?" ":"")+p)),this.startSpan(Math.max(i,a),u),d.opaque)return;let v=e.tree&&e.tree.prop(jn.mounted);if(v&&v.overlay){let y=e.node.enter(v.overlay[0].from+a,1),w=this.highlighters.filter(O=>!O.scope||O.scope(v.tree.type)),R=e.firstChild();for(let O=0,P=a;;O++){let N=O<v.overlay.length?v.overlay[O]:null,F=N?N.from+a:l,k=Math.max(i,P),$=Math.min(n,F);if(k<$&&R)for(;e.from<$&&(this.highlightRange(e,k,$,r,s),this.startSpan(Math.min($,e.to),u),!(e.to>=F||!e.nextSibling())););if(!N||F>n)break;P=N.to+a,P>i&&(this.highlightRange(y.cursor(),Math.max(i,N.from+a),Math.min(n,P),"",w),this.startSpan(Math.min(n,P),u))}R&&e.parent()}else if(e.firstChild()){v&&(r="");do if(!(e.to<=i)){if(e.from>=n)break;this.highlightRange(e,i,n,r,s),this.startSpan(Math.min(n,e.to),u)}while(e.nextSibling());e.parent()}}}function ife(t){let e=t.type.prop(cX);for(;e&&e.context&&!t.matchContext(e.context);)e=e.next;return e||null}const Ci=Cc.define,D1=Ci(),jf=Ci(),G$=Ci(jf),U$=Ci(jf),Qf=Ci(),L1=Ci(Qf),TF=Ci(Qf),Ku=Ci(),wm=Ci(Ku),qu=Ci(),ju=Ci(),q3=Ci(),Nb=Ci(q3),F1=Ci(),At={comment:D1,lineComment:Ci(D1),blockComment:Ci(D1),docComment:Ci(D1),name:jf,variableName:Ci(jf),typeName:G$,tagName:Ci(G$),propertyName:U$,attributeName:Ci(U$),className:Ci(jf),labelName:Ci(jf),namespace:Ci(jf),macroName:Ci(jf),literal:Qf,string:L1,docString:Ci(L1),character:Ci(L1),attributeValue:Ci(L1),number:TF,integer:Ci(TF),float:Ci(TF),bool:Ci(Qf),regexp:Ci(Qf),escape:Ci(Qf),color:Ci(Qf),url:Ci(Qf),keyword:qu,self:Ci(qu),null:Ci(qu),atom:Ci(qu),unit:Ci(qu),modifier:Ci(qu),operatorKeyword:Ci(qu),controlKeyword:Ci(qu),definitionKeyword:Ci(qu),moduleKeyword:Ci(qu),operator:ju,derefOperator:Ci(ju),arithmeticOperator:Ci(ju),logicOperator:Ci(ju),bitwiseOperator:Ci(ju),compareOperator:Ci(ju),updateOperator:Ci(ju),definitionOperator:Ci(ju),typeOperator:Ci(ju),controlOperator:Ci(ju),punctuation:q3,separator:Ci(q3),bracket:Nb,angleBracket:Ci(Nb),squareBracket:Ci(Nb),paren:Ci(Nb),brace:Ci(Nb),content:Ku,heading:wm,heading1:Ci(wm),heading2:Ci(wm),heading3:Ci(wm),heading4:Ci(wm),heading5:Ci(wm),heading6:Ci(wm),contentSeparator:Ci(Ku),list:Ci(Ku),quote:Ci(Ku),emphasis:Ci(Ku),strong:Ci(Ku),link:Ci(Ku),monospace:Ci(Ku),strikethrough:Ci(Ku),inserted:Ci(),deleted:Ci(),changed:Ci(),invalid:Ci(),meta:F1,documentMeta:Ci(F1),annotation:Ci(F1),processingInstruction:Ci(F1),definition:Cc.defineModifier("definition"),constant:Cc.defineModifier("constant"),function:Cc.defineModifier("function"),standard:Cc.defineModifier("standard"),local:Cc.defineModifier("local"),special:Cc.defineModifier("special")};for(let t in At){let e=At[t];e instanceof Cc&&(e.name=t)}uX([{tag:At.link,class:"tok-link"},{tag:At.heading,class:"tok-heading"},{tag:At.emphasis,class:"tok-emphasis"},{tag:At.strong,class:"tok-strong"},{tag:At.keyword,class:"tok-keyword"},{tag:At.atom,class:"tok-atom"},{tag:At.bool,class:"tok-bool"},{tag:At.url,class:"tok-url"},{tag:At.labelName,class:"tok-labelName"},{tag:At.inserted,class:"tok-inserted"},{tag:At.deleted,class:"tok-deleted"},{tag:At.literal,class:"tok-literal"},{tag:At.string,class:"tok-string"},{tag:At.number,class:"tok-number"},{tag:[At.regexp,At.escape,At.special(At.string)],class:"tok-string2"},{tag:At.variableName,class:"tok-variableName"},{tag:At.local(At.variableName),class:"tok-variableName tok-local"},{tag:At.definition(At.variableName),class:"tok-variableName tok-definition"},{tag:At.special(At.variableName),class:"tok-variableName2"},{tag:At.definition(At.propertyName),class:"tok-propertyName tok-definition"},{tag:At.typeName,class:"tok-typeName"},{tag:At.namespace,class:"tok-namespace"},{tag:At.className,class:"tok-className"},{tag:At.macroName,class:"tok-macroName"},{tag:At.propertyName,class:"tok-propertyName"},{tag:At.operator,class:"tok-operator"},{tag:At.comment,class:"tok-comment"},{tag:At.meta,class:"tok-meta"},{tag:At.invalid,class:"tok-invalid"},{tag:At.punctuation,class:"tok-punctuation"}]);var RF;const zy=new jn;function hX(t){return Fi.define({combine:t?e=>e.concat(t):void 0})}const CG=new jn;class xu{constructor(e,i,n=[],r=""){this.data=e,this.name=r,xs.prototype.hasOwnProperty("tree")||Object.defineProperty(xs.prototype,"tree",{get(){return mo(this)}}),this.parser=i,this.extension=[Op.of(this),xs.languageData.of((s,o,a)=>{let l=H$(s,o,a),u=l.type.prop(zy);if(!u)return[];let d=s.facet(u),p=l.type.prop(CG);if(p){let v=l.resolve(o-l.from,a);for(let y of p)if(y.test(v,s)){let w=s.facet(y.facet);return y.type=="replace"?w:w.concat(d)}}return d})].concat(n)}isActiveAt(e,i,n=-1){return H$(e,i,n).type.prop(zy)==this.data}findRegions(e){let i=e.facet(Op);if(i?.data==this.data)return[{from:0,to:e.doc.length}];if(!i||!i.allowsNesting)return[];let n=[],r=(s,o)=>{if(s.prop(zy)==this.data){n.push({from:o,to:o+s.length});return}let a=s.prop(jn.mounted);if(a){if(a.tree.prop(zy)==this.data){if(a.overlay)for(let l of a.overlay)n.push({from:l.from+o,to:l.to+o});else n.push({from:o,to:o+s.length});return}else if(a.overlay){let l=n.length;if(r(a.tree,a.overlay[0].from+o),n.length>l)return}}for(let l=0;l<s.children.length;l++){let u=s.children[l];u instanceof Js&&r(u,s.positions[l]+o)}};return r(mo(e),0),n}get allowsNesting(){return!0}}xu.setState=_n.define();function H$(t,e,i){let n=t.facet(Op),r=mo(t).topNode;if(!n||n.allowsNesting)for(let s=r;s;s=s.enter(e,i,uo.ExcludeBuffers))s.type.isTop&&(r=s);return r}class rT extends xu{constructor(e,i,n){super(e,i,[],n),this.parser=i}static define(e){let i=hX(e.languageData);return new rT(i,e.parser.configure({props:[zy.add(n=>n.isTop?i:void 0)]}),e.name)}configure(e,i){return new rT(this.data,this.parser.configure(e),i||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function mo(t){let e=t.field(xu.state,!1);return e?e.tree:Js.empty}class nfe{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,i){let n=this.cursorPos-this.string.length;return e<n||i>=this.cursorPos?this.doc.sliceString(e,i):this.string.slice(e-n,i-n)}}let Bb=null,rfe=class j3{constructor(e,i,n=[],r,s,o,a,l){this.parser=e,this.state=i,this.fragments=n,this.tree=r,this.treeLen=s,this.viewport=o,this.skipped=a,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(e,i,n){return new j3(e,i,[],Js.empty,0,n,[],null)}startParse(){return this.parser.startParse(new nfe(this.state.doc),this.fragments)}work(e,i){return i!=null&&i>=this.state.doc.length&&(i=void 0),this.tree!=Js.empty&&this.isDone(i??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var n;if(typeof e=="number"){let r=Date.now()+e;e=()=>Date.now()>r}for(this.parse||(this.parse=this.startParse()),i!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>i)&&i<this.state.doc.length&&this.parse.stopAt(i);;){let r=this.parse.advance();if(r)if(this.fragments=this.withoutTempSkipped(ag.addTree(r,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(n=this.parse.stoppedAt)!==null&&n!==void 0?n:this.state.doc.length,this.tree=r,this.parse=null,this.treeLen<(i??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,i;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(i=this.parse.advance()););}),this.treeLen=e,this.tree=i,this.fragments=this.withoutTempSkipped(ag.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let i=Bb;Bb=this;try{return e()}finally{Bb=i}}withoutTempSkipped(e){for(let i;i=this.tempSkipped.pop();)e=$$(e,i.from,i.to);return e}changes(e,i){let{fragments:n,tree:r,treeLen:s,viewport:o,skipped:a}=this;if(this.takeTree(),!e.empty){let l=[];if(e.iterChangedRanges((u,d,p,v)=>l.push({fromA:u,toA:d,fromB:p,toB:v})),n=ag.applyChanges(n,l),r=Js.empty,s=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){a=[];for(let u of this.skipped){let d=e.mapPos(u.from,1),p=e.mapPos(u.to,-1);d<p&&a.push({from:d,to:p})}}}return new j3(this.parser,i,n,r,s,o,a,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let i=this.skipped.length;for(let n=0;n<this.skipped.length;n++){let{from:r,to:s}=this.skipped[n];r<e.to&&s>e.from&&(this.fragments=$$(this.fragments,r,s),this.skipped.splice(n--,1))}return this.skipped.length>=i?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,i){this.skipped.push({from:e,to:i})}static getSkippingParser(e){return new class extends aX{createParse(i,n,r){let s=r[0].from,o=r[r.length-1].to;return{parsedPos:s,advance(){let l=Bb;if(l){for(let u of r)l.tempSkipped.push(u);e&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,e]):e)}return this.parsedPos=o,new Js(Wc.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let i=this.fragments;return this.treeLen>=e&&i.length&&i[0].from==0&&i[0].to>=e}static get(){return Bb}};function $$(t,e,i){return ag.applyChanges(t,[{fromA:e,toA:i,fromB:e,toB:i}])}class g0{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let i=this.context.changes(e.changes,e.state),n=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),i.viewport.to);return i.work(20,n)||i.takeTree(),new g0(i)}static init(e){let i=Math.min(3e3,e.doc.length),n=rfe.create(e.facet(Op).parser,e,{from:0,to:i});return n.work(20,i)||n.takeTree(),new g0(n)}}xu.state=Do.define({create:g0.init,update(t,e){for(let i of e.effects)if(i.is(xu.setState))return i.value;return e.startState.facet(Op)!=e.state.facet(Op)?g0.init(e.state):t.apply(e)}});let dX=t=>{let e=setTimeout(()=>t(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(dX=t=>{let e=-1,i=setTimeout(()=>{e=requestIdleCallback(t,{timeout:400})},100);return()=>e<0?clearTimeout(i):cancelIdleCallback(e)});const PF=typeof navigator<"u"&&(!((RF=navigator.scheduling)===null||RF===void 0)&&RF.isInputPending)?()=>navigator.scheduling.isInputPending():null,sfe=$s.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let i=this.view.state.field(xu.state).context;(i.updateViewport(e.view.viewport)||this.view.viewport.to>i.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(i)}scheduleWork(){if(this.working)return;let{state:e}=this.view,i=e.field(xu.state);(i.tree!=i.context.tree||!i.context.isDone(e.doc.length))&&(this.working=dX(this.work))}work(e){this.working=null;let i=Date.now();if(this.chunkEnd<i&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=i+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:n,viewport:{to:r}}=this.view,s=n.field(xu.state);if(s.tree==s.context.tree&&s.context.isDone(r+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!PF?Math.max(25,e.timeRemaining()-5):1e9),a=s.context.treeLen<r&&n.doc.length>r+1e3,l=s.context.work(()=>PF&&PF()||Date.now()>o,r+(a?0:1e5));this.chunkBudget-=Date.now()-i,(l||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:xu.setState.of(new g0(s.context))})),this.chunkBudget>0&&!(l&&!a)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(i=>fl(this.view.state,i)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Op=Fi.define({combine(t){return t.length?t[0]:null},enables:t=>[xu.state,sfe,Li.contentAttributes.compute([t],e=>{let i=e.facet(t);return i&&i.name?{"data-language":i.name}:{}})]});class ofe{constructor(e,i=[]){this.language=e,this.support=i,this.extension=[e,i]}}const afe=Fi.define(),RC=Fi.define({combine:t=>{if(!t.length)return"  ";let e=t[0];if(!e||/\S/.test(e)||Array.from(e).some(i=>i!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return e}});function sT(t){let e=t.facet(RC);return e.charCodeAt(0)==9?t.tabSize*e.length:e.length}function A_(t,e){let i="",n=t.tabSize,r=t.facet(RC)[0];if(r=="	"){for(;e>=n;)i+="	",e-=n;r=" "}for(let s=0;s<e;s++)i+=r;return i}function SG(t,e){t instanceof xs&&(t=new aP(t));for(let n of t.state.facet(afe)){let r=n(t,e);if(r!==void 0)return r}let i=mo(t.state);return i.length>=e?lfe(t,i,e):null}class aP{constructor(e,i={}){this.state=e,this.options=i,this.unit=sT(e)}lineAt(e,i=1){let n=this.state.doc.lineAt(e),{simulateBreak:r,simulateDoubleBreak:s}=this.options;return r!=null&&r>=n.from&&r<=n.to?s&&r==e?{text:"",from:e}:(i<0?r<e:r<=e)?{text:n.text.slice(r-n.from),from:r}:{text:n.text.slice(0,r-n.from),from:n.from}:n}textAfterPos(e,i=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:n,from:r}=this.lineAt(e,i);return n.slice(e-r,Math.min(n.length,e+100-r))}column(e,i=1){let{text:n,from:r}=this.lineAt(e,i),s=this.countColumn(n,e-r),o=this.options.overrideIndentation?this.options.overrideIndentation(r):-1;return o>-1&&(s+=o-this.countColumn(n,n.search(/\S|$/))),s}countColumn(e,i=e.length){return X0(e,this.state.tabSize,i)}lineIndent(e,i=1){let{text:n,from:r}=this.lineAt(e,i),s=this.options.overrideIndentation;if(s){let o=s(r);if(o>-1)return o}return this.countColumn(n,n.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const fX=new jn;function lfe(t,e,i){let n=e.resolveStack(i),r=e.resolveInner(i,-1).resolve(i,0).enterUnfinishedNodesBefore(i);if(r!=n.node){let s=[];for(let o=r;o&&!(o.from==n.node.from&&o.type==n.node.type);o=o.parent)s.push(o);for(let o=s.length-1;o>=0;o--)n={node:s[o],next:n}}return pX(n,t,i)}function pX(t,e,i){for(let n=t;n;n=n.next){let r=ufe(n.node);if(r)return r(OG.create(e,i,n))}return 0}function cfe(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}function ufe(t){let e=t.type.prop(fX);if(e)return e;let i=t.firstChild,n;if(i&&(n=i.type.prop(jn.closedBy))){let r=t.lastChild,s=r&&n.indexOf(r.name)>-1;return o=>mX(o,!0,1,void 0,s&&!cfe(o)?r.from:void 0)}return t.parent==null?hfe:null}function hfe(){return 0}class OG extends aP{constructor(e,i,n){super(e.state,e.options),this.base=e,this.pos=i,this.context=n}get node(){return this.context.node}static create(e,i,n){return new OG(e,i,n)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let i=this.state.doc.lineAt(e.from);for(;;){let n=e.resolve(i.from);for(;n.parent&&n.parent.from==n.from;)n=n.parent;if(dfe(n,e))break;i=this.state.doc.lineAt(n.from)}return this.lineIndent(i.from)}continue(){return pX(this.context.next,this.base,this.pos)}}function dfe(t,e){for(let i=e;i;i=i.parent)if(t==i)return!0;return!1}function ffe(t){let e=t.node,i=e.childAfter(e.from),n=e.lastChild;if(!i)return null;let r=t.options.simulateBreak,s=t.state.doc.lineAt(i.from),o=r==null||r<=s.from?s.to:Math.min(s.to,r);for(let a=i.to;;){let l=e.childAfter(a);if(!l||l==n)return null;if(!l.type.isSkipped){if(l.from>=o)return null;let u=/^ */.exec(s.text.slice(i.to-s.from))[0].length;return{from:i.from,to:i.to+u}}a=l.to}}function pfe({closing:t,align:e=!0,units:i=1}){return n=>mX(n,e,i,t)}function mX(t,e,i,n,r){let s=t.textAfter,o=s.match(/^\s*/)[0].length,a=n&&s.slice(o,o+n.length)==n||r==t.pos+o,l=e?ffe(t):null;return l?a?t.column(l.from):t.column(l.to):t.baseIndent+(a?0:t.unit*i)}const mfe=t=>t.baseIndent;function EF({except:t,units:e=1}={}){return i=>{let n=t&&t.test(i.textAfter);return i.baseIndent+(n?0:e*i.unit)}}const gfe=200;function vfe(){return xs.transactionFilter.of(t=>{if(!t.docChanged||!t.isUserEvent("input.type")&&!t.isUserEvent("input.complete"))return t;let e=t.startState.languageDataAt("indentOnInput",t.startState.selection.main.head);if(!e.length)return t;let i=t.newDoc,{head:n}=t.newSelection.main,r=i.lineAt(n);if(n>r.from+gfe)return t;let s=i.sliceString(r.from,n);if(!e.some(u=>u.test(s)))return t;let{state:o}=t,a=-1,l=[];for(let{head:u}of o.selection.ranges){let d=o.doc.lineAt(u);if(d.from==a)continue;a=d.from;let p=SG(o,d.from);if(p==null)continue;let v=/^\s*/.exec(d.text)[0],y=A_(o,p);v!=y&&l.push({from:d.from,to:d.from+v.length,insert:y})}return l.length?[t,{changes:l,sequential:!0}]:t})}const yfe=Fi.define(),gX=new jn;function xfe(t){let e=t.firstChild,i=t.lastChild;return e&&e.to<i.from?{from:e.to,to:i.type.isError?t.to:i.from}:null}function bfe(t,e,i){let n=mo(t);if(n.length<i)return null;let r=n.resolveStack(i,1),s=null;for(let o=r;o;o=o.next){let a=o.node;if(a.to<=i||a.from>i)continue;if(s&&a.from<e)break;let l=a.type.prop(gX);if(l&&(a.to<n.length-50||n.length==t.doc.length||!wfe(a))){let u=l(a,t);u&&u.from<=i&&u.from>=e&&u.to>i&&(s=u)}}return s}function wfe(t){let e=t.lastChild;return e&&e.to==t.to&&e.type.isError}function oT(t,e,i){for(let n of t.facet(yfe)){let r=n(t,e,i);if(r)return r}return bfe(t,e,i)}function vX(t,e){let i=e.mapPos(t.from,1),n=e.mapPos(t.to,-1);return i>=n?void 0:{from:i,to:n}}const lP=_n.define({map:vX}),PC=_n.define({map:vX});function yX(t){let e=[];for(let{head:i}of t.state.selection.ranges)e.some(n=>n.from<=i&&n.to>=i)||e.push(t.lineBlockAt(i));return e}const Ag=Do.define({create(){return an.none},update(t,e){t=t.map(e.changes);for(let i of e.effects)if(i.is(lP)&&!_fe(t,i.value.from,i.value.to)){let{preparePlaceholder:n}=e.state.facet(wX),r=n?an.replace({widget:new Pfe(n(e.state,i.value))}):W$;t=t.update({add:[r.range(i.value.from,i.value.to)]})}else i.is(PC)&&(t=t.update({filter:(n,r)=>i.value.from!=n||i.value.to!=r,filterFrom:i.value.from,filterTo:i.value.to}));if(e.selection){let i=!1,{head:n}=e.selection.main;t.between(n,n,(r,s)=>{r<n&&s>n&&(i=!0)}),i&&(t=t.update({filterFrom:n,filterTo:n,filter:(r,s)=>s<=n||r>=n}))}return t},provide:t=>Li.decorations.from(t),toJSON(t,e){let i=[];return t.between(0,e.doc.length,(n,r)=>{i.push(n,r)}),i},fromJSON(t){if(!Array.isArray(t)||t.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let i=0;i<t.length;){let n=t[i++],r=t[i++];if(typeof n!="number"||typeof r!="number")throw new RangeError("Invalid JSON for fold state");e.push(W$.range(n,r))}return an.set(e,!0)}});function aT(t,e,i){var n;let r=null;return(n=t.field(Ag,!1))===null||n===void 0||n.between(e,i,(s,o)=>{(!r||r.from>s)&&(r={from:s,to:o})}),r}function _fe(t,e,i){let n=!1;return t.between(e,e,(r,s)=>{r==e&&s==i&&(n=!0)}),n}function xX(t,e){return t.field(Ag,!1)?e:e.concat(_n.appendConfig.of(_X()))}const Cfe=t=>{for(let e of yX(t)){let i=oT(t.state,e.from,e.to);if(i)return t.dispatch({effects:xX(t.state,[lP.of(i),bX(t,i)])}),!0}return!1},Sfe=t=>{if(!t.state.field(Ag,!1))return!1;let e=[];for(let i of yX(t)){let n=aT(t.state,i.from,i.to);n&&e.push(PC.of(n),bX(t,n,!1))}return e.length&&t.dispatch({effects:e}),e.length>0};function bX(t,e,i=!0){let n=t.state.doc.lineAt(e.from).number,r=t.state.doc.lineAt(e.to).number;return Li.announce.of(`${t.state.phrase(i?"Folded lines":"Unfolded lines")} ${n} ${t.state.phrase("to")} ${r}.`)}const Ofe=t=>{let{state:e}=t,i=[];for(let n=0;n<e.doc.length;){let r=t.lineBlockAt(n),s=oT(e,r.from,r.to);s&&i.push(lP.of(s)),n=(s?t.lineBlockAt(s.to):r).to+1}return i.length&&t.dispatch({effects:xX(t.state,i)}),!!i.length},Mfe=t=>{let e=t.state.field(Ag,!1);if(!e||!e.size)return!1;let i=[];return e.between(0,t.state.doc.length,(n,r)=>{i.push(PC.of({from:n,to:r}))}),t.dispatch({effects:i}),!0},Tfe=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:Cfe},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:Sfe},{key:"Ctrl-Alt-[",run:Ofe},{key:"Ctrl-Alt-]",run:Mfe}],Rfe={placeholderDOM:null,preparePlaceholder:null,placeholderText:"â¦"},wX=Fi.define({combine(t){return Fh(t,Rfe)}});function _X(t){return[Ag,Ife]}function CX(t,e){let{state:i}=t,n=i.facet(wX),r=o=>{let a=t.lineBlockAt(t.posAtDOM(o.target)),l=aT(t.state,a.from,a.to);l&&t.dispatch({effects:PC.of(l)}),o.preventDefault()};if(n.placeholderDOM)return n.placeholderDOM(t,r,e);let s=document.createElement("span");return s.textContent=n.placeholderText,s.setAttribute("aria-label",i.phrase("folded code")),s.title=i.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=r,s}const W$=an.replace({widget:new class extends Nh{toDOM(t){return CX(t,null)}}});class Pfe extends Nh{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return CX(e,this.value)}}const Efe={openText:"â",closedText:"âº",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class AF extends Hd{constructor(e,i){super(),this.config=e,this.open=i}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let i=document.createElement("span");return i.textContent=this.open?this.config.openText:this.config.closedText,i.title=e.state.phrase(this.open?"Fold line":"Unfold line"),i}}function Afe(t={}){let e=Object.assign(Object.assign({},Efe),t),i=new AF(e,!0),n=new AF(e,!1),r=$s.fromClass(class{constructor(o){this.from=o.viewport.from,this.markers=this.buildMarkers(o)}update(o){(o.docChanged||o.viewportChanged||o.startState.facet(Op)!=o.state.facet(Op)||o.startState.field(Ag,!1)!=o.state.field(Ag,!1)||mo(o.startState)!=mo(o.state)||e.foldingChanged(o))&&(this.markers=this.buildMarkers(o.view))}buildMarkers(o){let a=new Vd;for(let l of o.viewportLineBlocks){let u=aT(o.state,l.from,l.to)?n:oT(o.state,l.from,l.to)?i:null;u&&a.add(l.from,l.from,u)}return a.finish()}}),{domEventHandlers:s}=e;return[r,Ede({class:"cm-foldGutter",markers(o){var a;return((a=o.plugin(r))===null||a===void 0?void 0:a.markers)||ur.empty},initialSpacer(){return new AF(e,!1)},domEventHandlers:Object.assign(Object.assign({},s),{click:(o,a,l)=>{if(s.click&&s.click(o,a,l))return!0;let u=aT(o.state,a.from,a.to);if(u)return o.dispatch({effects:PC.of(u)}),!0;let d=oT(o.state,a.from,a.to);return d?(o.dispatch({effects:lP.of(d)}),!0):!1}})}),_X()]}const Ife=Li.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class cP{constructor(e,i){this.specs=e;let n;function r(a){let l=_p.newName();return(n||(n=Object.create(null)))["."+l]=a,l}const s=typeof i.all=="string"?i.all:i.all?r(i.all):void 0,o=i.scope;this.scope=o instanceof xu?a=>a.prop(zy)==o.data:o?a=>a==o:void 0,this.style=uX(e.map(a=>({tag:a.tag,class:a.class||r(Object.assign({},a,{tag:null}))})),{all:s}).style,this.module=n?new _p(n):null,this.themeType=i.themeType}static define(e,i){return new cP(e,i||{})}}const Q3=Fi.define(),SX=Fi.define({combine(t){return t.length?[t[0]]:null}});function IF(t){let e=t.facet(Q3);return e.length?e:t.facet(SX)}function kfe(t,e){let i=[Lfe],n;return t instanceof cP&&(t.module&&i.push(Li.styleModule.of(t.module)),n=t.themeType),e?.fallback?i.push(SX.of(t)):n?i.push(Q3.computeN([Li.darkTheme],r=>r.facet(Li.darkTheme)==(n=="dark")?[t]:[])):i.push(Q3.of(t)),i}class Dfe{constructor(e){this.markCache=Object.create(null),this.tree=mo(e.state),this.decorations=this.buildDeco(e,IF(e.state)),this.decoratedTo=e.viewport.to}update(e){let i=mo(e.state),n=IF(e.state),r=n!=IF(e.startState),{viewport:s}=e.view,o=e.changes.mapPos(this.decoratedTo,1);i.length<s.to&&!r&&i.type==this.tree.type&&o>=s.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=o):(i!=this.tree||e.viewportChanged||r)&&(this.tree=i,this.decorations=this.buildDeco(e.view,n),this.decoratedTo=s.to)}buildDeco(e,i){if(!i||!this.tree.length)return an.none;let n=new Vd;for(let{from:r,to:s}of e.visibleRanges)efe(this.tree,i,(o,a,l)=>{n.add(o,a,this.markCache[l]||(this.markCache[l]=an.mark({class:l})))},r,s);return n.finish()}}const Lfe=kp.high($s.fromClass(Dfe,{decorations:t=>t.decorations})),Ffe=cP.define([{tag:At.meta,color:"#404740"},{tag:At.link,textDecoration:"underline"},{tag:At.heading,textDecoration:"underline",fontWeight:"bold"},{tag:At.emphasis,fontStyle:"italic"},{tag:At.strong,fontWeight:"bold"},{tag:At.strikethrough,textDecoration:"line-through"},{tag:At.keyword,color:"#708"},{tag:[At.atom,At.bool,At.url,At.contentSeparator,At.labelName],color:"#219"},{tag:[At.literal,At.inserted],color:"#164"},{tag:[At.string,At.deleted],color:"#a11"},{tag:[At.regexp,At.escape,At.special(At.string)],color:"#e40"},{tag:At.definition(At.variableName),color:"#00f"},{tag:At.local(At.variableName),color:"#30a"},{tag:[At.typeName,At.namespace],color:"#085"},{tag:At.className,color:"#167"},{tag:[At.special(At.variableName),At.macroName],color:"#256"},{tag:At.definition(At.propertyName),color:"#00c"},{tag:At.comment,color:"#940"},{tag:At.invalid,color:"#f00"}]),Nfe=Li.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),OX=1e4,MX="()[]{}",TX=Fi.define({combine(t){return Fh(t,{afterCursor:!0,brackets:MX,maxScanDistance:OX,renderMatch:Vfe})}}),Bfe=an.mark({class:"cm-matchingBracket"}),zfe=an.mark({class:"cm-nonmatchingBracket"});function Vfe(t){let e=[],i=t.matched?Bfe:zfe;return e.push(i.range(t.start.from,t.start.to)),t.end&&e.push(i.range(t.end.from,t.end.to)),e}const Gfe=Do.define({create(){return an.none},update(t,e){if(!e.docChanged&&!e.selection)return t;let i=[],n=e.state.facet(TX);for(let r of e.state.selection.ranges){if(!r.empty)continue;let s=uh(e.state,r.head,-1,n)||r.head>0&&uh(e.state,r.head-1,1,n)||n.afterCursor&&(uh(e.state,r.head,1,n)||r.head<e.state.doc.length&&uh(e.state,r.head+1,-1,n));s&&(i=i.concat(n.renderMatch(s,e.state)))}return an.set(i,!0)},provide:t=>Li.decorations.from(t)}),Ufe=[Gfe,Nfe];function Hfe(t={}){return[TX.of(t),Ufe]}const $fe=new jn;function Z3(t,e,i){let n=t.prop(e<0?jn.openedBy:jn.closedBy);if(n)return n;if(t.name.length==1){let r=i.indexOf(t.name);if(r>-1&&r%2==(e<0?1:0))return[i[r+e]]}return null}function X3(t){let e=t.type.prop($fe);return e?e(t.node):t}function uh(t,e,i,n={}){let r=n.maxScanDistance||OX,s=n.brackets||MX,o=mo(t),a=o.resolveInner(e,i);for(let l=a;l;l=l.parent){let u=Z3(l.type,i,s);if(u&&l.from<l.to){let d=X3(l);if(d&&(i>0?e>=d.from&&e<d.to:e>d.from&&e<=d.to))return Wfe(t,e,i,l,d,u,s)}}return qfe(t,e,i,o,a.type,r,s)}function Wfe(t,e,i,n,r,s,o){let a=n.parent,l={from:r.from,to:r.to},u=0,d=a?.cursor();if(d&&(i<0?d.childBefore(n.from):d.childAfter(n.to)))do if(i<0?d.to<=n.from:d.from>=n.to){if(u==0&&s.indexOf(d.type.name)>-1&&d.from<d.to){let p=X3(d);return{start:l,end:p?{from:p.from,to:p.to}:void 0,matched:!0}}else if(Z3(d.type,i,o))u++;else if(Z3(d.type,-i,o)){if(u==0){let p=X3(d);return{start:l,end:p&&p.from<p.to?{from:p.from,to:p.to}:void 0,matched:!1}}u--}}while(i<0?d.prevSibling():d.nextSibling());return{start:l,matched:!1}}function qfe(t,e,i,n,r,s,o){let a=i<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1),l=o.indexOf(a);if(l<0||l%2==0!=i>0)return null;let u={from:i<0?e-1:e,to:i>0?e+1:e},d=t.doc.iterRange(e,i>0?t.doc.length:0),p=0;for(let v=0;!d.next().done&&v<=s;){let y=d.value;i<0&&(v+=y.length);let w=e+v*i;for(let R=i>0?0:y.length-1,O=i>0?y.length:-1;R!=O;R+=i){let P=o.indexOf(y[R]);if(!(P<0||n.resolveInner(w+R,1).type!=r))if(P%2==0==i>0)p++;else{if(p==1)return{start:u,end:{from:w+R,to:w+R+1},matched:P>>1==l>>1};p--}}i>0&&(v+=y.length)}return d.done?{start:u,matched:!1}:null}const jfe=Object.create(null),q$=[Wc.none],j$=[],Q$=Object.create(null),Qfe=Object.create(null);for(let[t,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Qfe[t]=Zfe(jfe,e);function kF(t,e){j$.indexOf(t)>-1||(j$.push(t),console.warn(e))}function Zfe(t,e){let i=[];for(let a of e.split(" ")){let l=[];for(let u of a.split(".")){let d=t[u]||At[u];d?typeof d=="function"?l.length?l=l.map(d):kF(u,`Modifier ${u} used at start of tag`):l.length?kF(u,`Tag ${u} used as modifier`):l=Array.isArray(d)?d:[d]:kF(u,`Unknown highlighting tag ${u}`)}for(let u of l)i.push(u)}if(!i.length)return 0;let n=e.replace(/ /g,"_"),r=n+" "+i.map(a=>a.id),s=Q$[r];if(s)return s.id;let o=Q$[r]=Wc.define({id:q$.length,name:n,props:[lX({[n]:i})]});return q$.push(o),o.id}Yr.RTL,Yr.LTR;const Xfe=t=>{let{state:e}=t,i=e.doc.lineAt(e.selection.main.from),n=TG(t.state,i.from);return n.line?Kfe(t):n.block?Jfe(t):!1};function MG(t,e){return({state:i,dispatch:n})=>{if(i.readOnly)return!1;let r=t(e,i);return r?(n(i.update(r)),!0):!1}}const Kfe=MG(ipe,0),Yfe=MG(RX,0),Jfe=MG((t,e)=>RX(t,e,tpe(e)),0);function TG(t,e){let i=t.languageDataAt("commentTokens",e,1);return i.length?i[0]:{}}const zb=50;function epe(t,{open:e,close:i},n,r){let s=t.sliceDoc(n-zb,n),o=t.sliceDoc(r,r+zb),a=/\s*$/.exec(s)[0].length,l=/^\s*/.exec(o)[0].length,u=s.length-a;if(s.slice(u-e.length,u)==e&&o.slice(l,l+i.length)==i)return{open:{pos:n-a,margin:a&&1},close:{pos:r+l,margin:l&&1}};let d,p;r-n<=2*zb?d=p=t.sliceDoc(n,r):(d=t.sliceDoc(n,n+zb),p=t.sliceDoc(r-zb,r));let v=/^\s*/.exec(d)[0].length,y=/\s*$/.exec(p)[0].length,w=p.length-y-i.length;return d.slice(v,v+e.length)==e&&p.slice(w,w+i.length)==i?{open:{pos:n+v+e.length,margin:/\s/.test(d.charAt(v+e.length))?1:0},close:{pos:r-y-i.length,margin:/\s/.test(p.charAt(w-1))?1:0}}:null}function tpe(t){let e=[];for(let i of t.selection.ranges){let n=t.doc.lineAt(i.from),r=i.to<=n.to?n:t.doc.lineAt(i.to);r.from>n.from&&r.from==i.to&&(r=i.to==n.to+1?n:t.doc.lineAt(i.to-1));let s=e.length-1;s>=0&&e[s].to>n.from?e[s].to=r.to:e.push({from:n.from+/^\s*/.exec(n.text)[0].length,to:r.to})}return e}function RX(t,e,i=e.selection.ranges){let n=i.map(s=>TG(e,s.from).block);if(!n.every(s=>s))return null;let r=i.map((s,o)=>epe(e,n[o],s.from,s.to));if(t!=2&&!r.every(s=>s))return{changes:e.changes(i.map((s,o)=>r[o]?[]:[{from:s.from,insert:n[o].open+" "},{from:s.to,insert:" "+n[o].close}]))};if(t!=1&&r.some(s=>s)){let s=[];for(let o=0,a;o<r.length;o++)if(a=r[o]){let l=n[o],{open:u,close:d}=a;s.push({from:u.pos-l.open.length,to:u.pos+u.margin},{from:d.pos-d.margin,to:d.pos+l.close.length})}return{changes:s}}return null}function ipe(t,e,i=e.selection.ranges){let n=[],r=-1;for(let{from:s,to:o}of i){let a=n.length,l=1e9,u=TG(e,s).line;if(u){for(let d=s;d<=o;){let p=e.doc.lineAt(d);if(p.from>r&&(s==o||o>p.from)){r=p.from;let v=/^\s*/.exec(p.text)[0].length,y=v==p.length,w=p.text.slice(v,v+u.length)==u?v:-1;v<p.text.length&&v<l&&(l=v),n.push({line:p,comment:w,token:u,indent:v,empty:y,single:!1})}d=p.to+1}if(l<1e9)for(let d=a;d<n.length;d++)n[d].indent<n[d].line.text.length&&(n[d].indent=l);n.length==a+1&&(n[a].single=!0)}}if(t!=2&&n.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:a,token:l,indent:u,empty:d,single:p}of n)(p||!d)&&s.push({from:a.from+u,insert:l+" "});let o=e.changes(s);return{changes:o,selection:e.selection.map(o,1)}}else if(t!=1&&n.some(s=>s.comment>=0)){let s=[];for(let{line:o,comment:a,token:l}of n)if(a>=0){let u=o.from+a,d=u+l.length;o.text[d-o.from]==" "&&d++,s.push({from:u,to:d})}return{changes:s}}return null}const K3=ef.define(),npe=ef.define(),rpe=Fi.define(),PX=Fi.define({combine(t){return Fh(t,{minDepth:100,newGroupDelay:500,joinToEvent:(e,i)=>i},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,i)=>(n,r)=>e(n,r)||i(n,r)})}}),EX=Do.define({create(){return Gw.empty},update(t,e){let i=e.state.facet(PX),n=e.annotation(K3);if(n){let l=pl.fromTransaction(e,n.selection),u=n.side,d=u==0?t.undone:t.done;return l?d=lT(d,d.length,i.minDepth,l):d=kX(d,e.startState.selection),new Gw(u==0?n.rest:d,u==0?d:n.rest)}let r=e.annotation(npe);if((r=="full"||r=="before")&&(t=t.isolate()),e.annotation(Va.addToHistory)===!1)return e.changes.empty?t:t.addMapping(e.changes.desc);let s=pl.fromTransaction(e),o=e.annotation(Va.time),a=e.annotation(Va.userEvent);return s?t=t.addChanges(s,o,a,i,e):e.selection&&(t=t.addSelection(e.startState.selection,o,a,i.newGroupDelay)),(r=="full"||r=="after")&&(t=t.isolate()),t},toJSON(t){return{done:t.done.map(e=>e.toJSON()),undone:t.undone.map(e=>e.toJSON())}},fromJSON(t){return new Gw(t.done.map(pl.fromJSON),t.undone.map(pl.fromJSON))}});function spe(t={}){return[EX,PX.of(t),Li.domEventHandlers({beforeinput(e,i){let n=e.inputType=="historyUndo"?AX:e.inputType=="historyRedo"?Y3:null;return n?(e.preventDefault(),n(i)):!1}})]}function uP(t,e){return function({state:i,dispatch:n}){if(!e&&i.readOnly)return!1;let r=i.field(EX,!1);if(!r)return!1;let s=r.pop(t,i,e);return s?(n(s),!0):!1}}const AX=uP(0,!1),Y3=uP(1,!1),ope=uP(0,!0),ape=uP(1,!0);class pl{constructor(e,i,n,r,s){this.changes=e,this.effects=i,this.mapped=n,this.startSelection=r,this.selectionsAfter=s}setSelAfter(e){return new pl(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,i,n;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(i=this.mapped)===null||i===void 0?void 0:i.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(r=>r.toJSON())}}static fromJSON(e){return new pl(e.changes&&ao.fromJSON(e.changes),[],e.mapped&&gh.fromJSON(e.mapped),e.startSelection&&Kt.fromJSON(e.startSelection),e.selectionsAfter.map(Kt.fromJSON))}static fromTransaction(e,i){let n=Ec;for(let r of e.startState.facet(rpe)){let s=r(e);s.length&&(n=n.concat(s))}return!n.length&&e.changes.empty?null:new pl(e.changes.invert(e.startState.doc),n,void 0,i||e.startState.selection,Ec)}static selection(e){return new pl(void 0,Ec,void 0,void 0,e)}}function lT(t,e,i,n){let r=e+1>i+20?e-i-1:0,s=t.slice(r,e);return s.push(n),s}function lpe(t,e){let i=[],n=!1;return t.iterChangedRanges((r,s)=>i.push(r,s)),e.iterChangedRanges((r,s,o,a)=>{for(let l=0;l<i.length;){let u=i[l++],d=i[l++];a>=u&&o<=d&&(n=!0)}}),n}function cpe(t,e){return t.ranges.length==e.ranges.length&&t.ranges.filter((i,n)=>i.empty!=e.ranges[n].empty).length===0}function IX(t,e){return t.length?e.length?t.concat(e):t:e}const Ec=[],upe=200;function kX(t,e){if(t.length){let i=t[t.length-1],n=i.selectionsAfter.slice(Math.max(0,i.selectionsAfter.length-upe));return n.length&&n[n.length-1].eq(e)?t:(n.push(e),lT(t,t.length-1,1e9,i.setSelAfter(n)))}else return[pl.selection([e])]}function hpe(t){let e=t[t.length-1],i=t.slice();return i[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),i}function DF(t,e){if(!t.length)return t;let i=t.length,n=Ec;for(;i;){let r=dpe(t[i-1],e,n);if(r.changes&&!r.changes.empty||r.effects.length){let s=t.slice(0,i);return s[i-1]=r,s}else e=r.mapped,i--,n=r.selectionsAfter}return n.length?[pl.selection(n)]:Ec}function dpe(t,e,i){let n=IX(t.selectionsAfter.length?t.selectionsAfter.map(a=>a.map(e)):Ec,i);if(!t.changes)return pl.selection(n);let r=t.changes.map(e),s=e.mapDesc(t.changes,!0),o=t.mapped?t.mapped.composeDesc(s):s;return new pl(r,_n.mapEffects(t.effects,e),o,t.startSelection.map(s),n)}const fpe=/^(input\.type|delete)($|\.)/;let Gw=class yw{constructor(e,i,n=0,r=void 0){this.done=e,this.undone=i,this.prevTime=n,this.prevUserEvent=r}isolate(){return this.prevTime?new yw(this.done,this.undone):this}addChanges(e,i,n,r,s){let o=this.done,a=o[o.length-1];return a&&a.changes&&!a.changes.empty&&e.changes&&(!n||fpe.test(n))&&(!a.selectionsAfter.length&&i-this.prevTime<r.newGroupDelay&&r.joinToEvent(s,lpe(a.changes,e.changes))||n=="input.type.compose")?o=lT(o,o.length-1,r.minDepth,new pl(e.changes.compose(a.changes),IX(_n.mapEffects(e.effects,a.changes),a.effects),a.mapped,a.startSelection,Ec)):o=lT(o,o.length,r.minDepth,e),new yw(o,Ec,i,n)}addSelection(e,i,n,r){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:Ec;return s.length>0&&i-this.prevTime<r&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&cpe(s[s.length-1],e)?this:new yw(kX(this.done,e),this.undone,i,n)}addMapping(e){return new yw(DF(this.done,e),DF(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,i,n){let r=e==0?this.done:this.undone;if(r.length==0)return null;let s=r[r.length-1],o=s.selectionsAfter[0]||i.selection;if(n&&s.selectionsAfter.length)return i.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:K3.of({side:e,rest:hpe(r),selection:o}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let a=r.length==1?Ec:r.slice(0,r.length-1);return s.mapped&&(a=DF(a,s.mapped)),i.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:K3.of({side:e,rest:a,selection:o}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}};Gw.empty=new Gw(Ec,Ec);const ppe=[{key:"Mod-z",run:AX,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Y3,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Y3,preventDefault:!0},{key:"Mod-u",run:ope,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:ape,preventDefault:!0}];function K0(t,e){return Kt.create(t.ranges.map(e),t.mainIndex)}function Bh(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function Ru({state:t,dispatch:e},i){let n=K0(t.selection,i);return n.eq(t.selection,!0)?!1:(e(Bh(t,n)),!0)}function hP(t,e){return Kt.cursor(e?t.to:t.from)}function DX(t,e){return Ru(t,i=>i.empty?t.moveByChar(i,e):hP(i,e))}function va(t){return t.textDirectionAt(t.state.selection.main.head)==Yr.LTR}const LX=t=>DX(t,!va(t)),FX=t=>DX(t,va(t));function NX(t,e){return Ru(t,i=>i.empty?t.moveByGroup(i,e):hP(i,e))}const mpe=t=>NX(t,!va(t)),gpe=t=>NX(t,va(t));function vpe(t,e,i){if(e.type.prop(i))return!0;let n=e.to-e.from;return n&&(n>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function dP(t,e,i){let n=mo(t).resolveInner(e.head),r=i?jn.closedBy:jn.openedBy;for(let l=e.head;;){let u=i?n.childAfter(l):n.childBefore(l);if(!u)break;vpe(t,u,r)?n=u:l=i?u.to:u.from}let s=n.type.prop(r),o,a;return s&&(o=i?uh(t,n.from,1):uh(t,n.to,-1))&&o.matched?a=i?o.end.to:o.end.from:a=i?n.to:n.from,Kt.cursor(a,i?-1:1)}const ype=t=>Ru(t,e=>dP(t.state,e,!va(t))),xpe=t=>Ru(t,e=>dP(t.state,e,va(t)));function BX(t,e){return Ru(t,i=>{if(!i.empty)return hP(i,e);let n=t.moveVertically(i,e);return n.head!=i.head?n:t.moveToLineBoundary(i,e)})}const zX=t=>BX(t,!1),VX=t=>BX(t,!0);function GX(t){let e=t.scrollDOM.clientHeight<t.scrollDOM.scrollHeight-2,i=0,n=0,r;if(e){for(let s of t.state.facet(Li.scrollMargins)){let o=s(t);o?.top&&(i=Math.max(o?.top,i)),o?.bottom&&(n=Math.max(o?.bottom,n))}r=t.scrollDOM.clientHeight-i-n}else r=(t.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:i,marginBottom:n,selfScroll:e,height:Math.max(t.defaultLineHeight,r-5)}}function UX(t,e){let i=GX(t),{state:n}=t,r=K0(n.selection,o=>o.empty?t.moveVertically(o,e,i.height):hP(o,e));if(r.eq(n.selection))return!1;let s;if(i.selfScroll){let o=t.coordsAtPos(n.selection.main.head),a=t.scrollDOM.getBoundingClientRect(),l=a.top+i.marginTop,u=a.bottom-i.marginBottom;o&&o.top>l&&o.bottom<u&&(s=Li.scrollIntoView(r.main.head,{y:"start",yMargin:o.top-l}))}return t.dispatch(Bh(n,r),{effects:s}),!0}const Z$=t=>UX(t,!1),J3=t=>UX(t,!0);function Dp(t,e,i){let n=t.lineBlockAt(e.head),r=t.moveToLineBoundary(e,i);if(r.head==e.head&&r.head!=(i?n.to:n.from)&&(r=t.moveToLineBoundary(e,i,!1)),!i&&r.head==n.from&&n.length){let s=/^\s*/.exec(t.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;s&&e.head!=n.from+s&&(r=Kt.cursor(n.from+s))}return r}const bpe=t=>Ru(t,e=>Dp(t,e,!0)),wpe=t=>Ru(t,e=>Dp(t,e,!1)),_pe=t=>Ru(t,e=>Dp(t,e,!va(t))),Cpe=t=>Ru(t,e=>Dp(t,e,va(t))),Spe=t=>Ru(t,e=>Kt.cursor(t.lineBlockAt(e.head).from,1)),Ope=t=>Ru(t,e=>Kt.cursor(t.lineBlockAt(e.head).to,-1));function Mpe(t,e,i){let n=!1,r=K0(t.selection,s=>{let o=uh(t,s.head,-1)||uh(t,s.head,1)||s.head>0&&uh(t,s.head-1,1)||s.head<t.doc.length&&uh(t,s.head+1,-1);if(!o||!o.end)return s;n=!0;let a=o.start.from==s.head?o.end.to:o.end.from;return Kt.cursor(a)});return n?(e(Bh(t,r)),!0):!1}const Tpe=({state:t,dispatch:e})=>Mpe(t,e);function Zc(t,e){let i=K0(t.state.selection,n=>{let r=e(n);return Kt.range(n.anchor,r.head,r.goalColumn,r.bidiLevel||void 0)});return i.eq(t.state.selection)?!1:(t.dispatch(Bh(t.state,i)),!0)}function HX(t,e){return Zc(t,i=>t.moveByChar(i,e))}const $X=t=>HX(t,!va(t)),WX=t=>HX(t,va(t));function qX(t,e){return Zc(t,i=>t.moveByGroup(i,e))}const Rpe=t=>qX(t,!va(t)),Ppe=t=>qX(t,va(t)),Epe=t=>Zc(t,e=>dP(t.state,e,!va(t))),Ape=t=>Zc(t,e=>dP(t.state,e,va(t)));function jX(t,e){return Zc(t,i=>t.moveVertically(i,e))}const QX=t=>jX(t,!1),ZX=t=>jX(t,!0);function XX(t,e){return Zc(t,i=>t.moveVertically(i,e,GX(t).height))}const X$=t=>XX(t,!1),K$=t=>XX(t,!0),Ipe=t=>Zc(t,e=>Dp(t,e,!0)),kpe=t=>Zc(t,e=>Dp(t,e,!1)),Dpe=t=>Zc(t,e=>Dp(t,e,!va(t))),Lpe=t=>Zc(t,e=>Dp(t,e,va(t))),Fpe=t=>Zc(t,e=>Kt.cursor(t.lineBlockAt(e.head).from)),Npe=t=>Zc(t,e=>Kt.cursor(t.lineBlockAt(e.head).to)),Y$=({state:t,dispatch:e})=>(e(Bh(t,{anchor:0})),!0),J$=({state:t,dispatch:e})=>(e(Bh(t,{anchor:t.doc.length})),!0),eW=({state:t,dispatch:e})=>(e(Bh(t,{anchor:t.selection.main.anchor,head:0})),!0),tW=({state:t,dispatch:e})=>(e(Bh(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0),Bpe=({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0),zpe=({state:t,dispatch:e})=>{let i=fP(t).map(({from:n,to:r})=>Kt.range(n,Math.min(r+1,t.doc.length)));return e(t.update({selection:Kt.create(i),userEvent:"select"})),!0},Vpe=({state:t,dispatch:e})=>{let i=K0(t.selection,n=>{let r=mo(t),s=r.resolveStack(n.from,1);if(n.empty){let o=r.resolveStack(n.from,-1);o.node.from>=s.node.from&&o.node.to<=s.node.to&&(s=o)}for(let o=s;o;o=o.next){let{node:a}=o;if((a.from<n.from&&a.to>=n.to||a.to>n.to&&a.from<=n.from)&&o.next)return Kt.range(a.to,a.from)}return n});return i.eq(t.selection)?!1:(e(Bh(t,i)),!0)},Gpe=({state:t,dispatch:e})=>{let i=t.selection,n=null;return i.ranges.length>1?n=Kt.create([i.main]):i.main.empty||(n=Kt.create([Kt.cursor(i.main.head)])),n?(e(Bh(t,n)),!0):!1};function EC(t,e){if(t.state.readOnly)return!1;let i="delete.selection",{state:n}=t,r=n.changeByRange(s=>{let{from:o,to:a}=s;if(o==a){let l=e(s);l<o?(i="delete.backward",l=N1(t,l,!1)):l>o&&(i="delete.forward",l=N1(t,l,!0)),o=Math.min(o,l),a=Math.max(a,l)}else o=N1(t,o,!1),a=N1(t,a,!0);return o==a?{range:s}:{changes:{from:o,to:a},range:Kt.cursor(o,o<s.head?-1:1)}});return r.changes.empty?!1:(t.dispatch(n.update(r,{scrollIntoView:!0,userEvent:i,effects:i=="delete.selection"?Li.announce.of(n.phrase("Selection deleted")):void 0})),!0)}function N1(t,e,i){if(t instanceof Li)for(let n of t.state.facet(Li.atomicRanges).map(r=>r(t)))n.between(e,e,(r,s)=>{r<e&&s>e&&(e=i?s:r)});return e}const KX=(t,e,i)=>EC(t,n=>{let r=n.from,{state:s}=t,o=s.doc.lineAt(r),a,l;if(i&&!e&&r>o.from&&r<o.from+200&&!/[^ \t]/.test(a=o.text.slice(0,r-o.from))){if(a[a.length-1]=="	")return r-1;let u=X0(a,s.tabSize),d=u%sT(s)||sT(s);for(let p=0;p<d&&a[a.length-1-p]==" ";p++)r--;l=r}else l=Qo(o.text,r-o.from,e,e)+o.from,l==r&&o.number!=(e?s.doc.lines:1)?l+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(o.text.slice(l-o.from,r-o.from))&&(l=Qo(o.text,l-o.from,!1,!1)+o.from);return l}),ez=t=>KX(t,!1,!0),YX=t=>KX(t,!0,!1),JX=(t,e)=>EC(t,i=>{let n=i.head,{state:r}=t,s=r.doc.lineAt(n),o=r.charCategorizer(n);for(let a=null;;){if(n==(e?s.to:s.from)){n==i.head&&s.number!=(e?r.doc.lines:1)&&(n+=e?1:-1);break}let l=Qo(s.text,n-s.from,e)+s.from,u=s.text.slice(Math.min(n,l)-s.from,Math.max(n,l)-s.from),d=o(u);if(a!=null&&d!=a)break;(u!=" "||n!=i.head)&&(a=d),n=l}return n}),eK=t=>JX(t,!1),Upe=t=>JX(t,!0),Hpe=t=>EC(t,e=>{let i=t.lineBlockAt(e.head).to;return e.head<i?i:Math.min(t.state.doc.length,e.head+1)}),$pe=t=>EC(t,e=>{let i=t.moveToLineBoundary(e,!1).head;return e.head>i?i:Math.max(0,e.head-1)}),Wpe=t=>EC(t,e=>{let i=t.moveToLineBoundary(e,!0).head;return e.head<i?i:Math.min(t.state.doc.length,e.head+1)}),qpe=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:fr.of(["",""])},range:Kt.cursor(n.from)}));return e(t.update(i,{scrollIntoView:!0,userEvent:"input"})),!0},jpe=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=t.changeByRange(n=>{if(!n.empty||n.from==0||n.from==t.doc.length)return{range:n};let r=n.from,s=t.doc.lineAt(r),o=r==s.from?r-1:Qo(s.text,r-s.from,!1)+s.from,a=r==s.to?r+1:Qo(s.text,r-s.from,!0)+s.from;return{changes:{from:o,to:a,insert:t.doc.slice(r,a).append(t.doc.slice(o,r))},range:Kt.cursor(a)}});return i.changes.empty?!1:(e(t.update(i,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function fP(t){let e=[],i=-1;for(let n of t.selection.ranges){let r=t.doc.lineAt(n.from),s=t.doc.lineAt(n.to);if(!n.empty&&n.to==s.from&&(s=t.doc.lineAt(n.to-1)),i>=r.number){let o=e[e.length-1];o.to=s.to,o.ranges.push(n)}else e.push({from:r.from,to:s.to,ranges:[n]});i=s.number+1}return e}function tK(t,e,i){if(t.readOnly)return!1;let n=[],r=[];for(let s of fP(t)){if(i?s.to==t.doc.length:s.from==0)continue;let o=t.doc.lineAt(i?s.to+1:s.from-1),a=o.length+1;if(i){n.push({from:s.to,to:o.to},{from:s.from,insert:o.text+t.lineBreak});for(let l of s.ranges)r.push(Kt.range(Math.min(t.doc.length,l.anchor+a),Math.min(t.doc.length,l.head+a)))}else{n.push({from:o.from,to:s.from},{from:s.to,insert:t.lineBreak+o.text});for(let l of s.ranges)r.push(Kt.range(l.anchor-a,l.head-a))}}return n.length?(e(t.update({changes:n,scrollIntoView:!0,selection:Kt.create(r,t.selection.mainIndex),userEvent:"move.line"})),!0):!1}const Qpe=({state:t,dispatch:e})=>tK(t,e,!1),Zpe=({state:t,dispatch:e})=>tK(t,e,!0);function iK(t,e,i){if(t.readOnly)return!1;let n=[];for(let r of fP(t))i?n.push({from:r.from,insert:t.doc.slice(r.from,r.to)+t.lineBreak}):n.push({from:r.to,insert:t.lineBreak+t.doc.slice(r.from,r.to)});return e(t.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const Xpe=({state:t,dispatch:e})=>iK(t,e,!1),Kpe=({state:t,dispatch:e})=>iK(t,e,!0),Ype=t=>{if(t.state.readOnly)return!1;let{state:e}=t,i=e.changes(fP(e).map(({from:r,to:s})=>(r>0?r--:s<e.doc.length&&s++,{from:r,to:s}))),n=K0(e.selection,r=>{let s;if(t.lineWrapping){let o=t.lineBlockAt(r.head),a=t.coordsAtPos(r.head,r.assoc||1);a&&(s=o.bottom+t.documentTop-a.bottom+t.defaultLineHeight/2)}return t.moveVertically(r,!0,s)}).map(i);return t.dispatch({changes:i,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function Jpe(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let i=mo(t).resolveInner(e),n=i.childBefore(e),r=i.childAfter(e),s;return n&&r&&n.to<=e&&r.from>=e&&(s=n.type.prop(jn.closedBy))&&s.indexOf(r.name)>-1&&t.doc.lineAt(n.to).from==t.doc.lineAt(r.from).from&&!/\S/.test(t.sliceDoc(n.to,r.from))?{from:n.to,to:r.from}:null}const iW=nK(!1),eme=nK(!0);function nK(t){return({state:e,dispatch:i})=>{if(e.readOnly)return!1;let n=e.changeByRange(r=>{let{from:s,to:o}=r,a=e.doc.lineAt(s),l=!t&&s==o&&Jpe(e,s);t&&(s=o=(o<=a.to?a:e.doc.lineAt(o)).to);let u=new aP(e,{simulateBreak:s,simulateDoubleBreak:!!l}),d=SG(u,s);for(d==null&&(d=X0(/^\s*/.exec(e.doc.lineAt(s).text)[0],e.tabSize));o<a.to&&/\s/.test(a.text[o-a.from]);)o++;l?{from:s,to:o}=l:s>a.from&&s<a.from+100&&!/\S/.test(a.text.slice(0,s))&&(s=a.from);let p=["",A_(e,d)];return l&&p.push(A_(e,u.lineIndent(a.from,-1))),{changes:{from:s,to:o,insert:fr.of(p)},range:Kt.cursor(s+1+p[1].length)}});return i(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function RG(t,e){let i=-1;return t.changeByRange(n=>{let r=[];for(let o=n.from;o<=n.to;){let a=t.doc.lineAt(o);a.number>i&&(n.empty||n.to>a.from)&&(e(a,r,n),i=a.number),o=a.to+1}let s=t.changes(r);return{changes:r,range:Kt.range(s.mapPos(n.anchor,1),s.mapPos(n.head,1))}})}const tme=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let i=Object.create(null),n=new aP(t,{overrideIndentation:s=>{let o=i[s];return o??-1}}),r=RG(t,(s,o,a)=>{let l=SG(n,s.from);if(l==null)return;/\S/.test(s.text)||(l=0);let u=/^\s*/.exec(s.text)[0],d=A_(t,l);(u!=d||a.from<s.from+u.length)&&(i[s.from]=l,o.push({from:s.from,to:s.from+u.length,insert:d}))});return r.changes.empty||e(t.update(r,{userEvent:"indent"})),!0},rK=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(RG(t,(i,n)=>{n.push({from:i.from,insert:t.facet(RC)})}),{userEvent:"input.indent"})),!0),sK=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(RG(t,(i,n)=>{let r=/^\s*/.exec(i.text)[0];if(!r)return;let s=X0(r,t.tabSize),o=0,a=A_(t,Math.max(0,s-sT(t)));for(;o<r.length&&o<a.length&&r.charCodeAt(o)==a.charCodeAt(o);)o++;n.push({from:i.from+o,to:i.from+r.length,insert:a.slice(o)})}),{userEvent:"delete.dedent"})),!0),ime=t=>(t.setTabFocusMode(),!0),nme=[{key:"Ctrl-b",run:LX,shift:$X,preventDefault:!0},{key:"Ctrl-f",run:FX,shift:WX},{key:"Ctrl-p",run:zX,shift:QX},{key:"Ctrl-n",run:VX,shift:ZX},{key:"Ctrl-a",run:Spe,shift:Fpe},{key:"Ctrl-e",run:Ope,shift:Npe},{key:"Ctrl-d",run:YX},{key:"Ctrl-h",run:ez},{key:"Ctrl-k",run:Hpe},{key:"Ctrl-Alt-h",run:eK},{key:"Ctrl-o",run:qpe},{key:"Ctrl-t",run:jpe},{key:"Ctrl-v",run:J3}],rme=[{key:"ArrowLeft",run:LX,shift:$X,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:mpe,shift:Rpe,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:_pe,shift:Dpe,preventDefault:!0},{key:"ArrowRight",run:FX,shift:WX,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:gpe,shift:Ppe,preventDefault:!0},{mac:"Cmd-ArrowRight",run:Cpe,shift:Lpe,preventDefault:!0},{key:"ArrowUp",run:zX,shift:QX,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Y$,shift:eW},{mac:"Ctrl-ArrowUp",run:Z$,shift:X$},{key:"ArrowDown",run:VX,shift:ZX,preventDefault:!0},{mac:"Cmd-ArrowDown",run:J$,shift:tW},{mac:"Ctrl-ArrowDown",run:J3,shift:K$},{key:"PageUp",run:Z$,shift:X$},{key:"PageDown",run:J3,shift:K$},{key:"Home",run:wpe,shift:kpe,preventDefault:!0},{key:"Mod-Home",run:Y$,shift:eW},{key:"End",run:bpe,shift:Ipe,preventDefault:!0},{key:"Mod-End",run:J$,shift:tW},{key:"Enter",run:iW,shift:iW},{key:"Mod-a",run:Bpe},{key:"Backspace",run:ez,shift:ez},{key:"Delete",run:YX},{key:"Mod-Backspace",mac:"Alt-Backspace",run:eK},{key:"Mod-Delete",mac:"Alt-Delete",run:Upe},{mac:"Mod-Backspace",run:$pe},{mac:"Mod-Delete",run:Wpe}].concat(nme.map(t=>({mac:t.key,run:t.run,shift:t.shift}))),sme=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:ype,shift:Epe},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:xpe,shift:Ape},{key:"Alt-ArrowUp",run:Qpe},{key:"Shift-Alt-ArrowUp",run:Xpe},{key:"Alt-ArrowDown",run:Zpe},{key:"Shift-Alt-ArrowDown",run:Kpe},{key:"Escape",run:Gpe},{key:"Mod-Enter",run:eme},{key:"Alt-l",mac:"Ctrl-l",run:zpe},{key:"Mod-i",run:Vpe,preventDefault:!0},{key:"Mod-[",run:sK},{key:"Mod-]",run:rK},{key:"Mod-Alt-\\",run:tme},{key:"Shift-Mod-k",run:Ype},{key:"Shift-Mod-\\",run:Tpe},{key:"Mod-/",run:Xfe},{key:"Alt-A",run:Yfe},{key:"Ctrl-m",mac:"Shift-Alt-m",run:ime}].concat(rme),ome={key:"Tab",run:rK,shift:sK};function Dr(){var t=arguments[0];typeof t=="string"&&(t=document.createElement(t));var e=1,i=arguments[1];if(i&&typeof i=="object"&&i.nodeType==null&&!Array.isArray(i)){for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var r=i[n];typeof r=="string"?t.setAttribute(n,r):r!=null&&(t[n]=r)}e++}for(;e<arguments.length;e++)oK(t,arguments[e]);return t}function oK(t,e){if(typeof e=="string")t.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)t.appendChild(e);else if(Array.isArray(e))for(var i=0;i<e.length;i++)oK(t,e[i]);else throw new RangeError("Unsupported child node: "+e)}const nW=typeof String.prototype.normalize=="function"?t=>t.normalize("NFKD"):t=>t;class v0{constructor(e,i,n=0,r=e.length,s,o){this.test=o,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(n,r),this.bufferStart=n,this.normalize=s?a=>s(nW(a)):nW,this.query=this.normalize(i)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return al(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let i=nG(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=sh(e);let r=this.normalize(i);if(r.length)for(let s=0,o=n;;s++){let a=r.charCodeAt(s),l=this.match(a,o,this.bufferPos+this.bufferStart);if(s==r.length-1){if(l)return this.value=l,this;break}o==n&&s<i.length&&i.charCodeAt(s)==a&&o++}}}match(e,i,n){let r=null;for(let s=0;s<this.matches.length;s+=2){let o=this.matches[s],a=!1;this.query.charCodeAt(o)==e&&(o==this.query.length-1?r={from:this.matches[s+1],to:n}:(this.matches[s]++,a=!0)),a||(this.matches.splice(s,2),s-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?r={from:i,to:n}:this.matches.push(1,i)),r&&this.test&&!this.test(r.from,r.to,this.buffer,this.bufferStart)&&(r=null),r}}typeof Symbol<"u"&&(v0.prototype[Symbol.iterator]=function(){return this});const aK={from:-1,to:-1,match:/.*/.exec("")},PG="gm"+(/x/.unicode==null?"":"u");class lK{constructor(e,i,n,r=0,s=e.length){if(this.text=e,this.to=s,this.curLine="",this.done=!1,this.value=aK,/\\[sWDnr]|\n|\r|\[\^/.test(i))return new cK(e,i,n,r,s);this.re=new RegExp(i,PG+(n?.ignoreCase?"i":"")),this.test=n?.test,this.iter=e.iter();let o=e.lineAt(r);this.curLineStart=o.from,this.matchPos=cT(e,r),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let i=this.matchPos<=this.to&&this.re.exec(this.curLine);if(i){let n=this.curLineStart+i.index,r=n+i[0].length;if(this.matchPos=cT(this.text,r+(n==r?1:0)),n==this.curLineStart+this.curLine.length&&this.nextLine(),(n<r||n>this.value.to)&&(!this.test||this.test(n,r,i)))return this.value={from:n,to:r,match:i},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const LF=new WeakMap;class Xy{constructor(e,i){this.from=e,this.text=i}get to(){return this.from+this.text.length}static get(e,i,n){let r=LF.get(e);if(!r||r.from>=n||r.to<=i){let a=new Xy(i,e.sliceString(i,n));return LF.set(e,a),a}if(r.from==i&&r.to==n)return r;let{text:s,from:o}=r;return o>i&&(s=e.sliceString(i,o)+s,o=i),r.to<n&&(s+=e.sliceString(r.to,n)),LF.set(e,new Xy(o,s)),new Xy(i,s.slice(i-o,n-o))}}class cK{constructor(e,i,n,r,s){this.text=e,this.to=s,this.done=!1,this.value=aK,this.matchPos=cT(e,r),this.re=new RegExp(i,PG+(n?.ignoreCase?"i":"")),this.test=n?.test,this.flat=Xy.get(e,r,this.chunkEnd(r+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,i=this.re.exec(this.flat.text);if(i&&!i[0]&&i.index==e&&(this.re.lastIndex=e+1,i=this.re.exec(this.flat.text)),i){let n=this.flat.from+i.index,r=n+i[0].length;if((this.flat.to>=this.to||i.index+i[0].length<=this.flat.text.length-10)&&(!this.test||this.test(n,r,i)))return this.value={from:n,to:r,match:i},this.matchPos=cT(this.text,r+(n==r?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=Xy.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(lK.prototype[Symbol.iterator]=cK.prototype[Symbol.iterator]=function(){return this});function ame(t){try{return new RegExp(t,PG),!0}catch{return!1}}function cT(t,e){if(e>=t.length)return e;let i=t.lineAt(e),n;for(;e<i.to&&(n=i.text.charCodeAt(e-i.from))>=56320&&n<57344;)e++;return e}function tz(t){let e=String(t.state.doc.lineAt(t.state.selection.main.head).number),i=Dr("input",{class:"cm-textfield",name:"line",value:e}),n=Dr("form",{class:"cm-gotoLine",onkeydown:s=>{s.keyCode==27?(s.preventDefault(),t.dispatch({effects:Uw.of(!1)}),t.focus()):s.keyCode==13&&(s.preventDefault(),r())},onsubmit:s=>{s.preventDefault(),r()}},Dr("label",t.state.phrase("Go to line"),": ",i)," ",Dr("button",{class:"cm-button",type:"submit"},t.state.phrase("go")),Dr("button",{name:"close",onclick:()=>{t.dispatch({effects:Uw.of(!1)}),t.focus()},"aria-label":t.state.phrase("close"),type:"button"},["Ã"]));function r(){let s=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(i.value);if(!s)return;let{state:o}=t,a=o.doc.lineAt(o.selection.main.head),[,l,u,d,p]=s,v=d?+d.slice(1):0,y=u?+u:a.number;if(u&&p){let O=y/100;l&&(O=O*(l=="-"?-1:1)+a.number/o.doc.lines),y=Math.round(o.doc.lines*O)}else u&&l&&(y=y*(l=="-"?-1:1)+a.number);let w=o.doc.line(Math.max(1,Math.min(o.doc.lines,y))),R=Kt.cursor(w.from+Math.max(0,Math.min(v,w.length)));t.dispatch({effects:[Uw.of(!1),Li.scrollIntoView(R.from,{y:"center"})],selection:R}),t.focus()}return{dom:n}}const Uw=_n.define(),rW=Do.define({create(){return!0},update(t,e){for(let i of e.effects)i.is(Uw)&&(t=i.value);return t},provide:t=>P_.from(t,e=>e?tz:null)}),lme=t=>{let e=R_(t,tz);if(!e){let i=[Uw.of(!0)];t.state.field(rW,!1)==null&&i.push(_n.appendConfig.of([rW,cme])),t.dispatch({effects:i}),e=R_(t,tz)}return e&&e.dom.querySelector("input").select(),!0},cme=Li.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px",position:"relative","& label":{fontSize:"80%"},"& [name=close]":{position:"absolute",top:"0",bottom:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:"0"}}}),ume={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},hme=Fi.define({combine(t){return Fh(t,ume,{highlightWordAroundCursor:(e,i)=>e||i,minSelectionLength:Math.min,maxMatches:Math.min})}});function dme(t){return[vme,gme]}const fme=an.mark({class:"cm-selectionMatch"}),pme=an.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function sW(t,e,i,n){return(i==0||t(e.sliceDoc(i-1,i))!=cs.Word)&&(n==e.doc.length||t(e.sliceDoc(n,n+1))!=cs.Word)}function mme(t,e,i,n){return t(e.sliceDoc(i,i+1))==cs.Word&&t(e.sliceDoc(n-1,n))==cs.Word}const gme=$s.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(hme),{state:i}=t,n=i.selection;if(n.ranges.length>1)return an.none;let r=n.main,s,o=null;if(r.empty){if(!e.highlightWordAroundCursor)return an.none;let l=i.wordAt(r.head);if(!l)return an.none;o=i.charCategorizer(r.head),s=i.sliceDoc(l.from,l.to)}else{let l=r.to-r.from;if(l<e.minSelectionLength||l>200)return an.none;if(e.wholeWords){if(s=i.sliceDoc(r.from,r.to),o=i.charCategorizer(r.head),!(sW(o,i,r.from,r.to)&&mme(o,i,r.from,r.to)))return an.none}else if(s=i.sliceDoc(r.from,r.to),!s)return an.none}let a=[];for(let l of t.visibleRanges){let u=new v0(i.doc,s,l.from,l.to);for(;!u.next().done;){let{from:d,to:p}=u.value;if((!o||sW(o,i,d,p))&&(r.empty&&d<=r.from&&p>=r.to?a.push(pme.range(d,p)):(d>=r.to||p<=r.from)&&a.push(fme.range(d,p)),a.length>e.maxMatches))return an.none}}return an.set(a)}},{decorations:t=>t.decorations}),vme=Li.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),yme=({state:t,dispatch:e})=>{let{selection:i}=t,n=Kt.create(i.ranges.map(r=>t.wordAt(r.head)||Kt.cursor(r.head)),i.mainIndex);return n.eq(i)?!1:(e(t.update({selection:n})),!0)};function xme(t,e){let{main:i,ranges:n}=t.selection,r=t.wordAt(i.head),s=r&&r.from==i.from&&r.to==i.to;for(let o=!1,a=new v0(t.doc,e,n[n.length-1].to);;)if(a.next(),a.done){if(o)return null;a=new v0(t.doc,e,0,Math.max(0,n[n.length-1].from-1)),o=!0}else{if(o&&n.some(l=>l.from==a.value.from))continue;if(s){let l=t.wordAt(a.value.from);if(!l||l.from!=a.value.from||l.to!=a.value.to)continue}return a.value}}const bme=({state:t,dispatch:e})=>{let{ranges:i}=t.selection;if(i.some(s=>s.from===s.to))return yme({state:t,dispatch:e});let n=t.sliceDoc(i[0].from,i[0].to);if(t.selection.ranges.some(s=>t.sliceDoc(s.from,s.to)!=n))return!1;let r=xme(t,n);return r?(e(t.update({selection:t.selection.addRange(Kt.range(r.from,r.to),!1),effects:Li.scrollIntoView(r.to)})),!0):!1},Y0=Fi.define({combine(t){return Fh(t,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new Ime(e),scrollToMatch:e=>Li.scrollIntoView(e)})}});class uK{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||ame(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(i,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new Sme(this):new _me(this)}getCursor(e,i=0,n){let r=e.doc?e:xs.create({doc:e});return n==null&&(n=r.doc.length),this.regexp?Ay(this,r,i,n):Ey(this,r,i,n)}}class hK{constructor(e){this.spec=e}}function Ey(t,e,i,n){return new v0(e.doc,t.unquoted,i,n,t.caseSensitive?void 0:r=>r.toLowerCase(),t.wholeWord?wme(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function wme(t,e){return(i,n,r,s)=>((s>i||s+r.length<n)&&(s=Math.max(0,i-2),r=t.sliceString(s,Math.min(t.length,n+2))),(e(uT(r,i-s))!=cs.Word||e(hT(r,i-s))!=cs.Word)&&(e(hT(r,n-s))!=cs.Word||e(uT(r,n-s))!=cs.Word))}class _me extends hK{constructor(e){super(e)}nextMatch(e,i,n){let r=Ey(this.spec,e,n,e.doc.length).nextOverlapping();if(r.done){let s=Math.min(e.doc.length,i+this.spec.unquoted.length);r=Ey(this.spec,e,0,s).nextOverlapping()}return r.done||r.value.from==i&&r.value.to==n?null:r.value}prevMatchInRange(e,i,n){for(let r=n;;){let s=Math.max(i,r-1e4-this.spec.unquoted.length),o=Ey(this.spec,e,s,r),a=null;for(;!o.nextOverlapping().done;)a=o.value;if(a)return a;if(s==i)return null;r-=1e4}}prevMatch(e,i,n){let r=this.prevMatchInRange(e,0,i);return r||(r=this.prevMatchInRange(e,Math.max(0,n-this.spec.unquoted.length),e.doc.length)),r&&(r.from!=i||r.to!=n)?r:null}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,i){let n=Ey(this.spec,e,0,e.doc.length),r=[];for(;!n.next().done;){if(r.length>=i)return null;r.push(n.value)}return r}highlight(e,i,n,r){let s=Ey(this.spec,e,Math.max(0,i-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,e.doc.length));for(;!s.next().done;)r(s.value.from,s.value.to)}}function Ay(t,e,i,n){return new lK(e.doc,t.search,{ignoreCase:!t.caseSensitive,test:t.wholeWord?Cme(e.charCategorizer(e.selection.main.head)):void 0},i,n)}function uT(t,e){return t.slice(Qo(t,e,!1),e)}function hT(t,e){return t.slice(e,Qo(t,e))}function Cme(t){return(e,i,n)=>!n[0].length||(t(uT(n.input,n.index))!=cs.Word||t(hT(n.input,n.index))!=cs.Word)&&(t(hT(n.input,n.index+n[0].length))!=cs.Word||t(uT(n.input,n.index+n[0].length))!=cs.Word)}class Sme extends hK{nextMatch(e,i,n){let r=Ay(this.spec,e,n,e.doc.length).next();return r.done&&(r=Ay(this.spec,e,0,i).next()),r.done?null:r.value}prevMatchInRange(e,i,n){for(let r=1;;r++){let s=Math.max(i,n-r*1e4),o=Ay(this.spec,e,s,n),a=null;for(;!o.next().done;)a=o.value;if(a&&(s==i||a.from>s+10))return a;if(s==i)return null}}prevMatch(e,i,n){return this.prevMatchInRange(e,0,i)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,(i,n)=>{if(n=="&")return e.match[0];if(n=="$")return"$";for(let r=n.length;r>0;r--){let s=+n.slice(0,r);if(s>0&&s<e.match.length)return e.match[s]+n.slice(r)}return i})}matchAll(e,i){let n=Ay(this.spec,e,0,e.doc.length),r=[];for(;!n.next().done;){if(r.length>=i)return null;r.push(n.value)}return r}highlight(e,i,n,r){let s=Ay(this.spec,e,Math.max(0,i-250),Math.min(n+250,e.doc.length));for(;!s.next().done;)r(s.value.from,s.value.to)}}const I_=_n.define(),EG=_n.define(),pp=Do.define({create(t){return new FF(iz(t).create(),null)},update(t,e){for(let i of e.effects)i.is(I_)?t=new FF(i.value.create(),t.panel):i.is(EG)&&(t=new FF(t.query,i.value?AG:null));return t},provide:t=>P_.from(t,e=>e.panel)});class FF{constructor(e,i){this.query=e,this.panel=i}}const Ome=an.mark({class:"cm-searchMatch"}),Mme=an.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Tme=$s.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(pp))}update(t){let e=t.state.field(pp);(e!=t.startState.field(pp)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return an.none;let{view:i}=this,n=new Vd;for(let r=0,s=i.visibleRanges,o=s.length;r<o;r++){let{from:a,to:l}=s[r];for(;r<o-1&&l>s[r+1].from-2*250;)l=s[++r].to;t.highlight(i.state,a,l,(u,d)=>{let p=i.state.selection.ranges.some(v=>v.from==u&&v.to==d);n.add(u,d,p?Mme:Ome)})}return n.finish()}},{decorations:t=>t.decorations});function AC(t){return e=>{let i=e.state.field(pp,!1);return i&&i.query.spec.valid?t(e,i):pK(e)}}const dT=AC((t,{query:e})=>{let{to:i}=t.state.selection.main,n=e.nextMatch(t.state,i,i);if(!n)return!1;let r=Kt.single(n.from,n.to),s=t.state.facet(Y0);return t.dispatch({selection:r,effects:[IG(t,n),s.scrollToMatch(r.main,t)],userEvent:"select.search"}),fK(t),!0}),fT=AC((t,{query:e})=>{let{state:i}=t,{from:n}=i.selection.main,r=e.prevMatch(i,n,n);if(!r)return!1;let s=Kt.single(r.from,r.to),o=t.state.facet(Y0);return t.dispatch({selection:s,effects:[IG(t,r),o.scrollToMatch(s.main,t)],userEvent:"select.search"}),fK(t),!0}),Rme=AC((t,{query:e})=>{let i=e.matchAll(t.state,1e3);return!i||!i.length?!1:(t.dispatch({selection:Kt.create(i.map(n=>Kt.range(n.from,n.to))),userEvent:"select.search.matches"}),!0)}),Pme=({state:t,dispatch:e})=>{let i=t.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:n,to:r}=i.main,s=[],o=0;for(let a=new v0(t.doc,t.sliceDoc(n,r));!a.next().done;){if(s.length>1e3)return!1;a.value.from==n&&(o=s.length),s.push(Kt.range(a.value.from,a.value.to))}return e(t.update({selection:Kt.create(s,o),userEvent:"select.search.matches"})),!0},oW=AC((t,{query:e})=>{let{state:i}=t,{from:n,to:r}=i.selection.main;if(i.readOnly)return!1;let s=e.nextMatch(i,n,n);if(!s)return!1;let o=s,a=[],l,u,d=[];if(o.from==n&&o.to==r&&(u=i.toText(e.getReplacement(o)),a.push({from:o.from,to:o.to,insert:u}),o=e.nextMatch(i,o.from,o.to),d.push(Li.announce.of(i.phrase("replaced match on line $",i.doc.lineAt(n).number)+"."))),o){let p=a.length==0||a[0].from>=s.to?0:s.to-s.from-u.length;l=Kt.single(o.from-p,o.to-p),d.push(IG(t,o)),d.push(i.facet(Y0).scrollToMatch(l.main,t))}return t.dispatch({changes:a,selection:l,effects:d,userEvent:"input.replace"}),!0}),Eme=AC((t,{query:e})=>{if(t.state.readOnly)return!1;let i=e.matchAll(t.state,1e9).map(r=>{let{from:s,to:o}=r;return{from:s,to:o,insert:e.getReplacement(r)}});if(!i.length)return!1;let n=t.state.phrase("replaced $ matches",i.length)+".";return t.dispatch({changes:i,effects:Li.announce.of(n),userEvent:"input.replace.all"}),!0});function AG(t){return t.state.facet(Y0).createPanel(t)}function iz(t,e){var i,n,r,s,o;let a=t.selection.main,l=a.empty||a.to>a.from+100?"":t.sliceDoc(a.from,a.to);if(e&&!l)return e;let u=t.facet(Y0);return new uK({search:((i=e?.literal)!==null&&i!==void 0?i:u.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:(n=e?.caseSensitive)!==null&&n!==void 0?n:u.caseSensitive,literal:(r=e?.literal)!==null&&r!==void 0?r:u.literal,regexp:(s=e?.regexp)!==null&&s!==void 0?s:u.regexp,wholeWord:(o=e?.wholeWord)!==null&&o!==void 0?o:u.wholeWord})}function dK(t){let e=R_(t,AG);return e&&e.dom.querySelector("[main-field]")}function fK(t){let e=dK(t);e&&e==t.root.activeElement&&e.select()}const pK=t=>{let e=t.state.field(pp,!1);if(e&&e.panel){let i=dK(t);if(i&&i!=t.root.activeElement){let n=iz(t.state,e.query.spec);n.valid&&t.dispatch({effects:I_.of(n)}),i.focus(),i.select()}}else t.dispatch({effects:[EG.of(!0),e?I_.of(iz(t.state,e.query.spec)):_n.appendConfig.of(Dme)]});return!0},mK=t=>{let e=t.state.field(pp,!1);if(!e||!e.panel)return!1;let i=R_(t,AG);return i&&i.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:EG.of(!1)}),!0},Ame=[{key:"Mod-f",run:pK,scope:"editor search-panel"},{key:"F3",run:dT,shift:fT,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:dT,shift:fT,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:mK,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Pme},{key:"Mod-Alt-g",run:lme},{key:"Mod-d",run:bme,preventDefault:!0}];class Ime{constructor(e){this.view=e;let i=this.query=e.state.field(pp).query.spec;this.commit=this.commit.bind(this),this.searchField=Dr("input",{value:i.search,placeholder:Ll(e,"Find"),"aria-label":Ll(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=Dr("input",{value:i.replace,placeholder:Ll(e,"Replace"),"aria-label":Ll(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=Dr("input",{type:"checkbox",name:"case",form:"",checked:i.caseSensitive,onchange:this.commit}),this.reField=Dr("input",{type:"checkbox",name:"re",form:"",checked:i.regexp,onchange:this.commit}),this.wordField=Dr("input",{type:"checkbox",name:"word",form:"",checked:i.wholeWord,onchange:this.commit});function n(r,s,o){return Dr("button",{class:"cm-button",name:r,onclick:s,type:"button"},o)}this.dom=Dr("div",{onkeydown:r=>this.keydown(r),class:"cm-search"},[this.searchField,n("next",()=>dT(e),[Ll(e,"next")]),n("prev",()=>fT(e),[Ll(e,"previous")]),n("select",()=>Rme(e),[Ll(e,"all")]),Dr("label",null,[this.caseField,Ll(e,"match case")]),Dr("label",null,[this.reField,Ll(e,"regexp")]),Dr("label",null,[this.wordField,Ll(e,"by word")]),...e.state.readOnly?[]:[Dr("br"),this.replaceField,n("replace",()=>oW(e),[Ll(e,"replace")]),n("replaceAll",()=>Eme(e),[Ll(e,"replace all")])],Dr("button",{name:"close",onclick:()=>mK(e),"aria-label":Ll(e,"close"),type:"button"},["Ã"])])}commit(){let e=new uK({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:I_.of(e)}))}keydown(e){Bhe(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?fT:dT)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),oW(this.view))}update(e){for(let i of e.transactions)for(let n of i.effects)n.is(I_)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(Y0).top}}function Ll(t,e){return t.state.phrase(e)}const B1=30,z1=/[\s\.,:;?!]/;function IG(t,{from:e,to:i}){let n=t.state.doc.lineAt(e),r=t.state.doc.lineAt(i).to,s=Math.max(n.from,e-B1),o=Math.min(r,i+B1),a=t.state.sliceDoc(s,o);if(s!=n.from){for(let l=0;l<B1;l++)if(!z1.test(a[l+1])&&z1.test(a[l])){a=a.slice(l);break}}if(o!=r){for(let l=a.length-1;l>a.length-B1;l--)if(!z1.test(a[l-1])&&z1.test(a[l])){a=a.slice(0,l);break}}return Li.announce.of(`${t.state.phrase("current match")}. ${a} ${t.state.phrase("on line")} ${n.number}.`)}const kme=Li.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),Dme=[pp,kp.low(Tme),kme];class gK{constructor(e,i,n,r){this.state=e,this.pos=i,this.explicit=n,this.view=r,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(e){let i=mo(this.state).resolveInner(this.pos,-1);for(;i&&e.indexOf(i.name)<0;)i=i.parent;return i?{from:i.from,to:this.pos,text:this.state.sliceDoc(i.from,this.pos),type:i.type}:null}matchBefore(e){let i=this.state.doc.lineAt(this.pos),n=Math.max(i.from,this.pos-250),r=i.text.slice(n-i.from,this.pos-i.from),s=r.search(yK(e,!1));return s<0?null:{from:n+s,to:this.pos,text:r.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(e,i,n){e=="abort"&&this.abortListeners&&(this.abortListeners.push(i),n&&n.onDocChange&&(this.abortOnDocChange=!0))}}function aW(t){let e=Object.keys(t).join(""),i=/\w/.test(e);return i&&(e=e.replace(/\w/g,"")),`[${i?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function Lme(t){let e=Object.create(null),i=Object.create(null);for(let{label:r}of t){e[r[0]]=!0;for(let s=1;s<r.length;s++)i[r[s]]=!0}let n=aW(e)+aW(i)+"*$";return[new RegExp("^"+n),new RegExp(n)]}function vK(t){let e=t.map(r=>typeof r=="string"?{label:r}:r),[i,n]=e.every(r=>/^\w+$/.test(r.label))?[/\w*$/,/\w+$/]:Lme(e);return r=>{let s=r.matchBefore(n);return s||r.explicit?{from:s?s.from:r.pos,options:e,validFor:i}:null}}function Fme(t,e){return i=>{for(let n=mo(i.state).resolveInner(i.pos,-1);n;n=n.parent){if(t.indexOf(n.name)>-1)return null;if(n.type.isTop)break}return e(i)}}class lW{constructor(e,i,n,r){this.completion=e,this.source=i,this.match=n,this.score=r}}function lg(t){return t.selection.main.from}function yK(t,e){var i;let{source:n}=t,r=e&&n[0]!="^",s=n[n.length-1]!="$";return!r&&!s?t:new RegExp(`${r?"^":""}(?:${n})${s?"$":""}`,(i=t.flags)!==null&&i!==void 0?i:t.ignoreCase?"i":"")}const kG=ef.define();function Nme(t,e,i,n){let{main:r}=t.selection,s=i-r.from,o=n-r.from;return Object.assign(Object.assign({},t.changeByRange(a=>{if(a!=r&&i!=n&&t.sliceDoc(a.from+s,a.from+o)!=t.sliceDoc(i,n))return{range:a};let l=t.toText(e);return{changes:{from:a.from+s,to:n==r.from?a.to:a.from+o,insert:l},range:Kt.cursor(a.from+s+l.length)}})),{scrollIntoView:!0,userEvent:"input.complete"})}const cW=new WeakMap;function Bme(t){if(!Array.isArray(t))return t;let e=cW.get(t);return e||cW.set(t,e=vK(t)),e}const pT=_n.define(),k_=_n.define();class zme{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let i=0;i<e.length;){let n=al(e,i),r=sh(n);this.chars.push(n);let s=e.slice(i,i+r),o=s.toUpperCase();this.folded.push(al(o==s?s.toLowerCase():o,0)),i+=r}this.astral=e.length!=this.chars.length}ret(e,i){return this.score=e,this.matched=i,this}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return null;let{chars:i,folded:n,any:r,precise:s,byWord:o}=this;if(i.length==1){let N=al(e,0),F=sh(N),k=F==e.length?0:-100;if(N!=i[0])if(N==n[0])k+=-200;else return null;return this.ret(k,[0,F])}let a=e.indexOf(this.pattern);if(a==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let l=i.length,u=0;if(a<0){for(let N=0,F=Math.min(e.length,200);N<F&&u<l;){let k=al(e,N);(k==i[u]||k==n[u])&&(r[u++]=N),N+=sh(k)}if(u<l)return null}let d=0,p=0,v=!1,y=0,w=-1,R=-1,O=/[a-z]/.test(e),P=!0;for(let N=0,F=Math.min(e.length,200),k=0;N<F&&p<l;){let $=al(e,N);a<0&&(d<l&&$==i[d]&&(s[d++]=N),y<l&&($==i[y]||$==n[y]?(y==0&&(w=N),R=N+1,y++):y=0));let W,Q=$<255?$>=48&&$<=57||$>=97&&$<=122?2:$>=65&&$<=90?1:0:(W=nG($))!=W.toLowerCase()?1:W!=W.toUpperCase()?2:0;(!N||Q==1&&O||k==0&&Q!=0)&&(i[p]==$||n[p]==$&&(v=!0)?o[p++]=N:o.length&&(P=!1)),k=Q,N+=sh($)}return p==l&&o[0]==0&&P?this.result(-100+(v?-200:0),o,e):y==l&&w==0?this.ret(-200-e.length+(R==e.length?0:-100),[0,R]):a>-1?this.ret(-700-e.length,[a,a+this.pattern.length]):y==l?this.ret(-900-e.length,[w,R]):p==l?this.result(-100+(v?-200:0)+-700+(P?0:-1100),o,e):i.length==2?null:this.result((r[0]?-700:0)+-200+-1100,r,e)}result(e,i,n){let r=[],s=0;for(let o of i){let a=o+(this.astral?sh(al(n,o)):1);s&&r[s-1]==o?r[s-1]=a:(r[s++]=o,r[s++]=a)}return this.ret(e-n.length,r)}}class Vme{constructor(e){this.pattern=e,this.matched=[],this.score=0,this.folded=e.toLowerCase()}match(e){if(e.length<this.pattern.length)return null;let i=e.slice(0,this.pattern.length),n=i==this.pattern?0:i.toLowerCase()==this.folded?-200:null;return n==null?null:(this.matched=[0,i.length],this.score=n+(e.length==this.pattern.length?0:-100),this)}}const Eo=Fi.define({combine(t){return Fh(t,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:Gme,filterStrict:!1,compareCompletions:(e,i)=>e.label.localeCompare(i.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,i)=>e&&i,closeOnBlur:(e,i)=>e&&i,icons:(e,i)=>e&&i,tooltipClass:(e,i)=>n=>uW(e(n),i(n)),optionClass:(e,i)=>n=>uW(e(n),i(n)),addToOptions:(e,i)=>e.concat(i),filterStrict:(e,i)=>e||i})}});function uW(t,e){return t?e?t+" "+e:t:e}function Gme(t,e,i,n,r,s){let o=t.textDirection==Yr.RTL,a=o,l=!1,u="top",d,p,v=e.left-r.left,y=r.right-e.right,w=n.right-n.left,R=n.bottom-n.top;if(a&&v<Math.min(w,y)?a=!1:!a&&y<Math.min(w,v)&&(a=!0),w<=(a?v:y))d=Math.max(r.top,Math.min(i.top,r.bottom-R))-e.top,p=Math.min(400,a?v:y);else{l=!0,p=Math.min(400,(o?e.right:r.right-e.left)-30);let N=r.bottom-e.bottom;N>=R||N>e.top?d=i.bottom-e.top:(u="bottom",d=e.bottom-i.top)}let O=(e.bottom-e.top)/s.offsetHeight,P=(e.right-e.left)/s.offsetWidth;return{style:`${u}: ${d/O}px; max-width: ${p/P}px`,class:"cm-completionInfo-"+(l?o?"left-narrow":"right-narrow":a?"left":"right")}}function Ume(t){let e=t.addToOptions.slice();return t.icons&&e.push({render(i){let n=document.createElement("div");return n.classList.add("cm-completionIcon"),i.type&&n.classList.add(...i.type.split(/\s+/g).map(r=>"cm-completionIcon-"+r)),n.setAttribute("aria-hidden","true"),n},position:20}),e.push({render(i,n,r,s){let o=document.createElement("span");o.className="cm-completionLabel";let a=i.displayLabel||i.label,l=0;for(let u=0;u<s.length;){let d=s[u++],p=s[u++];d>l&&o.appendChild(document.createTextNode(a.slice(l,d)));let v=o.appendChild(document.createElement("span"));v.appendChild(document.createTextNode(a.slice(d,p))),v.className="cm-completionMatchedText",l=p}return l<a.length&&o.appendChild(document.createTextNode(a.slice(l))),o},position:50},{render(i){if(!i.detail)return null;let n=document.createElement("span");return n.className="cm-completionDetail",n.textContent=i.detail,n},position:80}),e.sort((i,n)=>i.position-n.position).map(i=>i.render)}function NF(t,e,i){if(t<=i)return{from:0,to:t};if(e<0&&(e=0),e<=t>>1){let r=Math.floor(e/i);return{from:r*i,to:(r+1)*i}}let n=Math.floor((t-e)/i);return{from:t-(n+1)*i,to:t-n*i}}class Hme{constructor(e,i,n){this.view=e,this.stateField=i,this.applyCompletion=n,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:l=>this.placeInfo(l),key:this},this.space=null,this.currentClass="";let r=e.state.field(i),{options:s,selected:o}=r.open,a=e.state.facet(Eo);this.optionContent=Ume(a),this.optionClass=a.optionClass,this.tooltipClass=a.tooltipClass,this.range=NF(s.length,o,a.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",l=>{let{options:u}=e.state.field(i).open;for(let d=l.target,p;d&&d!=this.dom;d=d.parentNode)if(d.nodeName=="LI"&&(p=/-(\d+)$/.exec(d.id))&&+p[1]<u.length){this.applyCompletion(e,u[+p[1]]),l.preventDefault();return}}),this.dom.addEventListener("focusout",l=>{let u=e.state.field(this.stateField,!1);u&&u.tooltip&&e.state.facet(Eo).closeOnBlur&&l.relatedTarget!=e.contentDOM&&e.dispatch({effects:k_.of(null)})}),this.showOptions(s,r.id)}mount(){this.updateSel()}showOptions(e,i){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,i,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var i;let n=e.state.field(this.stateField),r=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),n!=r){let{options:s,selected:o,disabled:a}=n.open;(!r.open||r.open.options!=s)&&(this.range=NF(s.length,o,e.state.facet(Eo).maxRenderedOptions),this.showOptions(s,n.id)),this.updateSel(),a!=((i=r.open)===null||i===void 0?void 0:i.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!a)}}updateTooltipClass(e){let i=this.tooltipClass(e);if(i!=this.currentClass){for(let n of this.currentClass.split(" "))n&&this.dom.classList.remove(n);for(let n of i.split(" "))n&&this.dom.classList.add(n);this.currentClass=i}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),i=e.open;if((i.selected>-1&&i.selected<this.range.from||i.selected>=this.range.to)&&(this.range=NF(i.options.length,i.selected,this.view.state.facet(Eo).maxRenderedOptions),this.showOptions(i.options,e.id)),this.updateSelectedOption(i.selected)){this.destroyInfo();let{completion:n}=i.options[i.selected],{info:r}=n;if(!r)return;let s=typeof r=="string"?document.createTextNode(r):r(n);if(!s)return;"then"in s?s.then(o=>{o&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(o,n)}).catch(o=>fl(this.view.state,o,"completion info")):this.addInfoPane(s,n)}}addInfoPane(e,i){this.destroyInfo();let n=this.info=document.createElement("div");if(n.className="cm-tooltip cm-completionInfo",e.nodeType!=null)n.appendChild(e),this.infoDestroy=null;else{let{dom:r,destroy:s}=e;n.appendChild(r),this.infoDestroy=s||null}this.dom.appendChild(n),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let i=null;for(let n=this.list.firstChild,r=this.range.from;n;n=n.nextSibling,r++)n.nodeName!="LI"||!n.id?r--:r==e?n.hasAttribute("aria-selected")||(n.setAttribute("aria-selected","true"),i=n):n.hasAttribute("aria-selected")&&n.removeAttribute("aria-selected");return i&&Wme(this.list,i),i}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let i=this.dom.getBoundingClientRect(),n=this.info.getBoundingClientRect(),r=e.getBoundingClientRect(),s=this.space;if(!s){let o=this.dom.ownerDocument.documentElement;s={left:0,top:0,right:o.clientWidth,bottom:o.clientHeight}}return r.top>Math.min(s.bottom,i.bottom)-10||r.bottom<Math.max(s.top,i.top)+10?null:this.view.state.facet(Eo).positionInfo(this.view,i,r,n,s,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,i,n){const r=document.createElement("ul");r.id=i,r.setAttribute("role","listbox"),r.setAttribute("aria-expanded","true"),r.setAttribute("aria-label",this.view.state.phrase("Completions")),r.addEventListener("mousedown",o=>{o.target==r&&o.preventDefault()});let s=null;for(let o=n.from;o<n.to;o++){let{completion:a,match:l}=e[o],{section:u}=a;if(u){let v=typeof u=="string"?u:u.name;if(v!=s&&(o>n.from||n.from==0))if(s=v,typeof u!="string"&&u.header)r.appendChild(u.header(u));else{let y=r.appendChild(document.createElement("completion-section"));y.textContent=v}}const d=r.appendChild(document.createElement("li"));d.id=i+"-"+o,d.setAttribute("role","option");let p=this.optionClass(a);p&&(d.className=p);for(let v of this.optionContent){let y=v(a,this.view.state,this.view,l);y&&d.appendChild(y)}}return n.from&&r.classList.add("cm-completionListIncompleteTop"),n.to<e.length&&r.classList.add("cm-completionListIncompleteBottom"),r}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function $me(t,e){return i=>new Hme(i,t,e)}function Wme(t,e){let i=t.getBoundingClientRect(),n=e.getBoundingClientRect(),r=i.height/t.offsetHeight;n.top<i.top?t.scrollTop-=(i.top-n.top)/r:n.bottom>i.bottom&&(t.scrollTop+=(n.bottom-i.bottom)/r)}function hW(t){return(t.boost||0)*100+(t.apply?10:0)+(t.info?5:0)+(t.type?1:0)}function qme(t,e){let i=[],n=null,r=u=>{i.push(u);let{section:d}=u.completion;if(d){n||(n=[]);let p=typeof d=="string"?d:d.name;n.some(v=>v.name==p)||n.push(typeof d=="string"?{name:p}:d)}},s=e.facet(Eo);for(let u of t)if(u.hasResult()){let d=u.result.getMatch;if(u.result.filter===!1)for(let p of u.result.options)r(new lW(p,u.source,d?d(p):[],1e9-i.length));else{let p=e.sliceDoc(u.from,u.to),v,y=s.filterStrict?new Vme(p):new zme(p);for(let w of u.result.options)if(v=y.match(w.label)){let R=w.displayLabel?d?d(w,v.matched):[]:v.matched;r(new lW(w,u.source,R,v.score+(w.boost||0)))}}}if(n){let u=Object.create(null),d=0,p=(v,y)=>{var w,R;return((w=v.rank)!==null&&w!==void 0?w:1e9)-((R=y.rank)!==null&&R!==void 0?R:1e9)||(v.name<y.name?-1:1)};for(let v of n.sort(p))d-=1e5,u[v.name]=d;for(let v of i){let{section:y}=v.completion;y&&(v.score+=u[typeof y=="string"?y:y.name])}}let o=[],a=null,l=s.compareCompletions;for(let u of i.sort((d,p)=>p.score-d.score||l(d.completion,p.completion))){let d=u.completion;!a||a.label!=d.label||a.detail!=d.detail||a.type!=null&&d.type!=null&&a.type!=d.type||a.apply!=d.apply||a.boost!=d.boost?o.push(u):hW(u.completion)>hW(a)&&(o[o.length-1]=u),a=u.completion}return o}class Vy{constructor(e,i,n,r,s,o){this.options=e,this.attrs=i,this.tooltip=n,this.timestamp=r,this.selected=s,this.disabled=o}setSelected(e,i){return e==this.selected||e>=this.options.length?this:new Vy(this.options,dW(i,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,i,n,r,s,o){if(r&&!o&&e.some(u=>u.isPending))return r.setDisabled();let a=qme(e,i);if(!a.length)return r&&e.some(u=>u.isPending)?r.setDisabled():null;let l=i.facet(Eo).selectOnOpen?0:-1;if(r&&r.selected!=l&&r.selected!=-1){let u=r.options[r.selected].completion;for(let d=0;d<a.length;d++)if(a[d].completion==u){l=d;break}}return new Vy(a,dW(n,l),{pos:e.reduce((u,d)=>d.hasResult()?Math.min(u,d.from):u,1e8),create:Yme,above:s.aboveCursor},r?r.timestamp:Date.now(),l,!1)}map(e){return new Vy(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}setDisabled(){return new Vy(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class mT{constructor(e,i,n){this.active=e,this.id=i,this.open=n}static start(){return new mT(Xme,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:i}=e,n=i.facet(Eo),s=(n.override||i.languageDataAt("autocomplete",lg(i)).map(Bme)).map(l=>(this.active.find(d=>d.source==l)||new Ac(l,this.active.some(d=>d.state!=0)?1:0)).update(e,n));s.length==this.active.length&&s.every((l,u)=>l==this.active[u])&&(s=this.active);let o=this.open,a=e.effects.some(l=>l.is(DG));o&&e.docChanged&&(o=o.map(e.changes)),e.selection||s.some(l=>l.hasResult()&&e.changes.touchesRange(l.from,l.to))||!jme(s,this.active)||a?o=Vy.build(s,i,this.id,o,n,a):o&&o.disabled&&!s.some(l=>l.isPending)&&(o=null),!o&&s.every(l=>!l.isPending)&&s.some(l=>l.hasResult())&&(s=s.map(l=>l.hasResult()?new Ac(l.source,0):l));for(let l of e.effects)l.is(bK)&&(o=o&&o.setSelected(l.value,this.id));return s==this.active&&o==this.open?this:new mT(s,this.id,o)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?Qme:Zme}}function jme(t,e){if(t==e)return!0;for(let i=0,n=0;;){for(;i<t.length&&!t[i].hasResult();)i++;for(;n<e.length&&!e[n].hasResult();)n++;let r=i==t.length,s=n==e.length;if(r||s)return r==s;if(t[i++].result!=e[n++].result)return!1}}const Qme={"aria-autocomplete":"list"},Zme={};function dW(t,e){let i={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":t};return e>-1&&(i["aria-activedescendant"]=t+"-"+e),i}const Xme=[];function xK(t,e){if(t.isUserEvent("input.complete")){let n=t.annotation(kG);if(n&&e.activateOnCompletion(n))return 12}let i=t.isUserEvent("input.type");return i&&e.activateOnTyping?5:i?1:t.isUserEvent("delete.backward")?2:t.selection?8:t.docChanged?16:0}class Ac{constructor(e,i,n=!1){this.source=e,this.state=i,this.explicit=n}hasResult(){return!1}get isPending(){return this.state==1}update(e,i){let n=xK(e,i),r=this;(n&8||n&16&&this.touches(e))&&(r=new Ac(r.source,0)),n&4&&r.state==0&&(r=new Ac(this.source,1)),r=r.updateFor(e,n);for(let s of e.effects)if(s.is(pT))r=new Ac(r.source,1,s.value);else if(s.is(k_))r=new Ac(r.source,0);else if(s.is(DG))for(let o of s.value)o.source==r.source&&(r=o);return r}updateFor(e,i){return this.map(e.changes)}map(e){return this}touches(e){return e.changes.touchesRange(lg(e.state))}}class Ky extends Ac{constructor(e,i,n,r,s,o){super(e,3,i),this.limit=n,this.result=r,this.from=s,this.to=o}hasResult(){return!0}updateFor(e,i){var n;if(!(i&3))return this.map(e.changes);let r=this.result;r.map&&!e.changes.empty&&(r=r.map(r,e.changes));let s=e.changes.mapPos(this.from),o=e.changes.mapPos(this.to,1),a=lg(e.state);if(a>o||!r||i&2&&(lg(e.startState)==this.from||a<this.limit))return new Ac(this.source,i&4?1:0);let l=e.changes.mapPos(this.limit);return Kme(r.validFor,e.state,s,o)?new Ky(this.source,this.explicit,l,r,s,o):r.update&&(r=r.update(r,s,o,new gK(e.state,a,!1)))?new Ky(this.source,this.explicit,l,r,r.from,(n=r.to)!==null&&n!==void 0?n:lg(e.state)):new Ac(this.source,1,this.explicit)}map(e){return e.empty?this:(this.result.map?this.result.map(this.result,e):this.result)?new Ky(this.source,this.explicit,e.mapPos(this.limit),this.result,e.mapPos(this.from),e.mapPos(this.to,1)):new Ac(this.source,0)}touches(e){return e.changes.touchesRange(this.from,this.to)}}function Kme(t,e,i,n){if(!t)return!1;let r=e.sliceDoc(i,n);return typeof t=="function"?t(r,i,n,e):yK(t,!0).test(r)}const DG=_n.define({map(t,e){return t.map(i=>i.map(e))}}),bK=_n.define(),cl=Do.define({create(){return mT.start()},update(t,e){return t.update(e)},provide:t=>[yG.from(t,e=>e.tooltip),Li.contentAttributes.from(t,e=>e.attrs)]});function LG(t,e){const i=e.completion.apply||e.completion.label;let n=t.state.field(cl).active.find(r=>r.source==e.source);return n instanceof Ky?(typeof i=="string"?t.dispatch(Object.assign(Object.assign({},Nme(t.state,i,n.from,n.to)),{annotations:kG.of(e.completion)})):i(t,e.completion,n.from,n.to),!0):!1}const Yme=$me(cl,LG);function V1(t,e="option"){return i=>{let n=i.state.field(cl,!1);if(!n||!n.open||n.open.disabled||Date.now()-n.open.timestamp<i.state.facet(Eo).interactionDelay)return!1;let r=1,s;e=="page"&&(s=Y7(i,n.open.tooltip))&&(r=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:o}=n.open.options,a=n.open.selected>-1?n.open.selected+r*(t?1:-1):t?0:o-1;return a<0?a=e=="page"?0:o-1:a>=o&&(a=e=="page"?o-1:0),i.dispatch({effects:bK.of(a)}),!0}}const Jme=t=>{let e=t.state.field(cl,!1);return t.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<t.state.facet(Eo).interactionDelay?!1:LG(t,e.open.options[e.open.selected])},fW=t=>t.state.field(cl,!1)?(t.dispatch({effects:pT.of(!0)}),!0):!1,ege=t=>{let e=t.state.field(cl,!1);return!e||!e.active.some(i=>i.state!=0)?!1:(t.dispatch({effects:k_.of(null)}),!0)};class tge{constructor(e,i){this.active=e,this.context=i,this.time=Date.now(),this.updates=[],this.done=void 0}}const ige=50,nge=1e3,rge=$s.fromClass(class{constructor(t){this.view=t,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let e of t.state.field(cl).active)e.isPending&&this.startQuery(e)}update(t){let e=t.state.field(cl),i=t.state.facet(Eo);if(!t.selectionSet&&!t.docChanged&&t.startState.field(cl)==e)return;let n=t.transactions.some(s=>{let o=xK(s,i);return o&8||(s.selection||s.docChanged)&&!(o&3)});for(let s=0;s<this.running.length;s++){let o=this.running[s];if(n||o.context.abortOnDocChange&&t.docChanged||o.updates.length+t.transactions.length>ige&&Date.now()-o.time>nge){for(let a of o.context.abortListeners)try{a()}catch(l){fl(this.view.state,l)}o.context.abortListeners=null,this.running.splice(s--,1)}else o.updates.push(...t.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),t.transactions.some(s=>s.effects.some(o=>o.is(pT)))&&(this.pendingStart=!0);let r=this.pendingStart?50:i.activateOnTypingDelay;if(this.debounceUpdate=e.active.some(s=>s.isPending&&!this.running.some(o=>o.active.source==s.source))?setTimeout(()=>this.startUpdate(),r):-1,this.composing!=0)for(let s of t.transactions)s.isUserEvent("input.type")?this.composing=2:this.composing==2&&s.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:t}=this.view,e=t.field(cl);for(let i of e.active)i.isPending&&!this.running.some(n=>n.active.source==i.source)&&this.startQuery(i);this.running.length&&e.open&&e.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(Eo).updateSyncTime))}startQuery(t){let{state:e}=this.view,i=lg(e),n=new gK(e,i,t.explicit,this.view),r=new tge(t,n);this.running.push(r),Promise.resolve(t.source(n)).then(s=>{r.context.aborted||(r.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:k_.of(null)}),fl(this.view.state,s)})}scheduleAccept(){this.running.every(t=>t.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(Eo).updateSyncTime))}accept(){var t;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],i=this.view.state.facet(Eo),n=this.view.state.field(cl);for(let r=0;r<this.running.length;r++){let s=this.running[r];if(s.done===void 0)continue;if(this.running.splice(r--,1),s.done){let a=lg(s.updates.length?s.updates[0].startState:this.view.state),l=Math.min(a,s.done.from+(s.active.explicit?0:1)),u=new Ky(s.active.source,s.active.explicit,l,s.done,s.done.from,(t=s.done.to)!==null&&t!==void 0?t:a);for(let d of s.updates)u=u.update(d,i);if(u.hasResult()){e.push(u);continue}}let o=n.active.find(a=>a.source==s.active.source);if(o&&o.isPending)if(s.done==null){let a=new Ac(s.active.source,0);for(let l of s.updates)a=a.update(l,i);a.isPending||e.push(a)}else this.startQuery(o)}(e.length||n.open&&n.open.disabled)&&this.view.dispatch({effects:DG.of(e)})}},{eventHandlers:{blur(t){let e=this.view.state.field(cl,!1);if(e&&e.tooltip&&this.view.state.facet(Eo).closeOnBlur){let i=e.open&&Y7(this.view,e.open.tooltip);(!i||!i.dom.contains(t.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:k_.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:pT.of(!1)}),20),this.composing=0}}}),sge=typeof navigator=="object"&&/Win/.test(navigator.platform),oge=kp.highest(Li.domEventHandlers({keydown(t,e){let i=e.state.field(cl,!1);if(!i||!i.open||i.open.disabled||i.open.selected<0||t.key.length>1||t.ctrlKey&&!(sge&&t.altKey)||t.metaKey)return!1;let n=i.open.options[i.open.selected],r=i.active.find(o=>o.source==n.source),s=n.completion.commitCharacters||r.result.commitCharacters;return s&&s.indexOf(t.key)>-1&&LG(e,n),!1}})),wK=Li.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"Â·Â·Â·"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'Æ'"}},".cm-completionIcon-class":{"&:after":{content:"'â'"}},".cm-completionIcon-interface":{"&:after":{content:"'â'"}},".cm-completionIcon-variable":{"&:after":{content:"'ð¥'"}},".cm-completionIcon-constant":{"&:after":{content:"'ð¶'"}},".cm-completionIcon-type":{"&:after":{content:"'ð¡'"}},".cm-completionIcon-enum":{"&:after":{content:"'âª'"}},".cm-completionIcon-property":{"&:after":{content:"'â¡'"}},".cm-completionIcon-keyword":{"&:after":{content:"'ðï¸'"}},".cm-completionIcon-namespace":{"&:after":{content:"'â¢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class age{constructor(e,i,n,r){this.field=e,this.line=i,this.from=n,this.to=r}}class FG{constructor(e,i,n){this.field=e,this.from=i,this.to=n}map(e){let i=e.mapPos(this.from,-1,jo.TrackDel),n=e.mapPos(this.to,1,jo.TrackDel);return i==null||n==null?null:new FG(this.field,i,n)}}class NG{constructor(e,i){this.lines=e,this.fieldPositions=i}instantiate(e,i){let n=[],r=[i],s=e.doc.lineAt(i),o=/^\s*/.exec(s.text)[0];for(let l of this.lines){if(n.length){let u=o,d=/^\t*/.exec(l)[0].length;for(let p=0;p<d;p++)u+=e.facet(RC);r.push(i+u.length-d),l=u+l.slice(d)}n.push(l),i+=l.length+1}let a=this.fieldPositions.map(l=>new FG(l.field,r[l.line]+l.from,r[l.line]+l.to));return{text:n,ranges:a}}static parse(e){let i=[],n=[],r=[],s;for(let o of e.split(/\r\n?|\n/)){for(;s=/[#$]\{(?:(\d+)(?::([^}]*))?|((?:\\[{}]|[^}])*))\}/.exec(o);){let a=s[1]?+s[1]:null,l=s[2]||s[3]||"",u=-1,d=l.replace(/\\[{}]/g,p=>p[1]);for(let p=0;p<i.length;p++)(a!=null?i[p].seq==a:d&&i[p].name==d)&&(u=p);if(u<0){let p=0;for(;p<i.length&&(a==null||i[p].seq!=null&&i[p].seq<a);)p++;i.splice(p,0,{seq:a,name:d}),u=p;for(let v of r)v.field>=u&&v.field++}r.push(new age(u,n.length,s.index,s.index+d.length)),o=o.slice(0,s.index)+l+o.slice(s.index+s[0].length)}o=o.replace(/\\([{}])/g,(a,l,u)=>{for(let d of r)d.line==n.length&&d.from>u&&(d.from--,d.to--);return l}),n.push(o)}return new NG(n,r)}}let lge=an.widget({widget:new class extends Nh{toDOM(){let t=document.createElement("span");return t.className="cm-snippetFieldPosition",t}ignoreEvent(){return!1}}}),cge=an.mark({class:"cm-snippetField"});class J0{constructor(e,i){this.ranges=e,this.active=i,this.deco=an.set(e.map(n=>(n.from==n.to?lge:cge).range(n.from,n.to)))}map(e){let i=[];for(let n of this.ranges){let r=n.map(e);if(!r)return null;i.push(r)}return new J0(i,this.active)}selectionInsideField(e){return e.ranges.every(i=>this.ranges.some(n=>n.field==this.active&&n.from<=i.from&&n.to>=i.to))}}const IC=_n.define({map(t,e){return t&&t.map(e)}}),uge=_n.define(),D_=Do.define({create(){return null},update(t,e){for(let i of e.effects){if(i.is(IC))return i.value;if(i.is(uge)&&t)return new J0(t.ranges,i.value)}return t&&e.docChanged&&(t=t.map(e.changes)),t&&e.selection&&!t.selectionInsideField(e.selection)&&(t=null),t},provide:t=>Li.decorations.from(t,e=>e?e.deco:an.none)});function BG(t,e){return Kt.create(t.filter(i=>i.field==e).map(i=>Kt.range(i.from,i.to)))}function hge(t){let e=NG.parse(t);return(i,n,r,s)=>{let{text:o,ranges:a}=e.instantiate(i.state,r),{main:l}=i.state.selection,u={changes:{from:r,to:s==l.from?l.to:s,insert:fr.of(o)},scrollIntoView:!0,annotations:n?[kG.of(n),Va.userEvent.of("input.complete")]:void 0};if(a.length&&(u.selection=BG(a,0)),a.some(d=>d.field>0)){let d=new J0(a,0),p=u.effects=[IC.of(d)];i.state.field(D_,!1)===void 0&&p.push(_n.appendConfig.of([D_,gge,vge,wK]))}i.dispatch(i.state.update(u))}}function _K(t){return({state:e,dispatch:i})=>{let n=e.field(D_,!1);if(!n||t<0&&n.active==0)return!1;let r=n.active+t,s=t>0&&!n.ranges.some(o=>o.field==r+t);return i(e.update({selection:BG(n.ranges,r),effects:IC.of(s?null:new J0(n.ranges,r)),scrollIntoView:!0})),!0}}const dge=({state:t,dispatch:e})=>t.field(D_,!1)?(e(t.update({effects:IC.of(null)})),!0):!1,fge=_K(1),pge=_K(-1),mge=[{key:"Tab",run:fge,shift:pge},{key:"Escape",run:dge}],pW=Fi.define({combine(t){return t.length?t[0]:mge}}),gge=kp.highest(MC.compute([pW],t=>t.facet(pW)));function ol(t,e){return Object.assign(Object.assign({},e),{apply:hge(t)})}const vge=Li.domEventHandlers({mousedown(t,e){let i=e.state.field(D_,!1),n;if(!i||(n=e.posAtCoords({x:t.clientX,y:t.clientY}))==null)return!1;let r=i.ranges.find(s=>s.from<=n&&s.to>=n);return!r||r.field==i.active?!1:(e.dispatch({selection:BG(i.ranges,r.field),effects:IC.of(i.ranges.some(s=>s.field>r.field)?new J0(i.ranges,r.field):null),scrollIntoView:!0}),!0)}}),L_={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},Xm=_n.define({map(t,e){let i=e.mapPos(t,-1,jo.TrackAfter);return i??void 0}}),zG=new class extends Tg{};zG.startSide=1;zG.endSide=-1;const CK=Do.define({create(){return ur.empty},update(t,e){if(t=t.map(e.changes),e.selection){let i=e.state.doc.lineAt(e.selection.main.head);t=t.update({filter:n=>n>=i.from&&n<=i.to})}for(let i of e.effects)i.is(Xm)&&(t=t.update({add:[zG.range(i.value,i.value+1)]}));return t}});function yge(){return[bge,CK]}const BF="()[]{}<>Â«Â»Â»Â«ï¼»ï¼½ï½ï½";function SK(t){for(let e=0;e<BF.length;e+=2)if(BF.charCodeAt(e)==t)return BF.charAt(e+1);return nG(t<128?t:t+1)}function OK(t,e){return t.languageDataAt("closeBrackets",e)[0]||L_}const xge=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),bge=Li.inputHandler.of((t,e,i,n)=>{if((xge?t.composing:t.compositionStarted)||t.state.readOnly)return!1;let r=t.state.selection.main;if(n.length>2||n.length==2&&sh(al(n,0))==1||e!=r.from||i!=r.to)return!1;let s=Cge(t.state,n);return s?(t.dispatch(s),!0):!1}),wge=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=OK(t,t.selection.main.head).brackets||L_.brackets,r=null,s=t.changeByRange(o=>{if(o.empty){let a=Sge(t.doc,o.head);for(let l of n)if(l==a&&pP(t.doc,o.head)==SK(al(l,0)))return{changes:{from:o.head-l.length,to:o.head+l.length},range:Kt.cursor(o.head-l.length)}}return{range:r=o}});return r||e(t.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!r},_ge=[{key:"Backspace",run:wge}];function Cge(t,e){let i=OK(t,t.selection.main.head),n=i.brackets||L_.brackets;for(let r of n){let s=SK(al(r,0));if(e==r)return s==r?Tge(t,r,n.indexOf(r+r+r)>-1,i):Oge(t,r,s,i.before||L_.before);if(e==s&&MK(t,t.selection.main.from))return Mge(t,r,s)}return null}function MK(t,e){let i=!1;return t.field(CK).between(0,t.doc.length,n=>{n==e&&(i=!0)}),i}function pP(t,e){let i=t.sliceString(e,e+2);return i.slice(0,sh(al(i,0)))}function Sge(t,e){let i=t.sliceString(e-2,e);return sh(al(i,0))==i.length?i:i.slice(1)}function Oge(t,e,i,n){let r=null,s=t.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:i,from:o.to}],effects:Xm.of(o.to+e.length),range:Kt.range(o.anchor+e.length,o.head+e.length)};let a=pP(t.doc,o.head);return!a||/\s/.test(a)||n.indexOf(a)>-1?{changes:{insert:e+i,from:o.head},effects:Xm.of(o.head+e.length),range:Kt.cursor(o.head+e.length)}:{range:r=o}});return r?null:t.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function Mge(t,e,i){let n=null,r=t.changeByRange(s=>s.empty&&pP(t.doc,s.head)==i?{changes:{from:s.head,to:s.head+i.length,insert:i},range:Kt.cursor(s.head+i.length)}:n={range:s});return n?null:t.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function Tge(t,e,i,n){let r=n.stringPrefixes||L_.stringPrefixes,s=null,o=t.changeByRange(a=>{if(!a.empty)return{changes:[{insert:e,from:a.from},{insert:e,from:a.to}],effects:Xm.of(a.to+e.length),range:Kt.range(a.anchor+e.length,a.head+e.length)};let l=a.head,u=pP(t.doc,l),d;if(u==e){if(mW(t,l))return{changes:{insert:e+e,from:l},effects:Xm.of(l+e.length),range:Kt.cursor(l+e.length)};if(MK(t,l)){let v=i&&t.sliceDoc(l,l+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:l,to:l+v.length,insert:v},range:Kt.cursor(l+v.length)}}}else{if(i&&t.sliceDoc(l-2*e.length,l)==e+e&&(d=gW(t,l-2*e.length,r))>-1&&mW(t,d))return{changes:{insert:e+e+e+e,from:l},effects:Xm.of(l+e.length),range:Kt.cursor(l+e.length)};if(t.charCategorizer(l)(u)!=cs.Word&&gW(t,l,r)>-1&&!Rge(t,l,e,r))return{changes:{insert:e+e,from:l},effects:Xm.of(l+e.length),range:Kt.cursor(l+e.length)}}return{range:s=a}});return s?null:t.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function mW(t,e){let i=mo(t).resolveInner(e+1);return i.parent&&i.from==e}function Rge(t,e,i,n){let r=mo(t).resolveInner(e,-1),s=n.reduce((o,a)=>Math.max(o,a.length),0);for(let o=0;o<5;o++){let a=t.sliceDoc(r.from,Math.min(r.to,r.from+i.length+s)),l=a.indexOf(i);if(!l||l>-1&&n.indexOf(a.slice(0,l))>-1){let d=r.firstChild;for(;d&&d.from==r.from&&d.to-d.from>i.length+l;){if(t.sliceDoc(d.to-i.length,d.to)==i)return!1;d=d.firstChild}return!0}let u=r.to==e&&r.parent;if(!u)break;r=u}return!1}function gW(t,e,i){let n=t.charCategorizer(e);if(n(t.sliceDoc(e-1,e))!=cs.Word)return e;for(let r of i){let s=e-r.length;if(t.sliceDoc(s,e)==r&&n(t.sliceDoc(s-1,s))!=cs.Word)return s}return-1}function Pge(t={}){return[oge,cl,Eo.of(t),rge,Ege,wK]}const TK=[{key:"Ctrl-Space",run:fW},{mac:"Alt-`",run:fW},{key:"Escape",run:ege},{key:"ArrowDown",run:V1(!0)},{key:"ArrowUp",run:V1(!1)},{key:"PageDown",run:V1(!0,"page")},{key:"PageUp",run:V1(!1,"page")},{key:"Enter",run:Jme}],Ege=kp.highest(MC.computeN([Eo],t=>t.facet(Eo).defaultKeymap?[TK]:[]));class vW{constructor(e,i,n){this.from=e,this.to=i,this.diagnostic=n}}class $m{constructor(e,i,n){this.diagnostics=e,this.panel=i,this.selected=n}static init(e,i,n){let r=n.facet(F_).markerFilter;r&&(e=r(e,n));let s=e.slice().sort((d,p)=>d.from-p.from||d.to-p.to),o=new Vd,a=[],l=0;for(let d=0;;){let p=d==s.length?null:s[d];if(!p&&!a.length)break;let v,y;for(a.length?(v=l,y=a.reduce((R,O)=>Math.min(R,O.to),p&&p.from>v?p.from:1e8)):(v=p.from,y=p.to,a.push(p),d++);d<s.length;){let R=s[d];if(R.from==v&&(R.to>R.from||R.to==v))a.push(R),d++,y=Math.min(R.to,y);else{y=Math.min(R.from,y);break}}let w=Hge(a);if(a.some(R=>R.from==R.to||R.from==R.to-1&&n.doc.lineAt(R.from).to==R.from))o.add(v,v,an.widget({widget:new zge(w),diagnostics:a.slice()}));else{let R=a.reduce((O,P)=>P.markClass?O+" "+P.markClass:O,"");o.add(v,y,an.mark({class:"cm-lintRange cm-lintRange-"+w+R,diagnostics:a.slice(),inclusiveEnd:a.some(O=>O.to>y)}))}l=y;for(let R=0;R<a.length;R++)a[R].to<=l&&a.splice(R--,1)}let u=o.finish();return new $m(u,i,y0(u))}}function y0(t,e=null,i=0){let n=null;return t.between(i,1e9,(r,s,{spec:o})=>{if(!(e&&o.diagnostics.indexOf(e)<0))if(!n)n=new vW(r,s,e||o.diagnostics[0]);else{if(o.diagnostics.indexOf(n.diagnostic)<0)return!1;n=new vW(n.from,s,n.diagnostic)}}),n}function Age(t,e){let i=e.pos,n=e.end||i,r=t.state.facet(F_).hideOn(t,i,n);if(r!=null)return r;let s=t.startState.doc.lineAt(e.pos);return!!(t.effects.some(o=>o.is(RK))||t.changes.touchesRange(s.from,Math.max(s.to,n)))}function Ige(t,e){return t.field(jl,!1)?e:e.concat(_n.appendConfig.of($ge))}const RK=_n.define(),VG=_n.define(),PK=_n.define(),jl=Do.define({create(){return new $m(an.none,null,null)},update(t,e){if(e.docChanged&&t.diagnostics.size){let i=t.diagnostics.map(e.changes),n=null,r=t.panel;if(t.selected){let s=e.changes.mapPos(t.selected.from,1);n=y0(i,t.selected.diagnostic,s)||y0(i,null,s)}!i.size&&r&&e.state.facet(F_).autoPanel&&(r=null),t=new $m(i,r,n)}for(let i of e.effects)if(i.is(RK)){let n=e.state.facet(F_).autoPanel?i.value.length?N_.open:null:t.panel;t=$m.init(i.value,n,e.state)}else i.is(VG)?t=new $m(t.diagnostics,i.value?N_.open:null,t.selected):i.is(PK)&&(t=new $m(t.diagnostics,t.panel,i.value));return t},provide:t=>[P_.from(t,e=>e.panel),Li.decorations.from(t,e=>e.diagnostics)]}),kge=an.mark({class:"cm-lintRange cm-lintRange-active"});function Dge(t,e,i){let{diagnostics:n}=t.state.field(jl),r,s=-1,o=-1;n.between(e-(i<0?1:0),e+(i>0?1:0),(l,u,{spec:d})=>{if(e>=l&&e<=u&&(l==u||(e>l||i>0)&&(e<u||i<0)))return r=d.diagnostics,s=l,o=u,!1});let a=t.state.facet(F_).tooltipFilter;return r&&a&&(r=a(r,t.state)),r?{pos:s,end:o,above:t.state.doc.lineAt(s).to<o,create(){return{dom:Lge(t,r)}}}:null}function Lge(t,e){return Dr("ul",{class:"cm-tooltip-lint"},e.map(i=>AK(t,i,!1)))}const Fge=t=>{let e=t.state.field(jl,!1);(!e||!e.panel)&&t.dispatch({effects:Ige(t.state,[VG.of(!0)])});let i=R_(t,N_.open);return i&&i.dom.querySelector(".cm-panel-lint ul").focus(),!0},yW=t=>{let e=t.state.field(jl,!1);return!e||!e.panel?!1:(t.dispatch({effects:VG.of(!1)}),!0)},Nge=t=>{let e=t.state.field(jl,!1);if(!e)return!1;let i=t.state.selection.main,n=e.diagnostics.iter(i.to+1);return!n.value&&(n=e.diagnostics.iter(0),!n.value||n.from==i.from&&n.to==i.to)?!1:(t.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)},Bge=[{key:"Mod-Shift-m",run:Fge,preventDefault:!0},{key:"F8",run:Nge}],F_=Fi.define({combine(t){return Object.assign({sources:t.map(e=>e.source).filter(e=>e!=null)},Fh(t.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{needsRefresh:(e,i)=>e?i?n=>e(n)||i(n):e:i}))}});function EK(t){let e=[];if(t)e:for(let{name:i}of t){for(let n=0;n<i.length;n++){let r=i[n];if(/[a-zA-Z]/.test(r)&&!e.some(s=>s.toLowerCase()==r.toLowerCase())){e.push(r);continue e}}e.push("")}return e}function AK(t,e,i){var n;let r=i?EK(e.actions):[];return Dr("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},Dr("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage(t):e.message),(n=e.actions)===null||n===void 0?void 0:n.map((s,o)=>{let a=!1,l=v=>{if(v.preventDefault(),a)return;a=!0;let y=y0(t.state.field(jl).diagnostics,e);y&&s.apply(t,y.from,y.to)},{name:u}=s,d=r[o]?u.indexOf(r[o]):-1,p=d<0?u:[u.slice(0,d),Dr("u",u.slice(d,d+1)),u.slice(d+1)];return Dr("button",{type:"button",class:"cm-diagnosticAction",onclick:l,onmousedown:l,"aria-label":` Action: ${u}${d<0?"":` (access key "${r[o]})"`}.`},p)}),e.source&&Dr("div",{class:"cm-diagnosticSource"},e.source))}class zge extends Nh{constructor(e){super(),this.sev=e}eq(e){return e.sev==this.sev}toDOM(){return Dr("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class xW{constructor(e,i){this.diagnostic=i,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=AK(e,i,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class N_{constructor(e){this.view=e,this.items=[];let i=r=>{if(r.keyCode==27)yW(this.view),this.view.focus();else if(r.keyCode==38||r.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(r.keyCode==40||r.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(r.keyCode==36)this.moveSelection(0);else if(r.keyCode==35)this.moveSelection(this.items.length-1);else if(r.keyCode==13)this.view.focus();else if(r.keyCode>=65&&r.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:s}=this.items[this.selectedIndex],o=EK(s.actions);for(let a=0;a<o.length;a++)if(o[a].toUpperCase().charCodeAt(0)==r.keyCode){let l=y0(this.view.state.field(jl).diagnostics,s);l&&s.actions[a].apply(e,l.from,l.to)}}else return;r.preventDefault()},n=r=>{for(let s=0;s<this.items.length;s++)this.items[s].dom.contains(r.target)&&this.moveSelection(s)};this.list=Dr("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:i,onclick:n}),this.dom=Dr("div",{class:"cm-panel-lint"},this.list,Dr("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>yW(this.view)},"Ã")),this.update()}get selectedIndex(){let e=this.view.state.field(jl).selected;if(!e)return-1;for(let i=0;i<this.items.length;i++)if(this.items[i].diagnostic==e.diagnostic)return i;return-1}update(){let{diagnostics:e,selected:i}=this.view.state.field(jl),n=0,r=!1,s=null,o=new Set;for(e.between(0,this.view.state.doc.length,(a,l,{spec:u})=>{for(let d of u.diagnostics){if(o.has(d))continue;o.add(d);let p=-1,v;for(let y=n;y<this.items.length;y++)if(this.items[y].diagnostic==d){p=y;break}p<0?(v=new xW(this.view,d),this.items.splice(n,0,v),r=!0):(v=this.items[p],p>n&&(this.items.splice(n,p-n),r=!0)),i&&v.diagnostic==i.diagnostic?v.dom.hasAttribute("aria-selected")||(v.dom.setAttribute("aria-selected","true"),s=v):v.dom.hasAttribute("aria-selected")&&v.dom.removeAttribute("aria-selected"),n++}});n<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)r=!0,this.items.pop();this.items.length==0&&(this.items.push(new xW(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),r=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:a,panel:l})=>{let u=l.height/this.list.offsetHeight;a.top<l.top?this.list.scrollTop-=(l.top-a.top)/u:a.bottom>l.bottom&&(this.list.scrollTop+=(a.bottom-l.bottom)/u)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),r&&this.sync()}sync(){let e=this.list.firstChild;function i(){let n=e;e=n.nextSibling,n.remove()}for(let n of this.items)if(n.dom.parentNode==this.list){for(;e!=n.dom;)i();e=n.dom.nextSibling}else this.list.insertBefore(n.dom,e);for(;e;)i()}moveSelection(e){if(this.selectedIndex<0)return;let i=this.view.state.field(jl),n=y0(i.diagnostics,this.items[e].diagnostic);n&&this.view.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:PK.of(n)})}static open(e){return new N_(e)}}function Vge(t,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(t)}</svg>')`}function G1(t){return Vge(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const Gge=Li.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:G1("#d11")},".cm-lintRange-warning":{backgroundImage:G1("orange")},".cm-lintRange-info":{backgroundImage:G1("#999")},".cm-lintRange-hint":{backgroundImage:G1("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function Uge(t){return t=="error"?4:t=="warning"?3:t=="info"?2:1}function Hge(t){let e="hint",i=1;for(let n of t){let r=Uge(n.severity);r>i&&(i=r,e=n.severity)}return e}const $ge=[jl,Li.decorations.compute([jl],t=>{let{selected:e,panel:i}=t.field(jl);return!e||!i||e.from==e.to?an.none:an.set([kge.range(e.from,e.to)])}),Mde(Dge,{hideOn:Age}),Gge],Wge=[Nde(),Vde(),tde(),spe(),Afe(),$he(),Zhe(),xs.allowMultipleSelections.of(!0),vfe(),kfe(Ffe,{fallback:!0}),Hfe(),yge(),Pge(),mde(),yde(),ade(),dme(),MC.of([..._ge,...sme,...Ame,...ppe,...Tfe,...TK,...Bge])];function bW(t,e,i=!1){let n;return function(...s){const o=this;n?clearTimeout(n):i&&t.apply(o,s),n=setTimeout(a,e||100);function a(){i||t.apply(o,s),n=null}}}var qge=hi("<div></div>"),jge=hi('<div><div class="scm-waiting__loading scm-loading svelte-kcx0g9"><div class="scm-loading__spinner svelte-kcx0g9"></div> <p class="scm-loading__text svelte-kcx0g9">Loading editor...</p></div> <pre class="scm-pre cm-editor svelte-kcx0g9"> </pre></div>');function Qge(t,e){Pi(e,!1);const i=Gt(),n=Gt();let r=ht(e,"class",8,""),s=ht(e,"value",12,""),o=ht(e,"basic",8,!0),a=ht(e,"lang",24,()=>{}),l=ht(e,"theme",24,()=>{}),u=ht(e,"extensions",24,()=>[]),d=ht(e,"useTab",8,!0),p=ht(e,"tabSize",8,2),v=ht(e,"styles",24,()=>{}),y=ht(e,"lineWrapping",8,!1),w=ht(e,"editable",8,!0),R=ht(e,"readonly",8,!1),O=ht(e,"placeholder",24,()=>{}),P=ht(e,"nodebounce",8,!1);const N=typeof window<"u",F=nZ();let k=Gt(),$=Gt(),W=!1,Q=!1,Y=!0,M=!0;Xo(()=>{rt($,D()),F("ready",B($))}),As(()=>B($)?.destroy());function D(){return new Li({parent:B(k),state:ie(s()),dispatch(je){B($).update([je]),!W&&je.docChanged&&B(n)()}})}function G(){if(Y){Y=!1;return}B($).dispatch({effects:_n.reconfigure.of(B(i))}),F("reconfigure",B($))}function j(je){if(M){M=!1;return}if(Q){Q=!1;return}W=!0,B($).setState(ie(je)),W=!1}function Z(){const je=B($).state.doc.toString();je!==s()&&(Q=!0,s(je),F("change",s()))}function ie(je){return xs.create({doc:je??void 0,extensions:B(i)})}function le(je,qe,ct,Ge,Je,mt,wt,Ot){const Qt=[RC.of(" ".repeat(ct)),Li.editable.of(mt),xs.readOnly.of(wt)];return je&&Qt.push(Wge),qe&&Qt.push(MC.of([ome])),Je&&Qt.push(hde(Je)),Ot&&Qt.push(Ot),Ge&&Qt.push(Li.lineWrapping),Qt}function me(je,qe){const ct=[];return qe&&ct.push(Li.theme(qe)),je&&ct.push(je),ct}Ui(()=>(en(o()),en(d()),en(p()),en(y()),en(O()),en(w()),en(R()),en(a()),en(l()),en(v()),en(u())),()=>{rt(i,[...le(o(),d(),p(),y(),O(),w(),R(),a()),...me(l(),v()),...u()])}),Ui(()=>(B($),en(s())),()=>{B($)&&j(s())}),Ui(()=>(B($),B(i)),()=>{B($)&&B(i)&&G()}),Ui(()=>(en(P()),bW),()=>{rt(n,P()?Z:bW(Z,300))}),Is(),ts();var be=nn(),fe=pi(be);{var Fe=je=>{var qe=qge();es(qe,ct=>rt(k,ct),()=>B(k)),Gi(()=>xi(qe,1,`codemirror-wrapper ${r()??""}`,"svelte-kcx0g9")),bt(je,qe)},He=je=>{var qe=jge(),ct=vi(Di(qe),2),Ge=Di(ct,!0);_i(ct),_i(qe),Gi(()=>{xi(qe,1,`scm-waiting ${r()??""}`,"svelte-kcx0g9"),zd(Ge,s())}),bt(je,qe)};Yi(fe,je=>{N?je(Fe):je(He,!1)})}bt(t,be),Ei()}var wW={};class gT{constructor(e,i,n,r,s,o,a,l,u,d=0,p){this.p=e,this.stack=i,this.state=n,this.reducePos=r,this.pos=s,this.score=o,this.buffer=a,this.bufferBase=l,this.curContext=u,this.lookAhead=d,this.parent=p}toString(){return`[${this.stack.filter((e,i)=>i%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,i,n=0){let r=e.parser.context;return new gT(e,[],i,n,n,0,[],0,r?new _W(r,r.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,i){this.stack.push(this.state,i,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var i;let n=e>>19,r=e&65535,{parser:s}=this.p,o=this.reducePos<this.pos-25;o&&this.setLookAhead(this.pos);let a=s.dynamicPrecedence(r);if(a&&(this.score+=a),n==0){this.pushState(s.getGoto(this.state,r,!0),this.reducePos),r<s.minRepeatTerm&&this.storeNode(r,this.reducePos,this.reducePos,o?8:4,!0),this.reduceContext(r,this.reducePos);return}let l=this.stack.length-(n-1)*3-(e&262144?6:0),u=l?this.stack[l-2]:this.p.ranges[0].from,d=this.reducePos-u;d>=2e3&&!(!((i=this.p.parser.nodeSet.types[r])===null||i===void 0)&&i.isAnonymous)&&(u==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=d):this.p.lastBigReductionSize<d&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=u,this.p.lastBigReductionSize=d));let p=l?this.stack[l-1]:0,v=this.bufferBase+this.buffer.length-p;if(r<s.minRepeatTerm||e&131072){let y=s.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(r,u,y,v+4,!0)}if(e&262144)this.state=this.stack[l];else{let y=this.stack[l-3];this.state=s.getGoto(y,r,!0)}for(;this.stack.length>l;)this.stack.pop();this.reduceContext(r,u)}storeNode(e,i,n,r=4,s=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let o=this,a=this.buffer.length;if(a==0&&o.parent&&(a=o.bufferBase-o.parent.bufferBase,o=o.parent),a>0&&o.buffer[a-4]==0&&o.buffer[a-1]>-1){if(i==n)return;if(o.buffer[a-2]>=i){o.buffer[a-2]=n;return}}}if(!s||this.pos==n)this.buffer.push(e,i,n,r);else{let o=this.buffer.length;if(o>0&&this.buffer[o-4]!=0){let a=!1;for(let l=o;l>0&&this.buffer[l-2]>n;l-=4)if(this.buffer[l-1]>=0){a=!0;break}if(a)for(;o>0&&this.buffer[o-2]>n;)this.buffer[o]=this.buffer[o-4],this.buffer[o+1]=this.buffer[o-3],this.buffer[o+2]=this.buffer[o-2],this.buffer[o+3]=this.buffer[o-1],o-=4,r>4&&(r-=4)}this.buffer[o]=e,this.buffer[o+1]=i,this.buffer[o+2]=n,this.buffer[o+3]=r}}shift(e,i,n,r){if(e&131072)this.pushState(e&65535,this.pos);else if((e&262144)==0){let s=e,{parser:o}=this.p;(r>this.pos||i<=o.maxNode)&&(this.pos=r,o.stateFlag(s,1)||(this.reducePos=r)),this.pushState(s,n),this.shiftContext(i,n),i<=o.maxNode&&this.buffer.push(i,n,r,4)}else this.pos=r,this.shiftContext(i,n),i<=this.p.parser.maxNode&&this.buffer.push(i,n,r,4)}apply(e,i,n,r){e&65536?this.reduce(e):this.shift(e,i,n,r)}useNode(e,i){let n=this.p.reused.length-1;(n<0||this.p.reused[n]!=e)&&(this.p.reused.push(e),n++);let r=this.pos;this.reducePos=this.pos=r+e.length,this.pushState(i,r),this.buffer.push(n,r,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,i=e.buffer.length;for(;i>0&&e.buffer[i-2]>e.reducePos;)i-=4;let n=e.buffer.slice(i),r=e.bufferBase+i;for(;e&&r==e.bufferBase;)e=e.parent;return new gT(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,n,r,this.curContext,this.lookAhead,e)}recoverByDelete(e,i){let n=e<=this.p.parser.maxNode;n&&this.storeNode(e,this.pos,i,4),this.storeNode(0,this.pos,i,n?8:4),this.pos=this.reducePos=i,this.score-=190}canShift(e){for(let i=new Zge(this);;){let n=this.p.parser.stateSlot(i.state,4)||this.p.parser.hasAction(i.state,e);if(n==0)return!1;if((n&65536)==0)return!0;i.reduce(n)}}recoverByInsert(e){if(this.stack.length>=300)return[];let i=this.p.parser.nextStates(this.state);if(i.length>8||this.stack.length>=120){let r=[];for(let s=0,o;s<i.length;s+=2)(o=i[s+1])!=this.state&&this.p.parser.hasAction(o,e)&&r.push(i[s],o);if(this.stack.length<120)for(let s=0;r.length<8&&s<i.length;s+=2){let o=i[s+1];r.some((a,l)=>l&1&&a==o)||r.push(i[s],o)}i=r}let n=[];for(let r=0;r<i.length&&n.length<4;r+=2){let s=i[r+1];if(s==this.state)continue;let o=this.split();o.pushState(s,this.pos),o.storeNode(0,o.pos,o.pos,4,!0),o.shiftContext(i[r],this.pos),o.reducePos=this.pos,o.score-=200,n.push(o)}return n}forceReduce(){let{parser:e}=this.p,i=e.stateSlot(this.state,5);if((i&65536)==0)return!1;if(!e.validAction(this.state,i)){let n=i>>19,r=i&65535,s=this.stack.length-n*3;if(s<0||e.getGoto(this.stack[s],r,!1)<0){let o=this.findForcedReduction();if(o==null)return!1;i=o}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(i),!0}findForcedReduction(){let{parser:e}=this.p,i=[],n=(r,s)=>{if(!i.includes(r))return i.push(r),e.allActions(r,o=>{if(!(o&393216))if(o&65536){let a=(o>>19)-s;if(a>1){let l=o&65535,u=this.stack.length-a*3;if(u>=0&&e.getGoto(this.stack[u],l,!1)>=0)return a<<19|65536|l}}else{let a=n(o,s+1);if(a!=null)return a}})};return n(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let i=0;i<this.stack.length;i+=3)if(this.stack[i]!=e.stack[i])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,i){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(i)))}reduceContext(e,i){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(i)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let i=new _W(this.curContext.tracker,e);i.hash!=this.curContext.hash&&this.emitContext(),this.curContext=i}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class _W{constructor(e,i){this.tracker=e,this.context=i,this.hash=e.strict?e.hash(i):0}}class Zge{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let i=e&65535,n=e>>19;n==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(n-1)*3;let r=this.start.p.parser.getGoto(this.stack[this.base-3],i,!0);this.state=r}}class vT{constructor(e,i,n){this.stack=e,this.pos=i,this.index=n,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,i=e.bufferBase+e.buffer.length){return new vT(e,i,i-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new vT(this.stack,this.pos,this.index)}}function xw(t,e=Uint16Array){if(typeof t!="string")return t;let i=null;for(let n=0,r=0;n<t.length;){let s=0;for(;;){let o=t.charCodeAt(n++),a=!1;if(o==126){s=65535;break}o>=92&&o--,o>=34&&o--;let l=o-32;if(l>=46&&(l-=46,a=!0),s+=l,a)break;s*=46}i?i[r++]=s:i=new e(s)}return i}class CM{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const CW=new CM;class Xge{constructor(e,i){this.input=e,this.ranges=i,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=CW,this.rangeIndex=0,this.pos=this.chunkPos=i[0].from,this.range=i[0],this.end=i[i.length-1].to,this.readNext()}resolveOffset(e,i){let n=this.range,r=this.rangeIndex,s=this.pos+e;for(;s<n.from;){if(!r)return null;let o=this.ranges[--r];s-=n.from-o.to,n=o}for(;i<0?s>n.to:s>=n.to;){if(r==this.ranges.length-1)return null;let o=this.ranges[++r];s+=o.from-n.to,n=o}return s}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let i of this.ranges)if(i.to>e)return Math.max(e,i.from);return this.end}peek(e){let i=this.chunkOff+e,n,r;if(i>=0&&i<this.chunk.length)n=this.pos+e,r=this.chunk.charCodeAt(i);else{let s=this.resolveOffset(e,1);if(s==null)return-1;if(n=s,n>=this.chunk2Pos&&n<this.chunk2Pos+this.chunk2.length)r=this.chunk2.charCodeAt(n-this.chunk2Pos);else{let o=this.rangeIndex,a=this.range;for(;a.to<=n;)a=this.ranges[++o];this.chunk2=this.input.chunk(this.chunk2Pos=n),n+this.chunk2.length>a.to&&(this.chunk2=this.chunk2.slice(0,a.to-n)),r=this.chunk2.charCodeAt(0)}}return n>=this.token.lookAhead&&(this.token.lookAhead=n+1),r}acceptToken(e,i=0){let n=i?this.resolveOffset(i,-1):this.pos;if(n==null||n<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=n}acceptTokenTo(e,i){this.token.value=e,this.token.end=i}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:i}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=i,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),i=this.pos+e.length;this.chunk=i>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,i){if(i?(this.token=i,i.start=e,i.lookAhead=e+1,i.value=i.extended=-1):this.token=CW,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,i){if(e>=this.chunkPos&&i<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,i-this.chunkPos);if(e>=this.chunk2Pos&&i<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,i-this.chunk2Pos);if(e>=this.range.from&&i<=this.range.to)return this.input.read(e,i);let n="";for(let r of this.ranges){if(r.from>=i)break;r.to>e&&(n+=this.input.read(Math.max(r.from,e),Math.min(r.to,i)))}return n}}class Yy{constructor(e,i){this.data=e,this.id=i}token(e,i){let{parser:n}=i.p;IK(this.data,e,i,this.id,n.data,n.tokenPrecTable)}}Yy.prototype.contextual=Yy.prototype.fallback=Yy.prototype.extend=!1;class nz{constructor(e,i,n){this.precTable=i,this.elseToken=n,this.data=typeof e=="string"?xw(e):e}token(e,i){let n=e.pos,r=0;for(;;){let s=e.next<0,o=e.resolveOffset(1,1);if(IK(this.data,e,i,0,this.data,this.precTable),e.token.value>-1)break;if(this.elseToken==null)return;if(s||r++,o==null)break;e.reset(o,e.token)}r&&(e.reset(n,e.token),e.acceptToken(this.elseToken,r))}}nz.prototype.contextual=Yy.prototype.fallback=Yy.prototype.extend=!1;class kC{constructor(e,i={}){this.token=e,this.contextual=!!i.contextual,this.fallback=!!i.fallback,this.extend=!!i.extend}}function IK(t,e,i,n,r,s){let o=0,a=1<<n,{dialect:l}=i.p.parser;e:for(;(a&t[o])!=0;){let u=t[o+1];for(let y=o+3;y<u;y+=2)if((t[y+1]&a)>0){let w=t[y];if(l.allows(w)&&(e.token.value==-1||e.token.value==w||Kge(w,e.token.value,r,s))){e.acceptToken(w);break}}let d=e.next,p=0,v=t[o+2];if(e.next<0&&v>p&&t[u+v*3-3]==65535){o=t[u+v*3-1];continue e}for(;p<v;){let y=p+v>>1,w=u+y+(y<<1),R=t[w],O=t[w+1]||65536;if(d<R)v=y;else if(d>=O)p=y+1;else{o=t[w+2],e.advance();continue e}}break}}function SW(t,e,i){for(let n=e,r;(r=t[n])!=65535;n++)if(r==i)return n-e;return-1}function Kge(t,e,i,n){let r=SW(i,n,e);return r<0||SW(i,n,t)<r}const Fl=typeof process<"u"&&wW&&/\bparse\b/.test(wW.LOG);let zF=null;function OW(t,e,i){let n=t.cursor(uo.IncludeAnonymous);for(n.moveTo(e);;)if(!(i<0?n.childBefore(e):n.childAfter(e)))for(;;){if((i<0?n.to<e:n.from>e)&&!n.type.isError)return i<0?Math.max(0,Math.min(n.to-1,e-25)):Math.min(t.length,Math.max(n.from+1,e+25));if(i<0?n.prevSibling():n.nextSibling())break;if(!n.parent())return i<0?0:t.length}}class Yge{constructor(e,i){this.fragments=e,this.nodeSet=i,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?OW(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?OW(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let i=this.trees.length-1;if(i<0)return this.nextFragment(),null;let n=this.trees[i],r=this.index[i];if(r==n.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let s=n.children[r],o=this.start[i]+n.positions[r];if(o>e)return this.nextStart=o,null;if(s instanceof Js){if(o==e){if(o<this.safeFrom)return null;let a=o+s.length;if(a<=this.safeTo){let l=s.prop(jn.lookAhead);if(!l||a+l<this.fragment.to)return s}}this.index[i]++,o+s.length>=Math.max(this.safeFrom,e)&&(this.trees.push(s),this.start.push(o),this.index.push(0))}else this.index[i]++,this.nextStart=o+s.length}}}class Jge{constructor(e,i){this.stream=i,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(n=>new CM)}getActions(e){let i=0,n=null,{parser:r}=e.p,{tokenizers:s}=r,o=r.stateSlot(e.state,3),a=e.curContext?e.curContext.hash:0,l=0;for(let u=0;u<s.length;u++){if((1<<u&o)==0)continue;let d=s[u],p=this.tokens[u];if(!(n&&!d.fallback)&&((d.contextual||p.start!=e.pos||p.mask!=o||p.context!=a)&&(this.updateCachedToken(p,d,e),p.mask=o,p.context=a),p.lookAhead>p.end+25&&(l=Math.max(p.lookAhead,l)),p.value!=0)){let v=i;if(p.extended>-1&&(i=this.addActions(e,p.extended,p.end,i)),i=this.addActions(e,p.value,p.end,i),!d.extend&&(n=p,i>v))break}}for(;this.actions.length>i;)this.actions.pop();return l&&e.setLookAhead(l),!n&&e.pos==this.stream.end&&(n=new CM,n.value=e.p.parser.eofTerm,n.start=n.end=e.pos,i=this.addActions(e,n.value,n.end,i)),this.mainToken=n,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let i=new CM,{pos:n,p:r}=e;return i.start=n,i.end=Math.min(n+1,r.stream.end),i.value=n==r.stream.end?r.parser.eofTerm:0,i}updateCachedToken(e,i,n){let r=this.stream.clipPos(n.pos);if(i.token(this.stream.reset(r,e),n),e.value>-1){let{parser:s}=n.p;for(let o=0;o<s.specialized.length;o++)if(s.specialized[o]==e.value){let a=s.specializers[o](this.stream.read(e.start,e.end),n);if(a>=0&&n.p.parser.dialect.allows(a>>1)){(a&1)==0?e.value=a>>1:e.extended=a>>1;break}}}else e.value=0,e.end=this.stream.clipPos(r+1)}putAction(e,i,n,r){for(let s=0;s<r;s+=3)if(this.actions[s]==e)return r;return this.actions[r++]=e,this.actions[r++]=i,this.actions[r++]=n,r}addActions(e,i,n,r){let{state:s}=e,{parser:o}=e.p,{data:a}=o;for(let l=0;l<2;l++)for(let u=o.stateSlot(s,l?2:1);;u+=3){if(a[u]==65535)if(a[u+1]==1)u=vd(a,u+2);else{r==0&&a[u+1]==2&&(r=this.putAction(vd(a,u+2),i,n,r));break}a[u]==i&&(r=this.putAction(vd(a,u+1),i,n,r))}return r}}class eve{constructor(e,i,n,r){this.parser=e,this.input=i,this.ranges=r,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new Xge(i,r),this.tokens=new Jge(e,this.stream),this.topTerm=e.top[1];let{from:s}=r[0];this.stacks=[gT.start(this,e.top[0],s)],this.fragments=n.length&&this.stream.end-s>e.bufferLength*4?new Yge(n,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,i=this.minStackPos,n=this.stacks=[],r,s;if(this.bigReductionCount>300&&e.length==1){let[o]=e;for(;o.forceReduce()&&o.stack.length&&o.stack[o.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let o=0;o<e.length;o++){let a=e[o];for(;;){if(this.tokens.mainToken=null,a.pos>i)n.push(a);else{if(this.advanceStack(a,n,e))continue;{r||(r=[],s=[]),r.push(a);let l=this.tokens.getMainToken(a);s.push(l.value,l.end)}}break}}if(!n.length){let o=r&&nve(r);if(o)return Fl&&console.log("Finish with "+this.stackID(o)),this.stackToTree(o);if(this.parser.strict)throw Fl&&r&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+i);this.recovering||(this.recovering=5)}if(this.recovering&&r){let o=this.stoppedAt!=null&&r[0].pos>this.stoppedAt?r[0]:this.runRecovery(r,s,n);if(o)return Fl&&console.log("Force-finish "+this.stackID(o)),this.stackToTree(o.forceAll())}if(this.recovering){let o=this.recovering==1?1:this.recovering*3;if(n.length>o)for(n.sort((a,l)=>l.score-a.score);n.length>o;)n.pop();n.some(a=>a.reducePos>i)&&this.recovering--}else if(n.length>1){e:for(let o=0;o<n.length-1;o++){let a=n[o];for(let l=o+1;l<n.length;l++){let u=n[l];if(a.sameState(u)||a.buffer.length>500&&u.buffer.length>500)if((a.score-u.score||a.buffer.length-u.buffer.length)>0)n.splice(l--,1);else{n.splice(o--,1);continue e}}}n.length>12&&n.splice(12,n.length-12)}this.minStackPos=n[0].pos;for(let o=1;o<n.length;o++)n[o].pos<this.minStackPos&&(this.minStackPos=n[o].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,i,n){let r=e.pos,{parser:s}=this,o=Fl?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&r>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let u=e.curContext&&e.curContext.tracker.strict,d=u?e.curContext.hash:0;for(let p=this.fragments.nodeAt(r);p;){let v=this.parser.nodeSet.types[p.type.id]==p.type?s.getGoto(e.state,p.type.id):-1;if(v>-1&&p.length&&(!u||(p.prop(jn.contextHash)||0)==d))return e.useNode(p,v),Fl&&console.log(o+this.stackID(e)+` (via reuse of ${s.getName(p.type.id)})`),!0;if(!(p instanceof Js)||p.children.length==0||p.positions[0]>0)break;let y=p.children[0];if(y instanceof Js&&p.positions[0]==0)p=y;else break}}let a=s.stateSlot(e.state,4);if(a>0)return e.reduce(a),Fl&&console.log(o+this.stackID(e)+` (via always-reduce ${s.getName(a&65535)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let l=this.tokens.getActions(e);for(let u=0;u<l.length;){let d=l[u++],p=l[u++],v=l[u++],y=u==l.length||!n,w=y?e:e.split(),R=this.tokens.mainToken;if(w.apply(d,p,R?R.start:w.pos,v),Fl&&console.log(o+this.stackID(w)+` (via ${(d&65536)==0?"shift":`reduce of ${s.getName(d&65535)}`} for ${s.getName(p)} @ ${r}${w==e?"":", split"})`),y)return!0;w.pos>r?i.push(w):n.push(w)}return!1}advanceFully(e,i){let n=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>n)return MW(e,i),!0}}runRecovery(e,i,n){let r=null,s=!1;for(let o=0;o<e.length;o++){let a=e[o],l=i[o<<1],u=i[(o<<1)+1],d=Fl?this.stackID(a)+" -> ":"";if(a.deadEnd&&(s||(s=!0,a.restart(),Fl&&console.log(d+this.stackID(a)+" (restarted)"),this.advanceFully(a,n))))continue;let p=a.split(),v=d;for(let y=0;p.forceReduce()&&y<10&&(Fl&&console.log(v+this.stackID(p)+" (via force-reduce)"),!this.advanceFully(p,n));y++)Fl&&(v=this.stackID(p)+" -> ");for(let y of a.recoverByInsert(l))Fl&&console.log(d+this.stackID(y)+" (via recover-insert)"),this.advanceFully(y,n);this.stream.end>a.pos?(u==a.pos&&(u++,l=0),a.recoverByDelete(l,u),Fl&&console.log(d+this.stackID(a)+` (via recover-delete ${this.parser.getName(l)})`),MW(a,n)):(!r||r.score<a.score)&&(r=a)}return r}stackToTree(e){return e.close(),Js.build({buffer:vT.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let i=(zF||(zF=new WeakMap)).get(e);return i||zF.set(e,i=String.fromCodePoint(this.nextStackID++)),i+e}}function MW(t,e){for(let i=0;i<e.length;i++){let n=e[i];if(n.pos==t.pos&&n.sameState(t)){e[i].score<t.score&&(e[i]=t);return}}e.push(t)}class tve{constructor(e,i,n){this.source=e,this.flags=i,this.disabled=n}allows(e){return!this.disabled||this.disabled[e]==0}}const VF=t=>t;class ive{constructor(e){this.start=e.start,this.shift=e.shift||VF,this.reduce=e.reduce||VF,this.reuse=e.reuse||VF,this.hash=e.hash||(()=>0),this.strict=e.strict!==!1}}class yT extends aX{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let i=e.nodeNames.split(" ");this.minRepeatTerm=i.length;for(let a=0;a<e.repeatNodeCount;a++)i.push("");let n=Object.keys(e.topRules).map(a=>e.topRules[a][1]),r=[];for(let a=0;a<i.length;a++)r.push([]);function s(a,l,u){r[a].push([l,l.deserialize(String(u))])}if(e.nodeProps)for(let a of e.nodeProps){let l=a[0];typeof l=="string"&&(l=jn[l]);for(let u=1;u<a.length;){let d=a[u++];if(d>=0)s(d,l,a[u++]);else{let p=a[u+-d];for(let v=-d;v>0;v--)s(a[u++],l,p);u++}}}this.nodeSet=new xG(i.map((a,l)=>Wc.define({name:l>=this.minRepeatTerm?void 0:a,id:l,props:r[l],top:n.indexOf(l)>-1,error:l==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(l)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=iX;let o=xw(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let a=0;a<this.specializerSpecs.length;a++)this.specialized[a]=this.specializerSpecs[a].term;this.specializers=this.specializerSpecs.map(TW),this.states=xw(e.states,Uint32Array),this.data=xw(e.stateData),this.goto=xw(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(a=>typeof a=="number"?new Yy(o,a):a),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,i,n){let r=new eve(this,e,i,n);for(let s of this.wrappers)r=s(r,e,i,n);return r}getGoto(e,i,n=!1){let r=this.goto;if(i>=r[0])return-1;for(let s=r[i+1];;){let o=r[s++],a=o&1,l=r[s++];if(a&&n)return l;for(let u=s+(o>>1);s<u;s++)if(r[s]==e)return l;if(a)return-1}}hasAction(e,i){let n=this.data;for(let r=0;r<2;r++)for(let s=this.stateSlot(e,r?2:1),o;;s+=3){if((o=n[s])==65535)if(n[s+1]==1)o=n[s=vd(n,s+2)];else{if(n[s+1]==2)return vd(n,s+2);break}if(o==i||o==0)return vd(n,s+1)}return 0}stateSlot(e,i){return this.states[e*6+i]}stateFlag(e,i){return(this.stateSlot(e,0)&i)>0}validAction(e,i){return!!this.allActions(e,n=>n==i?!0:null)}allActions(e,i){let n=this.stateSlot(e,4),r=n?i(n):void 0;for(let s=this.stateSlot(e,1);r==null;s+=3){if(this.data[s]==65535)if(this.data[s+1]==1)s=vd(this.data,s+2);else break;r=i(vd(this.data,s+1))}return r}nextStates(e){let i=[];for(let n=this.stateSlot(e,1);;n+=3){if(this.data[n]==65535)if(this.data[n+1]==1)n=vd(this.data,n+2);else break;if((this.data[n+2]&1)==0){let r=this.data[n+1];i.some((s,o)=>o&1&&s==r)||i.push(this.data[n],r)}}return i}configure(e){let i=Object.assign(Object.create(yT.prototype),this);if(e.props&&(i.nodeSet=this.nodeSet.extend(...e.props)),e.top){let n=this.topRules[e.top];if(!n)throw new RangeError(`Invalid top rule name ${e.top}`);i.top=n}return e.tokenizers&&(i.tokenizers=this.tokenizers.map(n=>{let r=e.tokenizers.find(s=>s.from==n);return r?r.to:n})),e.specializers&&(i.specializers=this.specializers.slice(),i.specializerSpecs=this.specializerSpecs.map((n,r)=>{let s=e.specializers.find(a=>a.from==n.external);if(!s)return n;let o=Object.assign(Object.assign({},n),{external:s.to});return i.specializers[r]=TW(o),o})),e.contextTracker&&(i.context=e.contextTracker),e.dialect&&(i.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(i.strict=e.strict),e.wrap&&(i.wrappers=i.wrappers.concat(e.wrap)),e.bufferLength!=null&&(i.bufferLength=e.bufferLength),i}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let i=this.dynamicPrecedences;return i==null?0:i[e]||0}parseDialect(e){let i=Object.keys(this.dialects),n=i.map(()=>!1);if(e)for(let s of e.split(" ")){let o=i.indexOf(s);o>=0&&(n[o]=!0)}let r=null;for(let s=0;s<i.length;s++)if(!n[s])for(let o=this.dialects[i[s]],a;(a=this.data[o++])!=65535;)(r||(r=new Uint8Array(this.maxTerm+1)))[a]=1;return new tve(e,n,r)}static deserialize(e){return new yT(e)}}function vd(t,e){return t[e]|t[e+1]<<16}function nve(t){let e=null;for(let i of t){let n=i.p.stoppedAt;(i.pos==i.p.stream.end||n!=null&&i.pos>n)&&i.p.parser.stateFlag(i.state,2)&&(!e||e.score<i.score)&&(e=i)}return e}function TW(t){if(t.external){let e=t.extend?1:0;return(i,n)=>t.external(i,n)<<1|e}return t.get}const rve=314,sve=315,RW=1,ove=2,ave=3,lve=4,cve=316,uve=318,hve=319,dve=5,fve=6,pve=0,rz=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288],kK=125,mve=59,sz=47,gve=42,vve=43,yve=45,xve=60,bve=44,wve=63,_ve=46,Cve=91,Sve=new ive({start:!1,shift(t,e){return e==dve||e==fve||e==uve?t:e==hve},strict:!1}),Ove=new kC((t,e)=>{let{next:i}=t;(i==kK||i==-1||e.context)&&t.acceptToken(cve)},{contextual:!0,fallback:!0}),Mve=new kC((t,e)=>{let{next:i}=t,n;rz.indexOf(i)>-1||i==sz&&((n=t.peek(1))==sz||n==gve)||i!=kK&&i!=mve&&i!=-1&&!e.context&&t.acceptToken(rve)},{contextual:!0}),Tve=new kC((t,e)=>{t.next==Cve&&!e.context&&t.acceptToken(sve)},{contextual:!0}),Rve=new kC((t,e)=>{let{next:i}=t;if(i==vve||i==yve){if(t.advance(),i==t.next){t.advance();let n=!e.context&&e.canShift(RW);t.acceptToken(n?RW:ove)}}else i==wve&&t.peek(1)==_ve&&(t.advance(),t.advance(),(t.next<48||t.next>57)&&t.acceptToken(ave))},{contextual:!0});function GF(t,e){return t>=65&&t<=90||t>=97&&t<=122||t==95||t>=192||!e&&t>=48&&t<=57}const Pve=new kC((t,e)=>{if(t.next!=xve||!e.dialectEnabled(pve)||(t.advance(),t.next==sz))return;let i=0;for(;rz.indexOf(t.next)>-1;)t.advance(),i++;if(GF(t.next,!0)){for(t.advance(),i++;GF(t.next,!1);)t.advance(),i++;for(;rz.indexOf(t.next)>-1;)t.advance(),i++;if(t.next==bve)return;for(let n=0;;n++){if(n==7){if(!GF(t.next,!0))return;break}if(t.next!="extends".charCodeAt(n))break;t.advance(),i++}}t.acceptToken(lve,-i)}),Eve=lX({"get set async static":At.modifier,"for while do if else switch try catch finally return throw break continue default case":At.controlKeyword,"in of await yield void typeof delete instanceof":At.operatorKeyword,"let var const using function class extends":At.definitionKeyword,"import export from":At.moduleKeyword,"with debugger as new":At.keyword,TemplateString:At.special(At.string),super:At.atom,BooleanLiteral:At.bool,this:At.self,null:At.null,Star:At.modifier,VariableName:At.variableName,"CallExpression/VariableName TaggedTemplateExpression/VariableName":At.function(At.variableName),VariableDefinition:At.definition(At.variableName),Label:At.labelName,PropertyName:At.propertyName,PrivatePropertyName:At.special(At.propertyName),"CallExpression/MemberExpression/PropertyName":At.function(At.propertyName),"FunctionDeclaration/VariableDefinition":At.function(At.definition(At.variableName)),"ClassDeclaration/VariableDefinition":At.definition(At.className),"NewExpression/VariableName":At.className,PropertyDefinition:At.definition(At.propertyName),PrivatePropertyDefinition:At.definition(At.special(At.propertyName)),UpdateOp:At.updateOperator,"LineComment Hashbang":At.lineComment,BlockComment:At.blockComment,Number:At.number,String:At.string,Escape:At.escape,ArithOp:At.arithmeticOperator,LogicOp:At.logicOperator,BitOp:At.bitwiseOperator,CompareOp:At.compareOperator,RegExp:At.regexp,Equals:At.definitionOperator,Arrow:At.function(At.punctuation),": Spread":At.punctuation,"( )":At.paren,"[ ]":At.squareBracket,"{ }":At.brace,"InterpolationStart InterpolationEnd":At.special(At.brace),".":At.derefOperator,", ;":At.separator,"@":At.meta,TypeName:At.typeName,TypeDefinition:At.definition(At.typeName),"type enum interface implements namespace module declare":At.definitionKeyword,"abstract global Privacy readonly override":At.modifier,"is keyof unique infer asserts":At.operatorKeyword,JSXAttributeValue:At.attributeValue,JSXText:At.content,"JSXStartTag JSXStartCloseTag JSXSelfCloseEndTag JSXEndTag":At.angleBracket,"JSXIdentifier JSXNameSpacedName":At.tagName,"JSXAttribute/JSXIdentifier JSXAttribute/JSXNameSpacedName":At.attributeName,"JSXBuiltin/JSXIdentifier":At.standard(At.tagName)}),Ave={__proto__:null,export:20,as:25,from:33,default:36,async:41,function:42,const:52,extends:56,this:60,true:68,false:68,null:80,void:84,typeof:88,super:104,new:138,delete:150,yield:159,await:163,class:168,public:231,private:231,protected:231,readonly:233,instanceof:252,satisfies:255,in:256,import:290,keyof:347,unique:351,infer:357,asserts:393,is:395,abstract:415,implements:417,type:419,let:422,var:424,using:427,interface:433,enum:437,namespace:443,module:445,declare:449,global:453,for:472,of:481,while:484,with:488,do:492,if:496,else:498,switch:502,case:508,try:514,catch:518,finally:522,return:526,throw:530,break:534,continue:538,debugger:542},Ive={__proto__:null,async:125,get:127,set:129,declare:191,public:193,private:193,protected:193,static:195,abstract:197,override:199,readonly:205,accessor:207,new:399},kve={__proto__:null,"<":189},Dve=yT.deserialize({version:14,states:"$EOQ%TQlOOO%[QlOOO'_QpOOP(lO`OOO*zQ!0MxO'#CiO+RO#tO'#CjO+aO&jO'#CjO+oO#@ItO'#D_O.QQlO'#DeO.bQlO'#DpO%[QlO'#DxO0fQlO'#EQOOQ!0Lf'#EY'#EYO1PQ`O'#EVOOQO'#En'#EnOOQO'#Ij'#IjO1XQ`O'#GrO1dQ`O'#EmO1iQ`O'#EmO3hQ!0MxO'#JpO6[Q!0MxO'#JqO6uQ`O'#F[O6zQ,UO'#FsOOQ!0Lf'#Fe'#FeO7VO7dO'#FeO7eQMhO'#F{O9UQ`O'#FzOOQ!0Lf'#Jq'#JqOOQ!0Lb'#Jp'#JpO9ZQ`O'#GvOOQ['#K]'#K]O9fQ`O'#IWO9kQ!0LrO'#IXOOQ['#J^'#J^OOQ['#I]'#I]Q`QlOOQ`QlOOO9sQ!L^O'#DtO9zQlO'#D|O:RQlO'#EOO9aQ`O'#GrO:YQMhO'#CoO:hQ`O'#ElO:sQ`O'#EwO:xQMhO'#FdO;gQ`O'#GrOOQO'#K^'#K^O;lQ`O'#K^O;zQ`O'#GzO;zQ`O'#G{O;zQ`O'#G}O9aQ`O'#HQO<qQ`O'#HTO>YQ`O'#CeO>jQ`O'#HaO>rQ`O'#HgO>rQ`O'#HiO`QlO'#HkO>rQ`O'#HmO>rQ`O'#HpO>wQ`O'#HvO>|Q!0LsO'#H|O%[QlO'#IOO?XQ!0LsO'#IQO?dQ!0LsO'#ISO9kQ!0LrO'#IUO?oQ!0MxO'#CiO@qQpO'#DjQOQ`OOO%[QlO'#EOOAXQ`O'#ERO:YQMhO'#ElOAdQ`O'#ElOAoQ!bO'#FdOOQ['#Cg'#CgOOQ!0Lb'#Do'#DoOOQ!0Lb'#Jt'#JtO%[QlO'#JtOOQO'#Jw'#JwOOQO'#If'#IfOBoQpO'#EeOOQ!0Lb'#Ed'#EdOOQ!0Lb'#J{'#J{OCkQ!0MSO'#EeOCuQpO'#EUOOQO'#Jv'#JvODZQpO'#JwOEhQpO'#EUOCuQpO'#EePEuO&2DjO'#CbPOOO)CD{)CD{OOOO'#I^'#I^OFQO#tO,59UOOQ!0Lh,59U,59UOOOO'#I_'#I_OF`O&jO,59UOFnQ!L^O'#DaOOOO'#Ia'#IaOFuO#@ItO,59yOOQ!0Lf,59y,59yOGTQlO'#IbOGhQ`O'#JrOIgQ!fO'#JrO+}QlO'#JrOInQ`O,5:POJUQ`O'#EnOJcQ`O'#KROJnQ`O'#KQOJnQ`O'#KQOJvQ`O,5;[OJ{Q`O'#KPOOQ!0Ln,5:[,5:[OKSQlO,5:[OMQQ!0MxO,5:dOMqQ`O,5:lON[Q!0LrO'#KOONcQ`O'#J}O9ZQ`O'#J}ONwQ`O'#J}O! PQ`O,5;ZO! UQ`O'#J}O!#ZQ!fO'#JqOOQ!0Lh'#Ci'#CiO%[QlO'#EQO!#yQ!fO,5:qOOQS'#Jx'#JxOOQO-E<h-E<hO9aQ`O,5=^O!$aQ`O,5=^O!$fQlO,5;XO!&iQMhO'#EiO!(SQ`O,5;XO!(XQlO'#DwO!(cQpO,5;bO!(kQpO,5;bO%[QlO,5;bOOQ['#FS'#FSOOQ['#FU'#FUO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cO%[QlO,5;cOOQ['#FY'#FYO!(yQlO,5;sOOQ!0Lf,5;x,5;xOOQ!0Lf,5;y,5;yOOQ!0Lf,5;{,5;{O%[QlO'#InO!*|Q!0LrO,5<hO%[QlO,5;cO!&iQMhO,5;cO!+kQMhO,5;cO!-]QMhO'#E[O%[QlO,5;vOOQ!0Lf,5;z,5;zO!-dQ,UO'#FiO!.aQ,UO'#KVO!-{Q,UO'#KVO!.hQ,UO'#KVOOQO'#KV'#KVO!.|Q,UO,5<ROOOW,5<_,5<_O!/_QlO'#FuOOOW'#Im'#ImO7VO7dO,5<PO!/fQ,UO'#FwOOQ!0Lf,5<P,5<PO!0VQ$IUO'#CwOOQ!0Lh'#C{'#C{O!0jO#@ItO'#DPO!1WQMjO,5<dO!1_Q`O,5<gO!2zQ(CWO'#GWO!3XQ`O'#GXO!3^Q`O'#GXO!4|Q(CWO'#G]O!6RQpO'#GaOOQO'#Gm'#GmO!+rQMhO'#GlOOQO'#Go'#GoO!+rQMhO'#GnO!6tQ$IUO'#JjOOQ!0Lh'#Jj'#JjO!7OQ`O'#JiO!7^Q`O'#JhO!7fQ`O'#CuOOQ!0Lh'#Cy'#CyO!7qQ`O'#C{OOQ!0Lh'#DT'#DTOOQ!0Lh'#DV'#DVO1SQ`O'#DXO!+rQMhO'#GOO!+rQMhO'#GQO!7vQ`O'#GSO!7{Q`O'#GTO!3^Q`O'#GZO!+rQMhO'#G`O;zQ`O'#JiO!8QQ`O'#EoO!8oQ`O,5<fOOQ!0Lb'#Cr'#CrO!8wQ`O'#EpO!9qQpO'#EqOOQ!0Lb'#KP'#KPO!9xQ!0LrO'#K_O9kQ!0LrO,5=bO`QlO,5>rOOQ['#Jf'#JfOOQ[,5>s,5>sOOQ[-E<Z-E<ZO!;wQ!0MxO,5:`O!9lQpO,5:^O!>bQ!0MxO,5:hO%[QlO,5:hO!@xQ!0MxO,5:jOOQO,5@x,5@xO!AiQMhO,5=^O!AwQ!0LrO'#JgO9UQ`O'#JgO!BYQ!0LrO,59ZO!BeQpO,59ZO!BmQMhO,59ZO:YQMhO,59ZO!BxQ`O,5;XO!CQQ`O'#H`O!CfQ`O'#KbO%[QlO,5;|O!9lQpO,5<OO!CnQ`O,5=yO!CsQ`O,5=yO!CxQ`O,5=yO9kQ!0LrO,5=yO;zQ`O,5=iOOQO'#Cw'#CwO!DWQpO,5=fO!D`QMhO,5=gO!DkQ`O,5=iO!DpQ!bO,5=lO!DxQ`O'#K^O>wQ`O'#HVO9aQ`O'#HXO!D}Q`O'#HXO:YQMhO'#HZO!ESQ`O'#HZOOQ[,5=o,5=oO!EXQ`O'#H[O!EjQ`O'#CoO!EoQ`O,59PO!EyQ`O,59PO!HOQlO,59POOQ[,59P,59PO!H`Q!0LrO,59PO%[QlO,59PO!JkQlO'#HcOOQ['#Hd'#HdOOQ['#He'#HeO`QlO,5={O!KRQ`O,5={O`QlO,5>RO`QlO,5>TO!KWQ`O,5>VO`QlO,5>XO!K]Q`O,5>[O!KbQlO,5>bOOQ[,5>h,5>hO%[QlO,5>hO9kQ!0LrO,5>jOOQ[,5>l,5>lO# lQ`O,5>lOOQ[,5>n,5>nO# lQ`O,5>nOOQ[,5>p,5>pO#!YQpO'#D]O%[QlO'#JtO#!{QpO'#JtO##VQpO'#DkO##hQpO'#DkO#%yQlO'#DkO#&QQ`O'#JsO#&YQ`O,5:UO#&_Q`O'#ErO#&mQ`O'#KSO#&uQ`O,5;]O#&zQpO'#DkO#'XQpO'#ETOOQ!0Lf,5:m,5:mO%[QlO,5:mO#'`Q`O,5:mO>wQ`O,5;WO!BeQpO,5;WO!BmQMhO,5;WO:YQMhO,5;WO#'hQ`O,5@`O#'mQ07dO,5:qOOQO-E<d-E<dO#(sQ!0MSO,5;POCuQpO,5:pO#(}QpO,5:pOCuQpO,5;PO!BYQ!0LrO,5:pOOQ!0Lb'#Eh'#EhOOQO,5;P,5;PO%[QlO,5;PO#)[Q!0LrO,5;PO#)gQ!0LrO,5;PO!BeQpO,5:pOOQO,5;V,5;VO#)uQ!0LrO,5;PPOOO'#I['#I[P#*ZO&2DjO,58|POOO,58|,58|OOOO-E<[-E<[OOQ!0Lh1G.p1G.pOOOO-E<]-E<]OOOO,59{,59{O#*fQ!bO,59{OOOO-E<_-E<_OOQ!0Lf1G/e1G/eO#*kQ!fO,5>|O+}QlO,5>|OOQO,5?S,5?SO#*uQlO'#IbOOQO-E<`-E<`O#+SQ`O,5@^O#+[Q!fO,5@^O#+cQ`O,5@lOOQ!0Lf1G/k1G/kO%[QlO,5@mO#+kQ`O'#IhOOQO-E<f-E<fO#+cQ`O,5@lOOQ!0Lb1G0v1G0vOOQ!0Ln1G/v1G/vOOQ!0Ln1G0W1G0WO%[QlO,5@jO#,PQ!0LrO,5@jO#,bQ!0LrO,5@jO#,iQ`O,5@iO9ZQ`O,5@iO#,qQ`O,5@iO#-PQ`O'#IkO#,iQ`O,5@iOOQ!0Lb1G0u1G0uO!(cQpO,5:sO!(nQpO,5:sOOQS,5:u,5:uO#-qQdO,5:uO#-yQMhO1G2xO9aQ`O1G2xOOQ!0Lf1G0s1G0sO#.XQ!0MxO1G0sO#/^Q!0MvO,5;TOOQ!0Lh'#GV'#GVO#/zQ!0MzO'#JjO!$fQlO1G0sO#2VQ!fO'#JuO%[QlO'#JuO#2aQ`O,5:cOOQ!0Lh'#D]'#D]OOQ!0Lf1G0|1G0|O%[QlO1G0|OOQ!0Lf1G1e1G1eO#2fQ`O1G0|O#4zQ!0MxO1G0}O#5RQ!0MxO1G0}O#7iQ!0MxO1G0}O#7pQ!0MxO1G0}O#:WQ!0MxO1G0}O#<nQ!0MxO1G0}O#<uQ!0MxO1G0}O#<|Q!0MxO1G0}O#?dQ!0MxO1G0}O#?kQ!0MxO1G0}O#AxQ?MtO'#CiO#CsQ?MtO1G1_O#CzQ?MtO'#JqO#D_Q!0MxO,5?YOOQ!0Lb-E<l-E<lO#FlQ!0MxO1G0}O#GiQ!0MzO1G0}OOQ!0Lf1G0}1G0}O#HlQMjO'#JzO#HvQ`O,5:vO#H{Q!0MxO1G1bO#IoQ,UO,5<VO#IwQ,UO,5<WO#JPQ,UO'#FnO#JhQ`O'#FmOOQO'#KW'#KWOOQO'#Il'#IlO#JmQ,UO1G1mOOQ!0Lf1G1m1G1mOOOW1G1x1G1xO#KOQ?MtO'#JpO#KYQ`O,5<aO!(yQlO,5<aOOOW-E<k-E<kOOQ!0Lf1G1k1G1kO#K_QpO'#KVOOQ!0Lf,5<c,5<cO#KgQpO,5<cO#KlQMhO'#DROOOO'#I`'#I`O#KsO#@ItO,59kOOQ!0Lh,59k,59kO%[QlO1G2OO!7{Q`O'#IpO#LOQ`O,5<yOOQ!0Lh,5<v,5<vO!+rQMhO'#IsO#LlQMjO,5=WO!+rQMhO'#IuO#M_QMjO,5=YO!&iQMhO,5=[OOQO1G2R1G2RO#MiQ!dO'#CrO#M|Q(CWO'#EpO$ RQpO'#GaO$ iQ!dO,5<rO$ pQ`O'#KYO9ZQ`O'#KYO$!OQ`O,5<tO!+rQMhO,5<sO$!TQ`O'#GYO$!fQ`O,5<sO$!kQ!dO'#GVO$!xQ!dO'#KZO$#SQ`O'#KZO!&iQMhO'#KZO$#XQ`O,5<wO$#^QlO'#JtO$#hQpO'#GbO##hQpO'#GbO$#yQ`O'#GfO!3^Q`O'#GjO$$OQ!0LrO'#IrO$$ZQpO,5<{OOQ!0Lp,5<{,5<{O$$bQpO'#GbO$$oQpO'#GcO$%QQpO'#GcO$%VQMjO,5=WO$%gQMjO,5=YOOQ!0Lh,5=],5=]O!+rQMhO,5@TO!+rQMhO,5@TO$%wQ`O'#IwO$&VQ`O,5@SO$&_Q`O,59aOOQ!0Lh,59g,59gO$'UQ$IYO,59sOOQ!0Lh'#Jn'#JnO$'wQMjO,5<jO$(jQMjO,5<lO@iQ`O,5<nOOQ!0Lh,5<o,5<oO$(tQ`O,5<uO$(yQMjO,5<zO$)ZQ`O,5@TO$)iQ`O'#J}O!$fQlO1G2QO$)nQ`O1G2QO9ZQ`O'#KQO9ZQ`O'#ErO%[QlO'#ErO9ZQ`O'#IyO$)sQ!0LrO,5@yOOQ[1G2|1G2|OOQ[1G4^1G4^OOQ!0Lf1G/z1G/zOOQ!0Lf1G/x1G/xO$+uQ!0MxO1G0SOOQ[1G2x1G2xO!&iQMhO1G2xO%[QlO1G2xO#-|Q`O1G2xO$-yQMhO'#EiOOQ!0Lb,5@R,5@RO$.WQ!0LrO,5@ROOQ[1G.u1G.uO!BYQ!0LrO1G.uO!BeQpO1G.uO!BmQMhO1G.uO$.iQ`O1G0sO$.nQ`O'#CiO$.yQ`O'#KcO$/RQ`O,5=zO$/WQ`O'#KcO$/]Q`O'#KcO$/kQ`O'#JPO$/yQ`O,5@|O$0RQ!fO1G1hOOQ!0Lf1G1j1G1jO9aQ`O1G3eO@iQ`O1G3eO$0YQ`O1G3eO$0_Q`O1G3eOOQ[1G3e1G3eO!DkQ`O1G3TO!&iQMhO1G3QO$0dQ`O1G3QOOQ[1G3R1G3RO!&iQMhO1G3RO$0iQ`O1G3RO$0qQpO'#HPOOQ[1G3T1G3TO!5|QpO'#I{O!DpQ!bO1G3WOOQ[1G3W1G3WOOQ[,5=q,5=qO$0yQMhO,5=sO9aQ`O,5=sO$#yQ`O,5=uO9UQ`O,5=uO!BeQpO,5=uO!BmQMhO,5=uO:YQMhO,5=uO$1XQ`O'#KaO$1dQ`O,5=vOOQ[1G.k1G.kO$1iQ!0LrO1G.kO@iQ`O1G.kO$1tQ`O1G.kO9kQ!0LrO1G.kO$3|Q!fO,5AOO$4ZQ`O,5AOO9ZQ`O,5AOO$4fQlO,5=}O$4mQ`O,5=}OOQ[1G3g1G3gO`QlO1G3gOOQ[1G3m1G3mOOQ[1G3o1G3oO>rQ`O1G3qO$4rQlO1G3sO$8vQlO'#HrOOQ[1G3v1G3vO$9TQ`O'#HxO>wQ`O'#HzOOQ[1G3|1G3|O$9]QlO1G3|O9kQ!0LrO1G4SOOQ[1G4U1G4UOOQ!0Lb'#G^'#G^O9kQ!0LrO1G4WO9kQ!0LrO1G4YO$=dQ`O,5@`O!(yQlO,5;^O9ZQ`O,5;^O>wQ`O,5:VO!(yQlO,5:VO!BeQpO,5:VO$=iQ?MtO,5:VOOQO,5;^,5;^O$=sQpO'#IcO$>ZQ`O,5@_OOQ!0Lf1G/p1G/pO$>cQpO'#IiO$>mQ`O,5@nOOQ!0Lb1G0w1G0wO##hQpO,5:VOOQO'#Ie'#IeO$>uQpO,5:oOOQ!0Ln,5:o,5:oO#'cQ`O1G0XOOQ!0Lf1G0X1G0XO%[QlO1G0XOOQ!0Lf1G0r1G0rO>wQ`O1G0rO!BeQpO1G0rO!BmQMhO1G0rOOQ!0Lb1G5z1G5zO!BYQ!0LrO1G0[OOQO1G0k1G0kO%[QlO1G0kO$>|Q!0LrO1G0kO$?XQ!0LrO1G0kO!BeQpO1G0[OCuQpO1G0[O$?gQ!0LrO1G0kOOQO1G0[1G0[O$?{Q!0MxO1G0kPOOO-E<Y-E<YPOOO1G.h1G.hOOOO1G/g1G/gO$@VQ!bO,5<hO$@_Q!fO1G4hOOQO1G4n1G4nO%[QlO,5>|O$@iQ`O1G5xO$@qQ`O1G6WO$@yQ!fO1G6XO9ZQ`O,5?SO$ATQ!0MxO1G6UO%[QlO1G6UO$AeQ!0LrO1G6UO$AvQ`O1G6TO$AvQ`O1G6TO9ZQ`O1G6TO$BOQ`O,5?VO9ZQ`O,5?VOOQO,5?V,5?VO$BdQ`O,5?VO$)iQ`O,5?VOOQO-E<i-E<iOOQS1G0_1G0_OOQS1G0a1G0aO#-tQ`O1G0aOOQ[7+(d7+(dO!&iQMhO7+(dO%[QlO7+(dO$BrQ`O7+(dO$B}QMhO7+(dO$C]Q!0MzO,5=WO$EhQ!0MzO,5=YO$GsQ!0MzO,5=WO$JUQ!0MzO,5=YO$LgQ!0MzO,59sO$NlQ!0MzO,5<jO%!wQ!0MzO,5<lO%%SQ!0MzO,5<zOOQ!0Lf7+&_7+&_O%'eQ!0MxO7+&_O%(XQlO'#IdO%(fQ`O,5@aO%(nQ!fO,5@aOOQ!0Lf1G/}1G/}O%(xQ`O7+&hOOQ!0Lf7+&h7+&hO%(}Q?MtO,5:dO%[QlO7+&yO%)XQ?MtO,5:`O%)fQ?MtO,5:hO%)pQ?MtO,5:jO%)zQMhO'#IgO%*UQ`O,5@fOOQ!0Lh1G0b1G0bOOQO1G1q1G1qOOQO1G1r1G1rO%*^Q!jO,5<YO!(yQlO,5<XOOQO-E<j-E<jOOQ!0Lf7+'X7+'XOOOW7+'d7+'dOOOW1G1{1G1{O%*iQ`O1G1{OOQ!0Lf1G1}1G1}OOOO,59m,59mO%*nQ!dO,59mOOOO-E<^-E<^OOQ!0Lh1G/V1G/VO%*uQ!0MxO7+'jOOQ!0Lh,5?[,5?[O%+iQMhO1G2eP%+pQ`O'#IpPOQ!0Lh-E<n-E<nO%,^QMjO,5?_OOQ!0Lh-E<q-E<qO%-PQMjO,5?aOOQ!0Lh-E<s-E<sO%-ZQ!dO1G2vO%-bQ!dO'#CrO%-xQMhO'#KQO$#^QlO'#JtOOQ!0Lh1G2^1G2^O%.PQ`O'#IoO%.eQ`O,5@tO%.eQ`O,5@tO%.mQ`O,5@tO%.xQ`O,5@tOOQO1G2`1G2`O%/WQMjO1G2_O!+rQMhO1G2_O%/hQ(CWO'#IqO%/uQ`O,5@uO!&iQMhO,5@uO%/}Q!dO,5@uOOQ!0Lh1G2c1G2cO%2_Q!fO'#CiO%2iQ`O,5=OOOQ!0Lb,5<|,5<|O%2qQpO,5<|OOQ!0Lb,5<},5<}OCfQ`O,5<|O%2|QpO,5<|OOQ!0Lb,5=Q,5=QO$)iQ`O,5=UOOQO,5?^,5?^OOQO-E<p-E<pOOQ!0Lp1G2g1G2gO##hQpO,5<|O$#^QlO,5=OO%3[Q`O,5<}O%3gQpO,5<}O!+rQMhO'#IsO%4aQMjO1G2rO!+rQMhO'#IuO%5SQMjO1G2tO%5^QMjO1G5oO%5hQMjO1G5oOOQO,5?c,5?cOOQO-E<u-E<uOOQO1G.{1G.{O!9lQpO,59uO%[QlO,59uOOQ!0Lh,5<i,5<iO%5uQ`O1G2YO!+rQMhO1G2aO!+rQMhO1G5oO!+rQMhO1G5oO%5zQ!0MxO7+'lOOQ!0Lf7+'l7+'lO!$fQlO7+'lO%6nQ`O,5;^OOQ!0Lb,5?e,5?eOOQ!0Lb-E<w-E<wO%6sQ!dO'#K[O#'cQ`O7+(dO4UQ!fO7+(dO$BuQ`O7+(dO%6}Q!0MvO'#CiO%7nQ!0LrO,5=RO%8PQ!0MvO,5=RO%8dQ`O,5=ROOQ!0Lb1G5m1G5mOOQ[7+$a7+$aO!BYQ!0LrO7+$aO!BeQpO7+$aO!$fQlO7+&_O%8lQ`O'#JOO%9TQ`O,5@}OOQO1G3f1G3fO9aQ`O,5@}O%9TQ`O,5@}O%9]Q`O,5@}OOQO,5?k,5?kOOQO-E<}-E<}OOQ!0Lf7+'S7+'SO%9bQ`O7+)PO9kQ!0LrO7+)PO9aQ`O7+)PO@iQ`O7+)POOQ[7+(o7+(oO%9gQ!0MvO7+(lO!&iQMhO7+(lO!DfQ`O7+(mOOQ[7+(m7+(mO!&iQMhO7+(mO%9qQ`O'#K`O%9|Q`O,5=kOOQO,5?g,5?gOOQO-E<y-E<yOOQ[7+(r7+(rO%;`QpO'#HYOOQ[1G3_1G3_O!&iQMhO1G3_O%[QlO1G3_O%;gQ`O1G3_O%;rQMhO1G3_O9kQ!0LrO1G3aO$#yQ`O1G3aO9UQ`O1G3aO!BeQpO1G3aO!BmQMhO1G3aO%<QQ`O'#I}O%<fQ`O,5@{O%<nQpO,5@{OOQ!0Lb1G3b1G3bOOQ[7+$V7+$VO@iQ`O7+$VO9kQ!0LrO7+$VO%<yQ`O7+$VO%[QlO1G6jO%[QlO1G6kO%=OQ!0LrO1G6jO%=YQlO1G3iO%=aQ`O1G3iO%=fQlO1G3iOOQ[7+)R7+)RO9kQ!0LrO7+)]O`QlO7+)_OOQ['#Kf'#KfOOQ['#JQ'#JQO%=mQlO,5>^OOQ[,5>^,5>^O%[QlO'#HsO%=zQ`O'#HuOOQ[,5>d,5>dO9ZQ`O,5>dOOQ[,5>f,5>fOOQ[7+)h7+)hOOQ[7+)n7+)nOOQ[7+)r7+)rOOQ[7+)t7+)tO%>PQpO1G5zO%>kQ?MtO1G0xO%>uQ`O1G0xOOQO1G/q1G/qO%?QQ?MtO1G/qO>wQ`O1G/qO!(yQlO'#DkOOQO,5>},5>}OOQO-E<a-E<aOOQO,5?T,5?TOOQO-E<g-E<gO!BeQpO1G/qOOQO-E<c-E<cOOQ!0Ln1G0Z1G0ZOOQ!0Lf7+%s7+%sO#'cQ`O7+%sOOQ!0Lf7+&^7+&^O>wQ`O7+&^O!BeQpO7+&^OOQO7+%v7+%vO$?{Q!0MxO7+&VOOQO7+&V7+&VO%[QlO7+&VO%?[Q!0LrO7+&VO!BYQ!0LrO7+%vO!BeQpO7+%vO%?gQ!0LrO7+&VO%?uQ!0MxO7++pO%[QlO7++pO%@VQ`O7++oO%@VQ`O7++oOOQO1G4q1G4qO9ZQ`O1G4qO%@_Q`O1G4qOOQS7+%{7+%{O#'cQ`O<<LOO4UQ!fO<<LOO%@mQ`O<<LOOOQ[<<LO<<LOO!&iQMhO<<LOO%[QlO<<LOO%@uQ`O<<LOO%AQQ!0MzO,5?_O%C]Q!0MzO,5?aO%EhQ!0MzO1G2_O%GyQ!0MzO1G2rO%JUQ!0MzO1G2tO%LaQ!fO,5?OO%[QlO,5?OOOQO-E<b-E<bO%LkQ`O1G5{OOQ!0Lf<<JS<<JSO%LsQ?MtO1G0sO%NzQ?MtO1G0}O& RQ?MtO1G0}O&#SQ?MtO1G0}O&#ZQ?MtO1G0}O&%[Q?MtO1G0}O&']Q?MtO1G0}O&'dQ?MtO1G0}O&'kQ?MtO1G0}O&)lQ?MtO1G0}O&)sQ?MtO1G0}O&)zQ!0MxO<<JeO&+rQ?MtO1G0}O&,oQ?MvO1G0}O&-rQ?MvO'#JjO&/xQ?MtO1G1bO&0VQ?MtO1G0SO&0aQMjO,5?ROOQO-E<e-E<eO!(yQlO'#FpOOQO'#KX'#KXOOQO1G1t1G1tO&0kQ`O1G1sO&0pQ?MtO,5?YOOOW7+'g7+'gOOOO1G/X1G/XO&0zQ!dO1G4vOOQ!0Lh7+(P7+(PP!&iQMhO,5?[O!+rQMhO7+(bO&1RQ`O,5?ZO9ZQ`O,5?ZOOQO-E<m-E<mO&1aQ`O1G6`O&1aQ`O1G6`O&1iQ`O1G6`O&1tQMjO7+'yO&2UQ!dO,5?]O&2`Q`O,5?]O!&iQMhO,5?]OOQO-E<o-E<oO&2eQ!dO1G6aO&2oQ`O1G6aO&2wQ`O1G2jO!&iQMhO1G2jOOQ!0Lb1G2h1G2hOOQ!0Lb1G2i1G2iO%2qQpO1G2hO!BeQpO1G2hOCfQ`O1G2hOOQ!0Lb1G2p1G2pO&2|QpO1G2hO&3[Q`O1G2jO$)iQ`O1G2iOCfQ`O1G2iO$#^QlO1G2jO&3dQ`O1G2iO&4WQMjO,5?_OOQ!0Lh-E<r-E<rO&4yQMjO,5?aOOQ!0Lh-E<t-E<tO!+rQMhO7++ZOOQ!0Lh1G/a1G/aO&5TQ`O1G/aOOQ!0Lh7+'t7+'tO&5YQMjO7+'{O&5jQMjO7++ZO&5tQMjO7++ZO&6RQ!0MxO<<KWOOQ!0Lf<<KW<<KWO&6uQ`O1G0xO!&iQMhO'#IxO&6zQ`O,5@vO&8|Q!fO<<LOO!&iQMhO1G2mO&9TQ!0LrO1G2mOOQ[<<G{<<G{O!BYQ!0LrO<<G{O&9fQ!0MxO<<IyOOQ!0Lf<<Iy<<IyOOQO,5?j,5?jO&:YQ`O,5?jO&:_Q`O,5?jOOQO-E<|-E<|O&:mQ`O1G6iO&:mQ`O1G6iO9aQ`O1G6iO@iQ`O<<LkOOQ[<<Lk<<LkO&:uQ`O<<LkO9kQ!0LrO<<LkOOQ[<<LW<<LWO%9gQ!0MvO<<LWOOQ[<<LX<<LXO!DfQ`O<<LXO&:zQpO'#IzO&;VQ`O,5@zO!(yQlO,5@zOOQ[1G3V1G3VOOQO'#I|'#I|O9kQ!0LrO'#I|O&;_QpO,5=tOOQ[,5=t,5=tO&;fQpO'#EeO&;mQpO'#GdO&;rQ`O7+(yO&;wQ`O7+(yOOQ[7+(y7+(yO!&iQMhO7+(yO%[QlO7+(yO&<PQ`O7+(yOOQ[7+({7+({O9kQ!0LrO7+({O$#yQ`O7+({O9UQ`O7+({O!BeQpO7+({O&<[Q`O,5?iOOQO-E<{-E<{OOQO'#H]'#H]O&<gQ`O1G6gO9kQ!0LrO<<GqOOQ[<<Gq<<GqO@iQ`O<<GqO&<oQ`O7+,UO&<tQ`O7+,VO%[QlO7+,UO%[QlO7+,VOOQ[7+)T7+)TO&<yQ`O7+)TO&=OQlO7+)TO&=VQ`O7+)TOOQ[<<Lw<<LwOOQ[<<Ly<<LyOOQ[-E=O-E=OOOQ[1G3x1G3xO&=[Q`O,5>_OOQ[,5>a,5>aO&=aQ`O1G4OO9ZQ`O7+&dO!(yQlO7+&dOOQO7+%]7+%]O&=fQ?MtO1G6XO>wQ`O7+%]OOQ!0Lf<<I_<<I_OOQ!0Lf<<Ix<<IxO>wQ`O<<IxOOQO<<Iq<<IqO$?{Q!0MxO<<IqO%[QlO<<IqOOQO<<Ib<<IbO!BYQ!0LrO<<IbO&=pQ!0LrO<<IqO&={Q!0MxO<= [O&>]Q`O<= ZOOQO7+*]7+*]O9ZQ`O7+*]OOQ[ANAjANAjO&>eQ!fOANAjO!&iQMhOANAjO#'cQ`OANAjO4UQ!fOANAjO&>lQ`OANAjO%[QlOANAjO&>tQ!0MzO7+'yO&AVQ!0MzO,5?_O&CbQ!0MzO,5?aO&EmQ!0MzO7+'{O&HOQ!fO1G4jO&HYQ?MtO7+&_O&J^Q?MvO,5=WO&LeQ?MvO,5=YO&LuQ?MvO,5=WO&MVQ?MvO,5=YO&MgQ?MvO,59sO' mQ?MvO,5<jO'#pQ?MvO,5<lO'&UQ?MvO,5<zO''zQ?MtO7+'jO'(XQ?MtO7+'lO'(fQ`O,5<[OOQO7+'_7+'_OOQ!0Lh7+*b7+*bO'(kQMjO<<K|OOQO1G4u1G4uO'(rQ`O1G4uO'(}Q`O1G4uO')]Q`O7++zO')]Q`O7++zO!&iQMhO1G4wO')eQ!dO1G4wO')oQ`O7++{O')wQ`O7+(UO'*SQ!dO7+(UOOQ!0Lb7+(S7+(SOOQ!0Lb7+(T7+(TO!BeQpO7+(SOCfQ`O7+(SO'*^Q`O7+(UO!&iQMhO7+(UO$)iQ`O7+(TO'*cQ`O7+(UOCfQ`O7+(TO'*kQMjO<<NuOOQ!0Lh7+${7+${O!+rQMhO<<NuO'*uQ!dO,5?dOOQO-E<v-E<vO'+PQ!0MvO7+(XO!&iQMhO7+(XOOQ[AN=gAN=gO9aQ`O1G5UOOQO1G5U1G5UO'+aQ`O1G5UO'+fQ`O7+,TO'+fQ`O7+,TO9kQ!0LrOANBVO@iQ`OANBVOOQ[ANBVANBVOOQ[ANArANArOOQ[ANAsANAsO'+nQ`O,5?fOOQO-E<x-E<xO'+yQ?MtO1G6fOOQO,5?h,5?hOOQO-E<z-E<zOOQ[1G3`1G3`O',TQ`O,5=OOOQ[<<Le<<LeO!&iQMhO<<LeO&;rQ`O<<LeO',YQ`O<<LeO%[QlO<<LeOOQ[<<Lg<<LgO9kQ!0LrO<<LgO$#yQ`O<<LgO9UQ`O<<LgO',bQpO1G5TO',mQ`O7+,ROOQ[AN=]AN=]O9kQ!0LrOAN=]OOQ[<= p<= pOOQ[<= q<= qO',uQ`O<= pO',zQ`O<= qOOQ[<<Lo<<LoO'-PQ`O<<LoO'-UQlO<<LoOOQ[1G3y1G3yO>wQ`O7+)jO'-]Q`O<<JOO'-hQ?MtO<<JOOOQO<<Hw<<HwOOQ!0LfAN?dAN?dOOQOAN?]AN?]O$?{Q!0MxOAN?]OOQOAN>|AN>|O%[QlOAN?]OOQO<<Mw<<MwOOQ[G27UG27UO!&iQMhOG27UO#'cQ`OG27UO'-rQ!fOG27UO4UQ!fOG27UO'-yQ`OG27UO'.RQ?MtO<<JeO'.`Q?MvO1G2_O'0UQ?MvO,5?_O'2XQ?MvO,5?aO'4[Q?MvO1G2rO'6_Q?MvO1G2tO'8bQ?MtO<<KWO'8oQ?MtO<<IyOOQO1G1v1G1vO!+rQMhOANAhOOQO7+*a7+*aO'8|Q`O7+*aO'9XQ`O<= fO'9aQ!dO7+*cOOQ!0Lb<<Kp<<KpO$)iQ`O<<KpOCfQ`O<<KpO'9kQ`O<<KpO!&iQMhO<<KpOOQ!0Lb<<Kn<<KnO!BeQpO<<KnO'9vQ!dO<<KpOOQ!0Lb<<Ko<<KoO':QQ`O<<KpO!&iQMhO<<KpO$)iQ`O<<KoO':VQMjOANDaO':aQ!0MvO<<KsOOQO7+*p7+*pO9aQ`O7+*pO':qQ`O<= oOOQ[G27qG27qO9kQ!0LrOG27qO!(yQlO1G5QO':yQ`O7+,QO';RQ`O1G2jO&;rQ`OANBPOOQ[ANBPANBPO!&iQMhOANBPO';WQ`OANBPOOQ[ANBRANBRO9kQ!0LrOANBRO$#yQ`OANBROOQO'#H^'#H^OOQO7+*o7+*oOOQ[G22wG22wOOQ[ANE[ANE[OOQ[ANE]ANE]OOQ[ANBZANBZO';`Q`OANBZOOQ[<<MU<<MUO!(yQlOAN?jOOQOG24wG24wO$?{Q!0MxOG24wO#'cQ`OLD,pOOQ[LD,pLD,pO!&iQMhOLD,pO';eQ!fOLD,pO';lQ?MvO7+'yO'=bQ?MvO,5?_O'?eQ?MvO,5?aO'AhQ?MvO7+'{O'C^QMjOG27SOOQO<<M{<<M{OOQ!0LbANA[ANA[O$)iQ`OANA[OCfQ`OANA[O'CnQ!dOANA[OOQ!0LbANAYANAYO'CuQ`OANA[O!&iQMhOANA[O'DQQ!dOANA[OOQ!0LbANAZANAZOOQO<<N[<<N[OOQ[LD-]LD-]O'D[Q?MtO7+*lOOQO'#Ge'#GeOOQ[G27kG27kO&;rQ`OG27kO!&iQMhOG27kOOQ[G27mG27mO9kQ!0LrOG27mOOQ[G27uG27uO'DfQ?MtOG25UOOQOLD*cLD*cOOQ[!$(![!$(![O#'cQ`O!$(![O!&iQMhO!$(![O'DpQ!0MzOG27SOOQ!0LbG26vG26vO$)iQ`OG26vO'GRQ`OG26vOCfQ`OG26vO'G^Q!dOG26vO!&iQMhOG26vOOQ[LD-VLD-VO&;rQ`OLD-VOOQ[LD-XLD-XOOQ[!)9Ev!)9EvO#'cQ`O!)9EvOOQ!0LbLD,bLD,bO$)iQ`OLD,bOCfQ`OLD,bO'GeQ`OLD,bO'GpQ!dOLD,bOOQ[!$(!q!$(!qOOQ[!.K;b!.K;bO'GwQ?MvOG27SOOQ!0Lb!$( |!$( |O$)iQ`O!$( |OCfQ`O!$( |O'ImQ`O!$( |OOQ!0Lb!)9Eh!)9EhO$)iQ`O!)9EhOCfQ`O!)9EhOOQ!0Lb!.K;S!.K;SO$)iQ`O!.K;SOOQ!0Lb!4/0n!4/0nO!(yQlO'#DxO1PQ`O'#EVO'IxQ!fO'#JpO'JPQ!L^O'#DtO'JWQlO'#D|O'J_Q!fO'#CiO'LuQ!fO'#CiO!(yQlO'#EOO'MVQlO,5;XO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO,5;cO!(yQlO'#InO( YQ`O,5<hO!(yQlO,5;cO( bQMhO,5;cO(!{QMhO,5;cO!(yQlO,5;vO!&iQMhO'#GlO( bQMhO'#GlO!&iQMhO'#GnO( bQMhO'#GnO1SQ`O'#DXO1SQ`O'#DXO!&iQMhO'#GOO( bQMhO'#GOO!&iQMhO'#GQO( bQMhO'#GQO!&iQMhO'#G`O( bQMhO'#G`O!(yQlO,5:hO(#SQpO'#D]O(#^QpO'#JtO!(yQlO,5@mO'MVQlO1G0sO(#hQ?MtO'#CiO!(yQlO1G2OO!&iQMhO'#IsO( bQMhO'#IsO!&iQMhO'#IuO( bQMhO'#IuO(#rQ!dO'#CrO!&iQMhO,5<sO( bQMhO,5<sO'MVQlO1G2QO!(yQlO7+&yO!&iQMhO1G2_O( bQMhO1G2_O!&iQMhO'#IsO( bQMhO'#IsO!&iQMhO'#IuO( bQMhO'#IuO!&iQMhO1G2aO( bQMhO1G2aO'MVQlO7+'lO'MVQlO7+&_O!&iQMhOANAhO( bQMhOANAhO($VQ`O'#EmO($[Q`O'#EmO($dQ`O'#F[O($iQ`O'#EwO($nQ`O'#KRO($yQ`O'#KPO(%UQ`O,5;XO(%ZQMjO,5<dO(%bQ`O'#GXO(%gQ`O'#GXO(%lQ`O,5<fO(%tQ`O,5;XO(%|Q?MtO1G1_O(&TQ`O,5<sO(&YQ`O,5<sO(&_Q`O,5<uO(&dQ`O,5<uO(&iQ`O1G2QO(&nQ`O1G0sO(&sQMjO<<K|O(&zQMjO<<K|O7eQMhO'#F{O9UQ`O'#FzOAdQ`O'#ElO!(yQlO,5;sO!3^Q`O'#GXO!3^Q`O'#GXO!3^Q`O'#GZO!3^Q`O'#GZO!+rQMhO7+(bO!+rQMhO7+(bO%-ZQ!dO1G2vO%-ZQ!dO1G2vO!&iQMhO,5=[O!&iQMhO,5=[",stateData:"((P~O'zOS'{OSTOS'|RQ~OPYOQYOSfOY!VOaqOdzOeyOj!POnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]XO!guO!jZO!mYO!nYO!oYO!qvO!swO!vxO!z]O$V|O$miO%g}O%i!QO%k!OO%l!OO%m!OO%p!RO%r!SO%u!TO%v!TO%x!UO&U!WO&[!XO&^!YO&`!ZO&b![O&e!]O&k!^O&q!_O&s!`O&u!aO&w!bO&y!cO(RSO(TTO(WUO(_VO(m[O~OWtO~P`OPYOQYOSfOd!jOe!iOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]!eO!guO!jZO!mYO!nYO!oYO!qvO!s!gO!v!hO$V!kO$miO(R!dO(TTO(WUO(_VO(m[O~Oa!wOq!nO!Q!oO!`!yO!a!vO!b!vO!z;wO#R!pO#S!pO#T!xO#U!pO#V!pO#Y!zO#Z!zO(S!lO(TTO(WUO(c!mO(m!sO~O'|!{O~OP]XR]X[]Xa]Xp]X!O]X!Q]X!Z]X!j]X!n]X#P]X#Q]X#^]X#ifX#l]X#m]X#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#w]X#y]X#z]X$P]X'x]X(_]X(p]X(w]X(x]X~O!e%QX~P(qO_!}O(T#PO(U!}O(V#PO~O_#QO(V#PO(W#PO(X#QO~Ov#SO!S#TO(`#TO(a#VO~OPYOQYOSfOd!jOe!iOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]!eO!guO!jZO!mYO!nYO!oYO!qvO!s!gO!v!hO$V!kO$miO(R;{O(TTO(WUO(_VO(m[O~O!Y#ZO!Z#WO!W(fP!W(tP~P+}O![#cO~P`OPYOQYOSfOd!jOe!iOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]!eO!guO!jZO!mYO!nYO!oYO!qvO!s!gO!v!hO$V!kO$miO(TTO(WUO(_VO(m[O~On#mO!Y#iO!z]O#g#lO#h#iO(R;|O!i(qP~P.iO!j#oO(R#nO~O!v#sO!z]O%g#tO~O#i#uO~O!e#vO#i#uO~OP$[OR#zO[$cOp$aO!O#yO!Q#{O!Z$_O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO#w$UO#y$WO#z$XO(_VO(p$YO(w#|O(x#}O~Oa(dX'x(dX'u(dX!i(dX!W(dX!](dX%h(dX!e(dX~P1qO#Q$dO#^$eO$P$eOP(eXR(eX[(eXp(eX!O(eX!Q(eX!Z(eX!j(eX!n(eX#P(eX#l(eX#m(eX#n(eX#o(eX#p(eX#q(eX#r(eX#s(eX#t(eX#u(eX#w(eX#y(eX#z(eX(_(eX(p(eX(w(eX(x(eX!](eX%h(eX~Oa(eX'x(eX'u(eX!W(eX!i(eXt(eX!e(eX~P4UO#^$eO~O$[$hO$^$gO$e$mO~OSfO!]$nO$h$oO$j$qO~Oh%VOj%cOn%WOp%XOq$tOr$tOx%YOz%ZO|%[O!Q${O!]$|O!g%aO!j$xO#h%bO$V%_O$s%]O$u%^O$x%`O(R$sO(TTO(WUO(_$uO(w$}O(x%POg([P~O!j%dO~O!Q%gO!]%hO(R%fO~O!e%lO~Oa%mO'x%mO~O!O%qO~P%[O(S!lO~P%[O%m%uO~P%[Oh%VO!j%dO(R%fO(S!lO~Oe%|O!j%dO(R%fO~O#t$RO~O!O&RO!]&OO!j&QO%i&UO(R%fO(S!lO(TTO(WUO`)UP~O!v#sO~O%r&WO!Q)QX!])QX(R)QX~O(R&XO~Oj!PO!s&^O%i!QO%k!OO%l!OO%m!OO%p!RO%r!SO%u!TO%v!TO~Od&cOe&bO!v&`O%g&aO%z&_O~P<POd&fOeyOj!PO!]&eO!s&^O!vxO!z]O%g}O%k!OO%l!OO%m!OO%p!RO%r!SO%u!TO%v!TO%x!UO~Ob&iO#^&lO%i&gO(S!lO~P=UO!j&mO!s&qO~O!j#oO~O!]XO~Oa%mO'v&yO'x%mO~Oa%mO'v&|O'x%mO~Oa%mO'v'OO'x%mO~O'u]X!W]Xt]X!i]X&Y]X!]]X%h]X!e]X~P(qO!`']O!a'UO!b'UO(S!lO(TTO(WUO~Oq'SO!Q'RO!Y'VO(c'QO![(gP![(vP~P@]Ol'`O!]'^O(R%fO~Oe'eO!j%dO(R%fO~O!O&RO!j&QO~Oq!nO!Q!oO!z;wO#R!pO#S!pO#U!pO#V!pO(S!lO(TTO(WUO(c!mO(m!sO~O!`'kO!a'jO!b'jO#T!pO#Y'lO#Z'lO~PAwOa%mOh%VO!e#vO!j%dO'x%mO(p'nO~O!n'rO#^'pO~PCVOq!nO!Q!oO(TTO(WUO(c!mO(m!sO~O!]XOq(kX!Q(kX!`(kX!a(kX!b(kX!z(kX#R(kX#S(kX#T(kX#U(kX#V(kX#Y(kX#Z(kX(S(kX(T(kX(W(kX(c(kX(m(kX~O!a'jO!b'jO(S!lO~PCuO'}'vO(O'vO(P'xO~O_!}O(T'zO(U!}O(V'zO~O_#QO(V'zO(W'zO(X#QO~Ot'|O~P%[Ov#SO!S#TO(`#TO(a(PO~O!Y(RO!W'UX!W'[X!Z'UX!Z'[X~P+}O!Z(TO!W(fX~OP$[OR#zO[$cOp$aO!O#yO!Q#{O!Z(TO!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO#w$UO#y$WO#z$XO(_VO(p$YO(w#|O(x#}O~O!W(fX~PGpO!W(YO~O!W(sX!Z(sX!e(sX!i(sX(p(sX~O#^(sX#i#bX![(sX~PIsO#^(ZO!W(uX!Z(uX~O!Z([O!W(tX~O!W(_O~O#^$eO~PIsO![(`O~P`OR#zO!O#yO!Q#{O!j#xO(_VOP!la[!lap!la!Z!la!n!la#P!la#l!la#m!la#n!la#o!la#p!la#q!la#r!la#s!la#t!la#u!la#w!la#y!la#z!la(p!la(w!la(x!la~Oa!la'x!la'u!la!W!la!i!lat!la!]!la%h!la!e!la~PKZO!i(aO~O!e#vO#^(bO(p'nO!Z(rXa(rX'x(rX~O!i(rX~PMvO!Q%gO!]%hO!z]O#g(gO#h(fO(R%fO~O!Z(hO!i(qX~O!i(jO~O!Q%gO!]%hO#h(fO(R%fO~OP(eXR(eX[(eXp(eX!O(eX!Q(eX!Z(eX!j(eX!n(eX#P(eX#l(eX#m(eX#n(eX#o(eX#p(eX#q(eX#r(eX#s(eX#t(eX#u(eX#w(eX#y(eX#z(eX(_(eX(p(eX(w(eX(x(eX~O!e#vO!i(eX~P! dOR(lO!O(kO!j#xO#Q$dO!z!ya!Q!ya~O!v!ya%g!ya!]!ya#g!ya#h!ya(R!ya~P!#eO!v(pO~OPYOQYOSfOd!jOe!iOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]XO!guO!jZO!mYO!nYO!oYO!qvO!s!gO!v!hO$V!kO$miO(R!dO(TTO(WUO(_VO(m[O~Oh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|<eO!Q${O!]$|O!g=vO!j$xO#h<kO$V%_O$s<gO$u<iO$x%`O(R(tO(TTO(WUO(_$uO(w$}O(x%PO~O#i(vO~O!Y(xO!i(iP~P%[O(c(zO(m[O~O!Q(|O!j#xO(c(zO(m[O~OP;vOQ;vOSfOd=rOe!iOnkOp;vOqkOrkOxkOz;vO|;vO!QWO!UkO!VkO!]!eO!g;yO!jZO!m;vO!n;vO!o;vO!q;zO!s;}O!v!hO$V!kO$m=pO(R)ZO(TTO(WUO(_VO(m[O~O!Z$_Oa$pa'x$pa'u$pa!i$pa!W$pa!]$pa%h$pa!e$pa~Oj)bO~P!&iOh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|%[O!Q${O!]$|O!g%aO!j$xO#h%bO$V%_O$s%]O$u%^O$x%`O(R(tO(TTO(WUO(_$uO(w$}O(x%PO~Og(nP~P!+rO!O)gO!e)fO!]$]X$Y$]X$[$]X$^$]X$e$]X~O!e)fO!](yX$Y(yX$[(yX$^(yX$e(yX~O!O)gO~P!-{O!O)gO!](yX$Y(yX$[(yX$^(yX$e(yX~O!])iO$Y)mO$[)hO$^)hO$e)nO~O!Y)qO~P!(yO$[$hO$^$gO$e)uO~Ol$yX!O$yX#Q$yX'w$yX(w$yX(x$yX~OgkXg$yXlkX!ZkX#^kX~P!/qOv)wO(`)xO(a)zO~Ol*TO!O)|O'w)}O(w$}O(x%PO~Og){O~P!0uOg*UO~Oh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|<eO!Q*WO!]*XO!g=vO!j$xO#h<kO$V%_O$s<gO$u<iO$x%`O(TTO(WUO(_$uO(w$}O(x%PO~O!Y*[O(R*VO!i(|P~P!1dO#i*^O~O!j*_O~Oh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|<eO!Q${O!]$|O!g=vO!j$xO#h<kO$V%_O$s<gO$u<iO$x%`O(R*aO(TTO(WUO(_$uO(w$}O(x%PO~O!Y*dO!W(}P~P!3cOp*pOq!nO!Q*fO!`*nO!a*hO!b*hO!j*_O#Y*oO%_*jO(S!lO(TTO(WUO(c!mO~O![*mO~P!5WO#Q$dOl(^X!O(^X'w(^X(w(^X(x(^X!Z(^X#^(^X~Og(^X#}(^X~P!6YOl*uO#^*tOg(]X!Z(]X~O!Z*vOg([X~Oj%cO(R&XOg([P~Oq*yO~O!j+OO~O(R(tO~On+TO!Q%gO!Y#iO!]%hO!z]O#g#lO#h#iO(R%fO!i(qP~O!e#vO#i+UO~O!Q%gO!Y+WO!Z([O!]%hO(R%fO!W(tP~Oq'YO!Q+YO!Y+XO(TTO(WUO(c(zO~O![(vP~P!9]O!Z+ZOa)RX'x)RX~OP$[OR#zO[$cOp$aO!O#yO!Q#{O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO#w$UO#y$WO#z$XO(_VO(p$YO(w#|O(x#}O~Oa!ha!Z!ha'x!ha'u!ha!W!ha!i!hat!ha!]!ha%h!ha!e!ha~P!:TOR#zO!O#yO!Q#{O!j#xO(_VOP!pa[!pap!pa!Z!pa!n!pa#P!pa#l!pa#m!pa#n!pa#o!pa#p!pa#q!pa#r!pa#s!pa#t!pa#u!pa#w!pa#y!pa#z!pa(p!pa(w!pa(x!pa~Oa!pa'x!pa'u!pa!W!pa!i!pat!pa!]!pa%h!pa!e!pa~P!<kOR#zO!O#yO!Q#{O!j#xO(_VOP!ra[!rap!ra!Z!ra!n!ra#P!ra#l!ra#m!ra#n!ra#o!ra#p!ra#q!ra#r!ra#s!ra#t!ra#u!ra#w!ra#y!ra#z!ra(p!ra(w!ra(x!ra~Oa!ra'x!ra'u!ra!W!ra!i!rat!ra!]!ra%h!ra!e!ra~P!?ROh%VOl+dO!]'^O%h+cO~O!e+fOa(ZX!](ZX'x(ZX!Z(ZX~Oa%mO!]XO'x%mO~Oh%VO!j%dO~Oh%VO!j%dO(R%fO~O!e#vO#i(vO~Ob+qO%i+rO(R+nO(TTO(WUO![)VP~O!Z+sO`)UX~O[+wO~O`+xO~O!]&OO(R%fO(S!lO`)UP~Oh%VO#^+}O~Oh%VOl,QO!]$|O~O!],SO~O!O,UO!]XO~O%m%uO~O!v,ZO~Oe,`O~Ob,aO(R#nO(TTO(WUO![)TP~Oe%|O~O%i!QO(R&XO~P=UO[,fO`,eO~OPYOQYOSfOdzOeyOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!guO!jZO!mYO!nYO!oYO!qvO!vxO!z]O$miO%g}O(TTO(WUO(_VO(m[O~O!]!eO!s!gO$V!kO(R!dO~P!FRO`,eOa%mO'x%mO~OPYOQYOSfOd!jOe!iOnkOpYOqkOrkOxkOzYO|YO!QWO!UkO!VkO!]!eO!guO!jZO!mYO!nYO!oYO!qvO!v!hO$V!kO$miO(R!dO(TTO(WUO(_VO(m[O~Oa,kOj!OO!swO%k!OO%l!OO%m!OO~P!HkO!j&mO~O&[,qO~O!],sO~O&m,uO&o,vOP&jaQ&jaS&jaY&jaa&jad&jae&jaj&jan&jap&jaq&jar&jax&jaz&ja|&ja!Q&ja!U&ja!V&ja!]&ja!g&ja!j&ja!m&ja!n&ja!o&ja!q&ja!s&ja!v&ja!z&ja$V&ja$m&ja%g&ja%i&ja%k&ja%l&ja%m&ja%p&ja%r&ja%u&ja%v&ja%x&ja&U&ja&[&ja&^&ja&`&ja&b&ja&e&ja&k&ja&q&ja&s&ja&u&ja&w&ja&y&ja'u&ja(R&ja(T&ja(W&ja(_&ja(m&ja![&ja&c&jab&ja&h&ja~O(R,{O~Oh!cX!Z!PX![!PX!e!PX!e!cX!j!cX#^!PX~O!Z!cX![!cX~P# qO!e-QO#^-POh(hX!Z#fX![#fX!e(hX!j(hX~O!Z(hX![(hX~P#!dOh%VO!e-SO!j%dO!Z!_X![!_X~Oq!nO!Q!oO(TTO(WUO(c!mO~OP;vOQ;vOSfOd=rOe!iOnkOp;vOqkOrkOxkOz;vO|;vO!QWO!UkO!VkO!]!eO!g;yO!jZO!m;vO!n;vO!o;vO!q;zO!s;}O!v!hO$V!kO$m=pO(TTO(WUO(_VO(m[O~O(R<rO~P##yO!Z-WO![(gX~O![-YO~O!e-QO#^-PO!Z#fX![#fX~O!Z-ZO![(vX~O![-]O~O!a-^O!b-^O(S!lO~P##hO![-aO~P'_Ol-dO!]'^O~O!W-iO~Oq!ya!`!ya!a!ya!b!ya#R!ya#S!ya#T!ya#U!ya#V!ya#Y!ya#Z!ya(S!ya(T!ya(W!ya(c!ya(m!ya~P!#eO!n-nO#^-lO~PCVO!a-pO!b-pO(S!lO~PCuOa%mO#^-lO'x%mO~Oa%mO!e#vO#^-lO'x%mO~Oa%mO!e#vO!n-nO#^-lO'x%mO(p'nO~O'}'vO(O'vO(P-uO~Ot-vO~O!W'Ua!Z'Ua~P!:TO!Y-zO!W'UX!Z'UX~P%[O!Z(TO!W(fa~O!W(fa~PGpO!Z([O!W(ta~O!Q%gO!Y.OO!]%hO(R%fO!W'[X!Z'[X~O#^.QO!Z(ra!i(raa(ra'x(ra~O!e#vO~P#,PO!Z(hO!i(qa~O!Q%gO!]%hO#h.UO(R%fO~On.ZO!Q%gO!Y.WO!]%hO!z]O#g.YO#h.WO(R%fO!Z'_X!i'_X~OR._O!j#xO~Oh%VOl.bO!]'^O%h.aO~Oa#ai!Z#ai'x#ai'u#ai!W#ai!i#ait#ai!]#ai%h#ai!e#ai~P!:TOl=|O!O)|O'w)}O(w$}O(x%PO~O#i#]aa#]a#^#]a'x#]a!Z#]a!i#]a!]#]a!W#]a~P#.{O#i(^XP(^XR(^X[(^Xa(^Xp(^X!Q(^X!j(^X!n(^X#P(^X#l(^X#m(^X#n(^X#o(^X#p(^X#q(^X#r(^X#s(^X#t(^X#u(^X#w(^X#y(^X#z(^X'x(^X(_(^X(p(^X!i(^X!W(^X'u(^Xt(^X!](^X%h(^X!e(^X~P!6YO!Z.oO!i(iX~P!:TO!i.rO~O!W.tO~OP$[OR#zO!O#yO!Q#{O!j#xO!n$[O(_VO[#kia#kip#ki!Z#ki#P#ki#m#ki#n#ki#o#ki#p#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki'x#ki(p#ki(w#ki(x#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#l#ki~P#2kO#l$OO~P#2kOP$[OR#zOp$aO!O#yO!Q#{O!j#xO!n$[O#l$OO#m$PO#n$PO#o$PO(_VO[#kia#ki!Z#ki#P#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki'x#ki(p#ki(w#ki(x#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#p#ki~P#5YO#p$QO~P#5YOP$[OR#zO[$cOp$aO!O#yO!Q#{O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO(_VOa#ki!Z#ki#w#ki#y#ki#z#ki'x#ki(p#ki(w#ki(x#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#u#ki~P#7wOP$[OR#zO[$cOp$aO!O#yO!Q#{O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO(_VO(x#}Oa#ki!Z#ki#y#ki#z#ki'x#ki(p#ki(w#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#w$UO~P#:_O#w#ki~P#:_O#u$SO~P#7wOP$[OR#zO[$cOp$aO!O#yO!Q#{O!j#xO!n$[O#P$RO#l$OO#m$PO#n$PO#o$PO#p$QO#q$RO#r$RO#s$bO#t$RO#u$SO#w$UO(_VO(w#|O(x#}Oa#ki!Z#ki#z#ki'x#ki(p#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~O#y#ki~P#=TO#y$WO~P#=TOP]XR]X[]Xp]X!O]X!Q]X!j]X!n]X#P]X#Q]X#^]X#ifX#l]X#m]X#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#w]X#y]X#z]X$P]X(_]X(p]X(w]X(x]X!Z]X![]X~O#}]X~P#?rOP$[OR#zO[<_Op<]O!O#yO!Q#{O!j#xO!n$[O#P<SO#l<PO#m<QO#n<QO#o<QO#p<RO#q<SO#r<SO#s<^O#t<SO#u<TO#w<VO#y<XO#z<YO(_VO(p$YO(w#|O(x#}O~O#}.vO~P#BPO#Q$dO#^<`O$P<`O#}(eX![(eX~P! dOa'ba!Z'ba'x'ba'u'ba!i'ba!W'bat'ba!]'ba%h'ba!e'ba~P!:TO[#kia#kip#ki!Z#ki#P#ki#p#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki'x#ki(p#ki'u#ki!W#ki!i#kit#ki!]#ki%h#ki!e#ki~OP$[OR#zO!O#yO!Q#{O!j#xO!n$[O#l$OO#m$PO#n$PO#o$PO(_VO(w#ki(x#ki~P#EROl=|O!O)|O'w)}O(w$}O(x%POP#kiR#ki!Q#ki!j#ki!n#ki#l#ki#m#ki#n#ki#o#ki(_#ki~P#ERO!Z.zOg(nX~P!0uOg.|O~Oa$Oi!Z$Oi'x$Oi'u$Oi!W$Oi!i$Oit$Oi!]$Oi%h$Oi!e$Oi~P!:TO$[.}O$^.}O~O$[/OO$^/OO~O!e)fO#^/PO!]$bX$Y$bX$[$bX$^$bX$e$bX~O!Y/QO~O!])iO$Y/SO$[)hO$^)hO$e/TO~O!Z<ZO![(dX~P#BPO![/UO~O!e)fO$e(yX~O$e/WO~Ot/XO~P!&iOv)wO(`)xO(a/[O~O!Q/_O~O(w$}Ol%`a!O%`a'w%`a(x%`a!Z%`a#^%`a~Og%`a#}%`a~P#LTO(x%POl%ba!O%ba'w%ba(w%ba!Z%ba#^%ba~Og%ba#}%ba~P#LvO!ZfX!efX!ifX!i$yX(pfX~P!/qO!Y/hO!Z([O(R/gO!W(tP!W(}P~P!1dOp*pO!`*nO!a*hO!b*hO!j*_O#Y*oO%_*jO(S!lO(TTO(WUO~Oq<oO!Q/iO!Y+XO![*mO(c<nO![(vP~P#NaO!i/jO~P#.{O!Z/kO!e#vO(p'nO!i(|X~O!i/pO~O!Q%gO!Y*[O!]%hO(R%fO!i(|P~O#i/rO~O!W$yX!Z$yX!e%QX~P!/qO!Z/sO!W(}X~P#.{O!e/uO~O!W/wO~OnkO(R/xO~P.iOh%VOp/}O!e#vO!j%dO(p'nO~O!e+fO~Oa%mO!Z0RO'x%mO~O![0TO~P!5WO!a0UO!b0UO(S!lO~P##hOq!nO!Q0VO(TTO(WUO(c!mO~O#Y0XO~Og%`a!Z%`a#^%`a#}%`a~P!0uOg%ba!Z%ba#^%ba#}%ba~P!0uOj%cO(R&XOg'kX!Z'kX~O!Z*vOg([a~Og0bO~OR0cO!O0cO!Q0dO#Q$dOl{a'w{a(w{a(x{a!Z{a#^{a~Og{a#}{a~P$&dO!O)|O'w)}Ol$ra(w$ra(x$ra!Z$ra#^$ra~Og$ra#}$ra~P$'`O!O)|O'w)}Ol$ta(w$ta(x$ta!Z$ta#^$ta~Og$ta#}$ta~P$(RO#i0gO~Og%Sa!Z%Sa#^%Sa#}%Sa~P!0uOl0iO#^0hOg(]a!Z(]a~O!e#vO~O#i0lO~O!Z+ZOa)Ra'x)Ra~OR#zO!O#yO!Q#{O!j#xO(_VOP!pi[!pip!pi!Z!pi!n!pi#P!pi#l!pi#m!pi#n!pi#o!pi#p!pi#q!pi#r!pi#s!pi#t!pi#u!pi#w!pi#y!pi#z!pi(p!pi(w!pi(x!pi~Oa!pi'x!pi'u!pi!W!pi!i!pit!pi!]!pi%h!pi!e!pi~P$*OOh%VOp%XOq$tOr$tOx%YOz%ZO|<eO!Q${O!]$|O!g=vO!j$xO#h<kO$V%_O$s<gO$u<iO$x%`O(TTO(WUO(_$uO(w$}O(x%PO~On0vO%[0wO(R0tO~P$,fO!e+fOa(Za!](Za'x(Za!Z(Za~O#i0|O~O[]X!ZfX![fX~O!Z0}O![)VX~O![1PO~O[1QO~Ob1SO(R+nO(TTO(WUO~O!]&OO(R%fO`'sX!Z'sX~O!Z+sO`)Ua~O!i1VO~P!:TO[1YO~O`1ZO~O#^1^O~Ol1aO!]$|O~O(c(zO![)SP~Oh%VOl1jO!]1gO%h1iO~O[1tO!Z1rO![)TX~O![1uO~O`1wOa%mO'x%mO~O(R#nO(TTO(WUO~O#Q$dO#^$eO$P$eOP(eXR(eX[(eXp(eX!O(eX!Q(eX!Z(eX!j(eX!n(eX#P(eX#l(eX#m(eX#n(eX#o(eX#p(eX#q(eX#r(eX#s(eX#u(eX#w(eX#y(eX#z(eX(_(eX(p(eX(w(eX(x(eX~O#t1zO&Y1{Oa(eX~P$2PO#^$eO#t1zO&Y1{O~Oa1}O~P%[Oa2PO~O&c2SOP&aiQ&aiS&aiY&aia&aid&aie&aij&ain&aip&aiq&air&aix&aiz&ai|&ai!Q&ai!U&ai!V&ai!]&ai!g&ai!j&ai!m&ai!n&ai!o&ai!q&ai!s&ai!v&ai!z&ai$V&ai$m&ai%g&ai%i&ai%k&ai%l&ai%m&ai%p&ai%r&ai%u&ai%v&ai%x&ai&U&ai&[&ai&^&ai&`&ai&b&ai&e&ai&k&ai&q&ai&s&ai&u&ai&w&ai&y&ai'u&ai(R&ai(T&ai(W&ai(_&ai(m&ai![&aib&ai&h&ai~Ob2YO![2WO&h2XO~P`O!]XO!j2[O~O&o,vOP&jiQ&jiS&jiY&jia&jid&jie&jij&jin&jip&jiq&jir&jix&jiz&ji|&ji!Q&ji!U&ji!V&ji!]&ji!g&ji!j&ji!m&ji!n&ji!o&ji!q&ji!s&ji!v&ji!z&ji$V&ji$m&ji%g&ji%i&ji%k&ji%l&ji%m&ji%p&ji%r&ji%u&ji%v&ji%x&ji&U&ji&[&ji&^&ji&`&ji&b&ji&e&ji&k&ji&q&ji&s&ji&u&ji&w&ji&y&ji'u&ji(R&ji(T&ji(W&ji(_&ji(m&ji![&ji&c&jib&ji&h&ji~O!W2bO~O!Z!_a![!_a~P#BPOq!nO!Q!oO!Y2hO(c!mO!Z'VX!['VX~P@]O!Z-WO![(ga~O!Z']X![']X~P!9]O!Z-ZO![(va~O![2oO~P'_Oa%mO#^2xO'x%mO~Oa%mO!e#vO#^2xO'x%mO~Oa%mO!e#vO!n2|O#^2xO'x%mO(p'nO~Oa%mO'x%mO~P!:TO!Z$_Ot$pa~O!W'Ui!Z'Ui~P!:TO!Z(TO!W(fi~O!Z([O!W(ti~O!W(ui!Z(ui~P!:TO!Z(ri!i(ria(ri'x(ri~P!:TO#^3OO!Z(ri!i(ria(ri'x(ri~O!Z(hO!i(qi~O!Q%gO!]%hO!z]O#g3TO#h3SO(R%fO~O!Q%gO!]%hO#h3SO(R%fO~Ol3[O!]'^O%h3ZO~Oh%VOl3[O!]'^O%h3ZO~O#i%`aP%`aR%`a[%`aa%`ap%`a!Q%`a!j%`a!n%`a#P%`a#l%`a#m%`a#n%`a#o%`a#p%`a#q%`a#r%`a#s%`a#t%`a#u%`a#w%`a#y%`a#z%`a'x%`a(_%`a(p%`a!i%`a!W%`a'u%`at%`a!]%`a%h%`a!e%`a~P#LTO#i%baP%baR%ba[%baa%bap%ba!Q%ba!j%ba!n%ba#P%ba#l%ba#m%ba#n%ba#o%ba#p%ba#q%ba#r%ba#s%ba#t%ba#u%ba#w%ba#y%ba#z%ba'x%ba(_%ba(p%ba!i%ba!W%ba'u%bat%ba!]%ba%h%ba!e%ba~P#LvO#i%`aP%`aR%`a[%`aa%`ap%`a!Q%`a!Z%`a!j%`a!n%`a#P%`a#l%`a#m%`a#n%`a#o%`a#p%`a#q%`a#r%`a#s%`a#t%`a#u%`a#w%`a#y%`a#z%`a'x%`a(_%`a(p%`a!i%`a!W%`a'u%`a#^%`at%`a!]%`a%h%`a!e%`a~P#.{O#i%baP%baR%ba[%baa%bap%ba!Q%ba!Z%ba!j%ba!n%ba#P%ba#l%ba#m%ba#n%ba#o%ba#p%ba#q%ba#r%ba#s%ba#t%ba#u%ba#w%ba#y%ba#z%ba'x%ba(_%ba(p%ba!i%ba!W%ba'u%ba#^%bat%ba!]%ba%h%ba!e%ba~P#.{O#i{aP{a[{aa{ap{a!j{a!n{a#P{a#l{a#m{a#n{a#o{a#p{a#q{a#r{a#s{a#t{a#u{a#w{a#y{a#z{a'x{a(_{a(p{a!i{a!W{a'u{at{a!]{a%h{a!e{a~P$&dO#i$raP$raR$ra[$raa$rap$ra!Q$ra!j$ra!n$ra#P$ra#l$ra#m$ra#n$ra#o$ra#p$ra#q$ra#r$ra#s$ra#t$ra#u$ra#w$ra#y$ra#z$ra'x$ra(_$ra(p$ra!i$ra!W$ra'u$rat$ra!]$ra%h$ra!e$ra~P$'`O#i$taP$taR$ta[$taa$tap$ta!Q$ta!j$ta!n$ta#P$ta#l$ta#m$ta#n$ta#o$ta#p$ta#q$ta#r$ta#s$ta#t$ta#u$ta#w$ta#y$ta#z$ta'x$ta(_$ta(p$ta!i$ta!W$ta'u$tat$ta!]$ta%h$ta!e$ta~P$(RO#i%SaP%SaR%Sa[%Saa%Sap%Sa!Q%Sa!Z%Sa!j%Sa!n%Sa#P%Sa#l%Sa#m%Sa#n%Sa#o%Sa#p%Sa#q%Sa#r%Sa#s%Sa#t%Sa#u%Sa#w%Sa#y%Sa#z%Sa'x%Sa(_%Sa(p%Sa!i%Sa!W%Sa'u%Sa#^%Sat%Sa!]%Sa%h%Sa!e%Sa~P#.{Oa#aq!Z#aq'x#aq'u#aq!W#aq!i#aqt#aq!]#aq%h#aq!e#aq~P!:TO!Y3dO!Z'WX!i'WX~P%[O!Z.oO!i(ia~O!Z.oO!i(ia~P!:TO!W3gO~O#}!la![!la~PKZO#}!ha!Z!ha![!ha~P#BPO#}!pa![!pa~P!<kO#}!ra![!ra~P!?ROg'ZX!Z'ZX~P!+rO!Z.zOg(na~OSfO!]3{O$c3|O~O![4QO~Ot4RO~P#.{Oa$lq!Z$lq'x$lq'u$lq!W$lq!i$lqt$lq!]$lq%h$lq!e$lq~P!:TO!W4TO~P!&iO!Q4UO~O!O)|O'w)}O(x%POl'ga(w'ga!Z'ga#^'ga~Og'ga#}'ga~P%+uO!O)|O'w)}Ol'ia(w'ia(x'ia!Z'ia#^'ia~Og'ia#}'ia~P%,hO(p$YO~P#.{O!WfX!W$yX!ZfX!Z$yX!e%QX#^fX~P!/qO(R<xO~P!1dO!Q%gO!Y4XO!]%hO(R%fO!Z'cX!i'cX~O!Z/kO!i(|a~O!Z/kO!e#vO!i(|a~O!Z/kO!e#vO(p'nO!i(|a~Og${i!Z${i#^${i#}${i~P!0uO!Y4aO!W'eX!Z'eX~P!3cO!Z/sO!W(}a~O!Z/sO!W(}a~P#.{OP]XR]X[]Xp]X!O]X!Q]X!W]X!Z]X!j]X!n]X#P]X#Q]X#^]X#ifX#l]X#m]X#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#w]X#y]X#z]X$P]X(_]X(p]X(w]X(x]X~O!e%XX#t%XX~P%0XO!e#vO#t4fO~Oh%VO!e#vO!j%dO~Oh%VOp4kO!j%dO(p'nO~Op4pO!e#vO(p'nO~Oq!nO!Q4qO(TTO(WUO(c!mO~O(w$}Ol%`i!O%`i'w%`i(x%`i!Z%`i#^%`i~Og%`i#}%`i~P%3xO(x%POl%bi!O%bi'w%bi(w%bi!Z%bi#^%bi~Og%bi#}%bi~P%4kOg(]i!Z(]i~P!0uO#^4wOg(]i!Z(]i~P!0uO!i4zO~Oa$nq!Z$nq'x$nq'u$nq!W$nq!i$nqt$nq!]$nq%h$nq!e$nq~P!:TO!W5QO~O!Z5RO!])OX~P#.{Oa]Xa$yX!]]X!]$yX%]]X'x]X'x$yX!Z]X!Z$yX~P!/qO%]5UOa%Za!]%Za'x%Za!Z%Za~OlmX!OmX'wmX(wmX(xmX~P%7nOn5VO(R#nO~Ob5]O%i5^O(R+nO(TTO(WUO!Z'rX!['rX~O!Z0}O![)Va~O[5bO~O`5cO~Oa%mO'x%mO~P#.{O!Z5kO#^5mO![)SX~O![5nO~Op5tOq!nO!Q*fO!`!yO!a!vO!b!vO!z;wO#R!pO#S!pO#T!pO#U!pO#V!pO#Y5sO#Z!zO(S!lO(TTO(WUO(c!mO(m!sO~O![5rO~P%:ROl5yO!]1gO%h5xO~Oh%VOl5yO!]1gO%h5xO~Ob6QO(R#nO(TTO(WUO!Z'qX!['qX~O!Z1rO![)Ta~O(TTO(WUO(c6SO~O`6WO~O#t6ZO&Y6[O~PMvO!i6]O~P%[Oa6_O~Oa6_O~P%[Ob2YO![6dO&h2XO~P`O!e6fO~O!e6hOh(hi!Z(hi![(hi!e(hi!j(hip(hi(p(hi~O!Z#fi![#fi~P#BPO#^6iO!Z#fi![#fi~O!Z!_i![!_i~P#BPOa%mO#^6rO'x%mO~Oa%mO!e#vO#^6rO'x%mO~O!Z(rq!i(rqa(rq'x(rq~P!:TO!Z(hO!i(qq~O!Q%gO!]%hO#h6yO(R%fO~O!]'^O%h6|O~Ol7QO!]'^O%h6|O~O#i'gaP'gaR'ga['gaa'gap'ga!Q'ga!j'ga!n'ga#P'ga#l'ga#m'ga#n'ga#o'ga#p'ga#q'ga#r'ga#s'ga#t'ga#u'ga#w'ga#y'ga#z'ga'x'ga(_'ga(p'ga!i'ga!W'ga'u'gat'ga!]'ga%h'ga!e'ga~P%+uO#i'iaP'iaR'ia['iaa'iap'ia!Q'ia!j'ia!n'ia#P'ia#l'ia#m'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#w'ia#y'ia#z'ia'x'ia(_'ia(p'ia!i'ia!W'ia'u'iat'ia!]'ia%h'ia!e'ia~P%,hO#i${iP${iR${i[${ia${ip${i!Q${i!Z${i!j${i!n${i#P${i#l${i#m${i#n${i#o${i#p${i#q${i#r${i#s${i#t${i#u${i#w${i#y${i#z${i'x${i(_${i(p${i!i${i!W${i'u${i#^${it${i!]${i%h${i!e${i~P#.{O#i%`iP%`iR%`i[%`ia%`ip%`i!Q%`i!j%`i!n%`i#P%`i#l%`i#m%`i#n%`i#o%`i#p%`i#q%`i#r%`i#s%`i#t%`i#u%`i#w%`i#y%`i#z%`i'x%`i(_%`i(p%`i!i%`i!W%`i'u%`it%`i!]%`i%h%`i!e%`i~P%3xO#i%biP%biR%bi[%bia%bip%bi!Q%bi!j%bi!n%bi#P%bi#l%bi#m%bi#n%bi#o%bi#p%bi#q%bi#r%bi#s%bi#t%bi#u%bi#w%bi#y%bi#z%bi'x%bi(_%bi(p%bi!i%bi!W%bi'u%bit%bi!]%bi%h%bi!e%bi~P%4kO!Z'Wa!i'Wa~P!:TO!Z.oO!i(ii~O#}#ai!Z#ai![#ai~P#BPOP$[OR#zO!O#yO!Q#{O!j#xO!n$[O(_VO[#kip#ki#P#ki#m#ki#n#ki#o#ki#p#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki#}#ki(p#ki(w#ki(x#ki!Z#ki![#ki~O#l#ki~P%MQO#l<PO~P%MQOP$[OR#zOp<]O!O#yO!Q#{O!j#xO!n$[O#l<PO#m<QO#n<QO#o<QO(_VO[#ki#P#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki#}#ki(p#ki(w#ki(x#ki!Z#ki![#ki~O#p#ki~P& YO#p<RO~P& YOP$[OR#zO[<_Op<]O!O#yO!Q#{O!j#xO!n$[O#P<SO#l<PO#m<QO#n<QO#o<QO#p<RO#q<SO#r<SO#s<^O#t<SO(_VO#w#ki#y#ki#z#ki#}#ki(p#ki(w#ki(x#ki!Z#ki![#ki~O#u#ki~P&#bOP$[OR#zO[<_Op<]O!O#yO!Q#{O!j#xO!n$[O#P<SO#l<PO#m<QO#n<QO#o<QO#p<RO#q<SO#r<SO#s<^O#t<SO#u<TO(_VO(x#}O#y#ki#z#ki#}#ki(p#ki(w#ki!Z#ki![#ki~O#w<VO~P&%cO#w#ki~P&%cO#u<TO~P&#bOP$[OR#zO[<_Op<]O!O#yO!Q#{O!j#xO!n$[O#P<SO#l<PO#m<QO#n<QO#o<QO#p<RO#q<SO#r<SO#s<^O#t<SO#u<TO#w<VO(_VO(w#|O(x#}O#z#ki#}#ki(p#ki!Z#ki![#ki~O#y#ki~P&'rO#y<XO~P&'rOa#{y!Z#{y'x#{y'u#{y!W#{y!i#{yt#{y!]#{y%h#{y!e#{y~P!:TO[#kip#ki#P#ki#p#ki#q#ki#r#ki#s#ki#t#ki#u#ki#w#ki#y#ki#z#ki#}#ki(p#ki!Z#ki![#ki~OP$[OR#zO!O#yO!Q#{O!j#xO!n$[O#l<PO#m<QO#n<QO#o<QO(_VO(w#ki(x#ki~P&*nOl=}O!O)|O'w)}O(w$}O(x%POP#kiR#ki!Q#ki!j#ki!n#ki#l#ki#m#ki#n#ki#o#ki(_#ki~P&*nO#Q$dOP(^XR(^X[(^Xl(^Xp(^X!O(^X!Q(^X!j(^X!n(^X#P(^X#l(^X#m(^X#n(^X#o(^X#p(^X#q(^X#r(^X#s(^X#t(^X#u(^X#w(^X#y(^X#z(^X#}(^X'w(^X(_(^X(p(^X(w(^X(x(^X!Z(^X![(^X~O#}$Oi!Z$Oi![$Oi~P#BPO#}!pi![!pi~P$*OOg'Za!Z'Za~P!0uO![7dO~O!Z'ba!['ba~P#BPO!W7eO~P#.{O!e#vO(p'nO!Z'ca!i'ca~O!Z/kO!i(|i~O!Z/kO!e#vO!i(|i~Og${q!Z${q#^${q#}${q~P!0uO!W'ea!Z'ea~P#.{O!e7lO~O!Z/sO!W(}i~P#.{O!Z/sO!W(}i~O!W7oO~Oh%VOp7tO!j%dO(p'nO~O!e#vO#t7vO~Op7yO!e#vO(p'nO~O!O)|O'w)}O(x%POl'ha(w'ha!Z'ha#^'ha~Og'ha#}'ha~P&3oO!O)|O'w)}Ol'ja(w'ja(x'ja!Z'ja#^'ja~Og'ja#}'ja~P&4bO!W7{O~Og$}q!Z$}q#^$}q#}$}q~P!0uOg(]q!Z(]q~P!0uO#^7|Og(]q!Z(]q~P!0uOa$ny!Z$ny'x$ny'u$ny!W$ny!i$nyt$ny!]$ny%h$ny!e$ny~P!:TO!e6hO~O!Z5RO!])Oa~O!]'^OP$SaR$Sa[$Sap$Sa!O$Sa!Q$Sa!Z$Sa!j$Sa!n$Sa#P$Sa#l$Sa#m$Sa#n$Sa#o$Sa#p$Sa#q$Sa#r$Sa#s$Sa#t$Sa#u$Sa#w$Sa#y$Sa#z$Sa(_$Sa(p$Sa(w$Sa(x$Sa~O%h6|O~P&7SO%]8QOa%Zi!]%Zi'x%Zi!Z%Zi~Oa#ay!Z#ay'x#ay'u#ay!W#ay!i#ayt#ay!]#ay%h#ay!e#ay~P!:TO[8SO~Ob8UO(R+nO(TTO(WUO~O!Z0}O![)Vi~O`8YO~O(c(zO!Z'nX!['nX~O!Z5kO![)Sa~O![8cO~P%:RO(m!sO~P$$oO#Y8dO~O!]1gO~O!]1gO%h8fO~Ol8iO!]1gO%h8fO~O[8nO!Z'qa!['qa~O!Z1rO![)Ti~O!i8rO~O!i8sO~O!i8vO~O!i8vO~P%[Oa8xO~O!e8yO~O!i8zO~O!Z(ui![(ui~P#BPOa%mO#^9SO'x%mO~O!Z(ry!i(rya(ry'x(ry~P!:TO!Z(hO!i(qy~O%h9VO~P&7SO!]'^O%h9VO~O#i${qP${qR${q[${qa${qp${q!Q${q!Z${q!j${q!n${q#P${q#l${q#m${q#n${q#o${q#p${q#q${q#r${q#s${q#t${q#u${q#w${q#y${q#z${q'x${q(_${q(p${q!i${q!W${q'u${q#^${qt${q!]${q%h${q!e${q~P#.{O#i'haP'haR'ha['haa'hap'ha!Q'ha!j'ha!n'ha#P'ha#l'ha#m'ha#n'ha#o'ha#p'ha#q'ha#r'ha#s'ha#t'ha#u'ha#w'ha#y'ha#z'ha'x'ha(_'ha(p'ha!i'ha!W'ha'u'hat'ha!]'ha%h'ha!e'ha~P&3oO#i'jaP'jaR'ja['jaa'jap'ja!Q'ja!j'ja!n'ja#P'ja#l'ja#m'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#w'ja#y'ja#z'ja'x'ja(_'ja(p'ja!i'ja!W'ja'u'jat'ja!]'ja%h'ja!e'ja~P&4bO#i$}qP$}qR$}q[$}qa$}qp$}q!Q$}q!Z$}q!j$}q!n$}q#P$}q#l$}q#m$}q#n$}q#o$}q#p$}q#q$}q#r$}q#s$}q#t$}q#u$}q#w$}q#y$}q#z$}q'x$}q(_$}q(p$}q!i$}q!W$}q'u$}q#^$}qt$}q!]$}q%h$}q!e$}q~P#.{O!Z'Wi!i'Wi~P!:TO#}#aq!Z#aq![#aq~P#BPO(w$}OP%`aR%`a[%`ap%`a!Q%`a!j%`a!n%`a#P%`a#l%`a#m%`a#n%`a#o%`a#p%`a#q%`a#r%`a#s%`a#t%`a#u%`a#w%`a#y%`a#z%`a#}%`a(_%`a(p%`a!Z%`a![%`a~Ol%`a!O%`a'w%`a(x%`a~P&HgO(x%POP%baR%ba[%bap%ba!Q%ba!j%ba!n%ba#P%ba#l%ba#m%ba#n%ba#o%ba#p%ba#q%ba#r%ba#s%ba#t%ba#u%ba#w%ba#y%ba#z%ba#}%ba(_%ba(p%ba!Z%ba![%ba~Ol%ba!O%ba'w%ba(w%ba~P&JnOl=}O!O)|O'w)}O(x%PO~P&HgOl=}O!O)|O'w)}O(w$}O~P&JnOR0cO!O0cO!Q0dO#Q$dOP{a[{al{ap{a!j{a!n{a#P{a#l{a#m{a#n{a#o{a#p{a#q{a#r{a#s{a#t{a#u{a#w{a#y{a#z{a#}{a'w{a(_{a(p{a(w{a(x{a!Z{a![{a~O!O)|O'w)}OP$raR$ra[$ral$rap$ra!Q$ra!j$ra!n$ra#P$ra#l$ra#m$ra#n$ra#o$ra#p$ra#q$ra#r$ra#s$ra#t$ra#u$ra#w$ra#y$ra#z$ra#}$ra(_$ra(p$ra(w$ra(x$ra!Z$ra![$ra~O!O)|O'w)}OP$taR$ta[$tal$tap$ta!Q$ta!j$ta!n$ta#P$ta#l$ta#m$ta#n$ta#o$ta#p$ta#q$ta#r$ta#s$ta#t$ta#u$ta#w$ta#y$ta#z$ta#}$ta(_$ta(p$ta(w$ta(x$ta!Z$ta![$ta~Ol=}O!O)|O'w)}O(w$}O(x%PO~OP%SaR%Sa[%Sap%Sa!Q%Sa!j%Sa!n%Sa#P%Sa#l%Sa#m%Sa#n%Sa#o%Sa#p%Sa#q%Sa#r%Sa#s%Sa#t%Sa#u%Sa#w%Sa#y%Sa#z%Sa#}%Sa(_%Sa(p%Sa!Z%Sa![%Sa~P'%sO#}$lq!Z$lq![$lq~P#BPO#}$nq!Z$nq![$nq~P#BPO![9dO~O#}9eO~P!0uO!e#vO!Z'ci!i'ci~O!e#vO(p'nO!Z'ci!i'ci~O!Z/kO!i(|q~O!W'ei!Z'ei~P#.{O!Z/sO!W(}q~Op9lO!e#vO(p'nO~O[9nO!W9mO~P#.{O!W9mO~O!e#vO#t9tO~Og(]y!Z(]y~P!0uO!Z'la!]'la~P#.{Oa%Zq!]%Zq'x%Zq!Z%Zq~P#.{O[9yO~O!Z0}O![)Vq~O#^9}O!Z'na!['na~O!Z5kO![)Si~P#BPO!Q:PO~O!]1gO%h:SO~O(TTO(WUO(c:XO~O!Z1rO![)Tq~O!i:[O~O!i:]O~O!i:^O~O!i:^O~P%[O#^:aO!Z#fy![#fy~O!Z#fy![#fy~P#BPO%h:fO~P&7SO!]'^O%h:fO~O#}#{y!Z#{y![#{y~P#BPOP${iR${i[${ip${i!Q${i!j${i!n${i#P${i#l${i#m${i#n${i#o${i#p${i#q${i#r${i#s${i#t${i#u${i#w${i#y${i#z${i#}${i(_${i(p${i!Z${i![${i~P'%sO!O)|O'w)}O(x%POP'gaR'ga['gal'gap'ga!Q'ga!j'ga!n'ga#P'ga#l'ga#m'ga#n'ga#o'ga#p'ga#q'ga#r'ga#s'ga#t'ga#u'ga#w'ga#y'ga#z'ga#}'ga(_'ga(p'ga(w'ga!Z'ga!['ga~O!O)|O'w)}OP'iaR'ia['ial'iap'ia!Q'ia!j'ia!n'ia#P'ia#l'ia#m'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#w'ia#y'ia#z'ia#}'ia(_'ia(p'ia(w'ia(x'ia!Z'ia!['ia~O(w$}OP%`iR%`i[%`il%`ip%`i!O%`i!Q%`i!j%`i!n%`i#P%`i#l%`i#m%`i#n%`i#o%`i#p%`i#q%`i#r%`i#s%`i#t%`i#u%`i#w%`i#y%`i#z%`i#}%`i'w%`i(_%`i(p%`i(x%`i!Z%`i![%`i~O(x%POP%biR%bi[%bil%bip%bi!O%bi!Q%bi!j%bi!n%bi#P%bi#l%bi#m%bi#n%bi#o%bi#p%bi#q%bi#r%bi#s%bi#t%bi#u%bi#w%bi#y%bi#z%bi#}%bi'w%bi(_%bi(p%bi(w%bi!Z%bi![%bi~O#}$ny!Z$ny![$ny~P#BPO#}#ay!Z#ay![#ay~P#BPO!e#vO!Z'cq!i'cq~O!Z/kO!i(|y~O!W'eq!Z'eq~P#.{Op:pO!e#vO(p'nO~O[:tO!W:sO~P#.{O!W:sO~Og(]!R!Z(]!R~P!0uOa%Zy!]%Zy'x%Zy!Z%Zy~P#.{O!Z0}O![)Vy~O!Z5kO![)Sq~O(R:zO~O!]1gO%h:}O~O!i;QO~O%h;VO~P&7SOP${qR${q[${qp${q!Q${q!j${q!n${q#P${q#l${q#m${q#n${q#o${q#p${q#q${q#r${q#s${q#t${q#u${q#w${q#y${q#z${q#}${q(_${q(p${q!Z${q![${q~P'%sO!O)|O'w)}O(x%POP'haR'ha['hal'hap'ha!Q'ha!j'ha!n'ha#P'ha#l'ha#m'ha#n'ha#o'ha#p'ha#q'ha#r'ha#s'ha#t'ha#u'ha#w'ha#y'ha#z'ha#}'ha(_'ha(p'ha(w'ha!Z'ha!['ha~O!O)|O'w)}OP'jaR'ja['jal'jap'ja!Q'ja!j'ja!n'ja#P'ja#l'ja#m'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#w'ja#y'ja#z'ja#}'ja(_'ja(p'ja(w'ja(x'ja!Z'ja!['ja~OP$}qR$}q[$}qp$}q!Q$}q!j$}q!n$}q#P$}q#l$}q#m$}q#n$}q#o$}q#p$}q#q$}q#r$}q#s$}q#t$}q#u$}q#w$}q#y$}q#z$}q#}$}q(_$}q(p$}q!Z$}q![$}q~P'%sOg%d!Z!Z%d!Z#^%d!Z#}%d!Z~P!0uO!W;ZO~P#.{Op;[O!e#vO(p'nO~O[;^O!W;ZO~P#.{O!Z'nq!['nq~P#BPO!Z#f!Z![#f!Z~P#BPO#i%d!ZP%d!ZR%d!Z[%d!Za%d!Zp%d!Z!Q%d!Z!Z%d!Z!j%d!Z!n%d!Z#P%d!Z#l%d!Z#m%d!Z#n%d!Z#o%d!Z#p%d!Z#q%d!Z#r%d!Z#s%d!Z#t%d!Z#u%d!Z#w%d!Z#y%d!Z#z%d!Z'x%d!Z(_%d!Z(p%d!Z!i%d!Z!W%d!Z'u%d!Z#^%d!Zt%d!Z!]%d!Z%h%d!Z!e%d!Z~P#.{Op;fO!e#vO(p'nO~O!W;gO~P#.{Op;nO!e#vO(p'nO~O!W;oO~P#.{OP%d!ZR%d!Z[%d!Zp%d!Z!Q%d!Z!j%d!Z!n%d!Z#P%d!Z#l%d!Z#m%d!Z#n%d!Z#o%d!Z#p%d!Z#q%d!Z#r%d!Z#s%d!Z#t%d!Z#u%d!Z#w%d!Z#y%d!Z#z%d!Z#}%d!Z(_%d!Z(p%d!Z!Z%d!Z![%d!Z~P'%sOp;rO!e#vO(p'nO~Ot(dX~P1qO!O%qO~P!(yO(S!lO~P!(yO!WfX!ZfX#^fX~P%0XOP]XR]X[]Xp]X!O]X!Q]X!Z]X!ZfX!j]X!n]X#P]X#Q]X#^]X#^fX#ifX#l]X#m]X#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#w]X#y]X#z]X$P]X(_]X(p]X(w]X(x]X~O!efX!i]X!ifX(pfX~P'JlOP;vOQ;vOSfOd=rOe!iOnkOp;vOqkOrkOxkOz;vO|;vO!QWO!UkO!VkO!]XO!g;yO!jZO!m;vO!n;vO!o;vO!q;zO!s;}O!v!hO$V!kO$m=pO(R)ZO(TTO(WUO(_VO(m[O~O!Z<ZO![$pa~Oh%VOn%WOp%XOq$tOr$tOx%YOz%ZO|<fO!Q${O!]$|O!g=wO!j$xO#h<lO$V%_O$s<hO$u<jO$x%`O(R(tO(TTO(WUO(_$uO(w$}O(x%PO~Oj)bO~P( bOp!cX(p!cX~P# qOp(hX(p(hX~P#!dO![]X![fX~P'JlO!WfX!W$yX!ZfX!Z$yX#^fX~P!/qO#i<OO~O!e#vO#i<OO~O#^<`O~O#t<SO~O#^<pO!Z(uX![(uX~O#^<`O!Z(sX![(sX~O#i<qO~Og<sO~P!0uO#i<yO~O#i<zO~O!e#vO#i<{O~O!e#vO#i<qO~O#}<|O~P#BPO#i<}O~O#i=OO~O#i=TO~O#i=UO~O#i=VO~O#i=WO~O#}=XO~P!0uO#}=YO~P!0uO#Q#R#S#U#V#Y#g#h#s$m$s$u$x%[%]%g%h%i%p%r%u%v%x%z~'|T#m!V'z(S#nq#l#op!O'{$['{(R$^(c~",goto:"$8f)ZPPPPPP)[PP)_P)pP+Q/VPPPP6aPP6wPP<oP@cP@yP@yPPP@yPCRP@yP@yP@yPCVPC[PCyPHsPPPHwPPPPHwKzPPPLQLrPHwPHwPP! QHwPPPHwPHwP!#XHwP!&o!'t!'}P!(q!(u!(q!,SPPPPPPP!,s!'tPP!-T!.uP!2RHwHw!2W!5d!:Q!:Q!>PPPP!>XHwPPPPPPPPPP!AhP!BuPPHw!DWPHwPHwHwHwHwHwPHw!EjP!HtP!KzP!LO!LY!L^!L^P!HqP!Lb!LbP# hP# lHwPHw# r#$wCV@yP@yP@y@yP#&U@y@y#(h@y#+`@y#-l@y@y#.[#0p#0p#0u#1O#0p#1ZPP#0pP@y#1s@y#5r@y@y6aPPP#9wPPP#:b#:bP#:bP#:x#:bPP#;OP#:uP#:u#;c#:u#;}#<T#<W)_#<Z)_P#<b#<b#<bP)_P)_P)_P)_PP)_P#<h#<kP#<k)_P#<oP#<rP)_P)_P)_P)_P)_P)_)_PP#<x#=O#=Z#=a#=g#=m#=s#>R#>X#>c#>i#>s#>y#?Z#?a#@R#@e#@k#@q#AP#Af#CZ#Ci#Cp#E[#Ej#G[#Gj#Gp#Gv#G|#HW#H^#Hd#Hn#IQ#IWPPPPPPPPPPP#I^PPPPPPP#JR#MY#Nr#Ny$ RPPP$&mP$&v$)o$0Y$0]$0`$1_$1b$1i$1qP$1w$1zP$2h$2l$3d$4r$4w$5_PP$5d$5j$5n$5q$5u$5y$6u$7^$7u$7y$7|$8P$8V$8Y$8^$8bR!|RoqOXst!Z#d%l&p&r&s&u,n,s2S2VY!vQ'^-`1g5qQ%svQ%{yQ&S|Q&h!VS'U!e-WQ'd!iS'j!r!yU*h$|*X*lQ+l%|Q+y&UQ,_&bQ-^']Q-h'eQ-p'kQ0U*nQ1q,`R<m;z%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y,k,n,s-d-l-z.Q.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3d4q5y6Z6[6_6r8i8x9SS#q];w!r)]$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sU*{%[<e<fQ+q&OQ,a&eQ,h&mQ0r+dQ0u+fQ1S+rQ1y,fQ3W.bQ5V0wQ5]0}Q6Q1rQ7O3[Q8U5^R9Y7Q'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=s!S!nQ!r!v!y!z$|'U']'^'j'k'l*h*l*n*o-W-^-`-p0U0X1g5q5s%[$ti#v$b$c$d$x${%O%Q%]%^%b)w*P*R*T*W*^*d*t*u+c+f+},Q.a.z/_/h/r/s/u0Y0[0g0h0i1^1a1i3Z4U4V4a4f4w5R5U5x6|7l7v7|8Q8f9V9e9n9t:S:f:t:};V;^<^<_<a<b<c<d<g<h<i<j<k<l<t<u<v<w<y<z<}=O=P=Q=R=S=T=U=X=Y=p=x=y=|=}Q&V|Q'S!eS'Y%h-ZQ+q&OQ,a&eQ0f+OQ1S+rQ1X+xQ1x,eQ1y,fQ5]0}Q5f1ZQ6Q1rQ6T1tQ6U1wQ8U5^Q8X5cQ8q6WQ9|8YQ:Y8nR<o*XrnOXst!V!Z#d%l&g&p&r&s&u,n,s2S2VR,c&i&z^OPXYstuvwz!Z!`!g!j!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=r=s[#]WZ#W#Z'V(R!b%im#h#i#l$x%d%g([(f(g(h*W*[*_+W+X+Z,j-Q.O.U.V.W.Y/h/k2[3S3T4X6h6yQ%vxQ%zyS&P|&UQ&]!TQ'a!hQ'c!iQ(o#sS+k%{%|Q+o&OQ,Y&`Q,^&bS-g'd'eQ.d(pQ0{+lQ1R+rQ1T+sQ1W+wQ1l,ZS1p,_,`Q2t-hQ5[0}Q5`1QQ5e1YQ6P1qQ8T5^Q8W5bQ9x8SR:w9y!U$zi$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=y!^%xy!i!u%z%{%|'T'c'd'e'i's*g+k+l-T-g-h-o/{0O0{2m2t2{4i4j4m7s9pQ+e%vQ,O&YQ,R&ZQ,]&bQ.c(oQ1k,YU1o,^,_,`Q3].dQ5z1lS6O1p1qQ8m6P#f=t#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}o=u<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=YW%Ti%V*v=pS&Y!Q&gQ&Z!RQ&[!SQ+S%cR+|&W%]%Si#v$b$c$d$x${%O%Q%]%^%b)w*P*R*T*W*^*d*t*u+c+f+},Q.a.z/_/h/r/s/u0Y0[0g0h0i1^1a1i3Z4U4V4a4f4w5R5U5x6|7l7v7|8Q8f9V9e9n9t:S:f:t:};V;^<^<_<a<b<c<d<g<h<i<j<k<l<t<u<v<w<y<z<}=O=P=Q=R=S=T=U=X=Y=p=x=y=|=}T)x$u)yV*{%[<e<fW'Y!e%h*X-ZS({#y#zQ+`%qQ+v&RS.](k(lQ1b,SQ4x0cR8^5k'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=s$i$^c#Y#e%p%r%t(Q(W(r(w)P)Q)R)S)T)U)V)W)X)Y)[)^)`)e)o+a+u-U-s-x-}.P.n.q.u.w.x.y/]0j2c2f2v2}3c3h3i3j3k3l3m3n3o3p3q3r3s3t3w3x4P5O5Y6k6q6v7V7W7a7b8`8|9Q9[9b9c:c:y;R;x=gT#TV#U'RkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sQ'W!eR2i-W!W!nQ!e!r!v!y!z$|'U']'^'j'k'l*X*h*l*n*o-W-^-`-p0U0X1g5q5sR1d,UnqOXst!Z#d%l&p&r&s&u,n,s2S2VQ&w!^Q't!xS(q#u<OQ+i%yQ,W&]Q,X&_Q-e'bQ-r'mS.m(v<qS0k+U<{Q0y+jQ1f,VQ2Z,uQ2],vQ2e-RQ2r-fQ2u-jS5P0l=VQ5W0zS5Z0|=WQ6j2gQ6n2sQ6s2zQ8R5XQ8}6lQ9O6oQ9R6tR:`8z$d$]c#Y#e%r%t(Q(W(r(w)P)Q)R)S)T)U)V)W)X)Y)[)^)`)e)o+a+u-U-s-x-}.P.n.q.u.x.y/]0j2c2f2v2}3c3h3i3j3k3l3m3n3o3p3q3r3s3t3w3x4P5O5Y6k6q6v7V7W7a7b8`8|9Q9[9b9c:c:y;R;x=gS(m#p'gQ(}#zS+_%p.wS.^(l(nR3U._'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sS#q];wQ&r!XQ&s!YQ&u![Q&v!]R2R,qQ'_!hQ+b%vQ-c'aS.`(o+eQ2p-bW3Y.c.d0q0sQ6m2qW6z3V3X3]5TU9U6{6}7PU:e9W9X9ZS;T:d:gQ;b;UR;j;cU!wQ'^-`T5o1g5q!Q_OXZ`st!V!Z#d#h%d%l&g&i&p&r&s&u(h,n,s.V2S2V]!pQ!r'^-`1g5qT#q];w%^{OPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9SS({#y#zS.](k(l!s=^$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sU$fd)],hS(n#p'gU*s%R(u3vU0e*z.i7]Q5T0rQ6{3WQ9X7OR:g9Ym!tQ!r!v!y!z'^'j'k'l-`-p1g5q5sQ'r!uS(d#g1|S-n'i'uQ/n*ZQ/{*gQ2|-qQ4]/oQ4i/}Q4j0OQ4o0WQ7h4WS7s4k4mS7w4p4rQ9g7iQ9k7oQ9p7tQ9u7yS:o9l9mS;Y:p:sS;e;Z;[S;m;f;gS;q;n;oR;t;rQ#wbQ'q!uS(c#g1|S(e#m+TQ+V%eQ+g%wQ+m%}U-m'i'r'uQ.R(dQ/m*ZQ/|*gQ0P*iQ0x+hQ1m,[S2y-n-qQ3R.ZS4[/n/oQ4e/yS4h/{0WQ4l0QQ5|1nQ6u2|Q7g4WQ7k4]U7r4i4o4rQ7u4nQ8k5}S9f7h7iQ9j7oQ9r7wQ9s7xQ:V8lQ:m9gS:n9k9mQ:v9uQ;P:WS;X:o:sS;d;Y;ZS;l;e;gS;p;m;oQ;s;qQ;u;tQ=a=[Q=l=eR=m=fV!wQ'^-`%^aOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9SS#wz!j!r=Z$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sR=a=r%^bOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9SQ%ej!^%wy!i!u%z%{%|'T'c'd'e'i's*g+k+l-T-g-h-o/{0O0{2m2t2{4i4j4m7s9pS%}z!jQ+h%xQ,[&bW1n,],^,_,`U5}1o1p1qS8l6O6PQ:W8m!r=[$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sQ=e=qR=f=r%QeOPXYstuvw!Z!`!g!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&p&r&s&u&y'R'`'p(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9SY#bWZ#W#Z(R!b%im#h#i#l$x%d%g([(f(g(h*W*[*_+W+X+Z,j-Q.O.U.V.W.Y/h/k2[3S3T4X6h6yQ,i&m!p=]$Z$n)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sR=`'VU'Z!e%h*XR2k-Z%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y,k,n,s-d-l-z.Q.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3d4q5y6Z6[6_6r8i8x9S!r)]$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sQ,h&mQ0r+dQ3W.bQ7O3[R9Y7Q!b$Tc#Y%p(Q(W(r(w)X)Y)^)e+u-s-x-}.P.n.q/]0j2v2}3c3s5O5Y6q6v7V9Q:c;x!P<U)[)o-U.w2c2f3h3q3r3w4P6k7W7a7b8`8|9[9b9c:y;R=g!f$Vc#Y%p(Q(W(r(w)U)V)X)Y)^)e+u-s-x-}.P.n.q/]0j2v2}3c3s5O5Y6q6v7V9Q:c;x!T<W)[)o-U.w2c2f3h3n3o3q3r3w4P6k7W7a7b8`8|9[9b9c:y;R=g!^$Zc#Y%p(Q(W(r(w)^)e+u-s-x-}.P.n.q/]0j2v2}3c3s5O5Y6q6v7V9Q:c;xQ4V/fz=s)[)o-U.w2c2f3h3w4P6k7W7a7b8`8|9[9b9c:y;R=gQ=x=zR=y={'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sS$oh$pR3|/P'XgOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/P/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sT$kf$qQ$ifS)h$l)lR)t$qT$jf$qT)j$l)l'XhOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%l%s&Q&i&l&m&p&r&s&u&y'R'V'`'p(R(T(Z(b(v(x(|)q){*f+U+Y+d,k,n,s-P-S-d-l-z.Q.b.o.v/P/Q/i0V0d0l0|1j1z1{1}2P2S2V2X2h2x3O3[3d3{4q5m5y6Z6[6_6i6r7Q8i8x9S9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=sT$oh$pQ$rhR)s$p%^jOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%l%s&Q&i&l&m&p&r&s&u&y'R'`'p(R(T(Z(b(v(x(|){*f+U+Y+d,k,n,s-d-l-z.Q.b.o.v/i0V0d0l0|1j1z1{1}2P2S2V2X2x3O3[3d4q5y6Z6[6_6r7Q8i8x9S!s=q$Z$n'V)q-P-S/Q2h3{5m6i9}:a;v;y;z;}<O<P<Q<R<S<T<U<V<W<X<Y<Z<]<`<m<p<q<s<{<|=V=W=s#glOPXZst!Z!`!o#S#d#o#{$n%l&i&l&m&p&r&s&u&y'R'`(|)q*f+Y+d,k,n,s-d.b/Q/i0V0d1j1z1{1}2P2S2V2X3[3{4q5y6Z6[6_7Q8i8x!U%Ri$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=y#f(u#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}Q+P%`Q/^)|o3v<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=Y!U$yi$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=yQ*`$zU*i$|*X*lQ+Q%aQ0Q*j#f=c#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}n=d<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=YQ=h=tQ=i=uQ=j=vR=k=w!U%Ri$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=y#f(u#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}o3v<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=YnoOXst!Z#d%l&p&r&s&u,n,s2S2VS*c${*WQ,|&|Q,}'OR4`/s%[%Si#v$b$c$d$x${%O%Q%]%^%b)w*P*R*T*W*^*d*t*u+c+f+},Q.a.z/_/h/r/s/u0Y0[0g0h0i1^1a1i3Z4U4V4a4f4w5R5U5x6|7l7v7|8Q8f9V9e9n9t:S:f:t:};V;^<^<_<a<b<c<d<g<h<i<j<k<l<t<u<v<w<y<z<}=O=P=Q=R=S=T=U=X=Y=p=x=y=|=}Q,P&ZQ1`,RQ5i1_R8]5jV*k$|*X*lU*k$|*X*lT5p1g5qS/y*f/iQ4n0VT7x4q:PQ+g%wQ0P*iQ0x+hQ1m,[Q5|1nQ8k5}Q:V8lR;P:W!U%Oi$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=yx*P$v)c*Q*r+R/q0^0_3y4^4{4|4}7f7z9v:l=b=n=oS0Y*q0Z#f<a#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}n<b<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=Y!d<t(s)a*Y*b.e.h.l/Y/f/v0p1]3`4S4_4c5h7R7U7m7p7}8P9i9q9w:q:u;W;];h=z={`<u3u7X7[7`9]:h:k;kS=P.g3aT=Q7Z9`!U%Qi$d%O%Q%]%^%b*P*R*^*t*u.z/r0Y0[0g0h0i4V4w7|9e=p=x=y|*R$v)c*S*q+R/b/q0^0_3y4^4s4{4|4}7f7z9v:l=b=n=oS0[*r0]#f<c#v$b$c$x${)w*T*W*d+c+f+},Q.a/_/h/s/u1^1a1i3Z4U4a4f5R5U5x6|7l7v8Q8f9V9n9t:S:f:t:};V;^<a<c<g<i<k<t<v<y<}=P=R=T=X=|=}n<d<^<_<b<d<h<j<l<u<w<z=O=Q=S=U=Y!h<v(s)a*Y*b.f.g.l/Y/f/v0p1]3^3`4S4_4c5h7R7S7U7m7p7}8P9i9q9w:q:u;W;];h=z={d<w3u7Y7Z7`9]9^:h:i:k;kS=R.h3bT=S7[9arnOXst!V!Z#d%l&g&p&r&s&u,n,s2S2VQ&d!UR,k&mrnOXst!V!Z#d%l&g&p&r&s&u,n,s2S2VR&d!UQ,T&[R1[+|snOXst!V!Z#d%l&g&p&r&s&u,n,s2S2VQ1h,YS5w1k1lU8e5u5v5zS:R8g8hS:{:Q:TQ;_:|R;i;`Q&k!VR,d&gR6T1tR:Y8nS&P|&UR1T+sQ&p!WR,n&qR,t&vT2T,s2VR,x&wQ,w&wR2^,xQ'w!{R-t'wSsOtQ#dXT%os#dQ#OTR'y#OQ#RUR'{#RQ)y$uR/Z)yQ#UVR(O#UQ#XWU(U#X(V-{Q(V#YR-{(WQ-X'WR2j-XQ.p(wS3e.p3fR3f.qQ-`'^R2n-`Y!rQ'^-`1g5qR'h!rQ.{)cR3z.{U#_W%g*WU(]#_(^-|Q(^#`R-|(XQ-['ZR2l-[t`OXst!V!Z#d%l&g&i&p&r&s&u,n,s2S2VS#hZ%dU#r`#h.VR.V(hQ(i#jQ.S(eW.[(i.S3P6wQ3P.TR6w3QQ)l$lR/R)lQ$phR)r$pQ$`cU)_$`-w<[Q-w;xR<[)oQ/l*ZW4Y/l4Z7j9hU4Z/m/n/oS7j4[4]R9h7k$e*O$v(s)a)c*Y*b*q*r*|*}+R.g.h.j.k.l/Y/b/d/f/q/v0^0_0p1]3^3_3`3u3y4S4^4_4c4s4u4{4|4}5h7R7S7T7U7Z7[7^7_7`7f7m7p7z7}8P9]9^9_9i9q9v9w:h:i:j:k:l:q:u;W;];h;k=b=n=o=z={Q/t*bU4b/t4d7nQ4d/vR7n4cS*l$|*XR0S*lx*Q$v)c*q*r+R/q0^0_3y4^4{4|4}7f7z9v:l=b=n=o!d.e(s)a*Y*b.g.h.l/Y/f/v0p1]3`4S4_4c5h7R7U7m7p7}8P9i9q9w:q:u;W;];h=z={U/c*Q.e7Xa7X3u7Z7[7`9]:h:k;kQ0Z*qQ3a.gU4t0Z3a9`R9`7Z|*S$v)c*q*r+R/b/q0^0_3y4^4s4{4|4}7f7z9v:l=b=n=o!h.f(s)a*Y*b.g.h.l/Y/f/v0p1]3^3`4S4_4c5h7R7S7U7m7p7}8P9i9q9w:q:u;W;];h=z={U/e*S.f7Ye7Y3u7Z7[7`9]9^:h:i:k;kQ0]*rQ3b.hU4v0]3b9aR9a7[Q*w%UR0a*wQ5S0pR8O5SQ+[%jR0o+[Q5l1bS8_5l:OR:O8`Q,V&]R1e,VQ5q1gR8b5qQ1s,aS6R1s8oR8o6TQ1O+oW5_1O5a8V9zQ5a1RQ8V5`R9z8WQ+t&PR1U+tQ2V,sR6c2VYrOXst#dQ&t!ZQ+^%lQ,m&pQ,o&rQ,p&sQ,r&uQ2Q,nS2T,s2VR6b2SQ%npQ&x!_Q&{!aQ&}!bQ'P!cQ'o!uQ+]%kQ+i%yQ+{&VQ,c&kQ,z&zW-k'i'q'r'uQ-r'mQ0R*kQ0y+jS1v,d,gQ2_,yQ2`,|Q2a,}Q2u-jW2w-m-n-q-sQ5W0zQ5d1XQ5g1]Q5{1mQ6V1xQ6a2RU6p2v2y2|Q6s2zQ8R5XQ8Z5fQ8[5hQ8a5pQ8j5|Q8p6US9P6q6uQ9R6tQ9{8XQ:U8kQ:Z8qQ:b9QQ:x9|Q;O:VQ;S:cR;a;PQ%yyQ'b!iQ'm!uU+j%z%{%|Q-R'TU-f'c'd'eS-j'i'sQ/z*gS0z+k+lQ2g-TS2s-g-hQ2z-oS4g/{0OQ5X0{Q6l2mQ6o2tQ6t2{U7q4i4j4mQ9o7sR:r9pS$wi=pR*x%VU%Ui%V=pR0`*vQ$viS(s#v+fS)a$b$cQ)c$dQ*Y$xS*b${*WQ*q%OQ*r%QQ*|%]Q*}%^Q+R%bQ.g<aQ.h<cQ.j<gQ.k<iQ.l<kQ/Y)wQ/b*PQ/d*RQ/f*TQ/q*^S/v*d/hQ0^*tQ0_*ul0p+c,Q.a1a1i3Z5x6|8f9V:S:f:};VQ1]+}Q3^<tQ3_<vQ3`<yS3u<^<_Q3y.zS4S/_4UQ4^/rQ4_/sQ4c/uQ4s0YQ4u0[Q4{0gQ4|0hQ4}0iQ5h1^Q7R<}Q7S=PQ7T=RQ7U=TQ7Z<bQ7[<dQ7^<hQ7_<jQ7`<lQ7f4VQ7m4aQ7p4fQ7z4wQ7}5RQ8P5UQ9]<zQ9^<uQ9_<wQ9i7lQ9q7vQ9v7|Q9w8QQ:h=OQ:i=QQ:j=SQ:k=UQ:l9eQ:q9nQ:u9tQ;W=XQ;]:tQ;h;^Q;k=YQ=b=pQ=n=xQ=o=yQ=z=|R={=}Q*z%[Q.i<eR7]<fnpOXst!Z#d%l&p&r&s&u,n,s2S2VQ!fPS#fZ#oQ&z!`W'f!o*f0V4qQ'}#SQ)O#{Q)p$nS,g&i&lQ,l&mQ,y&yS-O'R/iQ-b'`Q.s(|Q/V)qQ0m+YQ0s+dQ2O,kQ2q-dQ3X.bQ4O/QQ4y0dQ5v1jQ6X1zQ6Y1{Q6^1}Q6`2PQ6e2XQ7P3[Q7c3{Q8h5yQ8t6ZQ8u6[Q8w6_Q9Z7QQ:T8iR:_8x#[cOPXZst!Z!`!o#d#o#{%l&i&l&m&p&r&s&u&y'R'`(|*f+Y+d,k,n,s-d.b/i0V0d1j1z1{1}2P2S2V2X3[4q5y6Z6[6_7Q8i8xQ#YWQ#eYQ%puQ%rvS%tw!gS(Q#W(TQ(W#ZQ(r#uQ(w#xQ)P$OQ)Q$PQ)R$QQ)S$RQ)T$SQ)U$TQ)V$UQ)W$VQ)X$WQ)Y$XQ)[$ZQ)^$_Q)`$aQ)e$eW)o$n)q/Q3{Q+a%sQ+u&QS-U'V2hQ-s'pS-x(R-zQ-}(ZQ.P(bQ.n(vQ.q(xQ.u;vQ.w;yQ.x;zQ.y;}Q/]){Q0j+UQ2c-PQ2f-SQ2v-lQ2}.QQ3c.oQ3h<OQ3i<PQ3j<QQ3k<RQ3l<SQ3m<TQ3n<UQ3o<VQ3p<WQ3q<XQ3r<YQ3s.vQ3t<]Q3w<`Q3x<mQ4P<ZQ5O0lQ5Y0|Q6k<pQ6q2xQ6v3OQ7V3dQ7W<qQ7a<sQ7b<{Q8`5mQ8|6iQ9Q6rQ9[<|Q9b=VQ9c=WQ:c9SQ:y9}Q;R:aQ;x#SR=g=sR#[WR'X!el!tQ!r!v!y!z'^'j'k'l-`-p1g5q5sS'T!e-WU*g$|*X*lS-T'U']S0O*h*nQ0W*oQ2m-^Q4m0UR4r0XR(y#xQ!fQT-_'^-`]!qQ!r'^-`1g5qQ#p]R'g;wR)d$dY!uQ'^-`1g5qQ'i!rS's!v!yS'u!z5sS-o'j'kQ-q'lR2{-pT#kZ%dS#jZ%dS%jm,jU(e#h#i#lS.T(f(gQ.X(hQ0n+ZQ3Q.UU3R.V.W.YS6x3S3TR9T6yd#^W#W#Z%g(R([*W+W.O/hr#gZm#h#i#l%d(f(g(h+Z.U.V.W.Y3S3T6yS*Z$x*_Q/o*[Q1|,jQ2d-QQ4W/kQ6g2[Q7i4XQ8{6hT=_'V+XV#aW%g*WU#`W%g*WS(S#W([U(X#Z+W/hS-V'V+XT-y(R.OV'[!e%h*XQ$lfR)v$qT)k$l)lR3}/PT*]$x*_T*e${*WQ0q+cQ1_,QQ3V.aQ5j1aQ5u1iQ6}3ZQ8g5xQ9W6|Q:Q8fQ:d9VQ:|:SQ;U:fQ;`:}R;c;VnqOXst!Z#d%l&p&r&s&u,n,s2S2VQ&j!VR,c&gtmOXst!U!V!Z#d%l&g&p&r&s&u,n,s2S2VR,j&mT%km,jR1c,SR,b&eQ&T|R+z&UR+p&OT&n!W&qT&o!W&qT2U,s2V",nodeNames:"â  ArithOp ArithOp ?. JSXStartTag LineComment BlockComment Script Hashbang ExportDeclaration export Star as VariableName String Escape from ; default FunctionDeclaration async function VariableDefinition > < TypeParamList const TypeDefinition extends ThisType this LiteralType ArithOp Number BooleanLiteral TemplateType InterpolationEnd Interpolation InterpolationStart NullType null VoidType void TypeofType typeof MemberExpression . PropertyName [ TemplateString Escape Interpolation super RegExp ] ArrayExpression Spread , } { ObjectExpression Property async get set PropertyDefinition Block : NewTarget new NewExpression ) ( ArgList UnaryExpression delete LogicOp BitOp YieldExpression yield AwaitExpression await ParenthesizedExpression ClassExpression class ClassBody MethodDeclaration Decorator @ MemberExpression PrivatePropertyName CallExpression TypeArgList CompareOp < declare Privacy static abstract override PrivatePropertyDefinition PropertyDeclaration readonly accessor Optional TypeAnnotation Equals StaticBlock FunctionExpression ArrowFunction ParamList ParamList ArrayPattern ObjectPattern PatternProperty Privacy readonly Arrow MemberExpression BinaryExpression ArithOp ArithOp ArithOp ArithOp BitOp CompareOp instanceof satisfies in CompareOp BitOp BitOp BitOp LogicOp LogicOp ConditionalExpression LogicOp LogicOp AssignmentExpression UpdateOp PostfixExpression CallExpression InstantiationExpression TaggedTemplateExpression DynamicImport import ImportMeta JSXElement JSXSelfCloseEndTag JSXSelfClosingTag JSXIdentifier JSXBuiltin JSXIdentifier JSXNamespacedName JSXMemberExpression JSXSpreadAttribute JSXAttribute JSXAttributeValue JSXEscape JSXEndTag JSXOpenTag JSXFragmentTag JSXText JSXEscape JSXStartCloseTag JSXCloseTag PrefixCast < ArrowFunction TypeParamList SequenceExpression InstantiationExpression KeyofType keyof UniqueType unique ImportType InferredType infer TypeName ParenthesizedType FunctionSignature ParamList NewSignature IndexedType TupleType Label ArrayType ReadonlyType ObjectType MethodType PropertyType IndexSignature PropertyDefinition CallSignature TypePredicate asserts is NewSignature new UnionType LogicOp IntersectionType LogicOp ConditionalType ParameterizedType ClassDeclaration abstract implements type VariableDeclaration let var using TypeAliasDeclaration InterfaceDeclaration interface EnumDeclaration enum EnumBody NamespaceDeclaration namespace module AmbientDeclaration declare GlobalDeclaration global ClassDeclaration ClassBody AmbientFunctionDeclaration ExportGroup VariableName VariableName ImportDeclaration ImportGroup ForStatement for ForSpec ForInSpec ForOfSpec of WhileStatement while WithStatement with DoStatement do IfStatement if else SwitchStatement switch SwitchBody CaseLabel case DefaultLabel TryStatement try CatchClause catch FinallyClause finally ReturnStatement return ThrowStatement throw BreakStatement break ContinueStatement continue DebuggerStatement debugger LabeledStatement ExpressionStatement SingleExpression SingleClassItem",maxTerm:378,context:Sve,nodeProps:[["isolate",-8,5,6,14,35,37,49,51,53,""],["group",-26,9,17,19,66,206,210,214,215,217,220,223,233,235,241,243,245,247,250,256,262,264,266,268,270,272,273,"Statement",-34,13,14,30,33,34,40,49,52,53,55,60,68,70,74,78,80,82,83,108,109,118,119,135,138,140,141,142,143,144,146,147,166,168,170,"Expression",-23,29,31,35,39,41,43,172,174,176,177,179,180,181,183,184,185,187,188,189,200,202,204,205,"Type",-3,86,101,107,"ClassItem"],["openedBy",23,"<",36,"InterpolationStart",54,"[",58,"{",71,"(",159,"JSXStartCloseTag"],["closedBy",-2,24,167,">",38,"InterpolationEnd",48,"]",59,"}",72,")",164,"JSXEndTag"]],propSources:[Eve],skippedNodes:[0,5,6,276],repeatNodeCount:37,tokenData:"$Fq07[R!bOX%ZXY+gYZ-yZ[+g[]%Z]^.c^p%Zpq+gqr/mrs3cst:_tuEruvJSvwLkwx! Yxy!'iyz!(sz{!)}{|!,q|}!.O}!O!,q!O!P!/Y!P!Q!9j!Q!R#:O!R![#<_![!]#I_!]!^#Jk!^!_#Ku!_!`$![!`!a$$v!a!b$*T!b!c$,r!c!}Er!}#O$-|#O#P$/W#P#Q$4o#Q#R$5y#R#SEr#S#T$7W#T#o$8b#o#p$<r#p#q$=h#q#r$>x#r#s$@U#s$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$I|Er$I|$I}$Dk$I}$JO$Dk$JO$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr(n%d_$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z&j&hT$h&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c&j&zP;=`<%l&c'|'U]$h&j(X!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!b(SU(X!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!b(iP;=`<%l'}'|(oP;=`<%l&}'[(y]$h&j(UpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(rp)wU(UpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)rp*^P;=`<%l)r'[*dP;=`<%l(r#S*nX(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g#S+^P;=`<%l*g(n+dP;=`<%l%Z07[+rq$h&j(Up(X!b'z0/lOX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p$f%Z$f$g+g$g#BY%Z#BY#BZ+g#BZ$IS%Z$IS$I_+g$I_$JT%Z$JT$JU+g$JU$KV%Z$KV$KW+g$KW&FU%Z&FU&FV+g&FV;'S%Z;'S;=`+a<%l?HT%Z?HT?HU+g?HUO%Z07[.ST(V#S$h&j'{0/lO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c07[.n_$h&j(Up(X!b'{0/lOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)3p/x`$h&j!n),Q(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW1V`#u(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`2X!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW2d_#u(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At3l_(T':f$h&j(X!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k(^4r_$h&j(X!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k&z5vX$h&jOr5qrs6cs!^5q!^!_6y!_#o5q#o#p6y#p;'S5q;'S;=`7h<%lO5q&z6jT$c`$h&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c`6|TOr6yrs7]s;'S6y;'S;=`7b<%lO6y`7bO$c``7eP;=`<%l6y&z7kP;=`<%l5q(^7w]$c`$h&j(X!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!r8uZ(X!bOY8pYZ6yZr8prs9hsw8pwx6yx#O8p#O#P6y#P;'S8p;'S;=`:R<%lO8p!r9oU$c`(X!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!r:UP;=`<%l8p(^:[P;=`<%l4k%9[:hh$h&j(Up(X!bOY%ZYZ&cZq%Zqr<Srs&}st%ZtuCruw%Zwx(rx!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr(r<__WS$h&j(Up(X!bOY<SYZ&cZr<Srs=^sw<Swx@nx!^<S!^!_Bm!_#O<S#O#P>`#P#o<S#o#pBm#p;'S<S;'S;=`Cl<%lO<S(Q=g]WS$h&j(X!bOY=^YZ&cZw=^wx>`x!^=^!^!_?q!_#O=^#O#P>`#P#o=^#o#p?q#p;'S=^;'S;=`@h<%lO=^&n>gXWS$h&jOY>`YZ&cZ!^>`!^!_?S!_#o>`#o#p?S#p;'S>`;'S;=`?k<%lO>`S?XSWSOY?SZ;'S?S;'S;=`?e<%lO?SS?hP;=`<%l?S&n?nP;=`<%l>`!f?xWWS(X!bOY?qZw?qwx?Sx#O?q#O#P?S#P;'S?q;'S;=`@b<%lO?q!f@eP;=`<%l?q(Q@kP;=`<%l=^'`@w]WS$h&j(UpOY@nYZ&cZr@nrs>`s!^@n!^!_Ap!_#O@n#O#P>`#P#o@n#o#pAp#p;'S@n;'S;=`Bg<%lO@ntAwWWS(UpOYApZrAprs?Ss#OAp#O#P?S#P;'SAp;'S;=`Ba<%lOAptBdP;=`<%lAp'`BjP;=`<%l@n#WBvYWS(Up(X!bOYBmZrBmrs?qswBmwxApx#OBm#O#P?S#P;'SBm;'S;=`Cf<%lOBm#WCiP;=`<%lBm(rCoP;=`<%l<S%9[C}i$h&j(m%1l(Up(X!bOY%ZYZ&cZr%Zrs&}st%ZtuCruw%Zwx(rx!Q%Z!Q![Cr![!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr%9[EoP;=`<%lCr07[FRk$h&j(Up(X!b$[#t(R,2j(c$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr+dHRk$h&j(Up(X!b$[#tOY%ZYZ&cZr%Zrs&}st%ZtuGvuw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Gv![!^%Z!^!_*g!_!c%Z!c!}Gv!}#O%Z#O#P&c#P#R%Z#R#SGv#S#T%Z#T#oGv#o#p*g#p$g%Z$g;'SGv;'S;=`Iv<%lOGv+dIyP;=`<%lGv07[JPP;=`<%lEr(KWJ_`$h&j(Up(X!b#n(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWKl_$h&j$P(Ch(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,#xLva(x+JY$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sv%ZvwM{wx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWNW`$h&j#y(Ch(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At! c_(W';W$h&j(UpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b'l!!i_$h&j(UpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b&z!#mX$h&jOw!#hwx6cx!^!#h!^!_!$Y!_#o!#h#o#p!$Y#p;'S!#h;'S;=`!$r<%lO!#h`!$]TOw!$Ywx7]x;'S!$Y;'S;=`!$l<%lO!$Y`!$oP;=`<%l!$Y&z!$uP;=`<%l!#h'l!%R]$c`$h&j(UpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r!Q!&PZ(UpOY!%zYZ!$YZr!%zrs!$Ysw!%zwx!&rx#O!%z#O#P!$Y#P;'S!%z;'S;=`!']<%lO!%z!Q!&yU$c`(UpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)r!Q!'`P;=`<%l!%z'l!'fP;=`<%l!!b/5|!'t_!j/.^$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#&U!)O_!i!Lf$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z-!n!*[b$h&j(Up(X!b(S%&f#o(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rxz%Zz{!+d{!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW!+o`$h&j(Up(X!b#l(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;x!,|`$h&j(Up(X!bp+4YOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,$U!.Z_!Z+Jf$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!/ec$h&j(Up(X!b!O.2^OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!0p!P!Q%Z!Q![!3Y![!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!0ya$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!2O!P!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!2Z_!Y!L^$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!3eg$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!3Y![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S!3Y#S#X%Z#X#Y!4|#Y#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!5Vg$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx{%Z{|!6n|}%Z}!O!6n!O!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!6wc$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!8_c$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!9uf$h&j(Up(X!b#m(ChOY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcxz!;Zz{#-}{!P!;Z!P!Q#/d!Q!^!;Z!^!_#(i!_!`#7S!`!a#8i!a!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z?O!;fb$h&j(Up(X!b!V7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z>^!<w`$h&j(X!b!V7`OY!<nYZ&cZw!<nwx!=yx!P!<n!P!Q!Eq!Q!^!<n!^!_!Gr!_!}!<n!}#O!KS#O#P!Dy#P#o!<n#o#p!Gr#p;'S!<n;'S;=`!L]<%lO!<n<z!>Q^$h&j!V7`OY!=yYZ&cZ!P!=y!P!Q!>|!Q!^!=y!^!_!@c!_!}!=y!}#O!CW#O#P!Dy#P#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!?Td$h&j!V7`O!^&c!_#W&c#W#X!>|#X#Z&c#Z#[!>|#[#]&c#]#^!>|#^#a&c#a#b!>|#b#g&c#g#h!>|#h#i&c#i#j!>|#j#k!>|#k#m&c#m#n!>|#n#o&c#p;'S&c;'S;=`&w<%lO&c7`!@hX!V7`OY!@cZ!P!@c!P!Q!AT!Q!}!@c!}#O!Ar#O#P!Bq#P;'S!@c;'S;=`!CQ<%lO!@c7`!AYW!V7`#W#X!AT#Z#[!AT#]#^!AT#a#b!AT#g#h!AT#i#j!AT#j#k!AT#m#n!AT7`!AuVOY!ArZ#O!Ar#O#P!B[#P#Q!@c#Q;'S!Ar;'S;=`!Bk<%lO!Ar7`!B_SOY!ArZ;'S!Ar;'S;=`!Bk<%lO!Ar7`!BnP;=`<%l!Ar7`!BtSOY!@cZ;'S!@c;'S;=`!CQ<%lO!@c7`!CTP;=`<%l!@c<z!C][$h&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#O!CW#O#P!DR#P#Q!=y#Q#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DWX$h&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DvP;=`<%l!CW<z!EOX$h&jOY!=yYZ&cZ!^!=y!^!_!@c!_#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!EnP;=`<%l!=y>^!Ezl$h&j(X!b!V7`OY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#W&}#W#X!Eq#X#Z&}#Z#[!Eq#[#]&}#]#^!Eq#^#a&}#a#b!Eq#b#g&}#g#h!Eq#h#i&}#i#j!Eq#j#k!Eq#k#m&}#m#n!Eq#n#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}8r!GyZ(X!b!V7`OY!GrZw!Grwx!@cx!P!Gr!P!Q!Hl!Q!}!Gr!}#O!JU#O#P!Bq#P;'S!Gr;'S;=`!J|<%lO!Gr8r!Hse(X!b!V7`OY'}Zw'}x#O'}#P#W'}#W#X!Hl#X#Z'}#Z#[!Hl#[#]'}#]#^!Hl#^#a'}#a#b!Hl#b#g'}#g#h!Hl#h#i'}#i#j!Hl#j#k!Hl#k#m'}#m#n!Hl#n;'S'};'S;=`(f<%lO'}8r!JZX(X!bOY!JUZw!JUwx!Arx#O!JU#O#P!B[#P#Q!Gr#Q;'S!JU;'S;=`!Jv<%lO!JU8r!JyP;=`<%l!JU8r!KPP;=`<%l!Gr>^!KZ^$h&j(X!bOY!KSYZ&cZw!KSwx!CWx!^!KS!^!_!JU!_#O!KS#O#P!DR#P#Q!<n#Q#o!KS#o#p!JU#p;'S!KS;'S;=`!LV<%lO!KS>^!LYP;=`<%l!KS>^!L`P;=`<%l!<n=l!Ll`$h&j(Up!V7`OY!LcYZ&cZr!Lcrs!=ys!P!Lc!P!Q!Mn!Q!^!Lc!^!_# o!_!}!Lc!}#O#%P#O#P!Dy#P#o!Lc#o#p# o#p;'S!Lc;'S;=`#&Y<%lO!Lc=l!Mwl$h&j(Up!V7`OY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#W(r#W#X!Mn#X#Z(r#Z#[!Mn#[#](r#]#^!Mn#^#a(r#a#b!Mn#b#g(r#g#h!Mn#h#i(r#i#j!Mn#j#k!Mn#k#m(r#m#n!Mn#n#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r8Q# vZ(Up!V7`OY# oZr# ors!@cs!P# o!P!Q#!i!Q!}# o!}#O#$R#O#P!Bq#P;'S# o;'S;=`#$y<%lO# o8Q#!pe(Up!V7`OY)rZr)rs#O)r#P#W)r#W#X#!i#X#Z)r#Z#[#!i#[#])r#]#^#!i#^#a)r#a#b#!i#b#g)r#g#h#!i#h#i)r#i#j#!i#j#k#!i#k#m)r#m#n#!i#n;'S)r;'S;=`*Z<%lO)r8Q#$WX(UpOY#$RZr#$Rrs!Ars#O#$R#O#P!B[#P#Q# o#Q;'S#$R;'S;=`#$s<%lO#$R8Q#$vP;=`<%l#$R8Q#$|P;=`<%l# o=l#%W^$h&j(UpOY#%PYZ&cZr#%Prs!CWs!^#%P!^!_#$R!_#O#%P#O#P!DR#P#Q!Lc#Q#o#%P#o#p#$R#p;'S#%P;'S;=`#&S<%lO#%P=l#&VP;=`<%l#%P=l#&]P;=`<%l!Lc?O#&kn$h&j(Up(X!b!V7`OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#W%Z#W#X#&`#X#Z%Z#Z#[#&`#[#]%Z#]#^#&`#^#a%Z#a#b#&`#b#g%Z#g#h#&`#h#i%Z#i#j#&`#j#k#&`#k#m%Z#m#n#&`#n#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z9d#(r](Up(X!b!V7`OY#(iZr#(irs!Grsw#(iwx# ox!P#(i!P!Q#)k!Q!}#(i!}#O#+`#O#P!Bq#P;'S#(i;'S;=`#,`<%lO#(i9d#)th(Up(X!b!V7`OY*gZr*grs'}sw*gwx)rx#O*g#P#W*g#W#X#)k#X#Z*g#Z#[#)k#[#]*g#]#^#)k#^#a*g#a#b#)k#b#g*g#g#h#)k#h#i*g#i#j#)k#j#k#)k#k#m*g#m#n#)k#n;'S*g;'S;=`+Z<%lO*g9d#+gZ(Up(X!bOY#+`Zr#+`rs!JUsw#+`wx#$Rx#O#+`#O#P!B[#P#Q#(i#Q;'S#+`;'S;=`#,Y<%lO#+`9d#,]P;=`<%l#+`9d#,cP;=`<%l#(i?O#,o`$h&j(Up(X!bOY#,fYZ&cZr#,frs!KSsw#,fwx#%Px!^#,f!^!_#+`!_#O#,f#O#P!DR#P#Q!;Z#Q#o#,f#o#p#+`#p;'S#,f;'S;=`#-q<%lO#,f?O#-tP;=`<%l#,f?O#-zP;=`<%l!;Z07[#.[b$h&j(Up(X!b'|0/l!V7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z07[#/o_$h&j(Up(X!bT0/lOY#/dYZ&cZr#/drs#0nsw#/dwx#4Ox!^#/d!^!_#5}!_#O#/d#O#P#1p#P#o#/d#o#p#5}#p;'S#/d;'S;=`#6|<%lO#/d06j#0w]$h&j(X!bT0/lOY#0nYZ&cZw#0nwx#1px!^#0n!^!_#3R!_#O#0n#O#P#1p#P#o#0n#o#p#3R#p;'S#0n;'S;=`#3x<%lO#0n05W#1wX$h&jT0/lOY#1pYZ&cZ!^#1p!^!_#2d!_#o#1p#o#p#2d#p;'S#1p;'S;=`#2{<%lO#1p0/l#2iST0/lOY#2dZ;'S#2d;'S;=`#2u<%lO#2d0/l#2xP;=`<%l#2d05W#3OP;=`<%l#1p01O#3YW(X!bT0/lOY#3RZw#3Rwx#2dx#O#3R#O#P#2d#P;'S#3R;'S;=`#3r<%lO#3R01O#3uP;=`<%l#3R06j#3{P;=`<%l#0n05x#4X]$h&j(UpT0/lOY#4OYZ&cZr#4Ors#1ps!^#4O!^!_#5Q!_#O#4O#O#P#1p#P#o#4O#o#p#5Q#p;'S#4O;'S;=`#5w<%lO#4O00^#5XW(UpT0/lOY#5QZr#5Qrs#2ds#O#5Q#O#P#2d#P;'S#5Q;'S;=`#5q<%lO#5Q00^#5tP;=`<%l#5Q05x#5zP;=`<%l#4O01p#6WY(Up(X!bT0/lOY#5}Zr#5}rs#3Rsw#5}wx#5Qx#O#5}#O#P#2d#P;'S#5};'S;=`#6v<%lO#5}01p#6yP;=`<%l#5}07[#7PP;=`<%l#/d)3h#7ab$h&j$P(Ch(Up(X!b!V7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;ZAt#8vb$Y#t$h&j(Up(X!b!V7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z'Ad#:Zp$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#U%Z#U#V#?i#V#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#d#Bq#d#l%Z#l#m#Es#m#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#<jk$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#>j_$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#?rd$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#A]f$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Bzc$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Dbe$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#E|g$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Gpi$h&j(Up(X!bq'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x#Il_!e$b$h&j#})Lv(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)[#Jv_al$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f#LS^h#)`#P-<U(Up(X!b$m7`OY*gZr*grs'}sw*gwx)rx!P*g!P!Q#MO!Q!^*g!^!_#Mt!_!`$ f!`#O*g#P;'S*g;'S;=`+Z<%lO*g(n#MXX$j&j(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El#M}Z#p(Ch(Up(X!bOY*gZr*grs'}sw*gwx)rx!_*g!_!`#Np!`#O*g#P;'S*g;'S;=`+Z<%lO*g(El#NyX$P(Ch(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El$ oX#q(Ch(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g*)x$!ga#^*!Y$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`!a$#l!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(K[$#w_#i(Cl$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x$%Vag!*r#q(Ch$e#|$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`$&[!`!a$'f!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$&g_#q(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$'qa#p(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`!a$(v!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$)R`#p(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(Kd$*`a(p(Ct$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!a%Z!a!b$+e!b#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$+p`$h&j#z(Ch(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#`$,}_!z$Ip$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f$.X_!Q0,v$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(n$/]Z$h&jO!^$0O!^!_$0f!_#i$0O#i#j$0k#j#l$0O#l#m$2^#m#o$0O#o#p$0f#p;'S$0O;'S;=`$4i<%lO$0O(n$0VT_#S$h&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c#S$0kO_#S(n$0p[$h&jO!Q&c!Q![$1f![!^&c!_!c&c!c!i$1f!i#T&c#T#Z$1f#Z#o&c#o#p$3|#p;'S&c;'S;=`&w<%lO&c(n$1kZ$h&jO!Q&c!Q![$2^![!^&c!_!c&c!c!i$2^!i#T&c#T#Z$2^#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$2cZ$h&jO!Q&c!Q![$3U![!^&c!_!c&c!c!i$3U!i#T&c#T#Z$3U#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$3ZZ$h&jO!Q&c!Q![$0O![!^&c!_!c&c!c!i$0O!i#T&c#T#Z$0O#Z#o&c#p;'S&c;'S;=`&w<%lO&c#S$4PR!Q![$4Y!c!i$4Y#T#Z$4Y#S$4]S!Q![$4Y!c!i$4Y#T#Z$4Y#q#r$0f(n$4lP;=`<%l$0O#1[$4z_!W#)l$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$6U`#w(Ch$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;p$7c_$h&j(Up(X!b(_+4QOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$8qk$h&j(Up(X!b(R,2j$^#t(c$I[OY%ZYZ&cZr%Zrs&}st%Ztu$8buw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$8b![!^%Z!^!_*g!_!c%Z!c!}$8b!}#O%Z#O#P&c#P#R%Z#R#S$8b#S#T%Z#T#o$8b#o#p*g#p$g%Z$g;'S$8b;'S;=`$<l<%lO$8b+d$:qk$h&j(Up(X!b$^#tOY%ZYZ&cZr%Zrs&}st%Ztu$:fuw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$:f![!^%Z!^!_*g!_!c%Z!c!}$:f!}#O%Z#O#P&c#P#R%Z#R#S$:f#S#T%Z#T#o$:f#o#p*g#p$g%Z$g;'S$:f;'S;=`$<f<%lO$:f+d$<iP;=`<%l$:f07[$<oP;=`<%l$8b#Jf$<{X!]#Hb(Up(X!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g,#x$=sa(w+JY$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p#q$+e#q;'S%Z;'S;=`+a<%lO%Z)>v$?V_![(CdtBr$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z?O$@a_!o7`$h&j(Up(X!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$Aq|$h&j(Up(X!b'z0/l$[#t(R,2j(c$I[OX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr07[$D|k$h&j(Up(X!b'{0/l$[#t(R,2j(c$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr",tokenizers:[Mve,Tve,Rve,Pve,2,3,4,5,6,7,8,9,10,11,12,13,14,Ove,new nz("$S~RRtu[#O#Pg#S#T#|~_P#o#pb~gOv~~jVO#i!P#i#j!U#j#l!P#l#m!q#m;'S!P;'S;=`#v<%lO!P~!UO!S~~!XS!Q![!e!c!i!e#T#Z!e#o#p#Z~!hR!Q![!q!c!i!q#T#Z!q~!tR!Q![!}!c!i!}#T#Z!}~#QR!Q![!P!c!i!P#T#Z!P~#^R!Q![#g!c!i#g#T#Z#g~#jS!Q![#g!c!i#g#T#Z#g#q#r!P~#yP;=`<%l!P~$RO(a~~",141,338),new nz("j~RQYZXz{^~^O(O~~aP!P!Qd~iO(P~~",25,321)],topRules:{Script:[0,7],SingleExpression:[1,274],SingleClassItem:[2,275]},dialects:{jsx:0,ts:15091},dynamicPrecedences:{78:1,80:1,92:1,168:1,198:1},specialized:[{term:325,get:t=>Ave[t]||-1},{term:341,get:t=>Ive[t]||-1},{term:93,get:t=>kve[t]||-1}],tokenPrec:15116}),DK=[ol("function ${name}(${params}) {\n	${}\n}",{label:"function",detail:"definition",type:"keyword"}),ol("for (let ${index} = 0; ${index} < ${bound}; ${index}++) {\n	${}\n}",{label:"for",detail:"loop",type:"keyword"}),ol("for (let ${name} of ${collection}) {\n	${}\n}",{label:"for",detail:"of loop",type:"keyword"}),ol("do {\n	${}\n} while (${})",{label:"do",detail:"loop",type:"keyword"}),ol("while (${}) {\n	${}\n}",{label:"while",detail:"loop",type:"keyword"}),ol(`try {
	\${}
} catch (\${error}) {
	\${}
}`,{label:"try",detail:"/ catch block",type:"keyword"}),ol("if (${}) {\n	${}\n}",{label:"if",detail:"block",type:"keyword"}),ol(`if (\${}) {
	\${}
} else {
	\${}
}`,{label:"if",detail:"/ else block",type:"keyword"}),ol(`class \${name} {
	constructor(\${params}) {
		\${}
	}
}`,{label:"class",detail:"definition",type:"keyword"}),ol('import {${names}} from "${module}"\n${}',{label:"import",detail:"named",type:"keyword"}),ol('import ${name} from "${module}"\n${}',{label:"import",detail:"default",type:"keyword"})],Lve=DK.concat([ol("interface ${name} {\n	${}\n}",{label:"interface",detail:"definition",type:"keyword"}),ol("type ${name} = ${type}",{label:"type",detail:"definition",type:"keyword"}),ol("enum ${name} {\n	${}\n}",{label:"enum",detail:"definition",type:"keyword"})]),PW=new jde,LK=new Set(["Script","Block","FunctionExpression","FunctionDeclaration","ArrowFunction","MethodDeclaration","ForStatement"]);function Vb(t){return(e,i)=>{let n=e.node.getChild("VariableDefinition");return n&&i(n,t),!0}}const Fve=["FunctionDeclaration"],Nve={FunctionDeclaration:Vb("function"),ClassDeclaration:Vb("class"),ClassExpression:()=>!0,EnumDeclaration:Vb("constant"),TypeAliasDeclaration:Vb("type"),NamespaceDeclaration:Vb("namespace"),VariableDefinition(t,e){t.matchContext(Fve)||e(t,"variable")},TypeDefinition(t,e){e(t,"type")},__proto__:null};function FK(t,e){let i=PW.get(e);if(i)return i;let n=[],r=!0;function s(o,a){let l=t.sliceString(o.from,o.to);n.push({label:l,type:a})}return e.cursor(uo.IncludeAnonymous).iterate(o=>{if(r)r=!1;else if(o.name){let a=Nve[o.name];if(a&&a(o,s)||LK.has(o.name))return!1}else if(o.to-o.from>8192){for(let a of FK(t,o.node))n.push(a);return!1}}),PW.set(e,n),n}const EW=/^[\w$\xa1-\uffff][\w$\d\xa1-\uffff]*$/,NK=["TemplateString","String","RegExp","LineComment","BlockComment","VariableDefinition","TypeDefinition","Label","PropertyDefinition","PropertyName","PrivatePropertyDefinition","PrivatePropertyName","JSXText","JSXAttributeValue","JSXOpenTag","JSXCloseTag","JSXSelfClosingTag",".","?."];function Bve(t){let e=mo(t.state).resolveInner(t.pos,-1);if(NK.indexOf(e.name)>-1)return null;let i=e.name=="VariableName"||e.to-e.from<20&&EW.test(t.state.sliceDoc(e.from,e.to));if(!i&&!t.explicit)return null;let n=[];for(let r=e;r;r=r.parent)LK.has(r.name)&&(n=n.concat(FK(t.state.doc,r)));return{options:n,from:i?e.from:t.pos,validFor:EW}}const cg=rT.define({name:"javascript",parser:Dve.configure({props:[fX.add({IfStatement:EF({except:/^\s*({|else\b)/}),TryStatement:EF({except:/^\s*({|catch\b|finally\b)/}),LabeledStatement:mfe,SwitchBody:t=>{let e=t.textAfter,i=/^\s*\}/.test(e),n=/^\s*(case|default)\b/.test(e);return t.baseIndent+(i?0:n?1:2)*t.unit},Block:pfe({closing:"}"}),ArrowFunction:t=>t.baseIndent+t.unit,"TemplateString BlockComment":()=>null,"Statement Property":EF({except:/^{/}),JSXElement(t){let e=/^\s*<\//.test(t.textAfter);return t.lineIndent(t.node.from)+(e?0:t.unit)},JSXEscape(t){let e=/\s*\}/.test(t.textAfter);return t.lineIndent(t.node.from)+(e?0:t.unit)},"JSXOpenTag JSXSelfClosingTag"(t){return t.column(t.node.from)+t.unit}}),gX.add({"Block ClassBody SwitchBody EnumBody ObjectExpression ArrayExpression ObjectType":xfe,BlockComment(t){return{from:t.from+2,to:t.to-2}}})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"`"]},commentTokens:{line:"//",block:{open:"/*",close:"*/"}},indentOnInput:/^\s*(?:case |default:|\{|\}|<\/)$/,wordChars:"$"}}),BK={test:t=>/^JSX/.test(t.name),facet:hX({commentTokens:{block:{open:"{/*",close:"*/}"}}})},zve=cg.configure({dialect:"ts"},"typescript"),Vve=cg.configure({dialect:"jsx",props:[CG.add(t=>t.isTop?[BK]:void 0)]}),Gve=cg.configure({dialect:"jsx ts",props:[CG.add(t=>t.isTop?[BK]:void 0)]},"typescript");let zK=t=>({label:t,type:"keyword"});const VK="break case const continue default delete export extends false finally in instanceof let new return static super switch this throw true typeof var yield".split(" ").map(zK),Uve=VK.concat(["declare","implements","private","protected","public"].map(zK));function Hve(t={}){let e=t.jsx?t.typescript?Gve:Vve:t.typescript?zve:cg,i=t.typescript?Lve.concat(Uve):DK.concat(VK);return new ofe(e,[cg.data.of({autocomplete:Fme(NK,vK(i))}),cg.data.of({autocomplete:Bve}),t.jsx?qve:[]])}function $ve(t){for(;;){if(t.name=="JSXOpenTag"||t.name=="JSXSelfClosingTag"||t.name=="JSXFragmentTag")return t;if(t.name=="JSXEscape"||!t.parent)return null;t=t.parent}}function AW(t,e,i=t.length){for(let n=e?.firstChild;n;n=n.nextSibling)if(n.name=="JSXIdentifier"||n.name=="JSXBuiltin"||n.name=="JSXNamespacedName"||n.name=="JSXMemberExpression")return t.sliceString(n.from,Math.min(n.to,i));return""}const Wve=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),qve=Li.inputHandler.of((t,e,i,n,r)=>{if((Wve?t.composing:t.compositionStarted)||t.state.readOnly||e!=i||n!=">"&&n!="/"||!cg.isActiveAt(t.state,e,-1))return!1;let s=r(),{state:o}=s,a=o.changeByRange(l=>{var u;let{head:d}=l,p=mo(o).resolveInner(d-1,-1),v;if(p.name=="JSXStartTag"&&(p=p.parent),!(o.doc.sliceString(d-1,d)!=n||p.name=="JSXAttributeValue"&&p.to>d)){if(n==">"&&p.name=="JSXFragmentTag")return{range:l,changes:{from:d,insert:"</>"}};if(n=="/"&&p.name=="JSXStartCloseTag"){let y=p.parent,w=y.parent;if(w&&y.from==d-2&&((v=AW(o.doc,w.firstChild,d))||((u=w.firstChild)===null||u===void 0?void 0:u.name)=="JSXFragmentTag")){let R=`${v}>`;return{range:Kt.cursor(d+R.length,-1),changes:{from:d,insert:R}}}}else if(n==">"){let y=$ve(p);if(y&&y.name=="JSXOpenTag"&&!/^\/?>|^<\//.test(o.doc.sliceString(d,d+2))&&(v=AW(o.doc,y,d)))return{range:l,changes:{from:d,insert:`</${v}>`}}}}return{range:l}});return a.changes.empty?!1:(t.dispatch([s,o.update(a,{userEvent:"input.complete",scrollIntoView:!0})]),!0)});var jve=(t,e)=>{t.target===B(e)&&B(e).close()},Qve=hi('<dialog class="modal svelte-hqtv9z"><div class="modal-box svelte-hqtv9z"><!> <!></div></dialog>');function Zve(t,e){Pi(e,!0);let i=ht(e,"showModal",15),n=Fn(void 0);On(()=>{i()&&B(n).showModal()});var r=Qve();r.__click=[jve,n];var s=Di(r),o=Di(s);hs(o,()=>e.header??to);var a=vi(o,2);hs(a,()=>e.children??to),_i(s),_i(r),es(r,l=>rt(n,l),()=>B(n)),Tn("close",r,()=>i(!1)),bt(t,r),Ei()}Zg(["click"]);var wl="top",qc="bottom",jc="right",_l="left",GG="auto",DC=[wl,qc,jc,_l],x0="start",B_="end",Xve="clippingParents",GK="viewport",Gb="popper",Kve="reference",IW=DC.reduce(function(t,e){return t.concat([e+"-"+x0,e+"-"+B_])},[]),UK=[].concat(DC,[GG]).reduce(function(t,e){return t.concat([e,e+"-"+x0,e+"-"+B_])},[]),Yve="beforeRead",Jve="read",eye="afterRead",tye="beforeMain",iye="main",nye="afterMain",rye="beforeWrite",sye="write",oye="afterWrite",aye=[Yve,Jve,eye,tye,iye,nye,rye,sye,oye];function Oh(t){return t?(t.nodeName||"").toLowerCase():null}function ic(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Ig(t){var e=ic(t).Element;return t instanceof e||t instanceof Element}function Bc(t){var e=ic(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function UG(t){if(typeof ShadowRoot>"u")return!1;var e=ic(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function lye(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var n=e.styles[i]||{},r=e.attributes[i]||{},s=e.elements[i];!Bc(s)||!Oh(s)||(Object.assign(s.style,n),Object.keys(r).forEach(function(o){var a=r[o];a===!1?s.removeAttribute(o):s.setAttribute(o,a===!0?"":a)}))})}function cye(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(n){var r=e.elements[n],s=e.attributes[n]||{},o=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:i[n]),a=o.reduce(function(l,u){return l[u]="",l},{});!Bc(r)||!Oh(r)||(Object.assign(r.style,a),Object.keys(s).forEach(function(l){r.removeAttribute(l)}))})}}const HK={name:"applyStyles",enabled:!0,phase:"write",fn:lye,effect:cye,requires:["computeStyles"]};function vh(t){return t.split("-")[0]}var ug=Math.max,xT=Math.min,b0=Math.round;function oz(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function $K(){return!/^((?!chrome|android).)*safari/i.test(oz())}function w0(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var n=t.getBoundingClientRect(),r=1,s=1;e&&Bc(t)&&(r=t.offsetWidth>0&&b0(n.width)/t.offsetWidth||1,s=t.offsetHeight>0&&b0(n.height)/t.offsetHeight||1);var o=Ig(t)?ic(t):window,a=o.visualViewport,l=!$K()&&i,u=(n.left+(l&&a?a.offsetLeft:0))/r,d=(n.top+(l&&a?a.offsetTop:0))/s,p=n.width/r,v=n.height/s;return{width:p,height:v,top:d,right:u+p,bottom:d+v,left:u,x:u,y:d}}function HG(t){var e=w0(t),i=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:n}}function WK(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&UG(i)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function $d(t){return ic(t).getComputedStyle(t)}function uye(t){return["table","td","th"].indexOf(Oh(t))>=0}function Lp(t){return((Ig(t)?t.ownerDocument:t.document)||window.document).documentElement}function mP(t){return Oh(t)==="html"?t:t.assignedSlot||t.parentNode||(UG(t)?t.host:null)||Lp(t)}function kW(t){return!Bc(t)||$d(t).position==="fixed"?null:t.offsetParent}function hye(t){var e=/firefox/i.test(oz()),i=/Trident/i.test(oz());if(i&&Bc(t)){var n=$d(t);if(n.position==="fixed")return null}var r=mP(t);for(UG(r)&&(r=r.host);Bc(r)&&["html","body"].indexOf(Oh(r))<0;){var s=$d(r);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||e&&s.willChange==="filter"||e&&s.filter&&s.filter!=="none")return r;r=r.parentNode}return null}function LC(t){for(var e=ic(t),i=kW(t);i&&uye(i)&&$d(i).position==="static";)i=kW(i);return i&&(Oh(i)==="html"||Oh(i)==="body"&&$d(i).position==="static")?e:i||hye(t)||e}function $G(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Hw(t,e,i){return ug(t,xT(e,i))}function dye(t,e,i){var n=Hw(t,e,i);return n>i?i:n}function qK(){return{top:0,right:0,bottom:0,left:0}}function jK(t){return Object.assign({},qK(),t)}function QK(t,e){return e.reduce(function(i,n){return i[n]=t,i},{})}var fye=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,jK(typeof e!="number"?e:QK(e,DC))};function pye(t){var e,i=t.state,n=t.name,r=t.options,s=i.elements.arrow,o=i.modifiersData.popperOffsets,a=vh(i.placement),l=$G(a),u=[_l,jc].indexOf(a)>=0,d=u?"height":"width";if(!(!s||!o)){var p=fye(r.padding,i),v=HG(s),y=l==="y"?wl:_l,w=l==="y"?qc:jc,R=i.rects.reference[d]+i.rects.reference[l]-o[l]-i.rects.popper[d],O=o[l]-i.rects.reference[l],P=LC(s),N=P?l==="y"?P.clientHeight||0:P.clientWidth||0:0,F=R/2-O/2,k=p[y],$=N-v[d]-p[w],W=N/2-v[d]/2+F,Q=Hw(k,W,$),Y=l;i.modifiersData[n]=(e={},e[Y]=Q,e.centerOffset=Q-W,e)}}function mye(t){var e=t.state,i=t.options,n=i.element,r=n===void 0?"[data-popper-arrow]":n;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||WK(e.elements.popper,r)&&(e.elements.arrow=r))}const gye={name:"arrow",enabled:!0,phase:"main",fn:pye,effect:mye,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function _0(t){return t.split("-")[1]}var vye={top:"auto",right:"auto",bottom:"auto",left:"auto"};function yye(t,e){var i=t.x,n=t.y,r=e.devicePixelRatio||1;return{x:b0(i*r)/r||0,y:b0(n*r)/r||0}}function DW(t){var e,i=t.popper,n=t.popperRect,r=t.placement,s=t.variation,o=t.offsets,a=t.position,l=t.gpuAcceleration,u=t.adaptive,d=t.roundOffsets,p=t.isFixed,v=o.x,y=v===void 0?0:v,w=o.y,R=w===void 0?0:w,O=typeof d=="function"?d({x:y,y:R}):{x:y,y:R};y=O.x,R=O.y;var P=o.hasOwnProperty("x"),N=o.hasOwnProperty("y"),F=_l,k=wl,$=window;if(u){var W=LC(i),Q="clientHeight",Y="clientWidth";if(W===ic(i)&&(W=Lp(i),$d(W).position!=="static"&&a==="absolute"&&(Q="scrollHeight",Y="scrollWidth")),W=W,r===wl||(r===_l||r===jc)&&s===B_){k=qc;var M=p&&W===$&&$.visualViewport?$.visualViewport.height:W[Q];R-=M-n.height,R*=l?1:-1}if(r===_l||(r===wl||r===qc)&&s===B_){F=jc;var D=p&&W===$&&$.visualViewport?$.visualViewport.width:W[Y];y-=D-n.width,y*=l?1:-1}}var G=Object.assign({position:a},u&&vye),j=d===!0?yye({x:y,y:R},ic(i)):{x:y,y:R};if(y=j.x,R=j.y,l){var Z;return Object.assign({},G,(Z={},Z[k]=N?"0":"",Z[F]=P?"0":"",Z.transform=($.devicePixelRatio||1)<=1?"translate("+y+"px, "+R+"px)":"translate3d("+y+"px, "+R+"px, 0)",Z))}return Object.assign({},G,(e={},e[k]=N?R+"px":"",e[F]=P?y+"px":"",e.transform="",e))}function xye(t){var e=t.state,i=t.options,n=i.gpuAcceleration,r=n===void 0?!0:n,s=i.adaptive,o=s===void 0?!0:s,a=i.roundOffsets,l=a===void 0?!0:a,u={placement:vh(e.placement),variation:_0(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,DW(Object.assign({},u,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,DW(Object.assign({},u,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const bye={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:xye,data:{}};var U1={passive:!0};function wye(t){var e=t.state,i=t.instance,n=t.options,r=n.scroll,s=r===void 0?!0:r,o=n.resize,a=o===void 0?!0:o,l=ic(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&u.forEach(function(d){d.addEventListener("scroll",i.update,U1)}),a&&l.addEventListener("resize",i.update,U1),function(){s&&u.forEach(function(d){d.removeEventListener("scroll",i.update,U1)}),a&&l.removeEventListener("resize",i.update,U1)}}const _ye={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:wye,data:{}};var Cye={left:"right",right:"left",bottom:"top",top:"bottom"};function SM(t){return t.replace(/left|right|bottom|top/g,function(e){return Cye[e]})}var Sye={start:"end",end:"start"};function LW(t){return t.replace(/start|end/g,function(e){return Sye[e]})}function WG(t){var e=ic(t),i=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:i,scrollTop:n}}function qG(t){return w0(Lp(t)).left+WG(t).scrollLeft}function Oye(t,e){var i=ic(t),n=Lp(t),r=i.visualViewport,s=n.clientWidth,o=n.clientHeight,a=0,l=0;if(r){s=r.width,o=r.height;var u=$K();(u||!u&&e==="fixed")&&(a=r.offsetLeft,l=r.offsetTop)}return{width:s,height:o,x:a+qG(t),y:l}}function Mye(t){var e,i=Lp(t),n=WG(t),r=(e=t.ownerDocument)==null?void 0:e.body,s=ug(i.scrollWidth,i.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),o=ug(i.scrollHeight,i.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),a=-n.scrollLeft+qG(t),l=-n.scrollTop;return $d(r||i).direction==="rtl"&&(a+=ug(i.clientWidth,r?r.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}function jG(t){var e=$d(t),i=e.overflow,n=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+r+n)}function ZK(t){return["html","body","#document"].indexOf(Oh(t))>=0?t.ownerDocument.body:Bc(t)&&jG(t)?t:ZK(mP(t))}function $w(t,e){var i;e===void 0&&(e=[]);var n=ZK(t),r=n===((i=t.ownerDocument)==null?void 0:i.body),s=ic(n),o=r?[s].concat(s.visualViewport||[],jG(n)?n:[]):n,a=e.concat(o);return r?a:a.concat($w(mP(o)))}function az(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Tye(t,e){var i=w0(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function FW(t,e,i){return e===GK?az(Oye(t,i)):Ig(e)?Tye(e,i):az(Mye(Lp(t)))}function Rye(t){var e=$w(mP(t)),i=["absolute","fixed"].indexOf($d(t).position)>=0,n=i&&Bc(t)?LC(t):t;return Ig(n)?e.filter(function(r){return Ig(r)&&WK(r,n)&&Oh(r)!=="body"}):[]}function Pye(t,e,i,n){var r=e==="clippingParents"?Rye(t):[].concat(e),s=[].concat(r,[i]),o=s[0],a=s.reduce(function(l,u){var d=FW(t,u,n);return l.top=ug(d.top,l.top),l.right=xT(d.right,l.right),l.bottom=xT(d.bottom,l.bottom),l.left=ug(d.left,l.left),l},FW(t,o,n));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function XK(t){var e=t.reference,i=t.element,n=t.placement,r=n?vh(n):null,s=n?_0(n):null,o=e.x+e.width/2-i.width/2,a=e.y+e.height/2-i.height/2,l;switch(r){case wl:l={x:o,y:e.y-i.height};break;case qc:l={x:o,y:e.y+e.height};break;case jc:l={x:e.x+e.width,y:a};break;case _l:l={x:e.x-i.width,y:a};break;default:l={x:e.x,y:e.y}}var u=r?$G(r):null;if(u!=null){var d=u==="y"?"height":"width";switch(s){case x0:l[u]=l[u]-(e[d]/2-i[d]/2);break;case B_:l[u]=l[u]+(e[d]/2-i[d]/2);break}}return l}function z_(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=n===void 0?t.placement:n,s=i.strategy,o=s===void 0?t.strategy:s,a=i.boundary,l=a===void 0?Xve:a,u=i.rootBoundary,d=u===void 0?GK:u,p=i.elementContext,v=p===void 0?Gb:p,y=i.altBoundary,w=y===void 0?!1:y,R=i.padding,O=R===void 0?0:R,P=jK(typeof O!="number"?O:QK(O,DC)),N=v===Gb?Kve:Gb,F=t.rects.popper,k=t.elements[w?N:v],$=Pye(Ig(k)?k:k.contextElement||Lp(t.elements.popper),l,d,o),W=w0(t.elements.reference),Q=XK({reference:W,element:F,placement:r}),Y=az(Object.assign({},F,Q)),M=v===Gb?Y:W,D={top:$.top-M.top+P.top,bottom:M.bottom-$.bottom+P.bottom,left:$.left-M.left+P.left,right:M.right-$.right+P.right},G=t.modifiersData.offset;if(v===Gb&&G){var j=G[r];Object.keys(D).forEach(function(Z){var ie=[jc,qc].indexOf(Z)>=0?1:-1,le=[wl,qc].indexOf(Z)>=0?"y":"x";D[Z]+=j[le]*ie})}return D}function Eye(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=i.boundary,s=i.rootBoundary,o=i.padding,a=i.flipVariations,l=i.allowedAutoPlacements,u=l===void 0?UK:l,d=_0(n),p=d?a?IW:IW.filter(function(w){return _0(w)===d}):DC,v=p.filter(function(w){return u.indexOf(w)>=0});v.length===0&&(v=p);var y=v.reduce(function(w,R){return w[R]=z_(t,{placement:R,boundary:r,rootBoundary:s,padding:o})[vh(R)],w},{});return Object.keys(y).sort(function(w,R){return y[w]-y[R]})}function Aye(t){if(vh(t)===GG)return[];var e=SM(t);return[LW(t),e,LW(e)]}function Iye(t){var e=t.state,i=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var r=i.mainAxis,s=r===void 0?!0:r,o=i.altAxis,a=o===void 0?!0:o,l=i.fallbackPlacements,u=i.padding,d=i.boundary,p=i.rootBoundary,v=i.altBoundary,y=i.flipVariations,w=y===void 0?!0:y,R=i.allowedAutoPlacements,O=e.options.placement,P=vh(O),N=P===O,F=l||(N||!w?[SM(O)]:Aye(O)),k=[O].concat(F).reduce(function(Ge,Je){return Ge.concat(vh(Je)===GG?Eye(e,{placement:Je,boundary:d,rootBoundary:p,padding:u,flipVariations:w,allowedAutoPlacements:R}):Je)},[]),$=e.rects.reference,W=e.rects.popper,Q=new Map,Y=!0,M=k[0],D=0;D<k.length;D++){var G=k[D],j=vh(G),Z=_0(G)===x0,ie=[wl,qc].indexOf(j)>=0,le=ie?"width":"height",me=z_(e,{placement:G,boundary:d,rootBoundary:p,altBoundary:v,padding:u}),be=ie?Z?jc:_l:Z?qc:wl;$[le]>W[le]&&(be=SM(be));var fe=SM(be),Fe=[];if(s&&Fe.push(me[j]<=0),a&&Fe.push(me[be]<=0,me[fe]<=0),Fe.every(function(Ge){return Ge})){M=G,Y=!1;break}Q.set(G,Fe)}if(Y)for(var He=w?3:1,je=function(Je){var mt=k.find(function(wt){var Ot=Q.get(wt);if(Ot)return Ot.slice(0,Je).every(function(Qt){return Qt})});if(mt)return M=mt,"break"},qe=He;qe>0;qe--){var ct=je(qe);if(ct==="break")break}e.placement!==M&&(e.modifiersData[n]._skip=!0,e.placement=M,e.reset=!0)}}const kye={name:"flip",enabled:!0,phase:"main",fn:Iye,requiresIfExists:["offset"],data:{_skip:!1}};function NW(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function BW(t){return[wl,jc,qc,_l].some(function(e){return t[e]>=0})}function Dye(t){var e=t.state,i=t.name,n=e.rects.reference,r=e.rects.popper,s=e.modifiersData.preventOverflow,o=z_(e,{elementContext:"reference"}),a=z_(e,{altBoundary:!0}),l=NW(o,n),u=NW(a,r,s),d=BW(l),p=BW(u);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:d,hasPopperEscaped:p},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":p})}const Lye={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Dye};function Fye(t,e,i){var n=vh(t),r=[_l,wl].indexOf(n)>=0?-1:1,s=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,o=s[0],a=s[1];return o=o||0,a=(a||0)*r,[_l,jc].indexOf(n)>=0?{x:a,y:o}:{x:o,y:a}}function Nye(t){var e=t.state,i=t.options,n=t.name,r=i.offset,s=r===void 0?[0,0]:r,o=UK.reduce(function(d,p){return d[p]=Fye(p,e.rects,s),d},{}),a=o[e.placement],l=a.x,u=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[n]=o}const Bye={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Nye};function zye(t){var e=t.state,i=t.name;e.modifiersData[i]=XK({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const Vye={name:"popperOffsets",enabled:!0,phase:"read",fn:zye,data:{}};function Gye(t){return t==="x"?"y":"x"}function Uye(t){var e=t.state,i=t.options,n=t.name,r=i.mainAxis,s=r===void 0?!0:r,o=i.altAxis,a=o===void 0?!1:o,l=i.boundary,u=i.rootBoundary,d=i.altBoundary,p=i.padding,v=i.tether,y=v===void 0?!0:v,w=i.tetherOffset,R=w===void 0?0:w,O=z_(e,{boundary:l,rootBoundary:u,padding:p,altBoundary:d}),P=vh(e.placement),N=_0(e.placement),F=!N,k=$G(P),$=Gye(k),W=e.modifiersData.popperOffsets,Q=e.rects.reference,Y=e.rects.popper,M=typeof R=="function"?R(Object.assign({},e.rects,{placement:e.placement})):R,D=typeof M=="number"?{mainAxis:M,altAxis:M}:Object.assign({mainAxis:0,altAxis:0},M),G=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,j={x:0,y:0};if(W){if(s){var Z,ie=k==="y"?wl:_l,le=k==="y"?qc:jc,me=k==="y"?"height":"width",be=W[k],fe=be+O[ie],Fe=be-O[le],He=y?-Y[me]/2:0,je=N===x0?Q[me]:Y[me],qe=N===x0?-Y[me]:-Q[me],ct=e.elements.arrow,Ge=y&&ct?HG(ct):{width:0,height:0},Je=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:qK(),mt=Je[ie],wt=Je[le],Ot=Hw(0,Q[me],Ge[me]),Qt=F?Q[me]/2-He-Ot-mt-D.mainAxis:je-Ot-mt-D.mainAxis,ei=F?-Q[me]/2+He+Ot+wt+D.mainAxis:qe+Ot+wt+D.mainAxis,Jt=e.elements.arrow&&LC(e.elements.arrow),Yt=Jt?k==="y"?Jt.clientTop||0:Jt.clientLeft||0:0,Ut=(Z=G?.[k])!=null?Z:0,Re=be+Qt-Ut-Yt,gi=be+ei-Ut,it=Hw(y?xT(fe,Re):fe,be,y?ug(Fe,gi):Fe);W[k]=it,j[k]=it-be}if(a){var Pe,Ye=k==="x"?wl:_l,Ct=k==="x"?qc:jc,st=W[$],we=$==="y"?"height":"width",he=st+O[Ye],xe=st-O[Ct],Be=[wl,_l].indexOf(P)!==-1,$e=(Pe=G?.[$])!=null?Pe:0,Ze=Be?he:st-Q[we]-Y[we]-$e+D.altAxis,Lt=Be?st+Q[we]+Y[we]-$e-D.altAxis:xe,ot=y&&Be?dye(Ze,st,Lt):Hw(y?Ze:he,st,y?Lt:xe);W[$]=ot,j[$]=ot-st}e.modifiersData[n]=j}}const Hye={name:"preventOverflow",enabled:!0,phase:"main",fn:Uye,requiresIfExists:["offset"]};function $ye(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function Wye(t){return t===ic(t)||!Bc(t)?WG(t):$ye(t)}function qye(t){var e=t.getBoundingClientRect(),i=b0(e.width)/t.offsetWidth||1,n=b0(e.height)/t.offsetHeight||1;return i!==1||n!==1}function jye(t,e,i){i===void 0&&(i=!1);var n=Bc(e),r=Bc(e)&&qye(e),s=Lp(e),o=w0(t,r,i),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!i)&&((Oh(e)!=="body"||jG(s))&&(a=Wye(e)),Bc(e)?(l=w0(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=qG(s))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function Qye(t){var e=new Map,i=new Set,n=[];t.forEach(function(s){e.set(s.name,s)});function r(s){i.add(s.name);var o=[].concat(s.requires||[],s.requiresIfExists||[]);o.forEach(function(a){if(!i.has(a)){var l=e.get(a);l&&r(l)}}),n.push(s)}return t.forEach(function(s){i.has(s.name)||r(s)}),n}function Zye(t){var e=Qye(t);return aye.reduce(function(i,n){return i.concat(e.filter(function(r){return r.phase===n}))},[])}function Xye(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function Kye(t){var e=t.reduce(function(i,n){var r=i[n.name];return i[n.name]=r?Object.assign({},r,n,{options:Object.assign({},r.options,n.options),data:Object.assign({},r.data,n.data)}):n,i},{});return Object.keys(e).map(function(i){return e[i]})}var zW={placement:"bottom",modifiers:[],strategy:"absolute"};function VW(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function Yye(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,n=i===void 0?[]:i,r=e.defaultOptions,s=r===void 0?zW:r;return function(a,l,u){u===void 0&&(u=s);var d={placement:"bottom",orderedModifiers:[],options:Object.assign({},zW,s),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},p=[],v=!1,y={state:d,setOptions:function(P){var N=typeof P=="function"?P(d.options):P;R(),d.options=Object.assign({},s,d.options,N),d.scrollParents={reference:Ig(a)?$w(a):a.contextElement?$w(a.contextElement):[],popper:$w(l)};var F=Zye(Kye([].concat(n,d.options.modifiers)));return d.orderedModifiers=F.filter(function(k){return k.enabled}),w(),y.update()},forceUpdate:function(){if(!v){var P=d.elements,N=P.reference,F=P.popper;if(VW(N,F)){d.rects={reference:jye(N,LC(F),d.options.strategy==="fixed"),popper:HG(F)},d.reset=!1,d.placement=d.options.placement,d.orderedModifiers.forEach(function(D){return d.modifiersData[D.name]=Object.assign({},D.data)});for(var k=0;k<d.orderedModifiers.length;k++){if(d.reset===!0){d.reset=!1,k=-1;continue}var $=d.orderedModifiers[k],W=$.fn,Q=$.options,Y=Q===void 0?{}:Q,M=$.name;typeof W=="function"&&(d=W({state:d,options:Y,name:M,instance:y})||d)}}}},update:Xye(function(){return new Promise(function(O){y.forceUpdate(),O(d)})}),destroy:function(){R(),v=!0}};if(!VW(a,l))return y;y.setOptions(u).then(function(O){!v&&u.onFirstUpdate&&u.onFirstUpdate(O)});function w(){d.orderedModifiers.forEach(function(O){var P=O.name,N=O.options,F=N===void 0?{}:N,k=O.effect;if(typeof k=="function"){var $=k({state:d,name:P,instance:y,options:F}),W=function(){};p.push($||W)}})}function R(){p.forEach(function(O){return O()}),p=[]}return y}}var Jye=[_ye,Vye,bye,HK,Bye,kye,Hye,gye,Lye],e0e=Yye({defaultModifiers:Jye}),t0e="tippy-box",KK="tippy-content",i0e="tippy-backdrop",YK="tippy-arrow",JK="tippy-svg-arrow",Nm={passive:!0,capture:!0},eY=function(){return document.body};function UF(t,e,i){if(Array.isArray(t)){var n=t[e];return n??(Array.isArray(i)?i[e]:i)}return t}function QG(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function tY(t,e){return typeof t=="function"?t.apply(void 0,e):t}function GW(t,e){if(e===0)return t;var i;return function(n){clearTimeout(i),i=setTimeout(function(){t(n)},e)}}function n0e(t){return t.split(/\s+/).filter(Boolean)}function Iy(t){return[].concat(t)}function UW(t,e){t.indexOf(e)===-1&&t.push(e)}function r0e(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function s0e(t){return t.split("-")[0]}function bT(t){return[].slice.call(t)}function HW(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function Ww(){return document.createElement("div")}function gP(t){return["Element","Fragment"].some(function(e){return QG(t,e)})}function o0e(t){return QG(t,"NodeList")}function a0e(t){return QG(t,"MouseEvent")}function l0e(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function c0e(t){return gP(t)?[t]:o0e(t)?bT(t):Array.isArray(t)?t:bT(document.querySelectorAll(t))}function HF(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function $W(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function u0e(t){var e,i=Iy(t),n=i[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function h0e(t,e){var i=e.clientX,n=e.clientY;return t.every(function(r){var s=r.popperRect,o=r.popperState,a=r.props,l=a.interactiveBorder,u=s0e(o.placement),d=o.modifiersData.offset;if(!d)return!0;var p=u==="bottom"?d.top.y:0,v=u==="top"?d.bottom.y:0,y=u==="right"?d.left.x:0,w=u==="left"?d.right.x:0,R=s.top-n+p>l,O=n-s.bottom-v>l,P=s.left-i+y>l,N=i-s.right-w>l;return R||O||P||N})}function $F(t,e,i){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){t[n](r,i)})}function WW(t,e){for(var i=e;i;){var n;if(t.contains(i))return!0;i=i.getRootNode==null||(n=i.getRootNode())==null?void 0:n.host}return!1}var ih={isTouch:!1},qW=0;function d0e(){ih.isTouch||(ih.isTouch=!0,window.performance&&document.addEventListener("mousemove",iY))}function iY(){var t=performance.now();t-qW<20&&(ih.isTouch=!1,document.removeEventListener("mousemove",iY)),qW=t}function f0e(){var t=document.activeElement;if(l0e(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function p0e(){document.addEventListener("touchstart",d0e,Nm),window.addEventListener("blur",f0e)}var m0e=typeof window<"u"&&typeof document<"u",g0e=m0e?!!window.msCrypto:!1,v0e={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},y0e={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},bu=Object.assign({appendTo:eY,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},v0e,y0e),x0e=Object.keys(bu),b0e=function(e){var i=Object.keys(e);i.forEach(function(n){bu[n]=e[n]})};function nY(t){var e=t.plugins||[],i=e.reduce(function(n,r){var s=r.name,o=r.defaultValue;if(s){var a;n[s]=t[s]!==void 0?t[s]:(a=bu[s])!=null?a:o}return n},{});return Object.assign({},t,i)}function w0e(t,e){var i=e?Object.keys(nY(Object.assign({},bu,{plugins:e}))):x0e,n=i.reduce(function(r,s){var o=(t.getAttribute("data-tippy-"+s)||"").trim();if(!o)return r;if(s==="content")r[s]=o;else try{r[s]=JSON.parse(o)}catch{r[s]=o}return r},{});return n}function jW(t,e){var i=Object.assign({},e,{content:tY(e.content,[t])},e.ignoreAttributes?{}:w0e(t,e.plugins));return i.aria=Object.assign({},bu.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var _0e=function(){return"innerHTML"};function lz(t,e){t[_0e()]=e}function QW(t){var e=Ww();return t===!0?e.className=YK:(e.className=JK,gP(t)?e.appendChild(t):lz(e,t)),e}function ZW(t,e){gP(e.content)?(lz(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?lz(t,e.content):t.textContent=e.content)}function cz(t){var e=t.firstElementChild,i=bT(e.children);return{box:e,content:i.find(function(n){return n.classList.contains(KK)}),arrow:i.find(function(n){return n.classList.contains(YK)||n.classList.contains(JK)}),backdrop:i.find(function(n){return n.classList.contains(i0e)})}}function rY(t){var e=Ww(),i=Ww();i.className=t0e,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var n=Ww();n.className=KK,n.setAttribute("data-state","hidden"),ZW(n,t.props),e.appendChild(i),i.appendChild(n),r(t.props,t.props);function r(s,o){var a=cz(e),l=a.box,u=a.content,d=a.arrow;o.theme?l.setAttribute("data-theme",o.theme):l.removeAttribute("data-theme"),typeof o.animation=="string"?l.setAttribute("data-animation",o.animation):l.removeAttribute("data-animation"),o.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?l.setAttribute("role",o.role):l.removeAttribute("role"),(s.content!==o.content||s.allowHTML!==o.allowHTML)&&ZW(u,t.props),o.arrow?d?s.arrow!==o.arrow&&(l.removeChild(d),l.appendChild(QW(o.arrow))):l.appendChild(QW(o.arrow)):d&&l.removeChild(d)}return{popper:e,onUpdate:r}}rY.$$tippy=!0;var C0e=1,H1=[],WF=[];function S0e(t,e){var i=jW(t,Object.assign({},bu,nY(HW(e)))),n,r,s,o=!1,a=!1,l=!1,u=!1,d,p,v,y=[],w=GW(Re,i.interactiveDebounce),R,O=C0e++,P=null,N=r0e(i.plugins),F={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},k={id:O,reference:t,popper:Ww(),popperInstance:P,props:i,state:F,plugins:N,clearDelayTimeouts:Ze,setProps:Lt,setContent:ot,show:Nt,hide:fi,hideWithInteractivity:Pt,enable:Be,disable:$e,unmount:ni,destroy:ti};if(!i.render)return k;var $=i.render(k),W=$.popper,Q=$.onUpdate;W.setAttribute("data-tippy-root",""),W.id="tippy-"+k.id,k.popper=W,t._tippy=k,W._tippy=k;var Y=N.map(function(nt){return nt.fn(k)}),M=t.hasAttribute("aria-expanded");return Jt(),He(),be(),fe("onCreate",[k]),i.showOnCreate&&he(),W.addEventListener("mouseenter",function(){k.props.interactive&&k.state.isVisible&&k.clearDelayTimeouts()}),W.addEventListener("mouseleave",function(){k.props.interactive&&k.props.trigger.indexOf("mouseenter")>=0&&ie().addEventListener("mousemove",w)}),k;function D(){var nt=k.props.touch;return Array.isArray(nt)?nt:[nt,0]}function G(){return D()[0]==="hold"}function j(){var nt;return!!((nt=k.props.render)!=null&&nt.$$tippy)}function Z(){return R||t}function ie(){var nt=Z().parentNode;return nt?u0e(nt):document}function le(){return cz(W)}function me(nt){return k.state.isMounted&&!k.state.isVisible||ih.isTouch||d&&d.type==="focus"?0:UF(k.props.delay,nt?0:1,bu.delay)}function be(nt){nt===void 0&&(nt=!1),W.style.pointerEvents=k.props.interactive&&!nt?"":"none",W.style.zIndex=""+k.props.zIndex}function fe(nt,Ce,oe){if(oe===void 0&&(oe=!0),Y.forEach(function(ee){ee[nt]&&ee[nt].apply(ee,Ce)}),oe){var re;(re=k.props)[nt].apply(re,Ce)}}function Fe(){var nt=k.props.aria;if(nt.content){var Ce="aria-"+nt.content,oe=W.id,re=Iy(k.props.triggerTarget||t);re.forEach(function(ee){var te=ee.getAttribute(Ce);if(k.state.isVisible)ee.setAttribute(Ce,te?te+" "+oe:oe);else{var Se=te&&te.replace(oe,"").trim();Se?ee.setAttribute(Ce,Se):ee.removeAttribute(Ce)}})}}function He(){if(!(M||!k.props.aria.expanded)){var nt=Iy(k.props.triggerTarget||t);nt.forEach(function(Ce){k.props.interactive?Ce.setAttribute("aria-expanded",k.state.isVisible&&Ce===Z()?"true":"false"):Ce.removeAttribute("aria-expanded")})}}function je(){ie().removeEventListener("mousemove",w),H1=H1.filter(function(nt){return nt!==w})}function qe(nt){if(!(ih.isTouch&&(l||nt.type==="mousedown"))){var Ce=nt.composedPath&&nt.composedPath()[0]||nt.target;if(!(k.props.interactive&&WW(W,Ce))){if(Iy(k.props.triggerTarget||t).some(function(oe){return WW(oe,Ce)})){if(ih.isTouch||k.state.isVisible&&k.props.trigger.indexOf("click")>=0)return}else fe("onClickOutside",[k,nt]);k.props.hideOnClick===!0&&(k.clearDelayTimeouts(),k.hide(),a=!0,setTimeout(function(){a=!1}),k.state.isMounted||mt())}}}function ct(){l=!0}function Ge(){l=!1}function Je(){var nt=ie();nt.addEventListener("mousedown",qe,!0),nt.addEventListener("touchend",qe,Nm),nt.addEventListener("touchstart",Ge,Nm),nt.addEventListener("touchmove",ct,Nm)}function mt(){var nt=ie();nt.removeEventListener("mousedown",qe,!0),nt.removeEventListener("touchend",qe,Nm),nt.removeEventListener("touchstart",Ge,Nm),nt.removeEventListener("touchmove",ct,Nm)}function wt(nt,Ce){Qt(nt,function(){!k.state.isVisible&&W.parentNode&&W.parentNode.contains(W)&&Ce()})}function Ot(nt,Ce){Qt(nt,Ce)}function Qt(nt,Ce){var oe=le().box;function re(ee){ee.target===oe&&($F(oe,"remove",re),Ce())}if(nt===0)return Ce();$F(oe,"remove",p),$F(oe,"add",re),p=re}function ei(nt,Ce,oe){oe===void 0&&(oe=!1);var re=Iy(k.props.triggerTarget||t);re.forEach(function(ee){ee.addEventListener(nt,Ce,oe),y.push({node:ee,eventType:nt,handler:Ce,options:oe})})}function Jt(){G()&&(ei("touchstart",Ut,{passive:!0}),ei("touchend",gi,{passive:!0})),n0e(k.props.trigger).forEach(function(nt){if(nt!=="manual")switch(ei(nt,Ut),nt){case"mouseenter":ei("mouseleave",gi);break;case"focus":ei(g0e?"focusout":"blur",it);break;case"focusin":ei("focusout",it);break}})}function Yt(){y.forEach(function(nt){var Ce=nt.node,oe=nt.eventType,re=nt.handler,ee=nt.options;Ce.removeEventListener(oe,re,ee)}),y=[]}function Ut(nt){var Ce,oe=!1;if(!(!k.state.isEnabled||Pe(nt)||a)){var re=((Ce=d)==null?void 0:Ce.type)==="focus";d=nt,R=nt.currentTarget,He(),!k.state.isVisible&&a0e(nt)&&H1.forEach(function(ee){return ee(nt)}),nt.type==="click"&&(k.props.trigger.indexOf("mouseenter")<0||o)&&k.props.hideOnClick!==!1&&k.state.isVisible?oe=!0:he(nt),nt.type==="click"&&(o=!oe),oe&&!re&&xe(nt)}}function Re(nt){var Ce=nt.target,oe=Z().contains(Ce)||W.contains(Ce);if(!(nt.type==="mousemove"&&oe)){var re=we().concat(W).map(function(ee){var te,Se=ee._tippy,ve=(te=Se.popperInstance)==null?void 0:te.state;return ve?{popperRect:ee.getBoundingClientRect(),popperState:ve,props:i}:null}).filter(Boolean);h0e(re,nt)&&(je(),xe(nt))}}function gi(nt){var Ce=Pe(nt)||k.props.trigger.indexOf("click")>=0&&o;if(!Ce){if(k.props.interactive){k.hideWithInteractivity(nt);return}xe(nt)}}function it(nt){k.props.trigger.indexOf("focusin")<0&&nt.target!==Z()||k.props.interactive&&nt.relatedTarget&&W.contains(nt.relatedTarget)||xe(nt)}function Pe(nt){return ih.isTouch?G()!==nt.type.indexOf("touch")>=0:!1}function Ye(){Ct();var nt=k.props,Ce=nt.popperOptions,oe=nt.placement,re=nt.offset,ee=nt.getReferenceClientRect,te=nt.moveTransition,Se=j()?cz(W).arrow:null,ve=ee?{getBoundingClientRect:ee,contextElement:ee.contextElement||Z()}:t,Ae={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(ut){var lt=ut.state;if(j()){var Tt=le(),zt=Tt.box;["placement","reference-hidden","escaped"].forEach(function(ii){ii==="placement"?zt.setAttribute("data-placement",lt.placement):lt.attributes.popper["data-popper-"+ii]?zt.setAttribute("data-"+ii,""):zt.removeAttribute("data-"+ii)}),lt.attributes.popper={}}}},ke=[{name:"offset",options:{offset:re}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!te}},Ae];j()&&Se&&ke.push({name:"arrow",options:{element:Se,padding:3}}),ke.push.apply(ke,Ce?.modifiers||[]),k.popperInstance=e0e(ve,W,Object.assign({},Ce,{placement:oe,onFirstUpdate:v,modifiers:ke}))}function Ct(){k.popperInstance&&(k.popperInstance.destroy(),k.popperInstance=null)}function st(){var nt=k.props.appendTo,Ce,oe=Z();k.props.interactive&&nt===eY||nt==="parent"?Ce=oe.parentNode:Ce=tY(nt,[oe]),Ce.contains(W)||Ce.appendChild(W),k.state.isMounted=!0,Ye()}function we(){return bT(W.querySelectorAll("[data-tippy-root]"))}function he(nt){k.clearDelayTimeouts(),nt&&fe("onTrigger",[k,nt]),Je();var Ce=me(!0),oe=D(),re=oe[0],ee=oe[1];ih.isTouch&&re==="hold"&&ee&&(Ce=ee),Ce?n=setTimeout(function(){k.show()},Ce):k.show()}function xe(nt){if(k.clearDelayTimeouts(),fe("onUntrigger",[k,nt]),!k.state.isVisible){mt();return}if(!(k.props.trigger.indexOf("mouseenter")>=0&&k.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(nt.type)>=0&&o)){var Ce=me(!1);Ce?r=setTimeout(function(){k.state.isVisible&&k.hide()},Ce):s=requestAnimationFrame(function(){k.hide()})}}function Be(){k.state.isEnabled=!0}function $e(){k.hide(),k.state.isEnabled=!1}function Ze(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(s)}function Lt(nt){if(!k.state.isDestroyed){fe("onBeforeUpdate",[k,nt]),Yt();var Ce=k.props,oe=jW(t,Object.assign({},Ce,HW(nt),{ignoreAttributes:!0}));k.props=oe,Jt(),Ce.interactiveDebounce!==oe.interactiveDebounce&&(je(),w=GW(Re,oe.interactiveDebounce)),Ce.triggerTarget&&!oe.triggerTarget?Iy(Ce.triggerTarget).forEach(function(re){re.removeAttribute("aria-expanded")}):oe.triggerTarget&&t.removeAttribute("aria-expanded"),He(),be(),Q&&Q(Ce,oe),k.popperInstance&&(Ye(),we().forEach(function(re){requestAnimationFrame(re._tippy.popperInstance.forceUpdate)})),fe("onAfterUpdate",[k,nt])}}function ot(nt){k.setProps({content:nt})}function Nt(){var nt=k.state.isVisible,Ce=k.state.isDestroyed,oe=!k.state.isEnabled,re=ih.isTouch&&!k.props.touch,ee=UF(k.props.duration,0,bu.duration);if(!(nt||Ce||oe||re)&&!Z().hasAttribute("disabled")&&(fe("onShow",[k],!1),k.props.onShow(k)!==!1)){if(k.state.isVisible=!0,j()&&(W.style.visibility="visible"),be(),Je(),k.state.isMounted||(W.style.transition="none"),j()){var te=le(),Se=te.box,ve=te.content;HF([Se,ve],0)}v=function(){var ke;if(!(!k.state.isVisible||u)){if(u=!0,W.offsetHeight,W.style.transition=k.props.moveTransition,j()&&k.props.animation){var Xe=le(),ut=Xe.box,lt=Xe.content;HF([ut,lt],ee),$W([ut,lt],"visible")}Fe(),He(),UW(WF,k),(ke=k.popperInstance)==null||ke.forceUpdate(),fe("onMount",[k]),k.props.animation&&j()&&Ot(ee,function(){k.state.isShown=!0,fe("onShown",[k])})}},st()}}function fi(){var nt=!k.state.isVisible,Ce=k.state.isDestroyed,oe=!k.state.isEnabled,re=UF(k.props.duration,1,bu.duration);if(!(nt||Ce||oe)&&(fe("onHide",[k],!1),k.props.onHide(k)!==!1)){if(k.state.isVisible=!1,k.state.isShown=!1,u=!1,o=!1,j()&&(W.style.visibility="hidden"),je(),mt(),be(!0),j()){var ee=le(),te=ee.box,Se=ee.content;k.props.animation&&(HF([te,Se],re),$W([te,Se],"hidden"))}Fe(),He(),k.props.animation?j()&&wt(re,k.unmount):k.unmount()}}function Pt(nt){ie().addEventListener("mousemove",w),UW(H1,w),w(nt)}function ni(){k.state.isVisible&&k.hide(),k.state.isMounted&&(Ct(),we().forEach(function(nt){nt._tippy.unmount()}),W.parentNode&&W.parentNode.removeChild(W),WF=WF.filter(function(nt){return nt!==k}),k.state.isMounted=!1,fe("onHidden",[k]))}function ti(){k.state.isDestroyed||(k.clearDelayTimeouts(),k.unmount(),Yt(),delete t._tippy,k.state.isDestroyed=!0,fe("onDestroy",[k]))}}function FC(t,e){e===void 0&&(e={});var i=bu.plugins.concat(e.plugins||[]);p0e();var n=Object.assign({},e,{plugins:i}),r=c0e(t),s=r.reduce(function(o,a){var l=a&&S0e(a,n);return l&&o.push(l),o},[]);return gP(t)?s[0]:s}FC.defaultProps=bu;FC.setDefaultProps=b0e;FC.currentInput=ih;Object.assign({},HK,{effect:function(e){var i=e.state,n={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,n.popper),i.styles=n,i.elements.arrow&&Object.assign(i.elements.arrow.style,n.arrow)}});FC.setDefaultProps({render:rY});function ZG(t,e){let i=null;function n(r){if(!r.content){i&&(i.destroy(),i=null);return}i&&i.destroy(),i=FC(t,{content:r.content,allowHTML:!0})}return n(e),{update(r){n(r)},destroy(){i&&i.destroy()}}}function O0e(t,e){return new Function(...Object.keys(e),`${t}`)(...Object.values(e))}function XG(t,e,i){switch(t?.type){case"navigate":window.open($n(t.URL,e,i,!1),t.newTab?"_blank":"_self");break;case"clientScript":O0e(t.script,e);break;case"setProperty":e.page.namedPageObjects[t.objectName].getLayout().props[t.property]=$n(t.value,e,i,!1);break;case"setGlobal":e.page.data[t.variableName]=$n(t.value,e,i,!1);break}}function $n(t,e,i,n){if(n&&t)return M0e(t);if(t){const r=/{(.+?)(?::(\w+))?}/g;return t.replace(r,(s,o,a)=>{let l;switch(o.substring(0,5)){case"data.":l=qF(i,o.substring(5));break;case"page.":l=qF(e?.data,o.substring(5));break;case"self.":l=qF(e.self?.getLayout(),o.substring(5));break}return a&&a in XW?o.substring(5)in i?XW[a](l):s:l||s})}return t}function qF(t,e){return e.split(".").reduce((n,r)=>n&&n[r]!==void 0?n[r]:void 0,t)}const XW={longDate:t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),time:t=>new Date(t).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"}),dayNumber:t=>new Date(t).toLocaleDateString("en-US",{day:"2-digit"}),monthNumber:t=>new Date(t).toLocaleDateString("en-US",{month:"2-digit"}),monthName:t=>new Date(t).toLocaleDateString("en-US",{month:"long"}),year:t=>new Date(t).toLocaleDateString("en-US",{year:"numeric"}),dayOfWeek:t=>new Date(t).toLocaleDateString("en-US",{weekday:"long"}),currency:t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),thousands:t=>new Intl.NumberFormat("en-US",{}).format(t),removeSpaces:t=>t.replace(/\s/g,""),uppercase:t=>t.toUpperCase(),lowercase:t=>t.toLowerCase(),formatSuffix:t=>t?`, ${t}`:"",hideEmpty:t=>t||""};function M0e(t){if(!t)return;const e=/\{([^}]+)\}/g;return t.replace(e,(n,r)=>`<span class="macro-badge">${r}</span>`)}var T0e=hi('<button class="btn btn-error btn-xs">oops! try again</button> ',1),R0e=(t,e,i)=>e(i.index),P0e=hi('<div class="relative border border-dashed border-gray-400 p-2 m-1"><span class="absolute -top-2 -right-2 opacity-60"><!></span> <div class="absolute -left-2 -top-2 z-10 rounded bg-white opacity-60"><!></div> <!></div>'),E0e=hi("<div><!></div>");function kg(t,e){Pi(e,!0);const i=Xi("pageContext");let n=Fn(void 0);const r=Nle(e.layoutStructure.type)?.component;function s(){i.selectedLayout=e.layoutStructure,i.selectedComponent=B(n)}function o(){e.parent.children[e.index].id&&delete i.namedPageObjects[e.parent.children[e.index].id],e.parent.children.splice(e.index,1)}On(()=>{e.layoutStructure.id&&B(n)&&(i.namedPageObjects[e.layoutStructure.id]=B(n))});function a(d){d.stopPropagation(),e.layoutStructure.props?.draggable&&e.layoutStructure.props?.dragData&&d.dataTransfer?.setData("text/plain",$n(e.layoutStructure.props?.dragData,i,e.dataValues,!1))}var l=nn(),u=pi(l);Dle(u,{failed:(p,v=to,y=to)=>{var w=T0e(),R=pi(w);R.__click=function(...P){y()?.apply(this,P)};var O=vi(R);Gi(()=>zd(O,` ${v()??""}`)),bt(p,w)}},p=>{var v=nn(),y=pi(v);{var w=R=>{var O=nn(),P=pi(O);{var N=k=>{var $=P0e(),W=Di($),Q=Di(W);jM(Q,{onclick:()=>s(),icon:"mdi:gear",width:"24",class:"text-primary bg-white rounded-full p-1 shadow-md hover:text-accent hover:scale-150 transition-transform"}),_i(W);var Y=vi(W,2);Y.__click=[R0e,o,e];var M=Di(Y);jM(M,{icon:"lucide:trash-2",width:"24",class:"text-primary bg-white rounded-full p-1 shadow-md hover:text-error hover:scale-150 transition-transform"}),_i(Y);var D=vi(Y,2);es(r(D,{get layoutStructure(){return e.layoutStructure},get dataValues(){return e.dataValues},get myself(){return B(n)}}),G=>rt(n,kn(G)),()=>B(n)),_i($),bt(k,$)},F=k=>{var $=E0e(),W=Di($);es(r(W,{get layoutStructure(){return e.layoutStructure},get dataValues(){return e.dataValues},get myself(){return B(n)}}),Q=>rt(n,kn(Q)),()=>B(n)),_i($),Tn("dragstart",$,Q=>a(Q)),bt(k,$)};Yi(P,k=>{i?.editMode?k(N):k(F,!1)})}bt(R,O)};Yi(y,R=>{r&&R(w)})}bt(p,v)}),bt(t,l),Ei()}Zg(["click"]);function ex(t={},e,i){const n={};return Object.keys(t).forEach(r=>{const s=t[r];s&&(n[r]=()=>{XG(s,e,i)})}),n}var A0e=hi("<button> </button>");function Nrt(t,e){Pi(e,!0);const i=Xi("pageContext");function n(){return e.layoutStructure}function r(){return["onclick"]}function s(){return[{name:"disabled",type:"boolean"},{name:"label",type:"string"}]}const o=Vt(()=>$n(e.layoutStructure.props?.class,i,e.dataValues,!1)+(e.layoutStructure.props?.background?` bg-[url(${e.layoutStructure.props?.background})] bg-no-repeat bg-cover bg-center`:"")),a=Vt(()=>$n(e.layoutStructure.props?.label,i,e.dataValues,!1));var l=A0e();let u;var d=Di(l,!0);return _i(l),Us(l,(p,v)=>ZG?.(p,v),()=>({content:$n(e.layoutStructure.props?.tooltip,e.dataValues,!1)})),Gi(p=>{u=Ch(l,u,{...p,disabled:e.layoutStructure.props?.disabled,class:B(o),draggable:e.layoutStructure.props?.draggable}),zd(d,B(a))},[()=>ex(e.layoutStructure.actions,{page:i,data:e.dataValues,self:e.myself},e.dataValues)]),bt(t,l),Ei({getLayout:n,getEvents:r,getProps:s})}var tx=class{constructor(){this.allSyncListeners=new Map,this.allAsyncListeners=new Map,this.globalSyncListeners=new Set,this.globalAsyncListeners=new Set,this.asyncFunctionsQueue=[],this.scheduled=!1,this.firedEvents={}}setFrameworkOverrides(t){this.frameworkOverrides=t}getListeners(t,e,i){const n=e?this.allAsyncListeners:this.allSyncListeners;let r=n.get(t);return!r&&i&&(r=new Set,n.set(t,r)),r}noRegisteredListenersExist(){return this.allSyncListeners.size===0&&this.allAsyncListeners.size===0&&this.globalSyncListeners.size===0&&this.globalAsyncListeners.size===0}addEventListener(t,e,i=!1){this.getListeners(t,i,!0).add(e)}removeEventListener(t,e,i=!1){const n=this.getListeners(t,i,!1);n&&(n.delete(e),n.size===0&&(i?this.allAsyncListeners:this.allSyncListeners).delete(t))}addGlobalListener(t,e=!1){(e?this.globalAsyncListeners:this.globalSyncListeners).add(t)}removeGlobalListener(t,e=!1){(e?this.globalAsyncListeners:this.globalSyncListeners).delete(t)}dispatchEvent(t){const e=t;this.dispatchToListeners(e,!0),this.dispatchToListeners(e,!1),this.firedEvents[e.type]=!0}dispatchEventOnce(t){this.firedEvents[t.type]||this.dispatchEvent(t)}dispatchToListeners(t,e){const i=t.type;if(e&&"event"in t){const a=t.event;a instanceof Event&&(t.eventPath=a.composedPath())}const n=(a,l)=>a.forEach(u=>{if(!l.has(u))return;const d=this.frameworkOverrides?()=>this.frameworkOverrides.wrapIncoming(()=>u(t)):()=>u(t);e?this.dispatchAsync(d):d()}),r=this.getListeners(i,e,!1)??new Set,s=new Set(r);s.size>0&&n(s,r),new Set(e?this.globalAsyncListeners:this.globalSyncListeners).forEach(a=>{const l=this.frameworkOverrides?()=>this.frameworkOverrides.wrapIncoming(()=>a(i,t)):()=>a(i,t);e?this.dispatchAsync(l):l()})}dispatchAsync(t){if(this.asyncFunctionsQueue.push(t),!this.scheduled){const e=()=>{window.setTimeout(this.flushAsyncQueue.bind(this),0)};this.frameworkOverrides?this.frameworkOverrides.wrapIncoming(e):e(),this.scheduled=!0}}flushAsyncQueue(){this.scheduled=!1;const t=this.asyncFunctionsQueue.slice();this.asyncFunctionsQueue=[],t.forEach(e=>e())}},sY=(t=>(t.CommunityCoreModule="@ag-grid-community/core",t.InfiniteRowModelModule="@ag-grid-community/infinite-row-model",t.ClientSideRowModelModule="@ag-grid-community/client-side-row-model",t.CsvExportModule="@ag-grid-community/csv-export",t.EnterpriseCoreModule="@ag-grid-enterprise/core",t.RowGroupingModule="@ag-grid-enterprise/row-grouping",t.ColumnsToolPanelModule="@ag-grid-enterprise/column-tool-panel",t.FiltersToolPanelModule="@ag-grid-enterprise/filter-tool-panel",t.MenuModule="@ag-grid-enterprise/menu",t.SetFilterModule="@ag-grid-enterprise/set-filter",t.MultiFilterModule="@ag-grid-enterprise/multi-filter",t.StatusBarModule="@ag-grid-enterprise/status-bar",t.SideBarModule="@ag-grid-enterprise/side-bar",t.RangeSelectionModule="@ag-grid-enterprise/range-selection",t.MasterDetailModule="@ag-grid-enterprise/master-detail",t.RichSelectModule="@ag-grid-enterprise/rich-select",t.GridChartsModule="@ag-grid-enterprise/charts",t.ViewportRowModelModule="@ag-grid-enterprise/viewport-row-model",t.ServerSideRowModelModule="@ag-grid-enterprise/server-side-row-model",t.ExcelExportModule="@ag-grid-enterprise/excel-export",t.ClipboardModule="@ag-grid-enterprise/clipboard",t.SparklinesModule="@ag-grid-enterprise/sparklines",t.AdvancedFilterModule="@ag-grid-enterprise/advanced-filter",t.AngularModule="@ag-grid-community/angular",t.ReactModule="@ag-grid-community/react",t.VueModule="@ag-grid-community/vue",t))(sY||{}),KW={};function KG(t,e){KW[e]||(t(),KW[e]=!0)}function Ic(t,...e){console.log("AG Grid: "+t,...e)}function Wt(t,...e){KG(()=>console.warn("AG Grid: "+t,...e),t+e?.join(""))}function ar(t,...e){KG(()=>console.error("AG Grid: "+t,...e),t+e?.join(""))}function YG(t){return!!(t&&t.constructor&&t.call&&t.apply)}function I0e(t){k0e(t,400)}var jF=[],QF=!1;function YW(t){jF.push(t),!QF&&(QF=!0,window.setTimeout(()=>{const e=jF.slice();jF.length=0,QF=!1,e.forEach(i=>i())},0))}function k0e(t,e=0){t.length>0&&window.setTimeout(()=>t.forEach(i=>i()),e)}function Fa(t,e){let i;return function(...n){const r=this;window.clearTimeout(i),i=window.setTimeout(function(){t.apply(r,n)},e)}}function JW(t,e){let i=0;return function(...n){const r=this,s=new Date().getTime();s-i<e||(i=s,t.apply(r,n))}}function D0e(t,e,i=100,n){const r=new Date().getTime();let s=null,o=!1;const a=()=>{const l=new Date().getTime()-r>i;(t()||l)&&(e(),o=!0,s!=null&&(window.clearInterval(s),s=null))};a(),o||(s=window.setInterval(a,10))}function L0e(...t){return e=>t.reduce((i,n)=>n(i),e)}function Pd(t){return t==null||t===""?null:t}function oi(t,e=!1){return t!=null&&(t!==""||e)}function Wn(t){return!oi(t)}function Kl(t){return t==null||t.length===0}function uz(t){return t!=null&&typeof t.toString=="function"?t.toString():null}function hg(t){if(t===void 0)return;if(t===null||t==="")return null;if(typeof t=="number")return isNaN(t)?void 0:t;const e=parseInt(t,10);return isNaN(e)?void 0:e}function hz(t){if(t!==void 0)return t===null||t===""?!1:dz(t)}function dz(t){return typeof t=="boolean"?t:typeof t=="string"?t.toUpperCase()==="TRUE"||t=="":!1}function V_(t,e){const i=t?JSON.stringify(t):null,n=e?JSON.stringify(e):null;return i===n}function F0e(t,e,i=!1){const n=t==null,r=e==null;if(t&&t.toNumber&&(t=t.toNumber()),e&&e.toNumber&&(e=e.toNumber()),n&&r)return 0;if(n)return-1;if(r)return 1;function s(o,a){return o>a?1:o<a?-1:0}if(typeof t!="string"||!i)return s(t,e);try{return t.localeCompare(e)}catch{return s(t,e)}}function OM(t){if(t instanceof Set||t instanceof Map){const e=[];return t.forEach(i=>e.push(i)),e}return Object.values(t)}function oY(t,e){return t.get("rowModelType")===e}function ls(t){return oY(t,"clientSide")}function tf(t){return oY(t,"serverSide")}function Zo(t,e){return t.get("domLayout")===e}function wT(t){return ST(t)!==void 0}function _T(t){return!t.get("suppressAsyncEvents")}function aY(t){return typeof t.get("getRowHeight")=="function"}function N0e(t,e){return e?!t.get("enableStrictPivotColumnOrder"):t.get("maintainColumnOrder")}function Mp(t,e,i=!1,n){if(n==null&&(n=t.environment.getDefaultRowHeight()),aY(t)){if(i)return{height:n,estimated:!0};const o={node:e,data:e.data},a=t.getCallback("getRowHeight")(o);if(fz(a))return a===0&&Wt("The return of `getRowHeight` cannot be zero. If the intention is to hide rows, use a filter instead."),{height:Math.max(1,a),estimated:!1}}if(e.detail&&t.get("masterDetail"))return B0e(t);const r=t.get("rowHeight");return{height:r&&fz(r)?r:n,estimated:!1}}function B0e(t){if(t.get("detailRowAutoHeight"))return{height:1,estimated:!1};const e=t.get("detailRowHeight");return fz(e)?{height:e,estimated:!1}:{height:300,estimated:!1}}function dg(t){const{environment:e}=t,i=t.get("rowHeight");if(!i||Wn(i))return e.getDefaultRowHeight();const n=e.refreshRowHeightVariable();return n!==-1?n:(Wt("row height must be a number if not using standard row model"),e.getDefaultRowHeight())}function fz(t){return!isNaN(t)&&typeof t=="number"&&isFinite(t)}function G_(t,e,i){const n=e[t.getDomDataKey()];return n?n[i]:void 0}function Dg(t,e,i,n){const r=t.getDomDataKey();let s=e[r];Wn(s)&&(s={},e[r]=s),s[i]=n}function Rs(t){let e=null;const i=t.get("getDocument");return i&&oi(i)?e=i():t.eGridDiv&&(e=t.eGridDiv.ownerDocument),e&&oi(e)?e:document}function lY(t){return Rs(t).defaultView||window}function U_(t){return t.eGridDiv.getRootNode()}function Jr(t){return U_(t).activeElement}function cY(t){const e=Rs(t),i=Jr(t);return i===null||i===e.body}function Jy(t){return t.get("ensureDomOrder")?!1:t.get("animateRows")}function vP(t){return!(t.get("paginateChildRows")||t.get("groupHideOpenParents")||Zo(t,"print"))}function ah(t){return!t.get("autoGroupColumnDef")?.comparator&&!t.get("treeData")}function pz(t){const e=t.get("groupAggFiltering");if(typeof e=="function")return t.getCallback("groupAggFiltering");if(e===!0)return()=>!0}function uY(t){const e=t.get("grandTotalRow");if(e)return e;if(t.get("groupIncludeTotalFooter"))return"bottom"}function hY(t){const e=t.get("groupTotalRow");if(typeof e=="function")return t.getCallback("groupTotalRow");if(e)return()=>e;const i=t.get("groupIncludeFooter");if(typeof i=="function"){const n=t.getCallback("groupIncludeFooter");return r=>n(r)?"bottom":void 0}return()=>i?"bottom":void 0}function dY(t){return t.exists("groupDisplayType")?t.get("groupDisplayType")==="multipleColumns":t.get("groupHideOpenParents")}function yP(t,e){return e?!1:t.get("groupDisplayType")==="groupRows"}function ix(t){const e=t.getCallback("getRowId");return e===void 0?e:i=>{let n=e(i);return typeof n!="string"&&(Wt("The getRowId callback must return a string. The ID ",n," is being cast to a string."),n=String(n)),n}}function C0(t){return t?.checkboxes??!0}function CT(t){return t?.mode==="multiRow"&&(t.headerCheckbox??!0)}function z0e(t){return t?.hideDisabledCheckboxes??!1}function V0e(t){return typeof t.get("rowSelection")!="string"}function G0e(t){return t.get("cellSelection")!==void 0}function U0e(t){const e=t.get("cellSelection");return e!==void 0?typeof e!="boolean"?e?.suppressMultiRanges??!1:!1:t.get("suppressMultiRangeSelection")}function Mh(t){const e=t.get("cellSelection");return e!==void 0?!!e:t.get("enableRangeSelection")}function H0e(t){const e=t.get("cellSelection");return e!==void 0?typeof e!="boolean"?e.handle?.mode==="range":!1:t.get("enableRangeHandle")}function e6(t){const e=t.get("cellSelection");return e!==void 0?typeof e!="boolean"?e.handle?.mode==="fill":!1:t.get("enableFillHandle")}function fY(t){const e=t.get("rowSelection")??"single";if(typeof e=="string"){const i=t.get("suppressRowClickSelection"),n=t.get("suppressRowDeselection");return i&&n?!1:i?"enableDeselection":n?"enableSelection":!0}return e.mode==="singleRow"||e.mode==="multiRow"?e.enableClickSelection??!1:!1}function $0e(t){const e=fY(t);return e===!0||e==="enableSelection"}function t6(t){const e=fY(t);return e===!0||e==="enableDeselection"}function JG(t){const e=t.get("rowSelection");return typeof e=="string"?t.get("isRowSelectable"):e?.isRowSelectable}function ST(t){const e=t.get("rowSelection");if(typeof e=="string")switch(e){case"multiple":return"multiRow";case"single":return"singleRow";default:return}return e?.mode}function eU(t){return ST(t)==="multiRow"}function W0e(t){const e=t.get("rowSelection");return typeof e=="string"?t.get("rowMultiSelectWithClick"):e?.enableSelectionWithoutKeys??!1}function tU(t){const e=t.get("rowSelection");if(typeof e=="string"){const i=t.get("groupSelectsChildren"),n=t.get("groupSelectsFiltered");return i&&n?"filteredDescendants":i?"descendants":"self"}return e?.mode==="multiRow"?e.groupSelects:void 0}function Lg(t){const e=tU(t);return e==="descendants"||e==="filteredDescendants"}function ZF(t){return t.isModuleRegistered("@ag-grid-enterprise/set-filter")&&!t.get("suppressSetFilterByDefault")}function Yn(t){if(!(!t||!t.length))return t[t.length-1]}function Fp(t,e,i){return t==null&&e==null?!0:t!=null&&e!=null&&t.length===e.length&&t.every((n,r)=>i?i(n,e[r]):e[r]===n)}function q0e(t){return t.sort((e,i)=>e-i)}function pY(t,e){const i=t.indexOf(e);i>=0&&(t[i]=t[t.length-1],t.pop())}function Na(t,e){const i=t.indexOf(e);i>=0&&t.splice(i,1)}function j0e(t,e){for(let i=0;i<e.length;i++)pY(t,e[i])}function Q0e(t,e){for(let i=0;i<e.length;i++)Na(t,e[i])}function OT(t,e,i){t.splice(i,0,e)}function mY(t,e,i){Q0e(t,e),e.slice().reverse().forEach(n=>OT(t,n,i))}function fg(t,e){return t.indexOf(e)>-1}function Z0e(t){return t?.flatMap(e=>e)??[]}function i6(t,e){e==null||t==null||e.forEach(i=>t.push(i))}var gY="__ag_Grid_Stop_Propagation",X0e=["touchstart","touchend","touchmove","touchcancel","scroll"],XF={};function S0(t){t[gY]=!0}function Ed(t){return t[gY]===!0}var vY=(()=>{const t={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return i=>{if(typeof XF[i]=="boolean")return XF[i];const n=document.createElement(t[i]||"div");return i="on"+i,XF[i]=i in n}})();function mz(t,e,i){let n=e;for(;n;){const r=G_(t,n,i);if(r)return r;n=n.parentElement}return null}function K0e(t,e){return!e||!t?!1:J0e(e).indexOf(t)>=0}function Y0e(t){const e=[];let i=t.target;for(;i;)e.push(i),i=i.parentElement;return e}function J0e(t){const e=t;return e.path?e.path:e.composedPath?e.composedPath():Y0e(e)}function exe(t,e,i,n){const s=fg(X0e,i)?{passive:!0}:void 0;t&&t.addEventListener&&t.addEventListener(e,i,n,s)}var kt=class{constructor(){this.destroyFunctions=[],this.destroyed=!1,this.__v_skip=!0,this.propertyListenerId=0,this.lastChangeSetIdLookup={},this.isAlive=()=>!this.destroyed}preWireBeans(t){this.frameworkOverrides=t.frameworkOverrides,this.stubContext=t.context,this.eventService=t.eventService,this.gos=t.gos,this.localeService=t.localeService}getFrameworkOverrides(){return this.frameworkOverrides}destroy(){for(let t=0;t<this.destroyFunctions.length;t++)this.destroyFunctions[t]();this.destroyFunctions.length=0,this.destroyed=!0,this.dispatchLocalEvent({type:"destroyed"})}addEventListener(t,e,i){this.localEventService||(this.localEventService=new tx),this.localEventService.addEventListener(t,e,i)}removeEventListener(t,e,i){this.localEventService&&this.localEventService.removeEventListener(t,e,i)}dispatchLocalEvent(t){this.localEventService&&this.localEventService.dispatchEvent(t)}addManagedElementListeners(t,e){return this._setupListeners(t,e)}addManagedEventListeners(t){return this._setupListeners(this.eventService,t)}addManagedListeners(t,e){return this._setupListeners(t,e)}_setupListeners(t,e){const i=[];for(const n in e){const r=e[n];r&&i.push(this._setupListener(t,n,r))}return i}_setupListener(t,e,i){if(this.destroyed)return()=>null;t instanceof HTMLElement?exe(this.getFrameworkOverrides(),t,e,i):t.addEventListener(e,i);const n=()=>(t.removeEventListener(e,i),null);return this.destroyFunctions.push(n),()=>(n(),this.destroyFunctions=this.destroyFunctions.filter(r=>r!==n),null)}setupGridOptionListener(t,e){this.gos.addPropertyEventListener(t,e);const i=()=>(this.gos.removePropertyEventListener(t,e),null);return this.destroyFunctions.push(i),()=>(i(),this.destroyFunctions=this.destroyFunctions.filter(n=>n!==i),null)}addManagedPropertyListener(t,e){return this.destroyed?()=>null:this.setupGridOptionListener(t,e)}addManagedPropertyListeners(t,e){if(this.destroyed)return;const i=t.join("-")+this.propertyListenerId++,n=r=>{if(r.changeSet){if(r.changeSet&&r.changeSet.id===this.lastChangeSetIdLookup[i])return;this.lastChangeSetIdLookup[i]=r.changeSet.id}const s={type:"gridPropertyChanged",changeSet:r.changeSet,source:r.source};e(s)};t.forEach(r=>this.setupGridOptionListener(r,n))}addDestroyFunc(t){this.isAlive()?this.destroyFunctions.push(t):t()}createManagedBean(t,e){const i=this.createBean(t,e);return this.addDestroyFunc(this.destroyBean.bind(this,t,e)),i}createBean(t,e,i){return(e||this.stubContext).createBean(t,i)}destroyBean(t,e){return(e||this.stubContext).destroyBean(t)}destroyBeans(t,e){return(e||this.stubContext).destroyBeans(t)}};function Aa(t){return t instanceof MM}var MM=class extends kt{constructor(t,e,i,n){super(),this.isColumn=!1,this.expandable=!1,this.instanceId=bY(),this.expandableListenerRemoveCallback=null,this.colGroupDef=t,this.groupId=e,this.expanded=!!t&&!!t.openByDefault,this.padding=i,this.level=n}destroy(){this.expandableListenerRemoveCallback&&this.reset(null,void 0),super.destroy()}reset(t,e){this.colGroupDef=t,this.level=e,this.originalParent=null,this.expandableListenerRemoveCallback&&this.expandableListenerRemoveCallback(),this.children=void 0,this.expandable=void 0}getInstanceId(){return this.instanceId}setOriginalParent(t){this.originalParent=t}getOriginalParent(){return this.originalParent}getLevel(){return this.level}isVisible(){return this.children?this.children.some(t=>t.isVisible()):!1}isPadding(){return this.padding}setExpanded(t){this.expanded=t===void 0?!1:t,this.dispatchLocalEvent({type:"expandedChanged"})}isExpandable(){return this.expandable}isExpanded(){return this.expanded}getGroupId(){return this.groupId}getId(){return this.getGroupId()}setChildren(t){this.children=t}getChildren(){return this.children}getColGroupDef(){return this.colGroupDef}getLeafColumns(){const t=[];return this.addLeafColumns(t),t}addLeafColumns(t){this.children&&this.children.forEach(e=>{Tp(e)?t.push(e):Aa(e)&&e.addLeafColumns(t)})}getColumnGroupShow(){const t=this.colGroupDef;if(t)return t.columnGroupShow}setupExpandable(){this.setExpandable(),this.expandableListenerRemoveCallback&&this.expandableListenerRemoveCallback();const t=this.onColumnVisibilityChanged.bind(this);this.getLeafColumns().forEach(e=>e.addEventListener("visibleChanged",t)),this.expandableListenerRemoveCallback=()=>{this.getLeafColumns().forEach(e=>e.removeEventListener("visibleChanged",t)),this.expandableListenerRemoveCallback=null}}setExpandable(){if(this.isPadding())return;let t=!1,e=!1,i=!1;const n=this.findChildrenRemovingPadding();for(let s=0,o=n.length;s<o;s++){const a=n[s];if(!a.isVisible())continue;const l=a.getColumnGroupShow();l==="open"?(t=!0,i=!0):l==="closed"?(e=!0,i=!0):(t=!0,e=!0)}const r=t&&e&&i;this.expandable!==r&&(this.expandable=r,this.dispatchLocalEvent({type:"expandableChanged"}))}findChildrenRemovingPadding(){const t=[],e=i=>{i.forEach(n=>{Aa(n)&&n.isPadding()?e(n.children):t.push(n)})};return e(this.children),t}onColumnVisibilityChanged(){this.setExpandable()}},yY="ag-Grid-ControlsColumn",txe=class extends kt{constructor(){super(...arguments),this.beanName="controlsColService"}createControlsCols(){const{gos:t}=this,e=t.get("rowSelection");if(!e||typeof e!="object")return[];const i=C0(e),n=CT(e);if(i||n){const r=t.get("selectionColumnDef"),o={maxWidth:50,resizable:!1,suppressHeaderMenuButton:!0,sortable:!1,suppressMovable:!0,lockPosition:t.get("enableRtl")?"right":"left",comparator(l,u,d,p){const v=d.isSelected(),y=p.isSelected();return v&&y?0:v?1:-1},editable:!1,suppressFillHandle:!0,...r,colId:`${yY}`},a=new sU(o,null,o.colId,!1);return this.createBean(a),[a]}return[]}},xP="ag-Grid-AutoColumn";function iU(t){const e=[],i=n=>{for(let r=0;r<n.length;r++){const s=n[r];Tp(s)?e.push(s):Aa(s)&&i(s.getChildren())}};return i(t),e}function yd(t){return t.reduce((e,i)=>e+i.getActualWidth(),0)}function Zf(t,e,i){const n={};if(!e)return;Wd(null,e,s=>{n[s.getInstanceId()]=s}),i&&Wd(null,i,s=>{n[s.getInstanceId()]=null});const r=Object.values(n).filter(s=>s!=null);t.destroyBeans(r)}function gz(t){return t.getId().startsWith(xP)}function NC(t){return t.getColId().startsWith(yY)}function TM(t){let e=[];return t instanceof Array?t.some(n=>typeof n!="string")?Wt("if colDef.type is supplied an array it should be of type 'string[]'"):e=t:typeof t=="string"?e=t.split(","):Wt("colDef.type should be of type 'string' | 'string[]'"),e}var nU=class{constructor(t){this.frameworkOverrides=t,this.wrappedListeners=new Map,this.wrappedGlobalListeners=new Map}wrap(t){let e=t;return this.frameworkOverrides.shouldWrapOutgoing&&(e=i=>{this.frameworkOverrides.wrapOutgoing(()=>t(i))},this.wrappedListeners.set(t,e)),e}wrapGlobal(t){let e=t;return this.frameworkOverrides.shouldWrapOutgoing&&(e=(i,n)=>{this.frameworkOverrides.wrapOutgoing(()=>t(i,n))},this.wrappedGlobalListeners.set(t,e)),e}unwrap(t){return this.wrappedListeners.get(t)??t}unwrapGlobal(t){return this.wrappedGlobalListeners.get(t)??t}},rU=new Set(["__proto__","constructor","prototype"]);function gu(t,e){if(t!=null){if(Array.isArray(t)){for(let i=0;i<t.length;i++)e(i.toString(),t[i]);return}for(const[i,n]of Object.entries(t))e(i,n)}}function xY(t){const e={},i=Object.keys(t);for(let n=0;n<i.length;n++){if(rU.has(i[n]))continue;const r=i[n],s=t[r];e[r]=s}return e}function vz(t,e){if(!t)return;const i=t,n={};return Object.keys(i).forEach(r=>{if(e&&e.indexOf(r)>=0||rU.has(r))return;const s=i[r];yz(s)&&s.constructor===Object?n[r]=vz(s):n[r]=s}),n}function Fg(t){if(!t)return[];const e=Object;if(typeof e.values=="function")return e.values(t);const i=[];for(const n in t)t.hasOwnProperty(n)&&t.propertyIsEnumerable(n)&&i.push(t[n]);return i}function ka(t,e,i=!0,n=!1){oi(e)&&gu(e,(r,s)=>{if(rU.has(r))return;let o=t[r];o!==s&&(n&&o==null&&s!=null&&typeof s=="object"&&s.constructor===Object&&(o={},t[r]=o),yz(s)&&yz(o)&&!Array.isArray(o)?ka(o,s,i,n):(i||s!==void 0)&&(t[r]=s))})}function qw(t,e,i){if(!e||!t)return;if(!i)return t[e];const n=e.split(".");let r=t;for(let s=0;s<n.length;s++){if(r==null)return;r=r[n[s]]}return r}function yz(t){return typeof t=="object"&&t!==null}var ixe={resizable:!0,sortable:!0},nxe=0;function bY(){return nxe++}function Tp(t){return t instanceof sU}var sU=class extends kt{constructor(t,e,i,n){super(),this.isColumn=!0,this.instanceId=bY(),this.autoHeaderHeight=null,this.moving=!1,this.menuVisible=!1,this.lastLeftPinned=!1,this.firstRightPinned=!1,this.filterActive=!1,this.columnEventService=new tx,this.tooltipEnabled=!1,this.rowGroupActive=!1,this.pivotActive=!1,this.aggregationActive=!1,this.colDef=t,this.userProvidedColDef=e,this.colId=i,this.primary=n,this.setState(t)}wireBeans(t){this.columnHoverService=t.columnHoverService}getInstanceId(){return this.instanceId}setState(t){t.sort!==void 0?(t.sort==="asc"||t.sort==="desc")&&(this.sort=t.sort):(t.initialSort==="asc"||t.initialSort==="desc")&&(this.sort=t.initialSort);const e=t.sortIndex,i=t.initialSortIndex;e!==void 0?e!==null&&(this.sortIndex=e):i!==null&&(this.sortIndex=i);const n=t.hide,r=t.initialHide;n!==void 0?this.visible=!n:this.visible=!r,t.pinned!==void 0?this.setPinned(t.pinned):this.setPinned(t.initialPinned);const s=t.flex,o=t.initialFlex;s!==void 0?this.flex=s:o!==void 0&&(this.flex=o)}setColDef(t,e,i){this.colDef=t,this.userProvidedColDef=e,this.initMinAndMaxWidths(),this.initDotNotation(),this.initTooltip(),this.columnEventService.dispatchEvent(this.createColumnEvent("colDefChanged",i))}getUserProvidedColDef(){return this.userProvidedColDef}setParent(t){this.parent=t}getParent(){return this.parent}setOriginalParent(t){this.originalParent=t}getOriginalParent(){return this.originalParent}postConstruct(){this.initMinAndMaxWidths(),this.resetActualWidth("gridInitializing"),this.initDotNotation(),this.initTooltip()}initDotNotation(){const t=this.gos.get("suppressFieldDotNotation");this.fieldContainsDots=oi(this.colDef.field)&&this.colDef.field.indexOf(".")>=0&&!t,this.tooltipFieldContainsDots=oi(this.colDef.tooltipField)&&this.colDef.tooltipField.indexOf(".")>=0&&!t}initMinAndMaxWidths(){const t=this.colDef;this.minWidth=t.minWidth??this.gos.environment.getDefaultColumnMinWidth(),this.maxWidth=t.maxWidth??Number.MAX_SAFE_INTEGER}initTooltip(){this.tooltipEnabled=oi(this.colDef.tooltipField)||oi(this.colDef.tooltipValueGetter)||oi(this.colDef.tooltipComponent)}resetActualWidth(t){const e=this.calculateColInitialWidth(this.colDef);this.setActualWidth(e,t,!0)}calculateColInitialWidth(t){let e;const i=hg(t.width),n=hg(t.initialWidth);return i!=null?e=i:n!=null?e=n:e=200,Math.max(Math.min(e,this.maxWidth),this.minWidth)}isEmptyGroup(){return!1}isRowGroupDisplayed(t){if(Wn(this.colDef)||Wn(this.colDef.showRowGroup))return!1;const e=this.colDef.showRowGroup===!0,i=this.colDef.showRowGroup===t;return e||i}isPrimary(){return this.primary}isFilterAllowed(){return!!this.colDef.filter}isFieldContainsDots(){return this.fieldContainsDots}isTooltipEnabled(){return this.tooltipEnabled}isTooltipFieldContainsDots(){return this.tooltipFieldContainsDots}getHighlighted(){return this.highlighted}addEventListener(t,e){this.frameworkOverrides.shouldWrapOutgoing&&!this.frameworkEventListenerService&&(this.columnEventService.setFrameworkOverrides(this.frameworkOverrides),this.frameworkEventListenerService=new nU(this.frameworkOverrides));const i=this.frameworkEventListenerService?.wrap(e)??e;this.columnEventService.addEventListener(t,i)}removeEventListener(t,e){const i=this.frameworkEventListenerService?.unwrap(e)??e;this.columnEventService.removeEventListener(t,i)}createColumnFunctionCallbackParams(t){return this.gos.addGridCommonParams({node:t,data:t.data,column:this,colDef:this.colDef})}isSuppressNavigable(t){if(typeof this.colDef.suppressNavigable=="boolean")return this.colDef.suppressNavigable;if(typeof this.colDef.suppressNavigable=="function"){const e=this.createColumnFunctionCallbackParams(t),i=this.colDef.suppressNavigable;return i(e)}return!1}isCellEditable(t){if(t.group){if(this.gos.get("treeData")){if(!t.data&&!this.gos.get("enableGroupEdit"))return!1}else if(!this.gos.get("enableGroupEdit"))return!1}return this.isColumnFunc(t,this.colDef.editable)}isSuppressFillHandle(){return!!this.colDef.suppressFillHandle}isAutoHeight(){return!!this.colDef.autoHeight}isAutoHeaderHeight(){return!!this.colDef.autoHeaderHeight}isRowDrag(t){return this.isColumnFunc(t,this.colDef.rowDrag)}isDndSource(t){return this.isColumnFunc(t,this.colDef.dndSource)}isCellCheckboxSelection(t){const e=this.gos.get("rowSelection");if(e&&typeof e!="string"){const i=NC(this)&&C0(e);return this.isColumnFunc(t,i)}else return this.isColumnFunc(t,this.colDef.checkboxSelection)}isSuppressPaste(t){return this.isColumnFunc(t,this.colDef?this.colDef.suppressPaste:null)}isResizable(){return!!this.getColDefValue("resizable")}getColDefValue(t){return this.colDef[t]??ixe[t]}isColumnFunc(t,e){if(typeof e=="boolean")return e;if(typeof e=="function"){const i=this.createColumnFunctionCallbackParams(t);return e(i)}return!1}setHighlighted(t){this.highlighted!==t&&(this.highlighted=t,this.columnEventService.dispatchEvent(this.createColumnEvent("headerHighlightChanged","uiColumnMoved")))}setMoving(t,e){this.moving=t,this.columnEventService.dispatchEvent(this.createColumnEvent("movingChanged",e))}createColumnEvent(t,e){return this.gos.addGridCommonParams({type:t,column:this,columns:[this],source:e})}isMoving(){return this.moving}getSort(){return this.sort}setSort(t,e){this.sort!==t&&(this.sort=t,this.columnEventService.dispatchEvent(this.createColumnEvent("sortChanged",e))),this.dispatchStateUpdatedEvent("sort")}isSortable(){return!!this.getColDefValue("sortable")}isSortAscending(){return this.sort==="asc"}isSortDescending(){return this.sort==="desc"}isSortNone(){return Wn(this.sort)}isSorting(){return oi(this.sort)}getSortIndex(){return this.sortIndex}setSortIndex(t){this.sortIndex=t,this.dispatchStateUpdatedEvent("sortIndex")}setMenuVisible(t,e){this.menuVisible!==t&&(this.menuVisible=t,this.columnEventService.dispatchEvent(this.createColumnEvent("menuVisibleChanged",e)))}isMenuVisible(){return this.menuVisible}setAggFunc(t){this.aggFunc=t,this.dispatchStateUpdatedEvent("aggFunc")}getAggFunc(){return this.aggFunc}getLeft(){return this.left}getOldLeft(){return this.oldLeft}getRight(){return this.left+this.actualWidth}setLeft(t,e){this.oldLeft=this.left,this.left!==t&&(this.left=t,this.columnEventService.dispatchEvent(this.createColumnEvent("leftChanged",e)))}isFilterActive(){return this.filterActive}setFilterActive(t,e,i){this.filterActive!==t&&(this.filterActive=t,this.columnEventService.dispatchEvent(this.createColumnEvent("filterActiveChanged",e)));const n=this.createColumnEvent("filterChanged",e);i&&ka(n,i),this.columnEventService.dispatchEvent(n)}isHovered(){return this.columnHoverService.isHovered(this)}setPinned(t){t===!0||t==="left"?this.pinned="left":t==="right"?this.pinned="right":this.pinned=null,this.dispatchStateUpdatedEvent("pinned")}setFirstRightPinned(t,e){this.firstRightPinned!==t&&(this.firstRightPinned=t,this.columnEventService.dispatchEvent(this.createColumnEvent("firstRightPinnedChanged",e)))}setLastLeftPinned(t,e){this.lastLeftPinned!==t&&(this.lastLeftPinned=t,this.columnEventService.dispatchEvent(this.createColumnEvent("lastLeftPinnedChanged",e)))}isFirstRightPinned(){return this.firstRightPinned}isLastLeftPinned(){return this.lastLeftPinned}isPinned(){return this.pinned==="left"||this.pinned==="right"}isPinnedLeft(){return this.pinned==="left"}isPinnedRight(){return this.pinned==="right"}getPinned(){return this.pinned}setVisible(t,e){const i=t===!0;this.visible!==i&&(this.visible=i,this.columnEventService.dispatchEvent(this.createColumnEvent("visibleChanged",e))),this.dispatchStateUpdatedEvent("hide")}isVisible(){return this.visible}isSpanHeaderHeight(){return!this.getColDef().suppressSpanHeaderHeight}getColumnGroupPaddingInfo(){let t=this.getParent();if(!t||!t.isPadding())return{numberOfParents:0,isSpanningTotal:!1};const e=t.getPaddingLevel()+1;let i=!0;for(;t;){if(!t.isPadding()){i=!1;break}t=t.getParent()}return{numberOfParents:e,isSpanningTotal:i}}getColDef(){return this.colDef}getDefinition(){return this.colDef}getColumnGroupShow(){return this.colDef.columnGroupShow}getColId(){return this.colId}getId(){return this.colId}getUniqueId(){return this.colId}getActualWidth(){return this.actualWidth}getAutoHeaderHeight(){return this.autoHeaderHeight}setAutoHeaderHeight(t){const e=t!==this.autoHeaderHeight;return this.autoHeaderHeight=t,e}createBaseColDefParams(t){return this.gos.addGridCommonParams({node:t,data:t.data,colDef:this.colDef,column:this})}getColSpan(t){if(Wn(this.colDef.colSpan))return 1;const e=this.createBaseColDefParams(t),i=this.colDef.colSpan(e);return Math.max(i,1)}getRowSpan(t){if(Wn(this.colDef.rowSpan))return 1;const e=this.createBaseColDefParams(t),i=this.colDef.rowSpan(e);return Math.max(i,1)}setActualWidth(t,e,i=!1){t=Math.max(t,this.minWidth),t=Math.min(t,this.maxWidth),this.actualWidth!==t&&(this.actualWidth=t,this.flex&&e!=="flex"&&e!=="gridInitializing"&&(this.flex=null),i||this.fireColumnWidthChangedEvent(e)),this.dispatchStateUpdatedEvent("width")}fireColumnWidthChangedEvent(t){this.columnEventService.dispatchEvent(this.createColumnEvent("widthChanged",t))}isGreaterThanMax(t){return t>this.maxWidth}getMinWidth(){return this.minWidth}getMaxWidth(){return this.maxWidth}getFlex(){return this.flex||0}setFlex(t){this.flex!==t&&(this.flex=t),this.dispatchStateUpdatedEvent("flex")}setMinimum(t){this.setActualWidth(this.minWidth,t)}setRowGroupActive(t,e){this.rowGroupActive!==t&&(this.rowGroupActive=t,this.columnEventService.dispatchEvent(this.createColumnEvent("columnRowGroupChanged",e))),this.dispatchStateUpdatedEvent("rowGroup")}isRowGroupActive(){return this.rowGroupActive}setPivotActive(t,e){this.pivotActive!==t&&(this.pivotActive=t,this.columnEventService.dispatchEvent(this.createColumnEvent("columnPivotChanged",e))),this.dispatchStateUpdatedEvent("pivot")}isPivotActive(){return this.pivotActive}isAnyFunctionActive(){return this.isPivotActive()||this.isRowGroupActive()||this.isValueActive()}isAnyFunctionAllowed(){return this.isAllowPivot()||this.isAllowRowGroup()||this.isAllowValue()}setValueActive(t,e){this.aggregationActive!==t&&(this.aggregationActive=t,this.columnEventService.dispatchEvent(this.createColumnEvent("columnValueChanged",e)))}isValueActive(){return this.aggregationActive}isAllowPivot(){return this.colDef.enablePivot===!0}isAllowValue(){return this.colDef.enableValue===!0}isAllowRowGroup(){return this.colDef.enableRowGroup===!0}dispatchStateUpdatedEvent(t){this.columnEventService.dispatchEvent({type:"columnStateUpdated",key:t})}},rxe={numericColumn:{headerClass:"ag-right-aligned-header",cellClass:"ag-right-aligned-cell"},rightAligned:{headerClass:"ag-right-aligned-header",cellClass:"ag-right-aligned-cell"}},sxe=class{constructor(){this.existingKeys={}}addExistingKeys(t){for(let e=0;e<t.length;e++)this.existingKeys[t[e]]=!0}getUniqueKey(t,e){t=uz(t);let i=0;for(;;){let n;if(t?(n=t,i!==0&&(n+="_"+i)):e?(n=e,i!==0&&(n+="_"+i)):n=i,!this.existingKeys[n])return this.existingKeys[n]=!0,String(n);i++}}},oxe=class extends kt{constructor(){super(...arguments),this.beanName="columnFactory"}wireBeans(t){this.dataTypeService=t.dataTypeService}createColumnTree(t,e,i,n){const r=new sxe,{existingCols:s,existingGroups:o,existingColKeys:a}=this.extractExistingTreeData(i);r.addExistingKeys(a);const l=this.recursivelyCreateColumns(t,0,e,s,r,o,n),u=this.findMaxDept(l,0),d=this.balanceColumnTree(l,0,u,r);return Wd(null,d,(v,y)=>{Aa(v)&&v.setupExpandable(),v.setOriginalParent(y)}),{columnTree:d,treeDept:u}}extractExistingTreeData(t){const e=[],i=[],n=[];return t&&Wd(null,t,r=>{if(Aa(r)){const s=r;i.push(s)}else{const s=r;n.push(s.getId()),e.push(s)}}),{existingCols:e,existingGroups:i,existingColKeys:n}}balanceTreeForAutoCols(t,e){const i=[],n=this.findDepth(e);return t.forEach(r=>{let s=r;for(let o=n-1;o>=0;o--){const a=new MM(null,`FAKE_PATH_${r.getId()}}_${o}`,!0,o);this.createBean(a),a.setChildren([s]),s.setOriginalParent(a),s=a}n===0&&r.setOriginalParent(null),i.push(s)}),[i,n]}findDepth(t){let e=0,i=t;for(;i&&i[0]&&Aa(i[0]);)e++,i=i[0].getChildren();return e}balanceColumnTree(t,e,i,n){const r=[];for(let s=0;s<t.length;s++){const o=t[s];if(Aa(o)){const a=o,l=this.balanceColumnTree(a.getChildren(),e+1,i,n);a.setChildren(l),r.push(a)}else{let a,l;for(let u=i-1;u>=e;u--){const d=n.getUniqueKey(null,null),p=this.createMergedColGroupDef(null),v=new MM(p,d,!0,e);this.createBean(v),l&&l.setChildren([v]),l=v,a||(a=l)}if(a&&l)if(r.push(a),t.some(d=>Aa(d))){l.setChildren([o]);continue}else{l.setChildren(t);break}r.push(o)}}return r}findMaxDept(t,e){let i=e;for(let n=0;n<t.length;n++){const r=t[n];if(Aa(r)){const s=r,o=this.findMaxDept(s.getChildren(),e+1);i<o&&(i=o)}}return i}recursivelyCreateColumns(t,e,i,n,r,s,o){if(!t)return[];const a=new Array(t.length);for(let l=0;l<a.length;l++){const u=t[l];this.isColumnGroup(u)?a[l]=this.createColumnGroup(i,u,e,n,r,s,o):a[l]=this.createColumn(i,u,n,r,o)}return a}createColumnGroup(t,e,i,n,r,s,o){const a=this.createMergedColGroupDef(e),l=r.getUniqueKey(a.groupId||null,null),u=new MM(a,l,!1,i);this.createBean(u);const d=this.findExistingGroup(e,s);d&&s.splice(d.idx,1);const p=d?.group;p&&u.setExpanded(p.isExpanded());const v=this.recursivelyCreateColumns(a.children,i+1,t,n,r,s,o);return u.setChildren(v),u}createMergedColGroupDef(t){const e={};return Object.assign(e,this.gos.get("defaultColGroupDef")),Object.assign(e,t),e}createColumn(t,e,i,n,r){const s=this.findExistingColumn(e,i);s&&i?.splice(s.idx,1);let o=s?.column;if(o){const a=this.addColumnDefaultAndTypes(e,o.getColId());o.setColDef(a,e,r),this.applyColumnState(o,a,r)}else{const a=n.getUniqueKey(e.colId,e.field),l=this.addColumnDefaultAndTypes(e,a);o=new sU(l,e,a,t),this.createBean(o)}return this.dataTypeService?.addColumnListeners(o),o}applyColumnState(t,e,i){const n=hg(e.flex);if(n!==void 0&&t.setFlex(n),t.getFlex()<=0){const a=hg(e.width);if(a!=null)t.setActualWidth(a,i);else{const l=t.getActualWidth();t.setActualWidth(l,i)}}e.sort!==void 0&&(e.sort=="asc"||e.sort=="desc"?t.setSort(e.sort,i):t.setSort(void 0,i));const s=hg(e.sortIndex);s!==void 0&&t.setSortIndex(s);const o=hz(e.hide);o!==void 0&&t.setVisible(!o,i),e.pinned!==void 0&&t.setPinned(e.pinned)}findExistingColumn(t,e){if(e)for(let i=0;i<e.length;i++){const n=e[i].getUserProvidedColDef();if(!n)continue;if(t.colId!=null){if(e[i].getId()===t.colId)return{idx:i,column:e[i]};continue}if(t.field!=null){if(n.field===t.field)return{idx:i,column:e[i]};continue}if(n===t)return{idx:i,column:e[i]}}}findExistingGroup(t,e){if(t.groupId!=null)for(let n=0;n<e.length;n++){const r=e[n];if(r.getColGroupDef()&&r.getId()===t.groupId)return{idx:n,group:r}}}addColumnDefaultAndTypes(t,e){const i={},n=this.gos.get("defaultColDef");ka(i,n,!1,!0);const r=this.updateColDefAndGetColumnType(i,t,e);r&&this.assignColumnTypes(r,i),ka(i,t,!1,!0);const s=this.gos.get("autoGroupColumnDef"),o=ah(this.gos);return t.rowGroup&&s&&o&&ka(i,{sort:s.sort,initialSort:s.initialSort},!1,!0),this.dataTypeService?.validateColDef(i),i}updateColDefAndGetColumnType(t,e,i){const n=this.dataTypeService?.updateColDefAndGetColumnType(t,e,i),r=e.type??n??t.type;return t.type=r,r?TM(r):void 0}assignColumnTypes(t,e){if(!t.length)return;const i=Object.assign({},rxe),n=this.gos.get("columnTypes")||{};gu(n,(r,s)=>{r in i?Wt(`the column type '${r}' is a default column type and cannot be overridden.`):(s.type&&Wt("Column type definitions 'columnTypes' with a 'type' attribute are not supported because a column type cannot refer to another column type. Only column definitions 'columnDefs' can use the 'type' attribute to refer to a column type."),i[r]=s)}),t.forEach(r=>{const s=i[r.trim()];s?ka(e,s,!1,!0):Wt("colDef.type '"+r+"' does not correspond to defined gridOptions.columnTypes")})}isColumnGroup(t){return t.children!==void 0}};function Wd(t,e,i){if(e)for(let n=0;n<e.length;n++){const r=e[n];Aa(r)&&Wd(r,r.getChildren(),i),i(r,t)}}var axe=class extends kt{constructor(){super(...arguments),this.beanName="columnModel",this.pivotMode=!1,this.autoHeightActiveAtLeastOnce=!1,this.ready=!1,this.changeEventsDispatching=!1,this.shouldQueueResizeOperations=!1,this.resizeOperationQueue=[]}wireBeans(t){this.context=t.context,this.ctrlsService=t.ctrlsService,this.columnFactory=t.columnFactory,this.columnSizeService=t.columnSizeService,this.visibleColsService=t.visibleColsService,this.columnViewportService=t.columnViewportService,this.pivotResultColsService=t.pivotResultColsService,this.columnAnimationService=t.columnAnimationService,this.autoColService=t.autoColService,this.controlsColService=t.controlsColService,this.valueCache=t.valueCache,this.columnDefFactory=t.columnDefFactory,this.columnApplyStateService=t.columnApplyStateService,this.columnGroupStateService=t.columnGroupStateService,this.eventDispatcher=t.columnEventDispatcher,this.columnMoveService=t.columnMoveService,this.columnAutosizeService=t.columnAutosizeService,this.funcColsService=t.funcColsService,this.quickFilterService=t.quickFilterService,this.showRowGroupColsService=t.showRowGroupColsService,this.environment=t.environment}postConstruct(){const t=this.gos.get("pivotMode");this.isPivotSettingAllowed(t)&&(this.pivotMode=t),this.addManagedPropertyListeners(["groupDisplayType","treeData","treeDataDisplayType","groupHideOpenParents"],e=>this.refreshAll(Wm(e.source))),this.addManagedPropertyListener("rowSelection",e=>{this.onSelectionOptionsChanged(e.currentValue,e.previousValue,Wm(e.source))}),this.addManagedPropertyListener("autoGroupColumnDef",e=>this.onAutoGroupColumnDefChanged(Wm(e.source))),this.addManagedPropertyListeners(["defaultColDef","defaultColGroupDef","columnTypes","suppressFieldDotNotation"],e=>this.recreateColumnDefs(Wm(e.source))),this.addManagedPropertyListener("pivotMode",e=>this.setPivotMode(this.gos.get("pivotMode"),Wm(e.source))),this.addManagedEventListeners({firstDataRendered:()=>this.onFirstDataRendered()})}createColsFromColDefs(t){const e=this.colDefs?this.columnApplyStateService.compareColumnStatesAndDispatchEvents(t):void 0;this.valueCache.expire();const i=this.colDefCols?.list,n=this.colDefCols?.tree,r=this.columnFactory.createColumnTree(this.colDefs,!0,n,t);Zf(this.context,this.colDefCols?.tree,r.columnTree);const s=r.columnTree,o=r.treeDept,a=iU(s),l={};a.forEach(u=>l[u.getId()]=u),this.colDefCols={tree:s,treeDepth:o,list:a,map:l},this.funcColsService.extractCols(t,i),this.ready=!0,this.refreshCols(!0),this.visibleColsService.refresh(t),this.columnViewportService.checkViewportColumns(),this.eventDispatcher.everythingChanged(t),e&&(this.changeEventsDispatching=!0,e(),this.changeEventsDispatching=!1),this.eventDispatcher.newColumnsLoaded(t),t==="gridInitializing"&&this.columnSizeService.applyAutosizeStrategy()}refreshCols(t){if(!this.colDefCols)return;const e=this.cols?.tree;this.saveColOrder(),this.selectCols(),this.createAutoCols(),this.addAutoCols(),this.createControlsCols(),this.addControlsCols();const i=N0e(this.gos,this.showingPivotResult);(!t||i)&&this.restoreColOrder(),this.positionLockedCols(),this.showRowGroupColsService?.refresh(),this.quickFilterService?.refreshQuickFilterCols(),this.setColSpanActive(),this.setAutoHeightActive(),this.visibleColsService.clear(),this.columnViewportService.clear(),!Fp(e,this.cols.tree)&&this.eventDispatcher.gridColumns()}selectCols(){const t=this.pivotResultColsService.getPivotResultCols();if(this.showingPivotResult=t!=null,t){const{map:e,list:i,tree:n,treeDepth:r}=t;this.cols={list:i.slice(),map:{...e},tree:n.slice(),treeDepth:r},t.list.some(o=>this.cols?.map[o.getColId()]!==void 0)||(this.lastPivotOrder=null)}else{const{map:e,list:i,tree:n,treeDepth:r}=this.colDefCols;this.cols={list:i.slice(),map:{...e},tree:n.slice(),treeDepth:r}}}getColsToShow(){const t=this.isPivotMode()&&!this.isShowingPivotResult(),e=this.funcColsService.getValueColumns();return this.cols.list.filter(n=>{const r=gz(n);if(t){const s=e&&fg(e,n);return r||s}else return r||n.isVisible()})}addAutoCols(){this.autoCols!=null&&(this.cols.list=this.autoCols.list.concat(this.cols.list),this.cols.tree=this.autoCols.tree.concat(this.cols.tree),n6(this.cols))}createAutoCols(){const t=yP(this.gos,this.pivotMode),e=this.pivotMode?this.gos.get("pivotSuppressAutoColumn"):this.isSuppressAutoCol(),i=this.funcColsService.getRowGroupColumns(),r=!(i.length>0||this.gos.get("treeData"))||e||t,s=()=>{this.autoCols&&(Zf(this.context,this.autoCols.tree),this.autoCols=null)};if(r||!this.autoColService){s();return}const o=this.autoColService.createAutoCols(i)??[],a=s6(o,this.autoCols?.list||null),l=this.cols.treeDepth,d=(this.autoCols?this.autoCols.treeDepth:-1)==l;if(a&&d)return;s();const[p,v]=this.columnFactory.balanceTreeForAutoCols(o,this.cols.tree);this.autoCols={list:o,tree:p,treeDepth:v,map:{}};const y=w=>{if(!w)return null;const R=w.filter(O=>!gz(O));return[...o,...R]};this.lastOrder=y(this.lastOrder),this.lastPivotOrder=y(this.lastPivotOrder)}createControlsCols(){const t=()=>{Zf(this.context,this.controlsCols?.tree),this.controlsCols=null};this.controlsColService||t();const e=this.cols.treeDepth,n=(this.controlsCols?.treeDepth??-1)==e,r=this.controlsColService?.createControlsCols()??[];if(s6(r,this.controlsCols?.list??[])&&n)return;t();const[o,a]=this.columnFactory.balanceTreeForAutoCols(r,this.cols.tree);this.controlsCols={list:r,tree:o,treeDepth:a,map:{}};const l=u=>{if(!u)return null;const d=u.filter(p=>!NC(p));return[...r,...d]};this.lastOrder=l(this.lastOrder),this.lastPivotOrder=l(this.lastPivotOrder)}addControlsCols(){this.controlsCols!=null&&(this.cols.list=this.controlsCols.list.concat(this.cols.list),this.cols.tree=this.controlsCols.tree.concat(this.cols.tree),n6(this.cols))}refreshAll(t){this.isReady()&&(this.refreshCols(!1),this.visibleColsService.refresh(t))}setColsVisible(t,e=!1,i){this.columnApplyStateService.applyColumnState({state:t.map(n=>({colId:typeof n=="string"?n:n.getColId(),hide:!e}))},i)}setColsPinned(t,e,i){if(!this.cols||Kl(t))return;if(Zo(this.gos,"print")){Wt("Changing the column pinning status is not allowed with domLayout='print'");return}this.columnAnimationService.start();let n;e===!0||e==="left"?n="left":e==="right"?n="right":n=null;const r=[];t.forEach(s=>{if(!s)return;const o=this.getCol(s);o&&o.getPinned()!==n&&(o.setPinned(n),r.push(o))}),r.length&&(this.visibleColsService.refresh(i),this.eventDispatcher.columnPinned(r,i)),this.columnAnimationService.finish()}setColumnGroupOpened(t,e,i){let n;Aa(t)?n=t.getId():n=t||"",this.columnGroupStateService.setColumnGroupState([{groupId:n,open:e}],i)}getProvidedColGroup(t){let e=null;return Wd(null,this.cols?.tree,i=>{Aa(i)&&i.getId()===t&&(e=i)}),e}isColGroupLocked(t){const e=this.gos.get("groupLockGroupColumns");if(!t.isRowGroupActive()||e===0)return!1;if(e===-1)return!0;const n=this.funcColsService.getRowGroupColumns().findIndex(r=>r.getColId()===t.getColId());return e>n}isSuppressAutoCol(){return this.gos.get("groupDisplayType")==="custom"?!0:this.gos.get("treeDataDisplayType")==="custom"}setAutoHeightActive(){this.autoHeightActive=this.cols.list.some(t=>t.isVisible()&&t.isAutoHeight()),this.autoHeightActive&&(this.autoHeightActiveAtLeastOnce=!0,ls(this.gos)||tf(this.gos)||Wt("autoHeight columns only work with Client Side Row Model and Server Side Row Model."))}restoreColOrder(){const t=this.showingPivotResult?this.lastPivotOrder:this.lastOrder;if(!t)return;const e=new Map(t.map((l,u)=>[l,u]));if(!this.cols.list.some(l=>e.has(l)))return;const n=new Map(this.cols.list.map(l=>[l,!0])),r=t.filter(l=>n.has(l)),s=new Map(r.map(l=>[l,!0])),o=this.cols.list.filter(l=>!s.has(l)),a=r.slice();o.forEach(l=>{let u=l.getOriginalParent();if(!u){a.push(l);return}const d=[];for(;!d.length&&u;)u.getLeafColumns().forEach(w=>{const R=a.indexOf(w)>=0,O=d.indexOf(w)<0;R&&O&&d.push(w)}),u=u.getOriginalParent();if(!d.length){a.push(l);return}const p=d.map(y=>a.indexOf(y)),v=Math.max(...p);OT(a,l,v+1)}),this.cols.list=a}sortColsLikeKeys(t){if(this.cols==null)return;let e=[];const i={};t.forEach(r=>{if(i[r])return;const s=this.cols.map[r];s&&(e.push(s),i[r]=!0)});let n=0;if(this.cols.list.forEach(r=>{const s=r.getColId();if(i[s]!=null)return;s.startsWith(xP)?OT(e,r,n++):e.push(r)}),e=this.columnMoveService.placeLockedColumns(e),!this.columnMoveService.doesMovePassMarryChildren(e)){Wt("Applying column order broke a group where columns should be married together. Applying new order has been discarded.");return}this.cols.list=e}sortColsLikeCols(t){!t||t.length<=1||t.filter(i=>this.cols.list.indexOf(i)<0).length>0||t.sort((i,n)=>{const r=this.cols.list.indexOf(i),s=this.cols.list.indexOf(n);return r-s})}resetColDefIntoCol(t,e){const i=t.getUserProvidedColDef();if(!i)return!1;const n=this.columnFactory.addColumnDefaultAndTypes(i,t.getColId());return t.setColDef(n,i,e),!0}queueResizeOperations(){this.shouldQueueResizeOperations=!0}isShouldQueueResizeOperations(){return this.shouldQueueResizeOperations}processResizeOperations(){this.shouldQueueResizeOperations=!1,this.resizeOperationQueue.forEach(t=>t()),this.resizeOperationQueue=[]}pushResizeOperation(t){this.resizeOperationQueue.push(t)}moveInCols(t,e,i){mY(this.cols?.list,t,e),this.visibleColsService.refresh(i)}positionLockedCols(){this.cols.list=this.columnMoveService.placeLockedColumns(this.cols.list)}saveColOrder(){this.showingPivotResult?this.lastPivotOrder=this.cols?.list:this.lastOrder=this.cols?.list}getColumnDefs(){if(!this.colDefCols)return;const t=this.colDefCols.list.slice();this.showingPivotResult?t.sort((n,r)=>this.lastOrder.indexOf(n)-this.lastOrder.indexOf(r)):this.lastOrder&&t.sort((n,r)=>this.cols.list.indexOf(n)-this.cols.list.indexOf(r));const e=this.funcColsService.getRowGroupColumns(),i=this.funcColsService.getPivotColumns();return this.columnDefFactory.buildColumnDefs(t,e,i)}isShowingPivotResult(){return this.showingPivotResult}isChangeEventsDispatching(){return this.changeEventsDispatching}isColSpanActive(){return this.colSpanActive}isProvidedColGroupsPresent(){return this.colDefCols?.treeDepth>0}setColSpanActive(){this.colSpanActive=this.cols.list.some(t=>t.getColDef().colSpan!=null)}isAutoRowHeightActive(){return this.autoHeightActive}wasAutoRowHeightEverActive(){return this.autoHeightActiveAtLeastOnce}getHeaderRowCount(){return this.cols?this.cols.treeDepth+1:-1}isReady(){return this.ready}isPivotMode(){return this.pivotMode}setPivotMode(t,e){t===this.pivotMode||!this.isPivotSettingAllowed(this.pivotMode)||(this.pivotMode=t,this.ready&&(this.refreshCols(!1),this.visibleColsService.refresh(e),this.eventDispatcher.pivotModeChanged()))}isPivotSettingAllowed(t){return t&&this.gos.get("treeData")?(Wt("Pivot mode not available with treeData."),!1):!0}isPivotActive(){const t=this.funcColsService.getPivotColumns();return this.pivotMode&&!Kl(t)}recreateColumnDefs(t){this.cols&&(this.autoCols&&this.autoColService.updateAutoCols(this.autoCols.list,t),this.createColsFromColDefs(t))}setColumnDefs(t,e){this.colDefs=t,this.createColsFromColDefs(e)}destroy(){Zf(this.context,this.colDefCols?.tree),Zf(this.context,this.autoCols?.tree),Zf(this.context,this.controlsCols?.tree),super.destroy()}getColTree(){return this.cols.tree}getColDefColTree(){return this.colDefCols.tree}getColDefCols(){return this.colDefCols?.list?this.colDefCols.list:null}getCols(){return this.cols?.list??[]}getAllCols(){const e=this.pivotResultColsService.getPivotResultCols()?.list;return[this.colDefCols?.list??[],this.autoCols?.list??[],this.controlsCols?.list??[],e??[]].flat()}getColsForKeys(t){return t?t.map(e=>this.getCol(e)).filter(e=>e!=null):[]}getColDefCol(t){return this.colDefCols?.list?this.getColFromCollection(t,this.colDefCols):null}getCol(t){return t==null?null:this.getColFromCollection(t,this.cols)}getColFromCollection(t,e){if(e==null)return null;const{map:i,list:n}=e;if(typeof t=="string"&&i[t])return i[t];for(let r=0;r<n.length;r++)if(r6(n[r],t))return n[r];return this.getAutoCol(t)}getAutoCol(t){return this.autoCols?.list.find(e=>r6(e,t))??null}getAutoCols(){return this.autoCols?.list??null}setColHeaderHeight(t,e){t.setAutoHeaderHeight(e)&&(t.isColumn?this.eventDispatcher.headerHeight(t):this.eventDispatcher.groupHeaderHeight(t))}getGroupRowsHeight(){const t=[],e=this.ctrlsService.getHeaderRowContainerCtrls();for(const i of e){if(!i)continue;const n=i.getGroupRowCount()||0;for(let r=0;r<n;r++){const s=i.getGroupRowCtrlAtIndex(r),o=t[r];if(s){const a=this.getColumnGroupHeaderRowHeight(s);(o==null||a>o)&&(t[r]=a)}}}return t}getColumnGroupHeaderRowHeight(t){const e=this.isPivotMode()?this.getPivotGroupHeaderHeight():this.getGroupHeaderHeight();let i=0;const n=t.getHeaderCtrls();for(const r of n){const s=r.getColumn();if(s.isAutoHeaderHeight()){const o=s.getAutoHeaderHeight();o!=null&&o>i&&(i=o)}}return Math.max(e,i)}getColumnHeaderRowHeight(){const t=this.isPivotMode()?this.getPivotHeaderHeight():this.getHeaderHeight(),i=this.visibleColsService.getAllCols().filter(n=>n.isAutoHeaderHeight()).map(n=>n.getAutoHeaderHeight()||0);return Math.max(t,...i)}getHeaderHeight(){return this.gos.get("headerHeight")??this.environment.getDefaultHeaderHeight()}getFloatingFiltersHeight(){return this.gos.get("floatingFiltersHeight")??this.getHeaderHeight()}getGroupHeaderHeight(){return this.gos.get("groupHeaderHeight")??this.getHeaderHeight()}getPivotHeaderHeight(){return this.gos.get("pivotHeaderHeight")??this.getHeaderHeight()}getPivotGroupHeaderHeight(){return this.gos.get("pivotGroupHeaderHeight")??this.getGroupHeaderHeight()}onFirstDataRendered(){const t=this.gos.get("autoSizeStrategy");if(t?.type!=="fitCellContents")return;const{colIds:e,skipHeader:i}=t;setTimeout(()=>{e?this.columnAutosizeService.autoSizeCols({colKeys:e,skipHeader:i,source:"autosizeColumns"}):this.columnAutosizeService.autoSizeAllColumns("autosizeColumns",i)})}onAutoGroupColumnDefChanged(t){this.autoCols&&this.autoColService.updateAutoCols(this.autoCols.list,t)}onSelectionOptionsChanged(t,e,i){const n=e&&typeof e!="string"?C0(e):void 0,r=t&&typeof t!="string"?C0(t):void 0,s=n!==r,o=e&&typeof e!="string"?CT(e):void 0,a=t&&typeof t!="string"?CT(t):void 0;(s||o!==a)&&this.refreshAll(i)}};function Wm(t){return t==="gridOptionsUpdated"?"gridOptionsChanged":t}function n6(t){t.map={},t.list.forEach(e=>t.map[e.getId()]=e)}function r6(t,e){const i=t===e,n=t.getColDef()===e,r=t.getColId()==e;return i||n||r}function s6(t,e){return Fp(t,e,(i,n)=>i.getColId()===n.getColId())}var lxe=class extends kt{constructor(){super(...arguments),this.beanName="columnAutosizeService",this.timesDelayed=0}wireBeans(t){this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.animationFrameService=t.animationFrameService,this.autoWidthCalculator=t.autoWidthCalculator,this.eventDispatcher=t.columnEventDispatcher,this.ctrlsService=t.ctrlsService,this.renderStatusService=t.renderStatusService}autoSizeCols(t){if(this.columnModel.isShouldQueueResizeOperations()){this.columnModel.pushResizeOperation(()=>this.autoSizeCols(t));return}const{colKeys:e,skipHeader:i,skipHeaderGroups:n,stopAtGroup:r,source:s="api"}=t;if(this.animationFrameService.flushAllFrames(),this.timesDelayed<5&&this.renderStatusService&&!this.renderStatusService.areHeaderCellsRendered()){this.timesDelayed++,setTimeout(()=>this.autoSizeCols(t));return}this.timesDelayed=0;const o=[];let a=-1;const l=i??this.gos.get("skipHeaderOnAutoSize"),u=n??l;for(;a!==0;){a=0;const d=[];e.forEach(p=>{if(!p)return;const v=this.columnModel.getCol(p);if(!v||o.indexOf(v)>=0)return;const y=this.autoWidthCalculator.getPreferredWidthForColumn(v,l);if(y>0){const w=this.normaliseColumnWidth(v,y);v.setActualWidth(w,s),o.push(v),a++}d.push(v)}),d.length&&this.visibleColsService.refresh(s)}u||this.autoSizeColumnGroupsByColumns(e,s,r),this.eventDispatcher.columnResized(o,!0,"autosizeColumns")}autoSizeColumn(t,e,i){t&&this.autoSizeCols({colKeys:[t],skipHeader:i,skipHeaderGroups:!0,source:e})}autoSizeColumnGroupsByColumns(t,e,i){const n=new Set;this.columnModel.getColsForKeys(t).forEach(a=>{let l=a.getParent();for(;l&&l!=i;)l.isPadding()||n.add(l),l=l.getParent()});let s;const o=[];for(const a of n){for(const l of this.ctrlsService.getHeaderRowContainerCtrls())if(s=l.getHeaderCtrlForColumn(a),s)break;s&&s.resizeLeafColumnsToFit(e)}return o}autoSizeAllColumns(t,e){if(this.columnModel.isShouldQueueResizeOperations()){this.columnModel.pushResizeOperation(()=>this.autoSizeAllColumns(t,e));return}const i=this.visibleColsService.getAllCols();this.autoSizeCols({colKeys:i,skipHeader:e,source:t})}normaliseColumnWidth(t,e){const i=t.getMinWidth();e<i&&(e=i);const n=t.getMaxWidth();return t.isGreaterThanMax(e)&&(e=n),e}},cxe=class extends kt{constructor(){super(...arguments),this.beanName="funcColsService",this.rowGroupCols=[],this.valueCols=[],this.pivotCols=[]}wireBeans(t){this.columnModel=t.columnModel,this.eventDispatcher=t.columnEventDispatcher,this.aggFuncService=t.aggFuncService,this.visibleColsService=t.visibleColsService}getModifyColumnsNoEventsCallbacks(){return{addGroupCol:t=>this.rowGroupCols.push(t),removeGroupCol:t=>Na(this.rowGroupCols,t),addPivotCol:t=>this.pivotCols.push(t),removePivotCol:t=>Na(this.pivotCols,t),addValueCol:t=>this.valueCols.push(t),removeValueCol:t=>Na(this.valueCols,t)}}getSourceColumnsForGroupColumn(t){const e=t.getColDef().showRowGroup;if(!e)return null;if(e===!0)return this.rowGroupCols.slice(0);const i=this.columnModel.getColDefCol(e);return i?[i]:null}sortRowGroupColumns(t){this.rowGroupCols.sort(t)}sortPivotColumns(t){this.pivotCols.sort(t)}getValueColumns(){return this.valueCols?this.valueCols:[]}getPivotColumns(){return this.pivotCols?this.pivotCols:[]}getRowGroupColumns(){return this.rowGroupCols?this.rowGroupCols:[]}isRowGroupEmpty(){return Kl(this.rowGroupCols)}setColumnAggFunc(t,e,i){if(!t)return;const n=this.columnModel.getColDefCol(t);n&&(n.setAggFunc(e),this.eventDispatcher.columnChanged("columnValueChanged",[n],i))}setRowGroupColumns(t,e){this.setColList(t,this.rowGroupCols,"columnRowGroupChanged",!0,!0,(i,n)=>this.setRowGroupActive(i,n,e),e)}setRowGroupActive(t,e,i){t!==e.isRowGroupActive()&&(e.setRowGroupActive(t,i),t&&!this.gos.get("suppressRowGroupHidesColumns")&&this.columnModel.setColsVisible([e],!1,i),!t&&!this.gos.get("suppressMakeColumnVisibleAfterUnGroup")&&this.columnModel.setColsVisible([e],!0,i))}addRowGroupColumns(t,e){this.updateColList(t,this.rowGroupCols,!0,!0,i=>this.setRowGroupActive(!0,i,e),"columnRowGroupChanged",e)}removeRowGroupColumns(t,e){this.updateColList(t,this.rowGroupCols,!1,!0,i=>this.setRowGroupActive(!1,i,e),"columnRowGroupChanged",e)}addPivotColumns(t,e){this.updateColList(t,this.pivotCols,!0,!1,i=>i.setPivotActive(!0,e),"columnPivotChanged",e)}setPivotColumns(t,e){this.setColList(t,this.pivotCols,"columnPivotChanged",!0,!1,(i,n)=>{n.setPivotActive(i,e)},e)}removePivotColumns(t,e){this.updateColList(t,this.pivotCols,!1,!1,i=>i.setPivotActive(!1,e),"columnPivotChanged",e)}setValueColumns(t,e){this.setColList(t,this.valueCols,"columnValueChanged",!1,!1,(i,n)=>this.setValueActive(i,n,e),e)}setValueActive(t,e,i){if(t!==e.isValueActive()&&(e.setValueActive(t,i),t&&!e.getAggFunc()&&this.aggFuncService)){const n=this.aggFuncService.getDefaultAggFunc(e);e.setAggFunc(n)}}addValueColumns(t,e){this.updateColList(t,this.valueCols,!0,!1,i=>this.setValueActive(!0,i,e),"columnValueChanged",e)}removeValueColumns(t,e){this.updateColList(t,this.valueCols,!1,!1,i=>this.setValueActive(!1,i,e),"columnValueChanged",e)}moveRowGroupColumn(t,e,i){if(this.isRowGroupEmpty())return;const n=this.rowGroupCols[t],r=this.rowGroupCols.slice(t,e);this.rowGroupCols.splice(t,1),this.rowGroupCols.splice(e,0,n),this.eventDispatcher.rowGroupChanged(r,i)}setColList(t,e,i,n,r,s,o){if(!this.columnModel.getCols())return;const a=new Map;e.forEach((u,d)=>a.set(u,d)),e.length=0,oi(t)&&t.forEach(u=>{const d=this.columnModel.getColDefCol(u);d&&e.push(d)}),e.forEach((u,d)=>{const p=a.get(u);if(p===void 0){a.set(u,0);return}n&&p!==d||a.delete(u)}),(this.columnModel.getColDefCols()||[]).forEach(u=>{const d=e.indexOf(u)>=0;s(d,u)}),r&&this.columnModel.refreshCols(!1),this.visibleColsService.refresh(o),this.eventDispatcher.columnChanged(i,[...a.keys()],o)}updateColList(t,e,i,n,r,s,o){if(!t||Kl(t))return;let a=!1;const l=new Set;t.forEach(u=>{if(!u)return;const d=this.columnModel.getColDefCol(u);if(d){if(l.add(d),i){if(e.indexOf(d)>=0)return;e.push(d)}else{const p=e.indexOf(d);if(p<0)return;for(let v=p+1;v<e.length;v++)l.add(e[v]);Na(e,d)}r(d),a=!0}}),a&&(n&&this.columnModel.refreshCols(!1),this.visibleColsService.refresh(o),this.eventDispatcher.genericColumnEvent(s,Array.from(l),o))}extractCols(t,e){this.extractRowGroupCols(t,e),this.extractPivotCols(t,e),this.extractValueCols(t,e)}extractValueCols(t,e){this.valueCols=this.extractColsCommon(e,this.valueCols,(i,n)=>i.setValueActive(n,t),()=>{},()=>{},i=>{const n=i.aggFunc;if(n===null||n==="")return null;if(n!==void 0)return!!n},i=>i.initialAggFunc!=null&&i.initialAggFunc!=""),this.valueCols.forEach(i=>{const n=i.getColDef();n.aggFunc!=null&&n.aggFunc!=""?i.setAggFunc(n.aggFunc):i.getAggFunc()||i.setAggFunc(n.initialAggFunc)})}extractRowGroupCols(t,e){this.rowGroupCols=this.extractColsCommon(e,this.rowGroupCols,(i,n)=>i.setRowGroupActive(n,t),i=>i.rowGroupIndex,i=>i.initialRowGroupIndex,i=>i.rowGroup,i=>i.initialRowGroup)}extractPivotCols(t,e){this.pivotCols=this.extractColsCommon(e,this.pivotCols,(i,n)=>i.setPivotActive(n,t),i=>i.pivotIndex,i=>i.initialPivotIndex,i=>i.pivot,i=>i.initialPivot)}extractColsCommon(t=[],e=[],i,n,r,s,o){const a=[],l=[];(this.columnModel.getColDefCols()||[]).forEach(v=>{const y=t.indexOf(v)<0,w=v.getColDef(),R=hz(s(w)),O=hz(o(w)),P=hg(n(w)),N=hg(r(w));let F;R!==void 0?F=R:P!==void 0?P===null?F=!1:F=P>=0:y?O!==void 0?F=O:N!==void 0?F=N!=null&&N>=0:F=!1:F=e.indexOf(v)>=0,F&&((y?P!=null||N!=null:P!=null)?a.push(v):l.push(v))});const d=v=>{const y=n(v.getColDef()),w=r(v.getColDef());return y??w};a.sort((v,y)=>{const w=d(v),R=d(y);return w===R?0:w<R?-1:1});const p=[].concat(a);return e.forEach(v=>{l.indexOf(v)>=0&&p.push(v)}),l.forEach(v=>{p.indexOf(v)<0&&p.push(v)}),e.forEach(v=>{p.indexOf(v)<0&&i(v,!1)}),p.forEach(v=>{e.indexOf(v)<0&&i(v,!0)}),p}generateColumnStateForRowGroupAndPivotIndexes(t,e){const i={},n=(r,s,o,a,l,u)=>{const d=this.columnModel.getColDefCols();if(!s.length||!d)return[];const p=Object.keys(r),v=new Set(p),y=new Set(p),w=new Set(s.map(W=>{const Q=W.getColId();return y.delete(Q),Q}).concat(p)),R=[],O={};let P=0;for(let W=0;W<d.length;W++){const Q=d[W].getColId();w.has(Q)&&(R.push(Q),O[Q]=P++)}let N=1e3,F=!1,k=0;const $=W=>{const Q=O[W];for(let Y=k;Y<Q;Y++){const M=R[Y];y.has(M)&&(r[M][l]=N++,y.delete(M))}k=Q};s.forEach(W=>{const Q=W.getColId();if(v.has(Q))$(Q),r[Q][l]=N++;else{const Y=W.getColDef();(Y[l]===null||Y[l]===void 0&&Y[u]==null)&&(F||(Y[o]||Y[o]===void 0&&Y[a]?$(Q):(y.forEach(G=>{r[G][l]=N+O[G]}),N+=R.length,F=!0)),i[Q]||(i[Q]={colId:Q}),i[Q][l]=N++)}})};return n(t,this.rowGroupCols,"rowGroup","initialRowGroup","rowGroupIndex","initialRowGroupIndex"),n(e,this.pivotCols,"pivot","initialPivot","pivotIndex","initialPivotIndex"),Object.values(i)}},uxe=class extends kt{constructor(){super(...arguments),this.beanName="columnApplyStateService"}wireBeans(t){this.columnModel=t.columnModel,this.eventDispatcher=t.columnEventDispatcher,this.sortController=t.sortController,this.columnGetStateService=t.columnGetStateService,this.funcColsService=t.funcColsService,this.visibleColsService=t.visibleColsService,this.columnAnimationService=t.columnAnimationService,this.pivotResultColsService=t.pivotResultColsService}applyColumnState(t,e){const i=this.columnModel.getColDefCols()||[];if(Kl(i))return!1;if(t&&t.state&&!t.state.forEach)return Wt("applyColumnState() - the state attribute should be an array, however an array was not found. Please provide an array of items (one for each col you want to change) for state."),!1;const n=this.funcColsService.getModifyColumnsNoEventsCallbacks(),r=(a,l,u)=>{const d=this.compareColumnStatesAndDispatchEvents(e),p=l.slice(),v={},y={},w=[],R=[];let O=0;const P=this.funcColsService.getRowGroupColumns().slice(),N=this.funcColsService.getPivotColumns().slice();a.forEach(W=>{const Q=W.colId||"";if(Q.startsWith(xP)){w.push(W),R.push(W);return}const M=u(Q);M?(this.syncColumnWithStateItem(M,W,t.defaultState,v,y,!1,e,n),Na(p,M)):(R.push(W),O+=1)});const F=W=>this.syncColumnWithStateItem(W,null,t.defaultState,v,y,!1,e,n);p.forEach(F),this.funcColsService.sortRowGroupColumns(o6.bind(this,v,P)),this.funcColsService.sortPivotColumns(o6.bind(this,y,N)),this.columnModel.refreshCols(!1);const $=(this.columnModel.getAutoCols()||[]).slice();return w.forEach(W=>{const Q=this.columnModel.getAutoCol(W.colId);Na($,Q),this.syncColumnWithStateItem(Q,W,t.defaultState,null,null,!0,e,n)}),$.forEach(F),this.orderLiveColsLikeState(t),this.visibleColsService.refresh(e),this.eventDispatcher.everythingChanged(e),d(),{unmatchedAndAutoStates:R,unmatchedCount:O}};this.columnAnimationService.start();let{unmatchedAndAutoStates:s,unmatchedCount:o}=r(t.state||[],i,a=>this.columnModel.getColDefCol(a));if(s.length>0||oi(t.defaultState)){const l=this.pivotResultColsService.getPivotResultCols()?.list;o=r(s,l||[],u=>this.pivotResultColsService.getPivotResultCol(u)).unmatchedCount}return this.columnAnimationService.finish(),o===0}resetColumnState(t){const e=this.columnModel.getColDefCols();if(Kl(e))return;const i=this.columnModel.getColDefColTree(),n=iU(i),r=[];let s=1e3,o=1e3,a=[];const l=this.columnModel.getAutoCols();l&&(a=a.concat(l)),n&&(a=a.concat(n)),a.forEach(u=>{const d=this.getColumnStateFromColDef(u);Wn(d.rowGroupIndex)&&d.rowGroup&&(d.rowGroupIndex=s++),Wn(d.pivotIndex)&&d.pivot&&(d.pivotIndex=o++),r.push(d)}),this.applyColumnState({state:r,applyOrder:!0},t)}getColumnStateFromColDef(t){const e=(w,R)=>w??R??null,i=t.getColDef(),n=e(i.sort,i.initialSort),r=e(i.sortIndex,i.initialSortIndex),s=e(i.hide,i.initialHide),o=e(i.pinned,i.initialPinned),a=e(i.width,i.initialWidth),l=e(i.flex,i.initialFlex);let u=e(i.rowGroupIndex,i.initialRowGroupIndex),d=e(i.rowGroup,i.initialRowGroup);u==null&&(d==null||d==!1)&&(u=null,d=null);let p=e(i.pivotIndex,i.initialPivotIndex),v=e(i.pivot,i.initialPivot);p==null&&(v==null||v==!1)&&(p=null,v=null);const y=e(i.aggFunc,i.initialAggFunc);return{colId:t.getColId(),sort:n,sortIndex:r,hide:s,pinned:o,width:a,flex:l,rowGroup:d,rowGroupIndex:u,pivot:v,pivotIndex:p,aggFunc:y}}syncColumnWithStateItem(t,e,i,n,r,s,o,a){if(!t)return;const l=(k,$)=>{const W={value1:void 0,value2:void 0};let Q=!1;return e&&(e[k]!==void 0&&(W.value1=e[k],Q=!0),oi($)&&e[$]!==void 0&&(W.value2=e[$],Q=!0)),!Q&&i&&(i[k]!==void 0&&(W.value1=i[k]),oi($)&&i[$]!==void 0&&(W.value2=i[$])),W},u=l("hide").value1;u!==void 0&&t.setVisible(!u,o);const d=l("pinned").value1;d!==void 0&&t.setPinned(d);const p=t.getColDef().minWidth??this.gos.environment.getDefaultColumnMinWidth(),v=l("flex").value1;if(v!==void 0&&t.setFlex(v),v==null){const k=l("width").value1;k!=null&&p!=null&&k>=p&&t.setActualWidth(k,o)}const y=l("sort").value1;y!==void 0&&(y==="desc"||y==="asc"?t.setSort(y,o):t.setSort(void 0,o));const w=l("sortIndex").value1;if(w!==void 0&&t.setSortIndex(w),s||!t.isPrimary())return;const R=l("aggFunc").value1;R!==void 0&&(typeof R=="string"?(t.setAggFunc(R),t.isValueActive()||(t.setValueActive(!0,o),a.addValueCol(t))):(oi(R)&&Wt("stateItem.aggFunc must be a string. if using your own aggregation functions, register the functions first before using them in get/set state. This is because it is intended for the column state to be stored and retrieved as simple JSON."),t.isValueActive()&&(t.setValueActive(!1,o),a.removeValueCol(t))));const{value1:O,value2:P}=l("rowGroup","rowGroupIndex");(O!==void 0||P!==void 0)&&(typeof P=="number"||O?(t.isRowGroupActive()||(t.setRowGroupActive(!0,o),a.addGroupCol(t)),n&&typeof P=="number"&&(n[t.getId()]=P)):t.isRowGroupActive()&&(t.setRowGroupActive(!1,o),a.removeGroupCol(t)));const{value1:N,value2:F}=l("pivot","pivotIndex");(N!==void 0||F!==void 0)&&(typeof F=="number"||N?(t.isPivotActive()||(t.setPivotActive(!0,o),a.addPivotCol(t)),r&&typeof F=="number"&&(r[t.getId()]=F)):t.isPivotActive()&&(t.setPivotActive(!1,o),a.removePivotCol(t)))}orderLiveColsLikeState(t){if(!t.applyOrder||!t.state)return;const e=[];t.state.forEach(i=>{i.colId!=null&&e.push(i.colId)}),this.columnModel.sortColsLikeKeys(e)}compareColumnStatesAndDispatchEvents(t){const e={rowGroupColumns:this.funcColsService.getRowGroupColumns().slice(),pivotColumns:this.funcColsService.getPivotColumns().slice(),valueColumns:this.funcColsService.getValueColumns().slice()},i=this.columnGetStateService.getColumnState(),n={};return i.forEach(r=>{n[r.colId]=r}),()=>{const r=this.columnModel.getAllCols(),s=(R,O,P,N)=>{const F=O.map(N),k=P.map(N);if(Fp(F,k))return;const W=new Set(O);P.forEach(Y=>{W.delete(Y)||W.add(Y)});const Q=[...W];this.eventService.dispatchEvent({type:R,columns:Q,column:Q.length===1?Q[0]:null,source:t})},o=R=>{const O=[];return r.forEach(P=>{const N=n[P.getColId()];N&&R(N,P)&&O.push(P)}),O},a=R=>R.getColId();s("columnRowGroupChanged",e.rowGroupColumns,this.funcColsService.getRowGroupColumns(),a),s("columnPivotChanged",e.pivotColumns,this.funcColsService.getPivotColumns(),a);const u=o((R,O)=>{const P=R.aggFunc!=null,N=P!=O.isValueActive(),F=P&&R.aggFunc!=O.getAggFunc();return N||F});u.length>0&&this.eventDispatcher.columnChanged("columnValueChanged",u,t);const d=(R,O)=>R.width!=O.getActualWidth();this.eventDispatcher.columnResized(o(d),!0,t);const p=(R,O)=>R.pinned!=O.getPinned();this.eventDispatcher.columnPinned(o(p),t);const v=(R,O)=>R.hide==O.isVisible();this.eventDispatcher.columnVisible(o(v),t);const w=o((R,O)=>R.sort!=O.getSort()||R.sortIndex!=O.getSortIndex());w.length>0&&this.sortController.dispatchSortChangedEvents(t,w),this.normaliseColumnMovedEventForColumnState(i,t)}}normaliseColumnMovedEventForColumnState(t,e){const i=this.columnGetStateService.getColumnState(),n={};i.forEach(l=>n[l.colId]=l);const r={};t.forEach(l=>{n[l.colId]&&(r[l.colId]=!0)});const s=t.filter(l=>r[l.colId]),o=i.filter(l=>r[l.colId]),a=[];o.forEach((l,u)=>{const d=s&&s[u];if(d&&d.colId!==l.colId){const p=this.columnModel.getCol(d.colId);p&&a.push(p)}}),a.length&&this.eventDispatcher.columnMoved({movedColumns:a,source:e,finished:!0})}},o6=(t,e,i,n)=>{const r=t[i.getId()],s=t[n.getId()],o=r!=null,a=s!=null;if(o&&a)return r-s;if(o)return-1;if(a)return 1;const l=e.indexOf(i),u=e.indexOf(n),d=l>=0,p=u>=0;return d&&p?l-u:d?-1:1},hxe=class extends kt{constructor(){super(...arguments),this.beanName="columnMoveService"}wireBeans(t){this.columnModel=t.columnModel,this.columnAnimationService=t.columnAnimationService,this.eventDispatcher=t.columnEventDispatcher}moveColumnByIndex(t,e,i){const n=this.columnModel.getCols();if(!n)return;const r=n[t];this.moveColumns([r],e,i)}moveColumns(t,e,i,n=!0){const r=this.columnModel.getCols();if(!r)return;if(e>r.length-t.length){Wt("tried to insert columns in invalid location, toIndex = ",e),Wt("remember that you should not count the moving columns when calculating the new index");return}this.columnAnimationService.start();const s=this.columnModel.getColsForKeys(t);this.doesMovePassRules(s,e)&&(this.columnModel.moveInCols(s,e,i),this.eventDispatcher.columnMoved({movedColumns:s,source:i,toIndex:e,finished:n})),this.columnAnimationService.finish()}doesMovePassRules(t,e){const i=this.getProposedColumnOrder(t,e);return this.doesOrderPassRules(i)}doesOrderPassRules(t){return!(!this.doesMovePassMarryChildren(t)||!this.doesMovePassLockedPositions(t))}getProposedColumnOrder(t,e){const n=this.columnModel.getCols().slice();return mY(n,t,e),n}doesMovePassLockedPositions(t){const e=s=>s?s==="left"||s===!0?-1:1:0,i=this.gos.get("enableRtl");let n=i?1:-1,r=!0;return t.forEach(s=>{const o=e(s.getColDef().lockPosition);i?o>n&&(r=!1):o<n&&(r=!1),n=o}),r}doesMovePassMarryChildren(t){let e=!0;const i=this.columnModel.getColTree();return Wd(null,i,n=>{if(!Aa(n))return;const r=n,s=r.getColGroupDef();if(!(s&&s.marryChildren))return;const a=[];r.getLeafColumns().forEach(v=>{const y=t.indexOf(v);a.push(y)});const l=Math.max.apply(Math,a),u=Math.min.apply(Math,a),d=l-u,p=r.getLeafColumns().length-1;d>p&&(e=!1)}),e}placeLockedColumns(t){const e=[],i=[],n=[];return t.forEach(s=>{const o=s.getColDef().lockPosition;o==="right"?n.push(s):o==="left"||o===!0?e.push(s):i.push(s)}),this.gos.get("enableRtl")?[...n,...i,...e]:[...e,...i,...n]}},dxe=/[&<>"']/g,fxe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function yh(t,e){if(t==null)return null;const i=t.toString().toString();return e?i:i.replace(dxe,n=>fxe[n])}function pxe(t){if(!t||t==null)return null;const e=/([a-z])([A-Z])/g,i=/([A-Z]+)([A-Z])([a-z])/g;return t.replace(e,"$1 $2").replace(i,"$1 $2$3").replace(/\./g," ").split(" ").map(r=>r.substring(0,1).toUpperCase()+(r.length>1?r.substring(1,r.length):"")).join(" ")}function mxe(t){return t.replace(/[A-Z]/g,e=>`-${e.toLocaleLowerCase()}`)}var gxe=class extends kt{constructor(){super(...arguments),this.beanName="columnNameService"}wireBeans(t){this.expressionService=t.expressionService,this.funcColsService=t.funcColsService,this.columnModel=t.columnModel}getDisplayNameForColumn(t,e,i=!1){if(!t)return null;const n=this.getHeaderName(t.getColDef(),t,null,null,e);return i?this.wrapHeaderNameWithAggFunc(t,n):n}getDisplayNameForProvidedColumnGroup(t,e,i){const n=e?e.getColGroupDef():null;return n?this.getHeaderName(n,null,t,e,i):null}getDisplayNameForColumnGroup(t,e){return this.getDisplayNameForProvidedColumnGroup(t,t.getProvidedColumnGroup(),e)}getHeaderName(t,e,i,n,r){const s=t.headerValueGetter;if(s){const o=this.gos.addGridCommonParams({colDef:t,column:e,columnGroup:i,providedColumnGroup:n,location:r});return typeof s=="function"?s(o):typeof s=="string"?this.expressionService.evaluate(s,o):(Wt("headerValueGetter must be a function or a string"),"")}else{if(t.headerName!=null)return t.headerName;if(t.field)return pxe(t.field)}return""}wrapHeaderNameWithAggFunc(t,e){if(this.gos.get("suppressAggFuncInHeader"))return e;const i=t.getColDef().pivotValueColumn,n=oi(i);let r=null,s;if(n){const o=this.funcColsService.getValueColumns(),a=this.gos.get("removePivotHeaderRowWhenSingleValueColumn")&&o.length===1,l=t.getColDef().pivotTotalColumnIds!==void 0;if(a&&!l)return e;r=i?i.getAggFunc():null,s=!0}else{const o=t.isValueActive(),a=this.columnModel.isPivotMode()||!this.funcColsService.isRowGroupEmpty();o&&a?(r=t.getAggFunc(),s=!0):s=!1}if(s){const o=typeof r=="string"?r:"func";return`${this.localeService.getLocaleTextFunc()(o,o)}(${e})`}return e}},vxe=class extends kt{constructor(){super(...arguments),this.beanName="pivotResultColsService"}wireBeans(t){this.context=t.context,this.columnModel=t.columnModel,this.columnFactory=t.columnFactory,this.visibleColsService=t.visibleColsService}destroy(){Zf(this.context,this.pivotResultCols?.tree),super.destroy()}isPivotResultColsPresent(){return this.pivotResultCols!=null}lookupPivotResultCol(t,e){if(this.pivotResultCols==null)return null;const i=this.columnModel.getColDefCol(e);let n=null;return this.pivotResultCols.list.forEach(r=>{const s=r.getColDef().pivotKeys,o=r.getColDef().pivotValueColumn;Fp(s,t)&&o===i&&(n=r)}),n}getPivotResultCols(){return this.pivotResultCols}getPivotResultCol(t){return this.pivotResultCols?this.columnModel.getColFromCollection(t,this.pivotResultCols):null}setPivotResultCols(t,e){if(this.columnModel.isReady()&&!(t==null&&this.pivotResultCols==null)){if(t){this.processPivotResultColDef(t);const i=this.columnFactory.createColumnTree(t,!1,this.pivotResultCols?.tree||this.previousPivotResultCols||void 0,e);Zf(this.context,this.pivotResultCols?.tree,i.columnTree);const n=i.columnTree,r=i.treeDept,s=iU(n),o={};this.pivotResultCols={tree:n,treeDepth:r,list:s,map:o},this.pivotResultCols.list.forEach(l=>this.pivotResultCols.map[l.getId()]=l);const a=!!this.previousPivotResultCols;this.previousPivotResultCols=null,this.columnModel.refreshCols(!a)}else this.previousPivotResultCols=this.pivotResultCols?this.pivotResultCols.tree:null,this.pivotResultCols=null,this.columnModel.refreshCols(!1);this.visibleColsService.refresh(e)}}processPivotResultColDef(t){const e=this.gos.get("processPivotResultColDef"),i=this.gos.get("processPivotResultColGroupDef");if(!e&&!i)return;const n=r=>{r.forEach(s=>{if(oi(s.children)){const a=s;i&&i(a),n(a.children)}else e&&e(s)})};t&&n(t)}},yxe=class extends kt{constructor(){super(...arguments),this.beanName="columnSizeService"}wireBeans(t){this.columnModel=t.columnModel,this.columnViewportService=t.columnViewportService,this.eventDispatcher=t.columnEventDispatcher,this.visibleColsService=t.visibleColsService,this.ctrlsService=t.ctrlsService}setColumnWidths(t,e,i,n){const r=[];t.forEach(s=>{const o=this.columnModel.getColDefCol(s.key)||this.columnModel.getCol(s.key);if(!o)return;if(r.push({width:s.newWidth,ratios:[1],columns:[o]}),this.gos.get("colResizeDefault")==="shift"&&(e=!e),e){const l=this.visibleColsService.getColAfter(o);if(!l)return;const u=o.getActualWidth()-s.newWidth,d=l.getActualWidth()+u;r.push({width:d,ratios:[1],columns:[l]})}}),r.length!==0&&this.resizeColumnSets({resizeSets:r,finished:i,source:n})}resizeColumnSets(t){const{resizeSets:e,finished:i,source:n}=t;if(!(!e||e.every(d=>this.checkMinAndMaxWidthsForSet(d)))){if(i){const d=e&&e.length>0?e[0].columns:null;this.eventDispatcher.columnResized(d,i,n)}return}const s=[],o=[];e.forEach(d=>{const{width:p,columns:v,ratios:y}=d,w={},R={};v.forEach(N=>o.push(N));let O=!0,P=0;for(;O;){if(P++,P>1e3){ar("infinite loop in resizeColumnSets");break}O=!1;const N=[];let F=0,k=p;v.forEach((W,Q)=>{if(R[W.getId()])k-=w[W.getId()];else{N.push(W);const M=y[Q];F+=M}});const $=1/F;N.forEach((W,Q)=>{const Y=Q===N.length-1;let M;Y?M=k:(M=Math.round(y[Q]*p*$),k-=M);const D=W.getMinWidth(),G=W.getMaxWidth();M<D?(M=D,R[W.getId()]=!0,O=!0):G>0&&M>G&&(M=G,R[W.getId()]=!0,O=!0),w[W.getId()]=M})}v.forEach(N=>{const F=w[N.getId()];N.getActualWidth()!==F&&(N.setActualWidth(F,n),s.push(N))})});const a=s.length>0;let l=[];a&&(l=this.refreshFlexedColumns({resizingCols:o,skipSetLeft:!0}),this.visibleColsService.setLeftValues(n),this.visibleColsService.updateBodyWidths(),this.columnViewportService.checkViewportColumns());const u=o.concat(l);(a||i)&&this.eventDispatcher.columnResized(u,i,n,l)}checkMinAndMaxWidthsForSet(t){const{columns:e,width:i}=t;let n=0,r=0,s=!0;e.forEach(l=>{const u=l.getMinWidth();n+=u||0;const d=l.getMaxWidth();d>0?r+=d:s=!1});const o=i>=n,a=!s||i<=r;return o&&a}refreshFlexedColumns(t={}){const e=t.source?t.source:"flex";if(t.viewportWidth!=null&&(this.flexViewportWidth=t.viewportWidth),!this.flexViewportWidth)return[];const i=this.visibleColsService.getCenterCols();let n=-1;if(t.resizingCols){const v=new Set(t.resizingCols);for(let y=i.length-1;y>=0;y--)if(v.has(i[y])){n=y;break}}let r=0,s=[],o=0,a=0;for(let v=0;v<i.length;v++)i[v].getFlex()&&v>n?(s.push(i[v]),a+=i[v].getFlex(),o+=i[v].getMinWidth()):r+=i[v].getActualWidth();if(!s.length)return[];let l=[];r+o>this.flexViewportWidth&&(s.forEach(v=>v.setActualWidth(v.getMinWidth(),e)),l=s,s=[]);const u=[];let d;e:for(;;){d=this.flexViewportWidth-r;const v=d/a;for(let y=0;y<s.length;y++){const w=s[y],R=v*w.getFlex();let O=0;const P=w.getMinWidth(),N=w.getMaxWidth();if(R<P?O=P:R>N&&(O=N),O){w.setActualWidth(O,e),pY(s,w),a-=w.getFlex(),l.push(w),r+=w.getActualWidth();continue e}u[y]=Math.floor(R)}break}let p=d;return s.forEach((v,y)=>{const w=y<s.length-1?Math.min(u[y],p):Math.max(u[y],p);v.setActualWidth(w,e),l.push(v),p-=u[y]}),t.skipSetLeft||this.visibleColsService.setLeftValues(e),t.updateBodyWidths&&this.visibleColsService.updateBodyWidths(),t.fireResizedEvent&&this.eventDispatcher.columnResized(l,!0,e,s),s}sizeColumnsToFit(t,e="sizeColumnsToFit",i,n){if(this.columnModel.isShouldQueueResizeOperations()){this.columnModel.pushResizeOperation(()=>this.sizeColumnsToFit(t,e,i,n));return}const r={};n&&n?.columnLimits?.forEach(({key:v,...y})=>{r[typeof v=="string"?v:v.getColId()]=y});const s=this.visibleColsService.getAllCols(),o=t===yd(s);if(t<=0||!s.length||o)return;const a=[],l=[];s.forEach(v=>{v.getColDef().suppressSizeToFit===!0?l.push(v):a.push(v)});const u=a.slice(0);let d=!1;const p=v=>{Na(a,v),l.push(v)};for(a.forEach(v=>{v.resetActualWidth(e);const y=r?.[v.getId()],w=y?.minWidth??n?.defaultMinWidth,R=y?.maxWidth??n?.defaultMaxWidth,O=v.getActualWidth();typeof w=="number"&&O<w?v.setActualWidth(w,e,!0):typeof R=="number"&&O>R&&v.setActualWidth(R,e,!0)});!d;){d=!0;const v=t-yd(l);if(v<=0)a.forEach(y=>{const w=r?.[y.getId()]?.minWidth??n?.defaultMinWidth;if(typeof w=="number"){y.setActualWidth(w,e,!0);return}y.setMinimum(e)});else{const y=v/yd(a);let w=v;for(let R=a.length-1;R>=0;R--){const O=a[R],P=r?.[O.getId()],N=P?.minWidth??n?.defaultMinWidth,F=P?.maxWidth??n?.defaultMaxWidth,k=O.getMinWidth(),$=O.getMaxWidth(),W=typeof N=="number"&&N>k?N:k,Q=typeof F=="number"&&F<$?F:$;let Y=Math.round(O.getActualWidth()*y);Y<W?(Y=W,p(O),d=!1):Y>Q?(Y=Q,p(O),d=!1):R===0&&(Y=w),O.setActualWidth(Y,e,!0),w-=Y}}}u.forEach(v=>{v.fireColumnWidthChangedEvent(e)}),this.visibleColsService.setLeftValues(e),this.visibleColsService.updateBodyWidths(),!i&&this.eventDispatcher.columnResized(u,!0,e)}applyAutosizeStrategy(){const t=this.gos.get("autoSizeStrategy");if(!t)return;const{type:e}=t;setTimeout(()=>{if(e==="fitGridWidth"){const{columnLimits:i,defaultMinWidth:n,defaultMaxWidth:r}=t,s=i?.map(({colId:o,minWidth:a,maxWidth:l})=>({key:o,minWidth:a,maxWidth:l}));this.ctrlsService.getGridBodyCtrl().sizeColumnsToFit({defaultMinWidth:n,defaultMaxWidth:r,columnLimits:s})}else e==="fitProvidedWidth"&&this.sizeColumnsToFit(t.width,"sizeColumnsToFit")})}};function wY(t,e){return t+"_"+e}function Vs(t){return t instanceof _Y}var _Y=class extends kt{constructor(t,e,i,n){super(),this.isColumn=!1,this.displayedChildren=[],this.autoHeaderHeight=null,this.parent=null,this.groupId=e,this.partId=i,this.providedColumnGroup=t,this.pinned=n}reset(){this.parent=null,this.children=null,this.displayedChildren=null}getParent(){return this.parent}setParent(t){this.parent=t}getUniqueId(){return wY(this.groupId,this.partId)}isEmptyGroup(){return this.displayedChildren.length===0}isMoving(){const t=this.getProvidedColumnGroup().getLeafColumns();return!t||t.length===0?!1:t.every(e=>e.isMoving())}checkLeft(){if(this.displayedChildren.forEach(t=>{Vs(t)&&t.checkLeft()}),this.displayedChildren.length>0)if(this.gos.get("enableRtl")){const e=Yn(this.displayedChildren).getLeft();this.setLeft(e)}else{const t=this.displayedChildren[0].getLeft();this.setLeft(t)}else this.setLeft(null)}getLeft(){return this.left}getOldLeft(){return this.oldLeft}setLeft(t){this.oldLeft=this.left,this.left!==t&&(this.left=t,this.dispatchLocalEvent({type:"leftChanged"}))}getPinned(){return this.pinned}getGroupId(){return this.groupId}getPartId(){return this.partId}getActualWidth(){let t=0;return this.displayedChildren&&this.displayedChildren.forEach(e=>{t+=e.getActualWidth()}),t}isResizable(){if(!this.displayedChildren)return!1;let t=!1;return this.displayedChildren.forEach(e=>{e.isResizable()&&(t=!0)}),t}getMinWidth(){let t=0;return this.displayedChildren.forEach(e=>{t+=e.getMinWidth()}),t}addChild(t){this.children||(this.children=[]),this.children.push(t)}getDisplayedChildren(){return this.displayedChildren}getLeafColumns(){const t=[];return this.addLeafColumns(t),t}getDisplayedLeafColumns(){const t=[];return this.addDisplayedLeafColumns(t),t}getDefinition(){return this.providedColumnGroup.getColGroupDef()}getColGroupDef(){return this.providedColumnGroup.getColGroupDef()}isPadding(){return this.providedColumnGroup.isPadding()}isExpandable(){return this.providedColumnGroup.isExpandable()}isExpanded(){return this.providedColumnGroup.isExpanded()}setExpanded(t){this.providedColumnGroup.setExpanded(t)}isAutoHeaderHeight(){return!!this.getColGroupDef()?.autoHeaderHeight}getAutoHeaderHeight(){return this.autoHeaderHeight}setAutoHeaderHeight(t){const e=t!==this.autoHeaderHeight;return this.autoHeaderHeight=t,e}addDisplayedLeafColumns(t){this.displayedChildren.forEach(e=>{Tp(e)?t.push(e):Vs(e)&&e.addDisplayedLeafColumns(t)})}addLeafColumns(t){this.children.forEach(e=>{Tp(e)?t.push(e):Vs(e)&&e.addLeafColumns(t)})}getChildren(){return this.children}getColumnGroupShow(){return this.providedColumnGroup.getColumnGroupShow()}getProvidedColumnGroup(){return this.providedColumnGroup}getPaddingLevel(){const t=this.getParent();return!this.isPadding()||!t||!t.isPadding()?0:1+t.getPaddingLevel()}calculateDisplayedColumns(){this.displayedChildren=[];let t=this;for(;t!=null&&t.isPadding();)t=t.getParent();if(!(t?t.getProvidedColumnGroup().isExpandable():!1)){this.displayedChildren=this.children,this.dispatchLocalEvent({type:"displayedChildrenChanged"});return}this.children.forEach(i=>{if(Vs(i)&&(!i.displayedChildren||!i.displayedChildren.length))return;switch(i.getColumnGroupShow()){case"open":t.getProvidedColumnGroup().isExpanded()&&this.displayedChildren.push(i);break;case"closed":t.getProvidedColumnGroup().isExpanded()||this.displayedChildren.push(i);break;default:this.displayedChildren.push(i);break}}),this.dispatchLocalEvent({type:"displayedChildrenChanged"})}},CY=class{constructor(){this.existingIds={}}getInstanceIdForKey(t){const e=this.existingIds[t];let i;return typeof e!="number"?i=0:i=e+1,this.existingIds[t]=i,i}},xxe=class extends kt{constructor(){super(...arguments),this.beanName="visibleColsService",this.colsAndGroupsMap={},this.columnsLeft=[],this.columnsRight=[],this.columnsCenter=[],this.columns=[],this.bodyWidth=0,this.leftWidth=0,this.rightWidth=0,this.bodyWidthDirty=!0}wireBeans(t){this.columnModel=t.columnModel,this.columnSizeService=t.columnSizeService,this.columnViewportService=t.columnViewportService,this.eventDispatcher=t.columnEventDispatcher}refresh(t,e=!1){e||this.buildTrees(),this.updateOpenClosedVisibilityInColumnGroups(),this.columnsLeft=KF(this.treeLeft),this.columnsCenter=KF(this.treeCenter),this.columnsRight=KF(this.treeRight),this.joinColsAriaOrder(),this.joinCols(),this.setLeftValues(t),this.autoHeightCols=this.columns.filter(i=>i.isAutoHeight()),this.columnSizeService.refreshFlexedColumns(),this.updateBodyWidths(),this.columnViewportService.checkViewportColumns(!1),this.setFirstRightAndLastLeftPinned(t),this.eventDispatcher.visibleCols(t)}updateBodyWidths(){const t=yd(this.columnsCenter),e=yd(this.columnsLeft),i=yd(this.columnsRight);this.bodyWidthDirty=this.bodyWidth!==t,(this.bodyWidth!==t||this.leftWidth!==e||this.rightWidth!==i)&&(this.bodyWidth=t,this.leftWidth=e,this.rightWidth=i,this.eventService.dispatchEvent({type:"columnContainerWidthChanged"}),this.eventService.dispatchEvent({type:"displayedColumnsWidthChanged"}))}setLeftValues(t){this.setLeftValuesOfCols(t),this.setLeftValuesOfGroups()}setFirstRightAndLastLeftPinned(t){let e,i;this.gos.get("enableRtl")?(e=this.columnsLeft?this.columnsLeft[0]:null,i=this.columnsRight?Yn(this.columnsRight):null):(e=this.columnsLeft?Yn(this.columnsLeft):null,i=this.columnsRight?this.columnsRight[0]:null),this.columnModel.getCols().forEach(n=>{n.setLastLeftPinned(n===e,t),n.setFirstRightPinned(n===i,t)})}buildTrees(){const t=this.columnModel.getColsToShow(),e=t.filter(s=>s.getPinned()=="left"),i=t.filter(s=>s.getPinned()=="right"),n=t.filter(s=>s.getPinned()!="left"&&s.getPinned()!="right"),r=new CY;this.treeLeft=this.createGroups({columns:e,idCreator:r,pinned:"left",oldDisplayedGroups:this.treeLeft}),this.treeRight=this.createGroups({columns:i,idCreator:r,pinned:"right",oldDisplayedGroups:this.treeRight}),this.treeCenter=this.createGroups({columns:n,idCreator:r,pinned:null,oldDisplayedGroups:this.treeCenter}),this.updateColsAndGroupsMap()}clear(){this.columnsLeft=[],this.columnsRight=[],this.columnsCenter=[],this.columns=[],this.ariaOrderColumns=[]}joinColsAriaOrder(){const t=this.columnModel.getCols(),e=[],i=[],n=[];for(const r of t){const s=r.getPinned();s?s===!0||s==="left"?e.push(r):n.push(r):i.push(r)}this.ariaOrderColumns=e.concat(i).concat(n)}getAriaColIndex(t){let e;return Vs(t)?e=t.getLeafColumns()[0]:e=t,this.ariaOrderColumns.indexOf(e)+1}getAllAutoHeightCols(){return this.autoHeightCols}setLeftValuesOfGroups(){[this.treeLeft,this.treeRight,this.treeCenter].forEach(t=>{t.forEach(e=>{Vs(e)&&e.checkLeft()})})}setLeftValuesOfCols(t){if(!this.columnModel.getColDefCols())return;const i=this.columnModel.getCols().slice(0),n=this.gos.get("enableRtl");[this.columnsLeft,this.columnsRight,this.columnsCenter].forEach(r=>{if(n){let s=yd(r);r.forEach(o=>{s-=o.getActualWidth(),o.setLeft(s,t)})}else{let s=0;r.forEach(o=>{o.setLeft(s,t),s+=o.getActualWidth()})}j0e(i,r)}),i.forEach(r=>{r.setLeft(null,t)})}joinCols(){this.gos.get("enableRtl")?this.columns=this.columnsRight.concat(this.columnsCenter).concat(this.columnsLeft):this.columns=this.columnsLeft.concat(this.columnsCenter).concat(this.columnsRight)}getColsCenter(){return this.columnsCenter}getAllTrees(){return this.treeLeft&&this.treeRight&&this.treeCenter?this.treeLeft.concat(this.treeCenter).concat(this.treeRight):null}getTreeLeft(){return this.treeLeft}getTreeRight(){return this.treeRight}getTreeCenter(){return this.treeCenter}getAllCols(){return this.columns}isColDisplayed(t){return this.getAllCols().indexOf(t)>=0}getLeftColsForRow(t){return this.columnModel.isColSpanActive()?this.getColsForRow(t,this.columnsLeft):this.columnsLeft}getRightColsForRow(t){return this.columnModel.isColSpanActive()?this.getColsForRow(t,this.columnsRight):this.columnsRight}getColsForRow(t,e,i,n){const r=[];let s=null;for(let o=0;o<e.length;o++){const a=e[o],l=e.length-o,u=Math.min(a.getColSpan(t),l),d=[a];if(u>1){const v=u-1;for(let y=1;y<=v;y++)d.push(e[o+y]);o+=v}let p;i?(p=!1,d.forEach(v=>{i(v)&&(p=!0)})):p=!0,p&&(r.length===0&&s&&(n&&n(a))&&r.push(s),r.push(a)),s=a}return r}getBodyContainerWidth(){return this.bodyWidth}getContainerWidth(t){switch(t){case"left":return this.leftWidth;case"right":return this.rightWidth;default:return this.bodyWidth}}getCenterCols(){return this.columnsCenter}getLeftCols(){return this.columnsLeft}getRightCols(){return this.columnsRight}getColBefore(t){const e=this.getAllCols(),i=e.indexOf(t);return i>0?e[i-1]:null}getGroupAtDirection(t,e){const i=t.getProvidedColumnGroup().getLevel()+t.getPaddingLevel(),n=t.getDisplayedLeafColumns(),r=e==="After"?Yn(n):n[0],s=`getCol${e}`;for(;;){const o=this[s](r);if(!o)return null;const a=this.getColGroupAtLevel(o,i);if(a!==t)return a}}getColGroupAtLevel(t,e){let i=t.getParent(),n,r;for(;n=i.getProvidedColumnGroup().getLevel(),r=i.getPaddingLevel(),!(n+r<=e);)i=i.getParent();return i}isPinningLeft(){return this.columnsLeft.length>0}isPinningRight(){return this.columnsRight.length>0}updateColsAndGroupsMap(){this.colsAndGroupsMap={};const t=e=>{this.colsAndGroupsMap[e.getUniqueId()]=e};qm(this.treeCenter,!1,t),qm(this.treeLeft,!1,t),qm(this.treeRight,!1,t)}isVisible(t){return this.colsAndGroupsMap[t.getUniqueId()]===t}updateOpenClosedVisibilityInColumnGroups(){const t=this.getAllTrees();qm(t,!1,e=>{Vs(e)&&e.calculateDisplayedColumns()})}getFirstColumn(){const t=this.gos.get("enableRtl"),e=["getLeftCols","getCenterCols","getRightCols"];t&&e.reverse();for(let i=0;i<e.length;i++){const n=this[e[i]]();if(n.length)return t?Yn(n):n[0]}return null}getColumnGroup(t,e){if(!t)return null;if(Vs(t))return t;const i=this.getAllTrees(),n=typeof e=="number";let r=null;return qm(i,!1,s=>{if(Vs(s)){const o=s;let a;n?a=t===o.getGroupId()&&e===o.getPartId():a=t===o.getGroupId(),a&&(r=o)}}),r}getColAfter(t){const e=this.getAllCols(),i=e.indexOf(t);return i<e.length-1?e[i+1]:null}isBodyWidthDirty(){return this.bodyWidthDirty}setBodyWidthDirty(){this.bodyWidthDirty=!0}getColsLeftWidth(){return yd(this.columnsLeft)}getDisplayedColumnsRightWidth(){return yd(this.columnsRight)}isColAtEdge(t,e){const i=this.getAllCols();if(!i.length)return!1;const n=e==="first";let r;if(Vs(t)){const s=t.getDisplayedLeafColumns();if(!s.length)return!1;r=n?s[0]:Yn(s)}else r=t;return(n?i[0]:Yn(i))===r}createGroups(t){const{columns:e,idCreator:i,pinned:n,oldDisplayedGroups:r,isStandaloneStructure:s}=t,o=this.mapOldGroupsById(r),a=[];let l=e;for(;l.length;){const u=l;l=[];let d=0;const p=v=>{const y=d;d=v;const w=u[y],O=(Vs(w)?w.getProvidedColumnGroup():w).getOriginalParent();if(O==null){for(let N=y;N<v;N++)a.push(u[N]);return}const P=this.createColGroup(O,i,o,n,s);for(let N=y;N<v;N++)P.addChild(u[N]);l.push(P)};for(let v=1;v<u.length;v++){const y=u[v],R=(Vs(y)?y.getProvidedColumnGroup():y).getOriginalParent(),O=u[d],N=(Vs(O)?O.getProvidedColumnGroup():O).getOriginalParent();R!==N&&p(v)}d<u.length&&p(u.length)}return s||this.setupParentsIntoCols(a,null),a}createColGroup(t,e,i,n,r){const s=t.getGroupId(),o=e.getInstanceIdForKey(s),a=wY(s,o);let l=i[a];return l&&l.getProvidedColumnGroup()!==t&&(l=null),oi(l)?l.reset():(l=new _Y(t,s,o,n),r||this.createBean(l)),l}mapOldGroupsById(t){const e={},i=n=>{n.forEach(r=>{if(Vs(r)){const s=r;e[r.getUniqueId()]=s,i(s.getChildren())}})};return t&&i(t),e}setupParentsIntoCols(t,e){t.forEach(i=>{if(i.setParent(e),Vs(i)){const n=i;this.setupParentsIntoCols(n.getChildren(),n)}})}};function qm(t,e,i){if(t)for(let n=0;n<t.length;n++){const r=t[n];if(Vs(r)){const s=e?r.getDisplayedChildren():r.getChildren();qm(s,e,i)}i(r)}}function KF(t){const e=[];return qm(t,!0,i=>{Tp(i)&&e.push(i)}),e}var SY=["columnEverythingChanged","newColumnsLoaded","columnPivotModeChanged","pivotMaxColumnsExceeded","columnRowGroupChanged","expandOrCollapseAll","columnPivotChanged","gridColumnsChanged","columnValueChanged","columnMoved","columnVisible","columnPinned","columnGroupOpened","columnResized","displayedColumnsChanged","virtualColumnsChanged","columnHeaderMouseOver","columnHeaderMouseLeave","columnHeaderClicked","columnHeaderContextMenu","asyncTransactionsFlushed","rowGroupOpened","rowDataUpdated","pinnedRowDataChanged","rangeSelectionChanged","cellSelectionChanged","chartCreated","chartRangeSelectionChanged","chartOptionsChanged","chartDestroyed","toolPanelVisibleChanged","toolPanelSizeChanged","modelUpdated","cutStart","cutEnd","pasteStart","pasteEnd","fillStart","fillEnd","cellSelectionDeleteStart","cellSelectionDeleteEnd","rangeDeleteStart","rangeDeleteEnd","undoStarted","undoEnded","redoStarted","redoEnded","cellClicked","cellDoubleClicked","cellMouseDown","cellContextMenu","cellValueChanged","cellEditRequest","rowValueChanged","headerFocused","cellFocused","rowSelected","selectionChanged","tooltipShow","tooltipHide","cellKeyDown","cellMouseOver","cellMouseOut","filterChanged","filterModified","filterOpened","advancedFilterBuilderVisibleChanged","sortChanged","virtualRowRemoved","rowClicked","rowDoubleClicked","gridReady","gridPreDestroyed","gridSizeChanged","viewportChanged","firstDataRendered","dragStarted","dragStopped","dragCancelled","rowEditingStarted","rowEditingStopped","cellEditingStarted","cellEditingStopped","bodyScroll","bodyScrollEnd","paginationChanged","componentStateChanged","storeRefreshed","stateUpdated","columnMenuVisibleChanged","contextMenuVisibleChanged","rowDragEnter","rowDragMove","rowDragLeave","rowDragEnd","rowDragCancel"],bxe=["scrollbarWidthChanged","keyShortcutChangedCellStart","keyShortcutChangedCellEnd","pinnedHeightChanged","cellFocusCleared","fullWidthRowFocused","checkboxChanged","heightScaleChanged","suppressMovableColumns","suppressMenuHide","suppressFieldDotNotation","columnPanelItemDragStart","columnPanelItemDragEnd","bodyHeightChanged","columnContainerWidthChanged","displayedColumnsWidthChanged","scrollVisibilityChanged","scrollGapChanged","columnHoverChanged","flashCells","paginationPixelOffsetChanged","displayedRowsChanged","leftPinnedWidthChanged","rightPinnedWidthChanged","rowContainerHeightChanged","headerHeightChanged","columnGroupHeaderHeightChanged","columnHeaderHeightChanged","gridStylesChanged","storeUpdated","filterDestroyed","rowDataUpdateStarted","rowCountReady","advancedFilterEnabledChanged","dataTypesInferred","fieldValueChanged","fieldPickerValueSelected","richSelectListRowSelected","sideBarUpdated","alignedGridScroll","alignedGridColumn","gridOptionsChanged","chartTitleEdit","recalculateRowBounds","stickyTopOffsetChanged","overlayExclusiveChanged"],wxe=[...SY,...bxe],_xe={enableBrowserTooltips:!0,tooltipTrigger:!0,tooltipMouseTrack:!0,tooltipShowMode:!0,tooltipInteraction:!0,defaultColGroupDef:!0,suppressAutoSize:!0,skipHeaderOnAutoSize:!0,autoSizeStrategy:!0,components:!0,stopEditingWhenCellsLoseFocus:!0,undoRedoCellEditing:!0,undoRedoCellEditingLimit:!0,excelStyles:!0,cacheQuickFilter:!0,advancedFilterModel:!0,customChartThemes:!0,chartThemeOverrides:!0,chartToolPanelsDef:!0,loadingCellRendererSelector:!0,localeText:!0,keepDetailRows:!0,keepDetailRowsCount:!0,detailRowHeight:!0,detailRowAutoHeight:!0,tabIndex:!0,valueCache:!0,valueCacheNeverExpires:!0,enableCellExpressions:!0,suppressTouch:!0,suppressAsyncEvents:!0,suppressBrowserResizeObserver:!0,suppressPropertyNamesCheck:!0,debug:!0,dragAndDropImageComponent:!0,loadingOverlayComponent:!0,suppressLoadingOverlay:!0,noRowsOverlayComponent:!0,paginationPageSizeSelector:!0,paginateChildRows:!0,pivotPanelShow:!0,pivotSuppressAutoColumn:!0,suppressExpandablePivotGroups:!0,aggFuncs:!0,suppressAggFuncInHeader:!0,allowShowChangeAfterFilter:!0,ensureDomOrder:!0,enableRtl:!0,suppressColumnVirtualisation:!0,suppressMaxRenderedRowRestriction:!0,suppressRowVirtualisation:!0,rowDragText:!0,suppressGroupMaintainValueType:!0,groupLockGroupColumns:!0,rowGroupPanelSuppressSort:!0,suppressGroupRowsSticky:!0,rowModelType:!0,cacheOverflowSize:!0,infiniteInitialRowCount:!0,serverSideInitialRowCount:!0,suppressServerSideInfiniteScroll:!0,maxBlocksInCache:!0,maxConcurrentDatasourceRequests:!0,blockLoadDebounceMillis:!0,serverSideOnlyRefreshFilteredGroups:!0,serverSidePivotResultFieldSeparator:!0,viewportRowModelPageSize:!0,viewportRowModelBufferSize:!0,debounceVerticalScrollbar:!0,suppressAnimationFrame:!0,suppressPreventDefaultOnMouseWheel:!0,scrollbarWidth:!0,icons:!0,suppressRowTransform:!0,gridId:!0,enableGroupEdit:!0,initialState:!0,processUnpinnedColumns:!0,createChartContainer:!0,getLocaleText:!0,getRowId:!0,reactiveCustomComponents:!0,columnMenu:!0,suppressSetFilterByDefault:!0},aa=class{};aa.STRING_PROPERTIES=["overlayLoadingTemplate","overlayNoRowsTemplate","gridId","quickFilterText","rowModelType","editType","domLayout","clipboardDelimiter","rowGroupPanelShow","multiSortKey","pivotColumnGroupTotals","pivotRowTotals","pivotPanelShow","fillHandleDirection","groupDisplayType","treeDataDisplayType","colResizeDefault","tooltipTrigger","serverSidePivotResultFieldSeparator","columnMenu","tooltipShowMode","grandTotalRow"];aa.OBJECT_PROPERTIES=["components","rowStyle","context","autoGroupColumnDef","localeText","icons","datasource","dragAndDropImageComponentParams","serverSideDatasource","viewportDatasource","groupRowRendererParams","aggFuncs","fullWidthCellRendererParams","defaultColGroupDef","defaultColDef","defaultCsvExportParams","defaultExcelExportParams","columnTypes","rowClassRules","detailCellRendererParams","loadingCellRendererParams","loadingOverlayComponentParams","noRowsOverlayComponentParams","popupParent","statusBar","sideBar","theme","chartThemeOverrides","customChartThemes","chartToolPanelsDef","dataTypeDefinitions","advancedFilterModel","advancedFilterParent","advancedFilterBuilderParams","initialState","autoSizeStrategy","cellSelection","selectionColumnDef"];aa.ARRAY_PROPERTIES=["sortingOrder","alignedGrids","rowData","columnDefs","excelStyles","pinnedTopRowData","pinnedBottomRowData","chartThemes","rowClass","paginationPageSizeSelector"];aa.NUMBER_PROPERTIES=["rowHeight","detailRowHeight","rowBuffer","headerHeight","groupHeaderHeight","groupLockGroupColumns","floatingFiltersHeight","pivotHeaderHeight","pivotGroupHeaderHeight","groupDefaultExpanded","pivotDefaultExpanded","viewportRowModelPageSize","viewportRowModelBufferSize","autoSizePadding","maxBlocksInCache","maxConcurrentDatasourceRequests","tooltipShowDelay","tooltipHideDelay","cacheOverflowSize","paginationPageSize","cacheBlockSize","infiniteInitialRowCount","serverSideInitialRowCount","scrollbarWidth","asyncTransactionWaitMillis","blockLoadDebounceMillis","keepDetailRowsCount","undoRedoCellEditingLimit","cellFlashDelay","cellFadeDelay","cellFlashDuration","cellFadeDuration","tabIndex","pivotMaxGeneratedColumns"];aa.BOOLEAN_PROPERTIES=["suppressMakeColumnVisibleAfterUnGroup","suppressRowClickSelection","suppressCellFocus","suppressHeaderFocus","suppressHorizontalScroll","groupSelectsChildren","alwaysShowHorizontalScroll","alwaysShowVerticalScroll","debug","enableBrowserTooltips","enableCellExpressions","groupIncludeTotalFooter","groupSuppressBlankHeader","suppressMenuHide","suppressRowDeselection","unSortIcon","suppressMultiSort","alwaysMultiSort","singleClickEdit","suppressLoadingOverlay","suppressNoRowsOverlay","suppressAutoSize","skipHeaderOnAutoSize","suppressColumnMoveAnimation","suppressMoveWhenColumnDragging","suppressMovableColumns","suppressFieldDotNotation","enableRangeSelection","enableRangeHandle","enableFillHandle","suppressClearOnFillReduction","deltaSort","suppressTouch","suppressAsyncEvents","allowContextMenuWithControlKey","suppressContextMenu","enableCellChangeFlash","suppressDragLeaveHidesColumns","suppressRowGroupHidesColumns","suppressMiddleClickScrolls","suppressPreventDefaultOnMouseWheel","suppressCopyRowsToClipboard","copyHeadersToClipboard","copyGroupHeadersToClipboard","pivotMode","suppressAggFuncInHeader","suppressColumnVirtualisation","alwaysAggregateAtRootLevel","suppressFocusAfterRefresh","functionsReadOnly","animateRows","groupSelectsFiltered","groupRemoveSingleChildren","groupRemoveLowestSingleChildren","enableRtl","suppressClickEdit","rowDragEntireRow","rowDragManaged","suppressRowDrag","suppressMoveWhenRowDragging","rowDragMultiRow","enableGroupEdit","embedFullWidthRows","suppressPaginationPanel","groupHideOpenParents","groupAllowUnbalanced","pagination","paginationAutoPageSize","suppressScrollOnNewData","suppressScrollWhenPopupsAreOpen","purgeClosedRowNodes","cacheQuickFilter","includeHiddenColumnsInQuickFilter","ensureDomOrder","accentedSort","suppressChangeDetection","valueCache","valueCacheNeverExpires","aggregateOnlyChangedColumns","suppressAnimationFrame","suppressExcelExport","suppressCsvExport","includeHiddenColumnsInAdvancedFilter","suppressMultiRangeSelection","enterNavigatesVerticallyAfterEdit","enterNavigatesVertically","suppressPropertyNamesCheck","rowMultiSelectWithClick","suppressRowHoverHighlight","suppressRowTransform","suppressClipboardPaste","suppressLastEmptyLineOnPaste","enableCharts","suppressMaintainUnsortedOrder","enableCellTextSelection","suppressBrowserResizeObserver","suppressMaxRenderedRowRestriction","excludeChildrenWhenTreeDataFiltering","tooltipMouseTrack","tooltipInteraction","keepDetailRows","paginateChildRows","preventDefaultOnContextMenu","undoRedoCellEditing","allowDragFromColumnsToolPanel","pivotSuppressAutoColumn","suppressExpandablePivotGroups","debounceVerticalScrollbar","detailRowAutoHeight","serverSideSortAllLevels","serverSideEnableClientSideSort","serverSideOnlyRefreshFilteredGroups","serverSideSortOnServer","serverSideFilterOnServer","suppressAggFilteredOnly","showOpenedGroup","suppressClipboardApi","suppressModelUpdateAfterUpdateTransaction","stopEditingWhenCellsLoseFocus","groupMaintainOrder","columnHoverHighlight","readOnlyEdit","suppressRowVirtualisation","enableCellEditingOnBackspace","resetRowDataOnUpdate","removePivotHeaderRowWhenSingleValueColumn","suppressCopySingleCellRanges","suppressGroupRowsSticky","suppressCutToClipboard","suppressServerSideInfiniteScroll","rowGroupPanelSuppressSort","allowShowChangeAfterFilter","enableAdvancedFilter","masterDetail","treeData","suppressGroupMaintainValueType","reactiveCustomComponents","applyQuickFilterBeforePivotOrAgg","suppressServerSideFullWidthLoadingRow","suppressAdvancedFilterEval","loading","maintainColumnOrder","enableStrictPivotColumnOrder","suppressSetFilterByDefault"];aa.OTHER_PROPERTIES=["suppressStickyTotalRow","loadThemeGoogleFonts","rowSelection"];aa.FUNCTION_PROPERTIES=["doesExternalFilterPass","processPivotResultColDef","processPivotResultColGroupDef","getBusinessKeyForNode","isRowSelectable","rowDragText","groupRowRenderer","dragAndDropImageComponent","fullWidthCellRenderer","loadingCellRenderer","loadingOverlayComponent","noRowsOverlayComponent","detailCellRenderer","quickFilterParser","quickFilterMatcher","getLocaleText","isExternalFilterPresent","getRowHeight","getRowClass","getRowStyle","getContextMenuItems","getMainMenuItems","processRowPostCreate","processCellForClipboard","getGroupRowAgg","isFullWidthRow","sendToClipboard","focusGridInnerElement","navigateToNextHeader","tabToNextHeader","navigateToNextCell","tabToNextCell","processCellFromClipboard","getDocument","postProcessPopup","getChildCount","getDataPath","isRowMaster","postSortRows","processHeaderForClipboard","processUnpinnedColumns","processGroupHeaderForClipboard","paginationNumberFormatter","processDataFromClipboard","getServerSideGroupKey","isServerSideGroup","createChartContainer","getChartToolbarItems","fillOperation","isApplyServerSideTransaction","getServerSideGroupLevelParams","isServerSideGroupOpenByDefault","isGroupOpenByDefault","initialGroupOrderComparator","groupIncludeFooter","loadingCellRendererSelector","getRowId","groupAggFiltering","chartMenuItems","groupTotalRow"];aa.ALL_PROPERTIES=[...aa.ARRAY_PROPERTIES,...aa.OBJECT_PROPERTIES,...aa.STRING_PROPERTIES,...aa.NUMBER_PROPERTIES,...aa.FUNCTION_PROPERTIES,...aa.BOOLEAN_PROPERTIES,...aa.OTHER_PROPERTIES];var H_=aa,zc=class{static getCallbackForEvent(e){return!e||e.length<2?e:"on"+e[0].toUpperCase()+e.substring(1)}};zc.VUE_OMITTED_PROPERTY="AG-VUE-OMITTED-PROPERTY";zc.PUBLIC_EVENTS=SY;zc.EVENT_CALLBACKS=wxe.map(t=>zc.getCallbackForEvent(t));zc.BOOLEAN_PROPERTIES=H_.BOOLEAN_PROPERTIES;zc.ALL_PROPERTIES=H_.ALL_PROPERTIES;zc.ALL_PROPERTIES_AND_CALLBACKS=[...zc.ALL_PROPERTIES,...zc.EVENT_CALLBACKS];zc.ALL_PROPERTIES_AND_CALLBACKS_SET=new Set(zc.ALL_PROPERTIES_AND_CALLBACKS);var OY=zc;function BC(t,e,i){return i&&t.addDestroyFunc(()=>e.destroyBean(i)),i??t}var Cxe=class{constructor(t){this.cssClassStates={},this.getGui=t}addCssClass(t){const e=(t||"").split(" ");if(e.length>1){e.forEach(n=>this.addCssClass(n));return}if(this.cssClassStates[t]!==!0&&t.length){const n=this.getGui();n&&n.classList.add(t),this.cssClassStates[t]=!0}}removeCssClass(t){const e=(t||"").split(" ");if(e.length>1){e.forEach(n=>this.removeCssClass(n));return}if(this.cssClassStates[t]!==!1&&t.length){const n=this.getGui();n&&n.classList.remove(t),this.cssClassStates[t]=!1}}containsCssClass(t){const e=this.getGui();return e?e.classList.contains(t):!1}addOrRemoveCssClass(t,e){if(!t)return;if(t.indexOf(" ")>=0){const n=(t||"").split(" ");if(n.length>1){n.forEach(r=>this.addOrRemoveCssClass(r,e));return}}if(this.cssClassStates[t]!==e&&t.length){const n=this.getGui();n&&n.classList.toggle(t,e),this.cssClassStates[t]=e}}};function nf(t,e,i){i==null||typeof i=="string"&&i==""?MY(t,e):Pu(t,e,i)}function Pu(t,e,i){t.setAttribute(TY(e),i.toString())}function MY(t,e){t.removeAttribute(TY(e))}function TY(t){return`aria-${t}`}function nc(t,e){e?t.setAttribute("role",e):t.removeAttribute("role")}function Sxe(t){let e;return t==="asc"?e="ascending":t==="desc"?e="descending":t==="mixed"?e="other":e="none",e}function Oxe(t){return t.getAttribute("aria-label")}function O0(t,e){nf(t,"label",e)}function $_(t,e){nf(t,"labelledby",e)}function RY(t,e){nf(t,"live",e)}function Mxe(t,e){nf(t,"atomic",e)}function Txe(t,e){nf(t,"relevant",e)}function Rxe(t,e){nf(t,"disabled",e)}function PY(t,e){nf(t,"hidden",e)}function MT(t,e){Pu(t,"expanded",e)}function Pxe(t,e){Pu(t,"setsize",e)}function Exe(t,e){Pu(t,"posinset",e)}function Axe(t,e){Pu(t,"multiselectable",e)}function Ixe(t,e){Pu(t,"rowcount",e)}function EY(t,e){Pu(t,"rowindex",e)}function kxe(t,e){Pu(t,"colcount",e)}function AY(t,e){Pu(t,"colindex",e)}function Dxe(t,e){Pu(t,"colspan",e)}function Lxe(t,e){Pu(t,"sort",e)}function Fxe(t){MY(t,"sort")}function TT(t,e){nf(t,"selected",e)}function Nxe(t,e){nf(t,"controls",e.id),$_(e,t.id)}function oU(t,e){return e===void 0?t("ariaIndeterminate","indeterminate"):e===!0?t("ariaChecked","checked"):t("ariaUnchecked","unchecked")}var YF,$1,JF,eN,tN,iN,xz,bz,nN;function Th(){return YF===void 0&&(YF=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),YF}function IY(){if($1===void 0)if(Th()){const t=navigator.userAgent.match(/version\/(\d+)/i);t&&($1=t[1]!=null?parseFloat(t[1]):0)}else $1=0;return $1}function aU(){if(JF===void 0){const t=window;JF=!!t.chrome&&(!!t.chrome.webstore||!!t.chrome.runtime)||/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}return JF}function lU(){return eN===void 0&&(eN=/(firefox)/i.test(navigator.userAgent)),eN}function kY(){return tN===void 0&&(tN=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)),tN}function Np(){return iN===void 0&&(iN=/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1),iN}function wz(){return!Th()||IY()>=15}function _z(t){if(!t)return null;const e=t.tabIndex,i=t.getAttribute("tabIndex");return e===-1&&(i===null||i===""&&!lU())?null:e.toString()}function Bxe(){if(nN!==void 0)return nN;if(!document.body)return-1;let t=1e6;const e=lU()?6e6:1e9,i=document.createElement("div");for(document.body.appendChild(i);;){const n=t*2;if(i.style.height=n+"px",n>e||i.clientHeight!==n)break;t=n}return document.body.removeChild(i),nN=t,t}function zxe(){return document.body?.clientWidth??(window.innerHeight||document.documentElement?.clientWidth||-1)}function Vxe(){return document.body?.clientHeight??(window.innerHeight||document.documentElement?.clientHeight||-1)}function Gxe(){return bz==null&&DY(),bz}function DY(){const t=document.body,e=document.createElement("div");e.style.width=e.style.height="100px",e.style.opacity="0",e.style.overflow="scroll",e.style.msOverflowStyle="scrollbar",e.style.position="absolute",t.appendChild(e);let i=e.offsetWidth-e.clientWidth;i===0&&e.clientWidth===0&&(i=null),e.parentNode&&e.parentNode.removeChild(e),i!=null&&(bz=i,xz=i===0)}function LY(){return xz==null&&DY(),xz}var W1,Uxe="[tabindex], input, select, button, textarea, [href]",FY="[disabled], .ag-disabled:not(.ag-button), .ag-disabled *";function cU(t){const e=Element.prototype.matches||Element.prototype.msMatchesSelector,n=e.call(t,"input, select, button, textarea"),r=e.call(t,FY),s=Ou(t);return n&&!r&&s}function Xr(t,e,i={}){const{skipAriaHidden:n}=i;t.classList.toggle("ag-hidden",!e),n||PY(t,!e)}function Hxe(t,e,i={}){const{skipAriaHidden:n}=i;t.classList.toggle("ag-invisible",!e),n||PY(t,!e)}function W_(t,e){const i="disabled",n=e?r=>r.setAttribute(i,""):r=>r.removeAttribute(i);n(t),HY(t.querySelectorAll("input"),r=>n(r))}function e0(t,e,i){let n=0;for(;t;){if(t.classList.contains(e))return!0;if(t=t.parentElement,typeof i=="number"){if(++n>i)break}else if(t===i)break}return!1}function Xg(t){const{height:e,width:i,borderTopWidth:n,borderRightWidth:r,borderBottomWidth:s,borderLeftWidth:o,paddingTop:a,paddingRight:l,paddingBottom:u,paddingLeft:d,marginTop:p,marginRight:v,marginBottom:y,marginLeft:w,boxSizing:R}=window.getComputedStyle(t);return{height:parseFloat(e||"0"),width:parseFloat(i||"0"),borderTopWidth:parseFloat(n||"0"),borderRightWidth:parseFloat(r||"0"),borderBottomWidth:parseFloat(s||"0"),borderLeftWidth:parseFloat(o||"0"),paddingTop:parseFloat(a||"0"),paddingRight:parseFloat(l||"0"),paddingBottom:parseFloat(u||"0"),paddingLeft:parseFloat(d||"0"),marginTop:parseFloat(p||"0"),marginRight:parseFloat(v||"0"),marginBottom:parseFloat(y||"0"),marginLeft:parseFloat(w||"0"),boxSizing:R}}function uU(t){const e=Xg(t);return e.boxSizing==="border-box"?e.height-e.paddingTop-e.paddingBottom:e.height}function zC(t){const e=Xg(t);return e.boxSizing==="border-box"?e.width-e.paddingLeft-e.paddingRight:e.width}function NY(t){const{height:e,marginBottom:i,marginTop:n}=Xg(t);return Math.floor(e+i+n)}function RT(t){const{width:e,marginLeft:i,marginRight:n}=Xg(t);return Math.floor(e+i+n)}function BY(t){const e=t.getBoundingClientRect(),{borderTopWidth:i,borderLeftWidth:n,borderRightWidth:r,borderBottomWidth:s}=Xg(t);return{top:e.top+(i||0),left:e.left+(n||0),right:e.right+(r||0),bottom:e.bottom+(s||0)}}function PT(){if(typeof W1=="boolean")return W1;const t=document.createElement("div");return t.style.direction="rtl",t.style.width="1px",t.style.height="1px",t.style.position="fixed",t.style.top="0px",t.style.overflow="hidden",t.dir="rtl",t.innerHTML=`<div style="width: 2px">
            <span style="display: inline-block; width: 1px"></span>
            <span style="display: inline-block; width: 1px"></span>
        </div>`,document.body.appendChild(t),t.scrollLeft=1,W1=Math.floor(t.scrollLeft)===0,document.body.removeChild(t),W1}function ET(t,e){let i=t.scrollLeft;return e&&(i=Math.abs(i),aU()&&!PT()&&(i=t.scrollWidth-t.getBoundingClientRect().width-i)),i}function AT(t,e,i){i&&(PT()?e*=-1:(Th()||aU())&&(e=t.scrollWidth-t.getBoundingClientRect().width-e)),t.scrollLeft=e}function fa(t){for(;t&&t.firstChild;)t.removeChild(t.firstChild)}function hh(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function zY(t){return!!t.offsetParent}function Ou(t){const e=t;return e.checkVisibility?e.checkVisibility({checkVisibilityCSS:!0}):!(!zY(t)||window.getComputedStyle(t).visibility!=="visible")}function q_(t){const e=document.createElement("div");return e.innerHTML=(t||"").trim(),e.firstChild}function VY(t,e,i){i&&i.nextSibling===e||(t.firstChild?i?i.nextSibling?t.insertBefore(e,i.nextSibling):t.appendChild(e):t.firstChild&&t.firstChild!==e&&t.insertAdjacentElement("afterbegin",e):t.appendChild(e))}function GY(t,e){for(let i=0;i<e.length;i++){const n=e[i],r=t.children[i];r!==n&&t.insertBefore(n,r)}}function UY(t,e){if(e)for(const[i,n]of Object.entries(e)){if(!i||!i.length||n==null)continue;const r=mxe(i),s=n.toString(),o=s.replace(/\s*!important/g,""),a=o.length!=s.length?"important":void 0;t.style.setProperty(r,o,a)}}function $xe(t){return t.clientWidth<t.scrollWidth}function Wxe(t){return t.clientHeight<t.scrollHeight}function IT(t,e){e==="flex"?(t.style.removeProperty("width"),t.style.removeProperty("minWidth"),t.style.removeProperty("maxWidth"),t.style.flex="1 1 auto"):_u(t,e)}function _u(t,e){e=hU(e),t.style.width=e.toString(),t.style.maxWidth=e.toString(),t.style.minWidth=e.toString()}function jw(t,e){e=hU(e),t.style.height=e.toString(),t.style.maxHeight=e.toString(),t.style.minHeight=e.toString()}function hU(t){return typeof t=="number"?`${t}px`:t}function dU(t){return t instanceof Node||t instanceof HTMLElement}function qxe(t){if(t==null)return[];const e=[];return HY(t,i=>e.push(i)),e}function jxe(t,e){if(t)for(let i=0;i<t.length;i++){const n=t[i];e(n.name,n.value)}}function Vc(t,e,i){i==null||i===""?t.removeAttribute(e):t.setAttribute(e,i.toString())}function HY(t,e){if(t!=null)for(let i=0;i<t.length;i++)e(t[i])}var M0=class{constructor(t=0,e=1){this.nextValue=t,this.step=e}next(){const t=this.nextValue;return this.nextValue+=this.step,t}peek(){return this.nextValue}skip(t){this.nextValue+=t}},Qxe=1e3,Zxe=1e3,a6=100,$Y=class Bm extends kt{constructor(e,i,n,r){super(),this.parentComp=e,this.tooltipShowDelayOverride=i,this.tooltipHideDelayOverride=n,this.shouldDisplayTooltip=r,this.interactionEnabled=!1,this.isInteractingWithTooltip=!1,this.state=0,this.tooltipInstanceCount=0,this.tooltipMouseTrack=!1}wireBeans(e){this.popupService=e.popupService,this.userComponentFactory=e.userComponentFactory}postConstruct(){this.gos.get("tooltipInteraction")&&(this.interactionEnabled=!0),this.tooltipTrigger=this.getTooltipTrigger(),this.tooltipMouseTrack=this.gos.get("tooltipMouseTrack");const e=this.parentComp.getGui();this.tooltipTrigger===0&&this.addManagedListeners(e,{mouseenter:this.onMouseEnter.bind(this),mouseleave:this.onMouseLeave.bind(this)}),this.tooltipTrigger===1&&this.addManagedListeners(e,{focusin:this.onFocusIn.bind(this),focusout:this.onFocusOut.bind(this)}),this.addManagedListeners(e,{mousemove:this.onMouseMove.bind(this)}),this.interactionEnabled||this.addManagedListeners(e,{mousedown:this.onMouseDown.bind(this),keydown:this.onKeyDown.bind(this)})}getGridOptionsTooltipDelay(e){const i=this.gos.get(e);return i<0&&Wt(`${e} should not be lower than 0`),Math.max(200,i)}getTooltipDelay(e){return e==="show"?this.tooltipShowDelayOverride??this.getGridOptionsTooltipDelay("tooltipShowDelay"):this.tooltipHideDelayOverride??this.getGridOptionsTooltipDelay("tooltipHideDelay")}destroy(){this.setToDoNothing(),super.destroy()}getTooltipTrigger(){const e=this.gos.get("tooltipTrigger");return!e||e==="hover"?0:1}onMouseEnter(e){this.interactionEnabled&&this.interactiveTooltipTimeoutId&&(this.unlockService(),this.startHideTimeout()),!Np()&&(Bm.isLocked?this.showTooltipTimeoutId=window.setTimeout(()=>{this.prepareToShowTooltip(e)},a6):this.prepareToShowTooltip(e))}onMouseMove(e){this.lastMouseEvent&&(this.lastMouseEvent=e),this.tooltipMouseTrack&&this.state===2&&this.tooltipComp&&this.positionTooltip()}onMouseDown(){this.setToDoNothing()}onMouseLeave(){this.interactionEnabled?this.lockService():this.setToDoNothing()}onFocusIn(){this.prepareToShowTooltip()}onFocusOut(e){const i=e.relatedTarget,n=this.parentComp.getGui(),r=this.tooltipComp?.getGui();this.isInteractingWithTooltip||n.contains(i)||this.interactionEnabled&&r?.contains(i)||this.setToDoNothing()}onKeyDown(){this.isInteractingWithTooltip&&(this.isInteractingWithTooltip=!1),this.setToDoNothing()}prepareToShowTooltip(e){if(this.state!=0||Bm.isLocked)return;let i=0;e&&(i=this.isLastTooltipHiddenRecently()?200:this.getTooltipDelay("show")),this.lastMouseEvent=e||null,this.showTooltipTimeoutId=window.setTimeout(this.showTooltip.bind(this),i),this.state=1}isLastTooltipHiddenRecently(){const e=new Date().getTime(),i=Bm.lastTooltipHideTime;return e-i<Qxe}setToDoNothing(e){!e&&this.state===2&&this.hideTooltip(),this.onBodyScrollEventCallback&&(this.onBodyScrollEventCallback(),this.onBodyScrollEventCallback=void 0),this.onColumnMovedEventCallback&&(this.onColumnMovedEventCallback(),this.onColumnMovedEventCallback=void 0),this.onDocumentKeyDownCallback&&(this.onDocumentKeyDownCallback(),this.onDocumentKeyDownCallback=void 0),this.clearTimeouts(),this.state=0,this.lastMouseEvent=null}showTooltip(){const e={...this.parentComp.getTooltipParams()};if(!oi(e.value)||this.shouldDisplayTooltip&&!this.shouldDisplayTooltip()){this.setToDoNothing();return}this.state=2,this.tooltipInstanceCount++;const i=this.newTooltipComponentCallback.bind(this,this.tooltipInstanceCount);this.userComponentFactory.getTooltipCompDetails(e).newAgStackInstance().then(i)}hideTooltip(e){!e&&this.isInteractingWithTooltip||(this.tooltipComp&&(this.destroyTooltipComp(),Bm.lastTooltipHideTime=new Date().getTime()),this.eventService.dispatchEvent({type:"tooltipHide",parentGui:this.parentComp.getGui()}),e&&(this.isInteractingWithTooltip=!1),this.setToDoNothing(!0))}newTooltipComponentCallback(e,i){if(this.state!==2||this.tooltipInstanceCount!==e){this.destroyBean(i);return}const r=i.getGui();this.tooltipComp=i,r.classList.contains("ag-tooltip")||r.classList.add("ag-tooltip-custom"),this.tooltipTrigger===0&&r.classList.add("ag-tooltip-animate"),this.interactionEnabled&&r.classList.add("ag-tooltip-interactive");const s=this.localeService.getLocaleTextFunc(),o=this.popupService.addPopup({eChild:r,ariaLabel:s("ariaLabelTooltip","Tooltip")});if(o&&(this.tooltipPopupDestroyFunc=o.hideFunc),this.positionTooltip(),this.tooltipTrigger===1){const a=()=>this.setToDoNothing();[this.onBodyScrollEventCallback,this.onColumnMovedEventCallback]=this.addManagedEventListeners({bodyScroll:a,columnMoved:a})}this.interactionEnabled&&([this.tooltipMouseEnterListener,this.tooltipMouseLeaveListener]=this.addManagedElementListeners(r,{mouseenter:this.onTooltipMouseEnter.bind(this),mouseleave:this.onTooltipMouseLeave.bind(this)}),[this.onDocumentKeyDownCallback]=this.addManagedElementListeners(Rs(this.gos),{keydown:a=>{r.contains(a?.target)||this.onKeyDown()}}),this.tooltipTrigger===1&&([this.tooltipFocusInListener,this.tooltipFocusOutListener]=this.addManagedElementListeners(r,{focusin:this.onTooltipFocusIn.bind(this),focusout:this.onTooltipFocusOut.bind(this)}))),this.eventService.dispatchEvent({type:"tooltipShow",tooltipGui:r,parentGui:this.parentComp.getGui()}),this.startHideTimeout()}onTooltipMouseEnter(){this.isInteractingWithTooltip=!0,this.unlockService()}onTooltipMouseLeave(){this.isTooltipFocused()||(this.isInteractingWithTooltip=!1,this.lockService())}onTooltipFocusIn(){this.isInteractingWithTooltip=!0}isTooltipFocused(){const e=this.tooltipComp?.getGui(),i=Jr(this.gos);return!!e&&e.contains(i)}onTooltipFocusOut(e){const i=this.parentComp.getGui();this.isTooltipFocused()||(this.isInteractingWithTooltip=!1,i.contains(e.relatedTarget)?this.startHideTimeout():this.hideTooltip())}positionTooltip(){const e={type:"tooltip",ePopup:this.tooltipComp.getGui(),nudgeY:18,skipObserver:this.tooltipMouseTrack};this.lastMouseEvent?this.popupService.positionPopupUnderMouseEvent({...e,mouseEvent:this.lastMouseEvent}):this.popupService.positionPopupByComponent({...e,eventSource:this.parentComp.getGui(),position:"under",keepWithinBounds:!0,nudgeY:5})}destroyTooltipComp(){this.tooltipComp.getGui().classList.add("ag-tooltip-hiding");const e=this.tooltipPopupDestroyFunc,i=this.tooltipComp,n=this.tooltipTrigger===0?Zxe:0;window.setTimeout(()=>{e(),this.destroyBean(i)},n),this.clearTooltipListeners(),this.tooltipPopupDestroyFunc=void 0,this.tooltipComp=void 0}clearTooltipListeners(){[this.tooltipMouseEnterListener,this.tooltipMouseLeaveListener,this.tooltipFocusInListener,this.tooltipFocusOutListener].forEach(e=>{e&&e()}),this.tooltipMouseEnterListener=this.tooltipMouseLeaveListener=this.tooltipFocusInListener=this.tooltipFocusOutListener=null}lockService(){Bm.isLocked=!0,this.interactiveTooltipTimeoutId=window.setTimeout(()=>{this.unlockService(),this.setToDoNothing()},a6)}unlockService(){Bm.isLocked=!1,this.clearInteractiveTimeout()}startHideTimeout(){this.clearHideTimeout(),this.hideTooltipTimeoutId=window.setTimeout(this.hideTooltip.bind(this),this.getTooltipDelay("hide"))}clearShowTimeout(){this.showTooltipTimeoutId&&(window.clearTimeout(this.showTooltipTimeoutId),this.showTooltipTimeoutId=void 0)}clearHideTimeout(){this.hideTooltipTimeoutId&&(window.clearTimeout(this.hideTooltipTimeoutId),this.hideTooltipTimeoutId=void 0)}clearInteractiveTimeout(){this.interactiveTooltipTimeoutId&&(window.clearTimeout(this.interactiveTooltipTimeoutId),this.interactiveTooltipTimeoutId=void 0)}clearTimeouts(){this.clearShowTimeout(),this.clearHideTimeout(),this.clearInteractiveTimeout()}};$Y.isLocked=!1;var Xxe=$Y,nx=class extends kt{constructor(t,e){super(),this.ctrl=t,e&&(this.beans=e)}wireBeans(t){this.beans=t}postConstruct(){this.refreshToolTip()}setBrowserTooltip(t){const e="title",i=this.ctrl.getGui();i&&(t!=null&&t!=""?i.setAttribute(e,t):i.removeAttribute(e))}updateTooltipText(){this.tooltip=this.ctrl.getTooltipValue()}createTooltipFeatureIfNeeded(){if(this.tooltipManager!=null)return;const t={getTooltipParams:()=>this.getTooltipParams(),getGui:()=>this.ctrl.getGui()};this.tooltipManager=this.createBean(new Xxe(t,this.ctrl.getTooltipShowDelayOverride?.(),this.ctrl.getTooltipHideDelayOverride?.(),this.ctrl.shouldDisplayTooltip),this.beans.context)}refreshToolTip(){this.browserTooltips=this.beans.gos.get("enableBrowserTooltips"),this.updateTooltipText(),this.browserTooltips?(this.setBrowserTooltip(this.tooltip),this.tooltipManager&&(this.tooltipManager=this.destroyBean(this.tooltipManager,this.beans.context))):(this.setBrowserTooltip(null),this.createTooltipFeatureIfNeeded())}getTooltipParams(){const t=this.ctrl,e=t.getColumn?.(),i=t.getColDef?.(),n=t.getRowNode?.();return{location:t.getLocation(),colDef:i,column:e,rowIndex:t.getRowIndex?.(),node:n,data:n?.data,value:this.getTooltipText(),valueFormatted:t.getValueFormatted?.(),hideTooltipCallback:()=>this.tooltipManager?.hideTooltip(!0)}}getTooltipText(){return this.tooltip}destroy(){this.tooltipManager&&(this.tooltipManager=this.destroyBean(this.tooltipManager,this.beans.context)),super.destroy()}},Kxe=new M0,bi=null,ir=class WY extends kt{constructor(e,i){super(),this.suppressDataRefValidation=!1,this.displayed=!0,this.visible=!0,this.compId=Kxe.next(),this.cssClassManager=new Cxe(()=>this.eGui),this.componentSelectors=new Map((i??[]).map(n=>[n.selector,n])),e&&this.setTemplate(e)}preWireBeans(e){super.preWireBeans(e)}preConstruct(){this.usingBrowserTooltips=this.gos.get("enableBrowserTooltips"),this.wireTemplate(this.getGui())}wireTemplate(e,i){e&&this.gos&&(this.applyElementsToComponent(e),this.createChildComponentsFromTags(e,i))}getCompId(){return this.compId}getTooltipParams(){return{value:this.tooltipText,location:"UNKNOWN"}}setTooltip(e){const{newTooltipText:i,showDelayOverride:n,hideDelayOverride:r,location:s,shouldDisplayTooltip:o}=e||{};this.tooltipFeature&&(this.tooltipFeature=this.destroyBean(this.tooltipFeature)),this.tooltipText!==i&&(this.tooltipText=i);const a=()=>this.tooltipText;i!=null&&(this.tooltipFeature=this.createBean(new nx({getTooltipValue:a,getGui:()=>this.getGui(),getLocation:()=>s??"UNKNOWN",getColDef:e?.getColDef,getColumn:e?.getColumn,getTooltipShowDelayOverride:n!=null?()=>n:void 0,getTooltipHideDelayOverride:r!=null?()=>r:void 0,shouldDisplayTooltip:o})))}getDataRefAttribute(e){return e.getAttribute?e.getAttribute("data-ref"):null}applyElementsToComponent(e,i,n,r=null){if(i===void 0&&(i=this.getDataRefAttribute(e)),i){const s=this[i];if(s===bi)this[i]=r??e;else{const o=n&&n[i];!this.suppressDataRefValidation&&!o&&Wt(`Issue with data-ref: ${i} on ${this.constructor.name} with ${s}`)}}}createChildComponentsFromTags(e,i){qxe(e.childNodes).forEach(r=>{if(!(r instanceof HTMLElement))return;const s=this.createComponentFromElement(r,o=>{o.getGui()&&this.copyAttributesFromNode(r,o.getGui())},i);if(s){if(s.addItems&&r.children.length){this.createChildComponentsFromTags(r,i);const o=Array.prototype.slice.call(r.children);s.addItems(o)}this.swapComponentForNode(s,e,r)}else r.childNodes&&this.createChildComponentsFromTags(r,i)})}createComponentFromElement(e,i,n){const r=e.nodeName,s=this.getDataRefAttribute(e),o=r.indexOf("AG-")===0,a=o?this.componentSelectors.get(r):null;let l=null;if(a){WY.elementGettingCreated=e;const u=n&&s?n[s]:void 0;l=new a.component(u),l.setParentComponent(this),this.createBean(l,null,i)}else o&&Wt(`Missing selector: ${r}`);return this.applyElementsToComponent(e,s,n,l),l}copyAttributesFromNode(e,i){jxe(e.attributes,(n,r)=>i.setAttribute(n,r))}swapComponentForNode(e,i,n){const r=e.getGui();i.replaceChild(r,n),i.insertBefore(document.createComment(n.nodeName),r),this.addDestroyFunc(this.destroyBean.bind(this,e))}activateTabIndex(e){const i=this.gos.get("tabIndex");e||(e=[]),e.length||e.push(this.getGui()),e.forEach(n=>n.setAttribute("tabindex",i.toString()))}setTemplate(e,i,n){const r=q_(e);this.setTemplateFromElement(r,i,n)}setTemplateFromElement(e,i,n,r=!1){if(this.eGui=e,this.suppressDataRefValidation=r,i)for(let s=0;s<i.length;s++){const o=i[s];this.componentSelectors.set(o.selector,o)}this.wireTemplate(e,n)}getGui(){return this.eGui}getFocusableElement(){return this.eGui}getAriaElement(){return this.getFocusableElement()}setParentComponent(e){this.parentComponent=e}getParentComponent(){return this.parentComponent}setGui(e){this.eGui=e}queryForHtmlElement(e){return this.eGui.querySelector(e)}getContainerAndElement(e,i){let n=i;return e==null?null:(n||(n=this.eGui),dU(e)?{element:e,parent:n}:{element:e.getGui(),parent:n})}prependChild(e,i){const{element:n,parent:r}=this.getContainerAndElement(e,i)||{};!n||!r||r.insertAdjacentElement("afterbegin",n)}appendChild(e,i){const{element:n,parent:r}=this.getContainerAndElement(e,i)||{};!n||!r||r.appendChild(n)}isDisplayed(){return this.displayed}setVisible(e,i={}){if(e!==this.visible){this.visible=e;const{skipAriaHidden:n}=i;Hxe(this.eGui,e,{skipAriaHidden:n})}}setDisplayed(e,i={}){if(e!==this.displayed){this.displayed=e;const{skipAriaHidden:n}=i;Xr(this.eGui,e,{skipAriaHidden:n});const r={type:"displayChanged",visible:this.displayed};this.dispatchLocalEvent(r)}}destroy(){this.parentComponent&&(this.parentComponent=void 0),this.tooltipFeature&&(this.tooltipFeature=this.destroyBean(this.tooltipFeature)),super.destroy()}addGuiEventListener(e,i,n){this.eGui.addEventListener(e,i,n),this.addDestroyFunc(()=>this.eGui.removeEventListener(e,i))}addCssClass(e){this.cssClassManager.addCssClass(e)}removeCssClass(e){this.cssClassManager.removeCssClass(e)}containsCssClass(e){return this.cssClassManager.containsCssClass(e)}addOrRemoveCssClass(e,i){this.cssClassManager.addOrRemoveCssClass(e,i)}},qY={columnGroupOpened:"expanded",columnGroupClosed:"contracted",columnSelectClosed:"tree-closed",columnSelectOpen:"tree-open",columnSelectIndeterminate:"tree-indeterminate",columnMovePin:"pin",columnMoveHide:"eye-slash",columnMoveMove:"arrows",columnMoveLeft:"left",columnMoveRight:"right",columnMoveGroup:"group",columnMoveValue:"aggregation",columnMovePivot:"pivot",dropNotAllowed:"not-allowed",groupContracted:"tree-closed",groupExpanded:"tree-open",setFilterGroupClosed:"tree-closed",setFilterGroupOpen:"tree-open",setFilterGroupIndeterminate:"tree-indeterminate",chart:"chart",close:"cross",cancel:"cancel",check:"tick",first:"first",previous:"previous",next:"next",last:"last",linked:"linked",unlinked:"unlinked",colorPicker:"color-picker",groupLoading:"loading",menu:"menu",menuAlt:"menu-alt",filter:"filter",columns:"columns",maximize:"maximize",minimize:"minimize",menuPin:"pin",menuValue:"aggregation",menuAddRowGroup:"group",menuRemoveRowGroup:"group",clipboardCopy:"copy",clipboardCut:"cut",clipboardPaste:"paste",pivotPanel:"pivot",rowGroupPanel:"group",valuePanel:"aggregation",columnDrag:"grip",rowDrag:"grip",save:"save",csvExport:"csv",excelExport:"excel",smallDown:"small-down",smallLeft:"small-left",smallRight:"small-right",smallUp:"small-up",sortAscending:"asc",sortDescending:"desc",sortUnSort:"none",advancedFilterBuilder:"group",advancedFilterBuilderDrag:"grip",advancedFilterBuilderInvalid:"not-allowed",advancedFilterBuilderMoveUp:"up",advancedFilterBuilderMoveDown:"down",advancedFilterBuilderAdd:"plus",advancedFilterBuilderRemove:"minus",chartsMenuEdit:"chart",chartsMenuAdvancedSettings:"settings",chartsMenuAdd:"plus",checkboxChecked:"checkbox-checked",checkboxIndeterminate:"checkbox-indeterminate",checkboxUnchecked:"checkbox-unchecked",radioButtonOn:"radio-button-on",radioButtonOff:"radio-button-off"},Yxe=(()=>{const t=new Set(Object.values(qY));return t.add("eye"),t})();function Jxe(t,e,i){const n=Ql(t,e,i);if(n){const{className:s}=n;if(typeof s=="string"&&s.indexOf("ag-icon")>-1||typeof s=="object"&&s["ag-icon"])return n}const r=document.createElement("span");return r.appendChild(n),r}function Ql(t,e,i,n){let r=null;const s=i&&i.getColDef().icons;if(s&&(r=s[t]),e&&!r){const o=e.get("icons");o&&(r=o[t])}if(r){let o;if(typeof r=="function")o=r();else if(typeof r=="string")o=r;else throw new Error("icon from grid options needs to be a string or a function");if(typeof o=="string")return q_(o);if(dU(o))return o;Wt("iconRenderer should return back a string or a dom object")}else{const o=document.createElement("span");let a=qY[t]??(Yxe.has(t)?t:void 0);return a||(Wt(`Did not find icon ${t}`),a=""),o.setAttribute("class",`ag-icon ag-icon-${a}`),o.setAttribute("unselectable","on"),nc(o,"presentation"),o}}var ebe=class extends ir{constructor(){super(...arguments),this.dragSource=null,this.eIcon=bi,this.eLabel=bi}postConstruct(){const t=e=>Jxe(e,this.gos,null);this.dropIconMap={pinned:t("columnMovePin"),hide:t("columnMoveHide"),move:t("columnMoveMove"),left:t("columnMoveLeft"),right:t("columnMoveRight"),group:t("columnMoveGroup"),aggregate:t("columnMoveValue"),pivot:t("columnMovePivot"),notAllowed:t("dropNotAllowed")}}init(t){this.dragSource=t.dragSource,this.setTemplate(`<div class="ag-dnd-ghost ag-unselectable">
                <span data-ref="eIcon" class="ag-dnd-ghost-icon ag-shake-left-to-right"></span>
                <div data-ref="eLabel" class="ag-dnd-ghost-label"></div>
            </div>`)}destroy(){this.dragSource=null,super.destroy()}setIcon(t,e=!1){fa(this.eIcon);let i=null;t||(t=this.dragSource?.getDefaultIconName?this.dragSource?.getDefaultIconName():"notAllowed"),i=this.dropIconMap[t],this.eIcon.classList.toggle("ag-shake-left-to-right",e),!(i===this.dropIconMap.hide&&this.gos.get("suppressDragLeaveHidesColumns"))&&i&&this.eIcon.appendChild(i)}setLabel(t){this.eLabel.textContent=yh(t)}};function jY(t,e,i){if(i===0)return!1;const n=Math.abs(t.clientX-e.clientX),r=Math.abs(t.clientY-e.clientY);return Math.max(n,r)<=i}var mp=class{constructor(t,e=!1){this.DOUBLE_TAP_MILLIS=500,this.destroyFuncs=[],this.touching=!1,this.localEventService=new tx,this.eElement=t,this.preventMouseClick=e;const i=this.onTouchStart.bind(this),n=this.onTouchMove.bind(this),r=this.onTouchEnd.bind(this);this.eElement.addEventListener("touchstart",i,{passive:!0}),this.eElement.addEventListener("touchmove",n,{passive:!0}),this.eElement.addEventListener("touchend",r,{passive:!1}),this.destroyFuncs.push(()=>{this.eElement.removeEventListener("touchstart",i,{passive:!0}),this.eElement.removeEventListener("touchmove",n,{passive:!0}),this.eElement.removeEventListener("touchend",r,{passive:!1})})}getActiveTouch(t){for(let e=0;e<t.length;e++)if(t[e].identifier===this.touchStart.identifier)return t[e];return null}addEventListener(t,e){this.localEventService.addEventListener(t,e)}removeEventListener(t,e){this.localEventService.removeEventListener(t,e)}onTouchStart(t){if(this.touching)return;this.touchStart=t.touches[0],this.touching=!0,this.moved=!1;const e=this.touchStart;window.setTimeout(()=>{const i=this.touchStart===e;if(this.touching&&i&&!this.moved){this.moved=!0;const n={type:"longTap",touchStart:this.touchStart,touchEvent:t};this.localEventService.dispatchEvent(n)}},500)}onTouchMove(t){if(!this.touching)return;const e=this.getActiveTouch(t.touches);if(!e)return;!jY(e,this.touchStart,4)&&(this.moved=!0)}onTouchEnd(t){if(this.touching){if(!this.moved){const e={type:"tap",touchStart:this.touchStart};this.localEventService.dispatchEvent(e),this.checkForDoubleTap()}this.preventMouseClick&&t.cancelable&&t.preventDefault(),this.touching=!1}}checkForDoubleTap(){const t=new Date().getTime();if(this.lastTapTime&&this.lastTapTime>0)if(t-this.lastTapTime>this.DOUBLE_TAP_MILLIS){const i={type:"doubleTap",touchStart:this.touchStart};this.localEventService.dispatchEvent(i),this.lastTapTime=null}else this.lastTapTime=t;else this.lastTapTime=t}destroy(){this.destroyFuncs.forEach(t=>t())}};function Ub(t,e){return`<span data-ref="eSort${t}" class="ag-sort-indicator-icon ag-sort-${e} ag-hidden" aria-hidden="true"></span>`}var tbe=`<span class="ag-sort-indicator-container">
        ${Ub("Order","order")}
        ${Ub("Asc","ascending-icon")}
        ${Ub("Desc","descending-icon")}
        ${Ub("Mixed","mixed-icon")}
        ${Ub("None","none-icon")}
    </span>`,fU=class extends ir{constructor(t){super(),this.eSortOrder=bi,this.eSortAsc=bi,this.eSortDesc=bi,this.eSortMixed=bi,this.eSortNone=bi,t||this.setTemplate(tbe)}wireBeans(t){this.sortController=t.sortController}attachCustomElements(t,e,i,n,r){this.eSortOrder=t,this.eSortAsc=e,this.eSortDesc=i,this.eSortMixed=n,this.eSortNone=r}setupSort(t,e=!1){if(this.column=t,this.suppressOrder=e,this.setupMultiSortIndicator(),!this.column.isSortable()&&!this.column.getColDef().showRowGroup)return;this.addInIcon("sortAscending",this.eSortAsc,t),this.addInIcon("sortDescending",this.eSortDesc,t),this.addInIcon("sortUnSort",this.eSortNone,t);const i=this.updateIcons.bind(this),n=this.onSortChanged.bind(this);this.addManagedPropertyListener("unSortIcon",i),this.addManagedEventListeners({newColumnsLoaded:i,sortChanged:n,columnRowGroupChanged:n}),this.onSortChanged()}addInIcon(t,e,i){if(e==null)return;const n=Ql(t,this.gos,i);n&&e.appendChild(n)}onSortChanged(){this.updateIcons(),this.suppressOrder||this.updateSortOrder()}updateIcons(){const t=this.sortController.getDisplaySortForColumn(this.column);if(this.eSortAsc){const e=t==="asc";Xr(this.eSortAsc,e,{skipAriaHidden:!0})}if(this.eSortDesc){const e=t==="desc";Xr(this.eSortDesc,e,{skipAriaHidden:!0})}if(this.eSortNone){const e=!this.column.getColDef().unSortIcon&&!this.gos.get("unSortIcon"),i=t==null;Xr(this.eSortNone,!e&&i,{skipAriaHidden:!0})}}setupMultiSortIndicator(){this.addInIcon("sortUnSort",this.eSortMixed,this.column);const t=this.column.getColDef().showRowGroup;ah(this.gos)&&t&&(this.addManagedEventListeners({sortChanged:this.updateMultiSortIndicator.bind(this),columnRowGroupChanged:this.updateMultiSortIndicator.bind(this)}),this.updateMultiSortIndicator())}updateMultiSortIndicator(){if(this.eSortMixed){const t=this.sortController.getDisplaySortForColumn(this.column)==="mixed";Xr(this.eSortMixed,t,{skipAriaHidden:!0})}}updateSortOrder(){if(!this.eSortOrder)return;const t=this.sortController.getColumnsWithSortingOrdered(),e=this.sortController.getDisplaySortIndexForColumn(this.column)??-1,i=t.some(r=>this.sortController.getDisplaySortIndexForColumn(r)??!1),n=e>=0&&i;Xr(this.eSortOrder,n,{skipAriaHidden:!0}),e>=0?this.eSortOrder.textContent=(e+1).toString():fa(this.eSortOrder)}},ibe={selector:"AG-SORT-INDICATOR",component:fU},nbe=`<div class="ag-cell-label-container" role="presentation">
        <span data-ref="eMenu" class="ag-header-icon ag-header-cell-menu-button" aria-hidden="true"></span>
        <span data-ref="eFilterButton" class="ag-header-icon ag-header-cell-filter-button" aria-hidden="true"></span>
        <div data-ref="eLabel" class="ag-header-cell-label" role="presentation">
            <span data-ref="eText" class="ag-header-cell-text"></span>
            <span data-ref="eFilter" class="ag-header-icon ag-header-label-icon ag-filter-icon" aria-hidden="true"></span>
            <ag-sort-indicator data-ref="eSortIndicator"></ag-sort-indicator>
        </div>
    </div>`,Cz=class extends ir{constructor(){super(...arguments),this.eFilter=bi,this.eFilterButton=bi,this.eSortIndicator=bi,this.eMenu=bi,this.eLabel=bi,this.eText=bi,this.eSortOrder=bi,this.eSortAsc=bi,this.eSortDesc=bi,this.eSortMixed=bi,this.eSortNone=bi,this.lastMovingChanged=0}wireBeans(t){this.sortController=t.sortController,this.menuService=t.menuService,this.funcColsService=t.funcColsService}destroy(){super.destroy()}refresh(t){const e=this.params;return this.params=t,this.workOutTemplate()!=this.currentTemplate||this.workOutShowMenu()!=this.currentShowMenu||this.workOutSort()!=this.currentSort||this.shouldSuppressMenuHide()!=this.currentSuppressMenuHide||e.enableFilterButton!=t.enableFilterButton||e.enableFilterIcon!=t.enableFilterIcon?!1:(this.setDisplayName(t),!0)}workOutTemplate(){let t=this.params.template??nbe;return t=t&&t.trim?t.trim():t,t}init(t){this.params=t,this.currentTemplate=this.workOutTemplate(),this.setTemplate(this.currentTemplate,[ibe]),this.setupTap(),this.setMenu(),this.setupSort(),this.setupFilterIcon(),this.setupFilterButton(),this.setDisplayName(t)}setDisplayName(t){if(this.currentDisplayName!=t.displayName){this.currentDisplayName=t.displayName;const e=yh(this.currentDisplayName,!0);this.eText&&(this.eText.textContent=e)}}addInIcon(t,e,i){if(e==null)return;const n=Ql(t,this.gos,i);n&&e.appendChild(n)}setupTap(){const{gos:t}=this;if(t.get("suppressTouch"))return;const e=new mp(this.getGui(),!0),i=this.shouldSuppressMenuHide(),n=i&&oi(this.eMenu),r=n?new mp(this.eMenu,!0):e;if(this.params.enableMenu){const s=n?"tap":"longTap",o=a=>this.params.showColumnMenuAfterMouseClick(a.touchStart);this.addManagedListeners(r,{[s]:o})}if(this.params.enableSorting){const s=o=>{const a=o.touchStart.target;i&&(this.eMenu?.contains(a)||this.eFilterButton?.contains(a))||this.sortController.progressSort(this.params.column,!1,"uiColumnSorted")};this.addManagedListeners(e,{tap:s})}if(this.params.enableFilterButton){const s=new mp(this.eFilterButton,!0);this.addManagedListeners(s,{tap:()=>this.params.showFilter(this.eFilterButton)}),this.addDestroyFunc(()=>s.destroy())}this.addDestroyFunc(()=>e.destroy()),n&&this.addDestroyFunc(()=>r.destroy())}workOutShowMenu(){return this.params.enableMenu&&this.menuService.isHeaderMenuButtonEnabled()}shouldSuppressMenuHide(){return this.menuService.isHeaderMenuButtonAlwaysShowEnabled()}setMenu(){if(!this.eMenu)return;if(this.currentShowMenu=this.workOutShowMenu(),!this.currentShowMenu){hh(this.eMenu),this.eMenu=void 0;return}const t=this.menuService.isLegacyMenuEnabled();this.addInIcon(t?"menu":"menuAlt",this.eMenu,this.params.column),this.eMenu.classList.toggle("ag-header-menu-icon",!t),this.currentSuppressMenuHide=this.shouldSuppressMenuHide(),this.addManagedElementListeners(this.eMenu,{click:()=>this.params.showColumnMenu(this.eMenu)}),this.eMenu.classList.toggle("ag-header-menu-always-show",this.currentSuppressMenuHide)}onMenuKeyboardShortcut(t){const e=this.params.column,i=this.menuService.isLegacyMenuEnabled();if(t&&!i){if(this.menuService.isFilterMenuInHeaderEnabled(e))return this.params.showFilter(this.eFilterButton??this.eMenu??this.getGui()),!0}else if(this.params.enableMenu)return this.params.showColumnMenu(this.eMenu??this.eFilterButton??this.getGui()),!0;return!1}workOutSort(){return this.params.enableSorting}setupSort(){if(this.currentSort=this.params.enableSorting,this.eSortIndicator||(this.eSortIndicator=this.createBean(new fU(!0)),this.eSortIndicator.attachCustomElements(this.eSortOrder,this.eSortAsc,this.eSortDesc,this.eSortMixed,this.eSortNone)),this.eSortIndicator.setupSort(this.params.column),!this.currentSort)return;this.addManagedListeners(this.params.column,{movingChanged:()=>{this.lastMovingChanged=new Date().getTime()}}),this.eLabel&&this.addManagedElementListeners(this.eLabel,{click:e=>{const i=this.params.column.isMoving(),r=new Date().getTime()-this.lastMovingChanged<50;if(!(i||r)){const a=this.gos.get("multiSortKey")==="ctrl"?e.ctrlKey||e.metaKey:e.shiftKey;this.params.progressSort(a)}}});const t=()=>{const e=this.params.column.getSort();if(this.addOrRemoveCssClass("ag-header-cell-sorted-asc",e==="asc"),this.addOrRemoveCssClass("ag-header-cell-sorted-desc",e==="desc"),this.addOrRemoveCssClass("ag-header-cell-sorted-none",!e),this.params.column.getColDef().showRowGroup){const r=!this.funcColsService.getSourceColumnsForGroupColumn(this.params.column)?.every(s=>this.params.column.getSort()==s.getSort());this.addOrRemoveCssClass("ag-header-cell-sorted-mixed",r)}};this.addManagedEventListeners({sortChanged:t,columnRowGroupChanged:t})}setupFilterIcon(){this.eFilter&&this.configureFilter(this.params.enableFilterIcon,this.eFilter,this.onFilterChangedIcon.bind(this))}setupFilterButton(){if(!this.eFilterButton)return;this.configureFilter(this.params.enableFilterButton,this.eFilterButton,this.onFilterChangedButton.bind(this))?this.addManagedElementListeners(this.eFilterButton,{click:()=>this.params.showFilter(this.eFilterButton)}):this.eFilterButton=void 0}configureFilter(t,e,i){if(!t)return hh(e),!1;const n=this.params.column;return this.addInIcon("filter",e,n),this.addManagedListeners(n,{filterChanged:i}),i(),!0}onFilterChangedIcon(){const t=this.params.column.isFilterActive();Xr(this.eFilter,t,{skipAriaHidden:!0})}onFilterChangedButton(){const t=this.params.column.isFilterActive();this.eFilterButton.classList.toggle("ag-filter-active",t)}getAnchorElementForMenu(t){return t?this.eFilterButton??this.eMenu??this.getGui():this.eMenu??this.eFilterButton??this.getGui()}},rbe=class extends ir{constructor(){super(`<div class="ag-header-group-cell-label" role="presentation">
            <span data-ref="agLabel" class="ag-header-group-text" role="presentation"></span>
            <span data-ref="agOpened" class="ag-header-icon ag-header-expand-icon ag-header-expand-icon-expanded"></span>
            <span data-ref="agClosed" class="ag-header-icon ag-header-expand-icon ag-header-expand-icon-collapsed"></span>
        </div>`),this.agOpened=bi,this.agClosed=bi,this.agLabel=bi}wireBeans(t){this.columnModel=t.columnModel}destroy(){super.destroy()}init(t){this.params=t,this.checkWarnings(),this.setupLabel(),this.addGroupExpandIcon(),this.setupExpandIcons()}checkWarnings(){this.params.template&&Wt("A template was provided for Header Group Comp - templates are only supported for Header Comps (not groups)")}setupExpandIcons(){this.addInIcon("columnGroupOpened",this.agOpened),this.addInIcon("columnGroupClosed",this.agClosed);const t=r=>{if(Ed(r))return;const s=!this.params.columnGroup.isExpanded();this.columnModel.setColumnGroupOpened(this.params.columnGroup.getProvidedColumnGroup(),s,"uiColumnExpanded")};this.addTouchAndClickListeners(this.agClosed,t),this.addTouchAndClickListeners(this.agOpened,t);const e=r=>{S0(r)};this.addManagedElementListeners(this.agClosed,{dblclick:e}),this.addManagedElementListeners(this.agOpened,{dblclick:e}),this.addManagedElementListeners(this.getGui(),{dblclick:t}),this.updateIconVisibility();const i=this.params.columnGroup.getProvidedColumnGroup(),n=this.updateIconVisibility.bind(this);this.addManagedListeners(i,{expandedChanged:n,expandableChanged:n})}addTouchAndClickListeners(t,e){const i=new mp(t,!0);this.addManagedListeners(i,{tap:e}),this.addDestroyFunc(()=>i.destroy()),this.addManagedElementListeners(t,{click:e})}updateIconVisibility(){if(this.params.columnGroup.isExpandable()){const e=this.params.columnGroup.isExpanded();Xr(this.agOpened,e),Xr(this.agClosed,!e)}else Xr(this.agOpened,!1),Xr(this.agClosed,!1)}addInIcon(t,e){const i=Ql(t,this.gos,null);i&&e.appendChild(i)}addGroupExpandIcon(){if(!this.params.columnGroup.isExpandable()){Xr(this.agOpened,!1),Xr(this.agClosed,!1);return}}setupLabel(){const{displayName:t,columnGroup:e}=this.params;if(oi(t)){const i=yh(t,!0);this.agLabel.textContent=i}this.addOrRemoveCssClass("ag-sticky-label",!e.getColGroupDef()?.suppressStickyLabel)}},sbe="â",obe="â",abe=class extends ir{constructor(){super(),this.refreshCount=0;const t=document.createElement("span"),e=document.createElement("span");e.setAttribute("class","ag-value-change-delta");const i=document.createElement("span");i.setAttribute("class","ag-value-change-value"),t.appendChild(e),t.appendChild(i),this.setTemplateFromElement(t)}wireBeans(t){this.filterManager=t.filterManager}init(t){this.eValue=this.queryForHtmlElement(".ag-value-change-value"),this.eDelta=this.queryForHtmlElement(".ag-value-change-delta"),this.refresh(t,!0)}showDelta(t,e){const i=Math.abs(e),n=t.formatValue(i),r=oi(n)?n:i,s=e>=0;s?this.eDelta.textContent=sbe+r:this.eDelta.textContent=obe+r,this.eDelta.classList.toggle("ag-value-change-delta-up",s),this.eDelta.classList.toggle("ag-value-change-delta-down",!s)}setTimerToRemoveDelta(){this.refreshCount++;const t=this.refreshCount;this.getFrameworkOverrides().wrapIncoming(()=>{window.setTimeout(()=>{t===this.refreshCount&&this.hideDeltaValue()},2e3)})}hideDeltaValue(){this.eValue.classList.remove("ag-value-change-value-highlight"),fa(this.eDelta)}refresh(t,e=!1){const i=t.value;if(i===this.lastValue||(oi(t.valueFormatted)?this.eValue.textContent=t.valueFormatted:oi(t.value)?this.eValue.textContent=i:fa(this.eValue),this.filterManager?.isSuppressFlashingCellsBecauseFiltering()))return!1;if(typeof i=="number"&&typeof this.lastValue=="number"){const n=i-this.lastValue;this.showDelta(t,n)}return this.lastValue&&this.eValue.classList.add("ag-value-change-value-highlight"),e||this.setTimerToRemoveDelta(),this.lastValue=i,!0}},lbe=class extends ir{constructor(){super(),this.refreshCount=0;const t=document.createElement("span"),e=document.createElement("span");e.setAttribute("class","ag-value-slide-current"),t.appendChild(e),this.setTemplateFromElement(t),this.eCurrent=this.queryForHtmlElement(".ag-value-slide-current")}wireBeans(t){this.filterManager=t.filterManager}init(t){this.refresh(t,!0)}addSlideAnimation(){this.refreshCount++;const t=this.refreshCount;this.ePrevious&&this.getGui().removeChild(this.ePrevious);const e=document.createElement("span");e.setAttribute("class","ag-value-slide-previous ag-value-slide-out"),this.ePrevious=e,this.ePrevious.textContent=this.eCurrent.textContent,this.getGui().insertBefore(this.ePrevious,this.eCurrent),this.getFrameworkOverrides().wrapIncoming(()=>{window.setTimeout(()=>{t===this.refreshCount&&this.ePrevious.classList.add("ag-value-slide-out-end")},50),window.setTimeout(()=>{t===this.refreshCount&&(this.getGui().removeChild(this.ePrevious),this.ePrevious=null)},3e3)})}refresh(t,e=!1){let i=t.value;return Wn(i)&&(i=""),i===this.lastValue||this.filterManager?.isSuppressFlashingCellsBecauseFiltering()?!1:(e||this.addSlideAnimation(),this.lastValue=i,oi(t.valueFormatted)?this.eCurrent.textContent=t.valueFormatted:oi(t.value)?this.eCurrent.textContent=i:fa(this.eCurrent),!0)}},St=class{};St.BACKSPACE="Backspace";St.TAB="Tab";St.ENTER="Enter";St.ESCAPE="Escape";St.SPACE=" ";St.LEFT="ArrowLeft";St.UP="ArrowUp";St.RIGHT="ArrowRight";St.DOWN="ArrowDown";St.DELETE="Delete";St.F2="F2";St.PAGE_UP="PageUp";St.PAGE_DOWN="PageDown";St.PAGE_HOME="Home";St.PAGE_END="End";St.A="KeyA";St.C="KeyC";St.D="KeyD";St.V="KeyV";St.X="KeyX";St.Y="KeyY";St.Z="KeyZ";var cbe=class extends ir{constructor(t,e,i){super(e,i),this.labelSeparator="",this.labelAlignment="left",this.disabled=!1,this.label="",this.config=t||{}}postConstruct(){this.addCssClass("ag-labeled"),this.eLabel.classList.add("ag-label");const{labelSeparator:t,label:e,labelWidth:i,labelAlignment:n,disabled:r}=this.config;r!=null&&this.setDisabled(r),t!=null&&this.setLabelSeparator(t),e!=null&&this.setLabel(e),i!=null&&this.setLabelWidth(i),this.setLabelAlignment(n||this.labelAlignment),this.refreshLabel()}refreshLabel(){fa(this.eLabel),typeof this.label=="string"?this.eLabel.innerText=this.label+this.labelSeparator:this.label&&this.eLabel.appendChild(this.label),this.label===""?(Xr(this.eLabel,!1),nc(this.eLabel,"presentation")):(Xr(this.eLabel,!0),nc(this.eLabel,null))}setLabelSeparator(t){return this.labelSeparator===t?this:(this.labelSeparator=t,this.label!=null&&this.refreshLabel(),this)}getLabelId(){return this.eLabel.id=this.eLabel.id||`ag-${this.getCompId()}-label`,this.eLabel.id}getLabel(){return this.label}setLabel(t){return this.label===t?this:(this.label=t,this.refreshLabel(),this)}setLabelAlignment(t){const i=this.getGui().classList;return i.toggle("ag-label-align-left",t==="left"),i.toggle("ag-label-align-right",t==="right"),i.toggle("ag-label-align-top",t==="top"),this}setLabelEllipsis(t){return this.eLabel.classList.toggle("ag-label-ellipsis",t),this}setLabelWidth(t){return this.label==null?this:(IT(this.eLabel,t),this)}setDisabled(t){t=!!t;const e=this.getGui();return W_(e,t),e.classList.toggle("ag-disabled",t),this.disabled=t,this}isDisabled(){return!!this.disabled}},QY=class extends cbe{constructor(t,e,i,n){super(t,e,i),this.className=n}postConstruct(){super.postConstruct();const{width:t,value:e,onValueChange:i}=this.config;t!=null&&this.setWidth(t),e!=null&&this.setValue(e),i!=null&&this.onValueChange(i),this.className&&this.addCssClass(this.className),this.refreshAriaLabelledBy()}setLabel(t){return super.setLabel(t),this.refreshAriaLabelledBy(),this}refreshAriaLabelledBy(){const t=this.getAriaElement(),e=this.getLabelId(),i=this.getLabel();i==null||i==""||Oxe(t)!==null?$_(t,""):$_(t,e??"")}setAriaLabel(t){return O0(this.getAriaElement(),t),this.refreshAriaLabelledBy(),this}onValueChange(t){return this.addManagedListeners(this,{fieldValueChanged:()=>t(this.getValue())}),this}getWidth(){return this.getGui().clientWidth}setWidth(t){return _u(this.getGui(),t),this}getPreviousValue(){return this.previousValue}getValue(){return this.value}setValue(t,e){return this.value===t?this:(this.previousValue=this.value,this.value=t,e||this.dispatchLocalEvent({type:"fieldValueChanged"}),this)}},Km=class extends QY{constructor(t,e,i="text",n="input"){super(t,t?.template??`
            <div role="presentation">
                <div data-ref="eLabel" class="ag-input-field-label"></div>
                <div data-ref="eWrapper" class="ag-wrapper ag-input-wrapper" role="presentation">
                    <${n} data-ref="eInput" class="ag-input-field-input"></${n}>
                </div>
            </div>`,[],e),this.inputType=i,this.displayFieldTag=n,this.eLabel=bi,this.eWrapper=bi,this.eInput=bi}postConstruct(){super.postConstruct(),this.setInputType(),this.eLabel.classList.add(`${this.className}-label`),this.eWrapper.classList.add(`${this.className}-input-wrapper`),this.eInput.classList.add(`${this.className}-input`),this.addCssClass("ag-input-field"),this.eInput.id=this.eInput.id||`ag-${this.getCompId()}-input`;const{inputName:t,inputWidth:e}=this.config;t!=null&&this.setInputName(t),e!=null&&this.setInputWidth(e),this.addInputListeners(),this.activateTabIndex([this.eInput])}addInputListeners(){this.addManagedElementListeners(this.eInput,{input:t=>this.setValue(t.target.value)})}setInputType(){this.displayFieldTag==="input"&&this.eInput.setAttribute("type",this.inputType)}getInputElement(){return this.eInput}setInputWidth(t){return IT(this.eWrapper,t),this}setInputName(t){return this.getInputElement().setAttribute("name",t),this}getFocusableElement(){return this.eInput}setMaxLength(t){const e=this.eInput;return e.maxLength=t,this}setInputPlaceholder(t){return Vc(this.eInput,"placeholder",t),this}setInputAriaLabel(t){return O0(this.eInput,t),this.refreshAriaLabelledBy(),this}setDisabled(t){return W_(this.eInput,t),super.setDisabled(t)}setAutoComplete(t){if(t===!0)Vc(this.eInput,"autocomplete",null);else{const e=typeof t=="string"?t:"off";Vc(this.eInput,"autocomplete",e)}return this}},pU=class extends Km{constructor(t,e="ag-checkbox",i="checkbox"){super(t,e,i),this.labelAlignment="right",this.selected=!1,this.readOnly=!1,this.passive=!1}postConstruct(){super.postConstruct();const{readOnly:t,passive:e}=this.config;typeof t=="boolean"&&this.setReadOnly(t),typeof e=="boolean"&&this.setPassive(e)}addInputListeners(){this.addManagedElementListeners(this.eInput,{click:this.onCheckboxClick.bind(this)}),this.addManagedElementListeners(this.eLabel,{click:this.toggle.bind(this)})}getNextValue(){return this.selected===void 0?!0:!this.selected}setPassive(t){this.passive=t}isReadOnly(){return this.readOnly}setReadOnly(t){this.eWrapper.classList.toggle("ag-disabled",t),this.eInput.disabled=t,this.readOnly=t}setDisabled(t){return this.eWrapper.classList.toggle("ag-disabled",t),super.setDisabled(t)}toggle(){if(this.eInput.disabled)return;const t=this.isSelected(),e=this.getNextValue();this.passive?this.dispatchChange(e,t):this.setValue(e)}getValue(){return this.isSelected()}setValue(t,e){return this.refreshSelectedClass(t),this.setSelected(t,e),this}setName(t){const e=this.getInputElement();return e.name=t,this}isSelected(){return this.selected}setSelected(t,e){this.isSelected()!==t&&(this.previousValue=this.isSelected(),t=this.selected=typeof t=="boolean"?t:void 0,this.eInput.checked=t,this.eInput.indeterminate=t===void 0,e||this.dispatchChange(this.selected,this.previousValue))}dispatchChange(t,e,i){this.dispatchLocalEvent({type:"fieldValueChanged",selected:t,previousValue:e,event:i});const n=this.getInputElement();this.eventService.dispatchEvent({type:"checkboxChanged",id:n.id,name:n.name,selected:t,previousValue:e})}onCheckboxClick(t){if(this.passive||this.eInput.disabled)return;const e=this.isSelected(),i=this.selected=t.target.checked;this.refreshSelectedClass(i),this.dispatchChange(i,e,t)}refreshSelectedClass(t){this.eWrapper.classList.toggle("ag-checked",t===!0),this.eWrapper.classList.toggle("ag-indeterminate",t==null)}},mU={selector:"AG-CHECKBOX",component:pU},ube=class extends ir{constructor(){super(`
            <div class="ag-cell-wrapper ag-checkbox-cell" role="presentation">
                <ag-checkbox role="presentation" data-ref="eCheckbox"></ag-checkbox>
            </div>`,[mU]),this.eCheckbox=bi}init(t){this.refresh(t);const e=this.eCheckbox.getInputElement();e.setAttribute("tabindex","-1"),RY(e,"polite"),this.addManagedListeners(e,{click:i=>{if(S0(i),this.eCheckbox.isDisabled())return;const n=this.eCheckbox.getValue();this.onCheckboxChanged(n)},dblclick:i=>{S0(i)}}),this.addManagedElementListeners(this.params.eGridCell,{keydown:i=>{if(i.key===St.SPACE&&!this.eCheckbox.isDisabled()){this.params.eGridCell===Jr(this.gos)&&this.eCheckbox.toggle();const n=this.eCheckbox.getValue();this.onCheckboxChanged(n),i.preventDefault()}}})}refresh(t){return this.params=t,this.updateCheckbox(t),!0}updateCheckbox(t){let e,i=!0;if(t.node.group&&t.column)if(typeof t.value=="boolean")e=t.value;else{const a=t.column.getColId();a.startsWith(xP)?e=t.value==null||t.value===""?void 0:t.value==="true":t.node.aggData&&t.node.aggData[a]!==void 0?e=t.value??void 0:i=!1}else e=t.value??void 0;if(!i){this.eCheckbox.setDisplayed(!1);return}this.eCheckbox.setValue(e);const n=t.disabled!=null?t.disabled:!t.column?.isCellEditable(t.node);this.eCheckbox.setDisabled(n);const r=this.localeService.getLocaleTextFunc(),s=oU(r,e),o=n?s:`${r("ariaToggleCellValue","Press SPACE to toggle cell value")} (${s})`;this.eCheckbox.setInputAriaLabel(o)}onCheckboxChanged(t){const{column:e,node:i,value:n}=this.params;this.eventService.dispatchEvent({type:"cellEditingStarted",column:e,colDef:e?.getColDef(),data:i.data,node:i,rowIndex:i.rowIndex,rowPinned:i.rowPinned,value:n});const r=this.params.node.setDataValue(this.params.column,t,"edit");this.eventService.dispatchEvent({type:"cellEditingStopped",column:e,colDef:e?.getColDef(),data:i.data,node:i,rowIndex:i.rowIndex,rowPinned:i.rowPinned,value:n,oldValue:n,newValue:t,valueChanged:r}),r||this.updateCheckbox(this.params)}},hbe=class extends ir{constructor(){super(`<div class="ag-loading">
            <span class="ag-loading-icon" data-ref="eLoadingIcon"></span>
            <span class="ag-loading-text" data-ref="eLoadingText"></span>
        </div>`),this.eLoadingIcon=bi,this.eLoadingText=bi}init(t){t.node.failedLoad?this.setupFailed():this.setupLoading()}setupFailed(){const t=this.localeService.getLocaleTextFunc();this.eLoadingText.innerText=t("loadingError","ERR")}setupLoading(){const t=Ql("groupLoading",this.gos,null);t&&this.eLoadingIcon.appendChild(t);const e=this.localeService.getLocaleTextFunc();this.eLoadingText.innerText=e("loadingOoo","Loading")}refresh(t){return!1}destroy(){super.destroy()}},dbe=class extends ir{constructor(){super('<div class="ag-skeleton-container"></div>')}init(t){const e=`ag-cell-skeleton-renderer-${this.getCompId()}`;this.getGui().setAttribute("id",e),this.addDestroyFunc(()=>$_(t.eParentOfValue)),$_(t.eParentOfValue,e),t.node.failedLoad?this.setupFailed():this.setupLoading(t)}setupFailed(){const t=this.localeService.getLocaleTextFunc();this.getGui().innerText=t("loadingError","ERR");const e=t("ariaSkeletonCellLoadingFailed","Row failed to load");O0(this.getGui(),e)}setupLoading(t){const i=Rs(this.gos).createElement("div");i.classList.add("ag-skeleton-effect");const n=t.node.rowIndex;if(n!=null){const o=75+25*(n%2===0?Math.sin(n):Math.cos(n));i.style.width=`${o}%`}this.getGui().appendChild(i);const s=this.localeService.getLocaleTextFunc()("ariaSkeletonCellLoading","Row data is loading");O0(this.getGui(),s)}refresh(t){return!1}destroy(){super.destroy()}},ZY=class extends ir{constructor(){super()}destroy(){super.destroy()}},fbe=class extends ZY{init(){const t=Pd(this.gos.get("overlayLoadingTemplate")?.trim());if(this.setTemplate(t??'<span aria-live="polite" aria-atomic="true" class="ag-overlay-loading-center"></span>'),!t){const e=this.localeService.getLocaleTextFunc();setTimeout(()=>{this.getGui().textContent=e("loadingOoo","Loading...")})}}},pbe=class extends ZY{init(){const t=Pd(this.gos.get("overlayNoRowsTemplate")?.trim());if(this.setTemplate(t??'<span class="ag-overlay-no-rows-center"></span>'),!t){const e=this.localeService.getLocaleTextFunc();setTimeout(()=>{this.getGui().textContent=e("noRowsToShow","No Rows To Show")})}}},rx=class extends ir{isPopup(){return!0}setParentComponent(t){t.addCssClass("ag-has-popup"),super.setParentComponent(t)}destroy(){const t=this.parentComponent;t&&t.isAlive()&&t.getGui().classList.remove("ag-has-popup"),super.destroy()}},mbe=class extends rx{constructor(){super('<div class="ag-tooltip"></div>')}init(t){const{value:e}=t;this.getGui().textContent=yh(e,!0)}};function XY(t){const{inputValue:e,allSuggestions:i,hideIrrelevant:n,filterByPercentageOfBestMatch:r,addSequentialWeight:s}=t;let o=i.map((u,d)=>({value:u,relevance:vbe(e.toLowerCase(),u.toLocaleLowerCase(),s),idx:d}));if(o.sort((u,d)=>d.relevance-u.relevance),n&&(o=o.filter(u=>u.relevance!==0)),o.length>0&&r&&r>0){const d=o[0].relevance*r;o=o.filter(p=>d-p.relevance<0)}const a=[],l=[];for(const u of o)a.push(u.value),l.push(u.idx);return{values:a,indices:l}}function gbe(t){const e=[],i=t.length;for(let n=1;n<=i;n++)for(let r=0;r<=i-n;r++){const s=r+n-1;e.push(t.slice(r,s+1))}return e}function vbe(t,e,i=!1){const n=t.replace(/\s/g,""),r=e.replace(/\s/g,""),s=n.length,o=r.length,a=new Array(s+1).fill(null).map(()=>new Array(o+1).fill(0));for(let p=0;p<=s;p+=1)a[p][0]=p;for(let p=0;p<=o;p+=1)a[0][p]=p;for(let p=1;p<=s;p++)for(let v=1;v<=o;v++)n[p-1]===r[v-1]?a[p][v]=a[p-1][v-1]:a[p][v]=1+Math.min(a[p][v-1],Math.min(a[p-1][v],a[p-1][v-1]));const l=a[s][o];let d=Math.max(s,o)-l;if(i){const p=gbe(n);for(let v=0;v<p.length;v++){const y=p[v];r.indexOf(y)!==-1&&(d+=1,d*=y.length)}}return d}var ybe=class extends kt{constructor(){super(...arguments),this.beanName="userComponentRegistry",this.agGridDefaults={agDragAndDropImage:ebe,agColumnHeader:Cz,agColumnGroupHeader:rbe,agSortIndicator:fU,agAnimateShowChangeCellRenderer:abe,agAnimateSlideCellRenderer:lbe,agLoadingCellRenderer:hbe,agSkeletonCellRenderer:dbe,agCheckboxCellRenderer:ube,agLoadingOverlay:fbe,agNoRowsOverlay:pbe,agTooltipComponent:mbe},this.agGridDefaultParams={},this.enterpriseAgDefaultCompsModule={agSetColumnFilter:"@ag-grid-enterprise/set-filter",agSetColumnFloatingFilter:"@ag-grid-enterprise/set-filter",agMultiColumnFilter:"@ag-grid-enterprise/multi-filter",agMultiColumnFloatingFilter:"@ag-grid-enterprise/multi-filter",agGroupColumnFilter:"@ag-grid-enterprise/row-grouping",agGroupColumnFloatingFilter:"@ag-grid-enterprise/row-grouping",agGroupCellRenderer:"@ag-grid-enterprise/row-grouping",agGroupRowRenderer:"@ag-grid-enterprise/row-grouping",agRichSelect:"@ag-grid-enterprise/rich-select",agRichSelectCellEditor:"@ag-grid-enterprise/rich-select",agDetailCellRenderer:"@ag-grid-enterprise/master-detail",agSparklineCellRenderer:"@ag-grid-enterprise/sparklines"},this.jsComps={}}postConstruct(){const t=this.gos.get("components");t!=null&&gu(t,(e,i)=>this.registerJsComponent(e,i))}registerDefaultComponent(t,e,i){this.agGridDefaults[t]=e,i&&(this.agGridDefaultParams[t]=i)}registerJsComponent(t,e){this.jsComps[t]=e}retrieve(t,e){const i=(a,l,u)=>({componentFromFramework:l,component:a,params:u}),n=this.getFrameworkOverrides().frameworkComponent(e,this.gos.get("components"));if(n!=null)return i(n,!0);const r=this.jsComps[e];if(r){const a=this.getFrameworkOverrides().isFrameworkComponent(r);return i(r,a)}const s=this.agGridDefaults[e];if(s)return i(s,!1,this.agGridDefaultParams[e]);const o=this.enterpriseAgDefaultCompsModule[e];return o?this.gos.assertModuleRegistered(o,`AG Grid '${t}' component: ${e}`):KG(()=>{this.warnAboutMissingComponent(t,e)},"MissingComp"+e),null}warnAboutMissingComponent(t,e){const i=[...Object.keys(this.agGridDefaults).filter(r=>!["agCellEditor","agGroupRowRenderer","agSortIndicator"].includes(r)),...Object.keys(this.jsComps)],n=XY({inputValue:e,allSuggestions:i,hideIrrelevant:!0,filterByPercentageOfBestMatch:.8}).values;Wt(`Could not find '${e}' component. It was configured as "${t}: '${e}'" but it wasn't found in the list of registered components.`),n.length>0&&Wt(`         Did you mean: [${n.slice(0,3)}]?`),Wt(`If using a custom component check it has been registered as described in: ${this.getFrameworkOverrides().getDocLink("components/")}`)}},Hl=class bw{constructor(e){this.status=0,this.resolution=null,this.waiters=[],e(i=>this.onDone(i),i=>this.onReject(i))}static all(e){return e.length?new bw(i=>{let n=e.length;const r=new Array(n);e.forEach((s,o)=>{s.then(a=>{r[o]=a,n--,n===0&&i(r)})})}):bw.resolve()}static resolve(e=null){return new bw(i=>i(e))}then(e){return new bw(i=>{this.status===1?i(e(this.resolution)):this.waiters.push(n=>i(e(n)))})}onDone(e){this.status=1,this.resolution=e,this.waiters.forEach(i=>i(e))}onReject(e){}},xbe={propertyName:"dateComponent",cellRenderer:!1},bbe={propertyName:"dragAndDropImageComponent",cellRenderer:!1},wbe={propertyName:"headerComponent",cellRenderer:!1},_be={propertyName:"headerGroupComponent",cellRenderer:!1},l6={propertyName:"cellRenderer",cellRenderer:!0},Cbe={propertyName:"cellRenderer",cellRenderer:!1},Sbe={propertyName:"loadingCellRenderer",cellRenderer:!0},Obe={propertyName:"cellEditor",cellRenderer:!1},c6={propertyName:"innerRenderer",cellRenderer:!0},Mbe={propertyName:"loadingOverlayComponent",cellRenderer:!1},Tbe={propertyName:"noRowsOverlayComponent",cellRenderer:!1},Rbe={propertyName:"tooltipComponent",cellRenderer:!1},gU={propertyName:"filter",cellRenderer:!1},Pbe={propertyName:"floatingFilterComponent",cellRenderer:!1},Ebe={propertyName:"toolPanel",cellRenderer:!1},Abe={propertyName:"statusPanel",cellRenderer:!1},Ibe={propertyName:"fullWidthCellRenderer",cellRenderer:!0},kbe={propertyName:"loadingCellRenderer",cellRenderer:!0},Dbe={propertyName:"groupRowRenderer",cellRenderer:!0},Lbe={propertyName:"detailCellRenderer",cellRenderer:!0},Fbe={propertyName:"menuItem",cellRenderer:!1},KY=class YY extends kt{constructor(){super(...arguments),this.beanName="userComponentFactory"}wireBeans(e){this.agComponentUtils=e.agComponentUtils,this.componentMetadataProvider=e.componentMetadataProvider,this.userComponentRegistry=e.userComponentRegistry,this.frameworkComponentWrapper=e.frameworkComponentWrapper,this.gridOptions=e.gridOptions}getDragAndDropImageCompDetails(e){return this.getCompDetails(this.gridOptions,bbe,"agDragAndDropImage",e,!0)}getHeaderCompDetails(e,i){return this.getCompDetails(e,wbe,"agColumnHeader",i)}getHeaderGroupCompDetails(e){const i=e.columnGroup.getColGroupDef();return this.getCompDetails(i,_be,"agColumnGroupHeader",e)}getFullWidthCellRendererDetails(e){return this.getCompDetails(this.gridOptions,Ibe,null,e,!0)}getFullWidthLoadingCellRendererDetails(e){return this.getCompDetails(this.gridOptions,kbe,"agLoadingCellRenderer",e,!0)}getFullWidthGroupCellRendererDetails(e){return this.getCompDetails(this.gridOptions,Dbe,"agGroupRowRenderer",e,!0)}getFullWidthDetailCellRendererDetails(e){return this.getCompDetails(this.gridOptions,Lbe,"agDetailCellRenderer",e,!0)}getInnerRendererDetails(e,i){return this.getCompDetails(e,c6,null,i)}getFullWidthGroupRowInnerCellRenderer(e,i){return this.getCompDetails(e,c6,null,i)}getCellRendererDetails(e,i){return this.getCompDetails(e,l6,null,i)}getEditorRendererDetails(e,i){return this.getCompDetails(e,Cbe,null,i)}getLoadingCellRendererDetails(e,i){return this.getCompDetails(e,Sbe,"agSkeletonCellRenderer",i,!0)}getCellEditorDetails(e,i){return this.getCompDetails(e,Obe,"agCellEditor",i,!0)}getFilterDetails(e,i,n){return this.getCompDetails(e,gU,n,i,!0)}getDateCompDetails(e){return this.getCompDetails(this.gridOptions,xbe,"agDateInput",e,!0)}getLoadingOverlayCompDetails(e){return this.getCompDetails(this.gridOptions,Mbe,"agLoadingOverlay",e,!0)}getNoRowsOverlayCompDetails(e){return this.getCompDetails(this.gridOptions,Tbe,"agNoRowsOverlay",e,!0)}getTooltipCompDetails(e){return this.getCompDetails(e.colDef,Rbe,"agTooltipComponent",e,!0)}getSetFilterCellRendererDetails(e,i){return this.getCompDetails(e,l6,null,i)}getFloatingFilterCompDetails(e,i,n){return this.getCompDetails(e,Pbe,n,i)}getToolPanelCompDetails(e,i){return this.getCompDetails(e,Ebe,null,i,!0)}getStatusPanelCompDetails(e,i){return this.getCompDetails(e,Abe,null,i,!0)}getMenuItemCompDetails(e,i){return this.getCompDetails(e,Fbe,"agMenuItem",i,!0)}getCompDetails(e,i,n,r,s=!1){const{propertyName:o,cellRenderer:a}=i;let{compName:l,jsComp:u,fwComp:d,paramsFromSelector:p,popupFromSelector:v,popupPositionFromSelector:y}=YY.getCompKeys(this.frameworkOverrides,e,i,r),w;const R=F=>{const k=this.userComponentRegistry.retrieve(o,F);k&&(u=k.componentFromFramework?void 0:k.component,d=k.componentFromFramework?k.component:void 0,w=k.params)};if(l!=null&&R(l),u==null&&d==null&&n!=null&&R(n),u&&a&&!this.agComponentUtils.doesImplementIComponent(u)&&(u=this.agComponentUtils.adaptFunction(o,u)),!u&&!d){s&&ar(`Could not find component ${l}, did you forget to configure this component?`);return}const O=this.mergeParamsWithApplicationProvidedParams(e,i,r,p,w),P=u==null,N=u||d;return{componentFromFramework:P,componentClass:N,params:O,type:i,popupFromSelector:v,popupPositionFromSelector:y,newAgStackInstance:()=>this.newAgStackInstance(N,P,O,i)}}static getCompKeys(e,i,n,r){const{propertyName:s}=n;let o,a,l,u,d,p;if(i){const v=i,y=v[s+"Selector"],w=y?y(r):null,R=O=>{typeof O=="string"?o=O:O!=null&&O!==!0&&(e.isFrameworkComponent(O)?l=O:a=O)};w?(R(w.component),u=w.params,d=w.popup,p=w.popupPosition):R(v[s])}return{compName:o,jsComp:a,fwComp:l,paramsFromSelector:u,popupFromSelector:d,popupPositionFromSelector:p}}newAgStackInstance(e,i,n,r){const s=r.propertyName,o=!i;let a;if(o)a=new e;else{const u=this.componentMetadataProvider.retrieve(s);a=this.frameworkComponentWrapper.wrap(e,u.mandatoryMethodList,u.optionalMethodList,r)}const l=this.initComponent(a,n);return l==null?Hl.resolve(a):l.then(()=>a)}mergeParamsWithApplicationProvidedParams(e,i,n,r=null,s){const o=this.gos.getGridCommonParams();ka(o,n),s&&ka(o,s);const a=e,l=a&&a[i.propertyName+"Params"];if(typeof l=="function"){const u=l(n);ka(o,u)}else typeof l=="object"&&ka(o,l);return ka(o,r),o}initComponent(e,i){if(this.createBean(e),e.init!=null)return e.init(i)}};function Qw(t){const e=t;return e!=null&&e.getFrameworkComponentInstance!=null?e.getFrameworkComponentInstance():t}var bP=class dr{static register(e){dr.__register(e,!0,void 0)}static registerModules(e){dr.__registerModules(e,!0,void 0)}static __register(e,i,n){dr.runVersionChecks(e),n!==void 0?(dr.areGridScopedModules=!0,dr.gridModulesMap[n]===void 0&&(dr.gridModulesMap[n]={}),dr.gridModulesMap[n][e.moduleName]=e):dr.globalModulesMap[e.moduleName]=e,dr.setModuleBased(i)}static __unRegisterGridModules(e){delete dr.gridModulesMap[e]}static __registerModules(e,i,n){dr.setModuleBased(i),e&&e.forEach(r=>dr.__register(r,i,n))}static isValidModuleVersion(e){const[i,n]=e.version.split(".")||[],[r,s]=dr.currentModuleVersion.split(".")||[];return i===r&&n===s}static runVersionChecks(e){dr.currentModuleVersion||(dr.currentModuleVersion=e.version);const i=n=>`You are using incompatible versions of AG Grid modules. Major and minor versions should always match across modules. ${n} Please update all modules to the same version.`;if(e.version?dr.isValidModuleVersion(e)||ar(i(`'${e.moduleName}' is version ${e.version} but the other modules are version ${dr.currentModuleVersion}.`)):ar(i(`'${e.moduleName}' is incompatible.`)),e.validate){const n=e.validate();n.isValid||ar(`${n.message}`)}}static setModuleBased(e){dr.moduleBased===void 0?dr.moduleBased=e:dr.moduleBased!==e&&(ar("AG Grid: You are mixing modules (i.e. @ag-grid-community/core) and packages (ag-grid-community) - you can only use one or the other of these mechanisms."),ar("Please see https://www.ag-grid.com/javascript-grid/modules/ for more information."))}static __setIsBundled(){dr.isBundled=!0}static __assertRegistered(e,i,n){if(this.__isRegistered(e,n))return!0;let r;if(dr.isBundled)r=`AG Grid: unable to use ${i} as 'ag-grid-enterprise' has not been loaded. Check you are using the Enterprise bundle:
        
        <script src="https://cdn.jsdelivr.net/npm/ag-grid-enterprise@AG_GRID_VERSION/dist/ag-grid-enterprise.min.js"><\/script>
        
For more info see: https://ag-grid.com/javascript-data-grid/getting-started/#getting-started-with-ag-grid-enterprise`;else if(dr.moduleBased||dr.moduleBased===void 0){const s=Object.entries(sY).find(([o,a])=>a===e)?.[0];r=`AG Grid: unable to use ${i} as the ${s} is not registered${dr.areGridScopedModules?` for gridId: ${n}`:""}. Check if you have registered the module:
           
    import { ModuleRegistry } from '@ag-grid-community/core';
    import { ${s} } from '${e}';
    
    ModuleRegistry.registerModules([ ${s} ]);

For more info see: https://www.ag-grid.com/javascript-grid/modules/`}else r=`AG Grid: unable to use ${i} as package 'ag-grid-enterprise' has not been imported. Check that you have imported the package:
            
    import 'ag-grid-enterprise';`;return ar(r),!1}static __isRegistered(e,i){return!!dr.globalModulesMap[e]||!!dr.gridModulesMap[i]?.[e]}static __getRegisteredModules(e){return[...OM(dr.globalModulesMap),...OM(dr.gridModulesMap[e]||{})]}static __getGridRegisteredModules(e){return OM(dr.gridModulesMap[e]??{})||[]}static __isPackageBased(){return!dr.moduleBased}};bP.globalModulesMap={};bP.gridModulesMap={};bP.areGridScopedModules=!1;var bd=bP,Nbe=class{constructor(t){this.beans={},this.createdBeans=[],this.destroyed=!1,!(!t||!t.beanClasses)&&(this.beanDestroyComparator=t.beanDestroyComparator,this.init(t))}init(t){Object.entries(t.providedBeanInstances).forEach(([e,i])=>{this.beans[e]=i}),t.beanClasses.forEach(e=>{const i=new e;i.beanName?this.beans[i.beanName]=i:console.error(`Bean ${e.name} is missing beanName`),this.createdBeans.push(i)}),t.derivedBeans?.forEach(e=>{const{beanName:i,bean:n}=e(this);this.beans[i]=n,this.createdBeans.push(n)}),t.beanInitComparator&&this.createdBeans.sort(t.beanInitComparator),this.initBeans(this.createdBeans)}getBeanInstances(){return Object.values(this.beans)}createBean(t,e){if(!t)throw Error("Can't wire to bean since it is null");return this.initBeans([t],e),t}initBeans(t,e){t.forEach(i=>{i.preWireBeans?.(this.beans),i.wireBeans?.(this.beans)}),t.forEach(i=>i.preConstruct?.()),e&&t.forEach(e),t.forEach(i=>i.postConstruct?.())}getBeans(){return this.beans}getBean(t){return this.beans[t]}destroy(){if(this.destroyed)return;this.destroyed=!0;const t=this.getBeanInstances();this.beanDestroyComparator&&t.sort(this.beanDestroyComparator),this.destroyBeans(t),this.beans={},this.createdBeans=[]}destroyBean(t){t?.destroy?.()}destroyBeans(t){if(t)for(let e=0;e<t.length;e++)this.destroyBean(t[e]);return[]}isDestroyed(){return this.destroyed}},Bbe=class extends Nbe{init(e){this.gridId=e.gridId,this.beans.context=this,super.init(e)}destroy(){super.destroy(),bd.__unRegisterGridModules(this.gridId)}getGridId(){return this.gridId}},JY=(t=>(t[t.Left=0]="Left",t[t.Right=1]="Right",t))(JY||{}),zbe=class extends kt{constructor(){super(...arguments),this.beanName="dragAndDropService",this.dragSourceAndParamsList=[],this.dropTargets=[]}wireBeans(t){this.ctrlsService=t.ctrlsService,this.dragService=t.dragService,this.mouseEventService=t.mouseEventService,this.environment=t.environment,this.userComponentFactory=t.userComponentFactory}addDragSource(t,e=!1){const i={eElement:t.eElement,dragStartPixels:t.dragStartPixels,onDragStart:this.onDragStart.bind(this,t),onDragStop:this.onDragStop.bind(this),onDragging:this.onDragging.bind(this),onDragCancel:this.onDragCancel.bind(this),includeTouch:e};this.dragSourceAndParamsList.push({params:i,dragSource:t}),this.dragService.addDragSource(i)}getDragAndDropImageComponent(){const{dragAndDropImageComp:t}=this;return!t||!t.comp?null:t.comp}removeDragSource(t){const e=this.dragSourceAndParamsList.find(i=>i.dragSource===t);e&&(this.dragService.removeDragSource(e.params),Na(this.dragSourceAndParamsList,e))}destroy(){this.dragSourceAndParamsList.forEach(t=>this.dragService.removeDragSource(t.params)),this.dragSourceAndParamsList.length=0,this.dropTargets.length=0,this.clearDragAndDropProperties(),super.destroy()}nudge(){this.dragging&&this.onDragging(this.eventLastTime,!0)}onDragStart(t,e){this.dragging=!0,this.dragSource=t,this.eventLastTime=e,this.dragItem=this.dragSource.getDragItem(),this.dragSource.onDragStarted?.(),this.createDragAndDropImageComponent()}onDragStop(t){if(this.dragSource?.onDragStopped?.(),this.lastDropTarget?.onDragStop){const e=this.createDropTargetEvent(this.lastDropTarget,t,null,null,!1);this.lastDropTarget.onDragStop(e)}this.clearDragAndDropProperties()}onDragCancel(){this.dragSource?.onDragCancelled?.(),this.lastDropTarget?.onDragCancel&&this.lastDropTarget.onDragCancel(this.createDropTargetEvent(this.lastDropTarget,this.eventLastTime,null,null,!1)),this.clearDragAndDropProperties()}clearDragAndDropProperties(){this.eventLastTime=null,this.dragging=!1,this.lastDropTarget=void 0,this.dragItem=null,this.dragSource=null,this.removeDragAndDropImageComponent()}onDragging(t,e=!1){const i=this.getHorizontalDirection(t),n=this.getVerticalDirection(t);this.eventLastTime=t,this.positionDragAndDropImageComp(t);const r=this.dropTargets.filter(o=>this.isMouseOnDropTarget(t,o)),s=this.findCurrentDropTarget(t,r);if(s!==this.lastDropTarget){if(this.leaveLastTargetIfExists(t,i,n,e),this.lastDropTarget!==null&&s===null&&this.dragSource?.onGridExit?.(this.dragItem),this.lastDropTarget===null&&s!==null&&this.dragSource?.onGridEnter?.(this.dragItem),this.enterDragTargetIfExists(s,t,i,n,e),s&&this.dragAndDropImageComp){const{comp:o,promise:a}=this.dragAndDropImageComp;o?o.setIcon(s.getIconName?s.getIconName():null):a.then(l=>{l&&l.setIcon(s.getIconName?s.getIconName():null)})}this.lastDropTarget=s}else if(s&&s.onDragging){const o=this.createDropTargetEvent(s,t,i,n,e);s.onDragging(o)}}getAllContainersFromDropTarget(t){const e=t.getSecondaryContainers?t.getSecondaryContainers():null,i=[[t.getContainer()]];return e?i.concat(e):i}allContainersIntersect(t,e){for(const i of e){const{width:n,height:r,left:s,right:o,top:a,bottom:l}=i.getBoundingClientRect();if(n===0||r===0)return!1;const u=t.clientX>=s&&t.clientX<o,d=t.clientY>=a&&t.clientY<l;if(!u||!d)return!1}return!0}isMouseOnDropTarget(t,e){const i=this.getAllContainersFromDropTarget(e);let n=!1;for(const o of i)if(this.allContainersIntersect(t,o)){n=!0;break}const{eElement:r,type:s}=this.dragSource;return e.targetContainsSource&&!e.getContainer().contains(r)?!1:n&&e.isInterestedIn(s,r)}findCurrentDropTarget(t,e){const i=e.length;if(i===0)return null;if(i===1)return e[0];const r=U_(this.gos).elementsFromPoint(t.clientX,t.clientY);for(const s of r)for(const o of e)if(Z0e(this.getAllContainersFromDropTarget(o)).indexOf(s)!==-1)return o;return null}enterDragTargetIfExists(t,e,i,n,r){if(t&&t.onDragEnter){const s=this.createDropTargetEvent(t,e,i,n,r);t.onDragEnter(s)}}leaveLastTargetIfExists(t,e,i,n){if(!this.lastDropTarget)return;if(this.lastDropTarget.onDragLeave){const s=this.createDropTargetEvent(this.lastDropTarget,t,e,i,n);this.lastDropTarget.onDragLeave(s)}const r=this.getDragAndDropImageComponent();r&&r.setIcon(null)}addDropTarget(t){this.dropTargets.push(t)}removeDropTarget(t){this.dropTargets=this.dropTargets.filter(e=>e.getContainer()!==t.getContainer())}hasExternalDropZones(){return this.dropTargets.some(t=>t.external)}findExternalZone(t){return this.dropTargets.filter(i=>i.external).find(i=>i.getContainer()===t.getContainer())||null}isDropZoneWithinThisGrid(t){const i=this.ctrlsService.getGridBodyCtrl().getGui(),{dropZoneTarget:n}=t;return i.contains(n)}getHorizontalDirection(t){const e=this.eventLastTime&&this.eventLastTime.clientX,i=t.clientX;return e===i?null:e>i?0:1}getVerticalDirection(t){const e=this.eventLastTime&&this.eventLastTime.clientY,i=t.clientY;return e===i?null:e>i?0:1}createDropTargetEvent(t,e,i,n,r){const s=t.getContainer(),o=s.getBoundingClientRect(),{dragItem:a,dragSource:l}=this,u=e.clientX-o.left,d=e.clientY-o.top;return this.gos.addGridCommonParams({event:e,x:u,y:d,vDirection:n,hDirection:i,dragSource:l,fromNudge:r,dragItem:a,dropZoneTarget:s})}positionDragAndDropImageComp(t){const e=this.getDragAndDropImageComponent();if(!e)return;const i=e.getGui(),r=i.getBoundingClientRect().height,s=zxe()-2,o=Vxe()-2;if(!i.offsetParent)return;const l=BY(i.offsetParent),{clientY:u,clientX:d}=t;let p=u-l.top-r/2,v=d-l.left-10;const y=Rs(this.gos),w=y.defaultView||window,R=w.pageYOffset||y.documentElement.scrollTop,O=w.pageXOffset||y.documentElement.scrollLeft;s>0&&v+i.clientWidth>s+O&&(v=s+O-i.clientWidth),v<0&&(v=0),o>0&&p+i.clientHeight>o+R&&(p=o+R-i.clientHeight),p<0&&(p=0),i.style.left=`${v}px`,i.style.top=`${p}px`}removeDragAndDropImageComponent(){if(this.dragAndDropImageComp){const{comp:t}=this.dragAndDropImageComp;if(t){const e=t.getGui();this.dragAndDropImageParent&&this.dragAndDropImageParent.removeChild(e),this.destroyBean(t)}}this.dragAndDropImageComp=null}createDragAndDropImageComponent(){const{dragSource:t}=this;if(!t)return;const i=this.userComponentFactory.getDragAndDropImageCompDetails({dragSource:t}).newAgStackInstance();this.dragAndDropImageComp={promise:i},i.then(n=>{!n||!this.isAlive()||(this.processDragAndDropImageComponent(n),this.dragAndDropImageComp.comp=n)})}processDragAndDropImageComponent(t){const{dragSource:e,mouseEventService:i,environment:n}=this;if(!e)return;const r=t.getGui();r.style.setProperty("position","absolute"),r.style.setProperty("z-index","9999"),i.stampTopLevelGridCompWithGridInstance(r),n.applyThemeClasses(r),t.setIcon(null);let{dragItemName:s}=e;YG(s)&&(s=s()),t.setLabel(s||""),r.style.top="20px",r.style.left="20px";const o=Rs(this.gos);let a=null,l=null;try{a=o.fullscreenElement}catch{}finally{a||(a=U_(this.gos));const u=a.querySelector("body");u?l=u:a instanceof ShadowRoot?l=a:a instanceof Document?l=a?.documentElement:l=a}this.dragAndDropImageParent=l,l?l.appendChild(r):Wt("Could not find document body, it is needed for drag and drop.")}},Vbe=class{constructor(t){this.tickingInterval=null,this.onScrollCallback=null,this.scrollContainer=t.scrollContainer,this.scrollHorizontally=t.scrollAxis.indexOf("x")!==-1,this.scrollVertically=t.scrollAxis.indexOf("y")!==-1,this.scrollByTick=t.scrollByTick!=null?t.scrollByTick:20,t.onScrollCallback&&(this.onScrollCallback=t.onScrollCallback),this.scrollVertically&&(this.getVerticalPosition=t.getVerticalPosition,this.setVerticalPosition=t.setVerticalPosition),this.scrollHorizontally&&(this.getHorizontalPosition=t.getHorizontalPosition,this.setHorizontalPosition=t.setHorizontalPosition),this.shouldSkipVerticalScroll=t.shouldSkipVerticalScroll||(()=>!1),this.shouldSkipHorizontalScroll=t.shouldSkipHorizontalScroll||(()=>!1)}check(t,e=!1){const i=e||this.shouldSkipVerticalScroll();if(i&&this.shouldSkipHorizontalScroll())return;const n=this.scrollContainer.getBoundingClientRect(),r=this.scrollByTick;this.tickLeft=t.clientX<n.left+r,this.tickRight=t.clientX>n.right-r,this.tickUp=t.clientY<n.top+r&&!i,this.tickDown=t.clientY>n.bottom-r&&!i,this.tickLeft||this.tickRight||this.tickUp||this.tickDown?this.ensureTickingStarted():this.ensureCleared()}ensureTickingStarted(){this.tickingInterval===null&&(this.tickingInterval=window.setInterval(this.doTick.bind(this),100),this.tickCount=0)}doTick(){this.tickCount++;const t=this.tickCount>20?200:this.tickCount>10?80:40;if(this.scrollVertically){const e=this.getVerticalPosition();this.tickUp&&this.setVerticalPosition(e-t),this.tickDown&&this.setVerticalPosition(e+t)}if(this.scrollHorizontally){const e=this.getHorizontalPosition();this.tickLeft&&this.setHorizontalPosition(e-t),this.tickRight&&this.setHorizontalPosition(e+t)}this.onScrollCallback&&this.onScrollCallback()}ensureCleared(){this.tickingInterval&&(window.clearInterval(this.tickingInterval),this.tickingInterval=null)}},Gbe=class extends kt{wireBeans(t){this.dragAndDropService=t.dragAndDropService,this.rowModel=t.rowModel,this.pageBoundsService=t.pageBoundsService,this.focusService=t.focusService,this.sortController=t.sortController,this.filterManager=t.filterManager,this.selectionService=t.selectionService,this.mouseEventService=t.mouseEventService,this.ctrlsService=t.ctrlsService,this.funcColsService=t.funcColsService,this.rangeService=t.rangeService}constructor(t){super(),this.eContainer=t}postConstruct(){ls(this.gos)&&(this.clientSideRowModel=this.rowModel),this.ctrlsService.whenReady(this,t=>{const e=t.gridBodyCtrl;this.autoScrollService=new Vbe({scrollContainer:e.getBodyViewportElement(),scrollAxis:"y",getVerticalPosition:()=>e.getScrollFeature().getVScrollPosition().top,setVerticalPosition:i=>e.getScrollFeature().setVerticalScrollPosition(i),onScrollCallback:()=>{this.onDragging(this.lastDraggingEvent)}})})}getContainer(){return this.eContainer}isInterestedIn(t){return t===2}getIconName(){return this.gos.get("rowDragManaged")&&this.shouldPreventRowMove()?"notAllowed":"move"}shouldPreventRowMove(){return!!(this.funcColsService.getRowGroupColumns().length||this.filterManager?.isAnyFilterPresent()||this.sortController.isSortActive())}getRowNodes(t){if(!this.isFromThisGrid(t))return t.dragItem.rowNodes||[];const e=t.dragItem.rowNode;if(this.gos.get("rowDragMultiRow")){const n=[...this.selectionService.getSelectedNodes()].sort((r,s)=>r.rowIndex==null||s.rowIndex==null?0:this.getRowIndexNumber(r)-this.getRowIndexNumber(s));if(n.indexOf(e)!==-1)return n}return[e]}onDragEnter(t){t.dragItem.rowNodes=this.getRowNodes(t),this.dispatchGridEvent("rowDragEnter",t),this.getRowNodes(t).forEach(e=>{e.setDragging(!0)}),this.onEnterOrDragging(t)}onDragging(t){this.onEnterOrDragging(t)}isFromThisGrid(t){const{dragSourceDomDataKey:e}=t.dragSource;return e===this.gos.getDomDataKey()}onEnterOrDragging(t){this.dispatchGridEvent("rowDragMove",t),this.lastDraggingEvent=t;const e=this.mouseEventService.getNormalisedPosition(t).y;this.gos.get("rowDragManaged")&&this.doManagedDrag(t,e),this.autoScrollService.check(t.event)}doManagedDrag(t,e){const i=this.isFromThisGrid(t),n=this.gos.get("rowDragManaged"),r=t.dragItem.rowNodes;n&&this.shouldPreventRowMove()||(this.gos.get("suppressMoveWhenRowDragging")||!i?this.dragAndDropService.isDropZoneWithinThisGrid(t)&&this.clientSideRowModel.highlightRowAtPixel(r[0],e):this.moveRows(r,e))}getRowIndexNumber(t){const e=t.getRowIndexString();return parseInt(Yn(e.split("-")),10)}moveRowAndClearHighlight(t){const e=this.clientSideRowModel.getLastHighlightedRowNode(),i=e&&e.highlighted===1,n=this.mouseEventService.getNormalisedPosition(t).y,r=t.dragItem.rowNodes;let s=i?1:0;if(this.isFromThisGrid(t))r.forEach(o=>{o.rowTop<n&&(s-=1)}),this.moveRows(r,n,s);else{const o=ix(this.gos);let a=this.clientSideRowModel.getRowIndexAtPixel(n)+1;this.clientSideRowModel.getHighlightPosition(n)===0&&a--,this.clientSideRowModel.updateRowData({add:r.filter(l=>!this.clientSideRowModel.getRowNode(o?.({data:l.data,level:0,rowPinned:l.rowPinned})??l.data.id)).map(l=>l.data),addIndex:a})}this.clearRowHighlight()}clearRowHighlight(){this.clientSideRowModel.highlightRowAtPixel(null)}moveRows(t,e,i=0){this.clientSideRowModel.ensureRowsAtPixel(t,e,i)&&(this.focusService.clearFocusedCell(),this.rangeService?.removeAllCellRanges())}addRowDropZone(t){if(!t.getContainer()){Wt("addRowDropZone - A container target needs to be provided");return}if(this.dragAndDropService.findExternalZone(t)){Wt("addRowDropZone - target already exists in the list of DropZones. Use `removeRowDropZone` before adding it again.");return}let e={getContainer:t.getContainer};t.fromGrid?e=t:(t.onDragEnter&&(e.onDragEnter=n=>{t.onDragEnter(this.draggingToRowDragEvent("rowDragEnter",n))}),t.onDragLeave&&(e.onDragLeave=n=>{t.onDragLeave(this.draggingToRowDragEvent("rowDragLeave",n))}),t.onDragging&&(e.onDragging=n=>{t.onDragging(this.draggingToRowDragEvent("rowDragMove",n))}),t.onDragStop&&(e.onDragStop=n=>{t.onDragStop(this.draggingToRowDragEvent("rowDragEnd",n))}),t.onDragCancel&&(e.onDragCancel=n=>{t.onDragCancel(this.draggingToRowDragEvent("rowDragCancel",n))}));const i={isInterestedIn:n=>n===2,getIconName:()=>"move",external:!0,...e};this.dragAndDropService.addDropTarget(i),this.addDestroyFunc(()=>this.dragAndDropService.removeDropTarget(i))}getRowDropZone(t){const e=this.getContainer.bind(this),i=this.onDragEnter.bind(this),n=this.onDragLeave.bind(this),r=this.onDragging.bind(this),s=this.onDragStop.bind(this),o=this.onDragCancel.bind(this);let a;return t?a={getContainer:e,onDragEnter:t.onDragEnter?l=>{i(l),t.onDragEnter(this.draggingToRowDragEvent("rowDragEnter",l))}:i,onDragLeave:t.onDragLeave?l=>{n(l),t.onDragLeave(this.draggingToRowDragEvent("rowDragLeave",l))}:n,onDragging:t.onDragging?l=>{r(l),t.onDragging(this.draggingToRowDragEvent("rowDragMove",l))}:r,onDragStop:t.onDragStop?l=>{s(l),t.onDragStop(this.draggingToRowDragEvent("rowDragEnd",l))}:s,onDragCancel:t.onDragCancel?l=>{o(l),t.onDragCancel(this.draggingToRowDragEvent("rowDragCancel",l))}:o,fromGrid:!0}:a={getContainer:e,onDragEnter:i,onDragLeave:n,onDragging:r,onDragStop:s,onDragCancel:o,fromGrid:!0},a}draggingToRowDragEvent(t,e){const i=this.mouseEventService.getNormalisedPosition(e).y,n=i>this.pageBoundsService.getCurrentPageHeight();let r=-1,s;n||(r=this.rowModel.getRowIndexAtPixel(i),s=this.rowModel.getRow(r));let o;switch(e.vDirection){case 1:o="down";break;case 0:o="up";break;default:o=null;break}return this.gos.addGridCommonParams({type:t,event:e.event,node:e.dragItem.rowNode,nodes:e.dragItem.rowNodes,overIndex:r,overNode:s,y:i,vDirection:o})}dispatchGridEvent(t,e){const i=this.draggingToRowDragEvent(t,e);this.eventService.dispatchEvent(i)}onDragLeave(t){this.dispatchGridEvent("rowDragLeave",t),this.stopDragging(t),this.gos.get("rowDragManaged")&&this.clearRowHighlight()}onDragStop(t){this.dispatchGridEvent("rowDragEnd",t),this.stopDragging(t),this.gos.get("rowDragManaged")&&(this.gos.get("suppressMoveWhenRowDragging")||!this.isFromThisGrid(t))&&this.dragAndDropService.isDropZoneWithinThisGrid(t)&&this.moveRowAndClearHighlight(t)}onDragCancel(t){this.dispatchGridEvent("rowDragCancel",t),this.stopDragging(t),this.gos.get("rowDragManaged")&&(this.gos.get("suppressMoveWhenRowDragging")||!this.isFromThisGrid(t))&&this.dragAndDropService.isDropZoneWithinThisGrid(t)&&this.clearRowHighlight()}stopDragging(t){this.autoScrollService.ensureCleared(),this.getRowNodes(t).forEach(e=>{e.setDragging(!1)})}},Ube=class extends kt{constructor(){super(...arguments),this.beanName="dragService",this.dragEndFunctions=[],this.dragSources=[]}wireBeans(t){this.mouseEventService=t.mouseEventService}destroy(){this.dragSources.forEach(this.removeListener.bind(this)),this.dragSources.length=0,super.destroy()}removeListener(t){const e=t.dragSource.eElement,i=t.mouseDownListener;if(e.removeEventListener("mousedown",i),t.touchEnabled){const n=t.touchStartListener;e.removeEventListener("touchstart",n,{passive:!0})}}removeDragSource(t){const e=this.dragSources.find(i=>i.dragSource===t);e&&(this.removeListener(e),Na(this.dragSources,e))}isDragging(){return this.dragging}addDragSource(t){const e=this.onMouseDown.bind(this,t),{eElement:i,includeTouch:n,stopPropagationForTouch:r}=t;i.addEventListener("mousedown",e);let s=null;const o=this.gos.get("suppressTouch");n&&!o&&(s=a=>{cU(a.target)||(r&&a.stopPropagation(),this.onTouchStart(t,a))},i.addEventListener("touchstart",s,{passive:!1})),this.dragSources.push({dragSource:t,mouseDownListener:e,touchStartListener:s,touchEnabled:!!n})}getStartTarget(){return this.startTarget}onTouchStart(t,e){this.currentDragParams=t,this.dragging=!1;const i=e.touches[0];this.touchLastTime=i,this.touchStart=i;const n=l=>this.onTouchMove(l,t.eElement),r=l=>this.onTouchUp(l,t.eElement),s=l=>{l.cancelable&&l.preventDefault()},o=e.target,a=[{target:U_(this.gos),type:"touchmove",listener:s,options:{passive:!1}},{target:o,type:"touchmove",listener:n,options:{passive:!0}},{target:o,type:"touchend",listener:r,options:{passive:!0}},{target:o,type:"touchcancel",listener:r,options:{passive:!0}}];this.addTemporaryEvents(a),t.dragStartPixels===0&&this.onCommonMove(i,this.touchStart,t.eElement)}onMouseDown(t,e){const i=e;if(t.skipMouseEvent&&t.skipMouseEvent(e)||i._alreadyProcessedByDragService||(i._alreadyProcessedByDragService=!0,e.button!==0))return;this.shouldPreventMouseEvent(e)&&e.preventDefault(),this.currentDragParams=t,this.dragging=!1,this.mouseStartEvent=e,this.startTarget=e.target;const n=u=>this.onMouseMove(u,t.eElement),r=u=>this.onMouseUp(u,t.eElement),s=u=>u.preventDefault(),o=u=>{u.key===St.ESCAPE&&this.cancelDrag(t.eElement)},a=U_(this.gos),l=[{target:a,type:"mousemove",listener:n},{target:a,type:"mouseup",listener:r},{target:a,type:"contextmenu",listener:s},{target:a,type:"keydown",listener:o}];this.addTemporaryEvents(l),t.dragStartPixels===0&&this.onMouseMove(e,t.eElement)}addTemporaryEvents(t){t.forEach(e=>{const{target:i,type:n,listener:r,options:s}=e;i.addEventListener(n,r,s)}),this.dragEndFunctions.push(()=>{t.forEach(e=>{const{target:i,type:n,listener:r,options:s}=e;i.removeEventListener(n,r,s)})})}isEventNearStartEvent(t,e){const{dragStartPixels:i}=this.currentDragParams,n=oi(i)?i:4;return jY(t,e,n)}getFirstActiveTouch(t){for(let e=0;e<t.length;e++)if(t[e].identifier===this.touchStart.identifier)return t[e];return null}onCommonMove(t,e,i){if(!this.dragging){if(this.isEventNearStartEvent(t,e))return;if(this.dragging=!0,this.eventService.dispatchEvent({type:"dragStarted",target:i}),this.currentDragParams.onDragStart(e),!this.currentDragParams){this.dragging=!1;return}this.currentDragParams.onDragging(e)}this.currentDragParams?.onDragging(t)}onTouchMove(t,e){const i=this.getFirstActiveTouch(t.touches);i&&this.onCommonMove(i,this.touchStart,e)}onMouseMove(t,e){Th()&&Rs(this.gos).getSelection()?.removeAllRanges(),this.shouldPreventMouseEvent(t)&&t.preventDefault(),this.onCommonMove(t,this.mouseStartEvent,e)}shouldPreventMouseEvent(t){const e=this.gos.get("enableCellTextSelection"),i=t.type==="mousemove";return e&&i&&t.cancelable&&this.mouseEventService.isEventFromThisGrid(t)&&!this.isOverFormFieldElement(t)}isOverFormFieldElement(t){return!!t.target?.tagName.toLocaleLowerCase()?.match("^a$|textarea|input|select|button")}onTouchUp(t,e){let i=this.getFirstActiveTouch(t.changedTouches);i||(i=this.touchLastTime),this.onUpCommon(i,e)}onMouseUp(t,e){this.onUpCommon(t,e)}onUpCommon(t,e){this.dragging&&(this.dragging=!1,this.currentDragParams.onDragStop(t),this.eventService.dispatchEvent({type:"dragStopped",target:e})),this.resetDragProperties()}cancelDrag(t){this.eventService.dispatchEvent({type:"dragCancelled",target:t}),this.currentDragParams?.onDragCancel?.(),this.resetDragProperties()}resetDragProperties(){this.mouseStartEvent=null,this.startTarget=null,this.touchStart=null,this.touchLastTime=null,this.currentDragParams=null,this.dragEndFunctions.forEach(t=>t()),this.dragEndFunctions.length=0}},Sz=class extends ir{constructor(t,e,i,n,r,s){super(),this.cellValueFn=t,this.rowNode=e,this.column=i,this.customGui=n,this.dragStartPixels=r,this.suppressVisibilityChange=s,this.dragSource=null}wireBeans(t){this.beans=t}isCustomGui(){return this.customGui!=null}postConstruct(){if(this.customGui?this.setDragElement(this.customGui,this.dragStartPixels):(this.setTemplate('<div class="ag-drag-handle ag-row-drag" aria-hidden="true"></div>'),this.getGui().appendChild(Ql("rowDrag",this.gos,null)),this.addDragSource()),this.checkCompatibility(),!this.suppressVisibilityChange){const t=this.gos.get("rowDragManaged")?new $be(this,this.beans,this.rowNode,this.column):new Hbe(this,this.beans,this.rowNode,this.column);this.createManagedBean(t,this.beans.context)}}setDragElement(t,e){this.setTemplateFromElement(t,void 0,void 0,!0),this.addDragSource(e)}getSelectedNodes(){if(!this.gos.get("rowDragMultiRow"))return[this.rowNode];const e=this.beans.selectionService.getSelectedNodes();return e.indexOf(this.rowNode)!==-1?e:[this.rowNode]}checkCompatibility(){const t=this.gos.get("rowDragManaged");this.gos.get("treeData")&&t&&Wt("If using row drag with tree data, you cannot have rowDragManaged=true")}getDragItem(){return{rowNode:this.rowNode,rowNodes:this.getSelectedNodes(),columns:this.column?[this.column]:void 0,defaultTextValue:this.cellValueFn()}}getRowDragText(t){if(t){const e=t.getColDef();if(e.rowDragText)return e.rowDragText}return this.gos.get("rowDragText")}addDragSource(t=4){this.dragSource&&this.removeDragSource();const e=this.getGui();this.gos.get("enableCellTextSelection")&&(this.removeMouseDownListener(),this.mouseDownListener=this.addManagedElementListeners(e,{mousedown:n=>{n?.preventDefault()}})[0]);const i=this.localeService.getLocaleTextFunc();this.dragSource={type:2,eElement:e,dragItemName:()=>{const n=this.getDragItem(),r=n.rowNodes?.length||1,s=this.getRowDragText(this.column);return s?s(n,r):r===1?this.cellValueFn():`${r} ${i("rowDragRows","rows")}`},getDragItem:()=>this.getDragItem(),dragStartPixels:t,dragSourceDomDataKey:this.gos.getDomDataKey()},this.beans.dragAndDropService.addDragSource(this.dragSource,!0)}destroy(){this.removeDragSource(),this.removeMouseDownListener(),super.destroy()}removeDragSource(){this.dragSource&&(this.beans.dragAndDropService.removeDragSource(this.dragSource),this.dragSource=null)}removeMouseDownListener(){this.mouseDownListener&&(this.mouseDownListener(),this.mouseDownListener=void 0)}},eJ=class extends kt{constructor(t,e,i){super(),this.parent=t,this.rowNode=e,this.column=i}setDisplayedOrVisible(t){const e={skipAriaHidden:!0};if(t)this.parent.setDisplayed(!1,e);else{let i=!0,n=!1;this.column&&(i=this.column.isRowDrag(this.rowNode)||this.parent.isCustomGui(),n=YG(this.column.getColDef().rowDrag)),n?(this.parent.setDisplayed(!0,e),this.parent.setVisible(i,e)):(this.parent.setDisplayed(i,e),this.parent.setVisible(!0,e))}}},Hbe=class extends eJ{constructor(t,e,i,n){super(t,i,n),this.beans=e}postConstruct(){this.addManagedPropertyListener("suppressRowDrag",this.onSuppressRowDrag.bind(this));const t=this.workOutVisibility.bind(this);this.addManagedListeners(this.rowNode,{dataChanged:t,cellChanged:t}),this.addManagedListeners(this.beans.eventService,{newColumnsLoaded:t}),this.workOutVisibility()}onSuppressRowDrag(){this.workOutVisibility()}workOutVisibility(){const t=this.gos.get("suppressRowDrag");this.setDisplayedOrVisible(t)}},$be=class extends eJ{constructor(t,e,i,n){super(t,i,n),this.beans=e}postConstruct(){const t=this.workOutVisibility.bind(this);this.addManagedListeners(this.beans.eventService,{sortChanged:t,filterChanged:t,columnRowGroupChanged:t,newColumnsLoaded:t}),this.addManagedListeners(this.rowNode,{dataChanged:t,cellChanged:t}),this.addManagedPropertyListener("suppressRowDrag",this.onSuppressRowDrag.bind(this)),this.workOutVisibility()}onSuppressRowDrag(){this.workOutVisibility()}workOutVisibility(){const e=this.beans.ctrlsService.getGridBodyCtrl().getRowDragFeature(),i=e&&e.shouldPreventRowMove(),n=this.gos.get("suppressRowDrag"),r=this.beans.dragAndDropService.hasExternalDropZones(),s=i&&!r||n;this.setDisplayedOrVisible(s)}},Wbe=new Set(["localEventService","__objectId","sticky","__autoHeights","checkAutoHeightsDebounced"]),VC=class $f{constructor(e){this.rowIndex=null,this.key=null,this.sourceRowIndex=-1,this.childrenMapped={},this.treeNode=null,this.treeNodeFlags=0,this.displayed=!1,this.rowTop=null,this.oldRowTop=null,this.selectable=!0,this.__objectId=$f.OBJECT_ID_SEQUENCE++,this.__autoHeights={},this.alreadyRendered=!1,this.highlighted=null,this.hovered=!1,this.selected=!1,this.beans=e}setData(e){this.setDataCommon(e,!1)}updateData(e){this.setDataCommon(e,!0)}setDataCommon(e,i){const n=this.data;this.data=e,this.beans.valueCache.onDataChanged(),this.updateDataOnDetailNode(),this.checkRowSelectable(),this.resetQuickFilterAggregateText();const r=this.createDataChangedEvent(e,n,i);this.localEventService?.dispatchEvent(r)}updateDataOnDetailNode(){this.detailNode&&(this.detailNode.data=this.data)}createDataChangedEvent(e,i,n){return{type:"dataChanged",node:this,oldData:i,newData:e,update:n}}getRowIndexString(){return this.rowIndex==null?(ar("Could not find rowIndex, this means tasks are being executed on a rowNode that has been removed from the grid."),null):this.rowPinned==="top"?$f.ID_PREFIX_TOP_PINNED+this.rowIndex:this.rowPinned==="bottom"?$f.ID_PREFIX_BOTTOM_PINNED+this.rowIndex:this.rowIndex.toString()}createDaemonNode(){const e=new $f(this.beans);return e.id=this.id,e.data=this.data,e.__daemon=!0,e.selected=this.selected,e.level=this.level,e}setDataAndId(e,i){const n=oi(this.id)?this.createDaemonNode():null,r=this.data;this.data=e,this.updateDataOnDetailNode(),this.setId(i),this.checkRowSelectable(),this.beans.selectionService.syncInRowNode(this,n);const s=this.createDataChangedEvent(e,r,!1);this.localEventService?.dispatchEvent(s)}checkRowSelectable(){const e=JG(this.beans.gos);this.setRowSelectable(e?e(this):!0)}setRowSelectable(e,i){if(this.selectable!==e){if(this.selectable=e,this.dispatchRowEvent("selectableChanged"),i)return;if(Lg(this.beans.gos)){const r=this.calculateSelectedFromChildren();this.setSelectedParams({newValue:r??!1,source:"selectableChanged"});return}this.isSelected()&&!this.selectable&&this.setSelectedParams({newValue:!1,source:"selectableChanged"})}}setId(e){const i=ix(this.beans.gos);if(i)if(this.data){const n=this.parent?.getRoute()??[];this.id=i({data:this.data,parentKeys:n.length>0?n:void 0,level:this.level,rowPinned:this.rowPinned}),this.id.startsWith($f.ID_PREFIX_ROW_GROUP)&&ar(`Row IDs cannot start with ${$f.ID_PREFIX_ROW_GROUP}, this is a reserved prefix for AG Grid's row grouping feature.`)}else this.id=void 0;else this.id=e}setRowTop(e){this.oldRowTop=this.rowTop,this.rowTop!==e&&(this.rowTop=e,this.dispatchRowEvent("topChanged"),this.setDisplayed(e!==null))}clearRowTopAndRowIndex(){this.oldRowTop=null,this.setRowTop(null),this.setRowIndex(null)}setHovered(e){this.hovered=e}isHovered(){return this.hovered}setMaster(e){this.master!==e&&(this.master&&!e&&(this.expanded=!1),this.master=e,this.dispatchRowEvent("masterChanged"))}setGroup(e){this.group!==e&&(this.group&&!e&&(this.expanded=!1),this.group=e,this.updateHasChildren(),this.checkRowSelectable(),this.dispatchRowEvent("groupChanged"))}setRowHeight(e,i=!1){this.rowHeight=e,this.rowHeightEstimated=i,this.dispatchRowEvent("heightChanged")}setRowAutoHeight(e,i){this.__autoHeights||(this.__autoHeights={}),this.__autoHeights[i.getId()]=e,e!=null&&(this.checkAutoHeightsDebounced==null&&(this.checkAutoHeightsDebounced=Fa(this.checkAutoHeights.bind(this),1)),this.checkAutoHeightsDebounced())}checkAutoHeights(){let e=!1,i=!0,n=0;const r=this.__autoHeights;if(r==null||(this.beans.visibleColsService.getAllAutoHeightCols().forEach(a=>{let l=r[a.getId()];if(l==null)if(this.beans.columnModel.isColSpanActive()){let u=[];switch(a.getPinned()){case"left":u=this.beans.visibleColsService.getLeftColsForRow(this);break;case"right":u=this.beans.visibleColsService.getRightColsForRow(this);break;case null:u=this.beans.columnViewportService.getColsWithinViewport(this);break}if(u.includes(a)){e=!0;return}l=-1}else{e=!0;return}else i=!1;l>n&&(n=l)}),e)||((i||n<10)&&(n=Mp(this.beans.gos,this).height),n==this.rowHeight))return;this.setRowHeight(n),this.beans.rowModel.onRowHeightChangedDebounced?.()}setExpanded(e,i,n){if(this.expanded===e)return;this.expanded=e,this.dispatchRowEvent("expandedChanged");const r={...this.createGlobalRowEvent("rowGroupOpened"),expanded:e,event:i||null};this.beans.rowNodeEventThrottle.dispatchExpanded(r,n),this.beans.rowRenderer.refreshCells({rowNodes:[this]})}createGlobalRowEvent(e){return this.beans.gos.addGridCommonParams({type:e,node:this,data:this.data,rowIndex:this.rowIndex,rowPinned:this.rowPinned})}setDataValue(e,i,n){const s=typeof e!="string"?e:this.beans.columnModel.getCol(e)??this.beans.columnModel.getColDefCol(e),o=this.beans.valueService.getValueForDisplay(s,this);if(this.beans.gos.get("readOnlyEdit"))return this.beans.eventService.dispatchEvent({type:"cellEditRequest",event:null,rowIndex:this.rowIndex,rowPinned:this.rowPinned,column:s,colDef:s.getColDef(),data:this.data,node:this,oldValue:o,newValue:i,value:i,source:n}),!1;const a=this.beans.valueService.setValue(this,s,i,n);return this.dispatchCellChangedEvent(s,i,o),this.checkRowSelectable(),a}setGroupValue(e,i){const n=this.beans.columnModel.getCol(e);Wn(this.groupData)&&(this.groupData={});const r=n.getColId(),s=this.groupData[r];s!==i&&(this.groupData[r]=i,this.dispatchCellChangedEvent(n,i,s))}setAggData(e){const i=this.aggData;if(this.aggData=e,this.localEventService){const n=r=>{const s=this.aggData?this.aggData[r]:void 0,o=i?i[r]:void 0;if(s===o)return;const a=this.beans.columnModel.getCol(r);a&&this.dispatchCellChangedEvent(a,s,o)};for(const r in i)n(r);for(const r in e)(!i||!(r in i))&&n(r)}}updateHasChildren(){let e=this.group&&!this.footer||this.childrenAfterGroup&&this.childrenAfterGroup.length>0;if(tf(this.beans.gos)){const n=this.beans.gos.get("treeData"),r=this.beans.gos.get("isServerSideGroup");e=!this.stub&&!this.footer&&(n?!!r&&r(this.data):!!this.group)}e!==this.__hasChildren&&(this.__hasChildren=!!e,this.dispatchRowEvent("hasChildrenChanged"))}hasChildren(){return this.__hasChildren==null&&this.updateHasChildren(),this.__hasChildren}dispatchCellChangedEvent(e,i,n){const r={type:"cellChanged",node:this,column:e,newValue:i,oldValue:n};this.localEventService?.dispatchEvent(r)}resetQuickFilterAggregateText(){this.quickFilterAggregateText=null}isExpandable(){return this.footer?!1:this.beans.columnModel.isPivotMode()?this.hasChildren()&&!this.leafGroup:this.hasChildren()||!!this.master}isSelected(){return this.footer?this.sibling.isSelected():this.selected}depthFirstSearch(e){this.childrenAfterGroup&&this.childrenAfterGroup.forEach(i=>i.depthFirstSearch(e)),e(this)}calculateSelectedFromChildren(){let e=!1,i=!1;if(!this.childrenAfterGroup?.length)return this.selectable?this.selected:null;for(let n=0;n<this.childrenAfterGroup.length;n++){const r=this.childrenAfterGroup[n];let s=r.isSelected();if(!r.selectable){const o=r.calculateSelectedFromChildren();if(o===null)continue;s=o}switch(s){case!0:e=!0;break;case!1:i=!0;break;default:return}}if(!(e&&i))return e?!0:i?!1:this.selectable?this.selected:null}setSelectedInitialValue(e){this.selected=e}dispatchRowEvent(e){this.localEventService?.dispatchEvent({type:e,node:this})}selectThisNode(e,i,n="api"){const r=!this.selectable&&e,s=this.selected===e;if(r||s)return!1;this.selected=e,this.dispatchRowEvent("rowSelected");const o=this.sibling;return o&&o.footer&&o.localEventService&&o.dispatchRowEvent("rowSelected"),this.beans.eventService.dispatchEvent({...this.createGlobalRowEvent("rowSelected"),event:i||null,source:n}),!0}setSelected(e,i=!1,n="api"){if(typeof n=="boolean"){Wt("since version v30, rowNode.setSelected() property `suppressFinishActions` has been removed, please use `gridApi.setNodesSelected()` for bulk actions, and the event `source` property for ignoring events instead.");return}this.setSelectedParams({newValue:e,clearSelection:i,rangeSelect:!1,source:n})}setSelectedParams(e){return this.rowPinned?(Wt("cannot select pinned rows"),0):this.id===void 0?(Wt("cannot select node until id for node is known"),0):this.beans.selectionService.setNodesSelected({...e,nodes:[this.footer?this.sibling:this]})}isRowPinned(){return!!this.rowPinned}addEventListener(e,i){this.localEventService||(this.localEventService=new tx),this.beans.frameworkOverrides.shouldWrapOutgoing&&!this.frameworkEventListenerService&&(this.localEventService.setFrameworkOverrides(this.beans.frameworkOverrides),this.frameworkEventListenerService=new nU(this.beans.frameworkOverrides));const n=this.frameworkEventListenerService?.wrap(i)??i;this.localEventService.addEventListener(e,n)}removeEventListener(e,i){if(!this.localEventService)return;const n=this.frameworkEventListenerService?.unwrap(i)??i;this.localEventService.removeEventListener(e,n),this.localEventService.noRegisteredListenersExist()&&(this.localEventService=null)}onMouseEnter(){this.dispatchRowEvent("mouseEnter")}onMouseLeave(){this.dispatchRowEvent("mouseLeave")}isFullWidthCell(){if(Wt("since version v32.2.0, rowNode.isFullWidthCell() has been deprecated. Instead check `rowNode.detail` followed by the user provided `isFullWidthRow` grid option."),this.detail)return!0;const e=this.beans.gos.getCallback("isFullWidthRow");return e?e({rowNode:this}):!1}getRoute(){if(this.level===-1)return[];if(this.key==null)return;const e=[];let i=this;for(;i&&i.key!=null;)e.push(i.key),i=i.parent;return e.reverse()}createFooter(){if(this.sibling)return;const e=new $f(this.beans);Object.keys(this).forEach(i=>{Wbe.has(i)||(e[i]=this[i])}),e.footer=!0,e.setRowTop(null),e.setRowIndex(null),e.oldRowTop=null,e.id="rowGroupFooter_"+this.id,e.sibling=this,this.sibling=e}destroyFooter(){this.sibling&&(this.sibling.setRowTop(null),this.sibling.setRowIndex(null),this.sibling=void 0)}setFirstChild(e){this.firstChild!==e&&(this.firstChild=e,this.dispatchRowEvent("firstChildChanged"))}setLastChild(e){this.lastChild!==e&&(this.lastChild=e,this.dispatchRowEvent("lastChildChanged"))}setChildIndex(e){this.childIndex!==e&&(this.childIndex=e,this.dispatchRowEvent("childIndexChanged"))}setDisplayed(e){this.displayed!==e&&(this.displayed=e,this.dispatchRowEvent("displayedChanged"))}setDragging(e){this.dragging!==e&&(this.dragging=e,this.dispatchRowEvent("draggingChanged"))}setHighlighted(e){this.highlighted!==e&&(this.highlighted=e,this.dispatchRowEvent("rowHighlightChanged"))}setAllChildrenCount(e){this.allChildrenCount!==e&&(this.allChildrenCount=e,this.dispatchRowEvent("allChildrenCountChanged"))}setRowIndex(e){this.rowIndex!==e&&(this.rowIndex=e,this.dispatchRowEvent("rowIndexChanged"))}setUiLevel(e){this.uiLevel!==e&&(this.uiLevel=e,this.dispatchRowEvent("uiLevelChanged"))}};VC.ID_PREFIX_ROW_GROUP="row-group-";VC.ID_PREFIX_TOP_PINNED="t-";VC.ID_PREFIX_BOTTOM_PINNED="b-";VC.OBJECT_ID_SEQUENCE=0;var Ad=VC,qbe=class extends kt{constructor(){super(...arguments),this.beanName="filterManager",this.advancedFilterModelUpdateQueue=[]}wireBeans(t){this.columnModel=t.columnModel,this.dataTypeService=t.dataTypeService,this.quickFilterService=t.quickFilterService,this.advancedFilterService=t.advancedFilterService,this.columnFilterService=t.columnFilterService}postConstruct(){const t=this.refreshFiltersForAggregations.bind(this),e=this.updateAdvancedFilterColumns.bind(this);this.addManagedEventListeners({columnValueChanged:t,columnPivotChanged:t,columnPivotModeChanged:t,newColumnsLoaded:e,columnVisible:e,advancedFilterEnabledChanged:({enabled:i})=>this.onAdvancedFilterEnabledChanged(i),dataTypesInferred:this.processFilterModelUpdateQueue.bind(this)}),this.externalFilterPresent=this.isExternalFilterPresentCallback(),this.addManagedPropertyListeners(["isExternalFilterPresent","doesExternalFilterPass"],()=>{this.onFilterChanged({source:"api"})}),this.updateAggFiltering(),this.addManagedPropertyListener("groupAggFiltering",()=>{this.updateAggFiltering(),this.onFilterChanged()}),this.addManagedPropertyListener("advancedFilterModel",i=>this.setAdvancedFilterModel(i.currentValue)),this.quickFilterService&&this.addManagedListeners(this.quickFilterService,{quickFilterChanged:()=>this.onFilterChanged({source:"quickFilter"})})}isExternalFilterPresentCallback(){const t=this.gos.getCallback("isExternalFilterPresent");return typeof t=="function"?t({}):!1}doesExternalFilterPass(t){const e=this.gos.get("doesExternalFilterPass");return typeof e=="function"?e(t):!1}setFilterModel(t,e="api"){if(this.isAdvancedFilterEnabled()){this.warnAdvancedFilters();return}this.columnFilterService?.setFilterModel(t,e)}getFilterModel(){return this.columnFilterService?.getFilterModel()??{}}isColumnFilterPresent(){return!!this.columnFilterService?.isColumnFilterPresent()}isAggregateFilterPresent(){return!!this.columnFilterService?.isAggregateFilterPresent()}isExternalFilterPresent(){return this.externalFilterPresent}isChildFilterPresent(){return this.isColumnFilterPresent()||this.isQuickFilterPresent()||this.isExternalFilterPresent()||this.isAdvancedFilterPresent()}isAdvancedFilterPresent(){return this.isAdvancedFilterEnabled()&&this.advancedFilterService.isFilterPresent()}onAdvancedFilterEnabledChanged(t){t?this.columnFilterService?.disableColumnFilters()&&this.onFilterChanged({source:"advancedFilter"}):this.advancedFilterService?.isFilterPresent()&&(this.advancedFilterService.setModel(null),this.onFilterChanged({source:"advancedFilter"}))}isAdvancedFilterEnabled(){return!!this.advancedFilterService?.isEnabled()}isAdvancedFilterHeaderActive(){return this.isAdvancedFilterEnabled()&&this.advancedFilterService.isHeaderActive()}isAnyFilterPresent(){return this.isQuickFilterPresent()||this.isColumnFilterPresent()||this.isAggregateFilterPresent()||this.isExternalFilterPresent()||this.isAdvancedFilterPresent()}resetQuickFilterCache(){this.quickFilterService?.resetQuickFilterCache()}refreshFiltersForAggregations(){pz(this.gos)&&this.onFilterChanged()}onFilterChanged(t={}){const{source:e,additionalEventAttributes:i,columns:n=[]}=t;this.externalFilterPresent=this.isExternalFilterPresentCallback(),(this.columnFilterService?this.columnFilterService.updateBeforeFilterChanged(t):Hl.resolve()).then(()=>{const r={source:e,type:"filterChanged",columns:n};i&&ka(r,i),this.eventService.dispatchEvent(r),this.columnFilterService?.updateAfterFilterChanged()})}isSuppressFlashingCellsBecauseFiltering(){return!!this.columnFilterService?.isSuppressFlashingCellsBecauseFiltering()}isQuickFilterPresent(){return!!this.quickFilterService?.isQuickFilterPresent()}updateAggFiltering(){this.aggFiltering=!!pz(this.gos)}isAggregateQuickFilterPresent(){return this.isQuickFilterPresent()&&this.shouldApplyQuickFilterAfterAgg()}isNonAggregateQuickFilterPresent(){return this.isQuickFilterPresent()&&!this.shouldApplyQuickFilterAfterAgg()}shouldApplyQuickFilterAfterAgg(){return(this.aggFiltering||this.columnModel.isPivotMode())&&!this.gos.get("applyQuickFilterBeforePivotOrAgg")}doesRowPassOtherFilters(t,e){return this.doesRowPassFilter({rowNode:e,filterInstanceToSkip:t})}doesRowPassAggregateFilters(t){return!(this.isAggregateQuickFilterPresent()&&!this.quickFilterService.doesRowPassQuickFilter(t.rowNode)||this.isAggregateFilterPresent()&&!this.columnFilterService.doAggregateFiltersPass(t.rowNode,t.filterInstanceToSkip))}doesRowPassFilter(t){return!(this.isNonAggregateQuickFilterPresent()&&!this.quickFilterService.doesRowPassQuickFilter(t.rowNode)||this.isExternalFilterPresent()&&!this.doesExternalFilterPass(t.rowNode)||this.isColumnFilterPresent()&&!this.columnFilterService.doColumnFiltersPass(t.rowNode,t.filterInstanceToSkip)||this.isAdvancedFilterPresent()&&!this.advancedFilterService.doesFilterPass(t.rowNode))}isFilterActive(t){return!!this.columnFilterService?.isFilterActive(t)}getOrCreateFilterWrapper(t){return this.columnFilterService?.getOrCreateFilterWrapper(t)??null}getDefaultFloatingFilter(t){return this.columnFilterService.getDefaultFloatingFilter(t)}createFilterParams(t,e){return this.columnFilterService.createFilterParams(t,e)}isFilterAllowed(t){return this.isAdvancedFilterEnabled()?!1:!!this.columnFilterService?.isFilterAllowed(t)}getFloatingFilterCompDetails(t,e){return this.columnFilterService?.getFloatingFilterCompDetails(t,e)}getCurrentFloatingFilterParentModel(t){return this.columnFilterService?.getCurrentFloatingFilterParentModel(t)}destroyFilter(t,e="api"){this.columnFilterService?.destroyFilter(t,e)}areFilterCompsDifferent(t,e){return!!this.columnFilterService?.areFilterCompsDifferent(t,e)}getAdvancedFilterModel(){return this.isAdvancedFilterEnabled()?this.advancedFilterService.getModel():null}setAdvancedFilterModel(t){if(this.isAdvancedFilterEnabled()){if(this.dataTypeService?.isPendingInference()){this.advancedFilterModelUpdateQueue.push(t);return}this.advancedFilterService.setModel(t??null),this.onFilterChanged({source:"advancedFilter"})}}toggleAdvancedFilterBuilder(t,e){this.isAdvancedFilterEnabled()&&this.advancedFilterService.getCtrl().toggleFilterBuilder({source:e,force:t})}updateAdvancedFilterColumns(){this.isAdvancedFilterEnabled()&&this.advancedFilterService.updateValidity()&&this.onFilterChanged({source:"advancedFilter"})}hasFloatingFilters(){return this.isAdvancedFilterEnabled()?!1:!!this.columnFilterService?.hasFloatingFilters()}getFilterInstance(t,e){if(this.isAdvancedFilterEnabled()){this.warnAdvancedFilters();return}return this.columnFilterService?.getFilterInstance(t,e)}getColumnFilterInstance(t){return this.isAdvancedFilterEnabled()?(this.warnAdvancedFilters(),Promise.resolve(void 0)):this.columnFilterService?.getColumnFilterInstance(t)??Promise.resolve(void 0)}warnAdvancedFilters(){Wt("Column Filter API methods have been disabled as Advanced Filters are enabled.")}setupAdvancedFilterHeaderComp(t){this.advancedFilterService?.getCtrl().setupHeaderComp(t)}getHeaderRowCount(){return this.isAdvancedFilterHeaderActive()?1:0}getHeaderHeight(){return this.isAdvancedFilterHeaderActive()?this.advancedFilterService.getCtrl().getHeaderHeight():0}processFilterModelUpdateQueue(){this.advancedFilterModelUpdateQueue.forEach(t=>this.setAdvancedFilterModel(t)),this.advancedFilterModelUpdateQueue=[]}getColumnFilterModel(t){return this.columnFilterService?.getColumnFilterModel(t)}setColumnFilterModel(t,e){return this.isAdvancedFilterEnabled()?(this.warnAdvancedFilters(),Promise.resolve()):this.columnFilterService?.setColumnFilterModel(t,e)??Promise.resolve()}setColDefPropertiesForDataType(t,e,i){this.columnFilterService?.setColDefPropertiesForDataType(t,e,i)}},jbe=class extends ir{constructor(t,e){super('<div class="ag-filter"></div>'),this.column=t,this.source=e,this.filterWrapper=null}wireBeans(t){this.filterManager=t.filterManager,this.columnModel=t.columnModel}postConstruct(){this.createFilter(!0),this.addManagedEventListeners({filterDestroyed:this.onFilterDestroyed.bind(this)})}hasFilter(){return!!this.filterWrapper}getFilter(){return this.filterWrapper?.filterPromise??null}afterInit(){return this.filterWrapper?.filterPromise?.then(()=>{})??Hl.resolve()}afterGuiAttached(t){this.filterWrapper?.filterPromise?.then(e=>{e?.afterGuiAttached?.(t)})}afterGuiDetached(){this.filterWrapper?.filterPromise?.then(t=>{t?.afterGuiDetached?.()})}createFilter(t){const{column:e,source:i}=this;this.filterWrapper=this.filterManager?.getOrCreateFilterWrapper(e)??null,this.filterWrapper?.filterPromise&&this.filterWrapper.filterPromise.then(n=>{const r=n.getGui();oi(r)||Wt(`getGui method from filter returned ${r}; it should be a DOM element.`),this.appendChild(r),t&&this.eventService.dispatchEvent({type:"filterOpened",column:e,source:i,eGui:this.getGui()})})}onFilterDestroyed(t){(t.source==="api"||t.source==="paramsUpdated")&&t.column.getId()===this.column.getId()&&this.columnModel.getColDefCol(this.column)&&(fa(this.getGui()),this.createFilter())}destroy(){this.filterWrapper=null,super.destroy()}},tJ="ag-resizer-wrapper",Df=(t,e)=>`<div data-ref="${t}Resizer" class="ag-resizer ag-resizer-${e}"></div>`,Qbe=`<div class="${tJ}">
        ${Df("eTopLeft","topLeft")}
        ${Df("eTop","top")}
        ${Df("eTopRight","topRight")}
        ${Df("eRight","right")}
        ${Df("eBottomRight","bottomRight")}
        ${Df("eBottom","bottom")}
        ${Df("eBottomLeft","bottomLeft")}
        ${Df("eLeft","left")}
    </div>`,Zbe=class extends kt{constructor(t,e){super(),this.element=t,this.dragStartPosition={x:0,y:0},this.position={x:0,y:0},this.lastSize={width:-1,height:-1},this.positioned=!1,this.resizersAdded=!1,this.resizeListeners=[],this.boundaryEl=null,this.isResizing=!1,this.isMoving=!1,this.resizable={},this.movable=!1,this.currentResizer=null,this.config=Object.assign({},{popup:!1},e)}wireBeans(t){this.popupService=t.popupService,this.resizeObserverService=t.resizeObserverService,this.dragService=t.dragService}center(){const{clientHeight:t,clientWidth:e}=this.offsetParent,i=e/2-this.getWidth()/2,n=t/2-this.getHeight()/2;this.offsetElement(i,n)}initialisePosition(){if(this.positioned)return;const{centered:t,forcePopupParentAsOffsetParent:e,minWidth:i,width:n,minHeight:r,height:s,x:o,y:a}=this.config;this.offsetParent||this.setOffsetParent();let l=0,u=0;const d=Ou(this.element);if(d){const p=this.findBoundaryElement(),v=window.getComputedStyle(p);if(v.minWidth!=null){const y=p.offsetWidth-this.element.offsetWidth;u=parseInt(v.minWidth,10)-y}if(v.minHeight!=null){const y=p.offsetHeight-this.element.offsetHeight;l=parseInt(v.minHeight,10)-y}}if(this.minHeight=r||l,this.minWidth=i||u,n&&this.setWidth(n),s&&this.setHeight(s),(!n||!s)&&this.refreshSize(),t)this.center();else if(o||a)this.offsetElement(o,a);else if(d&&e){let p=this.boundaryEl,v=!0;if(p||(p=this.findBoundaryElement(),v=!1),p){const y=parseFloat(p.style.top),w=parseFloat(p.style.left);v?this.offsetElement(isNaN(w)?0:w,isNaN(y)?0:y):this.setPosition(w,y)}}this.positioned=!!this.offsetParent}isPositioned(){return this.positioned}getPosition(){return this.position}setMovable(t,e){if(!this.config.popup||t===this.movable)return;this.movable=t;const i=this.moveElementDragListener||{eElement:e,onDragStart:this.onMoveStart.bind(this),onDragging:this.onMove.bind(this),onDragStop:this.onMoveEnd.bind(this)};t?(this.dragService.addDragSource(i),this.moveElementDragListener=i):(this.dragService.removeDragSource(i),this.moveElementDragListener=void 0)}setResizable(t){if(this.clearResizeListeners(),t?this.addResizers():this.removeResizers(),typeof t=="boolean"){if(t===!1)return;t={topLeft:t,top:t,topRight:t,right:t,bottomRight:t,bottom:t,bottomLeft:t,left:t}}Object.keys(t).forEach(e=>{const n=!!t[e],r=this.getResizerElement(e),s={dragStartPixels:0,eElement:r,onDragStart:o=>this.onResizeStart(o,e),onDragging:this.onResize.bind(this),onDragStop:o=>this.onResizeEnd(o,e)};(n||!this.isAlive()&&!n)&&(n?(this.dragService.addDragSource(s),this.resizeListeners.push(s),r.style.pointerEvents="all"):r.style.pointerEvents="none",this.resizable[e]=n)})}removeSizeFromEl(){this.element.style.removeProperty("height"),this.element.style.removeProperty("width"),this.element.style.removeProperty("flex")}restoreLastSize(){this.element.style.flex="0 0 auto";const{height:t,width:e}=this.lastSize;e!==-1&&(this.element.style.width=`${e}px`),t!==-1&&(this.element.style.height=`${t}px`)}getHeight(){return this.element.offsetHeight}setHeight(t){const{popup:e}=this.config,i=this.element;let n=!1;if(typeof t=="string"&&t.indexOf("%")!==-1)jw(i,t),t=NY(i),n=!0;else if(t=Math.max(this.minHeight,t),this.positioned){const r=this.getAvailableHeight();r&&t>r&&(t=r)}this.getHeight()!==t&&(n?(i.style.maxHeight="unset",i.style.minHeight="unset"):e?jw(i,t):(i.style.height=`${t}px`,i.style.flex="0 0 auto",this.lastSize.height=typeof t=="number"?t:parseFloat(t)))}getAvailableHeight(){const{popup:t,forcePopupParentAsOffsetParent:e}=this.config;this.positioned||this.initialisePosition();const{clientHeight:i}=this.offsetParent;if(!i)return null;const n=this.element.getBoundingClientRect(),r=this.offsetParent.getBoundingClientRect(),s=t?this.position.y:n.top,o=t?0:r.top;let a=0;if(e){const u=this.element.parentElement;if(u){const{bottom:d}=u.getBoundingClientRect();a=d-n.bottom}}return i+o-s-a}getWidth(){return this.element.offsetWidth}setWidth(t){const e=this.element,{popup:i}=this.config;let n=!1;if(typeof t=="string"&&t.indexOf("%")!==-1)_u(e,t),t=RT(e),n=!0;else if(this.positioned){t=Math.max(this.minWidth,t);const{clientWidth:r}=this.offsetParent,s=i?this.position.x:this.element.getBoundingClientRect().left;r&&t+s>r&&(t=r-s)}this.getWidth()!==t&&(n?(e.style.maxWidth="unset",e.style.minWidth="unset"):this.config.popup?_u(e,t):(e.style.width=`${t}px`,e.style.flex=" unset",this.lastSize.width=typeof t=="number"?t:parseFloat(t)))}offsetElement(t=0,e=0){const{forcePopupParentAsOffsetParent:i}=this.config,n=i?this.boundaryEl:this.element;n&&(this.popupService.positionPopup({ePopup:n,keepWithinBounds:!0,skipObserver:this.movable||this.isResizable(),updatePosition:()=>({x:t,y:e})}),this.setPosition(parseFloat(n.style.left),parseFloat(n.style.top)))}constrainSizeToAvailableHeight(t){if(!this.config.forcePopupParentAsOffsetParent)return;const e=()=>{const i=this.getAvailableHeight();this.element.style.setProperty("max-height",`${i}px`)};t?this.resizeObserverSubscriber=this.resizeObserverService.observeResize(this.popupService.getPopupParent(),e):(this.element.style.removeProperty("max-height"),this.resizeObserverSubscriber&&(this.resizeObserverSubscriber(),this.resizeObserverSubscriber=void 0))}setPosition(t,e){this.position.x=t,this.position.y=e}updateDragStartPosition(t,e){this.dragStartPosition={x:t,y:e}}calculateMouseMovement(t){const{e,isLeft:i,isTop:n,anywhereWithin:r,topBuffer:s}=t,o=e.clientX-this.dragStartPosition.x,a=e.clientY-this.dragStartPosition.y,l=this.shouldSkipX(e,!!i,!!r,o)?0:o,u=this.shouldSkipY(e,!!n,s,a)?0:a;return{movementX:l,movementY:u}}shouldSkipX(t,e,i,n){const r=this.element.getBoundingClientRect(),s=this.offsetParent.getBoundingClientRect(),o=this.boundaryEl.getBoundingClientRect(),a=this.config.popup?this.position.x:r.left;let l=a<=0&&s.left>=t.clientX||s.right<=t.clientX&&s.right<=o.right;return l?!0:(e?l=n<0&&t.clientX>a+s.left||n>0&&t.clientX<a+s.left:i?l=n<0&&t.clientX>o.right||n>0&&t.clientX<a+s.left:l=n<0&&t.clientX>o.right||n>0&&t.clientX<o.right,l)}shouldSkipY(t,e,i=0,n){const r=this.element.getBoundingClientRect(),s=this.offsetParent.getBoundingClientRect(),o=this.boundaryEl.getBoundingClientRect(),a=this.config.popup?this.position.y:r.top;let l=a<=0&&s.top>=t.clientY||s.bottom<=t.clientY&&s.bottom<=o.bottom;return l?!0:(e?l=n<0&&t.clientY>a+s.top+i||n>0&&t.clientY<a+s.top:l=n<0&&t.clientY>o.bottom||n>0&&t.clientY<o.bottom,l)}createResizeMap(){const t=this.element;this.resizerMap={topLeft:{element:t.querySelector("[data-ref=eTopLeftResizer]")},top:{element:t.querySelector("[data-ref=eTopResizer]")},topRight:{element:t.querySelector("[data-ref=eTopRightResizer]")},right:{element:t.querySelector("[data-ref=eRightResizer]")},bottomRight:{element:t.querySelector("[data-ref=eBottomRightResizer]")},bottom:{element:t.querySelector("[data-ref=eBottomResizer]")},bottomLeft:{element:t.querySelector("[data-ref=eBottomLeftResizer]")},left:{element:t.querySelector("[data-ref=eLeftResizer]")}}}addResizers(){if(this.resizersAdded)return;const t=this.element;if(!t)return;const i=new DOMParser().parseFromString(Qbe,"text/html").body;t.appendChild(i.firstChild),this.createResizeMap(),this.resizersAdded=!0}removeResizers(){this.resizerMap=void 0;const t=this.element.querySelector(`.${tJ}`);t&&this.element.removeChild(t),this.resizersAdded=!1}getResizerElement(t){return this.resizerMap[t].element}onResizeStart(t,e){this.boundaryEl=this.findBoundaryElement(),this.positioned||this.initialisePosition(),this.currentResizer={isTop:!!e.match(/top/i),isRight:!!e.match(/right/i),isBottom:!!e.match(/bottom/i),isLeft:!!e.match(/left/i)},this.element.classList.add("ag-resizing"),this.resizerMap[e].element.classList.add("ag-active");const{popup:i,forcePopupParentAsOffsetParent:n}=this.config;!i&&!n&&this.applySizeToSiblings(this.currentResizer.isBottom||this.currentResizer.isTop),this.isResizing=!0,this.updateDragStartPosition(t.clientX,t.clientY)}getSiblings(){const e=this.element.parentElement;return e?Array.prototype.slice.call(e.children).filter(i=>!i.classList.contains("ag-hidden")):null}getMinSizeOfSiblings(){const t=this.getSiblings()||[];let e=0,i=0;for(let n=0;n<t.length;n++){const r=t[n],s=!!r.style.flex&&r.style.flex!=="0 0 auto";if(r===this.element)continue;let o=this.minHeight||0,a=this.minWidth||0;if(s){const l=window.getComputedStyle(r);l.minHeight&&(o=parseInt(l.minHeight,10)),l.minWidth&&(a=parseInt(l.minWidth,10))}else o=r.offsetHeight,a=r.offsetWidth;e+=o,i+=a}return{height:e,width:i}}applySizeToSiblings(t){let e=null;const i=this.getSiblings();if(i){for(let n=0;n<i.length;n++){const r=i[n];r!==e&&(t?r.style.height=`${r.offsetHeight}px`:r.style.width=`${r.offsetWidth}px`,r.style.flex="0 0 auto",r===this.element&&(e=i[n+1]))}e&&(e.style.removeProperty("height"),e.style.removeProperty("min-height"),e.style.removeProperty("max-height"),e.style.flex="1 1 auto")}}isResizable(){return Object.values(this.resizable).some(t=>t)}onResize(t){if(!this.isResizing||!this.currentResizer)return;const{popup:e,forcePopupParentAsOffsetParent:i}=this.config,{isTop:n,isRight:r,isBottom:s,isLeft:o}=this.currentResizer,a=r||o,l=s||n,{movementX:u,movementY:d}=this.calculateMouseMovement({e:t,isLeft:o,isTop:n}),p=this.position.x,v=this.position.y;let y=0,w=0;if(a&&u){const R=o?-1:1,O=this.getWidth(),P=O+u*R;let N=!1;o&&(y=O-P,(p+y<=0||P<=this.minWidth)&&(N=!0,y=0)),N||this.setWidth(P)}if(l&&d){const R=n?-1:1,O=this.getHeight(),P=O+d*R;let N=!1;n?(w=O-P,(v+w<=0||P<=this.minHeight)&&(N=!0,w=0)):!this.config.popup&&!this.config.forcePopupParentAsOffsetParent&&O<P&&this.getMinSizeOfSiblings().height+P>this.element.parentElement.offsetHeight&&(N=!0),N||this.setHeight(P)}this.updateDragStartPosition(t.clientX,t.clientY),((e||i)&&y||w)&&this.offsetElement(p+y,v+w)}onResizeEnd(t,e){this.isResizing=!1,this.currentResizer=null,this.boundaryEl=null,this.element.classList.remove("ag-resizing"),this.resizerMap[e].element.classList.remove("ag-active"),this.dispatchLocalEvent({type:"resize"})}refreshSize(){const t=this.element;this.config.popup&&(this.config.width||this.setWidth(t.offsetWidth),this.config.height||this.setHeight(t.offsetHeight))}onMoveStart(t){this.boundaryEl=this.findBoundaryElement(),this.positioned||this.initialisePosition(),this.isMoving=!0,this.element.classList.add("ag-moving"),this.updateDragStartPosition(t.clientX,t.clientY)}onMove(t){if(!this.isMoving)return;const{x:e,y:i}=this.position;let n;this.config.calculateTopBuffer&&(n=this.config.calculateTopBuffer());const{movementX:r,movementY:s}=this.calculateMouseMovement({e:t,isTop:!0,anywhereWithin:!0,topBuffer:n});this.offsetElement(e+r,i+s),this.updateDragStartPosition(t.clientX,t.clientY)}onMoveEnd(){this.isMoving=!1,this.boundaryEl=null,this.element.classList.remove("ag-moving")}setOffsetParent(){this.config.forcePopupParentAsOffsetParent?this.offsetParent=this.popupService.getPopupParent():this.offsetParent=this.element.offsetParent}findBoundaryElement(){let t=this.element;for(;t;){if(window.getComputedStyle(t).position!=="static")return t;t=t.parentElement}return this.element}clearResizeListeners(){for(;this.resizeListeners.length;){const t=this.resizeListeners.pop();this.dragService.removeDragSource(t)}}destroy(){super.destroy(),this.moveElementDragListener&&this.dragService.removeDragSource(this.moveElementDragListener),this.constrainSizeToAvailableHeight(!1),this.clearResizeListeners(),this.removeResizers()}},iJ=class nJ extends kt{constructor(e,i={}){super(),this.eFocusableElement=e,this.callbacks=i,this.callbacks={shouldStopEventPropagation:()=>!1,onTabKeyDown:n=>{if(n.defaultPrevented)return;const r=this.focusService.findNextFocusableElement(this.eFocusableElement,!1,n.shiftKey);r&&(r.focus(),n.preventDefault())},...i}}wireBeans(e){this.focusService=e.focusService}postConstruct(){this.eFocusableElement.classList.add(nJ.FOCUS_MANAGED_CLASS),this.addKeyDownListeners(this.eFocusableElement),this.callbacks.onFocusIn&&this.addManagedElementListeners(this.eFocusableElement,{focusin:this.callbacks.onFocusIn}),this.callbacks.onFocusOut&&this.addManagedElementListeners(this.eFocusableElement,{focusout:this.callbacks.onFocusOut})}addKeyDownListeners(e){this.addManagedElementListeners(e,{keydown:i=>{if(!(i.defaultPrevented||Ed(i))){if(this.callbacks.shouldStopEventPropagation(i)){S0(i);return}i.key===St.TAB?this.callbacks.onTabKeyDown(i):this.callbacks.handleKeyDown&&this.callbacks.handleKeyDown(i)}}})}};iJ.FOCUS_MANAGED_CLASS="ag-focus-managed";var Kg=iJ,rJ={applyFilter:"Apply",clearFilter:"Clear",resetFilter:"Reset",cancelFilter:"Cancel",textFilter:"Text Filter",numberFilter:"Number Filter",dateFilter:"Date Filter",setFilter:"Set Filter",filterOoo:"Filter...",empty:"Choose one",equals:"Equals",notEqual:"Does not equal",lessThan:"Less than",greaterThan:"Greater than",inRange:"Between",inRangeStart:"From",inRangeEnd:"To",lessThanOrEqual:"Less than or equal to",greaterThanOrEqual:"Greater than or equal to",contains:"Contains",notContains:"Does not contain",startsWith:"Begins with",endsWith:"Ends with",blank:"Blank",notBlank:"Not blank",before:"Before",after:"After",andCondition:"AND",orCondition:"OR",dateFormatOoo:"yyyy-mm-dd"};function vU(t,e){return kT(t)?(t.debounceMs!=null&&Wt("debounceMs is ignored when apply button is present"),0):t.debounceMs!=null?t.debounceMs:e}function kT(t){return!!t.buttons&&t.buttons.indexOf("apply")>=0}var Xbe=class extends ir{constructor(t){super(),this.filterNameKey=t,this.applyActive=!1,this.hidePopup=null,this.debouncePending=!1,this.appliedModel=null,this.eFilterBody=bi,this.buttonListeners=[]}wireBeans(t){this.rowModel=t.rowModel}postConstruct(){this.resetTemplate(),this.createManagedBean(new Kg(this.getFocusableElement(),{handleKeyDown:this.handleKeyDown.bind(this)})),this.positionableFeature=new Zbe(this.getPositionableElement(),{forcePopupParentAsOffsetParent:!0}),this.createBean(this.positionableFeature)}handleKeyDown(t){}getFilterTitle(){return this.translate(this.filterNameKey)}isFilterActive(){return!!this.appliedModel}resetTemplate(t){let e=this.getGui();e&&e.removeEventListener("submit",this.onFormSubmit);const i=`
            <form class="ag-filter-wrapper">
                <div class="ag-filter-body-wrapper ag-${this.getCssIdentifier()}-body-wrapper" data-ref="eFilterBody">
                    ${this.createBodyTemplate()}
                </div>
            </form>`;this.setTemplate(i,this.getAgComponents(),t),e=this.getGui(),e&&e.addEventListener("submit",this.onFormSubmit)}isReadOnly(){return!!this.providedFilterParams.readOnly}init(t){this.setParams(t),this.resetUiToDefaults(!0).then(()=>{this.updateUiVisibility(),this.setupOnBtApplyDebounce()})}setParams(t){this.providedFilterParams=t,this.applyActive=kT(t),this.resetButtonsPanel(t)}updateParams(t){this.providedFilterParams=t,this.applyActive=kT(t),this.resetUiToActiveModel(this.getModel(),()=>{this.updateUiVisibility(),this.setupOnBtApplyDebounce()})}resetButtonsPanel(t,e){const{buttons:i,readOnly:n}=e??{},{buttons:r,readOnly:s}=t;if(n===s&&V_(i,r))return;const o=r&&r.length>0&&!this.isReadOnly();if(this.eButtonsPanel?(fa(this.eButtonsPanel),this.buttonListeners.forEach(u=>u()),this.buttonListeners=[]):o&&(this.eButtonsPanel=document.createElement("div"),this.eButtonsPanel.classList.add("ag-filter-apply-panel")),!o){this.eButtonsPanel&&hh(this.eButtonsPanel);return}const a=document.createDocumentFragment(),l=u=>{let d,p;switch(u){case"apply":d=this.translate("applyFilter"),p=w=>this.onBtApply(!1,!1,w);break;case"clear":d=this.translate("clearFilter"),p=()=>this.onBtClear();break;case"reset":d=this.translate("resetFilter"),p=()=>this.onBtReset();break;case"cancel":d=this.translate("cancelFilter"),p=w=>{this.onBtCancel(w)};break;default:Wt("Unknown button type specified");return}const y=q_(`<button
                    type="${u==="apply"?"submit":"button"}"
                    data-ref="${u}FilterButton"
                    class="ag-button ag-standard-button ag-filter-apply-panel-button"
                >${d}
                </button>`);this.buttonListeners.push(...this.addManagedElementListeners(y,{click:p})),a.append(y)};r.forEach(u=>l(u)),this.eButtonsPanel.append(a),this.getGui().appendChild(this.eButtonsPanel)}getDefaultDebounceMs(){return 0}setupOnBtApplyDebounce(){const t=vU(this.providedFilterParams,this.getDefaultDebounceMs()),e=Fa(this.checkApplyDebounce.bind(this),t);this.onBtApplyDebounce=()=>{this.debouncePending=!0,e()}}checkApplyDebounce(){this.debouncePending&&(this.debouncePending=!1,this.onBtApply())}getModel(){return this.appliedModel?this.appliedModel:null}setModel(t){return(t!=null?this.setModelIntoUi(t):this.resetUiToDefaults()).then(()=>{this.updateUiVisibility(),this.applyModel("api")})}onBtCancel(t){this.resetUiToActiveModel(this.getModel(),()=>{this.handleCancelEnd(t)})}handleCancelEnd(t){this.providedFilterParams.closeOnApply&&this.close(t)}resetUiToActiveModel(t,e){const i=()=>{this.onUiChanged(!1,"prevent"),e?.()};t!=null?this.setModelIntoUi(t).then(i):this.resetUiToDefaults().then(i)}onBtClear(){this.resetUiToDefaults().then(()=>this.onUiChanged())}onBtReset(){this.onBtClear(),this.onBtApply()}applyModel(t="api"){const e=this.getModelFromUi();if(!this.isModelValid(e))return!1;const i=this.appliedModel;return this.appliedModel=e,!this.areModelsEqual(i,e)}isModelValid(t){return!0}onFormSubmit(t){t.preventDefault()}onBtApply(t=!1,e=!1,i){i&&i.preventDefault(),this.applyModel(e?"rowDataUpdated":"ui")&&this.providedFilterParams.filterChangedCallback({afterFloatingFilter:t,afterDataChange:e,source:"columnFilter"});const{closeOnApply:n}=this.providedFilterParams;n&&this.applyActive&&!t&&!e&&this.close(i)}onNewRowsLoaded(){}close(t){if(!this.hidePopup)return;const e=t,i=e&&e.key;let n;(i==="Enter"||i==="Space")&&(n={keyboardEvent:e}),this.hidePopup(n),this.hidePopup=null}onUiChanged(t=!1,e){if(this.updateUiVisibility(),this.providedFilterParams.filterModifiedCallback(),this.applyActive&&!this.isReadOnly()){const i=this.isModelValid(this.getModelFromUi()),n=this.queryForHtmlElement('[data-ref="applyFilterButton"]');n&&W_(n,!i)}t&&!e||e==="immediately"?this.onBtApply(t):(!this.applyActive&&!e||e==="debounce")&&this.onBtApplyDebounce()}afterGuiAttached(t){t&&(this.hidePopup=t.hidePopup),this.refreshFilterResizer(t?.container)}refreshFilterResizer(t){if(!this.positionableFeature||t==="toolPanel")return;const e=t==="floatingFilter"||t==="columnFilter",{positionableFeature:i,gos:n}=this;e?(i.restoreLastSize(),i.setResizable(n.get("enableRtl")?{bottom:!0,bottomLeft:!0,left:!0}:{bottom:!0,bottomRight:!0,right:!0})):(this.positionableFeature.removeSizeFromEl(),this.positionableFeature.setResizable(!1)),this.positionableFeature.constrainSizeToAvailableHeight(!0)}afterGuiDetached(){this.checkApplyDebounce(),this.positionableFeature&&this.positionableFeature.constrainSizeToAvailableHeight(!1)}refresh(t){const e=this.providedFilterParams;return this.providedFilterParams=t,this.resetButtonsPanel(t,e),!0}destroy(){const t=this.getGui();t&&t.removeEventListener("submit",this.onFormSubmit),this.hidePopup=null,this.positionableFeature&&(this.positionableFeature=this.destroyBean(this.positionableFeature)),this.appliedModel=null,super.destroy()}translate(t){return this.localeService.getLocaleTextFunc()(t,rJ[t])}getCellValue(t){return this.providedFilterParams.getValue(t)}getPositionableElement(){return this.eFilterBody}},Kbe=class extends pU{constructor(t){super(t,"ag-radio-button","radio")}isSelected(){return this.eInput.checked}toggle(){this.eInput.disabled||this.isSelected()||this.setValue(!0)}addInputListeners(){super.addInputListeners(),this.addManagedEventListeners({checkboxChanged:this.onChange.bind(this)})}onChange(t){t.selected&&t.name&&this.eInput.name&&this.eInput.name===t.name&&t.id&&this.eInput.id!==t.id&&this.setValue(!1,!0)}},Ybe=class extends ir{constructor(t="default",e=!1){super(`<div class="ag-list ag-${t}-list" role="listbox"></div>`),this.cssIdentifier=t,this.unFocusable=e,this.activeClass="ag-active-item",this.options=[],this.itemEls=[]}postConstruct(){const t=this.getGui();this.addManagedElementListeners(t,{mouseleave:()=>this.clearHighlighted()}),!this.unFocusable&&this.addManagedElementListeners(t,{keydown:this.handleKeyDown.bind(this)})}handleKeyDown(t){const e=t.key;switch(e){case St.ENTER:if(!this.highlightedEl)this.setValue(this.getValue());else{const i=this.itemEls.indexOf(this.highlightedEl);this.setValueByIndex(i)}break;case St.DOWN:case St.UP:t.preventDefault(),this.navigate(e);break;case St.PAGE_DOWN:case St.PAGE_UP:case St.PAGE_HOME:case St.PAGE_END:t.preventDefault(),this.navigateToPage(e);break}}navigate(t){const e=t===St.DOWN;let i;if(!this.highlightedEl)i=this.itemEls[e?0:this.itemEls.length-1];else{let r=this.itemEls.indexOf(this.highlightedEl)+(e?1:-1);r=Math.min(Math.max(r,0),this.itemEls.length-1),i=this.itemEls[r]}this.highlightItem(i)}navigateToPage(t){if(!this.highlightedEl||this.itemEls.length===0)return;const e=this.itemEls.indexOf(this.highlightedEl),i=this.options.length-1,n=this.itemEls[0].clientHeight,r=Math.floor(this.getGui().clientHeight/n);let s=-1;t===St.PAGE_HOME?s=0:t===St.PAGE_END?s=i:t===St.PAGE_DOWN?s=Math.min(e+r,i):t===St.PAGE_UP&&(s=Math.max(e-r,0)),s!==-1&&this.highlightItem(this.itemEls[s])}addOptions(t){return t.forEach(e=>this.addOption(e)),this}addOption(t){const{value:e,text:i}=t,n=i||e;return this.options.push({value:e,text:n}),this.renderOption(e,n),this.updateIndices(),this}clearOptions(){this.options=[],this.reset(!0),this.itemEls.forEach(t=>{hh(t)}),this.itemEls=[]}updateIndices(){const t=this.getGui().querySelectorAll(".ag-list-item");t.forEach((e,i)=>{Exe(e,i+1),Pxe(e,t.length)})}renderOption(t,e){const i=Rs(this.gos),n=i.createElement("div");nc(n,"option"),n.classList.add("ag-list-item",`ag-${this.cssIdentifier}-list-item`);const r=i.createElement("span");n.appendChild(r),r.textContent=e,this.unFocusable||(n.tabIndex=-1),this.itemEls.push(n),this.addManagedListeners(n,{mouseover:()=>this.highlightItem(n),mousedown:s=>{s.preventDefault(),s.stopPropagation(),this.setValue(t)}}),this.createManagedBean(new nx({getTooltipValue:()=>e,getGui:()=>n,getLocation:()=>"UNKNOWN",shouldDisplayTooltip:()=>r.scrollWidth>r.clientWidth})),this.getGui().appendChild(n)}setValue(t,e){if(this.value===t)return this.fireItemSelected(),this;if(t==null)return this.reset(e),this;const i=this.options.findIndex(n=>n.value===t);if(i!==-1){const n=this.options[i];this.value=n.value,this.displayValue=n.text,this.highlightItem(this.itemEls[i]),e||this.fireChangeEvent()}return this}setValueByIndex(t){return this.setValue(this.options[t].value)}getValue(){return this.value}getDisplayValue(){return this.displayValue}refreshHighlighted(){this.clearHighlighted();const t=this.options.findIndex(e=>e.value===this.value);t!==-1&&this.highlightItem(this.itemEls[t])}reset(t){this.value=null,this.displayValue=null,this.clearHighlighted(),t||this.fireChangeEvent()}highlightItem(t){if(!Ou(t))return;this.clearHighlighted(),this.highlightedEl=t,this.highlightedEl.classList.add(this.activeClass),TT(this.highlightedEl,!0);const e=this.getGui(),{scrollTop:i,clientHeight:n}=e,{offsetTop:r,offsetHeight:s}=t;(r+s>i+n||r<i)&&this.highlightedEl.scrollIntoView({block:"nearest"}),this.unFocusable||this.highlightedEl.focus()}clearHighlighted(){!this.highlightedEl||!Ou(this.highlightedEl)||(this.highlightedEl.classList.remove(this.activeClass),TT(this.highlightedEl,!1),this.highlightedEl=null)}fireChangeEvent(){this.dispatchLocalEvent({type:"fieldValueChanged"}),this.fireItemSelected()}fireItemSelected(){this.dispatchLocalEvent({type:"selectedItem"})}},Jbe=class extends QY{constructor(t){if(super(t,t?.template||`
            <div class="ag-picker-field" role="presentation">
                <div data-ref="eLabel"></div>
                <div data-ref="eWrapper" class="ag-wrapper ag-picker-field-wrapper ag-picker-collapsed">
                    <div data-ref="eDisplayField" class="ag-picker-field-display"></div>
                    <div data-ref="eIcon" class="ag-picker-field-icon" aria-hidden="true"></div>
                </div>
            </div>`,t?.agComponents||[],t?.className),this.isPickerDisplayed=!1,this.skipClick=!1,this.pickerGap=4,this.hideCurrentPicker=null,this.eLabel=bi,this.eWrapper=bi,this.eDisplayField=bi,this.eIcon=bi,this.ariaRole=t?.ariaRole,this.onPickerFocusIn=this.onPickerFocusIn.bind(this),this.onPickerFocusOut=this.onPickerFocusOut.bind(this),!t)return;const{pickerGap:e,maxPickerHeight:i,variableWidth:n,minPickerWidth:r,maxPickerWidth:s}=t;e!=null&&(this.pickerGap=e),this.variableWidth=!!n,i!=null&&this.setPickerMaxHeight(i),r!=null&&this.setPickerMinWidth(r),s!=null&&this.setPickerMaxWidth(s)}wireBeans(t){this.popupService=t.popupService}postConstruct(){super.postConstruct(),this.setupAria();const t=`ag-${this.getCompId()}-display`;this.eDisplayField.setAttribute("id",t);const e=this.getAriaElement();this.addManagedElementListeners(e,{keydown:this.onKeyDown.bind(this)}),this.addManagedElementListeners(this.eLabel,{mousedown:this.onLabelOrWrapperMouseDown.bind(this)}),this.addManagedElementListeners(this.eWrapper,{mousedown:this.onLabelOrWrapperMouseDown.bind(this)});const{pickerIcon:i,inputWidth:n}=this.config;if(i){const r=Ql(i,this.gos);r&&this.eIcon.appendChild(r)}n!=null&&this.setInputWidth(n)}setupAria(){const t=this.getAriaElement();t.setAttribute("tabindex",this.gos.get("tabIndex").toString()),MT(t,!1),this.ariaRole&&nc(t,this.ariaRole)}onLabelOrWrapperMouseDown(t){if(t){const e=this.getFocusableElement();if(e!==this.eWrapper&&t?.target===e)return;t.preventDefault(),this.getFocusableElement().focus()}if(this.skipClick){this.skipClick=!1;return}this.isDisabled()||(this.isPickerDisplayed?this.hidePicker():this.showPicker())}onKeyDown(t){switch(t.key){case St.UP:case St.DOWN:case St.ENTER:case St.SPACE:t.preventDefault(),this.onLabelOrWrapperMouseDown();break;case St.ESCAPE:this.isPickerDisplayed&&(t.preventDefault(),t.stopPropagation(),this.hideCurrentPicker&&this.hideCurrentPicker());break}}showPicker(){this.isPickerDisplayed=!0,this.pickerComponent||(this.pickerComponent=this.createPickerComponent());const t=this.pickerComponent.getGui();t.addEventListener("focusin",this.onPickerFocusIn),t.addEventListener("focusout",this.onPickerFocusOut),this.hideCurrentPicker=this.renderAndPositionPicker(),this.toggleExpandedStyles(!0)}renderAndPositionPicker(){const t=this.pickerComponent.getGui();this.gos.get("suppressScrollWhenPopupsAreOpen")||([this.destroyMouseWheelFunc]=this.addManagedEventListeners({bodyScroll:()=>{this.hidePicker()}}));const e=this.localeService.getLocaleTextFunc(),{pickerAriaLabelKey:i,pickerAriaLabelValue:n,modalPicker:r=!0}=this.config,s={modal:r,eChild:t,closeOnEsc:!0,closedCallback:()=>{const v=cY(this.gos);this.beforeHidePicker(),v&&this.isAlive()&&this.getFocusableElement().focus()},ariaLabel:e(i,n),anchorToElement:this.eWrapper};t.style.position="absolute";const o=this.popupService.addPopup(s),{maxPickerHeight:a,minPickerWidth:l,maxPickerWidth:u,variableWidth:d}=this;d?(l&&(t.style.minWidth=l),t.style.width=hU(RT(this.eWrapper)),u&&(t.style.maxWidth=u)):IT(t,u??RT(this.eWrapper));const p=a??`${uU(this.popupService.getPopupParent())}px`;return t.style.setProperty("max-height",p),this.alignPickerToComponent(),o.hideFunc}alignPickerToComponent(){if(!this.pickerComponent)return;const{pickerType:t}=this.config,{pickerGap:e}=this,i=this.gos.get("enableRtl")?"right":"left";this.popupService.positionPopupByComponent({type:t,eventSource:this.eWrapper,ePopup:this.pickerComponent.getGui(),position:"under",alignSide:i,keepWithinBounds:!0,nudgeY:e})}beforeHidePicker(){this.destroyMouseWheelFunc&&(this.destroyMouseWheelFunc(),this.destroyMouseWheelFunc=void 0),this.toggleExpandedStyles(!1);const t=this.pickerComponent.getGui();t.removeEventListener("focusin",this.onPickerFocusIn),t.removeEventListener("focusout",this.onPickerFocusOut),this.isPickerDisplayed=!1,this.pickerComponent=void 0,this.hideCurrentPicker=null}toggleExpandedStyles(t){if(!this.isAlive())return;const e=this.getAriaElement();MT(e,t),this.eWrapper.classList.toggle("ag-picker-expanded",t),this.eWrapper.classList.toggle("ag-picker-collapsed",!t)}onPickerFocusIn(){this.togglePickerHasFocus(!0)}onPickerFocusOut(t){this.pickerComponent?.getGui().contains(t.relatedTarget)||this.togglePickerHasFocus(!1)}togglePickerHasFocus(t){this.pickerComponent&&this.eWrapper.classList.toggle("ag-picker-has-focus",t)}hidePicker(){this.hideCurrentPicker&&this.hideCurrentPicker()}setInputWidth(t){return IT(this.eWrapper,t),this}getFocusableElement(){return this.eWrapper}setPickerGap(t){return this.pickerGap=t,this}setPickerMinWidth(t){return typeof t=="number"&&(t=`${t}px`),this.minPickerWidth=t??void 0,this}setPickerMaxWidth(t){return typeof t=="number"&&(t=`${t}px`),this.maxPickerWidth=t??void 0,this}setPickerMaxHeight(t){return typeof t=="number"&&(t=`${t}px`),this.maxPickerHeight=t??void 0,this}destroy(){this.hidePicker(),super.destroy()}},yU=class extends Jbe{constructor(t){super({pickerAriaLabelKey:"ariaLabelSelectField",pickerAriaLabelValue:"Select Field",pickerType:"ag-list",className:"ag-select",pickerIcon:"smallDown",ariaRole:"combobox",...t})}postConstruct(){super.postConstruct(),this.createListComponent(),this.eWrapper.tabIndex=this.gos.get("tabIndex");const{options:t,value:e,placeholder:i}=this.config;t!=null&&this.addOptions(t),e!=null&&this.setValue(e,!0),i&&e==null&&(this.eDisplayField.textContent=i),this.addManagedElementListeners(this.eWrapper,{focusout:this.onWrapperFocusOut.bind(this)})}onWrapperFocusOut(t){this.eWrapper.contains(t.relatedTarget)||this.hidePicker()}createListComponent(){this.listComponent=this.createBean(new Ybe("select",!0)),this.listComponent.setParentComponent(this);const t=this.listComponent.getAriaElement(),e=`ag-select-list-${this.listComponent.getCompId()}`;t.setAttribute("id",e),Nxe(this.getAriaElement(),t),this.listComponent.addManagedListeners(this.listComponent,{selectedItem:()=>{this.hidePicker(),this.dispatchLocalEvent({type:"selectedItem"})}}),this.listComponent.addManagedListeners(this.listComponent,{fieldValueChanged:()=>{this.listComponent&&(this.setValue(this.listComponent.getValue(),!1,!0),this.hidePicker())}})}createPickerComponent(){return this.listComponent}onKeyDown(t){const{key:e}=t;switch(e===St.TAB&&this.hidePicker(),e){case St.ENTER:case St.UP:case St.DOWN:case St.PAGE_UP:case St.PAGE_DOWN:case St.PAGE_HOME:case St.PAGE_END:t.preventDefault(),this.isPickerDisplayed?this.listComponent?.handleKeyDown(t):super.onKeyDown(t);break;case St.ESCAPE:super.onKeyDown(t);break;case St.SPACE:this.isPickerDisplayed?t.preventDefault():super.onKeyDown(t);break}}showPicker(){this.listComponent&&(super.showPicker(),this.listComponent.refreshHighlighted())}addOptions(t){return t.forEach(e=>this.addOption(e)),this}addOption(t){return this.listComponent.addOption(t),this}clearOptions(){return this.listComponent?.clearOptions(),this}setValue(t,e,i){if(this.value===t||!this.listComponent)return this;if(i||this.listComponent.setValue(t,!0),this.listComponent.getValue()===this.getValue())return this;let r=this.listComponent.getDisplayValue();return r==null&&this.config.placeholder&&(r=this.config.placeholder),this.eDisplayField.textContent=r,this.setTooltip({newTooltipText:r??null,shouldDisplayTooltip:()=>this.eDisplayField.scrollWidth>this.eDisplayField.clientWidth}),super.setValue(t,e)}destroy(){this.listComponent&&(this.listComponent=this.destroyBean(this.listComponent)),super.destroy()}},ewe={selector:"AG-SELECT",component:yU},sJ=class{constructor(){this.customFilterOptions={}}init(t,e){this.filterOptions=t.filterOptions||e,this.mapCustomOptions(),this.selectDefaultItem(t)}getFilterOptions(){return this.filterOptions}mapCustomOptions(){this.filterOptions&&this.filterOptions.forEach(t=>{if(typeof t=="string")return;const e=[["displayKey"],["displayName"],["predicate","test"]],i=n=>n.some(r=>t[r]!=null)?!0:(Wt(`ignoring FilterOptionDef as it doesn't contain one of '${n}'`),!1);if(!e.every(i)){this.filterOptions=this.filterOptions.filter(n=>n===t)||[];return}this.customFilterOptions[t.displayKey]=t})}selectDefaultItem(t){if(t.defaultOption)this.defaultOption=t.defaultOption;else if(this.filterOptions.length>=1){const e=this.filterOptions[0];typeof e=="string"?this.defaultOption=e:e.displayKey?this.defaultOption=e.displayKey:Wt("invalid FilterOptionDef supplied as it doesn't contain a 'displayKey'")}else Wt("no filter options for filter")}getDefaultOption(){return this.defaultOption}getCustomOption(t){return this.customFilterOptions[t]}},oJ=class extends Xbe{constructor(){super(...arguments),this.eTypes=[],this.eJoinOperatorPanels=[],this.eJoinOperatorsAnd=[],this.eJoinOperatorsOr=[],this.eConditionBodies=[],this.listener=()=>this.onUiChanged(),this.lastUiCompletePosition=null,this.joinOperatorId=0}getNumberOfInputs(t){const e=this.optionsFactory.getCustomOption(t);if(e){const{numberOfInputs:n}=e;return n??1}return t&&["empty","notBlank","blank"].indexOf(t)>=0?0:t==="inRange"?2:1}onFloatingFilterChanged(t,e){this.setTypeFromFloatingFilter(t),this.setValueFromFloatingFilter(e),this.onUiChanged(!0)}setTypeFromFloatingFilter(t){this.eTypes.forEach((e,i)=>{i===0?e.setValue(t,!0):e.setValue(this.optionsFactory.getDefaultOption(),!0)})}getModelFromUi(){const t=this.getUiCompleteConditions();return t.length===0?null:this.maxNumConditions>1&&t.length>1?{filterType:this.getFilterType(),operator:this.getJoinOperator(),conditions:t}:t[0]}getConditionTypes(){return this.eTypes.map(t=>t.getValue())}getConditionType(t){return this.eTypes[t].getValue()}getJoinOperator(){return this.eJoinOperatorsOr.length===0?this.defaultJoinOperator:this.eJoinOperatorsOr[0].getValue()===!0?"OR":"AND"}areModelsEqual(t,e){if(!t&&!e)return!0;if(!t&&e||t&&!e)return!1;const i=!t.operator,n=!e.operator;if(!i&&n||i&&!n)return!1;let s;if(i){const o=t,a=e;s=this.areSimpleModelsEqual(o,a)}else{const o=t,a=e;s=o.operator===a.operator&&Fp(o.conditions,a.conditions,(l,u)=>this.areSimpleModelsEqual(l,u))}return s}shouldRefresh(t){const e=this.getModel(),i=e?e.conditions??[e]:null,n=t.filterOptions?.map(s=>typeof s=="string"?s:s.displayKey)??this.getDefaultFilterOptions();return!(!(!i||i.every(s=>n.find(o=>o===s.type)!==void 0))||typeof t.maxNumConditions=="number"&&i&&i.length>t.maxNumConditions)}refresh(t){return!this.shouldRefresh(t)||!super.refresh(t)?!1:(this.setParams(t),this.removeConditionsAndOperators(0),this.createOption(),this.setModel(this.getModel()),!0)}setModelIntoUi(t){if(t.operator){const i=t;let n=i.conditions;n==null&&(n=[],Wt("Filter model is missing 'conditions'"));const r=this.validateAndUpdateConditions(n),s=this.getNumConditions();if(r<s)this.removeConditionsAndOperators(r);else if(r>s)for(let a=s;a<r;a++)this.createJoinOperatorPanel(),this.createOption();const o=i.operator==="OR";this.eJoinOperatorsAnd.forEach(a=>a.setValue(!o,!0)),this.eJoinOperatorsOr.forEach(a=>a.setValue(o,!0)),n.forEach((a,l)=>{this.eTypes[l].setValue(a.type,!0),this.setConditionIntoUi(a,l)})}else{const i=t;this.getNumConditions()>1&&this.removeConditionsAndOperators(1),this.eTypes[0].setValue(i.type,!0),this.setConditionIntoUi(i,0)}return this.lastUiCompletePosition=this.getNumConditions()-1,this.createMissingConditionsAndOperators(),this.onUiChanged(),Hl.resolve()}validateAndUpdateConditions(t){let e=t.length;return e>this.maxNumConditions&&(t.splice(this.maxNumConditions),Wt('Filter Model contains more conditions than "filterParams.maxNumConditions". Additional conditions have been ignored.'),e=this.maxNumConditions),e}doesFilterPass(t){const e=this.getModel();if(e==null)return!0;const{operator:i}=e,n=[];if(i){const s=e;n.push(...s.conditions??[])}else n.push(e);return n[i&&i==="OR"?"some":"every"](s=>this.individualConditionPasses(t,s))}setParams(t){super.setParams(t),this.setNumConditions(t),this.defaultJoinOperator=this.getDefaultJoinOperator(t.defaultJoinOperator),this.filterPlaceholder=t.filterPlaceholder,this.optionsFactory=new sJ,this.optionsFactory.init(t,this.getDefaultFilterOptions()),this.createFilterListOptions(),this.createOption(),this.createMissingConditionsAndOperators(),this.isReadOnly()&&this.eFilterBody.setAttribute("tabindex","-1")}setNumConditions(t){this.maxNumConditions=t.maxNumConditions??2,this.maxNumConditions<1&&(Wt('"filterParams.maxNumConditions" must be greater than or equal to zero.'),this.maxNumConditions=1),this.numAlwaysVisibleConditions=t.numAlwaysVisibleConditions??1,this.numAlwaysVisibleConditions<1&&(Wt('"filterParams.numAlwaysVisibleConditions" must be greater than or equal to zero.'),this.numAlwaysVisibleConditions=1),this.numAlwaysVisibleConditions>this.maxNumConditions&&(Wt('"filterParams.numAlwaysVisibleConditions" cannot be greater than "filterParams.maxNumConditions".'),this.numAlwaysVisibleConditions=this.maxNumConditions)}createOption(){const t=this.createManagedBean(new yU);this.eTypes.push(t),t.addCssClass("ag-filter-select"),this.eFilterBody.appendChild(t.getGui());const e=this.createValueElement();this.eConditionBodies.push(e),this.eFilterBody.appendChild(e),this.putOptionsIntoDropdown(t),this.resetType(t);const i=this.getNumConditions()-1;this.forEachPositionInput(i,n=>this.resetInput(n)),this.addChangedListeners(t,i)}createJoinOperatorPanel(){const t=document.createElement("div");this.eJoinOperatorPanels.push(t),t.classList.add("ag-filter-condition");const e=this.createJoinOperator(this.eJoinOperatorsAnd,t,"and"),i=this.createJoinOperator(this.eJoinOperatorsOr,t,"or");this.eFilterBody.appendChild(t);const n=this.eJoinOperatorPanels.length-1,r=this.joinOperatorId++;this.resetJoinOperatorAnd(e,n,r),this.resetJoinOperatorOr(i,n,r),this.isReadOnly()||(e.onValueChange(this.listener),i.onValueChange(this.listener))}createJoinOperator(t,e,i){const n=this.createManagedBean(new Kbe);return t.push(n),n.addCssClass("ag-filter-condition-operator"),n.addCssClass(`ag-filter-condition-operator-${i}`),e.appendChild(n.getGui()),n}getDefaultJoinOperator(t){return t==="AND"||t==="OR"?t:"AND"}createFilterListOptions(){const t=this.optionsFactory.getFilterOptions();this.filterListOptions=t.map(e=>typeof e=="string"?this.createBoilerplateListOption(e):this.createCustomListOption(e))}putOptionsIntoDropdown(t){this.filterListOptions.forEach(e=>{t.addOption(e)}),t.setDisabled(this.filterListOptions.length<=1)}createBoilerplateListOption(t){return{value:t,text:this.translate(t)}}createCustomListOption(t){const{displayKey:e}=t,i=this.optionsFactory.getCustomOption(t.displayKey);return{value:e,text:i?this.localeService.getLocaleTextFunc()(i.displayKey,i.displayName):this.translate(e)}}createBodyTemplate(){return""}getAgComponents(){return[]}getCssIdentifier(){return"simple-filter"}updateUiVisibility(){const t=this.getJoinOperator();this.updateNumConditions(),this.updateConditionStatusesAndValues(this.lastUiCompletePosition,t)}updateNumConditions(){let t=-1,e=!0;for(let i=0;i<this.getNumConditions();i++)this.isConditionUiComplete(i)?t=i:e=!1;if(this.shouldAddNewConditionAtEnd(e))this.createJoinOperatorPanel(),this.createOption();else{const i=this.lastUiCompletePosition??this.getNumConditions()-2;if(t<i){this.removeConditionsAndOperators(i+1);const n=t+1,r=i-n;r>0&&this.removeConditionsAndOperators(n,r),this.createMissingConditionsAndOperators()}}this.lastUiCompletePosition=t}updateConditionStatusesAndValues(t,e){this.eTypes.forEach((n,r)=>{const s=this.isConditionDisabled(r,t);n.setDisabled(s||this.filterListOptions.length<=1),r===1&&(W_(this.eJoinOperatorPanels[0],s),this.eJoinOperatorsAnd[0].setDisabled(s),this.eJoinOperatorsOr[0].setDisabled(s))}),this.eConditionBodies.forEach((n,r)=>{Xr(n,this.isConditionBodyVisible(r))});const i=(e??this.getJoinOperator())==="OR";this.eJoinOperatorsAnd.forEach(n=>{n.setValue(!i,!0)}),this.eJoinOperatorsOr.forEach(n=>{n.setValue(i,!0)}),this.forEachInput((n,r,s,o)=>{this.setElementDisplayed(n,r<o),this.setElementDisabled(n,this.isConditionDisabled(s,t))}),this.resetPlaceholder()}shouldAddNewConditionAtEnd(t){return t&&this.getNumConditions()<this.maxNumConditions&&!this.isReadOnly()}removeConditionsAndOperators(t,e){if(t>=this.getNumConditions())return;this.removeComponents(this.eTypes,t,e),this.removeElements(this.eConditionBodies,t,e),this.removeValueElements(t,e);const i=Math.max(t-1,0);this.removeElements(this.eJoinOperatorPanels,i,e),this.removeComponents(this.eJoinOperatorsAnd,i,e),this.removeComponents(this.eJoinOperatorsOr,i,e)}removeElements(t,e,i){this.removeItems(t,e,i).forEach(r=>hh(r))}removeComponents(t,e,i){this.removeItems(t,e,i).forEach(r=>{hh(r.getGui()),this.destroyBean(r)})}removeItems(t,e,i){return i==null?t.splice(e):t.splice(e,i)}afterGuiAttached(t){if(super.afterGuiAttached(t),this.resetPlaceholder(),!t?.suppressFocus)if(this.isReadOnly())this.eFilterBody.focus();else{const e=this.getInputs(0)[0];if(!e)return;e instanceof Km&&e.getInputElement().focus()}}afterGuiDetached(){super.afterGuiDetached();const t=this.getModel();this.resetUiToActiveModel(t);let e=-1,i=-1,n=!1;const r=this.getJoinOperator();for(let o=this.getNumConditions()-1;o>=0;o--)if(this.isConditionUiComplete(o))e===-1&&(e=o,i=o);else{const a=o>=this.numAlwaysVisibleConditions&&!this.isConditionUiComplete(o-1),l=o<e;(a||l)&&(this.removeConditionsAndOperators(o,1),n=!0,l&&i--)}let s=!1;this.getNumConditions()<this.numAlwaysVisibleConditions&&(this.createMissingConditionsAndOperators(),s=!0),this.shouldAddNewConditionAtEnd(i===this.getNumConditions()-1)&&(this.createJoinOperatorPanel(),this.createOption(),s=!0),s&&this.updateConditionStatusesAndValues(i,r),n&&this.updateJoinOperatorsDisabled(),this.lastUiCompletePosition=i}getPlaceholderText(t,e){let i=this.translate(t);if(YG(this.filterPlaceholder)){const n=this.filterPlaceholder,r=this.eTypes[e].getValue(),s=this.translate(r);i=n({filterOptionKey:r,filterOption:s,placeholder:i})}else typeof this.filterPlaceholder=="string"&&(i=this.filterPlaceholder);return i}resetPlaceholder(){const t=this.localeService.getLocaleTextFunc();this.forEachInput((e,i,n,r)=>{if(!(e instanceof Km))return;const s=i===0&&r>1?"inRangeStart":i===0?"filterOoo":"inRangeEnd",o=i===0&&r>1?t("ariaFilterFromValue","Filter from value"):i===0?t("ariaFilterValue","Filter Value"):t("ariaFilterToValue","Filter to Value");e.setInputPlaceholder(this.getPlaceholderText(s,n)),e.setInputAriaLabel(o)})}setElementValue(t,e,i){t instanceof Km&&t.setValue(e!=null?String(e):null,!0)}setElementDisplayed(t,e){t instanceof ir&&Xr(t.getGui(),e)}setElementDisabled(t,e){t instanceof ir&&W_(t.getGui(),e)}attachElementOnChange(t,e){t instanceof Km&&t.onValueChange(e)}forEachInput(t){this.getConditionTypes().forEach((e,i)=>{this.forEachPositionTypeInput(i,e,t)})}forEachPositionInput(t,e){const i=this.getConditionType(t);this.forEachPositionTypeInput(t,i,e)}forEachPositionTypeInput(t,e,i){const n=this.getNumberOfInputs(e),r=this.getInputs(t);for(let s=0;s<r.length;s++){const o=r[s];o!=null&&i(o,s,t,n)}}isConditionDisabled(t,e){return this.isReadOnly()?!0:t===0?!1:t>e+1}isConditionBodyVisible(t){const e=this.getConditionType(t);return this.getNumberOfInputs(e)>0}isConditionUiComplete(t){return!(t>=this.getNumConditions()||this.getConditionType(t)==="empty"||this.getValues(t).some(i=>i==null))}getNumConditions(){return this.eTypes.length}getUiCompleteConditions(){const t=[];for(let e=0;e<this.getNumConditions();e++)this.isConditionUiComplete(e)&&t.push(this.createCondition(e));return t}createMissingConditionsAndOperators(){if(!this.isReadOnly())for(let t=this.getNumConditions();t<this.numAlwaysVisibleConditions;t++)this.createJoinOperatorPanel(),this.createOption()}resetUiToDefaults(t){return this.removeConditionsAndOperators(this.isReadOnly()?1:this.numAlwaysVisibleConditions),this.eTypes.forEach(e=>this.resetType(e)),this.eJoinOperatorsAnd.forEach((e,i)=>this.resetJoinOperatorAnd(e,i,this.joinOperatorId+i)),this.eJoinOperatorsOr.forEach((e,i)=>this.resetJoinOperatorOr(e,i,this.joinOperatorId+i)),this.joinOperatorId++,this.forEachInput(e=>this.resetInput(e)),this.resetPlaceholder(),this.createMissingConditionsAndOperators(),this.lastUiCompletePosition=null,t||this.onUiChanged(),Hl.resolve()}resetType(t){const i=this.localeService.getLocaleTextFunc()("ariaFilteringOperator","Filtering operator");t.setValue(this.optionsFactory.getDefaultOption(),!0).setAriaLabel(i).setDisabled(this.isReadOnly()||this.filterListOptions.length<=1)}resetJoinOperatorAnd(t,e,i){this.resetJoinOperator(t,e,this.isDefaultOperator("AND"),this.translate("andCondition"),i)}resetJoinOperatorOr(t,e,i){this.resetJoinOperator(t,e,this.isDefaultOperator("OR"),this.translate("orCondition"),i)}resetJoinOperator(t,e,i,n,r){this.updateJoinOperatorDisabled(t.setValue(i,!0).setName(`ag-simple-filter-and-or-${this.getCompId()}-${r}`).setLabel(n),e)}updateJoinOperatorsDisabled(){this.eJoinOperatorsAnd.forEach((t,e)=>this.updateJoinOperatorDisabled(t,e)),this.eJoinOperatorsOr.forEach((t,e)=>this.updateJoinOperatorDisabled(t,e))}updateJoinOperatorDisabled(t,e){t.setDisabled(this.isReadOnly()||e>0)}resetInput(t){this.setElementValue(t,null),this.setElementDisabled(t,this.isReadOnly())}setConditionIntoUi(t,e){const i=this.mapValuesFromModel(t);this.forEachInput((n,r,s)=>{s===e&&this.setElementValue(n,i[r]!=null?i[r]:null)})}setValueFromFloatingFilter(t){this.forEachInput((e,i,n)=>{this.setElementValue(e,i===0&&n===0?t:null,!0)})}isDefaultOperator(t){return t===this.defaultJoinOperator}addChangedListeners(t,e){this.isReadOnly()||(t.onValueChange(this.listener),this.forEachPositionInput(e,i=>{this.attachElementOnChange(i,this.listener)}))}individualConditionPasses(t,e){const i=this.getCellValue(t.node),n=this.mapValuesFromModel(e),r=this.optionsFactory.getCustomOption(e.type),s=this.evaluateCustomFilter(r,n,i);return s??(i==null?this.evaluateNullValue(e.type):this.evaluateNonNullValue(n,i,e,t))}evaluateCustomFilter(t,e,i){if(t==null)return;const{predicate:n}=t;if(n!=null&&!e.some(r=>r==null))return n(e,i)}isBlank(t){return t==null||typeof t=="string"&&t.trim().length===0}hasInvalidInputs(){return!1}},aJ=class extends oJ{setParams(t){super.setParams(t),this.scalarFilterParams=t}evaluateNullValue(t){switch(t){case"equals":if(this.scalarFilterParams.includeBlanksInEquals)return!0;break;case"notEqual":if(this.scalarFilterParams.includeBlanksInNotEqual)return!0;break;case"greaterThan":case"greaterThanOrEqual":if(this.scalarFilterParams.includeBlanksInGreaterThan)return!0;break;case"lessThan":case"lessThanOrEqual":if(this.scalarFilterParams.includeBlanksInLessThan)return!0;break;case"inRange":if(this.scalarFilterParams.includeBlanksInRange)return!0;break;case"blank":return!0;case"notBlank":return!1}return!1}evaluateNonNullValue(t,e,i){const n=this.comparator(),r=t[0]!=null?n(t[0],e):0;switch(i.type){case"equals":return r===0;case"notEqual":return r!==0;case"greaterThan":return r>0;case"greaterThanOrEqual":return r>=0;case"lessThan":return r<0;case"lessThanOrEqual":return r<=0;case"inRange":{const s=n(t[1],e);return this.scalarFilterParams.inRangeInclusive?r>=0&&s<=0:r>0&&s<0}case"blank":return this.isBlank(e);case"notBlank":return!this.isBlank(e);default:return Wt('Unexpected type of filter "'+i.type+'", it looks like the filter was configured with incorrect Filter Options'),!0}}},twe=65,iwe=67,nwe=86,rwe=68,swe=90,owe=89;function lJ(t){return t.altKey||t.ctrlKey||t.metaKey?!1:t.key?.length===1}function Oz(t,e,i,n,r){const s=n?n.getColDef().suppressKeyboardEvent:void 0;if(!s)return!1;const o=t.addGridCommonParams({event:e,editing:r,column:n,node:i,data:i.data,colDef:n.getColDef()});return!!(s&&s(o))}function awe(t,e,i,n){const r=n.getDefinition(),s=r&&r.suppressHeaderKeyboardEvent;if(!oi(s))return!1;const o=t.addGridCommonParams({colDef:r,column:n,headerRowIndex:i,event:e});return!!s(o)}function lwe(t){const{keyCode:e}=t;let i;switch(e){case twe:i=St.A;break;case iwe:i=St.C;break;case nwe:i=St.V;break;case rwe:i=St.D;break;case swe:i=St.Z;break;case owe:i=St.Y;break;default:i=t.code}return i}function cwe(t,e=!1){return t===St.DELETE?!0:!e&&t===St.BACKSPACE?kY():!1}var Yg=class extends Km{constructor(t,e="ag-text-field",i="text"){super(t,e,i)}postConstruct(){super.postConstruct(),this.config.allowedCharPattern&&this.preventDisallowedCharacters()}setValue(t,e){return this.eInput.value!==t&&(this.eInput.value=oi(t)?t:""),super.setValue(t,e)}setStartValue(t){this.setValue(t,!0)}preventDisallowedCharacters(){const t=new RegExp(`[${this.config.allowedCharPattern}]`),e=i=>{lJ(i)&&i.key&&!t.test(i.key)&&i.preventDefault()};this.addManagedListeners(this.eInput,{keydown:e,paste:i=>{const n=i.clipboardData?.getData("text");n&&n.split("").some(r=>!t.test(r))&&i.preventDefault()}})}},wP={selector:"AG-INPUT-TEXT-FIELD",component:Yg},xU=class extends Yg{constructor(t){super(t,"ag-number-field","number")}postConstruct(){super.postConstruct(),this.addManagedListeners(this.eInput,{blur:()=>{const r=parseFloat(this.eInput.value),s=isNaN(r)?"":this.normalizeValue(r.toString());this.value!==s&&this.setValue(s)},wheel:this.onWheel.bind(this)}),this.eInput.step="any";const{precision:t,min:e,max:i,step:n}=this.config;typeof t=="number"&&this.setPrecision(t),typeof e=="number"&&this.setMin(e),typeof i=="number"&&this.setMax(i),typeof n=="number"&&this.setStep(n)}onWheel(t){Jr(this.gos)===this.eInput&&t.preventDefault()}normalizeValue(t){if(t==="")return"";this.precision!=null&&(t=this.adjustPrecision(t));const e=parseFloat(t);return this.min!=null&&e<this.min?t=this.min.toString():this.max!=null&&e>this.max&&(t=this.max.toString()),t}adjustPrecision(t,e){if(this.precision==null)return t;if(e){const n=parseFloat(t).toFixed(this.precision);return parseFloat(n).toString()}const i=String(t).split(".");if(i.length>1){if(i[1].length<=this.precision)return t;if(this.precision>0)return`${i[0]}.${i[1].slice(0,this.precision)}`}return i[0]}setMin(t){return this.min===t?this:(this.min=t,Vc(this.eInput,"min",t),this)}setMax(t){return this.max===t?this:(this.max=t,Vc(this.eInput,"max",t),this)}setPrecision(t){return this.precision=t,this}setStep(t){return this.step===t?this:(this.step=t,Vc(this.eInput,"step",t),this)}setValue(t,e){return this.setValueOrInputValue(i=>super.setValue(i,e),()=>this,t)}setStartValue(t){return this.setValueOrInputValue(e=>super.setValue(e,!0),e=>{this.eInput.value=e},t)}setValueOrInputValue(t,e,i){if(oi(i)){let n=this.isScientificNotation(i);if(n&&this.eInput.validity.valid)return t(i);if(!n){i=this.adjustPrecision(i);const r=this.normalizeValue(i);n=i!=r}if(n)return e(i)}return t(i)}getValue(){if(!this.eInput.validity.valid)return;const t=this.eInput.value;return this.isScientificNotation(t)?this.adjustPrecision(t,!0):super.getValue()}isScientificNotation(t){return typeof t=="string"&&t.includes("e")}},uwe={selector:"AG-INPUT-NUMBER-FIELD",component:xU},cJ=["equals","notEqual","greaterThan","greaterThanOrEqual","lessThan","lessThanOrEqual","inRange","blank","notBlank"],bU=class{constructor(t,e,i){this.localeService=t,this.optionsFactory=e,this.valueFormatter=i}getModelAsString(t){if(!t)return null;const e=t.operator!=null,i=this.localeService.getLocaleTextFunc();if(e){const n=t,s=(n.conditions??[]).map(a=>this.getModelAsString(a)),o=n.operator==="AND"?"andCondition":"orCondition";return s.join(` ${i(o,rJ[o])} `)}else{if(t.type==="blank"||t.type==="notBlank")return i(t.type,t.type);{const n=t,r=this.optionsFactory.getCustomOption(n.type),{displayKey:s,displayName:o,numberOfInputs:a}=r||{};return s&&o&&a===0?(i(s,o),o):this.conditionToString(n,r)}}}updateParams(t){this.optionsFactory=t.optionsFactory}formatValue(t){return this.valueFormatter?this.valueFormatter(t??null)??"":String(t)}},uJ=class extends bU{conditionToString(t,e){const{numberOfInputs:i}=e||{};return t.type=="inRange"||i===2?`${this.formatValue(t.filter)}-${this.formatValue(t.filterTo)}`:t.filter!=null?this.formatValue(t.filter):`${t.type}`}};function Mz(t){const{allowedCharPattern:e}=t??{};return e??null}var hwe=class extends aJ{constructor(){super("numberFilter"),this.eValuesFrom=[],this.eValuesTo=[]}refresh(t){return this.numberFilterParams.allowedCharPattern!==t.allowedCharPattern?!1:super.refresh(t)}mapValuesFromModel(t){const{filter:e,filterTo:i,type:n}=t||{};return[this.processValue(e),this.processValue(i)].slice(0,this.getNumberOfInputs(n))}getDefaultDebounceMs(){return 500}comparator(){return(t,e)=>t===e?0:t<e?1:-1}setParams(t){this.numberFilterParams=t,super.setParams(t),this.filterModelFormatter=new uJ(this.localeService,this.optionsFactory,this.numberFilterParams.numberFormatter)}getDefaultFilterOptions(){return cJ}setElementValue(t,e,i){const n=!i&&this.numberFilterParams.numberFormatter?this.numberFilterParams.numberFormatter(e??null):e;super.setElementValue(t,n)}createValueElement(){const t=Mz(this.numberFilterParams),e=document.createElement("div");return e.classList.add("ag-filter-body"),nc(e,"presentation"),this.createFromToElement(e,this.eValuesFrom,"from",t),this.createFromToElement(e,this.eValuesTo,"to",t),e}createFromToElement(t,e,i,n){const r=this.createManagedBean(n?new Yg({allowedCharPattern:n}):new xU);r.addCssClass(`ag-filter-${i}`),r.addCssClass("ag-filter-filter"),e.push(r),t.appendChild(r.getGui())}removeValueElements(t,e){this.removeComponents(this.eValuesFrom,t,e),this.removeComponents(this.eValuesTo,t,e)}getValues(t){const e=[];return this.forEachPositionInput(t,(i,n,r,s)=>{n<s&&e.push(this.processValue(this.stringToFloat(i.getValue())))}),e}areSimpleModelsEqual(t,e){return t.filter===e.filter&&t.filterTo===e.filterTo&&t.type===e.type}getFilterType(){return"number"}processValue(t){return t==null||isNaN(t)?null:t}stringToFloat(t){if(typeof t=="number")return t;let e=Pd(t);return e!=null&&e.trim()===""&&(e=null),this.numberFilterParams.numberParser?this.numberFilterParams.numberParser(e):e==null||e.trim()==="-"?null:parseFloat(e)}createCondition(t){const e=this.getConditionType(t),i={filterType:this.getFilterType(),type:e},n=this.getValues(t);return n.length>0&&(i.filter=n[0]),n.length>1&&(i.filterTo=n[1]),i}getInputs(t){return t>=this.eValuesFrom.length?[null,null]:[this.eValuesFrom[t],this.eValuesTo[t]]}getModelAsString(t){return this.filterModelFormatter.getModelAsString(t)??""}hasInvalidInputs(){let t=!1;return this.forEachInput(e=>{if(!e.getInputElement().validity.valid){t=!0;return}}),t}},hJ=["contains","notContains","equals","notEqual","startsWith","endsWith","blank","notBlank"],dJ=class extends bU{conditionToString(t,e){const{numberOfInputs:i}=e||{};return t.type=="inRange"||i===2?`${t.filter}-${t.filterTo}`:t.filter!=null?`${t.filter}`:`${t.type}`}};function fJ(t){const e=t&&t.trim();return e===""?t:e}var dwe=class extends oJ{constructor(){super("textFilter"),this.defaultFormatter=t=>t,this.defaultLowercaseFormatter=t=>t==null?null:t.toString().toLowerCase(),this.defaultMatcher=({filterOption:t,value:e,filterText:i})=>{if(i==null)return!1;switch(t){case"contains":return e.indexOf(i)>=0;case"notContains":return e.indexOf(i)<0;case"equals":return e===i;case"notEqual":return e!=i;case"startsWith":return e.indexOf(i)===0;case"endsWith":{const n=e.lastIndexOf(i);return n>=0&&n===e.length-i.length}default:return!1}},this.eValuesFrom=[],this.eValuesTo=[]}getDefaultDebounceMs(){return 500}setParams(t){this.textFilterParams=t,super.setParams(t),this.matcher=this.getTextMatcher(),this.formatter=this.textFilterParams.textFormatter||(this.textFilterParams.caseSensitive?this.defaultFormatter:this.defaultLowercaseFormatter),this.filterModelFormatter=new dJ(this.localeService,this.optionsFactory)}getTextMatcher(){const t=this.textFilterParams.textCustomComparator;return t?(Wt("textCustomComparator is deprecated, use textMatcher instead."),({filterOption:e,value:i,filterText:n})=>t(e,i,n)):this.textFilterParams.textMatcher||this.defaultMatcher}createCondition(t){const e=this.getConditionType(t),i={filterType:this.getFilterType(),type:e},n=this.getValuesWithSideEffects(t,!0);return n.length>0&&(i.filter=n[0]),n.length>1&&(i.filterTo=n[1]),i}getFilterType(){return"text"}areSimpleModelsEqual(t,e){return t.filter===e.filter&&t.filterTo===e.filterTo&&t.type===e.type}getInputs(t){return t>=this.eValuesFrom.length?[null,null]:[this.eValuesFrom[t],this.eValuesTo[t]]}getValues(t){return this.getValuesWithSideEffects(t,!1)}getValuesWithSideEffects(t,e){const i=[];return this.forEachPositionInput(t,(n,r,s,o)=>{if(r<o){let a=Pd(n.getValue());e&&this.textFilterParams.trimInput&&(a=fJ(a)??null,n.setValue(a,!0)),i.push(a)}}),i}getDefaultFilterOptions(){return hJ}createValueElement(){const t=document.createElement("div");return t.classList.add("ag-filter-body"),nc(t,"presentation"),this.createFromToElement(t,this.eValuesFrom,"from"),this.createFromToElement(t,this.eValuesTo,"to"),t}createFromToElement(t,e,i){const n=this.createManagedBean(new Yg);n.addCssClass(`ag-filter-${i}`),n.addCssClass("ag-filter-filter"),e.push(n),t.appendChild(n.getGui())}removeValueElements(t,e){this.removeComponents(this.eValuesFrom,t,e),this.removeComponents(this.eValuesTo,t,e)}mapValuesFromModel(t){const{filter:e,filterTo:i,type:n}=t||{};return[e||null,i||null].slice(0,this.getNumberOfInputs(n))}evaluateNullValue(t){return t?["notEqual","notContains","blank"].indexOf(t)>=0:!1}evaluateNonNullValue(t,e,i,n){const r=t.map(v=>this.formatter(v))||[],s=this.formatter(e),{api:o,colDef:a,column:l,context:u,textFormatter:d}=this.textFilterParams;if(i.type==="blank")return this.isBlank(e);if(i.type==="notBlank")return!this.isBlank(e);const p={api:o,colDef:a,column:l,context:u,node:n.node,data:n.data,filterOption:i.type,value:s,textFormatter:d};return r.some(v=>this.matcher({...p,filterText:v}))}getModelAsString(t){return this.filterModelFormatter.getModelAsString(t)??""}};function pJ(t){if(typeof t=="number")return t;if(typeof t=="string"){const e=parseInt(t);return isNaN(e)?void 0:e}}function Qu(t,e=Number.MAX_VALUE){return i=>{const n=pJ(i);if(!(n==null||n<t||n>e))return n}}function Zw(t,e){return t.toString().padStart(e,"0")}function fwe(t,e){const i=[];for(let n=t;n<=e;n++)i.push(n);return i}function pwe(t,e,i){return typeof t!="number"?"":t.toString().replace(".",i).replace(/(\d)(?=(\d{3})+(?!\d))/g,`$1${e}`)}function Gc(t,e=!0,i="-"){if(!t)return null;let n=[t.getFullYear(),t.getMonth()+1,t.getDate()].map(r=>Zw(r,2)).join(i);return e&&(n+=" "+[t.getHours(),t.getMinutes(),t.getSeconds()].map(r=>Zw(r,2)).join(":")),n}var rN=t=>{if(t>3&&t<21)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd"}return"th"};function Xw(t,e="YYYY-MM-DD"){const i=Zw(t.getFullYear(),4),n=["January","February","March","April","May","June","July","August","September","October","November","December"],r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s={YYYY:()=>i.slice(i.length-4,i.length),YY:()=>i.slice(i.length-2,i.length),Y:()=>`${t.getFullYear()}`,MMMM:()=>n[t.getMonth()],MMM:()=>n[t.getMonth()].slice(0,3),MM:()=>Zw(t.getMonth()+1,2),Mo:()=>`${t.getMonth()+1}${rN(t.getMonth()+1)}`,M:()=>`${t.getMonth()+1}`,Do:()=>`${t.getDate()}${rN(t.getDate())}`,DD:()=>Zw(t.getDate(),2),D:()=>`${t.getDate()}`,dddd:()=>r[t.getDay()],ddd:()=>r[t.getDay()].slice(0,3),dd:()=>r[t.getDay()].slice(0,2),do:()=>`${t.getDay()}${rN(t.getDay())}`,d:()=>`${t.getDay()}`},o=new RegExp(Object.keys(s).join("|"),"g");return e.replace(o,a=>a in s?s[a]():a)}function ml(t){if(!t)return null;const[e,i]=t.split(" ");if(!e)return null;const n=e.split("-").map(p=>parseInt(p,10));if(n.filter(p=>!isNaN(p)).length!==3)return null;const[r,s,o]=n,a=new Date(r,s-1,o);if(a.getFullYear()!==r||a.getMonth()!==s-1||a.getDate()!==o)return null;if(!i||i==="00:00:00")return a;const[l,u,d]=i.split(":").map(p=>parseInt(p,10));return l>=0&&l<24&&a.setHours(l),u>=0&&u<60&&a.setMinutes(u),d>=0&&d<60&&a.setSeconds(d),a}var mJ=class{constructor(t,e,i,n,r){this.alive=!0,this.context=t,this.eParent=n,e.getDateCompDetails(i).newAgStackInstance().then(a=>{if(!this.alive){t.destroyBean(a);return}this.dateComp=a,a&&(n.appendChild(a.getGui()),a.afterGuiAttached&&a.afterGuiAttached(),this.tempValue&&a.setDate(this.tempValue),this.disabled!=null&&this.setDateCompDisabled(this.disabled),r?.(this))})}destroy(){this.alive=!1,this.dateComp=this.context.destroyBean(this.dateComp)}getDate(){return this.dateComp?this.dateComp.getDate():this.tempValue}setDate(t){this.dateComp?this.dateComp.setDate(t):this.tempValue=t}setDisabled(t){this.dateComp?this.setDateCompDisabled(t):this.disabled=t}setDisplayed(t){Xr(this.eParent,t)}setInputPlaceholder(t){this.dateComp&&this.dateComp.setInputPlaceholder&&this.dateComp.setInputPlaceholder(t)}setInputAriaLabel(t){this.dateComp&&this.dateComp.setInputAriaLabel&&this.dateComp.setInputAriaLabel(t)}afterGuiAttached(t){this.dateComp&&typeof this.dateComp.afterGuiAttached=="function"&&this.dateComp.afterGuiAttached(t)}updateParams(t){let e=!1;this.dateComp?.refresh&&typeof this.dateComp.refresh=="function"&&this.dateComp.refresh(t)!==null&&(e=!0),!e&&this.dateComp?.onParamsUpdated&&typeof this.dateComp.onParamsUpdated=="function"&&this.dateComp.onParamsUpdated(t)!==null&&Wt("Custom date component method 'onParamsUpdated' is deprecated. Use 'refresh' instead.")}setDateCompDisabled(t){this.dateComp!=null&&this.dateComp.setDisabled!=null&&this.dateComp.setDisabled(t)}},gJ=["equals","notEqual","lessThan","greaterThan","inRange","blank","notBlank"],vJ=class extends bU{constructor(t,e,i){super(e,i),this.dateFilterParams=t}conditionToString(t,e){const{type:i}=t,{numberOfInputs:n}=e||{},r=i=="inRange"||n===2,s=ml(t.dateFrom),o=ml(t.dateTo),a=this.dateFilterParams.inRangeFloatingFilterDateFormat;if(r){const l=s!==null?Xw(s,a):"null",u=o!==null?Xw(o,a):"null";return`${l}-${u}`}return s!=null?Xw(s,a):`${i}`}updateParams(t){super.updateParams(t),this.dateFilterParams=t.dateFilterParams}},u6=1e3,h6=1/0,mwe=class extends aJ{constructor(){super("dateFilter"),this.eConditionPanelsFrom=[],this.eConditionPanelsTo=[],this.dateConditionFromComps=[],this.dateConditionToComps=[],this.minValidYear=u6,this.maxValidYear=h6,this.minValidDate=null,this.maxValidDate=null}wireBeans(t){super.wireBeans(t),this.context=t.context,this.userComponentFactory=t.userComponentFactory}afterGuiAttached(t){super.afterGuiAttached(t),this.dateConditionFromComps[0].afterGuiAttached(t)}mapValuesFromModel(t){const{dateFrom:e,dateTo:i,type:n}=t||{};return[e&&ml(e)||null,i&&ml(i)||null].slice(0,this.getNumberOfInputs(n))}comparator(){return this.dateFilterParams.comparator?this.dateFilterParams.comparator:this.defaultComparator.bind(this)}defaultComparator(t,e){const i=e;return e==null||i<t?-1:i>t?1:0}setParams(t){this.dateFilterParams=t,super.setParams(t);const e=(i,n)=>{if(t[i]!=null)if(isNaN(t[i]))Wt(`DateFilter ${i} is not a number`);else return t[i]==null?n:Number(t[i]);return n};this.minValidYear=e("minValidYear",u6),this.maxValidYear=e("maxValidYear",h6),this.minValidYear>this.maxValidYear&&Wt("DateFilter minValidYear should be <= maxValidYear"),t.minValidDate?this.minValidDate=t.minValidDate instanceof Date?t.minValidDate:ml(t.minValidDate):this.minValidDate=null,t.maxValidDate?this.maxValidDate=t.maxValidDate instanceof Date?t.maxValidDate:ml(t.maxValidDate):this.maxValidDate=null,this.minValidDate&&this.maxValidDate&&this.minValidDate>this.maxValidDate&&Wt("DateFilter minValidDate should be <= maxValidDate"),this.filterModelFormatter=new vJ(this.dateFilterParams,this.localeService,this.optionsFactory)}createDateCompWrapper(t){const e=new mJ(this.context,this.userComponentFactory,{onDateChanged:()=>this.onUiChanged(),filterParams:this.dateFilterParams},t);return this.addDestroyFunc(()=>e.destroy()),e}setElementValue(t,e){t.setDate(e)}setElementDisplayed(t,e){t.setDisplayed(e)}setElementDisabled(t,e){t.setDisabled(e)}getDefaultFilterOptions(){return gJ}createValueElement(){const e=Rs(this.gos).createElement("div");return e.classList.add("ag-filter-body"),this.createFromToElement(e,this.eConditionPanelsFrom,this.dateConditionFromComps,"from"),this.createFromToElement(e,this.eConditionPanelsTo,this.dateConditionToComps,"to"),e}createFromToElement(t,e,i,n){const s=Rs(this.gos).createElement("div");s.classList.add(`ag-filter-${n}`),s.classList.add(`ag-filter-date-${n}`),e.push(s),t.appendChild(s),i.push(this.createDateCompWrapper(s))}removeValueElements(t,e){this.removeDateComps(this.dateConditionFromComps,t,e),this.removeDateComps(this.dateConditionToComps,t,e),this.removeItems(this.eConditionPanelsFrom,t,e),this.removeItems(this.eConditionPanelsTo,t,e)}removeDateComps(t,e,i){this.removeItems(t,e,i).forEach(r=>r.destroy())}isValidDateValue(t){if(t===null)return!1;if(this.minValidDate){if(t<this.minValidDate)return!1}else if(t.getUTCFullYear()<this.minValidYear)return!1;if(this.maxValidDate){if(t>this.maxValidDate)return!1}else if(t.getUTCFullYear()>this.maxValidYear)return!1;return!0}isConditionUiComplete(t){if(!super.isConditionUiComplete(t))return!1;let e=!0;return this.forEachInput((i,n,r,s)=>{r!==t||!e||n>=s||(e=e&&this.isValidDateValue(i.getDate()))}),e}areSimpleModelsEqual(t,e){return t.dateFrom===e.dateFrom&&t.dateTo===e.dateTo&&t.type===e.type}getFilterType(){return"date"}createCondition(t){const e=this.getConditionType(t),i={},n=this.getValues(t);return n.length>0&&(i.dateFrom=Gc(n[0])),n.length>1&&(i.dateTo=Gc(n[1])),{dateFrom:null,dateTo:null,filterType:this.getFilterType(),type:e,...i}}resetPlaceholder(){const t=this.localeService.getLocaleTextFunc(),e=this.translate("dateFormatOoo"),i=t("ariaFilterValue","Filter Value");this.forEachInput(n=>{n.setInputPlaceholder(e),n.setInputAriaLabel(i)})}getInputs(t){return t>=this.dateConditionFromComps.length?[null,null]:[this.dateConditionFromComps[t],this.dateConditionToComps[t]]}getValues(t){const e=[];return this.forEachPositionInput(t,(i,n,r,s)=>{n<s&&e.push(i.getDate())}),e}translate(t){return t==="lessThan"?super.translate("before"):t==="greaterThan"?super.translate("after"):super.translate(t)}getModelAsString(t){return this.filterModelFormatter.getModelAsString(t)??""}},wU=class extends kt{constructor(t,e,i,n){super(),this.columnOrGroup=t,this.columnOrGroup=t,this.eCell=e,this.ariaEl=this.eCell.querySelector("[role=columnheader]")||this.eCell,this.colsSpanning=n,this.beans=i}setColsSpanning(t){this.colsSpanning=t,this.onLeftChanged()}getColumnOrGroup(){return this.beans.gos.get("enableRtl")&&this.colsSpanning?Yn(this.colsSpanning):this.columnOrGroup}postConstruct(){const t=this.onLeftChanged.bind(this);this.addManagedListeners(this.columnOrGroup,{leftChanged:t}),this.setLeftFirstTime(),this.addManagedEventListeners({displayedColumnsWidthChanged:t}),this.addManagedPropertyListener("domLayout",t)}setLeftFirstTime(){const t=this.beans.gos.get("suppressColumnMoveAnimation"),e=oi(this.columnOrGroup.getOldLeft());this.beans.columnAnimationService.isActive()&&e&&!t?this.animateInLeft():this.onLeftChanged()}animateInLeft(){const t=this.getColumnOrGroup(),e=t.getLeft(),i=t.getOldLeft(),n=this.modifyLeftForPrintLayout(t,i),r=this.modifyLeftForPrintLayout(t,e);this.setLeft(n),this.actualLeft=r,this.beans.columnAnimationService.executeNextVMTurn(()=>{this.actualLeft===r&&this.setLeft(r)})}onLeftChanged(){const t=this.getColumnOrGroup(),e=t.getLeft();this.actualLeft=this.modifyLeftForPrintLayout(t,e),this.setLeft(this.actualLeft)}modifyLeftForPrintLayout(t,e){if(!Zo(this.beans.gos,"print")||t.getPinned()==="left")return e;const n=this.beans.visibleColsService.getColsLeftWidth();if(t.getPinned()==="right"){const r=this.beans.visibleColsService.getBodyContainerWidth();return n+r+e}return n+e}setLeft(t){if(oi(t)&&(this.eCell.style.left=`${t}px`),Vs(this.columnOrGroup)){const e=this.columnOrGroup.getLeafColumns();if(!e.length)return;e.length>1&&Dxe(this.ariaEl,e.length)}}},gwe="ag-column-first",vwe="ag-column-last";function yJ(t,e,i,n){return Wn(t)?[]:xwe(t.headerClass,t,e,i,n)}function xJ(t,e,i){t.addOrRemoveCssClass(gwe,i.isColAtEdge(e,"first")),t.addOrRemoveCssClass(vwe,i.isColAtEdge(e,"last"))}function ywe(t,e,i,n){return e.addGridCommonParams({colDef:t,column:i,columnGroup:n})}function xwe(t,e,i,n,r){if(Wn(t))return[];let s;if(typeof t=="function"){const o=ywe(e,i,n,r);s=t(o)}else s=t;return typeof s=="string"?[s]:Array.isArray(s)?[...s]:[]}var bwe=0,bJ=class wJ extends kt{constructor(e,i,n){super(),this.resizeToggleTimeout=0,this.resizeMultiplier=1,this.resizeFeature=null,this.lastFocusEvent=null,this.dragSource=null,this.columnGroupChild=e,this.parentRowCtrl=n,this.beans=i,this.instanceId=e.getUniqueId()+"-"+bwe++}wireBeans(e){this.pinnedWidthService=e.pinnedWidthService,this.focusService=e.focusService,this.userComponentFactory=e.userComponentFactory,this.ctrlsService=e.ctrlsService,this.dragAndDropService=e.dragAndDropService,this.menuService=e.menuService}postConstruct(){const e=this.refreshTabIndex.bind(this);this.addManagedPropertyListeners(["suppressHeaderFocus"],e),this.addManagedEventListeners({overlayExclusiveChanged:e})}shouldStopEventPropagation(e){const{headerRowIndex:i,column:n}=this.focusService.getFocusedHeader();return awe(this.gos,e,i,n)}getWrapperHasFocus(){return Jr(this.gos)===this.eGui}setGui(e,i){this.eGui=e,this.addDomData(i),i.addManagedListeners(this.beans.eventService,{displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this)}),i.addManagedElementListeners(this.eGui,{focus:this.onGuiFocus.bind(this)}),this.onDisplayedColumnsChanged(),this.refreshTabIndex()}onGuiFocus(){this.eventService.dispatchEvent({type:"headerFocused",column:this.column})}setupAutoHeight(e){const{wrapperElement:i,checkMeasuringCallback:n,compBean:r}=e,{animationFrameService:s,resizeObserverService:o,columnModel:a,gos:l}=this.beans,u=R=>{if(!this.isAlive()||!r.isAlive())return;const{paddingTop:O,paddingBottom:P,borderBottomWidth:N,borderTopWidth:F}=Xg(this.getGui()),k=O+P+N+F,W=i.offsetHeight+k;if(R<5){const Q=Rs(l),Y=!Q||!Q.contains(i),M=W==0;if(Y||M){s.requestAnimationFrame(()=>u(R+1));return}}a.setColHeaderHeight(this.column,W)};let d=!1,p;const v=()=>{const R=this.column.isAutoHeaderHeight();R&&!d&&y(),!R&&d&&w()},y=()=>{d=!0,u(0),this.comp.addOrRemoveCssClass("ag-header-cell-auto-height",!0),p=o.observeResize(i,()=>u(0))},w=()=>{d=!1,p&&p(),this.comp.addOrRemoveCssClass("ag-header-cell-auto-height",!1),p=void 0};v(),r.addDestroyFunc(()=>w()),r.addManagedListeners(this.column,{widthChanged:()=>d&&u(0)}),r.addManagedEventListeners({sortChanged:()=>{d&&window.setTimeout(()=>u(0))}}),n&&n(v)}onDisplayedColumnsChanged(){const{comp:e,column:i,beans:n,eGui:r}=this;!e||!i||!r||(xJ(e,i,n.visibleColsService),AY(r,n.visibleColsService.getAriaColIndex(i)))}addResizeAndMoveKeyboardListeners(e){this.resizeFeature&&e.addManagedListeners(this.eGui,{keydown:this.onGuiKeyDown.bind(this),keyup:this.onGuiKeyUp.bind(this)})}refreshTabIndex(){const e=this.focusService.isHeaderFocusSuppressed();this.eGui&&Vc(this.eGui,"tabindex",e?null:"-1")}onGuiKeyDown(e){const i=Jr(this.gos),n=e.key===St.LEFT||e.key===St.RIGHT;if(this.isResizing&&(e.preventDefault(),e.stopImmediatePropagation()),i!==this.eGui||!e.shiftKey&&!e.altKey||((this.isResizing||n)&&(e.preventDefault(),e.stopImmediatePropagation()),!n))return;const r=e.key===St.LEFT!==this.gos.get("enableRtl"),s=JY[r?"Left":"Right"];if(e.altKey){this.isResizing=!0,this.resizeMultiplier+=1;const o=this.getViewportAdjustedResizeDiff(e);this.resizeHeader(o,e.shiftKey),this.resizeFeature?.toggleColumnResizing(!0)}else this.moveHeader(s)}getViewportAdjustedResizeDiff(e){let i=this.getResizeDiff(e);if(this.column.getPinned()){const r=this.pinnedWidthService.getPinnedLeftWidth(),s=this.pinnedWidthService.getPinnedRightWidth(),o=zC(this.ctrlsService.getGridBodyCtrl().getBodyViewportElement())-50;if(r+s+i>o)if(o>r+s)i=o-r-s;else return 0}return i}getResizeDiff(e){let i=e.key===St.LEFT!==this.gos.get("enableRtl");const n=this.column.getPinned(),r=this.gos.get("enableRtl");return n&&r!==(n==="right")&&(i=!i),(i?-1:1)*this.resizeMultiplier}onGuiKeyUp(){this.isResizing&&(this.resizeToggleTimeout&&(window.clearTimeout(this.resizeToggleTimeout),this.resizeToggleTimeout=0),this.isResizing=!1,this.resizeMultiplier=1,this.resizeToggleTimeout=window.setTimeout(()=>{this.resizeFeature?.toggleColumnResizing(!1)},150))}handleKeyDown(e){const i=this.getWrapperHasFocus();switch(e.key){case St.PAGE_DOWN:case St.PAGE_UP:case St.PAGE_HOME:case St.PAGE_END:i&&e.preventDefault()}}addDomData(e){const i=wJ.DOM_DATA_KEY_HEADER_CTRL;Dg(this.gos,this.eGui,i,this),e.addDestroyFunc(()=>Dg(this.gos,this.eGui,i,null))}getGui(){return this.eGui}focus(e){return this.eGui?(this.lastFocusEvent=e||null,this.eGui.focus(),!0):!1}getRowIndex(){return this.parentRowCtrl.getRowIndex()}getParentRowCtrl(){return this.parentRowCtrl}getPinned(){return this.parentRowCtrl.getPinned()}getColumnGroupChild(){return this.columnGroupChild}removeDragSource(){this.dragSource&&(this.dragAndDropService.removeDragSource(this.dragSource),this.dragSource=null)}handleContextMenuMouseEvent(e,i,n){const r=e??i;this.gos.get("preventDefaultOnContextMenu")&&r.preventDefault(),this.menuService.isHeaderContextMenuEnabled(n)&&this.menuService.showHeaderContextMenu(n,e,i),this.dispatchColumnMouseEvent("columnHeaderContextMenu",n)}dispatchColumnMouseEvent(e,i){this.eventService.dispatchEvent({type:e,column:i})}clearComponent(){this.removeDragSource(),this.resizeFeature=null,this.comp=null,this.eGui=null}destroy(){super.destroy(),this.column=null,this.lastFocusEvent=null,this.columnGroupChild=null,this.parentRowCtrl=null}};bJ.DOM_DATA_KEY_HEADER_CTRL="headerCtrl";var _P=bJ,_U=class extends kt{wireBeans(t){this.columnHoverService=t.columnHoverService}constructor(t,e){super(),this.columns=t,this.element=e}postConstruct(){this.gos.get("columnHoverHighlight")&&this.addMouseHoverListeners()}addMouseHoverListeners(){this.addManagedListeners(this.element,{mouseout:this.onMouseOut.bind(this),mouseover:this.onMouseOver.bind(this)})}onMouseOut(){this.columnHoverService.clearMouseOver()}onMouseOver(){this.columnHoverService.setMouseOver(this.columns)}},wwe=class extends _P{constructor(t,e,i){super(t,e,i),this.iconCreated=!1,this.column=t}setComp(t,e,i,n,r){this.comp=t,r=BC(this,this.beans.context,r),this.eButtonShowMainFilter=i,this.eFloatingFilterBody=n,this.setGui(e,r),this.setupActive(),this.setupWidth(r),this.setupLeft(r),this.setupHover(r),this.setupFocus(r),this.setupAria(),this.setupFilterButton(),this.setupUserComp(),this.setupSyncWithFilter(r),this.setupUi(),r.addManagedElementListeners(this.eButtonShowMainFilter,{click:this.showParentFilter.bind(this)}),this.setupFilterChangedListener(r),r.addManagedListeners(this.column,{colDefChanged:()=>this.onColDefChanged(r)}),r.addDestroyFunc(()=>{this.eButtonShowMainFilter=null,this.eFloatingFilterBody=null,this.userCompDetails=null,this.clearComponent()})}resizeHeader(){}moveHeader(){}setupActive(){const t=this.column.getColDef(),e=!!t.filter,i=!!t.floatingFilter;this.active=e&&i}setupUi(){if(this.comp.setButtonWrapperDisplayed(!this.suppressFilterButton&&this.active),this.comp.addOrRemoveBodyCssClass("ag-floating-filter-full-body",this.suppressFilterButton),this.comp.addOrRemoveBodyCssClass("ag-floating-filter-body",!this.suppressFilterButton),!this.active||this.iconCreated)return;const t=Ql("filter",this.gos,this.column);t&&(this.iconCreated=!0,this.eButtonShowMainFilter.appendChild(t))}setupFocus(t){t.createManagedBean(new Kg(this.eGui,{shouldStopEventPropagation:this.shouldStopEventPropagation.bind(this),onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this),onFocusIn:this.onFocusIn.bind(this)}))}setupAria(){const t=this.localeService.getLocaleTextFunc();O0(this.eButtonShowMainFilter,t("ariaFilterMenuOpen","Open Filter Menu"))}onTabKeyDown(t){if(Jr(this.gos)===this.eGui)return;const n=this.focusService.findNextFocusableElement(this.eGui,null,t.shiftKey);if(n){this.beans.headerNavigationService.scrollToColumn(this.column),t.preventDefault(),n.focus();return}const r=this.findNextColumnWithFloatingFilter(t.shiftKey);r&&this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:this.getParentRowCtrl().getRowIndex(),column:r},event:t})&&t.preventDefault()}findNextColumnWithFloatingFilter(t){const e=this.beans.visibleColsService;let i=this.column;do if(i=t?e.getColBefore(i):e.getColAfter(i),!i)break;while(!i.getColDef().filter||!i.getColDef().floatingFilter);return i}handleKeyDown(t){super.handleKeyDown(t);const e=this.getWrapperHasFocus();switch(t.key){case St.UP:case St.DOWN:e||t.preventDefault();case St.LEFT:case St.RIGHT:if(e)return;t.stopPropagation();case St.ENTER:e&&this.focusService.focusInto(this.eGui)&&t.preventDefault();break;case St.ESCAPE:e||this.eGui.focus()}}onFocusIn(t){if(this.eGui.contains(t.relatedTarget))return;const i=!!t.relatedTarget&&!t.relatedTarget.classList.contains("ag-floating-filter"),n=!!t.relatedTarget&&e0(t.relatedTarget,"ag-floating-filter");if(i&&n&&t.target===this.eGui){const s=this.lastFocusEvent,o=!!(s&&s.key===St.TAB);if(s&&o){const a=s.shiftKey;this.focusService.focusInto(this.eGui,a)}}const r=this.getRowIndex();this.beans.focusService.setFocusedHeader(r,this.column)}setupHover(t){t.createManagedBean(new _U([this.column],this.eGui));const e=()=>{if(!this.gos.get("columnHoverHighlight"))return;const i=this.beans.columnHoverService.isHovered(this.column);this.comp.addOrRemoveCssClass("ag-column-hover",i)};t.addManagedEventListeners({columnHoverChanged:e}),e()}setupLeft(t){const e=new wU(this.column,this.eGui,this.beans);t.createManagedBean(e)}setupFilterButton(){this.suppressFilterButton=!this.menuService.isFloatingFilterButtonEnabled(this.column),this.highlightFilterButtonWhenActive=!this.menuService.isLegacyMenuEnabled()}setupUserComp(){if(!this.active)return;const t=this.beans.filterManager?.getFloatingFilterCompDetails(this.column,()=>this.showParentFilter());t&&this.setCompDetails(t)}setCompDetails(t){this.userCompDetails=t,this.comp.setCompDetails(t)}showParentFilter(){const t=this.suppressFilterButton?this.eFloatingFilterBody:this.eButtonShowMainFilter;this.menuService.showFilterMenu({column:this.column,buttonElement:t,containerType:"floatingFilter",positionBy:"button"})}setupSyncWithFilter(t){if(!this.active)return;const{filterManager:e}=this.beans,i=n=>{if(n?.source==="filterDestroyed"&&!this.isAlive())return;const r=this.comp.getFloatingFilterComp();r&&r.then(s=>{if(s){const o=e?.getCurrentFloatingFilterParentModel(this.column),a=n?{...n,columns:n.columns??[],source:n.source==="api"?"api":"columnFilter"}:null;s.onParentModelChanged(o,a)}})};[this.destroySyncListener]=t.addManagedListeners(this.column,{filterChanged:i}),e?.isFilterActive(this.column)&&i(null)}setupWidth(t){const e=()=>{const i=`${this.column.getActualWidth()}px`;this.comp.setWidth(i)};t.addManagedListeners(this.column,{widthChanged:e}),e()}setupFilterChangedListener(t){this.active&&([this.destroyFilterChangedListener]=t.addManagedListeners(this.column,{filterChanged:this.updateFilterButton.bind(this)}),this.updateFilterButton())}updateFilterButton(){if(!this.suppressFilterButton&&this.comp){const t=!!this.beans.filterManager?.isFilterAllowed(this.column);this.comp.setButtonWrapperDisplayed(t),this.highlightFilterButtonWhenActive&&t&&this.eButtonShowMainFilter.classList.toggle("ag-filter-active",this.column.isFilterActive())}}onColDefChanged(t){const e=this.active;this.setupActive();const i=!e&&this.active;e&&!this.active&&(this.destroySyncListener(),this.destroyFilterChangedListener());const n=this.active?this.beans.filterManager?.getFloatingFilterCompDetails(this.column,()=>this.showParentFilter()):null,r=this.comp.getFloatingFilterComp();!r||!n?this.updateCompDetails(t,n,i):r.then(s=>{!s||this.beans.filterManager?.areFilterCompsDifferent(this.userCompDetails??null,n)?this.updateCompDetails(t,n,i):this.updateFloatingFilterParams(n)})}updateCompDetails(t,e,i){this.isAlive()&&(this.setCompDetails(e),this.setupFilterButton(),this.setupUi(),i&&(this.setupSyncWithFilter(t),this.setupFilterChangedListener(t)))}updateFloatingFilterParams(t){if(!t)return;const e=t.params;this.comp.getFloatingFilterComp()?.then(i=>{let n=!1;i?.refresh&&typeof i.refresh=="function"&&i.refresh(e)!==null&&(n=!0),!n&&i?.onParamsUpdated&&typeof i.onParamsUpdated=="function"&&i.onParamsUpdated(e)!==null&&Wt("Custom floating filter method 'onParamsUpdated' is deprecated. Use 'refresh' instead.")})}destroy(){super.destroy(),this.destroySyncListener=null,this.destroyFilterChangedListener=null}};var fn="32.3.4";function _we(t){return!!t.filterManager?.isColumnFilterPresent()||!!t.filterManager?.isAggregateFilterPresent()}function Cwe(t,e,i){return t.filterManager?.getFilterInstance(e,i)}function Swe(t,e){return t.filterManager?.getColumnFilterInstance(e)??Promise.resolve(void 0)}function Owe(t,e){const i=t.columnModel.getColDefCol(e);if(i)return t.filterManager?.destroyFilter(i,"api")}function Mwe(t,e){t.frameworkOverrides.wrapIncoming(()=>t.filterManager?.setFilterModel(e))}function Twe(t){return t.filterManager?.getFilterModel()??{}}function Rwe(t,e){return t.filterManager?.getColumnFilterModel(e)??null}function Pwe(t,e,i){return t.filterManager?.setColumnFilterModel(e,i)??Promise.resolve()}function Ewe(t,e){const i=t.columnModel.getCol(e);if(!i){ar(`column '${e}' not found`);return}t.menuService.showFilterMenu({column:i,containerType:"columnFilter",positionBy:"auto"})}function Awe(t,e,i){if(e==null)return null;let n=null;const{compName:r,jsComp:s,fwComp:o}=KY.getCompKeys(t,e,gU);return r?n={set:"agSetColumnFloatingFilter",agSetColumnFilter:"agSetColumnFloatingFilter",multi:"agMultiColumnFloatingFilter",agMultiColumnFilter:"agMultiColumnFloatingFilter",group:"agGroupColumnFloatingFilter",agGroupColumnFilter:"agGroupColumnFloatingFilter",number:"agNumberColumnFloatingFilter",agNumberColumnFilter:"agNumberColumnFloatingFilter",date:"agDateColumnFloatingFilter",agDateColumnFilter:"agDateColumnFloatingFilter",text:"agTextColumnFloatingFilter",agTextColumnFilter:"agTextColumnFloatingFilter"}[r]:s==null&&o==null&&e.filter===!0&&(n=i()),n}var d6={january:"January",february:"February",march:"March",april:"April",may:"May",june:"June",july:"July",august:"August",september:"September",october:"October",november:"November",december:"December"},f6=["january","february","march","april","may","june","july","august","september","october","november","december"],Iwe=class extends kt{constructor(){super(...arguments),this.beanName="columnFilterService",this.allColumnFilters=new Map,this.allColumnListeners=new Map,this.activeAggregateFilters=[],this.activeColumnFilters=[],this.processingFilterChange=!1,this.filterModelUpdateQueue=[],this.columnFilterModelUpdateQueue=[]}wireBeans(t){this.valueService=t.valueService,this.columnModel=t.columnModel,this.rowModel=t.rowModel,this.userComponentFactory=t.userComponentFactory,this.rowRenderer=t.rowRenderer,this.dataTypeService=t.dataTypeService,this.filterManager=t.filterManager}postConstruct(){this.addManagedEventListeners({gridColumnsChanged:this.onColumnsChanged.bind(this),rowDataUpdated:()=>this.onNewRowsLoaded("rowDataUpdated"),dataTypesInferred:this.processFilterModelUpdateQueue.bind(this)}),this.initialFilterModel={...this.gos.get("initialState")?.filter?.filterModel??{}}}setFilterModel(t,e="api"){if(this.dataTypeService?.isPendingInference()){this.filterModelUpdateQueue.push({model:t,source:e});return}const i=[],n=this.getFilterModel(!0);if(t){const r=new Set(Object.keys(t));this.allColumnFilters.forEach((s,o)=>{const a=t[o];i.push(this.setModelOnFilterWrapper(s.filterPromise,a)),r.delete(o)}),r.forEach(s=>{const o=this.columnModel.getColDefCol(s)||this.columnModel.getCol(s);if(!o){Wt("setFilterModel() - no column found for colId: "+s);return}if(!o.isFilterAllowed()){Wt("setFilterModel() - unable to fully apply model, filtering disabled for colId: "+s);return}const a=this.getOrCreateFilterWrapper(o);if(!a){Wt("setFilterModel() - unable to fully apply model, unable to create filter for colId: "+s);return}i.push(this.setModelOnFilterWrapper(a.filterPromise,t[s]))})}else this.allColumnFilters.forEach(r=>{i.push(this.setModelOnFilterWrapper(r.filterPromise,null))});Hl.all(i).then(()=>{const r=this.getFilterModel(!0),s=[];this.allColumnFilters.forEach((o,a)=>{const l=n?n[a]:null,u=r?r[a]:null;V_(l,u)||s.push(o.column)}),s.length>0&&this.filterManager?.onFilterChanged({columns:s,source:e})})}setModelOnFilterWrapper(t,e){return new Hl(i=>{t.then(n=>{typeof n.setModel!="function"&&(Wt("filter missing setModel method, which is needed for setFilterModel"),i()),(n.setModel(e)||Hl.resolve()).then(()=>i())})})}getFilterModel(t){const e={},{allColumnFilters:i,initialFilterModel:n}=this;return i.forEach((r,s)=>{const o=this.getModelFromFilterWrapper(r);oi(o)&&(e[s]=o)}),t||Object.entries(n).forEach(([r,s])=>{oi(s)&&!i.has(r)&&this.columnModel.getCol(r)?.isFilterAllowed()&&(e[r]=s)}),e}getModelFromFilterWrapper(t){const{filter:e}=t;return e?typeof e.getModel!="function"?(Wt("filter API missing getModel method, which is needed for getFilterModel"),null):e.getModel():this.getModelFromInitialState(t.column)}getModelFromInitialState(t){return this.initialFilterModel[t.getColId()]??null}isColumnFilterPresent(){return this.activeColumnFilters.length>0}isAggregateFilterPresent(){return!!this.activeAggregateFilters.length}disableColumnFilters(){return this.allColumnFilters.size?(this.allColumnFilters.forEach(t=>this.disposeFilterWrapper(t,"advancedFilterEnabled")),!0):!1}doAggregateFiltersPass(t,e){return this.doColumnFiltersPass(t,e,!0)}updateActiveFilters(){const t=s=>s?s.isFilterActive?s.isFilterActive():(Wt("Filter is missing isFilterActive() method"),!1):!1,e=!!pz(this.gos),i=s=>{if(!s.isPrimary())return!0;const a=!this.columnModel.isPivotActive();return!s.isValueActive()||!a?!1:this.columnModel.isPivotMode()?!0:e},n=[],r=[];return this.forEachColumnFilter((s,o)=>{t(s)&&(i(o.column)?n.push(s):r.push(s))}).then(()=>{this.activeAggregateFilters=n,this.activeColumnFilters=r})}updateFilterFlagInColumns(t,e){return this.forEachColumnFilter((i,n)=>n.column.setFilterActive(i.isFilterActive(),t,e))}forEachColumnFilter(t){return Hl.all(Array.from(this.allColumnFilters.values()).map(e=>e.filterPromise.then(i=>t(i,e))))}doColumnFiltersPass(t,e,i){const{data:n,aggData:r}=t,s=i?this.activeAggregateFilters:this.activeColumnFilters,o=i?r:n;for(let a=0;a<s.length;a++){const l=s[a];if(!(l==null||l===e)){if(typeof l.doesFilterPass!="function")throw new Error("Filter is missing method doesFilterPass");if(!l.doesFilterPass({node:t,data:o}))return!1}}return!0}callOnFilterChangedOutsideRenderCycle(t){const e=()=>this.filterManager?.onFilterChanged(t);this.rowRenderer.isRefreshInProgress()?setTimeout(e,0):e()}updateBeforeFilterChanged(t={}){const{filterInstance:e,additionalEventAttributes:i}=t;return this.updateDependentFilters(),this.updateActiveFilters().then(()=>this.updateFilterFlagInColumns("filterChanged",i).then(()=>{this.allColumnFilters.forEach(n=>{n.filterPromise&&n.filterPromise.then(r=>{r&&r!==e&&r.onAnyFilterChanged&&r.onAnyFilterChanged()})}),this.processingFilterChange=!0}))}updateAfterFilterChanged(){this.processingFilterChange=!1}isSuppressFlashingCellsBecauseFiltering(){return!(this.gos.get("allowShowChangeAfterFilter")??!1)&&this.processingFilterChange}onNewRowsLoaded(t){this.forEachColumnFilter(e=>{e.onNewRowsLoaded&&e.onNewRowsLoaded()}).then(()=>this.updateFilterFlagInColumns(t,{afterDataChange:!0})).then(()=>this.updateActiveFilters())}createValueGetter(t){return({node:e})=>this.valueService.getValue(t,e,!0)}createGetValue(t){return(e,i)=>{const n=i?this.columnModel.getCol(i):t;return n?this.valueService.getValue(n,e,!0):void 0}}isFilterActive(t){const{filter:e}=this.cachedFilter(t)??{};return e?e.isFilterActive():this.getModelFromInitialState(t)!=null}getOrCreateFilterWrapper(t){if(!t.isFilterAllowed())return null;let e=this.cachedFilter(t);return e||(e=this.createFilterWrapper(t),this.setColumnFilterWrapper(t,e)),e}cachedFilter(t){return this.allColumnFilters.get(t.getColId())}getDefaultFilter(t){let e;if(ZF(this.gos))e="agSetColumnFilter";else{const i=this.dataTypeService?.getBaseDataType(t);i==="number"?e="agNumberColumnFilter":i==="date"||i==="dateString"?e="agDateColumnFilter":e="agTextColumnFilter"}return e}getDefaultFloatingFilter(t){let e;if(ZF(this.gos))e="agSetColumnFloatingFilter";else{const i=this.dataTypeService?.getBaseDataType(t);i==="number"?e="agNumberColumnFloatingFilter":i==="date"||i==="dateString"?e="agDateColumnFloatingFilter":e="agTextColumnFloatingFilter"}return e}createFilterInstance(t,e){const i=this.getDefaultFilter(t),n=t.getColDef();let r;const s={...this.createFilterParams(t,n),filterModifiedCallback:()=>this.filterModifiedCallbackFactory(r,t)(),filterChangedCallback:a=>this.filterChangedCallbackFactory(r,t)(a),doesRowPassOtherFilter:a=>this.filterManager?this.filterManager.doesRowPassOtherFilters(r,a):!0},o=this.userComponentFactory.getFilterDetails(n,s,i);return o?{filterPromise:()=>{const a=o.newAgStackInstance();return a?.then(l=>{r=l,e&&(e.filter=l)}),a},compDetails:o}:{filterPromise:null,compDetails:null}}createFilterParams(t,e){return this.gos.addGridCommonParams({column:t,colDef:xY(e),rowModel:this.rowModel,filterChangedCallback:()=>{},filterModifiedCallback:()=>{},valueGetter:this.createValueGetter(t),getValue:this.createGetValue(t),doesRowPassOtherFilter:()=>!0})}createFilterWrapper(t){const e={column:t,filterPromise:null,compiledElement:null,compDetails:null},{filterPromise:i,compDetails:n}=this.createFilterInstance(t,e);return e.filterPromise=i?.()??null,e.compDetails=n,e}onColumnsChanged(){const t=[];this.allColumnFilters.forEach((i,n)=>{let r;i.column.isPrimary()?r=this.columnModel.getColDefCol(n):r=this.columnModel.getCol(n),!(r&&r===i.column)&&(t.push(i.column),this.disposeFilterWrapper(i,"columnChanged"),this.disposeColumnListener(n))});const e=t.every(i=>i.getColDef().filter==="agGroupColumnFilter");t.length>0&&!e?this.filterManager?.onFilterChanged({columns:t,source:"api"}):this.updateDependentFilters()}updateDependentFilters(){this.columnModel.getAutoCols()?.forEach(e=>{e.getColDef().filter==="agGroupColumnFilter"&&this.getOrCreateFilterWrapper(e)})}isFilterAllowed(t){if(!t.isFilterAllowed())return!1;const{filter:i}=this.allColumnFilters.get(t.getColId())??{};return i&&typeof i?.isFilterAllowed=="function"?i.isFilterAllowed():!0}getFloatingFilterCompDetails(t,e){const i=l=>{const u=this.getOrCreateFilterWrapper(t)?.filterPromise;u?.then(d=>{l(Qw(d))})},n=t.getColDef(),r={...this.createFilterParams(t,n),filterChangedCallback:()=>i(l=>this.filterChangedCallbackFactory(l,t)())},s=this.userComponentFactory.mergeParamsWithApplicationProvidedParams(n,gU,r);let o=Awe(this.frameworkOverrides,n,()=>this.getDefaultFloatingFilter(t));o==null&&(o="agReadOnlyFloatingFilter");const a={column:t,filterParams:s,currentParentModel:()=>this.getCurrentFloatingFilterParentModel(t),parentFilterInstance:i,showParentFilter:e,suppressFilterButton:!1};return this.userComponentFactory.getFloatingFilterCompDetails(n,a,o)}getCurrentFloatingFilterParentModel(t){return this.getModelFromFilterWrapper(this.cachedFilter(t)??{column:t})}destroyFilter(t,e="api"){const i=t.getColId(),n=this.allColumnFilters.get(i);this.disposeColumnListener(i),delete this.initialFilterModel[i],n&&(this.disposeFilterWrapper(n,e),this.filterManager?.onFilterChanged({columns:[t],source:"api"}))}disposeColumnListener(t){const e=this.allColumnListeners.get(t);e&&(this.allColumnListeners.delete(t),e())}disposeFilterWrapper(t,e){t.filterPromise.then(i=>{this.destroyBean(i),t.column.setFilterActive(!1,"filterDestroyed"),this.allColumnFilters.delete(t.column.getColId()),this.eventService.dispatchEvent({type:"filterDestroyed",source:e,column:t.column})})}filterModifiedCallbackFactory(t,e){return()=>{this.eventService.dispatchEvent({type:"filterModified",column:e,filterInstance:t})}}filterChangedCallbackFactory(t,e){return i=>{const n=i?.source??"columnFilter",r={filter:t,additionalEventAttributes:i,columns:[e],source:n};this.callOnFilterChangedOutsideRenderCycle(r)}}checkDestroyFilter(t){const e=this.allColumnFilters.get(t);if(!e)return;const i=e.column,{compDetails:n}=i.isFilterAllowed()?this.createFilterInstance(i):{compDetails:null};if(this.areFilterCompsDifferent(e.compDetails,n)){this.destroyFilter(i,"paramsUpdated");return}const r=i.getColDef().filterParams;if(!e.filterPromise){this.destroyFilter(i,"paramsUpdated");return}e.filterPromise.then(s=>{(s?.refresh?s.refresh({...this.createFilterParams(i,i.getColDef()),filterModifiedCallback:this.filterModifiedCallbackFactory(s,i),filterChangedCallback:this.filterChangedCallbackFactory(s,i),doesRowPassOtherFilter:a=>this.filterManager?this.filterManager.doesRowPassOtherFilters(s,a):!0,...r}):!0)===!1&&this.destroyFilter(i,"paramsUpdated")})}setColumnFilterWrapper(t,e){const i=t.getColId();this.allColumnFilters.set(i,e),this.allColumnListeners.set(i,this.addManagedListeners(t,{colDefChanged:()=>this.checkDestroyFilter(i)})[0])}areFilterCompsDifferent(t,e){if(!e||!t)return!0;const{componentClass:i}=t,{componentClass:n}=e;return!(i===n||i?.render&&n?.render&&i.render===n.render)}hasFloatingFilters(){return this.columnModel.getCols().some(e=>e.getColDef().floatingFilter)}getFilterInstance(t,e){e&&this.getFilterInstanceImpl(t).then(i=>{const n=Qw(i);e(n)})}getColumnFilterInstance(t){return new Promise(e=>{this.getFilterInstanceImpl(t).then(i=>{e(Qw(i))})})}getFilterInstanceImpl(t){const e=this.columnModel.getColDefCol(t);return e?this.getOrCreateFilterWrapper(e)?.filterPromise??Hl.resolve(null):Hl.resolve(void 0)}processFilterModelUpdateQueue(){this.filterModelUpdateQueue.forEach(({model:t,source:e})=>this.setFilterModel(t,e)),this.filterModelUpdateQueue=[],this.columnFilterModelUpdateQueue.forEach(({key:t,model:e,resolve:i})=>{this.setColumnFilterModel(t,e).then(()=>i())}),this.columnFilterModelUpdateQueue=[]}getColumnFilterModel(t){const e=this.getFilterWrapper(t);return e?this.getModelFromFilterWrapper(e):null}setColumnFilterModel(t,e){if(this.dataTypeService?.isPendingInference()){let s=()=>{};const o=new Promise(a=>{s=a});return this.columnFilterModelUpdateQueue.push({key:t,model:e,resolve:s}),o}const i=this.columnModel.getColDefCol(t),n=i?this.getOrCreateFilterWrapper(i):null;return n?(s=>new Promise(o=>{s.then(a=>o(a))}))(this.setModelOnFilterWrapper(n.filterPromise,e)):Promise.resolve()}getFilterWrapper(t){const e=this.columnModel.getColDefCol(t);return e?this.cachedFilter(e)??null:null}setColDefPropertiesForDataType(t,e,i){const n=ZF(this.gos),r=this.localeService.getLocaleTextFunc(),s=o=>{const{filterParams:a}=t;t.filterParams=typeof a=="object"?{...a,...o}:o};switch(e.baseDataType){case"number":{n&&s({comparator:(o,a)=>{const l=o==null?0:parseInt(o),u=a==null?0:parseInt(a);return l===u?0:l>u?1:-1}});break}case"boolean":{s(n?{valueFormatter:o=>oi(o.value)?r(String(o.value),o.value?"True":"False"):r("blanks","(Blanks)")}:{maxNumConditions:1,debounceMs:0,filterOptions:["empty",{displayKey:"true",displayName:"True",predicate:(o,a)=>a,numberOfInputs:0},{displayKey:"false",displayName:"False",predicate:(o,a)=>a===!1,numberOfInputs:0}]});break}case"date":{n&&s({valueFormatter:o=>{const a=i(o);return oi(a)?a:r("blanks","(Blanks)")},treeList:!0,treeListFormatter:(o,a)=>{if(a===1&&o!=null){const l=f6[Number(o)-1];return r(l,d6[l])}return o??r("blanks","(Blanks)")}});break}case"dateString":{const o=e.dateParser;s(n?{valueFormatter:a=>{const l=i(a);return oi(l)?l:r("blanks","(Blanks)")},treeList:!0,treeListPathGetter:a=>{const l=o(a??void 0);return l?[String(l.getFullYear()),String(l.getMonth()+1),String(l.getDate())]:null},treeListFormatter:(a,l)=>{if(l===1&&a!=null){const u=f6[Number(a)-1];return r(u,d6[u])}return a??r("blanks","(Blanks)")}}:{comparator:(a,l)=>{const u=o(l);return l==null||u<a?-1:u>a?1:0}});break}case"object":{n?s({valueFormatter:o=>{const a=i(o);return oi(a)?a:r("blanks","(Blanks)")}}):t.filterValueGetter=o=>i({column:o.column,node:o.node,value:this.valueService.getValue(o.column,o.node)});break}}}destroy(){super.destroy(),this.allColumnFilters.forEach(t=>this.disposeFilterWrapper(t,"gridDestroyed")),this.allColumnListeners.clear()}};function kwe(t){return!!t.filterManager?.isAnyFilterPresent()}function Dwe(t,e="api"){t.filterManager?.onFilterChanged({source:e})}var Lwe=class extends ir{constructor(){super(`
            <div class="ag-floating-filter-input" role="presentation">
                <ag-input-text-field data-ref="eFloatingFilterText"></ag-input-text-field>
            </div>`,[wP]),this.eFloatingFilterText=bi}wireBeans(t){this.columnNameService=t.columnNameService}destroy(){super.destroy()}init(t){this.params=t;const e=this.columnNameService.getDisplayNameForColumn(t.column,"header",!0),i=this.localeService.getLocaleTextFunc();this.eFloatingFilterText.setDisabled(!0).setInputAriaLabel(`${e} ${i("ariaFilterInput","Filter Input")}`)}onParentModelChanged(t){if(t==null){this.eFloatingFilterText.setValue("");return}this.params.parentFilterInstance(e=>{if(e.getModelAsString){const i=e.getModelAsString(t);this.eFloatingFilterText.setValue(i)}})}onParamsUpdated(t){this.refresh(t)}refresh(t){this.init(t)}},_J=class extends ir{wireBeans(t){this.columnNameService=t.columnNameService}getDefaultDebounceMs(){return 0}destroy(){super.destroy()}isEventFromFloatingFilter(t){return t&&t.afterFloatingFilter}isEventFromDataChange(t){return t?.afterDataChange}getLastType(){return this.lastType}isReadOnly(){return this.readOnly}setLastTypeFromModel(t){if(!t){this.lastType=this.optionsFactory.getDefaultOption();return}const e=t.operator;let i;e?i=t.conditions[0]:i=t,this.lastType=i.type}canWeEditAfterModelFromParentFilter(t){if(!t)return this.isTypeEditable(this.lastType);if(t.operator)return!1;const i=t;return this.isTypeEditable(i.type)}init(t){this.setSimpleParams(t,!1)}setSimpleParams(t,e=!0){this.optionsFactory=new sJ,this.optionsFactory.init(t.filterParams,this.getDefaultFilterOptions()),e||(this.lastType=this.optionsFactory.getDefaultOption()),this.readOnly=!!t.filterParams.readOnly;const i=this.isTypeEditable(this.optionsFactory.getDefaultOption());this.setEditable(i)}onParamsUpdated(t){this.refresh(t)}refresh(t){this.setSimpleParams(t)}doesFilterHaveSingleInput(t){const e=this.optionsFactory.getCustomOption(t),{numberOfInputs:i}=e||{};return i==null||i==1}isTypeEditable(t){const e=["inRange","empty","blank","notBlank"];return!!t&&!this.isReadOnly()&&this.doesFilterHaveSingleInput(t)&&e.indexOf(t)<0}getAriaLabel(t){const e=this.columnNameService.getDisplayNameForColumn(t.column,"header",!0),i=this.localeService.getLocaleTextFunc();return`${e} ${i("ariaFilterInput","Filter Input")}`}},Fwe=class extends _J{constructor(){super(`
            <div class="ag-floating-filter-input" role="presentation">
                <ag-input-text-field data-ref="eReadOnlyText"></ag-input-text-field>
                <div data-ref="eDateWrapper" style="display: flex;"></div>
            </div>`,[wP]),this.eReadOnlyText=bi,this.eDateWrapper=bi}wireBeans(t){super.wireBeans(t),this.context=t.context,this.userComponentFactory=t.userComponentFactory}getDefaultFilterOptions(){return gJ}init(t){super.init(t),this.params=t,this.filterParams=t.filterParams,this.createDateComponent(),this.filterModelFormatter=new vJ(this.filterParams,this.localeService,this.optionsFactory);const e=this.localeService.getLocaleTextFunc();this.eReadOnlyText.setDisabled(!0).setInputAriaLabel(e("ariaDateFilterInput","Date Filter Input"))}onParamsUpdated(t){this.refresh(t)}refresh(t){super.refresh(t),this.params=t,this.filterParams=t.filterParams,this.updateDateComponent(),this.filterModelFormatter.updateParams({optionsFactory:this.optionsFactory,dateFilterParams:this.filterParams}),this.updateCompOnModelChange(t.currentParentModel())}updateCompOnModelChange(t){const e=!this.isReadOnly()&&this.canWeEditAfterModelFromParentFilter(t);if(this.setEditable(e),e){if(t){const i=t;this.dateComp.setDate(ml(i.dateFrom))}else this.dateComp.setDate(null);this.eReadOnlyText.setValue("")}else this.eReadOnlyText.setValue(this.filterModelFormatter.getModelAsString(t)),this.dateComp.setDate(null)}setEditable(t){Xr(this.eDateWrapper,t),Xr(this.eReadOnlyText.getGui(),!t)}onParentModelChanged(t,e){this.isEventFromFloatingFilter(e)||this.isEventFromDataChange(e)||(super.setLastTypeFromModel(t),this.updateCompOnModelChange(t))}onDateChanged(){const t=this.dateComp.getDate(),e=Gc(t);this.params.parentFilterInstance(i=>{if(i){const n=ml(e);i.onFloatingFilterChanged(this.getLastType()||null,n)}})}getDateComponentParams(){const t=vU(this.params.filterParams,this.getDefaultDebounceMs());return{onDateChanged:Fa(this.onDateChanged.bind(this),t),filterParams:this.params.column.getColDef().filterParams}}createDateComponent(){this.dateComp=new mJ(this.context,this.userComponentFactory,this.getDateComponentParams(),this.eDateWrapper,t=>{t.setInputAriaLabel(this.getAriaLabel(this.params))}),this.addDestroyFunc(()=>this.dateComp.destroy())}updateDateComponent(){const t=this.gos.addGridCommonParams(this.getDateComponentParams());this.dateComp.updateParams(t)}getFilterModelFormatter(){return this.filterModelFormatter}},Nwe=class extends ir{constructor(){super(`
            <div class="ag-filter-filter">
                <ag-input-text-field class="ag-date-filter" data-ref="eDateInput"></ag-input-text-field>
            </div>`,[wP]),this.eDateInput=bi}destroy(){super.destroy()}init(t){this.params=t,this.setParams(t);const e=this.eDateInput.getInputElement();this.addManagedListeners(e,{mouseDown:()=>{this.eDateInput.isDisabled()||this.usingSafariDatePicker||e.focus()},input:i=>{i.target===Jr(this.gos)&&(this.eDateInput.isDisabled()||this.params.onDateChanged())}})}setParams(t){const e=this.eDateInput.getInputElement(),i=this.shouldUseBrowserDatePicker(t);this.usingSafariDatePicker=i&&Th(),e.type=i?"date":"text";const{minValidYear:n,maxValidYear:r,minValidDate:s,maxValidDate:o}=t.filterParams||{};if(s&&n&&Wt("DateFilter should not have both minValidDate and minValidYear parameters set at the same time! minValidYear will be ignored."),o&&r&&Wt("DateFilter should not have both maxValidDate and maxValidYear parameters set at the same time! maxValidYear will be ignored."),s&&o){const[a,l]=[s,o].map(u=>u instanceof Date?u:ml(u));a&&l&&a.getTime()>l.getTime()&&Wt("DateFilter parameter minValidDate should always be lower than or equal to parameter maxValidDate.")}s?s instanceof Date?e.min=Xw(s):e.min=s:n&&(e.min=`${n}-01-01`),o?o instanceof Date?e.max=Xw(o):e.max=o:r&&(e.max=`${r}-12-31`)}onParamsUpdated(t){this.refresh(t)}refresh(t){this.params=t,this.setParams(t)}getDate(){return ml(this.eDateInput.getValue())}setDate(t){this.eDateInput.setValue(Gc(t,!1))}setInputPlaceholder(t){this.eDateInput.setInputPlaceholder(t)}setInputAriaLabel(t){this.eDateInput.setAriaLabel(t)}setDisabled(t){this.eDateInput.setDisabled(t)}afterGuiAttached(t){(!t||!t.suppressFocus)&&this.eDateInput.getInputElement().focus()}shouldUseBrowserDatePicker(t){return t.filterParams&&t.filterParams.browserDatePicker!=null?t.filterParams.browserDatePicker:aU()||lU()||Th()&&IY()>=14.1}},CJ=class extends kt{constructor(t){super(),this.params=t,this.eFloatingFilterTextInput=bi,this.valueChangedListener=()=>{}}setupGui(t){this.eFloatingFilterTextInput=this.createManagedBean(new Yg(this.params?.config));const e=this.eFloatingFilterTextInput.getGui();t.appendChild(e);const i=n=>this.valueChangedListener(n);this.addManagedListeners(e,{input:i,keydown:i})}setEditable(t){this.eFloatingFilterTextInput.setDisabled(!t)}setAutoComplete(t){this.eFloatingFilterTextInput.setAutoComplete(t)}getValue(){return this.eFloatingFilterTextInput.getValue()}setValue(t,e){this.eFloatingFilterTextInput.setValue(t,e)}setValueChangedListener(t){this.valueChangedListener=t}setParams(t){this.setAriaLabel(t.ariaLabel),t.autoComplete!==void 0&&this.setAutoComplete(t.autoComplete)}setAriaLabel(t){this.eFloatingFilterTextInput.setInputAriaLabel(t)}},SJ=class extends _J{constructor(){super(...arguments),this.eFloatingFilterInputContainer=bi}postConstruct(){this.setTemplate(`
            <div class="ag-floating-filter-input" role="presentation" data-ref="eFloatingFilterInputContainer"></div>
        `)}getDefaultDebounceMs(){return 500}onParentModelChanged(t,e){this.isEventFromFloatingFilter(e)||this.isEventFromDataChange(e)||(this.setLastTypeFromModel(t),this.setEditable(this.canWeEditAfterModelFromParentFilter(t)),this.floatingFilterInputService.setValue(this.getFilterModelFormatter().getModelAsString(t)))}init(t){this.setupFloatingFilterInputService(t),super.init(t),this.setTextInputParams(t)}setupFloatingFilterInputService(t){this.floatingFilterInputService=this.createFloatingFilterInputService(t),this.floatingFilterInputService.setupGui(this.eFloatingFilterInputContainer)}setTextInputParams(t){this.params=t;const e=t.browserAutoComplete??!1;if(this.floatingFilterInputService.setParams({ariaLabel:this.getAriaLabel(t),autoComplete:e}),this.applyActive=kT(this.params.filterParams),!this.isReadOnly()){const i=vU(this.params.filterParams,this.getDefaultDebounceMs()),n=Fa(this.syncUpWithParentFilter.bind(this),i);this.floatingFilterInputService.setValueChangedListener(n)}}onParamsUpdated(t){this.refresh(t)}refresh(t){super.refresh(t),this.setTextInputParams(t)}recreateFloatingFilterInputService(t){const e=this.floatingFilterInputService.getValue();fa(this.eFloatingFilterInputContainer),this.destroyBean(this.floatingFilterInputService),this.setupFloatingFilterInputService(t),this.floatingFilterInputService.setValue(e,!0)}syncUpWithParentFilter(t){const e=t.key===St.ENTER;if(this.applyActive&&!e)return;let i=this.floatingFilterInputService.getValue();this.params.filterParams.trimInput&&(i=fJ(i),this.floatingFilterInputService.setValue(i,!0)),this.params.parentFilterInstance(n=>{n&&n.onFloatingFilterChanged(this.getLastType()||null,i||null)})}setEditable(t){this.floatingFilterInputService.setEditable(t)}},Bwe=class extends kt{constructor(){super(...arguments),this.valueChangedListener=()=>{},this.numberInputActive=!0}setupGui(t){this.eFloatingFilterNumberInput=this.createManagedBean(new xU),this.eFloatingFilterTextInput=this.createManagedBean(new Yg),this.eFloatingFilterTextInput.setDisabled(!0);const e=this.eFloatingFilterNumberInput.getGui(),i=this.eFloatingFilterTextInput.getGui();t.appendChild(e),t.appendChild(i),this.setupListeners(e,n=>this.valueChangedListener(n)),this.setupListeners(i,n=>this.valueChangedListener(n))}setEditable(t){this.numberInputActive=t,this.eFloatingFilterNumberInput.setDisplayed(this.numberInputActive),this.eFloatingFilterTextInput.setDisplayed(!this.numberInputActive)}setAutoComplete(t){this.eFloatingFilterNumberInput.setAutoComplete(t),this.eFloatingFilterTextInput.setAutoComplete(t)}getValue(){return this.getActiveInputElement().getValue()}setValue(t,e){this.getActiveInputElement().setValue(t,e)}getActiveInputElement(){return this.numberInputActive?this.eFloatingFilterNumberInput:this.eFloatingFilterTextInput}setValueChangedListener(t){this.valueChangedListener=t}setupListeners(t,e){this.addManagedListeners(t,{input:e,keydown:e})}setParams(t){this.setAriaLabel(t.ariaLabel),t.autoComplete!==void 0&&this.setAutoComplete(t.autoComplete)}setAriaLabel(t){this.eFloatingFilterNumberInput.setInputAriaLabel(t),this.eFloatingFilterTextInput.setInputAriaLabel(t)}},zwe=class extends SJ{init(t){super.init(t),this.filterModelFormatter=new uJ(this.localeService,this.optionsFactory,t.filterParams?.numberFormatter)}onParamsUpdated(t){this.refresh(t)}refresh(t){Mz(t.filterParams)!==this.allowedCharPattern&&this.recreateFloatingFilterInputService(t),super.refresh(t),this.filterModelFormatter.updateParams({optionsFactory:this.optionsFactory})}getDefaultFilterOptions(){return cJ}getFilterModelFormatter(){return this.filterModelFormatter}createFloatingFilterInputService(t){return this.allowedCharPattern=Mz(t.filterParams),this.allowedCharPattern?this.createManagedBean(new CJ({config:{allowedCharPattern:this.allowedCharPattern}})):this.createManagedBean(new Bwe)}},Vwe=class extends SJ{init(t){super.init(t),this.filterModelFormatter=new dJ(this.localeService,this.optionsFactory)}onParamsUpdated(t){this.refresh(t)}refresh(t){super.refresh(t),this.filterModelFormatter.updateParams({optionsFactory:this.optionsFactory})}getDefaultFilterOptions(){return hJ}getFilterModelFormatter(){return this.filterModelFormatter}createFloatingFilterInputService(){return this.createManagedBean(new CJ)}};function Gwe(t){return!!t.filterManager?.isQuickFilterPresent()}function Uwe(t){return t.gos.get("quickFilterText")}function Hwe(t){t.filterManager?.resetQuickFilterCache()}var $we=class extends kt{constructor(){super(...arguments),this.beanName="quickFilterService",this.quickFilter=null,this.quickFilterParts=null}wireBeans(t){this.valueService=t.valueService,this.columnModel=t.columnModel,this.rowModel=t.rowModel,this.pivotResultColsService=t.pivotResultColsService}postConstruct(){const t=this.resetQuickFilterCache.bind(this);this.addManagedEventListeners({columnPivotModeChanged:t,newColumnsLoaded:t,columnRowGroupChanged:t,columnVisible:()=>{this.gos.get("includeHiddenColumnsInQuickFilter")||this.resetQuickFilterCache()}}),this.addManagedPropertyListener("quickFilterText",e=>this.setQuickFilter(e.currentValue)),this.addManagedPropertyListeners(["includeHiddenColumnsInQuickFilter","applyQuickFilterBeforePivotOrAgg"],()=>this.onQuickFilterColumnConfigChanged()),this.quickFilter=this.parseQuickFilter(this.gos.get("quickFilterText")),this.parser=this.gos.get("quickFilterParser"),this.matcher=this.gos.get("quickFilterMatcher"),this.setQuickFilterParts(),this.addManagedPropertyListeners(["quickFilterMatcher","quickFilterParser"],()=>this.setQuickFilterParserAndMatcher())}refreshQuickFilterCols(){const t=this.columnModel.isPivotMode(),e=this.columnModel.getAutoCols(),i=this.columnModel.getColDefCols();let n=(t&&!this.gos.get("applyQuickFilterBeforePivotOrAgg")?this.pivotResultColsService.getPivotResultCols()?.list:i)??[];e&&(n=n.concat(e)),this.colsForQuickFilter=this.gos.get("includeHiddenColumnsInQuickFilter")?n:n.filter(r=>r.isVisible()||r.isRowGroupActive())}isQuickFilterPresent(){return this.quickFilter!==null}doesRowPassQuickFilter(t){const e=this.gos.get("cacheQuickFilter");return this.matcher?this.doesRowPassQuickFilterMatcher(e,t):this.quickFilterParts.every(i=>e?this.doesRowPassQuickFilterCache(t,i):this.doesRowPassQuickFilterNoCache(t,i))}resetQuickFilterCache(){this.rowModel.forEachNode(t=>t.quickFilterAggregateText=null)}setQuickFilterParts(){const{quickFilter:t,parser:e}=this;t?this.quickFilterParts=e?e(t):t.split(" "):this.quickFilterParts=null}parseQuickFilter(t){return oi(t)?ls(this.gos)?t.toUpperCase():(Wt("Quick filtering only works with the Client-Side Row Model"),null):null}setQuickFilter(t){if(t!=null&&typeof t!="string"){Wt(`Grid option quickFilterText only supports string inputs, received: ${typeof t}`);return}const e=this.parseQuickFilter(t);this.quickFilter!==e&&(this.quickFilter=e,this.setQuickFilterParts(),this.dispatchLocalEvent({type:"quickFilterChanged"}))}setQuickFilterParserAndMatcher(){const t=this.gos.get("quickFilterParser"),e=this.gos.get("quickFilterMatcher"),i=t!==this.parser||e!==this.matcher;this.parser=t,this.matcher=e,i&&(this.setQuickFilterParts(),this.dispatchLocalEvent({type:"quickFilterChanged"}))}onQuickFilterColumnConfigChanged(){this.refreshQuickFilterCols(),this.resetQuickFilterCache(),this.isQuickFilterPresent()&&this.dispatchLocalEvent({type:"quickFilterChanged"})}doesRowPassQuickFilterNoCache(t,e){return this.colsForQuickFilter.some(i=>{const n=this.getQuickFilterTextForColumn(i,t);return oi(n)&&n.indexOf(e)>=0})}doesRowPassQuickFilterCache(t,e){return this.checkGenerateQuickFilterAggregateText(t),t.quickFilterAggregateText.indexOf(e)>=0}doesRowPassQuickFilterMatcher(t,e){let i;t?(this.checkGenerateQuickFilterAggregateText(e),i=e.quickFilterAggregateText):i=this.getQuickFilterAggregateText(e);const{quickFilterParts:n,matcher:r}=this;return r(n,i)}checkGenerateQuickFilterAggregateText(t){t.quickFilterAggregateText||(t.quickFilterAggregateText=this.getQuickFilterAggregateText(t))}getQuickFilterTextForColumn(t,e){let i=this.valueService.getValue(t,e,!0);const n=t.getColDef();if(n.getQuickFilterText){const r=this.gos.addGridCommonParams({value:i,node:e,data:e.data,column:t,colDef:n});i=n.getQuickFilterText(r)}return oi(i)?i.toString().toUpperCase():null}getQuickFilterAggregateText(t){const e=[];return this.colsForQuickFilter.forEach(i=>{const n=this.getQuickFilterTextForColumn(i,t);oi(n)&&e.push(n)}),e.join(`
`)}},CU={version:fn,moduleName:"@ag-grid-community/filter-core",beans:[qbe]},Wwe={version:fn,moduleName:"@ag-grid-community/filter-api",apiFunctions:{isAnyFilterPresent:kwe,onFilterChanged:Dwe},dependantModules:[CU]},SU={version:fn,moduleName:"@ag-grid-community/column-filter",beans:[Iwe],dependantModules:[CU]},qwe={version:fn,moduleName:"@ag-grid-community/column-filter-api",apiFunctions:{isColumnFilterPresent:_we,getFilterInstance:Cwe,getColumnFilterInstance:Swe,destroyFilter:Owe,setFilterModel:Mwe,getFilterModel:Twe,getColumnFilterModel:Rwe,setColumnFilterModel:Pwe,showColumnFilter:Ewe},dependantModules:[SU,Wwe]},OJ={version:fn,moduleName:"@ag-grid-community/floating-filter-core",controllers:[{name:"headerFilterCell",classImp:wwe}],dependantModules:[SU]},jwe={version:fn,moduleName:"@ag-grid-community/read-only-floating-filter",userComponents:[{name:"agReadOnlyFloatingFilter",classImp:Lwe}],dependantModules:[OJ]},Qwe={version:fn,moduleName:"@ag-grid-community/simple-filter",dependantModules:[SU],userComponents:[{name:"agTextColumnFilter",classImp:dwe},{name:"agNumberColumnFilter",classImp:hwe},{name:"agDateColumnFilter",classImp:mwe},{name:"agDateInput",classImp:Nwe}]},Zwe={version:fn,moduleName:"@ag-grid-community/simple-floating-filter",dependantModules:[Qwe,OJ],userComponents:[{name:"agTextColumnFloatingFilter",classImp:Vwe},{name:"agNumberColumnFloatingFilter",classImp:zwe},{name:"agDateColumnFloatingFilter",classImp:Fwe}]},MJ={version:fn,moduleName:"@ag-grid-community/quick-filter-core",beans:[$we],dependantModules:[CU]},Xwe={version:fn,moduleName:"@ag-grid-community/quick-filter-api",apiFunctions:{isQuickFilterPresent:Gwe,getQuickFilter:Uwe,resetQuickFilter:Hwe},dependantModules:[MJ]},Kwe={version:fn,moduleName:"@ag-grid-community/quick-filter",dependantModules:[MJ,Xwe]},Ywe={version:fn,moduleName:"@ag-grid-community/filter",dependantModules:[Zwe,jwe,Kwe,qwe]},OU=class extends ir{constructor(t,e){super(t),this.ctrl=e}getCtrl(){return this.ctrl}},Jwe=class extends OU{constructor(t){super(`<div class="ag-header-cell ag-floating-filter" role="gridcell">
            <div data-ref="eFloatingFilterBody" role="presentation"></div>
            <div class="ag-floating-filter-button ag-hidden" data-ref="eButtonWrapper" role="presentation">
                <button type="button" class="ag-button ag-floating-filter-button-button" data-ref="eButtonShowMainFilter" tabindex="-1"></button>
            </div>
        </div>`,t),this.eFloatingFilterBody=bi,this.eButtonWrapper=bi,this.eButtonShowMainFilter=bi}postConstruct(){const t=this.getGui(),e={addOrRemoveCssClass:(i,n)=>this.addOrRemoveCssClass(i,n),addOrRemoveBodyCssClass:(i,n)=>this.eFloatingFilterBody.classList.toggle(i,n),setButtonWrapperDisplayed:i=>Xr(this.eButtonWrapper,i),setCompDetails:i=>this.setCompDetails(i),getFloatingFilterComp:()=>this.compPromise,setWidth:i=>t.style.width=i,setMenuIcon:i=>this.eButtonShowMainFilter.appendChild(i)};this.ctrl.setComp(e,t,this.eButtonShowMainFilter,this.eFloatingFilterBody,void 0)}setCompDetails(t){if(!t){this.destroyFloatingFilterComp(),this.compPromise=null;return}this.compPromise=t.newAgStackInstance(),this.compPromise.then(e=>this.afterCompCreated(e))}destroy(){this.destroyFloatingFilterComp(),super.destroy()}destroyFloatingFilterComp(){this.floatingFilterComp&&(this.eFloatingFilterBody.removeChild(this.floatingFilterComp.getGui()),this.floatingFilterComp=this.destroyBean(this.floatingFilterComp))}afterCompCreated(t){if(t){if(!this.isAlive()){this.destroyBean(t);return}this.destroyFloatingFilterComp(),this.floatingFilterComp=t,this.eFloatingFilterBody.appendChild(t.getGui()),t.afterGuiAttached&&t.afterGuiAttached()}}},e_e=class extends OU{constructor(t){super(`<div class="ag-header-cell" role="columnheader">
            <div data-ref="eResize" class="ag-header-cell-resize" role="presentation"></div>
            <div data-ref="eHeaderCompWrapper" class="ag-header-cell-comp-wrapper" role="presentation"></div>
        </div>`,t),this.eResize=bi,this.eHeaderCompWrapper=bi,this.headerCompVersion=0,this.column=t.getColumnGroupChild(),this.pinned=t.getPinned()}postConstruct(){const t=this.getGui();((r,s)=>{s!=null&&s!=""?t.setAttribute(r,s):t.removeAttribute(r)})("col-id",this.column.getColId());const i={setWidth:r=>t.style.width=r,addOrRemoveCssClass:(r,s)=>this.addOrRemoveCssClass(r,s),setAriaSort:r=>r?Lxe(t,r):Fxe(t),setUserCompDetails:r=>this.setUserCompDetails(r),getUserCompInstance:()=>this.headerComp};this.ctrl.setComp(i,this.getGui(),this.eResize,this.eHeaderCompWrapper,void 0);const n=this.ctrl.getSelectAllGui();this.eResize.insertAdjacentElement("afterend",n)}destroy(){this.destroyHeaderComp(),super.destroy()}destroyHeaderComp(){this.headerComp&&(this.eHeaderCompWrapper.removeChild(this.headerCompGui),this.headerComp=this.destroyBean(this.headerComp),this.headerCompGui=void 0)}setUserCompDetails(t){this.headerCompVersion++;const e=this.headerCompVersion;t.newAgStackInstance().then(i=>this.afterCompCreated(e,i))}afterCompCreated(t,e){if(t!=this.headerCompVersion||!this.isAlive()){this.destroyBean(e);return}this.destroyHeaderComp(),this.headerComp=e,this.headerCompGui=e.getGui(),this.eHeaderCompWrapper.appendChild(this.headerCompGui),this.ctrl.setDragSource(this.getGui())}},t_e=class extends OU{constructor(t){super(`<div class="ag-header-group-cell" role="columnheader">
            <div data-ref="eHeaderCompWrapper" class="ag-header-cell-comp-wrapper" role="presentation"></div>
            <div data-ref="eResize" class="ag-header-cell-resize" role="presentation"></div>
        </div>`,t),this.eResize=bi,this.eHeaderCompWrapper=bi}postConstruct(){const t=this.getGui(),e=(n,r)=>r!=null?t.setAttribute(n,r):t.removeAttribute(n);t.setAttribute("col-id",this.ctrl.getColId());const i={addOrRemoveCssClass:(n,r)=>this.addOrRemoveCssClass(n,r),setHeaderWrapperHidden:n=>{n?this.eHeaderCompWrapper.style.setProperty("display","none"):this.eHeaderCompWrapper.style.removeProperty("display")},setHeaderWrapperMaxHeight:n=>{n!=null?this.eHeaderCompWrapper.style.setProperty("max-height",`${n}px`):this.eHeaderCompWrapper.style.removeProperty("max-height"),this.eHeaderCompWrapper.classList.toggle("ag-header-cell-comp-wrapper-limited-height",n!=null)},setResizableDisplayed:n=>Xr(this.eResize,n),setWidth:n=>t.style.width=n,setAriaExpanded:n=>e("aria-expanded",n),setUserCompDetails:n=>this.setUserCompDetails(n),getUserCompInstance:()=>this.headerGroupComp};this.ctrl.setComp(i,t,this.eResize,this.eHeaderCompWrapper,void 0)}setUserCompDetails(t){t.newAgStackInstance().then(e=>this.afterHeaderCompCreated(e))}afterHeaderCompCreated(t){const e=()=>this.destroyBean(t);if(!this.isAlive()){e();return}const i=this.getGui(),n=t.getGui();this.eHeaderCompWrapper.appendChild(n),this.addDestroyFunc(e),this.headerGroupComp=t,this.ctrl.setDragSource(i)}addOrRemoveHeaderWrapperStyle(t,e){const{eHeaderCompWrapper:i}=this;e?i.style.setProperty(t,e):i.style.removeProperty(t)}},i_e=class extends ir{constructor(t){super(),this.headerComps={},this.ctrl=t,this.setTemplate(`<div class="${this.ctrl.getHeaderRowClass()}" role="row"></div>`)}postConstruct(){EY(this.getGui(),this.ctrl.getAriaRowIndex());const t={setHeight:e=>this.getGui().style.height=e,setTop:e=>this.getGui().style.top=e,setHeaderCtrls:(e,i)=>this.setHeaderCtrls(e,i),setWidth:e=>this.getGui().style.width=e};this.ctrl.setComp(t,void 0)}destroy(){this.setHeaderCtrls([],!1),super.destroy()}setHeaderCtrls(t,e){if(!this.isAlive())return;const i=this.headerComps;if(this.headerComps={},t.forEach(n=>{const r=n.instanceId;let s=i[r];delete i[r],s==null&&(s=this.createHeaderComp(n),this.getGui().appendChild(s.getGui())),this.headerComps[r]=s}),gu(i,(n,r)=>{this.getGui().removeChild(r.getGui()),this.destroyBean(r)}),e){const n=Fg(this.headerComps);n.sort((s,o)=>{const a=s.getCtrl().getColumnGroupChild().getLeft(),l=o.getCtrl().getColumnGroupChild().getLeft();return a-l});const r=n.map(s=>s.getGui());GY(this.getGui(),r)}}createHeaderComp(t){let e;switch(this.ctrl.getType()){case"group":e=new t_e(t);break;case"filter":e=new Jwe(t);break;default:e=new e_e(t);break}return this.createBean(e),e.setParentComponent(this),e}},n_e=class extends kt{constructor(){super(...arguments),this.beanName="headerNavigationService",this.currentHeaderRowWithoutSpan=-1}wireBeans(t){this.focusService=t.focusService,this.headerPositionUtils=t.headerPositionUtils,this.ctrlsService=t.ctrlsService,this.columnModel=t.columnModel,this.visibleColService=t.visibleColsService}postConstruct(){this.ctrlsService.whenReady(this,e=>{this.gridBodyCon=e.gridBodyCtrl});const t=Rs(this.gos);this.addManagedElementListeners(t,{mousedown:()=>this.setCurrentHeaderRowWithoutSpan(-1)})}getHeaderRowCount(){return this.ctrlsService.getHeaderRowContainerCtrl()?.getRowCount()??0}getHeaderPositionForColumn(t,e){let i;if(typeof t=="string"?(i=this.columnModel.getCol(t),i||(i=this.visibleColService.getColumnGroup(t))):i=t,!i)return null;const r=this.ctrlsService.getHeaderRowContainerCtrl()?.getAllCtrls(),s=Yn(r||[]).getType()==="filter",o=this.getHeaderRowCount()-1;let a=-1,l=i;for(;l;)a++,l=l.getParent();let u=a;return e&&s&&u===o-1&&u++,u===-1?null:{headerRowIndex:u,column:i}}navigateVertically(t,e,i){if(e||(e=this.focusService.getFocusedHeader()),!e)return!1;const{headerRowIndex:n}=e,r=e.column,s=this.getHeaderRowCount(),o=t===0;let{headerRowIndex:a,column:l,headerRowIndexWithoutSpan:u}=o?this.headerPositionUtils.getColumnVisibleParent(r,n):this.headerPositionUtils.getColumnVisibleChild(r,n),d=!1;return a<0&&(a=0,l=r,d=!0),a>=s?(a=-1,this.setCurrentHeaderRowWithoutSpan(-1)):u!==void 0&&(this.currentHeaderRowWithoutSpan=u),!d&&!l?!1:this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:a,column:l},allowUserOverride:!0,event:i})}setCurrentHeaderRowWithoutSpan(t){this.currentHeaderRowWithoutSpan=t}navigateHorizontally(t,e=!1,i){const n=this.focusService.getFocusedHeader(),r=t===2,s=this.gos.get("enableRtl");let o,a;if(this.currentHeaderRowWithoutSpan!==-1?n.headerRowIndex=this.currentHeaderRowWithoutSpan:this.currentHeaderRowWithoutSpan=n.headerRowIndex,r!==s?(a="Before",o=this.headerPositionUtils.findHeader(n,a)):(a="After",o=this.headerPositionUtils.findHeader(n,a)),o||!e)return this.focusService.focusHeaderPosition({headerPosition:o,direction:a,fromTab:e,allowUserOverride:!0,event:i});if(e){const l=this.gos.getCallback("tabToNextHeader");if(l)return this.focusService.focusHeaderPositionFromUserFunc({userFunc:l,headerPosition:o,direction:a})}return this.focusNextHeaderRow(n,a,i)}focusNextHeaderRow(t,e,i){const n=t.headerRowIndex;let r=null,s;if(e==="Before"?n>0&&(s=n-1,this.currentHeaderRowWithoutSpan-=1,r=this.headerPositionUtils.findColAtEdgeForHeaderRow(s,"end")):(s=n+1,this.currentHeaderRowWithoutSpan<this.getHeaderRowCount()?this.currentHeaderRowWithoutSpan+=1:this.setCurrentHeaderRowWithoutSpan(-1),r=this.headerPositionUtils.findColAtEdgeForHeaderRow(s,"start")),!r)return!1;const{column:o,headerRowIndex:a}=this.headerPositionUtils.getHeaderIndexToFocus(r.column,r?.headerRowIndex);return this.focusService.focusHeaderPosition({headerPosition:{column:o,headerRowIndex:a},direction:e,fromTab:!0,allowUserOverride:!0,event:i})}scrollToColumn(t,e="After"){if(t.getPinned())return;let i;if(Vs(t)){const n=t.getDisplayedLeafColumns();i=e==="Before"?Yn(n):n[0]}else i=t;this.gridBodyCon.getScrollFeature().ensureColumnVisible(i)}},r_e=class extends kt{wireBeans(t){this.animationFrameService=t.animationFrameService,this.headerNavigationService=t.headerNavigationService,this.focusService=t.focusService,this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.ctrlsService=t.ctrlsService,this.filterManager=t.filterManager,this.menuService=t.menuService}setComp(t,e,i){this.comp=t,this.eGui=e,this.createManagedBean(new Kg(i,{onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this),onFocusOut:this.onFocusOut.bind(this)})),this.addManagedEventListeners({columnPivotModeChanged:this.onPivotModeChanged.bind(this),displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this)}),this.onPivotModeChanged(),this.setupHeaderHeight();const n=this.onHeaderContextMenu.bind(this);this.addManagedElementListeners(this.eGui,{contextmenu:n}),this.mockContextMenuForIPad(n),this.ctrlsService.register("gridHeaderCtrl",this)}setupHeaderHeight(){const t=this.setHeaderHeight.bind(this);t(),this.addManagedPropertyListeners(["headerHeight","pivotHeaderHeight","groupHeaderHeight","pivotGroupHeaderHeight","floatingFiltersHeight"],t),this.addManagedEventListeners({displayedColumnsChanged:t,columnHeaderHeightChanged:t,columnGroupHeaderHeightChanged:()=>this.animationFrameService.requestAnimationFrame(()=>t()),gridStylesChanged:t,advancedFilterEnabledChanged:t})}getHeaderHeight(){return this.headerHeight}setHeaderHeight(){const{columnModel:t}=this;let e=0;const i=this.columnModel.getGroupRowsHeight().reduce((s,o)=>s+o,0),n=this.columnModel.getColumnHeaderRowHeight();if(this.filterManager?.hasFloatingFilters()&&(e+=t.getFloatingFiltersHeight()),e+=i,e+=n,this.headerHeight===e)return;this.headerHeight=e;const r=`${e+1}px`;this.comp.setHeightAndMinHeight(r),this.eventService.dispatchEvent({type:"headerHeightChanged"})}onPivotModeChanged(){const t=this.columnModel.isPivotMode();this.comp.addOrRemoveCssClass("ag-pivot-on",t),this.comp.addOrRemoveCssClass("ag-pivot-off",!t)}onDisplayedColumnsChanged(){const e=this.visibleColsService.getAllCols().some(i=>i.isSpanHeaderHeight());this.comp.addOrRemoveCssClass("ag-header-allow-overflow",e)}onTabKeyDown(t){const e=this.gos.get("enableRtl"),i=t.shiftKey,n=i!==e?2:3;(this.headerNavigationService.navigateHorizontally(n,!0,t)||!i&&this.focusService.focusOverlay(!1)||this.focusService.focusNextGridCoreContainer(i,!0))&&t.preventDefault()}handleKeyDown(t){let e=null;switch(t.key){case St.LEFT:e=2;case St.RIGHT:{oi(e)||(e=3),this.headerNavigationService.navigateHorizontally(e,!1,t)&&t.preventDefault();break}case St.UP:e=0;case St.DOWN:{oi(e)||(e=1),this.headerNavigationService.navigateVertically(e,null,t)&&t.preventDefault();break}default:return}}onFocusOut(t){const{relatedTarget:e}=t;!e&&this.eGui.contains(Jr(this.gos))||this.eGui.contains(e)||this.focusService.clearFocusedHeader()}onHeaderContextMenu(t,e,i){if(!t&&!i||!this.menuService.isHeaderContextMenuEnabled())return;const{target:n}=t??e;(n===this.eGui||n===this.ctrlsService.getHeaderRowContainerCtrl()?.getViewportElement())&&this.menuService.showHeaderContextMenu(void 0,t,i)}mockContextMenuForIPad(t){if(!Np())return;const e=new mp(this.eGui),i=n=>{t(void 0,n.touchStart,n.touchEvent)};this.addManagedListeners(e,{longTap:i}),this.addDestroyFunc(()=>e.destroy())}},MU=class extends kt{constructor(t,e=!1){super(),this.callback=t,this.addSpacer=e}wireBeans(t){this.visibleColsService=t.visibleColsService,this.scrollVisibleService=t.scrollVisibleService}postConstruct(){const t=this.setWidth.bind(this);this.addManagedPropertyListener("domLayout",t),this.addManagedEventListeners({columnContainerWidthChanged:t,displayedColumnsChanged:t,leftPinnedWidthChanged:t}),this.addSpacer&&this.addManagedEventListeners({rightPinnedWidthChanged:t,scrollVisibilityChanged:t,scrollbarWidthChanged:t}),this.setWidth()}setWidth(){const t=Zo(this.gos,"print"),e=this.visibleColsService.getBodyContainerWidth(),i=this.visibleColsService.getColsLeftWidth(),n=this.visibleColsService.getDisplayedColumnsRightWidth();let r;t?r=e+i+n:(r=e,this.addSpacer&&(this.gos.get("enableRtl")?i:n)===0&&this.scrollVisibleService.isVerticalScrollShowing()&&(r+=this.scrollVisibleService.getScrollbarWidth())),this.callback(r)}},s_e=class extends kt{constructor(t){super(),this.columnsToAggregate=[],this.columnsToGroup=[],this.columnsToPivot=[],this.pinned=t}wireBeans(t){this.funcColsService=t.funcColsService}onDragEnter(t){if(this.clearColumnsList(),this.gos.get("functionsReadOnly"))return;const e=t.dragItem.columns;e&&e.forEach(i=>{i.isPrimary()&&(i.isAnyFunctionActive()||(i.isAllowValue()?this.columnsToAggregate.push(i):i.isAllowRowGroup()?this.columnsToGroup.push(i):i.isAllowPivot()&&this.columnsToPivot.push(i)))})}getIconName(){return this.columnsToAggregate.length+this.columnsToGroup.length+this.columnsToPivot.length>0?this.pinned?"pinned":"move":null}onDragLeave(t){this.clearColumnsList()}clearColumnsList(){this.columnsToAggregate.length=0,this.columnsToGroup.length=0,this.columnsToPivot.length=0}onDragging(t){}onDragStop(t){this.columnsToAggregate.length>0&&this.funcColsService.addValueColumns(this.columnsToAggregate,"toolPanelDragAndDrop"),this.columnsToGroup.length>0&&this.funcColsService.addRowGroupColumns(this.columnsToGroup,"toolPanelDragAndDrop"),this.columnsToPivot.length>0&&this.funcColsService.addPivotColumns(this.columnsToPivot,"toolPanelDragAndDrop")}onDragCancel(){this.clearColumnsList()}};function TJ(t){const{isFromHeader:e,fromLeft:i,xPosition:n,fromEnter:r,fakeEvent:s,pinned:o,gos:a,columnModel:l,columnMoveService:u,visibleColsService:d}=t;let{allMovingColumns:p}=t;if(e){const $=[];p.forEach(W=>{let Q=null,Y=W.getParent();for(;Y!=null&&Y.getDisplayedLeafColumns().length===1;)Q=Y,Y=Y.getParent();Q!=null?(!!Q.getColGroupDef()?.marryChildren?Q.getProvidedColumnGroup().getLeafColumns():Q.getLeafColumns()).forEach(G=>{$.includes(G)||$.push(G)}):$.includes(W)||$.push(W)}),p=$}const v=p.slice();l.sortColsLikeCols(v);const y=c_e({movingCols:v,draggingRight:i,xPosition:n,pinned:o,gos:a,columnModel:l,visibleColsService:d}),w=o_e(v,l);if(y.length===0)return;const R=y[0];let O=w!==null&&!r;if(e&&(O=w!==null),O&&!s&&(!i&&R>=w||i&&R<=w))return;const P=d.getAllCols(),N=[];let F=null;for(let $=0;$<y.length;$++){const W=y[$],Q=u.getProposedColumnOrder(v,W);if(!u.doesOrderPassRules(Q))continue;const Y=Q.filter(D=>P.includes(D));if(F===null)F=Y;else if(!Fp(Y,F))break;const M=a_e(Q);N.push({move:W,fragCount:M})}if(N.length===0)return;N.sort(($,W)=>$.fragCount-W.fragCount);const k=N[0].move;if(!(k>l.getCols().length-p.length))return{columns:p,toIndex:k}}function TU(t){const{columns:e,toIndex:i}=TJ(t)||{},{finished:n,columnMoveService:r}=t;return!e||i==null?null:(r.moveColumns(e,i,"uiColumnMoved",n),n?null:{columns:e,toIndex:i})}function o_e(t,e){const i=e.getCols(),n=q0e(t.map(l=>i.indexOf(l))),r=n[0];return Yn(n)-r!==n.length-1?null:r}function a_e(t){function e(n){const r=[];let s=n.getOriginalParent();for(;s!=null;)r.push(s),s=s.getOriginalParent();return r}let i=0;for(let n=0;n<t.length-1;n++){let r=e(t[n]),s=e(t[n+1]);[r,s]=r.length>s.length?[r,s]:[s,r],r.forEach(o=>{s.indexOf(o)===-1&&i++})}return i}function l_e(t,e){switch(e){case"left":return t.getLeftCols();case"right":return t.getRightCols();default:return t.getCenterCols()}}function c_e(t){const{movingCols:e,draggingRight:i,xPosition:n,pinned:r,gos:s,columnModel:o,visibleColsService:a}=t;if(s.get("suppressMovableColumns")||e.some(F=>F.getColDef().suppressMovable))return[];const u=l_e(a,r),d=o.getCols(),p=u.filter(F=>fg(e,F)),v=u.filter(F=>!fg(e,F)),y=d.filter(F=>!fg(e,F));let w=0,R=n;if(i){let F=0;p.forEach(k=>F+=k.getActualWidth()),R-=F}if(R>0){for(let F=0;F<v.length;F++){const k=v[F];if(R-=k.getActualWidth(),R<0)break;w++}i&&w++}let O;if(w>0){const F=v[w-1];O=y.indexOf(F)+1}else O=y.indexOf(v[0]),O===-1&&(O=0);const P=[O],N=(F,k)=>F-k;if(i){let F=O+1;const k=d.length-1;for(;F<=k;)P.push(F),F++;P.sort(N)}else{let F=O;const k=d.length-1;let $=d[F];for(;F<=k&&u.indexOf($)<0;)F++,P.push(F),$=d[F];F=O-1;const W=0;for(;F>=W;)P.push(F),F--;P.sort(N).reverse()}return P}function DT(t){const{pinned:e,fromKeyboard:i,gos:n,ctrlsService:r,useHeaderRow:s,skipScrollPadding:o}=t;let a=r.getHeaderRowContainerCtrl(e)?.getViewportElement(),{x:l}=t;return a?(i&&(l-=a.getBoundingClientRect().left),n.get("enableRtl")&&(s&&(a=a.querySelector(".ag-header-row")),l=a.clientWidth-l),e==null&&!o&&(l+=r.get("center").getCenterViewportScrollLeft()),l):0}function t0(t,e){for(const i of t)i.setMoving(e,"uiColumnMoved")}var p6=7,Tz=100,q1=Tz/2,u_e=5,h_e=100,d_e=class extends kt{constructor(t){super(),this.needToMoveLeft=!1,this.needToMoveRight=!1,this.lastMovedInfo=null,this.pinned=t,this.isCenterContainer=!oi(t)}wireBeans(t){this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.columnMoveService=t.columnMoveService,this.dragAndDropService=t.dragAndDropService,this.ctrlsService=t.ctrlsService}postConstruct(){this.ctrlsService.whenReady(this,t=>{this.gridBodyCon=t.gridBodyCtrl})}getIconName(){const t=this.lastDraggingEvent?.dragItem.columns??[];for(const e of t){const i=e.getPinned();if(e.getColDef().lockPinned){if(i==this.pinned)return"move";continue}if(i===this.pinned||!this.pinned)return"move";if(!i&&this.pinned)return"pinned"}return"notAllowed"}onDragEnter(t){const e=t.dragItem.columns;if(t.dragSource.type===0)this.setColumnsVisible(e,!0,"uiColumnDragged");else{const n=t.dragItem.visibleState,r=(e||[]).filter(s=>n[s.getId()]);this.setColumnsVisible(r,!0,"uiColumnDragged")}this.gos.get("suppressMoveWhenColumnDragging")||this.attemptToPinColumns(e,this.pinned),this.onDragging(t,!0,!0)}onDragging(t=this.lastDraggingEvent,e=!1,i=!1,n=!1){const r=this.gos.get("suppressMoveWhenColumnDragging");if(n&&!r){this.finishColumnMoving();return}if(this.lastDraggingEvent=t,!t||!n&&Wn(t.hDirection))return;const{pinned:s,gos:o,ctrlsService:a}=this,l=DT({x:t.x,pinned:s,gos:o,ctrlsService:a});e||this.checkCenterForScrolling(l),r?this.handleColumnDragWhileSuppressingMovement(t,e,i,l,n):this.handleColumnDragWhileAllowingMovement(t,e,i,l,n)}onDragLeave(){this.ensureIntervalCleared(),this.clearHighlighted(),this.lastMovedInfo=null}onDragStop(){this.onDragging(this.lastDraggingEvent,!1,!0,!0),this.ensureIntervalCleared(),this.lastMovedInfo=null}onDragCancel(){this.clearHighlighted(),this.ensureIntervalCleared(),this.lastMovedInfo=null}setColumnsVisible(t,e,i){if(!t)return;const n=t.filter(r=>!r.getColDef().lockVisible);this.columnModel.setColsVisible(n,e,i)}finishColumnMoving(){if(this.clearHighlighted(),!this.lastMovedInfo)return;const{columns:t,toIndex:e}=this.lastMovedInfo;this.columnMoveService.moveColumns(t,e,"uiColumnMoved",!0)}handleColumnDragWhileSuppressingMovement(t,e,i,n,r){const s=this.getAllMovingColumns(t,!0);if(r){const o=this.isAttemptingToPin(s);o&&this.attemptToPinColumns(s,void 0,!0);const{fromLeft:a,xPosition:l}=this.getNormalisedXPositionInfo(s,o)||{};if(a==null||l==null){this.finishColumnMoving();return}this.moveColumnsAfterHighlight({allMovingColumns:s,xPosition:l,fromEnter:e,fakeEvent:i,fromLeft:a})}else{if(!this.dragAndDropService.isDropZoneWithinThisGrid(t))return;this.highlightHoveredColumn(s,n)}}handleColumnDragWhileAllowingMovement(t,e,i,n,r){const s=this.getAllMovingColumns(t),o=this.normaliseDirection(t.hDirection)===1,a=t.dragSource.type===1,l=this.getMoveColumnParams({allMovingColumns:s,isFromHeader:a,xPosition:n,fromLeft:o,fromEnter:e,fakeEvent:i}),u=TU({...l,finished:r});u&&(this.lastMovedInfo=u)}getAllMovingColumns(t,e=!1){const i=t.dragSource.getDragItem();let n=null;e?(n=i.columnsInSplit,n||(n=i.columns)):n=i.columns;const r=s=>s.getColDef().lockPinned?s.getPinned()==this.pinned:!0;return n?n.filter(r):[]}getMoveColumnParams(t){const{allMovingColumns:e,isFromHeader:i,xPosition:n,fromLeft:r,fromEnter:s,fakeEvent:o}=t,{pinned:a,gos:l,columnModel:u,columnMoveService:d,visibleColsService:p}=this;return{allMovingColumns:e,isFromHeader:i,fromLeft:r,xPosition:n,pinned:a,fromEnter:s,fakeEvent:o,gos:l,columnModel:u,columnMoveService:d,visibleColsService:p}}findFirstAndLastMovingColumns(t){const e=t.length;let i,n;for(let r=0;r<=e;r++){if(!i){const s=t[r];s.getLeft()!=null&&(i=s)}if(!n){const s=t[e-1-r];s.getLeft()!=null&&(n=s)}if(i&&n)break}return{firstMovingCol:i,lastMovingCol:n}}highlightHoveredColumn(t,e){const{gos:i,columnModel:n}=this,r=i.get("enableRtl"),s=n.getCols().filter(d=>d.isVisible()&&d.getPinned()===this.pinned);let o=null,a=null,l=null;for(const d of s){if(a=d.getActualWidth(),o=this.getNormalisedColumnLeft(d,0,r),o!=null){const p=o+a;if(o<=e&&p>=e){l=d;break}}o=null,a=null}if(l)t.indexOf(l)!==-1&&(l=null);else{for(let d=s.length-1;d>=0;d--){const p=s[d],v=s[d].getParent();if(!v){l=p;break}const y=v?.getDisplayedLeafColumns();if(y.length){l=Yn(y);break}}if(!l)return;o=this.getNormalisedColumnLeft(l,0,r),a=l.getActualWidth()}if(this.lastHighlightedColumn?.column!==l&&this.clearHighlighted(),l==null||o==null||a==null)return;let u;e-o<a/2!==r?u=0:u=1,l.setHighlighted(u),this.lastHighlightedColumn={column:l,position:u}}getNormalisedXPositionInfo(t,e){const{gos:i,visibleColsService:n}=this,r=i.get("enableRtl"),{firstMovingCol:s,column:o,position:a}=this.getColumnMoveAndTargetInfo(t,e,r);if(!s||!o||a==null)return;const l=n.getAllCols(),u=l.indexOf(s),d=l.indexOf(o),p=a===0!==r,v=u<d||u===d&&!p;let y=0;if(p?v&&(y-=1):v||(y+=1),d+y===u)return;const w=l[d+y];if(!w)return;const R=this.getNormalisedColumnLeft(w,20,r);return{fromLeft:v,xPosition:R}}getColumnMoveAndTargetInfo(t,e,i){const n=this.lastHighlightedColumn||{},{firstMovingCol:r,lastMovingCol:s}=this.findFirstAndLastMovingColumns(t);if(!r||!s||n.column||!e)return{firstMovingCol:r,...n};const a=this.getPinDirection()==="left";return{firstMovingCol:r,position:a?1:0,column:a!==i?r:s}}normaliseDirection(t){if(this.gos.get("enableRtl"))switch(t){case 0:return 1;case 1:return 0}return t}getNormalisedColumnLeft(t,e,i){const{gos:n,ctrlsService:r}=this,s=t.getLeft();if(s==null)return null;const o=t.getActualWidth();return DT({x:i?s+o-e:s+e,pinned:t.getPinned(),useHeaderRow:i,skipScrollPadding:!0,gos:n,ctrlsService:r})}isAttemptingToPin(t){const e=this.needToMoveLeft||this.needToMoveRight,i=this.failedMoveAttempts>p6;return e&&i||t.some(n=>n.getPinned()!==this.pinned)}moveColumnsAfterHighlight(t){const{allMovingColumns:e,xPosition:i,fromEnter:n,fakeEvent:r,fromLeft:s}=t,o=this.getMoveColumnParams({allMovingColumns:e,isFromHeader:!0,xPosition:i,fromLeft:s,fromEnter:n,fakeEvent:r}),{columns:a,toIndex:l}=TJ(o)||{};a&&l!=null&&(this.lastMovedInfo={columns:a,toIndex:l}),this.finishColumnMoving()}clearHighlighted(){this.lastHighlightedColumn&&(this.lastHighlightedColumn.column.setHighlighted(null),this.lastHighlightedColumn=null)}checkCenterForScrolling(t){if(!this.isCenterContainer)return;const e=this.ctrlsService.get("center"),i=e.getCenterViewportScrollLeft(),n=i+e.getCenterWidth();this.gos.get("enableRtl")?(this.needToMoveRight=t<i+q1,this.needToMoveLeft=t>n-q1):(this.needToMoveLeft=t<i+q1,this.needToMoveRight=t>n-q1),this.needToMoveLeft||this.needToMoveRight?this.ensureIntervalStarted():this.ensureIntervalCleared()}ensureIntervalStarted(){this.movingIntervalId||(this.intervalCount=0,this.failedMoveAttempts=0,this.movingIntervalId=window.setInterval(this.moveInterval.bind(this),h_e),this.dragAndDropService.getDragAndDropImageComponent()?.setIcon(this.needToMoveLeft?"left":"right",!0))}ensureIntervalCleared(){this.movingIntervalId&&(window.clearInterval(this.movingIntervalId),this.movingIntervalId=null,this.failedMoveAttempts=0,this.dragAndDropService.getDragAndDropImageComponent()?.setIcon(this.getIconName()))}moveInterval(){let t;this.intervalCount++,t=10+this.intervalCount*u_e,t>Tz&&(t=Tz);let e=null;const i=this.gridBodyCon.getScrollFeature();if(this.needToMoveLeft?e=i.scrollHorizontally(-t):this.needToMoveRight&&(e=i.scrollHorizontally(t)),e!==0)this.onDragging(this.lastDraggingEvent),this.failedMoveAttempts=0;else{if(this.failedMoveAttempts++,this.failedMoveAttempts<=p6+1)return;if(this.dragAndDropService.getDragAndDropImageComponent()?.setIcon("pinned"),!this.gos.get("suppressMoveWhenColumnDragging")){const n=this.lastDraggingEvent?.dragItem.columns;this.attemptToPinColumns(n,void 0,!0)}}}getPinDirection(){if(this.needToMoveLeft||this.pinned==="left")return"left";if(this.needToMoveRight||this.pinned==="right")return"right"}attemptToPinColumns(t,e,i=!1){const n=(t||[]).filter(r=>!r.getColDef().lockPinned);return n.length?(i&&(e=this.getPinDirection()),this.columnModel.setColsPinned(n,e,"uiColumnDragged"),i&&this.dragAndDropService.nudge(),n.length):0}destroy(){super.destroy(),this.lastDraggingEvent=null,this.clearHighlighted(),this.lastMovedInfo=null}},f_e=class extends kt{wireBeans(t){this.dragAndDropService=t.dragAndDropService,this.columnModel=t.columnModel,this.ctrlsService=t.ctrlsService}constructor(t,e){super(),this.pinned=t,this.eContainer=e}postConstruct(){this.ctrlsService.whenReady(this,t=>{switch(this.pinned){case"left":this.eSecondaryContainers=[[t.gridBodyCtrl.getBodyViewportElement(),t.left.getContainerElement()],[t.bottomLeft.getContainerElement()],[t.topLeft.getContainerElement()]];break;case"right":this.eSecondaryContainers=[[t.gridBodyCtrl.getBodyViewportElement(),t.right.getContainerElement()],[t.bottomRight.getContainerElement()],[t.topRight.getContainerElement()]];break;default:this.eSecondaryContainers=[[t.gridBodyCtrl.getBodyViewportElement(),t.center.getViewportElement()],[t.bottomCenter.getViewportElement()],[t.topCenter.getViewportElement()]];break}}),this.moveColumnFeature=this.createManagedBean(new d_e(this.pinned)),this.bodyDropPivotTarget=this.createManagedBean(new s_e(this.pinned)),this.dragAndDropService.addDropTarget(this),this.addDestroyFunc(()=>this.dragAndDropService.removeDropTarget(this))}isInterestedIn(t){return t===1||t===0&&this.gos.get("allowDragFromColumnsToolPanel")}getSecondaryContainers(){return this.eSecondaryContainers}getContainer(){return this.eContainer}getIconName(){return this.currentDropListener.getIconName()}isDropColumnInPivotMode(t){return this.columnModel.isPivotMode()&&t.dragSource.type===0}onDragEnter(t){this.currentDropListener=this.isDropColumnInPivotMode(t)?this.bodyDropPivotTarget:this.moveColumnFeature,this.currentDropListener.onDragEnter(t)}onDragLeave(t){this.currentDropListener.onDragLeave(t)}onDragging(t){this.currentDropListener.onDragging(t)}onDragStop(t){this.currentDropListener.onDragStop(t)}onDragCancel(){this.currentDropListener.onDragCancel()}},p_e=class extends kt{wireBeans(t){this.horizontalResizeService=t.horizontalResizeService,this.pinnedWidthService=t.pinnedWidthService,this.ctrlsService=t.ctrlsService,this.columnSizeService=t.columnSizeService,this.columnAutosizeService=t.columnAutosizeService}constructor(t,e,i,n,r){super(),this.pinned=t,this.column=e,this.eResize=i,this.comp=n,this.ctrl=r}postConstruct(){const t=[];let e,i;const n=()=>{if(Xr(this.eResize,e),!e)return;const o=this.horizontalResizeService.addResizeBar({eResizeBar:this.eResize,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this,!1),onResizeEnd:this.onResizing.bind(this,!0)});if(t.push(o),i){const a=this.gos.get("skipHeaderOnAutoSize"),l=()=>{this.columnAutosizeService.autoSizeColumn(this.column,"uiColumnResized",a)};this.eResize.addEventListener("dblclick",l);const u=new mp(this.eResize);u.addEventListener("doubleTap",l),t.push(()=>{this.eResize.removeEventListener("dblclick",l),u.removeEventListener("doubleTap",l),u.destroy()})}},r=()=>{t.forEach(o=>o()),t.length=0},s=()=>{const o=this.column.isResizable(),a=!this.gos.get("suppressAutoSize")&&!this.column.getColDef().suppressAutoSize;(o!==e||a!==i)&&(e=o,i=a,r(),n())};s(),this.addDestroyFunc(r),this.ctrl.setRefreshFunction("resize",s)}onResizing(t,e){const{column:i,lastResizeAmount:n,resizeStartWidth:r}=this,s=this.normaliseResizeAmount(e),o=r+s,a=[{key:i,newWidth:o}];if(this.column.getPinned()){const l=this.pinnedWidthService.getPinnedLeftWidth(),u=this.pinnedWidthService.getPinnedRightWidth(),d=zC(this.ctrlsService.getGridBodyCtrl().getBodyViewportElement())-50;if(l+u+(s-n)>d)return}this.lastResizeAmount=s,this.columnSizeService.setColumnWidths(a,this.resizeWithShiftKey,t,"uiColumnResized"),t&&this.toggleColumnResizing(!1)}onResizeStart(t){this.resizeStartWidth=this.column.getActualWidth(),this.lastResizeAmount=0,this.resizeWithShiftKey=t,this.toggleColumnResizing(!0)}toggleColumnResizing(t){this.comp.addOrRemoveCssClass("ag-column-resizing",t)}normaliseResizeAmount(t){let e=t;const i=this.pinned!=="left",n=this.pinned==="right";return this.gos.get("enableRtl")?i&&(e*=-1):n&&(e*=-1),e}},m_e=class extends kt{constructor(t){super(),this.cbSelectAllVisible=!1,this.processingEventFromCheckbox=!1,this.column=t}wireBeans(t){this.rowModel=t.rowModel,this.selectionService=t.selectionService}onSpaceKeyDown(t){const e=this.cbSelectAll;e.isDisplayed()&&!e.getGui().contains(Jr(this.gos))&&(t.preventDefault(),e.setValue(!e.getValue()))}getCheckboxGui(){return this.cbSelectAll.getGui()}setComp(t){this.headerCellCtrl=t,this.cbSelectAll=this.createManagedBean(new pU),this.cbSelectAll.addCssClass("ag-header-select-all"),nc(this.cbSelectAll.getGui(),"presentation"),this.showOrHideSelectAll(),this.addManagedEventListeners({newColumnsLoaded:this.onNewColumnsLoaded.bind(this),displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this),selectionChanged:this.onSelectionChanged.bind(this),paginationChanged:this.onSelectionChanged.bind(this),modelUpdated:this.onModelChanged.bind(this)}),this.addManagedListeners(this.cbSelectAll,{fieldValueChanged:this.onCbSelectAll.bind(this)}),this.cbSelectAll.getInputElement().setAttribute("tabindex","-1"),this.refreshSelectAllLabel()}onNewColumnsLoaded(){this.showOrHideSelectAll()}onDisplayedColumnsChanged(){this.isAlive()&&this.showOrHideSelectAll()}showOrHideSelectAll(){this.cbSelectAllVisible=this.isCheckboxSelection(),this.cbSelectAll.setDisplayed(this.cbSelectAllVisible),this.cbSelectAllVisible&&(this.checkRightRowModelType("selectAllCheckbox"),this.checkSelectionType("selectAllCheckbox"),this.updateStateOfCheckbox()),this.refreshSelectAllLabel()}onModelChanged(){this.cbSelectAllVisible&&this.updateStateOfCheckbox()}onSelectionChanged(){this.cbSelectAllVisible&&this.updateStateOfCheckbox()}updateStateOfCheckbox(){if(this.processingEventFromCheckbox)return;this.processingEventFromCheckbox=!0;const t=this.selectionService.getSelectAllState(this.isFilteredOnly(),this.isCurrentPageOnly());this.cbSelectAll.setValue(t);const e=this.selectionService.hasNodesToSelect(this.isFilteredOnly(),this.isCurrentPageOnly());this.cbSelectAll.setDisabled(!e),this.refreshSelectAllLabel(),this.processingEventFromCheckbox=!1}refreshSelectAllLabel(){const t=this.localeService.getLocaleTextFunc(),i=this.cbSelectAll.getValue()?t("ariaChecked","checked"):t("ariaUnchecked","unchecked"),n=t("ariaRowSelectAll","Press Space to toggle all rows selection");this.cbSelectAllVisible?this.headerCellCtrl.setAriaDescriptionProperty("selectAll",`${n} (${i})`):this.headerCellCtrl.setAriaDescriptionProperty("selectAll",null),this.cbSelectAll.setInputAriaLabel(t("ariaHeaderSelection","Column with Header Selection")),this.headerCellCtrl.announceAriaDescription()}checkSelectionType(t){return eU(this.gos)?!0:(Wt(`${t} is only available if using 'multiRow' selection mode.`),!1)}checkRightRowModelType(t){return ls(this.gos)||tf(this.gos)?!0:(Wt(`${t} is only available if using 'clientSide' or 'serverSide' rowModelType, you are using ${this.rowModel.getType()}.`),!1)}onCbSelectAll(){if(this.processingEventFromCheckbox||!this.cbSelectAllVisible)return;const t=this.cbSelectAll.getValue(),e=this.isFilteredOnly(),i=this.isCurrentPageOnly();let n="uiSelectAll";i?n="uiSelectAllCurrentPage":e&&(n="uiSelectAllFiltered");const r={source:n,justFiltered:e,justCurrentPage:i};t?this.selectionService.selectAllRowNodes(r):this.selectionService.deselectAllRowNodes(r)}isCheckboxSelection(){const t=this.gos.get("rowSelection"),e=typeof t=="object"&&CT(t)&&NC(this.column),i=this.column.getColDef().headerCheckboxSelection;let n=!1;return e?n=!0:typeof i=="function"?n=i(this.gos.addGridCommonParams({column:this.column,colDef:this.column.getColDef()})):n=!!i,n&&this.checkRightRowModelType(e?"headerCheckbox":"headerCheckboxSelection")&&this.checkSelectionType(e?"headerCheckbox":"headerCheckboxSelection")}isFilteredOnly(){const t=this.gos.get("rowSelection");return typeof t=="object"?t.mode==="multiRow"&&t.selectAll==="filtered":!!this.column.getColDef().headerCheckboxSelectionFilteredOnly}isCurrentPageOnly(){const t=this.gos.get("rowSelection");return typeof t=="object"?t.mode==="multiRow"&&t.selectAll==="currentPage":!!this.column.getColDef().headerCheckboxSelectionCurrentPageOnly}},g_e=class extends _P{constructor(t,e,i){super(t,e,i),this.refreshFunctions={},this.userHeaderClasses=new Set,this.ariaDescriptionProperties=new Map,this.column=t}setComp(t,e,i,n,r){this.comp=t,r=BC(this,this.beans.context,r),this.setGui(e,r),this.updateState(),this.setupWidth(r),this.setupMovingCss(r),this.setupMenuClass(r),this.setupSortableClass(r),this.setupWrapTextClass(),this.refreshSpanHeaderHeight(),this.setupAutoHeight({wrapperElement:n,checkMeasuringCallback:o=>this.setRefreshFunction("measuring",o),compBean:r}),this.addColumnHoverListener(r),this.setupFilterClass(r),this.setupClassesFromColDef(),this.setupTooltip(r),this.addActiveHeaderMouseListeners(r),this.setupSelectAll(r),this.setupUserComp(r),this.refreshAria(),this.resizeFeature=r.createManagedBean(new p_e(this.getPinned(),this.column,i,t,this)),r.createManagedBean(new _U([this.column],e)),r.createManagedBean(new wU(this.column,e,this.beans)),r.createManagedBean(new Kg(e,{shouldStopEventPropagation:o=>this.shouldStopEventPropagation(o),onTabKeyDown:()=>null,handleKeyDown:this.handleKeyDown.bind(this),onFocusIn:this.onFocusIn.bind(this),onFocusOut:this.onFocusOut.bind(this)})),this.addResizeAndMoveKeyboardListeners(r),r.addManagedPropertyListeners(["suppressMovableColumns","suppressMenuHide","suppressAggFuncInHeader"],()=>this.refresh(r)),r.addManagedListeners(this.column,{colDefChanged:()=>this.refresh(r)}),r.addManagedListeners(this.column,{headerHighlightChanged:this.onHeaderHighlightChanged.bind(this)});const s=()=>this.checkDisplayName(r);r.addManagedEventListeners({columnValueChanged:s,columnRowGroupChanged:s,columnPivotChanged:s,headerHeightChanged:this.onHeaderHeightChanged.bind(this)}),r.addDestroyFunc(()=>{this.refreshFunctions={},this.selectAllFeature=null,this.dragSourceElement=void 0,this.userCompDetails=null,this.userHeaderClasses.clear(),this.ariaDescriptionProperties.clear(),this.clearComponent()})}resizeHeader(t,e){if(!this.column.isResizable())return;const i=this.column.getActualWidth(),n=this.column.getMinWidth(),r=this.column.getMaxWidth(),s=Math.min(Math.max(i+t,n),r);this.beans.columnSizeService.setColumnWidths([{key:this.column,newWidth:s}],e,!0,"uiColumnResized")}moveHeader(t){const{eGui:e,beans:i,column:n,ctrlsService:r}=this,{gos:s,columnModel:o,columnMoveService:a,visibleColsService:l}=i,u=this.getPinned(),d=e.getBoundingClientRect().left,p=n.getActualWidth(),v=s.get("enableRtl"),w=DT({x:t===0!==v?d-20:d+p+20,pinned:u,fromKeyboard:!0,gos:s,ctrlsService:r}),R=this.focusService.getFocusedHeader();TU({allMovingColumns:[n],isFromHeader:!0,fromLeft:t===1,xPosition:w,pinned:u,fromEnter:!1,fakeEvent:!1,gos:s,columnModel:o,columnMoveService:a,visibleColsService:l,finished:!0}),r.getGridBodyCtrl().getScrollFeature().ensureColumnVisible(n,"auto"),(!this.isAlive()||this.beans.gos.get("ensureDomOrder"))&&R&&this.restoreFocus(R)}restoreFocus(t){this.focusService.focusHeaderPosition({headerPosition:{...t,column:this.column}})}setupUserComp(t){const e=this.lookupUserCompDetails(t);this.setCompDetails(e)}setCompDetails(t){this.userCompDetails=t,this.comp.setUserCompDetails(t)}lookupUserCompDetails(t){const e=this.createParams(t),i=this.column.getColDef();return this.userComponentFactory.getHeaderCompDetails(i,e)}createParams(t){return this.gos.addGridCommonParams({column:this.column,displayName:this.displayName,enableSorting:this.column.isSortable(),enableMenu:this.menuEnabled,enableFilterButton:this.openFilterEnabled&&this.menuService.isHeaderFilterButtonEnabled(this.column),enableFilterIcon:!this.openFilterEnabled||this.menuService.isLegacyMenuEnabled(),showColumnMenu:i=>{this.menuService.showColumnMenu({column:this.column,buttonElement:i,positionBy:"button"})},showColumnMenuAfterMouseClick:i=>{this.menuService.showColumnMenu({column:this.column,mouseEvent:i,positionBy:"mouse"})},showFilter:i=>{this.menuService.showFilterMenu({column:this.column,buttonElement:i,containerType:"columnFilter",positionBy:"button"})},progressSort:i=>{this.beans.sortController.progressSort(this.column,!!i,"uiColumnSorted")},setSort:(i,n)=>{this.beans.sortController.setSortForColumn(this.column,i,!!n,"uiColumnSorted")},eGridHeader:this.getGui(),setTooltip:(i,n)=>{this.setupTooltip(t,i,n)}})}setupSelectAll(t){this.selectAllFeature=t.createManagedBean(new m_e(this.column)),this.selectAllFeature.setComp(this)}getSelectAllGui(){return this.selectAllFeature.getCheckboxGui()}handleKeyDown(t){super.handleKeyDown(t),t.key===St.SPACE&&this.selectAllFeature.onSpaceKeyDown(t),t.key===St.ENTER&&this.onEnterKeyDown(t),t.key===St.DOWN&&t.altKey&&this.showMenuOnKeyPress(t,!1)}onEnterKeyDown(t){if(t.ctrlKey||t.metaKey)this.showMenuOnKeyPress(t,!0);else if(this.sortable){const e=t.shiftKey;this.beans.sortController.progressSort(this.column,e,"uiColumnSorted")}}showMenuOnKeyPress(t,e){const i=this.comp.getUserCompInstance();!i||!(i instanceof Cz)||i.onMenuKeyboardShortcut(e)&&t.preventDefault()}onFocusIn(t){if(!this.getGui().contains(t.relatedTarget)){const e=this.getRowIndex();this.focusService.setFocusedHeader(e,this.column),this.announceAriaDescription()}this.focusService.isKeyboardMode()&&this.setActiveHeader(!0)}onFocusOut(t){this.getGui().contains(t.relatedTarget)||this.setActiveHeader(!1)}setupTooltip(t,e,i){this.tooltipFeature&&(this.tooltipFeature=this.destroyBean(this.tooltipFeature));const n=this.gos.get("tooltipShowMode")==="whenTruncated",r=this.eGui,s=this.column.getColDef();!i&&n&&!s.headerComponent&&(i=()=>{const l=r.querySelector(".ag-header-cell-text");return l?l.scrollWidth>l.clientWidth:!0});const o={getColumn:()=>this.column,getColDef:()=>this.column.getColDef(),getGui:()=>r,getLocation:()=>"header",getTooltipValue:()=>e??this.column.getColDef().headerTooltip,shouldDisplayTooltip:i},a=t.createManagedBean(new nx(o));this.setRefreshFunction("tooltip",()=>a.refreshToolTip())}setupClassesFromColDef(){const t=()=>{const e=this.column.getColDef(),i=yJ(e,this.gos,this.column,null),n=this.userHeaderClasses;this.userHeaderClasses=new Set(i),i.forEach(r=>{n.has(r)?n.delete(r):this.comp.addOrRemoveCssClass(r,!0)}),n.forEach(r=>this.comp.addOrRemoveCssClass(r,!1))};this.setRefreshFunction("headerClasses",t),t()}setDragSource(t){if(this.dragSourceElement=t,this.removeDragSource(),!t||!this.draggable)return;const{column:e,beans:i,displayName:n,dragAndDropService:r,gos:s}=this,{columnModel:o}=i;let a=!this.gos.get("suppressDragLeaveHidesColumns");const l=this.dragSource={type:1,eElement:t,getDefaultIconName:()=>a?"hide":"notAllowed",getDragItem:()=>this.createDragItem(e),dragItemName:n,onDragStarted:()=>{a=!s.get("suppressDragLeaveHidesColumns"),t0([e],!0)},onDragStopped:()=>t0([e],!1),onDragCancelled:()=>t0([e],!1),onGridEnter:u=>{if(a){const d=u?.columns?.filter(p=>!p.getColDef().lockVisible)||[];o.setColsVisible(d,!0,"uiColumnMoved")}},onGridExit:u=>{if(a){const d=u?.columns?.filter(p=>!p.getColDef().lockVisible)||[];o.setColsVisible(d,!1,"uiColumnMoved")}}};r.addDragSource(l,!0)}createDragItem(t){const e={};return e[t.getId()]=t.isVisible(),{columns:[t],visibleState:e}}updateState(){this.menuEnabled=this.menuService.isColumnMenuInHeaderEnabled(this.column),this.openFilterEnabled=this.menuService.isFilterMenuInHeaderEnabled(this.column),this.sortable=this.column.isSortable(),this.displayName=this.calculateDisplayName(),this.draggable=this.workOutDraggable()}setRefreshFunction(t,e){this.refreshFunctions[t]=e}refresh(t){this.updateState(),this.refreshHeaderComp(t),this.refreshAria(),Object.values(this.refreshFunctions).forEach(e=>e())}refreshHeaderComp(t){const e=this.lookupUserCompDetails(t);(this.comp.getUserCompInstance()!=null&&this.userCompDetails.componentClass==e.componentClass?this.attemptHeaderCompRefresh(e.params):!1)?this.setDragSource(this.dragSourceElement):this.setCompDetails(e)}attemptHeaderCompRefresh(t){const e=this.comp.getUserCompInstance();return!e||!e.refresh?!1:e.refresh(t)}calculateDisplayName(){return this.beans.columnNameService.getDisplayNameForColumn(this.column,"header",!0)}checkDisplayName(t){this.displayName!==this.calculateDisplayName()&&this.refresh(t)}workOutDraggable(){const t=this.column.getColDef();return!!(!this.gos.get("suppressMovableColumns")&&!t.suppressMovable&&!t.lockPosition)||!!t.enableRowGroup||!!t.enablePivot}setupWidth(t){const e=()=>{const i=this.column.getActualWidth();this.comp.setWidth(`${i}px`)};t.addManagedListeners(this.column,{widthChanged:e}),e()}setupMovingCss(t){const e=()=>{this.comp.addOrRemoveCssClass("ag-header-cell-moving",this.column.isMoving())};t.addManagedListeners(this.column,{movingChanged:e}),e()}setupMenuClass(t){const e=()=>{this.comp.addOrRemoveCssClass("ag-column-menu-visible",this.column.isMenuVisible())};t.addManagedListeners(this.column,{menuVisibleChanged:e}),e()}setupSortableClass(t){const e=()=>{this.comp.addOrRemoveCssClass("ag-header-cell-sortable",!!this.sortable)};e(),this.setRefreshFunction("updateSortable",e),t.addManagedEventListeners({sortChanged:this.refreshAriaSort.bind(this)})}setupFilterClass(t){const e=()=>{const i=this.column.isFilterActive();this.comp.addOrRemoveCssClass("ag-header-cell-filtered",i),this.refreshAria()};t.addManagedListeners(this.column,{filterActiveChanged:e}),e()}setupWrapTextClass(){const t=()=>{const e=!!this.column.getColDef().wrapHeaderText;this.comp.addOrRemoveCssClass("ag-header-cell-wrap-text",e)};t(),this.setRefreshFunction("wrapText",t)}onHeaderHighlightChanged(){const t=this.column.getHighlighted(),e=t===0,i=t===1;this.comp.addOrRemoveCssClass("ag-header-highlight-before",e),this.comp.addOrRemoveCssClass("ag-header-highlight-after",i)}onDisplayedColumnsChanged(){super.onDisplayedColumnsChanged(),this.isAlive()&&this.onHeaderHeightChanged()}onHeaderHeightChanged(){this.refreshSpanHeaderHeight()}refreshSpanHeaderHeight(){const{eGui:t,column:e,comp:i,beans:n}=this,r=this.beans.columnModel.getGroupRowsHeight(),s=r.reduce((p,v)=>p+=v,0)===0;if(i.addOrRemoveCssClass("ag-header-parent-hidden",s),!e.isSpanHeaderHeight()){t.style.removeProperty("top"),t.style.removeProperty("height"),i.addOrRemoveCssClass("ag-header-span-height",!1),i.addOrRemoveCssClass("ag-header-span-total",!1);return}const{numberOfParents:o,isSpanningTotal:a}=this.column.getColumnGroupPaddingInfo();i.addOrRemoveCssClass("ag-header-span-height",o>0);const{columnModel:l}=n,u=l.getColumnHeaderRowHeight();if(o===0){i.addOrRemoveCssClass("ag-header-span-total",!1),t.style.setProperty("top","0px"),t.style.setProperty("height",`${u}px`);return}i.addOrRemoveCssClass("ag-header-span-total",a);let d=0;for(let p=0;p<o;p++)d+=r[r.length-1-p];t.style.setProperty("top",`${-d}px`),t.style.setProperty("height",`${u+d}px`)}refreshAriaSort(){if(this.sortable){const t=this.localeService.getLocaleTextFunc(),e=this.beans.sortController.getDisplaySortForColumn(this.column)||null;this.comp.setAriaSort(Sxe(e)),this.setAriaDescriptionProperty("sort",t("ariaSortableColumn","Press ENTER to sort"))}else this.comp.setAriaSort(),this.setAriaDescriptionProperty("sort",null)}refreshAriaMenu(){if(this.menuEnabled){const t=this.localeService.getLocaleTextFunc();this.setAriaDescriptionProperty("menu",t("ariaMenuColumn","Press ALT DOWN to open column menu"))}else this.setAriaDescriptionProperty("menu",null)}refreshAriaFilterButton(){if(this.openFilterEnabled&&!this.menuService.isLegacyMenuEnabled()){const t=this.localeService.getLocaleTextFunc();this.setAriaDescriptionProperty("filterButton",t("ariaFilterColumn","Press CTRL ENTER to open filter"))}else this.setAriaDescriptionProperty("filterButton",null)}refreshAriaFiltered(){const t=this.localeService.getLocaleTextFunc();this.column.isFilterActive()?this.setAriaDescriptionProperty("filter",t("ariaColumnFiltered","Column Filtered")):this.setAriaDescriptionProperty("filter",null)}setAriaDescriptionProperty(t,e){e!=null?this.ariaDescriptionProperties.set(t,e):this.ariaDescriptionProperties.delete(t)}announceAriaDescription(){if(!this.eGui.contains(Jr(this.beans.gos)))return;const t=Array.from(this.ariaDescriptionProperties.keys()).sort((e,i)=>e==="filter"?-1:i.charCodeAt(0)-e.charCodeAt(0)).map(e=>this.ariaDescriptionProperties.get(e)).join(". ");this.beans.ariaAnnouncementService.announceValue(t,"columnHeader")}refreshAria(){this.refreshAriaSort(),this.refreshAriaMenu(),this.refreshAriaFilterButton(),this.refreshAriaFiltered()}addColumnHoverListener(t){const e=()=>{if(!this.gos.get("columnHoverHighlight"))return;const i=this.beans.columnHoverService.isHovered(this.column);this.comp.addOrRemoveCssClass("ag-column-hover",i)};t.addManagedEventListeners({columnHoverChanged:e}),e()}getColId(){return this.column.getColId()}addActiveHeaderMouseListeners(t){const e=r=>this.handleMouseOverChange(r.type==="mouseenter"),i=()=>this.dispatchColumnMouseEvent("columnHeaderClicked",this.column),n=r=>this.handleContextMenuMouseEvent(r,void 0,this.column);t.addManagedListeners(this.getGui(),{mouseenter:e,mouseleave:e,click:i,contextmenu:n})}handleMouseOverChange(t){this.setActiveHeader(t),this.eventService.dispatchEvent({type:t?"columnHeaderMouseOver":"columnHeaderMouseLeave",column:this.column})}setActiveHeader(t){this.comp.addOrRemoveCssClass("ag-header-active",t)}getAnchorElementForMenu(t){const e=this.comp.getUserCompInstance();return e instanceof Cz?e.getAnchorElementForMenu(t):this.getGui()}destroy(){super.destroy()}},v_e=class extends kt{wireBeans(t){this.horizontalResizeService=t.horizontalResizeService,this.autoWidthCalculator=t.autoWidthCalculator,this.visibleColsService=t.visibleColsService,this.columnSizeService=t.columnSizeService,this.columnAutosizeService=t.columnAutosizeService}constructor(t,e,i,n){super(),this.eResize=e,this.comp=t,this.pinned=i,this.columnGroup=n}postConstruct(){if(!this.columnGroup.isResizable()){this.comp.setResizableDisplayed(!1);return}const t=this.horizontalResizeService.addResizeBar({eResizeBar:this.eResize,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this,!1),onResizeEnd:this.onResizing.bind(this,!0)});if(this.addDestroyFunc(t),!this.gos.get("suppressAutoSize")){const e=this.gos.get("skipHeaderOnAutoSize");this.eResize.addEventListener("dblclick",()=>{const i=[];this.columnGroup.getDisplayedLeafColumns().forEach(r=>{r.getColDef().suppressAutoSize||i.push(r.getColId())}),i.length>0&&this.columnAutosizeService.autoSizeCols({colKeys:i,skipHeader:e,stopAtGroup:this.columnGroup,source:"uiColumnResized"}),this.resizeLeafColumnsToFit("uiColumnResized")})}}onResizeStart(t){const e=this.getInitialValues(t);this.storeLocalValues(e),this.toggleColumnResizing(!0)}onResizing(t,e,i="uiColumnResized"){const n=this.normaliseDragChange(e),r=this.resizeStartWidth+n;this.resizeColumnsFromLocalValues(r,i,t)}getInitialValues(t){const e=this.getColumnsToResize(),i=this.getInitialSizeOfColumns(e),n=this.getSizeRatiosOfColumns(e,i),r={columnsToResize:e,resizeStartWidth:i,resizeRatios:n};let s=null;if(t&&(s=this.visibleColsService.getGroupAtDirection(this.columnGroup,"After")),s){const o=s.getDisplayedLeafColumns(),a=r.groupAfterColumns=o.filter(u=>u.isResizable()),l=r.groupAfterStartWidth=this.getInitialSizeOfColumns(a);r.groupAfterRatios=this.getSizeRatiosOfColumns(a,l)}else r.groupAfterColumns=void 0,r.groupAfterStartWidth=void 0,r.groupAfterRatios=void 0;return r}storeLocalValues(t){const{columnsToResize:e,resizeStartWidth:i,resizeRatios:n,groupAfterColumns:r,groupAfterStartWidth:s,groupAfterRatios:o}=t;this.resizeCols=e,this.resizeStartWidth=i,this.resizeRatios=n,this.resizeTakeFromCols=r,this.resizeTakeFromStartWidth=s,this.resizeTakeFromRatios=o}clearLocalValues(){this.resizeCols=void 0,this.resizeRatios=void 0,this.resizeTakeFromCols=void 0,this.resizeTakeFromRatios=void 0}resizeLeafColumnsToFit(t){const e=this.autoWidthCalculator.getPreferredWidthForColumnGroup(this.columnGroup),i=this.getInitialValues();e>i.resizeStartWidth&&this.resizeColumns(i,e,t,!0)}resizeColumnsFromLocalValues(t,e,i=!0){if(!this.resizeCols||!this.resizeRatios)return;const n={columnsToResize:this.resizeCols,resizeStartWidth:this.resizeStartWidth,resizeRatios:this.resizeRatios,groupAfterColumns:this.resizeTakeFromCols??void 0,groupAfterStartWidth:this.resizeTakeFromStartWidth??void 0,groupAfterRatios:this.resizeTakeFromRatios??void 0};this.resizeColumns(n,t,e,i)}resizeColumns(t,e,i,n=!0){const{columnsToResize:r,resizeStartWidth:s,resizeRatios:o,groupAfterColumns:a,groupAfterStartWidth:l,groupAfterRatios:u}=t,d=[];if(d.push({columns:r,ratios:o,width:e}),a){const p=e-s;d.push({columns:a,ratios:u,width:l-p})}this.columnSizeService.resizeColumnSets({resizeSets:d,finished:n,source:i}),n&&this.toggleColumnResizing(!1)}toggleColumnResizing(t){this.comp.addOrRemoveCssClass("ag-column-resizing",t)}getColumnsToResize(){return this.columnGroup.getDisplayedLeafColumns().filter(e=>e.isResizable())}getInitialSizeOfColumns(t){return t.reduce((e,i)=>e+i.getActualWidth(),0)}getSizeRatiosOfColumns(t,e){return t.map(i=>i.getActualWidth()/e)}normaliseDragChange(t){let e=t;return this.gos.get("enableRtl")?this.pinned!=="left"&&(e*=-1):this.pinned==="right"&&(e*=-1),e}destroy(){super.destroy(),this.clearLocalValues()}},y_e=class extends kt{constructor(t,e){super(),this.removeChildListenersFuncs=[],this.columnGroup=e,this.comp=t}postConstruct(){this.addListenersToChildrenColumns(),this.addManagedListeners(this.columnGroup,{displayedChildrenChanged:this.onDisplayedChildrenChanged.bind(this)}),this.onWidthChanged(),this.addDestroyFunc(this.removeListenersOnChildrenColumns.bind(this))}addListenersToChildrenColumns(){this.removeListenersOnChildrenColumns();const t=this.onWidthChanged.bind(this);this.columnGroup.getLeafColumns().forEach(e=>{e.addEventListener("widthChanged",t),e.addEventListener("visibleChanged",t),this.removeChildListenersFuncs.push(()=>{e.removeEventListener("widthChanged",t),e.removeEventListener("visibleChanged",t)})})}removeListenersOnChildrenColumns(){this.removeChildListenersFuncs.forEach(t=>t()),this.removeChildListenersFuncs=[]}onDisplayedChildrenChanged(){this.addListenersToChildrenColumns(),this.onWidthChanged()}onWidthChanged(){const t=this.columnGroup.getActualWidth();this.comp.setWidth(`${t}px`),this.comp.addOrRemoveCssClass("ag-hidden",t===0)}},x_e=class extends _P{constructor(t,e,i){super(t,e,i),this.onSuppressColMoveChange=()=>{if(!this.isAlive()||this.isSuppressMoving())this.removeDragSource();else if(!this.dragSource){const n=this.getGui();this.setDragSource(n)}},this.column=t}setComp(t,e,i,n,r){this.comp=t,r=BC(this,this.beans.context,r),this.setGui(e,r),this.displayName=this.beans.columnNameService.getDisplayNameForColumnGroup(this.column,"header"),this.addClasses(),this.setupMovingCss(r),this.setupExpandable(r),this.setupTooltip(r),this.setupAutoHeight({wrapperElement:n,compBean:r}),this.setupUserComp(r),this.addHeaderMouseListeners(r),this.addManagedPropertyListener("groupHeaderHeight",this.refreshMaxHeaderHeight.bind(this)),this.refreshMaxHeaderHeight();const s=this.getParentRowCtrl().getPinned(),o=this.column.getProvidedColumnGroup().getLeafColumns();r.createManagedBean(new _U(o,e)),r.createManagedBean(new wU(this.column,e,this.beans)),r.createManagedBean(new y_e(t,this.column)),this.resizeFeature=r.createManagedBean(new v_e(t,i,s,this.column)),r.createManagedBean(new Kg(e,{shouldStopEventPropagation:this.shouldStopEventPropagation.bind(this),onTabKeyDown:()=>{},handleKeyDown:this.handleKeyDown.bind(this),onFocusIn:this.onFocusIn.bind(this)})),this.addHighlightListeners(r,o),r.addManagedPropertyListener("suppressMovableColumns",this.onSuppressColMoveChange),this.addResizeAndMoveKeyboardListeners(r),r.addDestroyFunc(()=>this.clearComponent())}refreshMaxHeaderHeight(){const{gos:t,comp:e}=this,i=t.get("groupHeaderHeight");i!=null?i===0?e.setHeaderWrapperHidden(!0):e.setHeaderWrapperMaxHeight(i):(e.setHeaderWrapperHidden(!1),e.setHeaderWrapperMaxHeight(null))}addHighlightListeners(t,e){if(this.beans.gos.get("suppressMoveWhenColumnDragging"))for(const i of e)t.addManagedListeners(i,{headerHighlightChanged:this.onLeafColumnHighlightChanged.bind(this,i)})}onLeafColumnHighlightChanged(t){const e=this.column.getDisplayedLeafColumns(),i=e[0]===t,n=Yn(e)===t;if(!i&&!n)return;const r=t.getHighlighted(),s=!!this.getParentRowCtrl().findHeaderCellCtrl(l=>l.getColumnGroupChild().isMoving());let o=!1,a=!1;if(s){const l=this.beans.gos.get("enableRtl"),u=r===1,d=r===0;i&&(l?a=u:o=d),n&&(l?o=d:a=u)}this.comp.addOrRemoveCssClass("ag-header-highlight-before",o),this.comp.addOrRemoveCssClass("ag-header-highlight-after",a)}getColumn(){return this.column}resizeHeader(t,e){if(!this.resizeFeature)return;const i=this.resizeFeature.getInitialValues(e);this.resizeFeature.resizeColumns(i,i.resizeStartWidth+t,"uiColumnResized",!0)}moveHeader(t){const{beans:e,eGui:i,column:n,ctrlsService:r}=this,{gos:s,columnModel:o,columnMoveService:a,visibleColsService:l}=e,u=s.get("enableRtl"),d=t===0,p=this.getPinned(),v=i.getBoundingClientRect(),y=v.left,w=v.width,R=DT({x:d!==u?y-20:y+w+20,pinned:p,fromKeyboard:!0,gos:s,ctrlsService:r}),O=n.getGroupId(),P=this.focusService.getFocusedHeader();TU({allMovingColumns:this.column.getLeafColumns(),isFromHeader:!0,fromLeft:t===1,xPosition:R,pinned:p,fromEnter:!1,fakeEvent:!1,gos:s,columnModel:o,columnMoveService:a,visibleColsService:l,finished:!0});const N=n.getDisplayedLeafColumns(),F=d?N[0]:Yn(N);this.ctrlsService.getGridBodyCtrl().getScrollFeature().ensureColumnVisible(F,"auto"),(!this.isAlive()||this.beans.gos.get("ensureDomOrder"))&&P&&this.restoreFocus(O,n,P)}restoreFocus(t,e,i){const n=e.getLeafColumns();if(!n.length)return;const r=n[0].getParent();if(!r)return;const s=this.findGroupWidthId(r,t);s&&this.focusService.focusHeaderPosition({headerPosition:{...i,column:s}})}findGroupWidthId(t,e){for(;t;){if(t.getGroupId()===e)return t;t=t.getParent()}return null}resizeLeafColumnsToFit(t){this.resizeFeature&&this.resizeFeature.resizeLeafColumnsToFit(t)}setupUserComp(t){const e=this.gos.addGridCommonParams({displayName:this.displayName,columnGroup:this.column,setExpanded:n=>{this.beans.columnModel.setColumnGroupOpened(this.column.getProvidedColumnGroup(),n,"gridInitializing")},setTooltip:(n,r)=>{this.setupTooltip(t,n,r)}}),i=this.userComponentFactory.getHeaderGroupCompDetails(e);this.comp.setUserCompDetails(i)}addHeaderMouseListeners(t){const e=r=>this.handleMouseOverChange(r.type==="mouseenter"),i=()=>this.dispatchColumnMouseEvent("columnHeaderClicked",this.column.getProvidedColumnGroup()),n=r=>this.handleContextMenuMouseEvent(r,void 0,this.column.getProvidedColumnGroup());t.addManagedListeners(this.getGui(),{mouseenter:e,mouseleave:e,click:i,contextmenu:n})}handleMouseOverChange(t){this.eventService.dispatchEvent({type:t?"columnHeaderMouseOver":"columnHeaderMouseLeave",column:this.column.getProvidedColumnGroup()})}setupTooltip(t,e,i){this.tooltipFeature&&(this.tooltipFeature=this.destroyBean(this.tooltipFeature));const n=this.column.getColGroupDef(),r=this.gos.get("tooltipShowMode")==="whenTruncated",s=this.eGui;!i&&r&&!n?.headerGroupComponent&&(i=()=>{const a=s.querySelector(".ag-header-group-text");return a?a.scrollWidth>a.clientWidth:!0});const o={getColumn:()=>this.column,getGui:()=>s,getLocation:()=>"headerGroup",getTooltipValue:()=>e??(n&&n.headerTooltip),shouldDisplayTooltip:i};n&&(o.getColDef=()=>n),t.createManagedBean(new nx(o))}setupExpandable(t){const e=this.column.getProvidedColumnGroup();this.refreshExpanded();const i=this.refreshExpanded.bind(this);t.addManagedListeners(e,{expandedChanged:i,expandableChanged:i})}refreshExpanded(){const{column:t}=this;this.expandable=t.isExpandable();const e=t.isExpanded();this.expandable?this.comp.setAriaExpanded(e?"true":"false"):this.comp.setAriaExpanded(void 0)}getColId(){return this.column.getUniqueId()}addClasses(){const t=this.column.getColGroupDef(),e=yJ(t,this.gos,null,this.column);this.column.isPadding()?(e.push("ag-header-group-cell-no-group"),this.column.getLeafColumns().every(n=>n.isSpanHeaderHeight())&&e.push("ag-header-span-height")):(e.push("ag-header-group-cell-with-group"),t?.wrapHeaderText&&e.push("ag-header-cell-wrap-text")),e.forEach(i=>this.comp.addOrRemoveCssClass(i,!0))}setupMovingCss(t){const i=this.column.getProvidedColumnGroup().getLeafColumns(),n=()=>this.comp.addOrRemoveCssClass("ag-header-cell-moving",this.column.isMoving());i.forEach(r=>{t.addManagedListeners(r,{movingChanged:n})}),n()}onFocusIn(t){if(!this.eGui.contains(t.relatedTarget)){const e=this.getRowIndex();this.beans.focusService.setFocusedHeader(e,this.column)}}handleKeyDown(t){super.handleKeyDown(t);const e=this.getWrapperHasFocus();if(!(!this.expandable||!e)&&t.key===St.ENTER){const i=this.column,n=!i.isExpanded();this.beans.columnModel.setColumnGroupOpened(i.getProvidedColumnGroup(),n,"uiColumnExpanded")}}setDragSource(t){if(!this.isAlive()||this.isSuppressMoving()||(this.removeDragSource(),!t))return;const{beans:e,column:i,displayName:n,gos:r,dragAndDropService:s}=this,{columnModel:o}=e,a=i.getProvidedColumnGroup().getLeafColumns();let l=!r.get("suppressDragLeaveHidesColumns");const u=this.dragSource={type:1,eElement:t,getDefaultIconName:()=>l?"hide":"notAllowed",dragItemName:n,getDragItem:()=>this.getDragItemForGroup(i),onDragStarted:()=>{l=!r.get("suppressDragLeaveHidesColumns"),t0(a,!0)},onDragStopped:()=>t0(a,!1),onDragCancelled:()=>t0(a,!1),onGridEnter:d=>{if(l){const{columns:p=[],visibleState:v}=d??{},y=p.filter(w=>!w.getColDef().lockVisible&&(!v||v[w.getColId()]));o.setColsVisible(y,!0,"uiColumnMoved")}},onGridExit:d=>{if(l){const p=d?.columns?.filter(v=>!v.getColDef().lockVisible)||[];o.setColsVisible(p,!1,"uiColumnMoved")}}};s.addDragSource(u,!0)}getDragItemForGroup(t){const e=t.getProvidedColumnGroup().getLeafColumns(),i={};e.forEach(o=>i[o.getId()]=o.isVisible());const n=[];this.beans.visibleColsService.getAllCols().forEach(o=>{e.indexOf(o)>=0&&(n.push(o),Na(e,o))}),e.forEach(o=>n.push(o));const r=[],s=t.getLeafColumns();for(const o of n)s.indexOf(o)!==-1&&r.push(o);return{columns:n,columnsInSplit:r,visibleState:i}}isSuppressMoving(){let t=!1;return this.column.getLeafColumns().forEach(i=>{(i.getColDef().suppressMovable||i.getColDef().lockPosition)&&(t=!0)}),t||this.gos.get("suppressMovableColumns")}destroy(){super.destroy()}},b_e=0,sN=class extends kt{constructor(t,e,i){super(),this.instanceId=b_e++,this.rowIndex=t,this.pinned=e,this.type=i;const n=i=="group"?"ag-header-row-column-group":i=="filter"?"ag-header-row-column-filter":"ag-header-row-column";this.headerRowClass=`ag-header-row ${n}`}wireBeans(t){this.beans=t}postConstruct(){this.isPrintLayout=Zo(this.gos,"print"),this.isEnsureDomOrder=this.gos.get("ensureDomOrder")}areCellsRendered(){return this.comp?this.getHeaderCellCtrls().every(t=>t.getGui()!=null):!1}setComp(t,e,i=!0){this.comp=t,e=BC(this,this.beans.context,e),i&&(this.onRowHeightChanged(),this.onVirtualColumnsChanged()),this.setWidth(),this.addEventListeners(e)}getHeaderRowClass(){return this.headerRowClass}getAriaRowIndex(){return this.rowIndex+1}addEventListeners(t){const e=this.onRowHeightChanged.bind(this);t.addManagedEventListeners({columnResized:this.onColumnResized.bind(this),displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this),virtualColumnsChanged:i=>this.onVirtualColumnsChanged(i.afterScroll),columnGroupHeaderHeightChanged:e,columnHeaderHeightChanged:e,gridStylesChanged:e,advancedFilterEnabledChanged:e}),t.addManagedPropertyListener("domLayout",this.onDisplayedColumnsChanged.bind(this)),t.addManagedPropertyListener("ensureDomOrder",i=>this.isEnsureDomOrder=i.currentValue),t.addManagedPropertyListeners(["headerHeight","pivotHeaderHeight","groupHeaderHeight","pivotGroupHeaderHeight","floatingFiltersHeight"],e)}getHeaderCellCtrl(t){if(this.headerCellCtrls)return OM(this.headerCellCtrls).find(e=>e.getColumnGroupChild()===t)}onDisplayedColumnsChanged(){this.isPrintLayout=Zo(this.gos,"print"),this.onVirtualColumnsChanged(),this.setWidth(),this.onRowHeightChanged()}getType(){return this.type}onColumnResized(){this.setWidth()}setWidth(){const t=this.getWidthForRow();this.comp.setWidth(`${t}px`)}getWidthForRow(){const{visibleColsService:t}=this.beans;return this.isPrintLayout?this.pinned!=null?0:t.getContainerWidth("right")+t.getContainerWidth("left")+t.getContainerWidth(null):t.getContainerWidth(this.pinned)}onRowHeightChanged(){const{topOffset:t,rowHeight:e}=this.getTopAndHeight();this.comp.setTop(t+"px"),this.comp.setHeight(e+"px")}getTopAndHeight(){const{columnModel:t,filterManager:e}=this.beans,i=[],n=t.getGroupRowsHeight(),r=t.getColumnHeaderRowHeight();i.push(...n),i.push(r),e?.hasFloatingFilters()&&i.push(t.getFloatingFiltersHeight());let s=0;for(let a=0;a<this.rowIndex;a++)s+=i[a];const o=i[this.rowIndex];return{topOffset:s,rowHeight:o}}getPinned(){return this.pinned}getRowIndex(){return this.rowIndex}onVirtualColumnsChanged(t=!1){const e=this.getHeaderCtrls(),i=this.isEnsureDomOrder||this.isPrintLayout;this.comp.setHeaderCtrls(e,i,t)}getHeaderCtrls(){const t=this.headerCellCtrls;this.headerCellCtrls=new Map;const e=this.getColumnsInViewport();for(const n of e)this.recycleAndCreateHeaderCtrls(n,t);const i=n=>{const{focusService:r,visibleColsService:s}=this.beans;return r.isHeaderWrapperFocused(n)?s.isVisible(n.getColumnGroupChild()):!1};if(t)for(const[n,r]of t)i(r)?this.headerCellCtrls.set(n,r):this.destroyBean(r);return this.getHeaderCellCtrls()}getHeaderCellCtrls(){return Array.from(this.headerCellCtrls?.values()??[])}recycleAndCreateHeaderCtrls(t,e){if(!this.headerCellCtrls||t.isEmptyGroup())return;const i=t.getUniqueId();let n;if(e&&(n=e.get(i),e.delete(i)),n&&n.getColumnGroupChild()!=t&&(this.destroyBean(n),n=void 0),n==null)switch(this.type){case"filter":{n=this.createBean(this.beans.ctrlsFactory.getInstance("headerFilterCell",t,this.beans,this));break}case"group":n=this.createBean(new x_e(t,this.beans,this));break;default:n=this.createBean(new g_e(t,this.beans,this));break}this.headerCellCtrls.set(i,n)}getColumnsInViewport(){return this.isPrintLayout?this.getColumnsInViewportPrintLayout():this.getColumnsInViewportNormalLayout()}getColumnsInViewportPrintLayout(){if(this.pinned!=null)return[];let t=[];const e=this.getActualDepth(),{columnViewportService:i}=this.beans;return["left",null,"right"].forEach(n=>{const r=i.getHeadersToRender(n,e);t=t.concat(r)}),t}getActualDepth(){return this.type=="filter"?this.rowIndex-1:this.rowIndex}getColumnsInViewportNormalLayout(){return this.beans.columnViewportService.getHeadersToRender(this.pinned,this.getActualDepth())}findHeaderCellCtrl(t){if(!this.headerCellCtrls)return;const e=this.getHeaderCellCtrls();let i;return typeof t=="function"?i=e.find(t):i=e.find(n=>n.getColumnGroupChild()==t),i}focusHeader(t,e){const i=this.findHeaderCellCtrl(t);return i?i.focus(e):!1}destroy(){this.headerCellCtrls?.forEach(t=>{this.destroyBean(t)}),this.headerCellCtrls=void 0,super.destroy()}},w_e=class extends kt{constructor(t){super(),this.hidden=!1,this.includeFloatingFilter=!1,this.groupsRowCtrls=[],this.pinned=t}wireBeans(t){this.ctrlsService=t.ctrlsService,this.scrollVisibleService=t.scrollVisibleService,this.pinnedWidthService=t.pinnedWidthService,this.columnModel=t.columnModel,this.focusService=t.focusService,this.filterManager=t.filterManager}setComp(t,e){this.comp=t,this.eViewport=e,this.setupCenterWidth(),this.setupPinnedWidth(),this.setupDragAndDrop(this.eViewport);const i=this.onDisplayedColumnsChanged.bind(this);this.addManagedEventListeners({gridColumnsChanged:this.onGridColumnsChanged.bind(this),displayedColumnsChanged:i,advancedFilterEnabledChanged:i});const n=`${typeof this.pinned=="string"?this.pinned:"center"}Header`;this.ctrlsService.register(n,this),this.columnModel.isReady()&&this.refresh()}getAllCtrls(){const t=[...this.groupsRowCtrls];return this.columnsRowCtrl&&t.push(this.columnsRowCtrl),this.filtersRowCtrl&&t.push(this.filtersRowCtrl),t}refresh(t=!1){const e=new M0,i=this.focusService.getFocusHeaderToUseAfterRefresh(),n=()=>{const a=this.columnModel.getHeaderRowCount()-1;this.groupsRowCtrls=this.destroyBeans(this.groupsRowCtrls);for(let l=0;l<a;l++){const u=this.createBean(new sN(e.next(),this.pinned,"group"));this.groupsRowCtrls.push(u)}},r=()=>{const a=e.next(),l=!this.hidden&&(this.columnsRowCtrl==null||!t||this.columnsRowCtrl.getRowIndex()!==a);(l||this.hidden)&&(this.columnsRowCtrl=this.destroyBean(this.columnsRowCtrl)),l&&(this.columnsRowCtrl=this.createBean(new sN(a,this.pinned,"column")))},s=()=>{this.includeFloatingFilter=!!this.filterManager?.hasFloatingFilters()&&!this.hidden;const a=()=>{this.filtersRowCtrl=this.destroyBean(this.filtersRowCtrl)};if(!this.includeFloatingFilter){a();return}const l=e.next();if(this.filtersRowCtrl){const u=this.filtersRowCtrl.getRowIndex()!==l;(!t||u)&&a()}this.filtersRowCtrl||(this.filtersRowCtrl=this.createBean(new sN(l,this.pinned,"filter")))};n(),r(),s();const o=this.getAllCtrls();this.comp.setCtrls(o),this.restoreFocusOnHeader(i)}getHeaderCtrlForColumn(t){if(Tp(t))return this.columnsRowCtrl?.getHeaderCellCtrl(t);if(this.groupsRowCtrls.length!==0)for(let e=0;e<this.groupsRowCtrls.length;e++){const i=this.groupsRowCtrls[e].getHeaderCellCtrl(t);if(i)return i}}getHtmlElementForColumnHeader(t){const e=this.getHeaderCtrlForColumn(t);return e?e.getGui():null}getRowType(t){const i=this.getAllCtrls()[t];return i?i.getType():void 0}focusHeader(t,e,i){const r=this.getAllCtrls()[t];return r?r.focusHeader(e,i):!1}getViewportElement(){return this.eViewport}getGroupRowCount(){return this.groupsRowCtrls.length}getGroupRowCtrlAtIndex(t){return this.groupsRowCtrls[t]}getRowCount(){return this.groupsRowCtrls.length+(this.columnsRowCtrl?1:0)+(this.filtersRowCtrl?1:0)}setHorizontalScroll(t){this.comp.setViewportScrollLeft(t)}onScrollCallback(t){this.addManagedElementListeners(this.getViewportElement(),{scroll:t})}destroy(){this.filtersRowCtrl&&(this.filtersRowCtrl=this.destroyBean(this.filtersRowCtrl)),this.columnsRowCtrl&&(this.columnsRowCtrl=this.destroyBean(this.columnsRowCtrl)),this.groupsRowCtrls&&this.groupsRowCtrls.length&&(this.groupsRowCtrls=this.destroyBeans(this.groupsRowCtrls)),super.destroy()}setupDragAndDrop(t){const e=new f_e(this.pinned,t);this.createManagedBean(e)}restoreFocusOnHeader(t){if(!t)return;const{column:e}=t;e.getPinned()==this.pinned&&this.focusService.focusHeaderPosition({headerPosition:t})}onGridColumnsChanged(){this.refresh(!0)}onDisplayedColumnsChanged(){const t=this.filterManager?.hasFloatingFilters()&&!this.hidden;this.includeFloatingFilter!==t&&this.refresh(!0)}setupCenterWidth(){this.pinned==null&&this.createManagedBean(new MU(t=>this.comp.setCenterWidth(`${t}px`),!0))}setupPinnedWidth(){if(this.pinned==null)return;const t=this.pinned==="left",e=this.pinned==="right";this.hidden=!0;const i=()=>{const n=t?this.pinnedWidthService.getPinnedLeftWidth():this.pinnedWidthService.getPinnedRightWidth();if(n==null)return;const r=n==0,s=this.hidden!==r,o=this.gos.get("enableRtl"),a=this.scrollVisibleService.getScrollbarWidth(),u=this.scrollVisibleService.isVerticalScrollShowing()&&(o&&t||!o&&e)?n+a:n;this.comp.setPinnedContainerWidth(`${u}px`),this.comp.setDisplayed(!r),s&&(this.hidden=r,this.refresh())};this.addManagedEventListeners({leftPinnedWidthChanged:i,rightPinnedWidthChanged:i,scrollVisibilityChanged:i,scrollbarWidthChanged:i})}},__e='<div class="ag-pinned-left-header" role="rowgroup"></div>',C_e='<div class="ag-pinned-right-header" role="rowgroup"></div>',S_e=`<div class="ag-header-viewport" role="presentation">
        <div class="ag-header-container" data-ref="eCenterContainer" role="rowgroup"></div>
    </div>`,oN=class extends ir{constructor(t){super(),this.eCenterContainer=bi,this.headerRowComps={},this.rowCompsList=[],this.pinned=t}postConstruct(){this.selectAndSetTemplate();const t={setDisplayed:i=>this.setDisplayed(i),setCtrls:i=>this.setCtrls(i),setCenterWidth:i=>this.eCenterContainer.style.width=i,setViewportScrollLeft:i=>this.getGui().scrollLeft=i,setPinnedContainerWidth:i=>{const n=this.getGui();n.style.width=i,n.style.maxWidth=i,n.style.minWidth=i}};this.createManagedBean(new w_e(this.pinned)).setComp(t,this.getGui())}selectAndSetTemplate(){const t=this.pinned=="left",e=this.pinned=="right",i=t?__e:e?C_e:S_e;this.setTemplate(i),this.eRowContainer=this.eCenterContainer!==bi?this.eCenterContainer:this.getGui()}destroy(){this.setCtrls([]),super.destroy()}destroyRowComp(t){this.destroyBean(t),this.eRowContainer.removeChild(t.getGui())}setCtrls(t){const e=this.headerRowComps;this.headerRowComps={},this.rowCompsList=[];let i;const n=r=>{const s=r.getGui();s.parentElement!=this.eRowContainer&&this.eRowContainer.appendChild(s),i&&VY(this.eRowContainer,s,i),i=s};t.forEach(r=>{const s=r.instanceId,o=e[s];delete e[s];const a=o||this.createBean(new i_e(r));this.headerRowComps[s]=a,this.rowCompsList.push(a),n(a)}),Fg(e).forEach(r=>this.destroyRowComp(r))}},O_e=class extends ir{constructor(){super('<div class="ag-header" role="presentation"/>')}postConstruct(){const t={addOrRemoveCssClass:(n,r)=>this.addOrRemoveCssClass(n,r),setHeightAndMinHeight:n=>{this.getGui().style.height=n,this.getGui().style.minHeight=n}};this.createManagedBean(new r_e).setComp(t,this.getGui(),this.getFocusableElement());const i=n=>{this.createManagedBean(n),this.appendChild(n)};i(new oN("left")),i(new oN(null)),i(new oN("right"))}},M_e={selector:"AG-HEADER-ROOT",component:O_e},RU=class extends kt{constructor(t){super(),this.view=t}postConstruct(){this.addManagedPropertyListener("domLayout",this.updateLayoutClasses.bind(this)),this.updateLayoutClasses()}updateLayoutClasses(){const t=this.getDomLayout(),e={autoHeight:t==="autoHeight",normal:t==="normal",print:t==="print"},i=e.autoHeight?"ag-layout-auto-height":e.print?"ag-layout-print":"ag-layout-normal";this.view.updateLayoutClasses(i,e)}getDomLayout(){const t=this.gos.get("domLayout")??"normal";return["normal","print","autoHeight"].indexOf(t)===-1?(Wt(`${t} is not valid for DOM Layout, valid values are 'normal', 'autoHeight', 'print'.`),"normal"):t}},T_e=class extends ir{constructor(){super(`
            <div class="ag-overlay" role="presentation">
                <div class="ag-overlay-panel" role="presentation">
                    <div class="ag-overlay-wrapper" data-ref="eOverlayWrapper" role="presentation"></div>
                </div>
            </div>`),this.eOverlayWrapper=bi,this.activePromise=null,this.activeOverlay=null,this.updateListenerDestroyFunc=null,this.activeOverlayWrapperCssClass=null,this.elToFocusAfter=null}wireBeans(t){this.overlayService=t.overlayService,this.focusService=t.focusService,this.visibleColsService=t.visibleColsService}handleKeyDown(t){if(t.key!==St.TAB||t.defaultPrevented||Ed(t)||this.focusService.findNextFocusableElement(this.eOverlayWrapper,!1,t.shiftKey))return;let i=!1;t.shiftKey?i=this.focusService.focusGridView(Yn(this.visibleColsService.getAllCols()),!0,!1):i=this.focusService.focusNextGridCoreContainer(!1),i&&t.preventDefault()}updateLayoutClasses(t,e){const i=this.eOverlayWrapper.classList;i.toggle("ag-layout-auto-height",e.autoHeight),i.toggle("ag-layout-normal",e.normal),i.toggle("ag-layout-print",e.print)}postConstruct(){this.createManagedBean(new RU(this)),this.setDisplayed(!1,{skipAriaHidden:!0}),this.overlayService.setOverlayWrapperComp(this),this.addManagedElementListeners(this.getFocusableElement(),{keydown:this.handleKeyDown.bind(this)})}setWrapperTypeClass(t){const e=this.eOverlayWrapper.classList;this.activeOverlayWrapperCssClass&&e.toggle(this.activeOverlayWrapperCssClass,!1),this.activeOverlayWrapperCssClass=t,e.toggle(t,!0)}showOverlay(t,e,i,n){if(this.setWrapperTypeClass(e),this.destroyActiveOverlay(),this.elToFocusAfter=null,this.activePromise=t,!!t){if(this.setDisplayed(!0,{skipAriaHidden:!0}),i&&this.focusService.isGridFocused()){const r=Jr(this.gos);r&&!cY(this.gos)&&(this.elToFocusAfter=r)}t.then(r=>{if(this.activePromise!==t){this.activeOverlay!==r&&(this.destroyBean(r),r=null);return}if(this.activePromise=null,!r)return;if(this.activeOverlay!==r&&(this.eOverlayWrapper.appendChild(r.getGui()),this.activeOverlay=r,n)){const o=r;this.updateListenerDestroyFunc=this.addManagedPropertyListener(n,({currentValue:a})=>{o.refresh?.(this.gos.addGridCommonParams({...a??{}}))})}const s=this.focusService;i&&s.isGridFocused()&&s.focusInto(this.eOverlayWrapper)})}}updateOverlayWrapperPaddingTop(t){this.eOverlayWrapper.style.setProperty("padding-top",`${t}px`)}destroyActiveOverlay(){this.activePromise=null;const t=this.activeOverlay;if(!t)return;let e=this.elToFocusAfter;this.activeOverlay=null,this.elToFocusAfter=null,e&&!this.focusService.isGridFocused()&&(e=null);const i=this.updateListenerDestroyFunc;i&&(i(),this.updateListenerDestroyFunc=null),this.destroyBean(t),fa(this.eOverlayWrapper),e?.focus?.({preventScroll:!0})}hideOverlay(){this.destroyActiveOverlay(),this.setDisplayed(!1,{skipAriaHidden:!0})}destroy(){this.elToFocusAfter=null,this.destroyActiveOverlay(),this.overlayService.setOverlayWrapperComp(void 0),super.destroy()}},R_e={selector:"AG-OVERLAY-WRAPPER",component:T_e},RJ=class extends ir{constructor(t,e){super(),this.direction=e,this.eViewport=bi,this.eContainer=bi,this.hideTimeout=null,this.setTemplate(t)}wireBeans(t){this.animationFrameService=t.animationFrameService}postConstruct(){this.addManagedEventListeners({scrollVisibilityChanged:this.onScrollVisibilityChanged.bind(this)}),this.onScrollVisibilityChanged(),this.addOrRemoveCssClass("ag-apple-scrollbar",kY()||Np())}initialiseInvisibleScrollbar(){this.invisibleScrollbar===void 0&&(this.invisibleScrollbar=LY(),this.invisibleScrollbar&&(this.hideAndShowInvisibleScrollAsNeeded(),this.addActiveListenerToggles()))}addActiveListenerToggles(){const t=this.getGui(),e=()=>this.addOrRemoveCssClass("ag-scrollbar-active",!0),i=()=>this.addOrRemoveCssClass("ag-scrollbar-active",!1);this.addManagedListeners(t,{mouseenter:e,mousedown:e,touchstart:e,mouseleave:i,touchend:i})}onScrollVisibilityChanged(){this.invisibleScrollbar===void 0&&this.initialiseInvisibleScrollbar(),this.animationFrameService.requestAnimationFrame(()=>this.setScrollVisible())}hideAndShowInvisibleScrollAsNeeded(){this.addManagedEventListeners({bodyScroll:t=>{t.direction===this.direction&&(this.hideTimeout!==null&&(window.clearTimeout(this.hideTimeout),this.hideTimeout=null),this.addOrRemoveCssClass("ag-scrollbar-scrolling",!0))},bodyScrollEnd:()=>{this.hideTimeout=window.setTimeout(()=>{this.addOrRemoveCssClass("ag-scrollbar-scrolling",!1),this.hideTimeout=null},400)}})}attemptSettingScrollPosition(t){const e=this.getViewportElement();D0e(()=>Ou(e),()=>this.setScrollPosition(t),100)}getViewportElement(){return this.eViewport}getContainer(){return this.eContainer}onScrollCallback(t){this.addManagedElementListeners(this.getViewportElement(),{scroll:t})}},P_e=class extends RJ{constructor(){super(`<div class="ag-body-horizontal-scroll" aria-hidden="true">
            <div class="ag-horizontal-left-spacer" data-ref="eLeftSpacer"></div>
            <div class="ag-body-horizontal-scroll-viewport" data-ref="eViewport">
                <div class="ag-body-horizontal-scroll-container" data-ref="eContainer"></div>
            </div>
            <div class="ag-horizontal-right-spacer" data-ref="eRightSpacer"></div>
        </div>`,"horizontal"),this.eLeftSpacer=bi,this.eRightSpacer=bi}wireBeans(t){super.wireBeans(t),this.visibleColsService=t.visibleColsService,this.pinnedRowModel=t.pinnedRowModel,this.ctrlsService=t.ctrlsService,this.scrollVisibleService=t.scrollVisibleService}postConstruct(){super.postConstruct();const t=this.setFakeHScrollSpacerWidths.bind(this);this.addManagedEventListeners({displayedColumnsChanged:t,displayedColumnsWidthChanged:t,pinnedRowDataChanged:this.onPinnedRowDataChanged.bind(this)}),this.addManagedPropertyListener("domLayout",t),this.ctrlsService.register("fakeHScrollComp",this),this.createManagedBean(new MU(e=>this.eContainer.style.width=`${e}px`)),this.addManagedPropertyListeners(["suppressHorizontalScroll"],this.onScrollVisibilityChanged.bind(this))}initialiseInvisibleScrollbar(){this.invisibleScrollbar===void 0&&(this.enableRtl=this.gos.get("enableRtl"),super.initialiseInvisibleScrollbar(),this.invisibleScrollbar&&this.refreshCompBottom())}onPinnedRowDataChanged(){this.refreshCompBottom()}refreshCompBottom(){if(!this.invisibleScrollbar)return;const t=this.pinnedRowModel.getPinnedBottomTotalHeight();this.getGui().style.bottom=`${t}px`}onScrollVisibilityChanged(){super.onScrollVisibilityChanged(),this.setFakeHScrollSpacerWidths()}setFakeHScrollSpacerWidths(){const t=this.scrollVisibleService.isVerticalScrollShowing();let e=this.visibleColsService.getDisplayedColumnsRightWidth();const i=!this.enableRtl&&t,n=this.scrollVisibleService.getScrollbarWidth();i&&(e+=n),_u(this.eRightSpacer,e),this.eRightSpacer.classList.toggle("ag-scroller-corner",e<=n);let r=this.visibleColsService.getColsLeftWidth();this.enableRtl&&t&&(r+=n),_u(this.eLeftSpacer,r),this.eLeftSpacer.classList.toggle("ag-scroller-corner",r<=n)}setScrollVisible(){const t=this.scrollVisibleService.isHorizontalScrollShowing(),e=this.invisibleScrollbar,i=this.gos.get("suppressHorizontalScroll"),n=t&&this.scrollVisibleService.getScrollbarWidth()||0,s=i?0:n===0&&e?16:n;this.addOrRemoveCssClass("ag-scrollbar-invisible",e),jw(this.getGui(),s),jw(this.eViewport,s),jw(this.eContainer,s),this.setDisplayed(t,{skipAriaHidden:!0})}getScrollPosition(){return ET(this.getViewportElement(),this.enableRtl)}setScrollPosition(t){Ou(this.getViewportElement())||this.attemptSettingScrollPosition(t),AT(this.getViewportElement(),t,this.enableRtl)}},E_e={selector:"AG-FAKE-HORIZONTAL-SCROLL",component:P_e},PJ=class extends kt{wireBeans(t){this.maxDivHeightScaler=t.rowContainerHeightService}constructor(t,e){super(),this.eContainer=t,this.eViewport=e}postConstruct(){this.addManagedEventListeners({rowContainerHeightChanged:this.onHeightChanged.bind(this)})}onHeightChanged(){const t=this.maxDivHeightScaler.getUiContainerHeight(),e=t!=null?`${t}px`:"";this.eContainer.style.height=e,this.eViewport&&(this.eViewport.style.height=e)}},A_e=class extends RJ{wireBeans(t){super.wireBeans(t),this.ctrlsService=t.ctrlsService,this.scrollVisibleService=t.scrollVisibleService}constructor(){super(`<div class="ag-body-vertical-scroll" aria-hidden="true">
            <div class="ag-body-vertical-scroll-viewport" data-ref="eViewport">
                <div class="ag-body-vertical-scroll-container" data-ref="eContainer"></div>
            </div>
        </div>`,"vertical")}postConstruct(){super.postConstruct(),this.createManagedBean(new PJ(this.eContainer)),this.ctrlsService.register("fakeVScrollComp",this),this.addManagedEventListeners({rowContainerHeightChanged:this.onRowContainerHeightChanged.bind(this)})}setScrollVisible(){const t=this.scrollVisibleService.isVerticalScrollShowing(),e=this.invisibleScrollbar,i=t&&this.scrollVisibleService.getScrollbarWidth()||0,n=i===0&&e?16:i;this.addOrRemoveCssClass("ag-scrollbar-invisible",e),_u(this.getGui(),n),_u(this.eViewport,n),_u(this.eContainer,n),this.setDisplayed(t,{skipAriaHidden:!0})}onRowContainerHeightChanged(){const{ctrlsService:t}=this,i=t.getGridBodyCtrl().getBodyViewportElement(),n=this.getScrollPosition(),r=i.scrollTop;n!=r&&this.setScrollPosition(r,!0)}getScrollPosition(){return this.getViewportElement().scrollTop}setScrollPosition(t,e){!e&&!Ou(this.getViewportElement())&&this.attemptSettingScrollPosition(t),this.getViewportElement().scrollTop=t}},I_e={selector:"AG-FAKE-VERTICAL-SCROLL",component:A_e},Rz=(t=>(t.FakeHScrollbar="fakeHScrollComp",t.Header="centerHeader",t.PinnedTop="topCenter",t.PinnedBottom="bottomCenter",t.StickyTop="stickyTopCenter",t.StickyBottom="stickyBottomCenter",t))(Rz||{}),k_e=class extends kt{constructor(t){super(),this.lastScrollSource=[null,null],this.scrollLeft=-1,this.nextScrollTop=-1,this.scrollTop=-1,this.lastOffsetHeight=-1,this.lastScrollTop=-1,this.eBodyViewport=t,this.resetLastHScrollDebounced=Fa(()=>this.lastScrollSource[1]=null,500),this.resetLastVScrollDebounced=Fa(()=>this.lastScrollSource[0]=null,500)}wireBeans(t){this.ctrlsService=t.ctrlsService,this.animationFrameService=t.animationFrameService,this.paginationService=t.paginationService,this.pageBoundsService=t.pageBoundsService,this.rowModel=t.rowModel,this.heightScaler=t.rowContainerHeightService,this.rowRenderer=t.rowRenderer,this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService}postConstruct(){this.enableRtl=this.gos.get("enableRtl"),this.addManagedEventListeners({displayedColumnsWidthChanged:this.onDisplayedColumnsWidthChanged.bind(this)}),this.ctrlsService.whenReady(this,t=>{this.centerRowsCtrl=t.center,this.onDisplayedColumnsWidthChanged(),this.addScrollListener()})}addScrollListener(){this.addHorizontalScrollListeners(),this.addVerticalScrollListeners()}addHorizontalScrollListeners(){this.addManagedElementListeners(this.centerRowsCtrl.getViewportElement(),{scroll:this.onHScroll.bind(this,"Viewport")});for(const t of Object.values(Rz)){const e=this.ctrlsService.get(t);this.registerScrollPartner(e,this.onHScroll.bind(this,t))}}addVerticalScrollListeners(){const t=this.ctrlsService.get("fakeVScrollComp"),e=this.gos.get("debounceVerticalScrollbar"),i=e?Fa(this.onVScroll.bind(this,"Viewport"),100):this.onVScroll.bind(this,"Viewport"),n=e?Fa(this.onVScroll.bind(this,"fakeVScrollComp"),100):this.onVScroll.bind(this,"fakeVScrollComp");this.addManagedElementListeners(this.eBodyViewport,{scroll:i}),this.registerScrollPartner(t,n)}registerScrollPartner(t,e){t.onScrollCallback(e)}onDisplayedColumnsWidthChanged(){this.enableRtl&&this.horizontallyScrollHeaderCenterAndFloatingCenter()}horizontallyScrollHeaderCenterAndFloatingCenter(t){this.centerRowsCtrl!=null&&(t===void 0&&(t=this.centerRowsCtrl.getCenterViewportScrollLeft()),this.setScrollLeftForAllContainersExceptCurrent(Math.abs(t)))}setScrollLeftForAllContainersExceptCurrent(t){for(const e of[...Object.values(Rz),"Viewport"]){if(this.lastScrollSource[1]===e)continue;const i=this.getViewportForSource(e);AT(i,t,this.enableRtl)}}getViewportForSource(t){return t==="Viewport"?this.centerRowsCtrl.getViewportElement():this.ctrlsService.get(t).getViewportElement()}isControllingScroll(t,e){return this.lastScrollSource[e]==null?(e===0?this.lastScrollSource[0]=t:this.lastScrollSource[1]=t,!0):this.lastScrollSource[e]===t}onHScroll(t){if(!this.isControllingScroll(t,1))return;const e=this.centerRowsCtrl.getViewportElement(),{scrollLeft:i}=e;if(this.shouldBlockScrollUpdate(1,i,!0))return;const n=ET(this.getViewportForSource(t),this.enableRtl);this.doHorizontalScroll(n),this.resetLastHScrollDebounced()}onVScroll(t){if(!this.isControllingScroll(t,0))return;let e;t==="Viewport"?e=this.eBodyViewport.scrollTop:e=this.ctrlsService.get("fakeVScrollComp").getScrollPosition(),!this.shouldBlockScrollUpdate(0,e,!0)&&(this.animationFrameService.setScrollTop(e),this.nextScrollTop=e,t==="Viewport"?this.ctrlsService.get("fakeVScrollComp").setScrollPosition(e):this.eBodyViewport.scrollTop=e,this.gos.get("suppressAnimationFrame")?this.scrollGridIfNeeded():this.animationFrameService.schedule(),this.resetLastVScrollDebounced())}doHorizontalScroll(t){const e=this.ctrlsService.get("fakeHScrollComp").getScrollPosition();this.scrollLeft===t&&t===e||(this.scrollLeft=t,this.fireScrollEvent(1),this.horizontallyScrollHeaderCenterAndFloatingCenter(t),this.centerRowsCtrl.onHorizontalViewportChanged(!0))}fireScrollEvent(t){const e={type:"bodyScroll",direction:t===1?"horizontal":"vertical",left:this.scrollLeft,top:this.scrollTop};this.eventService.dispatchEvent(e),window.clearTimeout(this.scrollTimer),this.scrollTimer=void 0,this.scrollTimer=window.setTimeout(()=>{this.eventService.dispatchEvent({...e,type:"bodyScrollEnd"})},100)}shouldBlockScrollUpdate(t,e,i=!1){return i&&!Np()?!1:t===0?this.shouldBlockVerticalScroll(e):this.shouldBlockHorizontalScroll(e)}shouldBlockVerticalScroll(t){const e=uU(this.eBodyViewport),{scrollHeight:i}=this.eBodyViewport;return t<0||t+e>i}shouldBlockHorizontalScroll(t){const e=this.centerRowsCtrl.getCenterWidth(),{scrollWidth:i}=this.centerRowsCtrl.getViewportElement();if(this.enableRtl&&PT()){if(t>0)return!0}else if(t<0)return!0;return Math.abs(t)+e>i}redrawRowsAfterScroll(){this.fireScrollEvent(0)}checkScrollLeft(){this.scrollLeft!==this.centerRowsCtrl.getCenterViewportScrollLeft()&&this.onHScroll("Viewport")}scrollGridIfNeeded(){const t=this.scrollTop!=this.nextScrollTop;return t&&(this.scrollTop=this.nextScrollTop,this.redrawRowsAfterScroll()),t}setHorizontalScrollPosition(t,e=!1){const n=this.centerRowsCtrl.getViewportElement().scrollWidth-this.centerRowsCtrl.getCenterWidth();!e&&this.shouldBlockScrollUpdate(1,t)&&(this.enableRtl&&PT()?t=t>0?0:n:t=Math.min(Math.max(t,0),n)),AT(this.centerRowsCtrl.getViewportElement(),Math.abs(t),this.enableRtl),this.doHorizontalScroll(t)}setVerticalScrollPosition(t){this.eBodyViewport.scrollTop=t}getVScrollPosition(){return this.lastScrollTop=this.eBodyViewport.scrollTop,this.lastOffsetHeight=this.eBodyViewport.offsetHeight,{top:this.lastScrollTop,bottom:this.lastScrollTop+this.lastOffsetHeight}}getApproximateVScollPosition(){return this.lastScrollTop>=0&&this.lastOffsetHeight>=0?{top:this.scrollTop,bottom:this.scrollTop+this.lastOffsetHeight}:this.getVScrollPosition()}getHScrollPosition(){return this.centerRowsCtrl.getHScrollPosition()}isHorizontalScrollShowing(){return this.centerRowsCtrl.isHorizontalScrollShowing()}scrollHorizontally(t){const e=this.centerRowsCtrl.getViewportElement().scrollLeft;return this.setHorizontalScrollPosition(e+t),this.centerRowsCtrl.getViewportElement().scrollLeft-e}scrollToTop(){this.eBodyViewport.scrollTop=0}ensureNodeVisible(t,e=null){const i=this.rowModel.getRowCount();let n=-1;for(let r=0;r<i;r++){const s=this.rowModel.getRow(r);if(typeof t=="function"){if(s&&t(s)){n=r;break}}else if(t===s||t===s.data){n=r;break}}n>=0&&this.ensureIndexVisible(n,e)}ensureIndexVisible(t,e){if(Zo(this.gos,"print"))return;const i=this.rowModel.getRowCount();if(typeof t!="number"||t<0||t>=i){Wt("Invalid row index for ensureIndexVisible: "+t);return}const r=this.gos.get("pagination")&&!this.gos.get("suppressPaginationPanel");this.getFrameworkOverrides().wrapIncoming(()=>{r||this.paginationService?.goToPageWithIndex(t);const s=this.ctrlsService.getGridBodyCtrl(),o=s.getStickyTopHeight(),a=s.getStickyBottomHeight(),l=this.rowModel.getRow(t);let u;do{const d=l.rowTop,p=l.rowHeight,v=this.pageBoundsService.getPixelOffset(),y=l.rowTop-v,w=y+l.rowHeight,R=this.getVScrollPosition(),O=this.heightScaler.getDivStretchOffset(),P=R.top+O,N=R.bottom+O,F=N-P,k=this.heightScaler.getScrollPositionForPixel(y),$=this.heightScaler.getScrollPositionForPixel(w-F),W=Math.min((k+$)/2,y),Q=P+o>y,Y=N-a<w;let M=null;e==="top"?M=k:e==="bottom"?M=$:e==="middle"?M=W:Q?M=k-o:Y&&(M=$+a),M!==null&&(this.setVerticalScrollPosition(M),this.rowRenderer.redraw({afterScroll:!0})),u=d!==l.rowTop||p!==l.rowHeight}while(u);this.animationFrameService.flushAllFrames()})}ensureColumnVisible(t,e="auto"){const i=this.columnModel.getCol(t);if(!i||i.isPinned()||!this.visibleColsService.isColDisplayed(i))return;const n=this.getPositionedHorizontalScroll(i,e);this.getFrameworkOverrides().wrapIncoming(()=>{n!==null&&this.centerRowsCtrl.setCenterViewportScrollLeft(n),this.centerRowsCtrl.onHorizontalViewportChanged(),this.animationFrameService.flushAllFrames()})}setScrollPosition(t,e){this.getFrameworkOverrides().wrapIncoming(()=>{this.centerRowsCtrl.setCenterViewportScrollLeft(e),this.setVerticalScrollPosition(t),this.rowRenderer.redraw({afterScroll:!0}),this.animationFrameService.flushAllFrames()})}getPositionedHorizontalScroll(t,e){const{columnBeforeStart:i,columnAfterEnd:n}=this.isColumnOutsideViewport(t),r=this.centerRowsCtrl.getCenterWidth()<t.getActualWidth(),s=this.centerRowsCtrl.getCenterWidth(),o=this.enableRtl;let a=(o?i:n)||r,l=o?n:i;e!=="auto"&&(a=e==="start",l=e==="end");const u=e==="middle";if(a||l||u){const{colLeft:d,colMiddle:p,colRight:v}=this.getColumnBounds(t);return u?p-s/2:a?o?v:d:o?d-s:v-s}return null}isColumnOutsideViewport(t){const{start:e,end:i}=this.getViewportBounds(),{colLeft:n,colRight:r}=this.getColumnBounds(t),s=this.enableRtl,o=s?e>r:i<r,a=s?i<n:e>n;return{columnBeforeStart:o,columnAfterEnd:a}}getColumnBounds(t){const e=this.enableRtl,i=this.visibleColsService.getBodyContainerWidth(),n=t.getActualWidth(),r=t.getLeft(),s=e?-1:1,o=e?i-r:r,a=o+n*s,l=o+n/2*s;return{colLeft:o,colMiddle:l,colRight:a}}getViewportBounds(){const t=this.centerRowsCtrl.getCenterWidth(),e=this.centerRowsCtrl.getCenterViewportScrollLeft(),i=e,n=t+e;return{start:i,end:n,width:t}}},D_e=class extends kt{wireBeans(t){this.animationFrameService=t.animationFrameService,this.ctrlsService=t.ctrlsService,this.pinnedWidthService=t.pinnedWidthService,this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.columnSizeService=t.columnSizeService,this.scrollVisibleService=t.scrollVisibleService,this.columnViewportService=t.columnViewportService}constructor(t){super(),this.centerContainerCtrl=t}postConstruct(){this.ctrlsService.whenReady(this,t=>{this.gridBodyCtrl=t.gridBodyCtrl,this.listenForResize()}),this.addManagedEventListeners({scrollbarWidthChanged:this.onScrollbarWidthChanged.bind(this)}),this.addManagedPropertyListeners(["alwaysShowHorizontalScroll","alwaysShowVerticalScroll"],()=>{this.checkViewportAndScrolls()})}listenForResize(){const t=()=>{this.animationFrameService.requestAnimationFrame(()=>{this.onCenterViewportResized()})};this.centerContainerCtrl.registerViewportResizeListener(t),this.gridBodyCtrl.registerBodyViewportResizeListener(t)}onScrollbarWidthChanged(){this.checkViewportAndScrolls()}onCenterViewportResized(){if(this.scrollVisibleService.onCentreViewportResized(),this.centerContainerCtrl.isViewportInTheDOMTree()){this.keepPinnedColumnsNarrowerThanViewport(),this.checkViewportAndScrolls();const t=this.centerContainerCtrl.getCenterWidth();t!==this.centerWidth&&(this.centerWidth=t,this.columnSizeService.refreshFlexedColumns({viewportWidth:this.centerWidth,updateBodyWidths:!0,fireResizedEvent:!0}))}else this.bodyHeight=0}keepPinnedColumnsNarrowerThanViewport(){const t=this.gridBodyCtrl.getBodyViewportElement(),e=zC(t);if(e<=50)return;let i=this.getPinnedColumnsOverflowingViewport(e-50);const n=this.gos.getCallback("processUnpinnedColumns");i.length&&(n&&(i=n({columns:i,viewportWidth:e})),this.columnModel.setColsPinned(i,null,"viewportSizeFeature"))}getPinnedColumnsOverflowingViewport(t){const e=this.pinnedWidthService.getPinnedRightWidth(),i=this.pinnedWidthService.getPinnedLeftWidth(),n=e+i;if(n<t)return[];const r=[...this.visibleColsService.getLeftCols()],s=[...this.visibleColsService.getRightCols()];let o=0,a=0;const l=0,u=[];let d=n-l-t;for(;(a<r.length||o<s.length)&&d>0;){if(o<s.length){const p=s[o++];d-=p.getActualWidth(),u.push(p)}if(a<r.length&&d>0){const p=r[a++];d-=p.getActualWidth(),u.push(p)}}return u}checkViewportAndScrolls(){this.updateScrollVisibleService(),this.checkBodyHeight(),this.onHorizontalViewportChanged(),this.gridBodyCtrl.getScrollFeature().checkScrollLeft()}getBodyHeight(){return this.bodyHeight}checkBodyHeight(){const t=this.gridBodyCtrl.getBodyViewportElement(),e=uU(t);this.bodyHeight!==e&&(this.bodyHeight=e,this.eventService.dispatchEvent({type:"bodyHeightChanged"}))}updateScrollVisibleService(){this.updateScrollVisibleServiceImpl(),setTimeout(this.updateScrollVisibleServiceImpl.bind(this),500)}updateScrollVisibleServiceImpl(){const t={horizontalScrollShowing:this.isHorizontalScrollShowing(),verticalScrollShowing:this.gridBodyCtrl.isVerticalScrollShowing()};this.scrollVisibleService.setScrollsVisible(t)}isHorizontalScrollShowing(){return this.centerContainerCtrl.isHorizontalScrollShowing()}onHorizontalViewportChanged(){const t=this.centerContainerCtrl.getCenterWidth(),e=this.centerContainerCtrl.getViewportScrollLeft();this.columnViewportService.setScrollPosition(t,e)}},L_e=class extends kt{wireBeans(t){this.dragService=t.dragService,this.rangeService=t.rangeService}constructor(t){super(),this.eContainer=t}postConstruct(){if(!this.rangeService)return;this.params={eElement:this.eContainer,onDragStart:this.rangeService.onDragStart.bind(this.rangeService),onDragStop:this.rangeService.onDragStop.bind(this.rangeService),onDragging:this.rangeService.onDragging.bind(this.rangeService)},this.addManagedPropertyListeners(["enableRangeSelection","cellSelection"],()=>{Mh(this.gos)?this.enableFeature():this.disableFeature()}),this.addDestroyFunc(()=>this.disableFeature()),Mh(this.gos)&&this.enableFeature()}enableFeature(){this.dragService.addDragSource(this.params)}disableFeature(){this.dragService.removeDragSource(this.params)}},F_e=class extends ir{constructor(){super(`
            <div class="ag-selection-checkbox" role="presentation">
                <ag-checkbox role="presentation" data-ref="eCheckbox"></ag-checkbox>
            </div>`,[mU]),this.eCheckbox=bi}postConstruct(){this.eCheckbox.setPassive(!0)}getCheckboxId(){return this.eCheckbox.getInputElement().id}onDataChanged(){this.onSelectionChanged()}onSelectableChanged(){this.showOrHideSelect()}onSelectionChanged(){const t=this.localeService.getLocaleTextFunc(),e=this.rowNode.isSelected(),i=oU(t,e),[n,r]=this.rowNode.selectable?["ariaRowToggleSelection","Press Space to toggle row selection"]:["ariaRowSelectionDisabled","Row Selection is disabled for this row"],s=t(n,r);this.eCheckbox.setValue(e,!0),this.eCheckbox.setInputAriaLabel(`${s} (${i})`)}onClicked(t,e,i){return this.rowNode.setSelectedParams({newValue:t,rangeSelect:i.shiftKey,groupSelectsFiltered:e,event:i,source:"checkboxSelected"})}init(t){if(this.rowNode=t.rowNode,this.column=t.column,this.overrides=t.overrides,this.onSelectionChanged(),this.addManagedListeners(this.eCheckbox.getInputElement(),{dblclick:n=>S0(n),click:n=>{S0(n);const r=tU(this.gos)==="filteredDescendants",s=this.eCheckbox.getValue();this.shouldHandleIndeterminateState(s,r)?this.onClicked(!0,r,n||{})===0&&this.onClicked(!1,r,n):s?this.onClicked(!1,r,n):this.onClicked(!0,r,n||{})}}),this.addManagedListeners(this.rowNode,{rowSelected:this.onSelectionChanged.bind(this),dataChanged:this.onDataChanged.bind(this),selectableChanged:this.onSelectableChanged.bind(this)}),JG(this.gos)||typeof this.getIsVisible()=="function"){const n=this.showOrHideSelect.bind(this);this.addManagedEventListeners({displayedColumnsChanged:n}),this.addManagedListeners(this.rowNode,{dataChanged:n,cellChanged:n}),this.showOrHideSelect()}this.eCheckbox.getInputElement().setAttribute("tabindex","-1")}shouldHandleIndeterminateState(t,e){return e&&(this.eCheckbox.getPreviousValue()===void 0||t===void 0)&&ls(this.gos)}showOrHideSelect(){let t=this.rowNode.selectable;const e=this.getIsVisible();if(t)if(typeof e=="function"){const r=this.overrides?.callbackParams;if(!this.column)t=e({...r,node:this.rowNode,data:this.rowNode.data});else{const s=this.column.createColumnFunctionCallbackParams(this.rowNode);t=e({...r,...s})}}else t=e??!1;const i=this.gos.get("rowSelection");if(i&&typeof i!="string"?!z0e(i):this.column?.getColDef().showDisabledCheckboxes){this.eCheckbox.setDisabled(!t),this.setVisible(!0),this.setDisplayed(!0);return}if(this.overrides?.removeHidden){this.setDisplayed(t);return}this.setVisible(t)}getIsVisible(){if(this.overrides)return this.overrides.isVisible;const t=this.gos.get("rowSelection");return t&&typeof t!="string"?C0(t):this.column?.getColDef()?.checkboxSelection}},N_e=class extends ir{constructor(t,e,i){super('<div class="ag-drag-handle ag-row-drag" draggable="true"></div>'),this.rowNode=t,this.column=e,this.eCell=i}postConstruct(){this.getGui().appendChild(Ql("rowDrag",this.gos,null)),this.addGuiEventListener("mousedown",e=>{e.stopPropagation()}),this.addDragSource(),this.checkVisibility()}addDragSource(){this.addGuiEventListener("dragstart",this.onDragStart.bind(this))}onDragStart(t){const e=this.column.getColDef().dndSourceOnRowDrag;t.dataTransfer.setDragImage(this.eCell,0,0);const i=()=>{try{const n=JSON.stringify(this.rowNode.data);t.dataTransfer.setData("application/json",n),t.dataTransfer.setData("text/plain",n)}catch{}};if(e){const n=this.gos.addGridCommonParams({rowNode:this.rowNode,dragEvent:t});e(n)}else i()}checkVisibility(){const t=this.column.isDndSource(this.rowNode);this.setDisplayed(t)}},B_e=class extends kt{constructor(t,e){super(),this.staticClasses=[],this.cellCtrl=t,this.beans=e,this.column=t.getColumn(),this.rowNode=t.getRowNode()}setComp(t){this.cellComp=t,this.applyUserStyles(),this.applyCellClassRules(),this.applyClassesFromColDef()}applyCellClassRules(){const t=this.column.getColDef(),{cellClassRules:e}=t,i=this.beans.gos.addGridCommonParams({value:this.cellCtrl.getValue(),data:this.rowNode.data,node:this.rowNode,colDef:t,column:this.column,rowIndex:this.rowNode.rowIndex});this.beans.stylingService.processClassRules(e===this.cellClassRules?void 0:this.cellClassRules,e,i,n=>this.cellComp.addOrRemoveCssClass(n,!0),n=>this.cellComp.addOrRemoveCssClass(n,!1)),this.cellClassRules=e}applyUserStyles(){const t=this.column.getColDef();if(!t.cellStyle)return;let e;if(typeof t.cellStyle=="function"){const i=this.beans.gos.addGridCommonParams({column:this.column,value:this.cellCtrl.getValue(),colDef:t,data:this.rowNode.data,node:this.rowNode,rowIndex:this.rowNode.rowIndex}),n=t.cellStyle;e=n(i)}else e=t.cellStyle;e&&this.cellComp.setUserStyles(e)}applyClassesFromColDef(){const t=this.column.getColDef(),e=this.beans.gos.addGridCommonParams({value:this.cellCtrl.getValue(),data:this.rowNode.data,node:this.rowNode,column:this.column,colDef:t,rowIndex:this.rowNode.rowIndex});this.staticClasses.length&&this.staticClasses.forEach(i=>this.cellComp.addOrRemoveCssClass(i,!1)),this.staticClasses=this.beans.stylingService.getStaticCellClasses(t,e),this.staticClasses.length&&this.staticClasses.forEach(i=>this.cellComp.addOrRemoveCssClass(i,!0))}destroy(){super.destroy()}},z_e=class extends kt{constructor(t,e,i,n,r){super(),this.cellCtrl=t,this.beans=e,this.rowNode=n,this.rowCtrl=r}setComp(t){this.eGui=t}onKeyDown(t){const e=t.key;switch(e){case St.ENTER:this.onEnterKeyDown(t);break;case St.F2:this.onF2KeyDown(t);break;case St.ESCAPE:this.onEscapeKeyDown(t);break;case St.TAB:this.onTabKeyDown(t);break;case St.BACKSPACE:case St.DELETE:this.onBackspaceOrDeleteKeyDown(e,t);break;case St.DOWN:case St.UP:case St.RIGHT:case St.LEFT:this.onNavigationKeyDown(t,e);break}}onNavigationKeyDown(t,e){this.cellCtrl.isEditing()||(t.shiftKey&&this.cellCtrl.isRangeSelectionEnabled()?this.onShiftRangeSelect(t):this.beans.navigationService.navigateToNextCell(t,e,this.cellCtrl.getCellPosition(),!0),t.preventDefault())}onShiftRangeSelect(t){if(!this.beans.rangeService)return;const e=this.beans.rangeService.extendLatestRangeInDirection(t);e&&this.beans.navigationService.ensureCellVisible(e)}onTabKeyDown(t){this.beans.navigationService.onTabKeyDown(this.cellCtrl,t)}onBackspaceOrDeleteKeyDown(t,e){const{cellCtrl:i,beans:n,rowNode:r}=this,{gos:s,rangeService:o,eventService:a}=n;if(!i.isEditing()){if(a.dispatchEvent({type:"keyShortcutChangedCellStart"}),cwe(t,s.get("enableCellEditingOnBackspace"))){if(o&&Mh(s))o.clearCellRangeCellValues({dispatchWrapperEvents:!0,wrapperEventSource:"deleteKey"});else if(i.isCellEditable()){const l=i.getColumn(),u=this.beans.valueService.getDeleteValue(l,r);r.setDataValue(l,u,"cellClear")}}else i.startRowOrCellEdit(t,e);a.dispatchEvent({type:"keyShortcutChangedCellEnd"})}}onEnterKeyDown(t){if(this.cellCtrl.isEditing()||this.rowCtrl.isEditing())this.cellCtrl.stopEditingAndFocus(!1,t.shiftKey);else if(this.beans.gos.get("enterNavigatesVertically")){const e=t.shiftKey?St.UP:St.DOWN;this.beans.navigationService.navigateToNextCell(null,e,this.cellCtrl.getCellPosition(),!1)}else this.cellCtrl.startRowOrCellEdit(St.ENTER,t),this.cellCtrl.isEditing()&&t.preventDefault()}onF2KeyDown(t){this.cellCtrl.isEditing()||this.cellCtrl.startRowOrCellEdit(St.F2,t)}onEscapeKeyDown(t){this.cellCtrl.isEditing()&&(this.cellCtrl.stopRowOrCellEdit(!0),this.cellCtrl.focusCell(!0))}processCharacter(t){if(t.target!==this.eGui||this.cellCtrl.isEditing())return;const n=t.key;n===" "?this.onSpaceKeyDown(t):this.cellCtrl.startRowOrCellEdit(n,t)&&t.preventDefault()}onSpaceKeyDown(t){const{gos:e}=this.beans;if(!this.cellCtrl.isEditing()&&wT(e)){const i=this.rowNode.isSelected(),n=!i,r=tU(e)==="filteredDescendants",s=this.rowNode.setSelectedParams({newValue:n,rangeSelect:t.shiftKey,groupSelectsFiltered:r,event:t,source:"spaceKey"});i===void 0&&s===0&&this.rowNode.setSelectedParams({newValue:!1,rangeSelect:t.shiftKey,groupSelectsFiltered:r,event:t,source:"spaceKey"})}t.preventDefault()}destroy(){super.destroy()}},V_e=class extends kt{constructor(t,e,i){super(),this.cellCtrl=t,this.beans=e,this.column=i}onMouseEvent(t,e){if(!Ed(e))switch(t){case"click":this.onCellClicked(e);break;case"mousedown":case"touchstart":this.onMouseDown(e);break;case"dblclick":this.onCellDoubleClicked(e);break;case"mouseout":this.onMouseOut(e);break;case"mouseover":this.onMouseOver(e);break}}onCellClicked(t){if(this.isDoubleClickOnIPad()){this.onCellDoubleClicked(t),t.preventDefault();return}const{eventService:e,rangeService:i,gos:n}=this.beans,r=t.ctrlKey||t.metaKey;i&&r&&i.getCellRangeCount(this.cellCtrl.getCellPosition())>1&&i.intersectLastRange(!0);const s=this.cellCtrl.createEvent(t,"cellClicked");e.dispatchEvent(s);const o=this.column.getColDef();o.onCellClicked&&window.setTimeout(()=>{this.beans.frameworkOverrides.wrapOutgoing(()=>{o.onCellClicked(s)})},0),(n.get("singleClickEdit")||o.singleClickEdit)&&!n.get("suppressClickEdit")&&!(t.shiftKey&&i?.getCellRanges().length!=0)&&this.cellCtrl.startRowOrCellEdit()}isDoubleClickOnIPad(){if(!Np()||vY("dblclick"))return!1;const t=new Date().getTime(),e=t-this.lastIPadMouseClickEvent<200;return this.lastIPadMouseClickEvent=t,e}onCellDoubleClicked(t){const{column:e,beans:i,cellCtrl:n}=this,{eventService:r,frameworkOverrides:s,gos:o}=i,a=e.getColDef(),l=n.createEvent(t,"cellDoubleClicked");r.dispatchEvent(l),typeof a.onCellDoubleClicked=="function"&&window.setTimeout(()=>{s.wrapOutgoing(()=>{a.onCellDoubleClicked(l)})},0),!o.get("singleClickEdit")&&!o.get("suppressClickEdit")&&n.startRowOrCellEdit(null,t)}onMouseDown(t){const{ctrlKey:e,metaKey:i,shiftKey:n}=t,r=t.target,{cellCtrl:s,beans:o}=this,{eventService:a,rangeService:l,focusService:u,gos:d}=o;if(this.isRightClickInExistingRange(t))return;const p=l&&l.getCellRanges().length!=0;if(!n||!p){const y=d.get("enableCellTextSelection")&&t.defaultPrevented,w=(Th()||y)&&!s.isEditing()&&!cU(r);s.focusCell(w)}if(n&&p&&!u.isCellFocused(s.getCellPosition())){t.preventDefault();const v=u.getFocusedCell();if(v){const{column:y,rowIndex:w,rowPinned:R}=v,P=o.rowRenderer.getRowByPosition({rowIndex:w,rowPinned:R})?.getCellCtrl(y);P?.isEditing()&&P.stopEditing(),u.setFocusedCell({column:y,rowIndex:w,rowPinned:R,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!0})}}if(!this.containsWidget(r)){if(l){const v=this.cellCtrl.getCellPosition();if(n)l.extendLatestRangeToCell(v);else{const y=e||i;l.setRangeToCell(v,y)}}a.dispatchEvent(this.cellCtrl.createEvent(t,"cellMouseDown"))}}isRightClickInExistingRange(t){const{rangeService:e}=this.beans;if(e){const i=e.isCellInAnyRange(this.cellCtrl.getCellPosition()),n=t.button===2||t.ctrlKey&&this.beans.gos.get("allowContextMenuWithControlKey");if(i&&n)return!0}return!1}containsWidget(t){return e0(t,"ag-selection-checkbox",3)}onMouseOut(t){this.mouseStayingInsideCell(t)||(this.beans.eventService.dispatchEvent(this.cellCtrl.createEvent(t,"cellMouseOut")),this.beans.columnHoverService.clearMouseOver())}onMouseOver(t){this.mouseStayingInsideCell(t)||(this.beans.eventService.dispatchEvent(this.cellCtrl.createEvent(t,"cellMouseOver")),this.beans.columnHoverService.setMouseOver([this.column]))}mouseStayingInsideCell(t){if(!t.target||!t.relatedTarget)return!1;const e=this.cellCtrl.getGui(),i=e.contains(t.target),n=e.contains(t.relatedTarget);return i&&n}destroy(){super.destroy()}},G_e=class extends kt{constructor(t,e){super(),this.cellCtrl=t,this.beans=e,this.column=t.getColumn(),this.rowNode=t.getRowNode()}setupRowSpan(){this.rowSpan=this.column.getRowSpan(this.rowNode),this.addManagedListeners(this.beans.eventService,{newColumnsLoaded:()=>this.onNewColumnsLoaded()})}setComp(t){this.eGui=t,this.setupColSpan(),this.setupRowSpan(),this.onLeftChanged(),this.onWidthChanged(),this.applyRowSpan()}onNewColumnsLoaded(){const t=this.column.getRowSpan(this.rowNode);this.rowSpan!==t&&(this.rowSpan=t,this.applyRowSpan(!0))}onDisplayColumnsChanged(){const t=this.getColSpanningList();Fp(this.colsSpanning,t)||(this.colsSpanning=t,this.onWidthChanged(),this.onLeftChanged())}setupColSpan(){this.column.getColDef().colSpan!=null&&(this.colsSpanning=this.getColSpanningList(),this.addManagedListeners(this.beans.eventService,{displayedColumnsChanged:this.onDisplayColumnsChanged.bind(this),displayedColumnsWidthChanged:this.onWidthChanged.bind(this)}))}onWidthChanged(){if(!this.eGui)return;const t=this.getCellWidth();this.eGui.style.width=`${t}px`}getCellWidth(){return this.colsSpanning?this.colsSpanning.reduce((t,e)=>t+e.getActualWidth(),0):this.column.getActualWidth()}getColSpanningList(){const t=this.column.getColSpan(this.rowNode),e=[];if(t===1)e.push(this.column);else{let i=this.column;const n=this.column.getPinned();for(let r=0;i&&r<t&&(e.push(i),i=this.beans.visibleColsService.getColAfter(i),!(!i||Wn(i)||n!==i.getPinned()));r++);}return e}onLeftChanged(){if(!this.eGui)return;const t=this.modifyLeftForPrintLayout(this.getCellLeft());this.eGui.style.left=t+"px"}getCellLeft(){let t;return this.beans.gos.get("enableRtl")&&this.colsSpanning?t=Yn(this.colsSpanning):t=this.column,t.getLeft()}modifyLeftForPrintLayout(t){if(!this.cellCtrl.isPrintLayout()||this.column.getPinned()==="left")return t;const e=this.beans.visibleColsService.getColsLeftWidth();if(this.column.getPinned()==="right"){const i=this.beans.visibleColsService.getBodyContainerWidth();return e+i+(t||0)}return e+(t||0)}applyRowSpan(t){if(this.rowSpan===1&&!t)return;const i=dg(this.beans.gos)*this.rowSpan;this.eGui.style.height=`${i}px`,this.eGui.style.zIndex="1"}destroy(){super.destroy()}},Hb="ag-cell-range-selected",U_e="ag-cell-range-chart",H_e="ag-cell-range-single-cell",$_e="ag-cell-range-chart-category",W_e="ag-cell-range-handle",q_e="ag-cell-range-top",j_e="ag-cell-range-right",Q_e="ag-cell-range-bottom",Z_e="ag-cell-range-left",X_e=class{constructor(t,e){this.beans=t,this.rangeService=t.rangeService,this.selectionHandleFactory=t.selectionHandleFactory,this.cellCtrl=e}setComp(t,e){this.cellComp=t,this.eGui=e,this.onCellSelectionChanged()}onCellSelectionChanged(){this.cellComp&&(this.rangeCount=this.rangeService.getCellRangeCount(this.cellCtrl.getCellPosition()),this.hasChartRange=this.getHasChartRange(),this.cellComp.addOrRemoveCssClass(Hb,this.rangeCount!==0),this.cellComp.addOrRemoveCssClass(`${Hb}-1`,this.rangeCount===1),this.cellComp.addOrRemoveCssClass(`${Hb}-2`,this.rangeCount===2),this.cellComp.addOrRemoveCssClass(`${Hb}-3`,this.rangeCount===3),this.cellComp.addOrRemoveCssClass(`${Hb}-4`,this.rangeCount>=4),this.cellComp.addOrRemoveCssClass(U_e,this.hasChartRange),TT(this.eGui,this.rangeCount>0?!0:void 0),this.cellComp.addOrRemoveCssClass(H_e,this.isSingleCell()),this.updateRangeBorders(),this.refreshHandle())}updateRangeBorders(){const t=this.getRangeBorders(),e=this.isSingleCell(),i=!e&&t.top,n=!e&&t.right,r=!e&&t.bottom,s=!e&&t.left;this.cellComp.addOrRemoveCssClass(q_e,i),this.cellComp.addOrRemoveCssClass(j_e,n),this.cellComp.addOrRemoveCssClass(Q_e,r),this.cellComp.addOrRemoveCssClass(Z_e,s)}isSingleCell(){const{rangeService:t}=this.beans;return this.rangeCount===1&&!!t&&!t.isMoreThanOneCell()}getHasChartRange(){const{rangeService:t}=this.beans;if(!this.rangeCount||!t)return!1;const e=t.getCellRanges();return e.length>0&&e.every(i=>fg([1,0],i.type))}updateRangeBordersIfRangeCount(){this.rangeCount>0&&(this.updateRangeBorders(),this.refreshHandle())}getRangeBorders(){const t=this.beans.gos.get("enableRtl");let e=!1,i=!1,n=!1,r=!1;const s=this.cellCtrl.getCellPosition().column,o=this.beans.visibleColsService;let a,l;t?(a=o.getColAfter(s),l=o.getColBefore(s)):(a=o.getColBefore(s),l=o.getColAfter(s));const u=this.rangeService.getCellRanges().filter(d=>this.rangeService.isCellInSpecificRange(this.cellCtrl.getCellPosition(),d));a||(r=!0),l||(i=!0);for(let d=0;d<u.length&&!(e&&i&&n&&r);d++){const p=u[d],v=this.rangeService.getRangeStartRow(p),y=this.rangeService.getRangeEndRow(p);!e&&this.beans.rowPositionUtils.sameRow(v,this.cellCtrl.getCellPosition())&&(e=!0),!n&&this.beans.rowPositionUtils.sameRow(y,this.cellCtrl.getCellPosition())&&(n=!0),!r&&a&&p.columns.indexOf(a)<0&&(r=!0),!i&&l&&p.columns.indexOf(l)<0&&(i=!0)}return{top:e,right:i,bottom:n,left:r}}refreshHandle(){if(this.beans.context.isDestroyed())return;const t=this.shouldHaveSelectionHandle();this.selectionHandle&&!t&&(this.selectionHandle=this.beans.context.destroyBean(this.selectionHandle)),t&&this.addSelectionHandle(),this.cellComp.addOrRemoveCssClass(W_e,!!this.selectionHandle)}shouldHaveSelectionHandle(){const t=this.beans.gos,e=this.rangeService.getCellRanges(),i=e.length;if(this.rangeCount<1||i<1)return!1;const n=Yn(e),r=this.cellCtrl.getCellPosition(),s=e6(t)&&!this.cellCtrl.isSuppressFillHandle(),o=H0e(t);let a=i===1&&!this.cellCtrl.isEditing()&&(s||o);if(this.hasChartRange){const u=e[0].type===1&&this.rangeService.isCellInSpecificRange(r,e[0]);this.cellComp.addOrRemoveCssClass($_e,u),a=n.type===0}return a&&n.endRow!=null&&this.rangeService.isContiguousRange(n)&&this.rangeService.isBottomRightCell(n,r)}addSelectionHandle(){const t=Yn(this.rangeService.getCellRanges()).type,i=e6(this.beans.gos)&&Wn(t)?0:1;this.selectionHandle&&this.selectionHandle.getType()!==i&&(this.selectionHandle=this.beans.context.destroyBean(this.selectionHandle)),this.selectionHandle||(this.selectionHandle=this.selectionHandleFactory.createSelectionHandle(i)),this.selectionHandle.refresh(this.cellCtrl)}destroy(){this.beans.context.destroyBean(this.selectionHandle)}},K_e="ag-cell",Y_e="ag-cell-auto-height",J_e="ag-cell-normal-height",eCe="ag-cell-focus",tCe="ag-cell-first-right-pinned",iCe="ag-cell-last-left-pinned",nCe="ag-cell-not-inline-editing",rCe="ag-column-hover",sCe="ag-cell-wrap-text",oCe=0,EJ=class Pz extends kt{constructor(e,i,n,r){super(),this.column=e,this.rowNode=i,this.beans=n,this.rowCtrl=r,this.cellRangeFeature=void 0,this.cellPositionFeature=void 0,this.cellCustomStyleFeature=void 0,this.tooltipFeature=void 0,this.cellMouseListenerFeature=void 0,this.cellKeyboardListenerFeature=void 0,this.suppressRefreshCell=!1,this.onCellCompAttachedFuncs=[],this.onCellEditorAttachedFuncs=[],this.instanceId=e.getId()+"-"+oCe++,this.colIdSanitised=yh(this.column.getId()),this.createCellPosition(),this.updateAndFormatValue(!1)}shouldRestoreFocus(){return this.beans.focusService.shouldRestoreFocus(this.cellPosition)}onFocusOut(){this.beans.focusService.clearRestoreFocus()}addFeatures(){this.cellPositionFeature=new G_e(this,this.beans),this.cellCustomStyleFeature=new B_e(this,this.beans),this.cellMouseListenerFeature=new V_e(this,this.beans,this.column),this.cellKeyboardListenerFeature=new z_e(this,this.beans,this.column,this.rowNode,this.rowCtrl),this.column.isTooltipEnabled()&&this.enableTooltipFeature(),this.beans.rangeService&&Mh(this.beans.gos)&&(this.cellRangeFeature=new X_e(this.beans,this))}removeFeatures(){const e=this.beans.context;this.cellPositionFeature=e.destroyBean(this.cellPositionFeature),this.cellCustomStyleFeature=e.destroyBean(this.cellCustomStyleFeature),this.cellMouseListenerFeature=e.destroyBean(this.cellMouseListenerFeature),this.cellKeyboardListenerFeature=e.destroyBean(this.cellKeyboardListenerFeature),this.cellRangeFeature=e.destroyBean(this.cellRangeFeature),this.disableTooltipFeature()}enableTooltipFeature(e,i){const n=()=>{const o=this.column.getColDef(),a=this.rowNode.data;if(o.tooltipField&&oi(a))return qw(a,o.tooltipField,this.column.isTooltipFieldContainsDots());const l=o.tooltipValueGetter;return l?l(this.beans.gos.addGridCommonParams({location:"cell",colDef:this.column.getColDef(),column:this.column,rowIndex:this.cellPosition.rowIndex,node:this.rowNode,data:this.rowNode.data,value:this.value,valueFormatted:this.valueFormatted})):null},r=this.beans.gos.get("tooltipShowMode")==="whenTruncated";!i&&r&&!this.isCellRenderer()&&(i=()=>{const o=this.getGui(),a=o.children.length===0?o:o.querySelector(".ag-cell-value");return a?a.scrollWidth>a.clientWidth:!0});const s={getColumn:()=>this.column,getColDef:()=>this.column.getColDef(),getRowIndex:()=>this.cellPosition.rowIndex,getRowNode:()=>this.rowNode,getGui:()=>this.getGui(),getLocation:()=>"cell",getTooltipValue:e!=null?()=>e:n,getValueFormatted:()=>this.valueFormatted,shouldDisplayTooltip:i};this.tooltipFeature=new nx(s,this.beans)}disableTooltipFeature(){this.tooltipFeature=this.beans.context.destroyBean(this.tooltipFeature)}setComp(e,i,n,r,s,o){this.cellComp=e,this.eGui=i,this.printLayout=r,o??(o=this),this.addDomData(o),this.addFeatures(),o.addDestroyFunc(()=>this.removeFeatures()),this.onSuppressCellFocusChanged(this.beans.gos.get("suppressCellFocus")),this.onCellFocused(this.focusEventToRestore),this.applyStaticCssClasses(),this.setWrapText(),this.onFirstRightPinnedChanged(),this.onLastLeftPinnedChanged(),this.onColumnHover(),this.setupControlComps(),this.setupAutoHeight(n,o),this.refreshFirstAndLastStyles(),this.refreshAriaColIndex(),this.cellPositionFeature?.setComp(i),this.cellCustomStyleFeature?.setComp(e),this.tooltipFeature?.refreshToolTip(),this.cellKeyboardListenerFeature?.setComp(this.eGui),this.cellRangeFeature&&this.cellRangeFeature.setComp(e,i),s&&this.isCellEditable()?this.startEditing():this.showValue(),this.onCellCompAttachedFuncs.length&&(this.onCellCompAttachedFuncs.forEach(a=>a()),this.onCellCompAttachedFuncs=[])}setupAutoHeight(e,i){if(this.isAutoHeight=this.column.isAutoHeight(),!this.isAutoHeight||!e)return;const n=e.parentElement,r=Mp(this.beans.gos,this.rowNode).height,s=l=>{if(this.editing||!this.isAlive()||!i.isAlive())return;const{paddingTop:u,paddingBottom:d,borderBottomWidth:p,borderTopWidth:v}=Xg(n),y=u+d+p+v,R=e.offsetHeight+y;if(l<5){const P=Rs(this.beans.gos),N=!P||!P.contains(e),F=R==0;if(N||F){window.setTimeout(()=>s(l+1),0);return}}const O=Math.max(R,r);this.rowNode.setRowAutoHeight(O,this.column)},o=()=>s(0);o();const a=this.beans.resizeObserverService.observeResize(e,o);i.addDestroyFunc(()=>{a(),this.rowNode.setRowAutoHeight(void 0,this.column)})}getCellAriaRole(){return this.column.getColDef().cellAriaRole??"gridcell"}isCellRenderer(){const e=this.column.getColDef();return e.cellRenderer!=null||e.cellRendererSelector!=null}getValueToDisplay(){return this.valueFormatted??this.value}showValue(e=!1){const{beans:i,column:n,rowNode:r,cellRangeFeature:s,cellComp:o}=this,{userComponentFactory:a,animationFrameService:l}=i,u=this.getValueToDisplay();let d;if(r.stub&&r.groupData?.[this.column.getId()]==null){const v=this.createCellRendererParams();d=a.getLoadingCellRendererDetails(n.getColDef(),v)}else if(this.isCellRenderer()){const v=this.createCellRendererParams();d=a.getCellRendererDetails(n.getColDef(),v)}o.setRenderDetails(d,u,e),l.requestAnimationFrame(()=>s?.refreshHandle())}setupControlComps(){const e=this.column.getColDef();this.includeSelection=this.isIncludeControl(this.isCheckboxSelection(e)),this.includeRowDrag=this.isIncludeControl(e.rowDrag),this.includeDndSource=this.isIncludeControl(e.dndSource),this.cellComp.setIncludeSelection(this.includeSelection),this.cellComp.setIncludeDndSource(this.includeDndSource),this.cellComp.setIncludeRowDrag(this.includeRowDrag)}isForceWrapper(){return this.beans.gos.get("enableCellTextSelection")||this.column.isAutoHeight()}isIncludeControl(e){return this.rowNode.rowPinned!=null?!1:typeof e=="function"||e===!0}isCheckboxSelection(e){const{rowSelection:i}=this.beans.gridOptions;return e.checkboxSelection||NC(this.column)&&i&&typeof i!="string"&&C0(i)}refreshShouldDestroy(){const e=this.column.getColDef(),i=this.includeSelection!=this.isIncludeControl(this.isCheckboxSelection(e)),n=this.includeRowDrag!=this.isIncludeControl(e.rowDrag),r=this.includeDndSource!=this.isIncludeControl(e.dndSource),s=this.isAutoHeight!=this.column.isAutoHeight();return i||n||r||s}startEditing(e=null,i=!1,n=null){const{editService:r}=this.beans;return!this.isCellEditable()||this.editing||!r?!0:this.cellComp?r.startEditing(this,e,i,n):(this.onCellCompAttachedFuncs.push(()=>{this.startEditing(e,i,n)}),!0)}setEditing(e,i){this.editCompDetails=i,this.editing!==e&&(this.editing=e)}stopRowOrCellEdit(e=!1){this.beans.gos.get("editType")==="fullRow"?this.rowCtrl.stopEditing(e):this.stopEditing(e)}onPopupEditorClosed(){this.editing&&this.stopEditingAndFocus()}stopEditing(e=!1){this.onCellEditorAttachedFuncs=[];const{editService:i}=this.beans;return!this.editing||!i?!1:i.stopEditing(this,e)}createCellRendererParams(){return this.beans.gos.addGridCommonParams({value:this.value,valueFormatted:this.valueFormatted,getValue:()=>this.beans.valueService.getValueForDisplay(this.column,this.rowNode),setValue:i=>this.beans.valueService.setValue(this.rowNode,this.column,i),formatValue:this.formatValue.bind(this),data:this.rowNode.data,node:this.rowNode,pinned:this.column.getPinned(),colDef:this.column.getColDef(),column:this.column,refreshCell:this.refreshCell.bind(this),eGridCell:this.getGui(),eParentOfValue:this.cellComp.getParentOfValue(),registerRowDragger:(i,n,r,s)=>this.registerRowDragger(i,n,s),setTooltip:(i,n)=>{this.tooltipFeature&&this.disableTooltipFeature(),this.enableTooltipFeature(i,n),this.tooltipFeature?.refreshToolTip()}})}setFocusOutOnEditor(){this.editing&&this.beans.editService?.setFocusOutOnEditor(this)}setFocusInOnEditor(){this.editing&&this.beans.editService?.setFocusInOnEditor(this)}onCellChanged(e){e.column===this.column&&this.refreshCell({})}refreshOrDestroyCell(e){this.refreshShouldDestroy()?this.rowCtrl?.recreateCell(this):this.refreshCell(e)}refreshCell(e){if(this.suppressRefreshCell||this.editing)return;const i=this.column.getColDef(),n=e!=null&&!!e.newData,r=e!=null&&!!e.suppressFlash||!!i.suppressCellFlash,s=i.field==null&&i.valueGetter==null&&i.showRowGroup==null,o=e&&e.forceRefresh||s||n,a=!!this.cellComp,l=this.updateAndFormatValue(a),u=o||l;if(a){if(u){this.showValue(n);const d=this.beans.filterManager?.isSuppressFlashingCellsBecauseFiltering();!r&&!d&&(this.beans.gos.get("enableCellChangeFlash")||i.enableCellChangeFlash)&&this.flashCell(),this.cellCustomStyleFeature?.applyUserStyles(),this.cellCustomStyleFeature?.applyClassesFromColDef()}this.tooltipFeature?.refreshToolTip(),this.cellCustomStyleFeature?.applyCellClassRules()}}stopEditingAndFocus(e=!1,i=!1){this.beans.editService?.stopEditingAndFocus(this,e,i)}flashCell(e){const i=e?.flashDuration??e?.flashDelay,n=e?.fadeDuration??e?.fadeDelay;this.animateCell("data-changed",i,n)}animateCell(e,i,n){if(!this.cellComp)return;const{gos:r}=this.beans;if(i||(i=r.get("cellFlashDuration")),i===0)return;oi(n)||(n=r.get("cellFadeDuration"));const s=`ag-cell-${e}`,o=`ag-cell-${e}-animation`;this.cellComp.addOrRemoveCssClass(s,!0),this.cellComp.addOrRemoveCssClass(o,!1),this.beans.frameworkOverrides.wrapIncoming(()=>{window.setTimeout(()=>{this.isAlive()&&(this.cellComp.addOrRemoveCssClass(s,!1),this.cellComp.addOrRemoveCssClass(o,!0),this.eGui.style.transition=`background-color ${n}ms`,window.setTimeout(()=>{this.isAlive()&&(this.cellComp.addOrRemoveCssClass(o,!1),this.eGui.style.transition="")},n))},i)})}onFlashCells(e){if(!this.cellComp)return;const i=this.beans.cellPositionUtils.createId(this.getCellPosition());e.cells[i]&&this.animateCell("highlight")}isCellEditable(){return this.column.isCellEditable(this.rowNode)}isSuppressFillHandle(){return this.column.isSuppressFillHandle()}formatValue(e){return this.callValueFormatter(e)??e}callValueFormatter(e){return this.beans.valueService.formatValue(this.column,this.rowNode,e)}updateAndFormatValue(e){const i=this.value,n=this.valueFormatted;return this.value=this.beans.valueService.getValueForDisplay(this.column,this.rowNode),this.valueFormatted=this.callValueFormatter(this.value),e?!this.valuesAreEqual(i,this.value)||this.valueFormatted!=n:!0}valuesAreEqual(e,i){const n=this.column.getColDef();return n.equals?n.equals(e,i):e===i}getComp(){return this.cellComp}getValue(){return this.value}addDomData(e){const i=this.getGui();Dg(this.beans.gos,i,Pz.DOM_DATA_KEY_CELL_CTRL,this),e.addDestroyFunc(()=>Dg(this.beans.gos,i,Pz.DOM_DATA_KEY_CELL_CTRL,null))}createEvent(e,i){return this.beans.gos.addGridCommonParams({type:i,node:this.rowNode,data:this.rowNode.data,value:this.value,column:this.column,colDef:this.column.getColDef(),rowPinned:this.rowNode.rowPinned,event:e,rowIndex:this.rowNode.rowIndex})}processCharacter(e){this.cellKeyboardListenerFeature?.processCharacter(e)}onKeyDown(e){this.cellKeyboardListenerFeature?.onKeyDown(e)}onMouseEvent(e,i){this.cellMouseListenerFeature?.onMouseEvent(e,i)}getGui(){return this.eGui}getColSpanningList(){return this.cellPositionFeature.getColSpanningList()}onLeftChanged(){this.cellComp&&this.cellPositionFeature?.onLeftChanged()}onDisplayedColumnsChanged(){this.eGui&&(this.refreshAriaColIndex(),this.refreshFirstAndLastStyles())}refreshFirstAndLastStyles(){const{cellComp:e,column:i,beans:n}=this;xJ(e,i,n.visibleColsService)}refreshAriaColIndex(){const e=this.beans.visibleColsService.getAriaColIndex(this.column);AY(this.getGui(),e)}isSuppressNavigable(){return this.column.isSuppressNavigable(this.rowNode)}onWidthChanged(){return this.cellPositionFeature?.onWidthChanged()}getColumn(){return this.column}getRowNode(){return this.rowNode}isPrintLayout(){return this.printLayout}getCellPosition(){return this.cellPosition}isEditing(){return this.editing}startRowOrCellEdit(e,i=null){return this.cellComp?this.beans.gos.get("editType")==="fullRow"?this.rowCtrl.startRowEditing(e,this):this.startEditing(e,!0,i):(this.onCellCompAttachedFuncs.push(()=>{this.startRowOrCellEdit(e,i)}),!0)}getRowCtrl(){return this.rowCtrl}getRowPosition(){return{rowIndex:this.cellPosition.rowIndex,rowPinned:this.cellPosition.rowPinned}}updateRangeBordersIfRangeCount(){this.cellComp&&this.cellRangeFeature&&this.cellRangeFeature.updateRangeBordersIfRangeCount()}onCellSelectionChanged(){this.cellComp&&this.cellRangeFeature&&this.cellRangeFeature.onCellSelectionChanged()}isRangeSelectionEnabled(){return this.cellRangeFeature!=null}focusCell(e=!1){this.beans.focusService.setFocusedCell({rowIndex:this.getCellPosition().rowIndex,column:this.column,rowPinned:this.rowNode.rowPinned,forceBrowserFocus:e})}onRowIndexChanged(){this.createCellPosition(),this.onCellFocused(),this.cellRangeFeature&&this.cellRangeFeature.onCellSelectionChanged()}onSuppressCellFocusChanged(e){this.eGui&&Vc(this.eGui,"tabindex",e?void 0:-1)}onFirstRightPinnedChanged(){if(!this.cellComp)return;const e=this.column.isFirstRightPinned();this.cellComp.addOrRemoveCssClass(tCe,e)}onLastLeftPinnedChanged(){if(!this.cellComp)return;const e=this.column.isLastLeftPinned();this.cellComp.addOrRemoveCssClass(iCe,e)}onCellFocused(e){if(this.beans.focusService.isCellFocusSuppressed())return;const i=this.beans.focusService.isCellFocused(this.cellPosition);if(!this.cellComp){i&&e?.forceBrowserFocus&&(this.focusEventToRestore=e);return}if(this.focusEventToRestore=void 0,this.cellComp.addOrRemoveCssClass(eCe,i),i&&e&&e.forceBrowserFocus){let r=this.cellComp.getFocusableElement();if(this.editing){const s=this.beans.focusService.findFocusableElements(r,null,!0);s.length&&(r=s[0])}r.focus({preventScroll:!!e.preventScrollOnBrowserFocus})}const n=this.beans.gos.get("editType")==="fullRow";!i&&!n&&this.editing&&this.stopRowOrCellEdit(),i&&this.rowCtrl.announceDescription()}createCellPosition(){this.cellPosition={rowIndex:this.rowNode.rowIndex,rowPinned:Pd(this.rowNode.rowPinned),column:this.column}}applyStaticCssClasses(){this.cellComp.addOrRemoveCssClass(K_e,!0),this.cellComp.addOrRemoveCssClass(nCe,!0);const e=this.column.isAutoHeight()==!0;this.cellComp.addOrRemoveCssClass(Y_e,e),this.cellComp.addOrRemoveCssClass(J_e,!e)}onColumnHover(){if(!this.cellComp||!this.beans.gos.get("columnHoverHighlight"))return;const e=this.beans.columnHoverService.isHovered(this.column);this.cellComp.addOrRemoveCssClass(rCe,e)}onColDefChanged(){if(!this.cellComp)return;this.column.isTooltipEnabled()?(this.disableTooltipFeature(),this.enableTooltipFeature()):this.disableTooltipFeature(),this.setWrapText(),this.editing?this.beans.editService?.handleColDefChanged(this):this.refreshOrDestroyCell({forceRefresh:!0,suppressFlash:!0})}setWrapText(){const e=this.column.getColDef().wrapText==!0;this.cellComp.addOrRemoveCssClass(sCe,e)}dispatchCellContextMenuEvent(e){const i=this.column.getColDef(),n=this.createEvent(e,"cellContextMenu");this.beans.eventService.dispatchEvent(n),i.onCellContextMenu&&window.setTimeout(()=>{this.beans.frameworkOverrides.wrapOutgoing(()=>{i.onCellContextMenu(n)})},0)}getCellRenderer(){return this.cellComp?this.cellComp.getCellRenderer():null}getCellEditor(){return this.cellComp?this.cellComp.getCellEditor():null}destroy(){this.onCellCompAttachedFuncs=[],this.onCellEditorAttachedFuncs=[],super.destroy()}createSelectionCheckbox(){const e=new F_e;return this.beans.context.createBean(e),e.init({rowNode:this.rowNode,column:this.column}),e}createDndSource(){const e=new N_e(this.rowNode,this.column,this.eGui);return this.beans.context.createBean(e),e}registerRowDragger(e,i,n){if(this.customRowDragComp){this.customRowDragComp.setDragElement(e,i);return}const r=this.createRowDragComp(e,i,n);r&&(this.customRowDragComp=r,this.addDestroyFunc(()=>{this.beans.context.destroyBean(r),this.customRowDragComp=null}))}createRowDragComp(e,i,n){const r=this.beans.gos.get("pagination"),s=this.beans.gos.get("rowDragManaged"),o=ls(this.beans.gos);if(s){if(!o){Wt("managed row dragging is only allowed in the Client Side Row Model");return}if(r){Wt("managed row dragging is not possible when doing pagination");return}}const a=new Sz(()=>this.value,this.rowNode,this.column,e,i,n);return this.beans.context.createBean(a),a}setSuppressRefreshCell(e){this.suppressRefreshCell=e}getEditCompDetails(){return this.editCompDetails}onCellEditorAttached(e){this.onCellEditorAttachedFuncs.push(e)}cellEditorAttached(){this.onCellEditorAttachedFuncs.forEach(e=>e()),this.onCellEditorAttachedFuncs=[]}};EJ.DOM_DATA_KEY_CELL_CTRL="cellCtrl";var pg=EJ,aCe=0,AJ=class Ez extends kt{constructor(e,i,n,r,s){super(),this.allRowGuis=[],this.active=!0,this.centerCellCtrls={list:[],map:{}},this.leftCellCtrls={list:[],map:{}},this.rightCellCtrls={list:[],map:{}},this.slideInAnimation={left:!1,center:!1,right:!1,fullWidth:!1},this.fadeInAnimation={left:!1,center:!1,right:!1,fullWidth:!1},this.rowDragComps=[],this.lastMouseDownOnDragger=!1,this.emptyStyle={},this.updateColumnListsPending=!1,this.rowId=null,this.businessKeySanitised=null,this.beans=i,this.gos=i.gos,this.rowNode=e,this.paginationPage=i.paginationService?.getCurrentPage()??0,this.useAnimationFrameForCreate=r,this.printLayout=s,this.suppressRowTransform=this.gos.get("suppressRowTransform"),this.instanceId=e.id+"-"+aCe++,this.rowId=yh(e.id),this.initRowBusinessKey(),this.rowFocused=i.focusService.isRowFocused(this.rowNode.rowIndex,this.rowNode.rowPinned),this.rowLevel=i.rowCssClassCalculator.calculateRowLevel(this.rowNode),this.setRowType(),this.setAnimateFlags(n),this.rowStyles=this.processStylesFromGridOptions(),this.addListeners()}initRowBusinessKey(){this.businessKeyForNodeFunc=this.gos.get("getBusinessKeyForNode"),this.updateRowBusinessKey()}updateRowBusinessKey(){if(typeof this.businessKeyForNodeFunc!="function")return;const e=this.businessKeyForNodeFunc(this.rowNode);this.businessKeySanitised=yh(e)}getRowId(){return this.rowId}getRowStyles(){return this.rowStyles}isSticky(){return this.rowNode.sticky}updateGui(e,i){e==="left"?this.leftGui=i:e==="right"?this.rightGui=i:e==="fullWidth"?this.fullWidthGui=i:this.centerGui=i}setComp(e,i,n,r){r=BC(this,this.beans.context,r);const s={rowComp:e,element:i,containerType:n,compBean:r};this.allRowGuis.push(s),this.updateGui(n,s),this.initialiseRowComp(s),this.rowType!=="FullWidthLoading"&&!this.rowNode.rowPinned&&this.beans.rowRenderer.dispatchFirstDataRenderedEvent()}unsetComp(e){this.allRowGuis=this.allRowGuis.filter(i=>i.containerType!==e),this.updateGui(e,void 0)}isCacheable(){return this.rowType==="FullWidthDetail"&&this.gos.get("keepDetailRows")}setCached(e){const i=e?"none":"";this.allRowGuis.forEach(n=>n.element.style.display=i)}initialiseRowComp(e){const i=this.gos;this.onSuppressCellFocusChanged(this.beans.gos.get("suppressCellFocus")),this.listenOnDomOrder(e),this.beans.columnModel.wasAutoRowHeightEverActive()&&this.rowNode.checkAutoHeights(),this.onRowHeightChanged(e),this.updateRowIndexes(e),this.setFocusedClasses(e),this.setStylesFromGridOptions(!1,e),wT(i)&&this.rowNode.selectable&&this.onRowSelected(e),this.updateColumnLists(!this.useAnimationFrameForCreate);const n=e.rowComp;this.getInitialRowClasses(e.containerType).forEach(s=>n.addOrRemoveCssClass(s,!0)),this.executeSlideAndFadeAnimations(e),this.rowNode.group&&MT(e.element,this.rowNode.expanded==!0),this.setRowCompRowId(n),this.setRowCompRowBusinessKey(n),Dg(i,e.element,Ez.DOM_DATA_KEY_ROW_CTRL,this),e.compBean.addDestroyFunc(()=>Dg(i,e.element,Ez.DOM_DATA_KEY_ROW_CTRL,null)),this.useAnimationFrameForCreate?this.beans.animationFrameService.createTask(this.addHoverFunctionality.bind(this,e),this.rowNode.rowIndex,"createTasksP2"):this.addHoverFunctionality(e),this.isFullWidth()&&this.setupFullWidth(e),i.get("rowDragEntireRow")&&this.addRowDraggerToRow(e),this.useAnimationFrameForCreate&&this.beans.animationFrameService.addDestroyTask(()=>{this.isAlive()&&e.rowComp.addOrRemoveCssClass("ag-after-created",!0)}),this.executeProcessRowPostCreateFunc()}setRowCompRowBusinessKey(e){this.businessKeySanitised!=null&&e.setRowBusinessKey(this.businessKeySanitised)}getBusinessKey(){return this.businessKeySanitised}setRowCompRowId(e){this.rowId=yh(this.rowNode.id),this.rowId!=null&&e.setRowId(this.rowId)}executeSlideAndFadeAnimations(e){const{containerType:i}=e;this.slideInAnimation[i]&&(YW(()=>{this.onTopChanged()}),this.slideInAnimation[i]=!1),this.fadeInAnimation[i]&&(YW(()=>{e.rowComp.addOrRemoveCssClass("ag-opacity-zero",!1)}),this.fadeInAnimation[i]=!1)}addRowDraggerToRow(e){if(Mh(this.gos)){Wt("Setting `rowDragEntireRow: true` in the gridOptions doesn't work with `cellSelection: true`");return}const i=this.beans.localeService.getLocaleTextFunc(),n=new Sz(()=>`1 ${i("rowDragRow","row")}`,this.rowNode,void 0,e.element,void 0,!0),r=this.createBean(n,this.beans.context);this.rowDragComps.push(r),e.compBean.addDestroyFunc(()=>{this.rowDragComps=this.rowDragComps.filter(s=>s!==r),this.destroyBean(r,this.beans.context)})}setupFullWidth(e){const i=this.getPinnedForContainer(e.containerType);if(this.rowType=="FullWidthDetail"&&!this.gos.assertModuleRegistered("@ag-grid-enterprise/master-detail","cell renderer 'agDetailCellRenderer' (for master detail)"))return;const n=this.createFullWidthCompDetails(e.element,i);e.rowComp.showFullWidth(n)}isPrintLayout(){return this.printLayout}getFullWidthCellRenderers(){return this.gos.get("embedFullWidthRows")?this.allRowGuis.map(e=>e?.rowComp?.getFullWidthCellRenderer()):[this.fullWidthGui?.rowComp?.getFullWidthCellRenderer()]}getCellElement(e){const i=this.getCellCtrl(e);return i?i.getGui():null}executeProcessRowPostCreateFunc(){const e=this.gos.getCallback("processRowPostCreate");if(!e||!this.areAllContainersReady())return;const i={eRow:this.centerGui.element,ePinnedLeftRow:this.leftGui?this.leftGui.element:void 0,ePinnedRightRow:this.rightGui?this.rightGui.element:void 0,node:this.rowNode,rowIndex:this.rowNode.rowIndex,addRenderedRowListener:this.addEventListener.bind(this)};e(i)}areAllContainersReady(){const e=!!this.leftGui||!this.beans.visibleColsService.isPinningLeft(),i=!!this.centerGui,n=!!this.rightGui||!this.beans.visibleColsService.isPinningRight();return e&&i&&n}isNodeFullWidthCell(){if(this.rowNode.detail)return!0;const e=this.beans.gos.getCallback("isFullWidthRow");return e?e({rowNode:this.rowNode}):!1}setRowType(){const e=this.rowNode.stub&&!this.gos.get("suppressServerSideFullWidthLoadingRow")&&!this.gos.get("groupHideOpenParents"),i=this.isNodeFullWidthCell(),n=this.gos.get("masterDetail")&&this.rowNode.detail,r=this.beans.columnModel.isPivotMode(),o=!!this.rowNode.group&&!this.rowNode.footer&&yP(this.gos,r);e?this.rowType="FullWidthLoading":n?this.rowType="FullWidthDetail":i?this.rowType="FullWidth":o?this.rowType="FullWidthGroup":this.rowType="Normal"}updateColumnLists(e=!1,i=!1){if(this.isFullWidth())return;if(e||this.gos.get("suppressAnimationFrame")||this.printLayout){this.updateColumnListsImpl(i);return}this.updateColumnListsPending||(this.beans.animationFrameService.createTask(()=>{this.active&&this.updateColumnListsImpl(!0)},this.rowNode.rowIndex,"createTasksP1"),this.updateColumnListsPending=!0)}createCellCtrls(e,i,n=null){const r={list:[],map:{}},s=(a,l,u)=>{u!=null?r.list.splice(u,0,l):r.list.push(l),r.map[a]=l},o=[];for(const a of i){const l=a.getInstanceId();let u=e.map[l];u||(u=new pg(a,this.rowNode,this.beans,this)),s(l,u)}for(const a of e.list){const l=a.getColumn().getInstanceId();if(r.map[l]!=null)continue;!this.isCellEligibleToBeRemoved(a,n)?o.push([l,a]):a.destroy()}if(o.length)for(const[a,l]of o){const u=r.list.findIndex(p=>p.getColumn().getLeft()>l.getColumn().getLeft()),d=u===-1?void 0:Math.max(u-1,0);s(a,l,d)}return r}updateColumnListsImpl(e){this.updateColumnListsPending=!1,this.createAllCellCtrls(),this.setCellCtrls(e)}setCellCtrls(e){this.allRowGuis.forEach(i=>{const n=this.getCellCtrlsForContainer(i.containerType);i.rowComp.setCellCtrls(n,e)})}getCellCtrlsForContainer(e){switch(e){case"left":return this.leftCellCtrls.list;case"right":return this.rightCellCtrls.list;case"fullWidth":return[];case"center":return this.centerCellCtrls.list}}createAllCellCtrls(){const e=this.beans.columnViewportService,i=this.beans.visibleColsService;if(this.printLayout)this.centerCellCtrls=this.createCellCtrls(this.centerCellCtrls,i.getAllCols()),this.leftCellCtrls={list:[],map:{}},this.rightCellCtrls={list:[],map:{}};else{const n=e.getColsWithinViewport(this.rowNode);this.centerCellCtrls=this.createCellCtrls(this.centerCellCtrls,n);const r=i.getLeftColsForRow(this.rowNode);this.leftCellCtrls=this.createCellCtrls(this.leftCellCtrls,r,"left");const s=i.getRightColsForRow(this.rowNode);this.rightCellCtrls=this.createCellCtrls(this.rightCellCtrls,s,"right")}}isCellEligibleToBeRemoved(e,i){if(e.getColumn().getPinned()!=i)return!0;const o=e.isEditing(),a=this.beans.focusService.isCellFocused(e.getCellPosition());if(o||a){const u=e.getColumn();return!(this.beans.visibleColsService.getAllCols().indexOf(u)>=0)}return!0}getDomOrder(){return this.gos.get("ensureDomOrder")||Zo(this.gos,"print")}listenOnDomOrder(e){const i=()=>{e.rowComp.setDomOrder(this.getDomOrder())};e.compBean.addManagedPropertyListeners(["domLayout","ensureDomOrder"],i)}setAnimateFlags(e){if(this.isSticky()||!e)return;const i=oi(this.rowNode.oldRowTop),n=this.beans.visibleColsService.isPinningLeft(),r=this.beans.visibleColsService.isPinningRight();if(i){if(this.isFullWidth()&&!this.gos.get("embedFullWidthRows")){this.slideInAnimation.fullWidth=!0;return}this.slideInAnimation.center=!0,this.slideInAnimation.left=n,this.slideInAnimation.right=r}else{if(this.isFullWidth()&&!this.gos.get("embedFullWidthRows")){this.fadeInAnimation.fullWidth=!0;return}this.fadeInAnimation.center=!0,this.fadeInAnimation.left=n,this.fadeInAnimation.right=r}}isEditing(){return this.editingRow}isFullWidth(){return this.rowType!=="Normal"}refreshFullWidth(){const e=(a,l)=>a?a.rowComp.refreshFullWidth(()=>this.createFullWidthCompDetails(a.element,l).params):!0,i=e(this.fullWidthGui,null),n=e(this.centerGui,null),r=e(this.leftGui,"left"),s=e(this.rightGui,"right");return i&&n&&r&&s}addListeners(){this.addManagedListeners(this.rowNode,{heightChanged:()=>this.onRowHeightChanged(),rowSelected:()=>this.onRowSelected(),rowIndexChanged:this.onRowIndexChanged.bind(this),topChanged:this.onTopChanged.bind(this),expandedChanged:this.updateExpandedCss.bind(this),hasChildrenChanged:this.updateExpandedCss.bind(this)}),this.rowNode.detail&&this.addManagedListeners(this.rowNode.parent,{dataChanged:this.onRowNodeDataChanged.bind(this)}),this.addManagedListeners(this.rowNode,{dataChanged:this.onRowNodeDataChanged.bind(this),cellChanged:this.postProcessCss.bind(this),rowHighlightChanged:this.onRowNodeHighlightChanged.bind(this),draggingChanged:this.postProcessRowDragging.bind(this),uiLevelChanged:this.onUiLevelChanged.bind(this)}),this.addManagedListeners(this.beans.eventService,{paginationPixelOffsetChanged:this.onPaginationPixelOffsetChanged.bind(this),heightScaleChanged:this.onTopChanged.bind(this),displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this),virtualColumnsChanged:this.onVirtualColumnsChanged.bind(this),cellFocused:this.onCellFocusChanged.bind(this),cellFocusCleared:this.onCellFocusChanged.bind(this),paginationChanged:this.onPaginationChanged.bind(this),modelUpdated:this.refreshFirstAndLastRowStyles.bind(this),columnMoved:()=>this.updateColumnLists()}),this.addDestroyFunc(()=>{this.rowDragComps=this.destroyBeans(this.rowDragComps,this.beans.context),this.tooltipFeature&&(this.tooltipFeature=this.destroyBean(this.tooltipFeature,this.beans.context))}),this.addManagedPropertyListeners(["rowStyle","getRowStyle","rowClass","getRowClass","rowClassRules"],this.postProcessCss.bind(this)),this.addManagedPropertyListener("rowDragEntireRow",()=>{if(this.gos.get("rowDragEntireRow")){this.allRowGuis.forEach(i=>{this.addRowDraggerToRow(i)});return}this.rowDragComps=this.destroyBeans(this.rowDragComps,this.beans.context)}),this.addListenersForCellComps()}addListenersForCellComps(){this.addManagedListeners(this.rowNode,{rowIndexChanged:()=>{this.getAllCellCtrls().forEach(e=>e.onRowIndexChanged())},cellChanged:e=>{this.getAllCellCtrls().forEach(i=>i.onCellChanged(e))}})}onRowNodeDataChanged(e){if(this.isFullWidth()!==!!this.isNodeFullWidthCell()){this.beans.rowRenderer.redrawRow(this.rowNode);return}if(this.isFullWidth()){this.refreshFullWidth()||this.beans.rowRenderer.redrawRow(this.rowNode);return}this.getAllCellCtrls().forEach(n=>n.refreshCell({suppressFlash:!e.update,newData:!e.update})),this.allRowGuis.forEach(n=>{this.setRowCompRowId(n.rowComp),this.updateRowBusinessKey(),this.setRowCompRowBusinessKey(n.rowComp)}),this.onRowSelected(),this.postProcessCss()}postProcessCss(){this.setStylesFromGridOptions(!0),this.postProcessClassesFromGridOptions(),this.postProcessRowClassRules(),this.postProcessRowDragging()}onRowNodeHighlightChanged(){const e=this.rowNode.highlighted;this.allRowGuis.forEach(i=>{const n=e===0,r=e===1;i.rowComp.addOrRemoveCssClass("ag-row-highlight-above",n),i.rowComp.addOrRemoveCssClass("ag-row-highlight-below",r)})}postProcessRowDragging(){const e=this.rowNode.dragging;this.allRowGuis.forEach(i=>i.rowComp.addOrRemoveCssClass("ag-row-dragging",e))}updateExpandedCss(){const e=this.rowNode.isExpandable(),i=this.rowNode.expanded==!0;this.allRowGuis.forEach(n=>{n.rowComp.addOrRemoveCssClass("ag-row-group",e),n.rowComp.addOrRemoveCssClass("ag-row-group-expanded",e&&i),n.rowComp.addOrRemoveCssClass("ag-row-group-contracted",e&&!i),MT(n.element,e&&i)})}onDisplayedColumnsChanged(){this.updateColumnLists(!0),this.beans.columnModel.wasAutoRowHeightEverActive()&&this.rowNode.checkAutoHeights()}onVirtualColumnsChanged(){this.updateColumnLists(!1,!0)}getRowPosition(){return{rowPinned:Pd(this.rowNode.rowPinned),rowIndex:this.rowNode.rowIndex}}findFullWidthRowGui(e){return this.allRowGuis.find(i=>i.element.contains(e))}onKeyboardNavigate(e){const i=this.findFullWidthRowGui(e.target);if(!((i?i.element:null)===e.target))return;const s=this.rowNode,o=this.beans.focusService.getFocusedCell(),a={rowIndex:s.rowIndex,rowPinned:s.rowPinned,column:o?.column??this.getColumnForFullWidth(i)};this.beans.navigationService.navigateToNextCell(e,e.key,a,!0),e.preventDefault()}onTabKeyDown(e){if(e.defaultPrevented||Ed(e))return;const i=this.allRowGuis.find(l=>l.element.contains(e.target)),n=i?i.element:null,r=n===e.target,s=Jr(this.gos);let o=!1;n&&s&&(o=n.contains(s)&&s.classList.contains("ag-cell"));let a=null;!r&&!o&&(a=this.beans.focusService.findNextFocusableElement(n,!1,e.shiftKey)),(this.isFullWidth()&&r||!a)&&this.beans.navigationService.onTabKeyDown(this,e)}getFullWidthElement(){return this.fullWidthGui?this.fullWidthGui.element:null}getRowYPosition(){const e=this.allRowGuis.find(i=>Ou(i.element))?.element;return e?e.getBoundingClientRect().top:0}onSuppressCellFocusChanged(e){const i=this.isFullWidth()&&e?void 0:-1;this.allRowGuis.forEach(n=>{Vc(n.element,"tabindex",i)})}onFullWidthRowFocused(e){const i=this.rowNode,n=e?this.isFullWidth()&&e.rowIndex===i.rowIndex&&e.rowPinned==i.rowPinned:!1,r=this.fullWidthGui?this.fullWidthGui.element:this.centerGui?.element;r&&(r.classList.toggle("ag-full-width-focus",n),n&&e?.forceBrowserFocus&&r.focus({preventScroll:!0}))}recreateCell(e){this.centerCellCtrls=this.removeCellCtrl(this.centerCellCtrls,e),this.leftCellCtrls=this.removeCellCtrl(this.leftCellCtrls,e),this.rightCellCtrls=this.removeCellCtrl(this.rightCellCtrls,e),e.destroy(),this.updateColumnLists()}removeCellCtrl(e,i){const n={list:[],map:{}};return e.list.forEach(r=>{r!==i&&(n.list.push(r),n.map[r.getColumn().getInstanceId()]=r)}),n}onMouseEvent(e,i){switch(e){case"dblclick":this.onRowDblClick(i);break;case"click":this.onRowClick(i);break;case"touchstart":case"mousedown":this.onRowMouseDown(i);break}}createRowEvent(e,i){return this.gos.addGridCommonParams({type:e,node:this.rowNode,data:this.rowNode.data,rowIndex:this.rowNode.rowIndex,rowPinned:this.rowNode.rowPinned,event:i})}createRowEventWithSource(e,i){const n=this.createRowEvent(e,i);return n.source=this,n}onRowDblClick(e){Ed(e)||this.beans.eventService.dispatchEvent(this.createRowEventWithSource("rowDoubleClicked",e))}getColumnForFullWidth(e){const{visibleColsService:i}=this.beans;switch(e?.containerType){case"center":return i.getCenterCols()[0];case"left":return i.getLeftCols()[0];case"right":return i.getRightCols()[0];default:return i.getAllCols()[0]}}onRowMouseDown(e){if(this.lastMouseDownOnDragger=e0(e.target,"ag-row-drag",3),!this.isFullWidth())return;const i=this.rowNode;this.beans.rangeService&&this.beans.rangeService.removeAllCellRanges();const n=this.findFullWidthRowGui(e.target),r=n?.element,s=e.target;let o=!0;r&&r.contains(s)&&cU(s)&&(o=!1),this.beans.focusService.setFocusedCell({rowIndex:i.rowIndex,column:this.getColumnForFullWidth(n),rowPinned:i.rowPinned,forceBrowserFocus:o})}onRowClick(e){if(Ed(e)||this.lastMouseDownOnDragger)return;const{gos:n}=this;this.beans.eventService.dispatchEvent(this.createRowEventWithSource("rowClicked",e));const r=e.ctrlKey||e.metaKey,s=e.shiftKey,o=this.rowNode.isSelected(),a=Lg(n),l=t6(n),u=$0e(n);if(a&&this.rowNode.group||this.isRowSelectionBlocked()||!u&&!o||!l&&o)return;const d=W0e(n),p="rowClicked";if(o)d?this.rowNode.setSelectedParams({newValue:!1,event:e,source:p}):r?l&&this.rowNode.setSelectedParams({newValue:!1,event:e,source:p}):u&&this.rowNode.setSelectedParams({newValue:!0,clearSelection:!s,rangeSelect:s,event:e,source:p});else{const v=d?!1:!r;this.rowNode.setSelectedParams({newValue:!0,clearSelection:v,rangeSelect:s,event:e,source:p})}}isRowSelectionBlocked(){return!this.rowNode.selectable||!!this.rowNode.rowPinned||!wT(this.gos)}setupDetailRowAutoHeight(e){if(this.rowType!=="FullWidthDetail"||!this.gos.get("detailRowAutoHeight"))return;const i=()=>{const r=e.clientHeight;if(r!=null&&r>0){const s=()=>{this.rowNode.setRowHeight(r),(ls(this.gos)||tf(this.gos))&&this.beans.rowModel.onRowHeightChanged()};window.setTimeout(s,0)}},n=this.beans.resizeObserverService.observeResize(e,i);this.addDestroyFunc(n),i()}createFullWidthCompDetails(e,i){const{gos:n,rowNode:r}=this,s=n.addGridCommonParams({fullWidth:!0,data:r.data,node:r,value:r.key,valueFormatted:r.key,eGridCell:e,eParentOfValue:e,pinned:i,addRenderedRowListener:this.addEventListener.bind(this),registerRowDragger:(a,l,u,d)=>this.addFullWidthRowDragging(a,l,u,d),setTooltip:(a,l)=>this.refreshRowTooltip(a,l)}),o=this.beans.userComponentFactory;switch(this.rowType){case"FullWidthDetail":return o.getFullWidthDetailCellRendererDetails(s);case"FullWidthGroup":return o.getFullWidthGroupCellRendererDetails(s);case"FullWidthLoading":return o.getFullWidthLoadingCellRendererDetails(s);default:return o.getFullWidthCellRendererDetails(s)}}refreshRowTooltip(e,i){if(!this.fullWidthGui)return;const n={getGui:()=>this.fullWidthGui.element,getTooltipValue:()=>e,getLocation:()=>"fullWidthRow",shouldDisplayTooltip:i};this.tooltipFeature&&this.destroyBean(this.tooltipFeature,this.beans.context),this.tooltipFeature=this.createBean(new nx(n,this.beans))}addFullWidthRowDragging(e,i,n="",r){if(!this.isFullWidth())return;const s=new Sz(()=>n,this.rowNode,void 0,e,i,r);this.createBean(s,this.beans.context),this.addDestroyFunc(()=>{this.destroyBean(s,this.beans.context)})}onUiLevelChanged(){const e=this.beans.rowCssClassCalculator.calculateRowLevel(this.rowNode);if(this.rowLevel!=e){const i="ag-row-level-"+e,n="ag-row-level-"+this.rowLevel;this.allRowGuis.forEach(r=>{r.rowComp.addOrRemoveCssClass(i,!0),r.rowComp.addOrRemoveCssClass(n,!1)})}this.rowLevel=e}isFirstRowOnPage(){return this.rowNode.rowIndex===this.beans.pageBoundsService.getFirstRow()}isLastRowOnPage(){return this.rowNode.rowIndex===this.beans.pageBoundsService.getLastRow()}refreshFirstAndLastRowStyles(){const e=this.isFirstRowOnPage(),i=this.isLastRowOnPage();this.firstRowOnPage!==e&&(this.firstRowOnPage=e,this.allRowGuis.forEach(n=>n.rowComp.addOrRemoveCssClass("ag-row-first",e))),this.lastRowOnPage!==i&&(this.lastRowOnPage=i,this.allRowGuis.forEach(n=>n.rowComp.addOrRemoveCssClass("ag-row-last",i)))}stopEditing(e=!1){this.stoppingRowEdit||this.beans.rowEditService?.stopEditing(this,e)}setInlineEditingCss(){const e=this.editingRow||this.getAllCellCtrls().some(i=>i.isEditing());this.allRowGuis.forEach(i=>{i.rowComp.addOrRemoveCssClass("ag-row-inline-editing",e),i.rowComp.addOrRemoveCssClass("ag-row-not-inline-editing",!e)})}setEditingRow(e){this.editingRow=e}startRowEditing(e=null,i=null,n=null){return this.editingRow?!0:this.beans.rowEditService?.startEditing(this,e,i,n)??!0}getAllCellCtrls(){return this.leftCellCtrls.list.length===0&&this.rightCellCtrls.list.length===0?this.centerCellCtrls.list:[...this.centerCellCtrls.list,...this.leftCellCtrls.list,...this.rightCellCtrls.list]}postProcessClassesFromGridOptions(){const e=this.beans.rowCssClassCalculator.processClassesFromGridOptions(this.rowNode);!e||!e.length||e.forEach(i=>{this.allRowGuis.forEach(n=>n.rowComp.addOrRemoveCssClass(i,!0))})}postProcessRowClassRules(){this.beans.rowCssClassCalculator.processRowClassRules(this.rowNode,e=>{this.allRowGuis.forEach(i=>i.rowComp.addOrRemoveCssClass(e,!0))},e=>{this.allRowGuis.forEach(i=>i.rowComp.addOrRemoveCssClass(e,!1))})}setStylesFromGridOptions(e,i){e&&(this.rowStyles=this.processStylesFromGridOptions()),this.forEachGui(i,n=>n.rowComp.setUserStyles(this.rowStyles))}getPinnedForContainer(e){return e==="left"||e==="right"?e:null}getInitialRowClasses(e){const i=this.getPinnedForContainer(e),n={rowNode:this.rowNode,rowFocused:this.rowFocused,fadeRowIn:this.fadeInAnimation[e],rowIsEven:this.rowNode.rowIndex%2===0,rowLevel:this.rowLevel,fullWidthRow:this.isFullWidth(),firstRowOnPage:this.isFirstRowOnPage(),lastRowOnPage:this.isLastRowOnPage(),printLayout:this.printLayout,expandable:this.rowNode.isExpandable(),pinned:i};return this.beans.rowCssClassCalculator.getInitialRowClasses(n)}processStylesFromGridOptions(){const e=this.gos.get("rowStyle");if(e&&typeof e=="function"){Wt("rowStyle should be an object of key/value styles, not be a function, use getRowStyle() instead");return}const i=this.gos.getCallback("getRowStyle");let n;if(i){const r={data:this.rowNode.data,node:this.rowNode,rowIndex:this.rowNode.rowIndex};n=i(r)}return n||e?Object.assign({},e,n):this.emptyStyle}onRowSelected(e){const i=!!this.rowNode.isSelected();this.forEachGui(e,n=>{n.rowComp.addOrRemoveCssClass("ag-row-selected",i),TT(n.element,i),n.element.contains(Jr(this.gos))&&(n===this.centerGui||n===this.fullWidthGui)&&this.announceDescription()})}announceDescription(){if(this.isRowSelectionBlocked())return;const e=this.rowNode.isSelected();if(e&&!t6(this.gos))return;const n=this.beans.localeService.getLocaleTextFunc()(e?"ariaRowDeselect":"ariaRowSelect",`Press SPACE to ${e?"deselect":"select"} this row.`);this.beans.ariaAnnouncementService.announceValue(n,"rowSelection")}addHoverFunctionality(e){if(!this.active)return;const{element:i,compBean:n}=e,{rowNode:r,beans:s,gos:o}=this;n.addManagedListeners(i,{mouseenter:()=>r.onMouseEnter(),mouseleave:()=>r.onMouseLeave()}),n.addManagedListeners(r,{mouseEnter:()=>{!s.dragService.isDragging()&&!o.get("suppressRowHoverHighlight")&&(i.classList.add("ag-row-hover"),r.setHovered(!0))},mouseLeave:()=>{i.classList.remove("ag-row-hover"),r.setHovered(!1)}})}roundRowTopToBounds(e){const i=this.beans.ctrlsService.getGridBodyCtrl().getScrollFeature().getApproximateVScollPosition(),n=this.applyPaginationOffset(i.top,!0)-100,r=this.applyPaginationOffset(i.bottom,!0)+100;return Math.min(Math.max(n,e),r)}getFrameworkOverrides(){return this.beans.frameworkOverrides}forEachGui(e,i){e?i(e):this.allRowGuis.forEach(i)}onRowHeightChanged(e){if(this.rowNode.rowHeight==null)return;const i=this.rowNode.rowHeight,n=this.beans.environment.getDefaultRowHeight(),s=aY(this.gos)?Mp(this.gos,this.rowNode).height:void 0,o=s?`${Math.min(n,s)-2}px`:void 0;this.forEachGui(e,a=>{a.element.style.height=`${i}px`,o&&a.element.style.setProperty("--ag-line-height",o)})}addEventListener(e,i){super.addEventListener(e,i)}removeEventListener(e,i){super.removeEventListener(e,i)}destroyFirstPass(e=!1){if(this.active=!1,!e&&Jy(this.gos)&&!this.isSticky())if(this.rowNode.rowTop!=null){const r=this.roundRowTopToBounds(this.rowNode.rowTop);this.setRowTop(r)}else this.allRowGuis.forEach(r=>r.rowComp.addOrRemoveCssClass("ag-opacity-zero",!0));this.rowNode.setHovered(!1);const i=this.createRowEvent("virtualRowRemoved");this.dispatchLocalEvent(i),this.beans.eventService.dispatchEvent(i),super.destroy()}destroySecondPass(){this.allRowGuis.length=0,this.stopEditing();const e=i=>(i.list.forEach(n=>n.destroy()),{list:[],map:{}});this.centerCellCtrls=e(this.centerCellCtrls),this.leftCellCtrls=e(this.leftCellCtrls),this.rightCellCtrls=e(this.rightCellCtrls)}setFocusedClasses(e){this.forEachGui(e,i=>{i.rowComp.addOrRemoveCssClass("ag-row-focus",this.rowFocused),i.rowComp.addOrRemoveCssClass("ag-row-no-focus",!this.rowFocused)})}onCellFocusChanged(){const e=this.beans.focusService.isRowFocused(this.rowNode.rowIndex,this.rowNode.rowPinned);e!==this.rowFocused&&(this.rowFocused=e,this.setFocusedClasses()),!e&&this.editingRow&&this.stopEditing(!1)}onPaginationChanged(){const e=this.beans.paginationService?.getCurrentPage()??0;this.paginationPage!==e&&(this.paginationPage=e,this.onTopChanged()),this.refreshFirstAndLastRowStyles()}onTopChanged(){this.setRowTop(this.rowNode.rowTop)}onPaginationPixelOffsetChanged(){this.onTopChanged()}applyPaginationOffset(e,i=!1){if(this.rowNode.isRowPinned()||this.rowNode.sticky)return e;const n=this.beans.pageBoundsService.getPixelOffset();return e+n*(i?1:-1)}setRowTop(e){if(!this.printLayout&&oi(e)){const i=this.applyPaginationOffset(e),s=`${this.rowNode.isRowPinned()||this.rowNode.sticky?i:this.beans.rowContainerHeightService.getRealPixelPosition(i)}px`;this.setRowTopStyle(s)}}getInitialRowTop(e){return this.suppressRowTransform?this.getInitialRowTopShared(e):void 0}getInitialTransform(e){return this.suppressRowTransform?void 0:`translateY(${this.getInitialRowTopShared(e)})`}getInitialRowTopShared(e){if(this.printLayout)return"";const i=this.rowNode;let n;if(this.isSticky())n=i.stickyRowTop;else{const r=this.slideInAnimation[e]?this.roundRowTopToBounds(i.oldRowTop):i.rowTop,s=this.applyPaginationOffset(r);n=i.isRowPinned()?s:this.beans.rowContainerHeightService.getRealPixelPosition(s)}return n+"px"}setRowTopStyle(e){this.allRowGuis.forEach(i=>this.suppressRowTransform?i.rowComp.setTop(e):i.rowComp.setTransform(`translateY(${e})`))}getRowNode(){return this.rowNode}getCellCtrl(e){let i=null;return this.getAllCellCtrls().forEach(n=>{n.getColumn()==e&&(i=n)}),i!=null||this.getAllCellCtrls().forEach(n=>{n.getColSpanningList().indexOf(e)>=0&&(i=n)}),i}onRowIndexChanged(){this.rowNode.rowIndex!=null&&(this.onCellFocusChanged(),this.updateRowIndexes(),this.postProcessCss())}getRowIndex(){return this.rowNode.getRowIndexString()}updateRowIndexes(e){const i=this.rowNode.getRowIndexString();if(i===null)return;const n=this.beans.headerNavigationService.getHeaderRowCount()+(this.beans.filterManager?.getHeaderRowCount()??0),r=this.rowNode.rowIndex%2===0,s=n+this.rowNode.rowIndex+1;this.forEachGui(e,o=>{o.rowComp.setRowIndex(i),o.rowComp.addOrRemoveCssClass("ag-row-even",r),o.rowComp.addOrRemoveCssClass("ag-row-odd",!r),EY(o.element,s)})}setStoppingRowEdit(e){this.stoppingRowEdit=e}};AJ.DOM_DATA_KEY_ROW_CTRL="renderedRow";var mg=AJ,lCe=class extends kt{wireBeans(t){this.mouseEventService=t.mouseEventService,this.valueService=t.valueService,this.menuService=t.menuService,this.ctrlsService=t.ctrlsService,this.navigationService=t.navigationService,this.focusService=t.focusService,this.undoRedoService=t.undoRedoService,this.visibleColsService=t.visibleColsService,this.rowModel=t.rowModel,this.pinnedRowModel=t.pinnedRowModel,this.rangeService=t.rangeService,this.clipboardService=t.clipboardService}constructor(t){super(),this.element=t}postConstruct(){this.addKeyboardListeners(),this.addMouseListeners(),this.mockContextMenuForIPad()}addKeyboardListeners(){const t="keydown",e=this.processKeyboardEvent.bind(this,t);this.addManagedElementListeners(this.element,{[t]:e})}addMouseListeners(){["dblclick","contextmenu","mouseover","mouseout","click",vY("touchstart")?"touchstart":"mousedown"].forEach(i=>{const n=this.processMouseEvent.bind(this,i);this.addManagedElementListeners(this.element,{[i]:n})})}processMouseEvent(t,e){if(!this.mouseEventService.isEventFromThisGrid(e)||Ed(e))return;const i=this.getRowForEvent(e),n=this.mouseEventService.getRenderedCellForEvent(e);t==="contextmenu"?this.handleContextMenuMouseEvent(e,void 0,i,n):(n&&n.onMouseEvent(t,e),i&&i.onMouseEvent(t,e))}mockContextMenuForIPad(){if(!Np())return;const t=new mp(this.element),e=i=>{const n=this.getRowForEvent(i.touchEvent),r=this.mouseEventService.getRenderedCellForEvent(i.touchEvent);this.handleContextMenuMouseEvent(void 0,i.touchEvent,n,r)};this.addManagedListeners(t,{longTap:e}),this.addDestroyFunc(()=>t.destroy())}getRowForEvent(t){let e=t.target;for(;e;){const i=G_(this.gos,e,mg.DOM_DATA_KEY_ROW_CTRL);if(i)return i;e=e.parentElement}return null}handleContextMenuMouseEvent(t,e,i,n){const r=i?i.getRowNode():null,s=n?n.getColumn():null;let o=null;if(s){const u=t||e;n.dispatchCellContextMenuEvent(u??null),o=this.valueService.getValue(s,r)}const a=this.ctrlsService.getGridBodyCtrl(),l=n?n.getGui():a.getGridBodyElement();this.menuService.showContextMenu({mouseEvent:t,touchEvent:e,rowNode:r,column:s,value:o,anchorToElement:l})}getControlsForEventTarget(t){return{cellCtrl:mz(this.gos,t,pg.DOM_DATA_KEY_CELL_CTRL),rowCtrl:mz(this.gos,t,mg.DOM_DATA_KEY_ROW_CTRL)}}processKeyboardEvent(t,e){const{cellCtrl:i,rowCtrl:n}=this.getControlsForEventTarget(e.target);e.defaultPrevented||(i?this.processCellKeyboardEvent(i,t,e):n&&n.isFullWidth()&&this.processFullWidthRowKeyboardEvent(n,t,e))}processCellKeyboardEvent(t,e,i){const n=t.getRowNode(),r=t.getColumn(),s=t.isEditing();!Oz(this.gos,i,n,r,s)&&e==="keydown"&&(!s&&this.navigationService.handlePageScrollingKey(i)||t.onKeyDown(i),this.doGridOperations(i,t.isEditing()),lJ(i)&&t.processCharacter(i)),e==="keydown"&&this.eventService.dispatchEvent(t.createEvent(i,"cellKeyDown"))}processFullWidthRowKeyboardEvent(t,e,i){const n=t.getRowNode(),r=this.focusService.getFocusedCell(),s=r&&r.column;if(!Oz(this.gos,i,n,s,!1)){const a=i.key;if(e==="keydown")switch(a){case St.PAGE_HOME:case St.PAGE_END:case St.PAGE_UP:case St.PAGE_DOWN:this.navigationService.handlePageScrollingKey(i,!0);break;case St.UP:case St.DOWN:t.onKeyboardNavigate(i);break;case St.TAB:t.onTabKeyDown(i);break}}e==="keydown"&&this.eventService.dispatchEvent(t.createRowEvent("cellKeyDown",i))}doGridOperations(t,e){if(!t.ctrlKey&&!t.metaKey||e||!this.mouseEventService.isEventFromThisGrid(t))return;const i=lwe(t);if(i===St.A)return this.onCtrlAndA(t);if(i===St.C)return this.onCtrlAndC(t);if(i===St.D)return this.onCtrlAndD(t);if(i===St.V)return this.onCtrlAndV(t);if(i===St.X)return this.onCtrlAndX(t);if(i===St.Y)return this.onCtrlAndY();if(i===St.Z)return this.onCtrlAndZ(t)}onCtrlAndA(t){const{pinnedRowModel:e,rowModel:i,rangeService:n}=this;if(n&&i.isRowsToRender()){const[r,s]=[e.isEmpty("top"),e.isEmpty("bottom")],o=r?null:"top";let a,l;s?(a=null,l=i.getRowCount()-1):(a="bottom",l=e.getPinnedBottomRowCount()-1);const u=this.visibleColsService.getAllCols();if(Kl(u))return;n.setCellRange({rowStartIndex:0,rowStartPinned:o,rowEndIndex:l,rowEndPinned:a,columnStart:u[0],columnEnd:Yn(u)})}t.preventDefault()}onCtrlAndC(t){if(!this.clipboardService||this.gos.get("enableCellTextSelection"))return;const{cellCtrl:e,rowCtrl:i}=this.getControlsForEventTarget(t.target);e?.isEditing()||i?.isEditing()||(t.preventDefault(),this.clipboardService.copyToClipboard())}onCtrlAndX(t){if(!this.clipboardService||this.gos.get("enableCellTextSelection")||this.gos.get("suppressCutToClipboard"))return;const{cellCtrl:e,rowCtrl:i}=this.getControlsForEventTarget(t.target);e?.isEditing()||i?.isEditing()||(t.preventDefault(),this.clipboardService.cutToClipboard(void 0,"ui"))}onCtrlAndV(t){const{cellCtrl:e,rowCtrl:i}=this.getControlsForEventTarget(t.target);e?.isEditing()||i?.isEditing()||this.clipboardService&&!this.gos.get("suppressClipboardPaste")&&this.clipboardService.pasteFromClipboard()}onCtrlAndD(t){this.clipboardService&&!this.gos.get("suppressClipboardPaste")&&this.clipboardService.copyRangeDown(),t.preventDefault()}onCtrlAndZ(t){!this.gos.get("undoRedoCellEditing")||!this.undoRedoService||(t.preventDefault(),t.shiftKey?this.undoRedoService.redo("ui"):this.undoRedoService.undo("ui"))}onCtrlAndY(){this.undoRedoService?.redo("ui")}},cCe=class extends kt{wireBeans(t){this.pinnedWidthService=t.pinnedWidthService}constructor(t){super(),this.element=t}postConstruct(){this.addManagedEventListeners({leftPinnedWidthChanged:this.onPinnedLeftWidthChanged.bind(this)})}onPinnedLeftWidthChanged(){const t=this.pinnedWidthService.getPinnedLeftWidth(),e=t>0;Xr(this.element,e),_u(this.element,t)}getWidth(){return this.pinnedWidthService.getPinnedLeftWidth()}},uCe=class extends kt{wireBeans(t){this.pinnedWidthService=t.pinnedWidthService}constructor(t){super(),this.element=t}postConstruct(){this.addManagedEventListeners({rightPinnedWidthChanged:this.onPinnedRightWidthChanged.bind(this)})}onPinnedRightWidthChanged(){const t=this.pinnedWidthService.getPinnedRightWidth(),e=t>0;Xr(this.element,e),_u(this.element,t)}getWidth(){return this.pinnedWidthService.getPinnedRightWidth()}},j1=t=>t.getTopRowCtrls(),Q1=t=>t.getStickyTopRowCtrls(),Z1=t=>t.getStickyBottomRowCtrls(),X1=t=>t.getBottomRowCtrls(),K1=t=>t.getCentreRowCtrls(),hCe={center:{type:"center",container:"ag-center-cols-container",viewport:"ag-center-cols-viewport",getRowCtrls:K1},left:{type:"left",container:"ag-pinned-left-cols-container",pinnedType:"left",getRowCtrls:K1},right:{type:"right",container:"ag-pinned-right-cols-container",pinnedType:"right",getRowCtrls:K1},fullWidth:{type:"fullWidth",container:"ag-full-width-container",fullWidth:!0,getRowCtrls:K1},topCenter:{type:"center",container:"ag-floating-top-container",viewport:"ag-floating-top-viewport",getRowCtrls:j1},topLeft:{type:"left",container:"ag-pinned-left-floating-top",pinnedType:"left",getRowCtrls:j1},topRight:{type:"right",container:"ag-pinned-right-floating-top",pinnedType:"right",getRowCtrls:j1},topFullWidth:{type:"fullWidth",container:"ag-floating-top-full-width-container",fullWidth:!0,getRowCtrls:j1},stickyTopCenter:{type:"center",container:"ag-sticky-top-container",viewport:"ag-sticky-top-viewport",getRowCtrls:Q1},stickyTopLeft:{type:"left",container:"ag-pinned-left-sticky-top",pinnedType:"left",getRowCtrls:Q1},stickyTopRight:{type:"right",container:"ag-pinned-right-sticky-top",pinnedType:"right",getRowCtrls:Q1},stickyTopFullWidth:{type:"fullWidth",container:"ag-sticky-top-full-width-container",fullWidth:!0,getRowCtrls:Q1},stickyBottomCenter:{type:"center",container:"ag-sticky-bottom-container",viewport:"ag-sticky-bottom-viewport",getRowCtrls:Z1},stickyBottomLeft:{type:"left",container:"ag-pinned-left-sticky-bottom",pinnedType:"left",getRowCtrls:Z1},stickyBottomRight:{type:"right",container:"ag-pinned-right-sticky-bottom",pinnedType:"right",getRowCtrls:Z1},stickyBottomFullWidth:{type:"fullWidth",container:"ag-sticky-bottom-full-width-container",fullWidth:!0,getRowCtrls:Z1},bottomCenter:{type:"center",container:"ag-floating-bottom-container",viewport:"ag-floating-bottom-viewport",getRowCtrls:X1},bottomLeft:{type:"left",container:"ag-pinned-left-floating-bottom",pinnedType:"left",getRowCtrls:X1},bottomRight:{type:"right",container:"ag-pinned-right-floating-bottom",pinnedType:"right",getRowCtrls:X1},bottomFullWidth:{type:"fullWidth",container:"ag-floating-bottom-full-width-container",fullWidth:!0,getRowCtrls:X1}};function Gy(t){return hCe[t]}var dCe=["topCenter","topLeft","topRight"],fCe=["bottomCenter","bottomLeft","bottomRight"],pCe=["center","left","right"],mCe=["center","left","right","fullWidth"],gCe=["stickyTopCenter","stickyBottomCenter","center","topCenter","bottomCenter"],vCe=["left","bottomLeft","topLeft","stickyTopLeft","stickyBottomLeft"],yCe=["right","bottomRight","topRight","stickyTopRight","stickyBottomRight"],IJ=["stickyTopCenter","stickyTopLeft","stickyTopRight"],kJ=["stickyBottomCenter","stickyBottomLeft","stickyBottomRight"],xCe=[...IJ,"stickyTopFullWidth",...kJ,"stickyBottomFullWidth"],bCe=[...dCe,...fCe,...pCe,...IJ,...kJ],wCe=class extends kt{constructor(t){super(),this.visible=!0,this.EMPTY_CTRLS=[],this.name=t,this.options=Gy(t)}wireBeans(t){this.dragService=t.dragService,this.ctrlsService=t.ctrlsService,this.columnViewportService=t.columnViewportService,this.resizeObserverService=t.resizeObserverService,this.rowRenderer=t.rowRenderer}postConstruct(){this.enableRtl=this.gos.get("enableRtl"),this.forContainers(["center"],()=>{this.viewportSizeFeature=this.createManagedBean(new D_e(this)),this.addManagedEventListeners({stickyTopOffsetChanged:this.onStickyTopOffsetChanged.bind(this)})})}onStickyTopOffsetChanged(t){this.comp.setOffsetTop(`${t.offset}px`)}registerWithCtrlsService(){this.options.fullWidth||this.ctrlsService.register(this.name,this)}forContainers(t,e){t.indexOf(this.name)>=0&&e()}getContainerElement(){return this.eContainer}getViewportSizeFeature(){return this.viewportSizeFeature}setComp(t,e,i){this.comp=t,this.eContainer=e,this.eViewport=i,this.createManagedBean(new lCe(this.eContainer)),this.addPreventScrollWhileDragging(),this.listenOnDomOrder();const n=()=>this.onPinnedWidthChanged();this.forContainers(vCe,()=>{this.pinnedWidthFeature=this.createManagedBean(new cCe(this.eContainer)),this.addManagedEventListeners({leftPinnedWidthChanged:n})}),this.forContainers(yCe,()=>{this.pinnedWidthFeature=this.createManagedBean(new uCe(this.eContainer)),this.addManagedEventListeners({rightPinnedWidthChanged:n})}),this.forContainers(mCe,()=>this.createManagedBean(new PJ(this.eContainer,this.name==="center"?i:void 0))),this.forContainers(bCe,()=>this.createManagedBean(new L_e(this.eContainer))),this.forContainers(gCe,()=>this.createManagedBean(new MU(r=>this.comp.setContainerWidth(`${r}px`)))),this.visible=this.isContainerVisible(),this.addListeners(),this.registerWithCtrlsService()}onScrollCallback(t){this.addManagedElementListeners(this.getViewportElement(),{scroll:t})}addListeners(){this.addManagedEventListeners({displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this),displayedColumnsWidthChanged:this.onDisplayedColumnsWidthChanged.bind(this),displayedRowsChanged:t=>this.onDisplayedRowsChanged(t.afterScroll)}),this.onDisplayedColumnsChanged(),this.onDisplayedColumnsWidthChanged(),this.onDisplayedRowsChanged()}listenOnDomOrder(){if(xCe.indexOf(this.name)>=0){this.comp.setDomOrder(!0);return}const e=()=>{const i=this.gos.get("ensureDomOrder"),n=Zo(this.gos,"print");this.comp.setDomOrder(i||n)};this.addManagedPropertyListener("domLayout",e),e()}onDisplayedColumnsChanged(){this.forContainers(["center"],()=>this.onHorizontalViewportChanged())}onDisplayedColumnsWidthChanged(){this.forContainers(["center"],()=>this.onHorizontalViewportChanged())}addPreventScrollWhileDragging(){const t=e=>{this.dragService.isDragging()&&e.cancelable&&e.preventDefault()};this.eContainer.addEventListener("touchmove",t,{passive:!1}),this.addDestroyFunc(()=>this.eContainer.removeEventListener("touchmove",t))}onHorizontalViewportChanged(t=!1){const e=this.getCenterWidth(),i=this.getCenterViewportScrollLeft();this.columnViewportService.setScrollPosition(e,i,t)}hasHorizontalScrollGap(){return this.eContainer.clientWidth-this.eViewport.clientWidth<0}hasVerticalScrollGap(){return this.eContainer.clientHeight-this.eViewport.clientHeight<0}getCenterWidth(){return zC(this.eViewport)}getCenterViewportScrollLeft(){return ET(this.eViewport,this.enableRtl)}registerViewportResizeListener(t){const e=this.resizeObserverService.observeResize(this.eViewport,t);this.addDestroyFunc(()=>e())}isViewportInTheDOMTree(){return zY(this.eViewport)}getViewportScrollLeft(){return ET(this.eViewport,this.enableRtl)}isHorizontalScrollShowing(){return this.gos.get("alwaysShowHorizontalScroll")||$xe(this.eViewport)}getViewportElement(){return this.eViewport}setHorizontalScroll(t){this.comp.setHorizontalScroll(t)}getHScrollPosition(){return{left:this.eViewport.scrollLeft,right:this.eViewport.scrollLeft+this.eViewport.offsetWidth}}setCenterViewportScrollLeft(t){AT(this.eViewport,t,this.enableRtl)}isContainerVisible(){return!(this.options.pinnedType!=null)||!!this.pinnedWidthFeature&&this.pinnedWidthFeature.getWidth()>0}onPinnedWidthChanged(){const t=this.isContainerVisible();this.visible!=t&&(this.visible=t,this.onDisplayedRowsChanged())}onDisplayedRowsChanged(t=!1){const e=this.options.getRowCtrls(this.rowRenderer);if(!this.visible||e.length===0){this.comp.setRowCtrls({rowCtrls:this.EMPTY_CTRLS});return}const i=Zo(this.gos,"print"),r=this.gos.get("embedFullWidthRows")||i,s=e.filter(o=>{const a=o.isFullWidth();return this.options.fullWidth?!r&&a:r||!a});this.comp.setRowCtrls({rowCtrls:s,useFlushSync:t})}},DJ="ag-force-vertical-scroll",_Ce="ag-selectable",CCe="ag-column-moving",SCe=class extends kt{constructor(){super(...arguments),this.stickyTopHeight=0,this.stickyBottomHeight=0}wireBeans(t){this.animationFrameService=t.animationFrameService,this.rowContainerHeightService=t.rowContainerHeightService,this.ctrlsService=t.ctrlsService,this.columnModel=t.columnModel,this.columnSizeService=t.columnSizeService,this.scrollVisibleService=t.scrollVisibleService,this.menuService=t.menuService,this.headerNavigationService=t.headerNavigationService,this.dragAndDropService=t.dragAndDropService,this.pinnedRowModel=t.pinnedRowModel,this.rowRenderer=t.rowRenderer,this.popupService=t.popupService,this.mouseEventService=t.mouseEventService,this.rowModel=t.rowModel,this.filterManager=t.filterManager,this.environment=t.environment}getScrollFeature(){return this.bodyScrollFeature}getBodyViewportElement(){return this.eBodyViewport}setComp(t,e,i,n,r,s,o){this.comp=t,this.eGridBody=e,this.eBodyViewport=i,this.eTop=n,this.eBottom=r,this.eStickyTop=s,this.eStickyBottom=o,this.eCenterColsViewport=i.querySelector(`.${Gy("center").viewport}`),this.eFullWidthContainer=i.querySelector(`.${Gy("fullWidth").container}`),this.eStickyTopFullWidthContainer=s.querySelector(`.${Gy("stickyTopFullWidth").container}`),this.eStickyBottomFullWidthContainer=o.querySelector(`.${Gy("stickyBottomFullWidth").container}`),this.setCellTextSelection(this.gos.get("enableCellTextSelection")),this.addManagedPropertyListener("enableCellTextSelection",a=>this.setCellTextSelection(a.currentValue)),this.createManagedBean(new RU(this.comp)),this.bodyScrollFeature=this.createManagedBean(new k_e(this.eBodyViewport)),this.addRowDragListener(),this.setupRowAnimationCssClass(),this.addEventListeners(),this.addFocusListeners([n,i,r,s,o]),this.onGridColumnsChanged(),this.addBodyViewportListener(),this.setFloatingHeights(),this.disableBrowserDragging(),this.addStopEditingWhenGridLosesFocus(),this.updateScrollingClasses(),this.filterManager?.setupAdvancedFilterHeaderComp(n),this.ctrlsService.register("gridBodyCtrl",this)}getComp(){return this.comp}addEventListeners(){const t=this.setFloatingHeights.bind(this);this.addManagedEventListeners({gridColumnsChanged:this.onGridColumnsChanged.bind(this),scrollVisibilityChanged:this.onScrollVisibilityChanged.bind(this),scrollGapChanged:this.onScrollGapChanged.bind(this),pinnedRowDataChanged:t,pinnedHeightChanged:t,headerHeightChanged:this.onHeaderHeightChanged.bind(this)})}addFocusListeners(t){t.forEach(e=>{this.addManagedElementListeners(e,{focusin:i=>{const{target:n}=i,r=e0(n,"ag-root",e);e.classList.toggle("ag-has-focus",!r)},focusout:i=>{const{target:n,relatedTarget:r}=i,s=e.contains(r),o=e0(r,"ag-root",e);e0(n,"ag-root",e)||(!s||o)&&e.classList.remove("ag-has-focus")}})})}setColumnMovingCss(t){this.comp.setColumnMovingCss(CCe,t)}setCellTextSelection(t=!1){this.comp.setCellSelectableCss(_Ce,t)}onScrollVisibilityChanged(){const t=this.scrollVisibleService.isVerticalScrollShowing();this.setVerticalScrollPaddingVisible(t),this.setStickyWidth(t),this.setStickyBottomOffsetBottom();const e=t&&this.scrollVisibleService.getScrollbarWidth()||0,i=LY()?16:0,n=`calc(100% + ${e+i}px)`;this.animationFrameService.requestAnimationFrame(()=>this.comp.setBodyViewportWidth(n)),this.updateScrollingClasses()}onScrollGapChanged(){this.updateScrollingClasses()}updateScrollingClasses(){this.eGridBody.classList.toggle("ag-body-vertical-content-no-gap",!this.scrollVisibleService.hasVerticalScrollGap()),this.eGridBody.classList.toggle("ag-body-horizontal-content-no-gap",!this.scrollVisibleService.hasHorizontalScrollGap())}onGridColumnsChanged(){const t=this.columnModel.getCols();this.comp.setColumnCount(t.length)}disableBrowserDragging(){this.addManagedElementListeners(this.eGridBody,{dragstart:t=>{if(t.target instanceof HTMLImageElement)return t.preventDefault(),!1}})}addStopEditingWhenGridLosesFocus(){if(!this.gos.get("stopEditingWhenCellsLoseFocus"))return;const t=i=>{const n=i.relatedTarget;if(_z(n)===null){this.rowRenderer.stopEditing();return}let r=e.some(s=>s.contains(n))&&this.mouseEventService.isElementInThisGrid(n);if(!r){const s=this.popupService;r=s.getActivePopups().some(o=>o.contains(n))||s.isElementWithinCustomPopup(n)}r||this.rowRenderer.stopEditing()},e=[this.eBodyViewport,this.eBottom,this.eTop,this.eStickyTop,this.eStickyBottom];e.forEach(i=>this.addManagedElementListeners(i,{focusout:t}))}updateRowCount(){const t=this.headerNavigationService.getHeaderRowCount()+(this.filterManager?.getHeaderRowCount()??0),e=this.rowModel.isLastRowIndexKnown()?this.rowModel.getRowCount():-1,i=e===-1?-1:t+e;this.comp.setRowCount(i)}registerBodyViewportResizeListener(t){this.comp.registerBodyViewportResizeListener(t)}setVerticalScrollPaddingVisible(t){const e=t?"scroll":"hidden";this.comp.setPinnedTopBottomOverflowY(e)}isVerticalScrollShowing(){const t=this.gos.get("alwaysShowVerticalScroll"),e=t?DJ:null,i=Zo(this.gos,"normal");return this.comp.setAlwaysVerticalScrollClass(e,t),t||i&&Wxe(this.eBodyViewport)}setupRowAnimationCssClass(){let t=this.environment.hasMeasuredSizes();const e=()=>{const i=t&&Jy(this.gos)&&!this.rowContainerHeightService.isStretching(),n=i?"ag-row-animation":"ag-row-no-animation";this.comp.setRowAnimationCssOnBodyViewport(n,i)};e(),this.addManagedEventListeners({heightScaleChanged:e}),this.addManagedPropertyListener("animateRows",e),this.addManagedEventListeners({gridStylesChanged:()=>{!t&&this.environment.hasMeasuredSizes()&&(t=!0,e())}})}getGridBodyElement(){return this.eGridBody}addBodyViewportListener(){const t=this.onBodyViewportContextMenu.bind(this);this.addManagedElementListeners(this.eBodyViewport,{contextmenu:t}),this.mockContextMenuForIPad(t),this.addManagedElementListeners(this.eBodyViewport,{wheel:this.onBodyViewportWheel.bind(this)}),this.addManagedElementListeners(this.eStickyTop,{wheel:this.onStickyWheel.bind(this)}),this.addManagedElementListeners(this.eStickyBottom,{wheel:this.onStickyWheel.bind(this)}),this.addFullWidthContainerWheelListener()}addFullWidthContainerWheelListener(){this.addManagedElementListeners(this.eFullWidthContainer,{wheel:t=>this.onFullWidthContainerWheel(t)})}onFullWidthContainerWheel(t){const{deltaX:e,deltaY:i,shiftKey:n}=t;(n||Math.abs(e)>Math.abs(i))&&this.mouseEventService.isEventFromThisGrid(t)&&this.scrollGridBodyToMatchEvent(t)}onStickyWheel(t){const{deltaX:e,deltaY:i,shiftKey:n}=t,r=n||Math.abs(e)>Math.abs(i),s=t.target;r?(this.eStickyTopFullWidthContainer.contains(s)||this.eStickyBottomFullWidthContainer.contains(s))&&this.scrollGridBodyToMatchEvent(t):(t.preventDefault(),this.scrollVertically(i))}scrollGridBodyToMatchEvent(t){const{deltaX:e,deltaY:i}=t;t.preventDefault(),this.eCenterColsViewport.scrollBy({left:e||i})}onBodyViewportContextMenu(t,e,i){if(!t&&!i)return;this.gos.get("preventDefaultOnContextMenu")&&(t||i).preventDefault();const{target:n}=t||e;(n===this.eBodyViewport||n===this.ctrlsService.get("center").getViewportElement())&&this.menuService.showContextMenu({mouseEvent:t,touchEvent:i,value:null,anchorToElement:this.eGridBody})}mockContextMenuForIPad(t){if(!Np())return;const e=new mp(this.eBodyViewport),i=n=>{t(void 0,n.touchStart,n.touchEvent)};this.addManagedListeners(e,{longTap:i}),this.addDestroyFunc(()=>e.destroy())}onBodyViewportWheel(t){this.gos.get("suppressScrollWhenPopupsAreOpen")&&this.popupService.hasAnchoredPopup()&&t.preventDefault()}getGui(){return this.eGridBody}scrollVertically(t){const e=this.eBodyViewport.scrollTop;return this.bodyScrollFeature.setVerticalScrollPosition(e+t),this.eBodyViewport.scrollTop-e}addRowDragListener(){this.rowDragFeature=this.createManagedBean(new Gbe(this.eBodyViewport)),this.dragAndDropService.addDropTarget(this.rowDragFeature),this.addDestroyFunc(()=>this.dragAndDropService.removeDropTarget(this.rowDragFeature))}getRowDragFeature(){return this.rowDragFeature}setFloatingHeights(){const{pinnedRowModel:t}=this,e=t.getPinnedTopTotalHeight(),i=t.getPinnedBottomTotalHeight();this.comp.setTopHeight(e),this.comp.setBottomHeight(i),this.comp.setTopDisplay(e?"inherit":"none"),this.comp.setBottomDisplay(i?"inherit":"none"),this.setStickyTopOffsetTop(),this.setStickyBottomOffsetBottom()}setStickyTopHeight(t=0){this.comp.setStickyTopHeight(`${t}px`),this.stickyTopHeight=t}getStickyTopHeight(){return this.stickyTopHeight}setStickyBottomHeight(t=0){this.comp.setStickyBottomHeight(`${t}px`),this.stickyBottomHeight=t}getStickyBottomHeight(){return this.stickyBottomHeight}setStickyWidth(t){if(!t)this.comp.setStickyTopWidth("100%"),this.comp.setStickyBottomWidth("100%");else{const e=this.scrollVisibleService.getScrollbarWidth();this.comp.setStickyTopWidth(`calc(100% - ${e}px)`),this.comp.setStickyBottomWidth(`calc(100% - ${e}px)`)}}onHeaderHeightChanged(){this.setStickyTopOffsetTop()}setStickyTopOffsetTop(){const e=this.ctrlsService.get("gridHeaderCtrl").getHeaderHeight()+(this.filterManager?.getHeaderHeight()??0),i=this.pinnedRowModel.getPinnedTopTotalHeight();let n=0;e>0&&(n+=e),i>0&&(n+=i),n>0&&(n+=1),this.comp.setStickyTopTop(`${n}px`)}setStickyBottomOffsetBottom(){const t=this.pinnedRowModel.getPinnedBottomTotalHeight(),i=this.scrollVisibleService.isHorizontalScrollShowing()&&this.scrollVisibleService.getScrollbarWidth()||0,n=t+i;this.comp.setStickyBottomBottom(`${n}px`)}sizeColumnsToFit(t,e){const n=this.isVerticalScrollShowing()?this.scrollVisibleService.getScrollbarWidth():0,s=zC(this.eGridBody)-n;if(s>0){this.columnSizeService.sizeColumnsToFit(s,"sizeColumnsToFit",!1,t);return}e===void 0?window.setTimeout(()=>{this.sizeColumnsToFit(t,100)},0):e===100?window.setTimeout(()=>{this.sizeColumnsToFit(t,500)},100):e===500?window.setTimeout(()=>{this.sizeColumnsToFit(t,-1)},500):Wt("tried to call sizeColumnsToFit() but the grid is coming back with zero width, maybe the grid is not visible yet on the screen?")}addScrollEventListener(t){this.eBodyViewport.addEventListener("scroll",t,{passive:!0})}removeScrollEventListener(t){this.eBodyViewport.removeEventListener("scroll",t)}},OCe=class extends ir{constructor(t,e,i,n,r){super(),this.rendererVersion=0,this.editorVersion=0,this.beans=t,this.column=e.getColumn(),this.rowNode=e.getRowNode(),this.rowCtrl=e.getRowCtrl(),this.eRow=n,this.cellCtrl=e;const s=document.createElement("div");s.setAttribute("comp-id",`${this.getCompId()}`),this.setTemplateFromElement(s);const o=this.getGui();this.forceWrapper=e.isForceWrapper(),this.refreshWrapper(!1),nc(o,e.getCellAriaRole()),o.setAttribute("col-id",e.colIdSanitised);const a={addOrRemoveCssClass:(l,u)=>this.addOrRemoveCssClass(l,u),setUserStyles:l=>UY(o,l),getFocusableElement:()=>this.getFocusableElement(),setIncludeSelection:l=>this.includeSelection=l,setIncludeRowDrag:l=>this.includeRowDrag=l,setIncludeDndSource:l=>this.includeDndSource=l,setRenderDetails:(l,u,d)=>this.setRenderDetails(l,u,d),setEditDetails:(l,u,d)=>this.setEditDetails(l,u,d),getCellEditor:()=>this.cellEditor||null,getCellRenderer:()=>this.cellRenderer||null,getParentOfValue:()=>this.getParentOfValue()};e.setComp(a,this.getGui(),this.eCellWrapper,i,r,void 0)}getParentOfValue(){return this.eCellValue?this.eCellValue:this.eCellWrapper?this.eCellWrapper:this.getGui()}setRenderDetails(t,e,i){if(this.cellEditor&&!this.cellEditorPopupWrapper)return;this.firstRender=this.firstRender==null;const r=this.refreshWrapper(!1);this.refreshEditStyles(!1),t?!(i||r)&&this.refreshCellRenderer(t)||(this.destroyRenderer(),this.createCellRendererInstance(t)):(this.destroyRenderer(),this.insertValueWithoutCellRenderer(e))}setEditDetails(t,e,i){t?this.createCellEditorInstance(t,e,i):this.destroyEditor()}removeControls(){this.checkboxSelectionComp=this.beans.context.destroyBean(this.checkboxSelectionComp),this.dndSourceComp=this.beans.context.destroyBean(this.dndSourceComp),this.rowDraggingComp=this.beans.context.destroyBean(this.rowDraggingComp)}refreshWrapper(t){const e=this.includeRowDrag||this.includeDndSource||this.includeSelection,i=e||this.forceWrapper,n=i&&this.eCellWrapper==null;if(n){const u=document.createElement("div");u.setAttribute("role","presentation"),u.setAttribute("class","ag-cell-wrapper"),this.eCellWrapper=u,this.getGui().appendChild(this.eCellWrapper)}const r=!i&&this.eCellWrapper!=null;r&&(hh(this.eCellWrapper),this.eCellWrapper=void 0),this.addOrRemoveCssClass("ag-cell-value",!i);const s=!t&&i,o=s&&this.eCellValue==null;if(o){const u=document.createElement("span");u.setAttribute("role","presentation"),u.setAttribute("class","ag-cell-value"),this.eCellValue=u,this.eCellWrapper.appendChild(this.eCellValue)}const a=!s&&this.eCellValue!=null;a&&(hh(this.eCellValue),this.eCellValue=void 0);const l=n||r||o||a;return l&&this.removeControls(),t||e&&this.addControls(),l}addControls(){this.includeRowDrag&&this.rowDraggingComp==null&&(this.rowDraggingComp=this.cellCtrl.createRowDragComp(),this.rowDraggingComp&&this.eCellWrapper.insertBefore(this.rowDraggingComp.getGui(),this.eCellValue)),this.includeDndSource&&this.dndSourceComp==null&&(this.dndSourceComp=this.cellCtrl.createDndSource(),this.eCellWrapper.insertBefore(this.dndSourceComp.getGui(),this.eCellValue)),this.includeSelection&&this.checkboxSelectionComp==null&&(this.checkboxSelectionComp=this.cellCtrl.createSelectionCheckbox(),this.eCellWrapper.insertBefore(this.checkboxSelectionComp.getGui(),this.eCellValue))}createCellEditorInstance(t,e,i){const n=this.editorVersion,r=t.newAgStackInstance();if(r==null)return;const{params:s}=t;r.then(a=>this.afterCellEditorCreated(n,a,s,e,i)),Wn(this.cellEditor)&&s.cellStartedEdit&&this.cellCtrl.focusCell(!0)}insertValueWithoutCellRenderer(t){const e=this.getParentOfValue();fa(e);const i=t!=null?yh(t,!0):null;i!=null&&(e.textContent=i)}destroyEditorAndRenderer(){this.destroyRenderer(),this.destroyEditor()}destroyRenderer(){const{context:t}=this.beans;this.cellRenderer=t.destroyBean(this.cellRenderer),hh(this.cellRendererGui),this.cellRendererGui=null,this.rendererVersion++}destroyEditor(){const{context:t}=this.beans;this.hideEditorPopup&&this.hideEditorPopup(),this.hideEditorPopup=void 0,this.cellEditor=t.destroyBean(this.cellEditor),this.cellEditorPopupWrapper=t.destroyBean(this.cellEditorPopupWrapper),hh(this.cellEditorGui),this.cellEditorGui=null,this.editorVersion++}refreshCellRenderer(t){if(this.cellRenderer==null||this.cellRenderer.refresh==null||this.cellRendererClass!==t.componentClass)return!1;const e=this.cellRenderer.refresh(t.params);return e===!0||e===void 0}createCellRendererInstance(t){const i=!this.beans.gos.get("suppressAnimationFrame"),n=this.rendererVersion,{componentClass:r}=t,s=()=>{if(this.rendererVersion!==n||!this.isAlive())return;const a=t.newAgStackInstance(),l=this.afterCellRendererCreated.bind(this,n,r);a&&a.then(l)};i&&this.firstRender?this.beans.animationFrameService.createTask(s,this.rowNode.rowIndex,"createTasksP2"):s()}getCtrl(){return this.cellCtrl}getRowCtrl(){return this.rowCtrl}getCellRenderer(){return this.cellRenderer}getCellEditor(){return this.cellEditor}afterCellRendererCreated(t,e,i){if(!this.isAlive()||t!==this.rendererVersion){this.beans.context.destroyBean(i);return}if(this.cellRenderer=i,this.cellRendererClass=e,this.cellRendererGui=this.cellRenderer.getGui(),this.cellRendererGui!=null){const r=this.getParentOfValue();fa(r),r.appendChild(this.cellRendererGui)}}afterCellEditorCreated(t,e,i,n,r){if(t!==this.editorVersion){this.beans.context.destroyBean(e);return}if(e.isCancelBeforeStart&&e.isCancelBeforeStart()){this.beans.context.destroyBean(e),this.cellCtrl.stopEditing(!0);return}if(!e.getGui){Wt(`cellEditor for column ${this.column.getId()} is missing getGui() method`),this.beans.context.destroyBean(e);return}this.cellEditor=e,this.cellEditorGui=e.getGui();const a=n||e.isPopup!==void 0&&e.isPopup();a?this.addPopupCellEditor(i,r):this.addInCellEditor(),this.refreshEditStyles(!0,a),e.afterGuiAttached&&e.afterGuiAttached(),this.cellCtrl.cellEditorAttached()}refreshEditStyles(t,e){this.addOrRemoveCssClass("ag-cell-inline-editing",t&&!e),this.addOrRemoveCssClass("ag-cell-popup-editing",t&&!!e),this.addOrRemoveCssClass("ag-cell-not-inline-editing",!t||!!e),this.rowCtrl?.setInlineEditingCss()}addInCellEditor(){const t=this.getGui();t.contains(Jr(this.beans.gos))&&t.focus(),this.destroyRenderer(),this.refreshWrapper(!0),this.clearParentOfValue(),this.cellEditorGui&&this.getParentOfValue().appendChild(this.cellEditorGui)}addPopupCellEditor(t,e){this.beans.gos.get("editType")==="fullRow"&&Wt("popup cellEditor does not work with fullRowEdit - you cannot use them both - either turn off fullRowEdit, or stop using popup editors.");const i=this.cellEditor;this.cellEditorPopupWrapper=this.beans.context.createBean(this.beans.editService.createPopupEditorWrapper(t));const n=this.cellEditorPopupWrapper.getGui();this.cellEditorGui&&n.appendChild(this.cellEditorGui);const r=this.beans.popupService,s=this.beans.gos.get("stopEditingWhenCellsLoseFocus"),o=e??i.getPopupPosition?.()??"over",a=this.beans.gos.get("enableRtl"),l={ePopup:n,column:this.column,rowNode:this.rowNode,type:"popupCellEditor",eventSource:this.getGui(),position:o,alignSide:a?"right":"left",keepWithinBounds:!0},u=r.positionPopupByComponent.bind(r,l),d=this.beans.localeService.getLocaleTextFunc(),p=r.addPopup({modal:s,eChild:n,closeOnEsc:!0,closedCallback:()=>{this.cellCtrl.onPopupEditorClosed()},anchorToElement:this.getGui(),positionCallback:u,ariaLabel:d("ariaLabelCellEditor","Cell Editor")});p&&(this.hideEditorPopup=p.hideFunc)}detach(){this.eRow.removeChild(this.getGui())}destroy(){this.cellCtrl.stopEditing(),this.destroyEditorAndRenderer(),this.removeControls(),super.destroy()}clearParentOfValue(){const t=this.getGui();t.contains(Jr(this.beans.gos))&&wz()&&t.focus({preventScroll:!0}),fa(this.getParentOfValue())}},MCe=class extends ir{constructor(t,e,i){super(),this.cellComps={},this.beans=e,this.rowCtrl=t;const n=document.createElement("div");n.setAttribute("comp-id",`${this.getCompId()}`),this.setInitialStyle(n,i),this.setTemplateFromElement(n);const r=this.getGui(),s=r.style;this.domOrder=this.rowCtrl.getDomOrder(),nc(r,"row");const o={setDomOrder:a=>this.domOrder=a,setCellCtrls:a=>this.setCellCtrls(a),showFullWidth:a=>this.showFullWidth(a),getFullWidthCellRenderer:()=>this.fullWidthCellRenderer,addOrRemoveCssClass:(a,l)=>this.addOrRemoveCssClass(a,l),setUserStyles:a=>UY(r,a),setTop:a=>s.top=a,setTransform:a=>s.transform=a,setRowIndex:a=>r.setAttribute("row-index",a),setRowId:a=>r.setAttribute("row-id",a),setRowBusinessKey:a=>r.setAttribute("row-business-key",a),refreshFullWidth:a=>this.fullWidthCellRenderer?.refresh?.(a())??!1};t.setComp(o,this.getGui(),i,void 0),this.addDestroyFunc(()=>{t.unsetComp(i)})}setInitialStyle(t,e){const i=this.rowCtrl.getInitialTransform(e);if(i)t.style.setProperty("transform",i);else{const n=this.rowCtrl.getInitialRowTop(e);n&&t.style.setProperty("top",n)}}showFullWidth(t){const e=n=>{if(this.isAlive()){const r=n.getGui();this.getGui().appendChild(r),this.rowCtrl.setupDetailRowAutoHeight(r),this.setFullWidthRowComp(n)}else this.beans.context.destroyBean(n)},i=t.newAgStackInstance();i?.then(e)}setCellCtrls(t){const e=Object.assign({},this.cellComps);t.forEach(n=>{const r=n.instanceId;this.cellComps[r]==null?this.newCellComp(n):e[r]=null});const i=Fg(e).filter(n=>n!=null);this.destroyCells(i),this.ensureDomOrder(t)}ensureDomOrder(t){if(!this.domOrder)return;const e=[];t.forEach(i=>{const n=this.cellComps[i.instanceId];n&&e.push(n.getGui())}),GY(this.getGui(),e)}newCellComp(t){const e=new OCe(this.beans,t,this.rowCtrl.isPrintLayout(),this.getGui(),this.rowCtrl.isEditing());this.cellComps[t.instanceId]=e,this.getGui().appendChild(e.getGui())}destroy(){super.destroy(),this.destroyAllCells()}destroyAllCells(){const t=Fg(this.cellComps).filter(e=>e!=null);this.destroyCells(t)}setFullWidthRowComp(t){this.fullWidthCellRenderer&&ar("should not be setting fullWidthRowComponent twice"),this.fullWidthCellRenderer=t,this.addDestroyFunc(()=>{this.fullWidthCellRenderer=this.beans.context.destroyBean(this.fullWidthCellRenderer)})}destroyCells(t){t.forEach(e=>{if(!e)return;const i=e.getCtrl().instanceId;this.cellComps[i]===e&&(e.detach(),e.destroy(),this.cellComps[i]=null)})}};function TCe(t){let e;return t.type==="center"?e=`<div class="${t.viewport}" data-ref="eViewport" role="presentation">
                <div class="${t.container}" data-ref="eContainer" role="rowgroup"></div>
            </div>`:e=`<div class="${t.container}" data-ref="eContainer" role="rowgroup"></div>`,e}var RCe=class extends ir{constructor(){super(),this.eViewport=bi,this.eContainer=bi,this.rowComps={},this.name=ir.elementGettingCreated.getAttribute("name"),this.options=Gy(this.name),this.setTemplate(TCe(this.options))}wireBeans(t){this.beans=t}postConstruct(){const t={setHorizontalScroll:i=>this.eViewport.scrollLeft=i,setViewportHeight:i=>this.eViewport.style.height=i,setRowCtrls:({rowCtrls:i})=>this.setRowCtrls(i),setDomOrder:i=>{this.domOrder=i},setContainerWidth:i=>this.eContainer.style.width=i,setOffsetTop:i=>this.eContainer.style.transform=`translateY(${i})`};this.createManagedBean(new wCe(this.name)).setComp(t,this.eContainer,this.eViewport)}destroy(){this.setRowCtrls([]),super.destroy(),this.lastPlacedElement=null}setRowCtrls(t){const{rowComps:e,beans:i,options:n}=this,r={...e};this.rowComps={},this.lastPlacedElement=null;const s=[];for(const o of t){const a=o.instanceId,l=r[a];let u;if(l)u=l,delete r[a];else{if(!o.getRowNode().displayed)continue;u=new MCe(o,i,n.type)}this.rowComps[a]=u,s.push([u,!l])}this.removeOldRows(Object.values(r)),this.addRowNodes(s)}addRowNodes(t){const{domOrder:e,eContainer:i}=this;for(const[n,r]of t){const s=n.getGui();e?this.ensureDomOrder(s):r&&i.appendChild(s)}}removeOldRows(t){const{eContainer:e}=this;for(const i of t)e.removeChild(i.getGui()),i.destroy()}ensureDomOrder(t){this.domOrder&&(VY(this.eContainer,t,this.lastPlacedElement),this.lastPlacedElement=t)}},PCe={selector:"AG-ROW-CONTAINER",component:RCe};function $b(t){return t.map(e=>`<ag-row-container name="${e}"></ag-row-container>`).join("")}var ECe=`<div class="ag-root ag-unselectable" role="treegrid">
        <ag-header-root></ag-header-root>
        <div class="ag-floating-top" data-ref="eTop" role="presentation">
            ${$b(["topLeft","topCenter","topRight","topFullWidth"])}
        </div>
        <div class="ag-body" data-ref="eBody" role="presentation">
            <div class="ag-body-viewport" data-ref="eBodyViewport" role="presentation">
            ${$b(["left","center","right","fullWidth"])}
            </div>
            <ag-fake-vertical-scroll></ag-fake-vertical-scroll>
        </div>
        <div class="ag-sticky-top" data-ref="eStickyTop" role="presentation">
            ${$b(["stickyTopLeft","stickyTopCenter","stickyTopRight","stickyTopFullWidth"])}
        </div>
        <div class="ag-sticky-bottom" data-ref="eStickyBottom" role="presentation">
            ${$b(["stickyBottomLeft","stickyBottomCenter","stickyBottomRight","stickyBottomFullWidth"])}
        </div>
        <div class="ag-floating-bottom" data-ref="eBottom" role="presentation">
            ${$b(["bottomLeft","bottomCenter","bottomRight","bottomFullWidth"])}
        </div>
        <ag-fake-horizontal-scroll></ag-fake-horizontal-scroll>
        <ag-overlay-wrapper></ag-overlay-wrapper>
    </div>`,ACe=class extends ir{constructor(){super(ECe,[R_e,E_e,I_e,M_e,PCe]),this.eBodyViewport=bi,this.eStickyTop=bi,this.eStickyBottom=bi,this.eTop=bi,this.eBottom=bi,this.eBody=bi}wireBeans(t){this.resizeObserverService=t.resizeObserverService,this.rangeService=t.rangeService}postConstruct(){const t=(i,n)=>{const r=`${i}px`;n.style.minHeight=r,n.style.height=r},e={setRowAnimationCssOnBodyViewport:(i,n)=>this.setRowAnimationCssOnBodyViewport(i,n),setColumnCount:i=>kxe(this.getGui(),i),setRowCount:i=>Ixe(this.getGui(),i),setTopHeight:i=>t(i,this.eTop),setBottomHeight:i=>t(i,this.eBottom),setTopDisplay:i=>this.eTop.style.display=i,setBottomDisplay:i=>this.eBottom.style.display=i,setStickyTopHeight:i=>this.eStickyTop.style.height=i,setStickyTopTop:i=>this.eStickyTop.style.top=i,setStickyTopWidth:i=>this.eStickyTop.style.width=i,setStickyBottomHeight:i=>{this.eStickyBottom.style.height=i,this.eStickyBottom.classList.toggle("ag-hidden",i==="0px")},setStickyBottomBottom:i=>this.eStickyBottom.style.bottom=i,setStickyBottomWidth:i=>this.eStickyBottom.style.width=i,setColumnMovingCss:(i,n)=>this.addOrRemoveCssClass(i,n),updateLayoutClasses:(i,n)=>{[this.eBodyViewport.classList,this.eBody.classList].forEach(s=>{s.toggle("ag-layout-auto-height",n.autoHeight),s.toggle("ag-layout-normal",n.normal),s.toggle("ag-layout-print",n.print)}),this.addOrRemoveCssClass("ag-layout-auto-height",n.autoHeight),this.addOrRemoveCssClass("ag-layout-normal",n.normal),this.addOrRemoveCssClass("ag-layout-print",n.print)},setAlwaysVerticalScrollClass:(i,n)=>this.eBodyViewport.classList.toggle(DJ,n),registerBodyViewportResizeListener:i=>{const n=this.resizeObserverService.observeResize(this.eBodyViewport,i);this.addDestroyFunc(()=>n())},setPinnedTopBottomOverflowY:i=>this.eTop.style.overflowY=this.eBottom.style.overflowY=i,setCellSelectableCss:(i,n)=>{[this.eTop,this.eBodyViewport,this.eBottom].forEach(r=>r.classList.toggle(i,n))},setBodyViewportWidth:i=>this.eBodyViewport.style.width=i};this.ctrl=this.createManagedBean(new SCe),this.ctrl.setComp(e,this.getGui(),this.eBodyViewport,this.eTop,this.eBottom,this.eStickyTop,this.eStickyBottom),(this.rangeService&&Mh(this.gos)||eU(this.gos))&&Axe(this.getGui(),!0)}setRowAnimationCssOnBodyViewport(t,e){const i=this.eBodyViewport.classList;i.toggle("ag-row-animation",e),i.toggle("ag-row-no-animation",!e)}getFloatingTopBottom(){return[this.eTop,this.eBottom]}},ICe={selector:"AG-GRID-BODY",component:ACe},kCe=class extends kt{constructor(){super(...arguments),this.beanName="scrollVisibleService"}wireBeans(t){this.ctrlsService=t.ctrlsService,this.columnAnimationService=t.columnAnimationService}postConstruct(){this.getScrollbarWidth(),this.addManagedEventListeners({displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this),displayedColumnsWidthChanged:this.onDisplayedColumnsWidthChanged.bind(this)})}onDisplayedColumnsChanged(){this.updateScrollVisible()}onDisplayedColumnsWidthChanged(){this.updateScrollVisible()}onCentreViewportResized(){this.updateScrollGap()}updateScrollVisible(){this.columnAnimationService.isActive()?this.columnAnimationService.executeLaterVMTurn(()=>{this.columnAnimationService.executeLaterVMTurn(()=>this.updateScrollVisibleImpl())}):this.updateScrollVisibleImpl()}updateScrollVisibleImpl(){const t=this.ctrlsService.get("center");if(!t||this.columnAnimationService.isActive())return;const e={horizontalScrollShowing:t.isHorizontalScrollShowing(),verticalScrollShowing:this.isVerticalScrollShowing()};this.setScrollsVisible(e),this.updateScrollGap()}updateScrollGap(){const t=this.ctrlsService.get("center"),e=t.hasHorizontalScrollGap(),i=t.hasVerticalScrollGap();(this.horizontalScrollGap!==e||this.verticalScrollGap!==i)&&(this.horizontalScrollGap=e,this.verticalScrollGap=i,this.eventService.dispatchEvent({type:"scrollGapChanged"}))}setScrollsVisible(t){(this.horizontalScrollShowing!==t.horizontalScrollShowing||this.verticalScrollShowing!==t.verticalScrollShowing)&&(this.horizontalScrollShowing=t.horizontalScrollShowing,this.verticalScrollShowing=t.verticalScrollShowing,this.eventService.dispatchEvent({type:"scrollVisibilityChanged"}))}isHorizontalScrollShowing(){return this.horizontalScrollShowing}isVerticalScrollShowing(){return this.verticalScrollShowing}hasHorizontalScrollGap(){return this.horizontalScrollGap}hasVerticalScrollGap(){return this.verticalScrollGap}getScrollbarWidth(){if(this.scrollbarWidth==null){const t=this.gos.get("scrollbarWidth"),i=typeof t=="number"&&t>=0?t:Gxe();i!=null&&(this.scrollbarWidth=i,this.eventService.dispatchEvent({type:"scrollbarWidthChanged"}))}return this.scrollbarWidth}},m6="__ag_grid_instance",LJ=class FJ extends kt{constructor(){super(...arguments),this.beanName="mouseEventService",this.gridInstanceId=FJ.gridInstanceSequence.next()}wireBeans(e){this.ctrlsService=e.ctrlsService}stampTopLevelGridCompWithGridInstance(e){e[m6]=this.gridInstanceId}getRenderedCellForEvent(e){return mz(this.gos,e.target,pg.DOM_DATA_KEY_CELL_CTRL)}isEventFromThisGrid(e){return this.isElementInThisGrid(e.target)}isElementInThisGrid(e){let i=e;for(;i;){const n=i[m6];if(oi(n))return n===this.gridInstanceId;i=i.parentElement}return!1}getCellPositionForEvent(e){const i=this.getRenderedCellForEvent(e);return i?i.getCellPosition():null}getNormalisedPosition(e){const i=Zo(this.gos,"normal"),n=e;let r,s;if(n.clientX!=null||n.clientY!=null?(r=n.clientX,s=n.clientY):(r=n.x,s=n.y),i){const o=this.ctrlsService.getGridBodyCtrl(),a=o.getScrollFeature().getVScrollPosition(),l=o.getScrollFeature().getHScrollPosition();r+=l.left,s+=a.top}return{x:r,y:s}}};LJ.gridInstanceSequence=new M0;var DCe=LJ,LCe=class extends kt{constructor(){super(),this.beanName="navigationService",this.onPageDown=JW(this.onPageDown,100),this.onPageUp=JW(this.onPageUp,100)}wireBeans(t){this.mouseEventService=t.mouseEventService,this.pageBoundsService=t.pageBoundsService,this.focusService=t.focusService,this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.rowModel=t.rowModel,this.ctrlsService=t.ctrlsService,this.rowRenderer=t.rowRenderer,this.headerNavigationService=t.headerNavigationService,this.rowPositionUtils=t.rowPositionUtils,this.cellNavigationService=t.cellNavigationService,this.pinnedRowModel=t.pinnedRowModel,this.scrollVisibleService=t.scrollVisibleService,this.rangeService=t.rangeService}postConstruct(){this.ctrlsService.whenReady(this,t=>{this.gridBodyCon=t.gridBodyCtrl})}handlePageScrollingKey(t,e=!1){const i=t.key,n=t.altKey,r=t.ctrlKey||t.metaKey,s=!!this.rangeService&&t.shiftKey,o=this.mouseEventService.getCellPositionForEvent(t);let a=!1;switch(i){case St.PAGE_HOME:case St.PAGE_END:!r&&!n&&(this.onHomeOrEndKey(i),a=!0);break;case St.LEFT:case St.RIGHT:case St.UP:case St.DOWN:if(!o)return!1;r&&!n&&!s&&(this.onCtrlUpDownLeftRight(i,o),a=!0);break;case St.PAGE_DOWN:case St.PAGE_UP:!r&&!n&&(a=this.handlePageUpDown(i,o,e));break}return a&&t.preventDefault(),a}handlePageUpDown(t,e,i){return i&&(e=this.focusService.getFocusedCell()),e?(t===St.PAGE_UP?this.onPageUp(e):this.onPageDown(e),!0):!1}navigateTo(t){const{scrollIndex:e,scrollType:i,scrollColumn:n,focusIndex:r,focusColumn:s}=t;oi(n)&&!n.isPinned()&&this.gridBodyCon.getScrollFeature().ensureColumnVisible(n),oi(e)&&this.gridBodyCon.getScrollFeature().ensureIndexVisible(e,i),t.isAsync||this.gridBodyCon.getScrollFeature().ensureIndexVisible(r),this.focusService.setFocusedCell({rowIndex:r,column:s,rowPinned:null,forceBrowserFocus:!0}),this.rangeService?.setRangeToCell({rowIndex:r,rowPinned:null,column:s})}onPageDown(t){const i=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition(),n=this.getViewportHeight(),r=this.pageBoundsService.getPixelOffset(),s=i.top+n,o=this.rowModel.getRowIndexAtPixel(s+r);this.columnModel.isAutoRowHeightActive()?this.navigateToNextPageWithAutoHeight(t,o):this.navigateToNextPage(t,o)}onPageUp(t){const i=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition(),n=this.pageBoundsService.getPixelOffset(),r=i.top,s=this.rowModel.getRowIndexAtPixel(r+n);this.columnModel.isAutoRowHeightActive()?this.navigateToNextPageWithAutoHeight(t,s,!0):this.navigateToNextPage(t,s,!0)}navigateToNextPage(t,e,i=!1){const n=this.getViewportHeight(),r=this.pageBoundsService.getFirstRow(),s=this.pageBoundsService.getLastRow(),o=this.pageBoundsService.getPixelOffset(),a=this.rowModel.getRow(t.rowIndex),l=i?a?.rowHeight-n-o:n-o,u=a?.rowTop+l;let d=this.rowModel.getRowIndexAtPixel(u+o);if(d===t.rowIndex){const v=i?-1:1;e=d=t.rowIndex+v}let p;i?(p="bottom",d<r&&(d=r),e<r&&(e=r)):(p="top",d>s&&(d=s),e>s&&(e=s)),this.isRowTallerThanView(d)&&(e=d,p="top"),this.navigateTo({scrollIndex:e,scrollType:p,scrollColumn:null,focusIndex:d,focusColumn:t.column})}navigateToNextPageWithAutoHeight(t,e,i=!1){this.navigateTo({scrollIndex:e,scrollType:i?"bottom":"top",scrollColumn:null,focusIndex:e,focusColumn:t.column}),setTimeout(()=>{const n=this.getNextFocusIndexForAutoHeight(t,i);this.navigateTo({scrollIndex:e,scrollType:i?"bottom":"top",scrollColumn:null,focusIndex:n,focusColumn:t.column,isAsync:!0})},50)}getNextFocusIndexForAutoHeight(t,e=!1){const i=e?-1:1,n=this.getViewportHeight(),r=this.pageBoundsService.getLastRow();let s=0,o=t.rowIndex;for(;o>=0&&o<=r;){const a=this.rowModel.getRow(o);if(a){const l=a.rowHeight??0;if(s+l>n)break;s+=l}o+=i}return Math.max(0,Math.min(o,r))}getViewportHeight(){const t=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition(),e=this.scrollVisibleService.getScrollbarWidth();let i=t.bottom-t.top;return this.ctrlsService.get("center").isHorizontalScrollShowing()&&(i-=e),i}isRowTallerThanView(t){const e=this.rowModel.getRow(t);if(!e)return!1;const i=e.rowHeight;return typeof i!="number"?!1:i>this.getViewportHeight()}onCtrlUpDownLeftRight(t,e){const i=this.cellNavigationService.getNextCellToFocus(t,e,!0),{rowIndex:n}=i,r=i.column;this.navigateTo({scrollIndex:n,scrollType:null,scrollColumn:r,focusIndex:n,focusColumn:r})}onHomeOrEndKey(t){const e=t===St.PAGE_HOME,i=this.visibleColsService.getAllCols(),n=e?i[0]:Yn(i),r=e?this.pageBoundsService.getFirstRow():this.pageBoundsService.getLastRow();this.navigateTo({scrollIndex:r,scrollType:null,scrollColumn:n,focusIndex:r,focusColumn:n})}onTabKeyDown(t,e){const i=e.shiftKey,n=this.tabToNextCellCommon(t,i,e);if(n!==!1){n?e.preventDefault():n===null&&this.focusService.allowFocusForNextGridCoreContainer(i);return}if(i){const{rowIndex:r,rowPinned:s}=t.getRowPosition();(s?r===0:r===this.pageBoundsService.getFirstRow())&&(this.gos.get("headerHeight")===0||this.focusService.isHeaderFocusSuppressed()?this.focusService.focusNextGridCoreContainer(!0,!0):(e.preventDefault(),this.focusService.focusPreviousFromFirstCell(e)))}else t instanceof pg&&t.focusCell(!0),(!i&&this.focusService.focusOverlay(!1)||this.focusService.focusNextGridCoreContainer(i))&&e.preventDefault()}tabToNextCell(t,e){const i=this.focusService.getFocusedCell();if(!i)return!1;let n=this.getCellByPosition(i);return!n&&(n=this.rowRenderer.getRowByPosition(i),!n||!n.isFullWidth())?!1:!!this.tabToNextCellCommon(n,t,e)}tabToNextCellCommon(t,e,i){let n=t.isEditing();if(!n&&t instanceof pg){const o=t.getRowCtrl();o&&(n=o.isEditing())}let r;return n?this.gos.get("editType")==="fullRow"?r=this.moveToNextEditingRow(t,e,i):r=this.moveToNextEditingCell(t,e,i):r=this.moveToNextCellNotEditing(t,e),r===null?r:r||!!this.focusService.getFocusedHeader()}moveToNextEditingCell(t,e,i=null){const n=t.getCellPosition();t.getGui().focus(),t.stopEditing();const r=this.findNextCellToFocusOn(n,e,!0);return r===!1?null:r==null?!1:(r.startEditing(null,!0,i),r.focusCell(!1),!0)}moveToNextEditingRow(t,e,i=null){const n=t.getCellPosition(),r=this.findNextCellToFocusOn(n,e,!0);if(r===!1)return null;if(r==null)return!1;const s=r.getCellPosition(),o=this.isCellEditable(n),a=this.isCellEditable(s),l=s&&n.rowIndex===s.rowIndex&&n.rowPinned===s.rowPinned;return o&&t.setFocusOutOnEditor(),l||(t.getRowCtrl().stopEditing(),r.getRowCtrl().startRowEditing(void 0,void 0,i)),a?(r.setFocusInOnEditor(),r.focusCell()):r.focusCell(!0),!0}moveToNextCellNotEditing(t,e){const i=this.visibleColsService.getAllCols();let n;t instanceof mg?n={...t.getRowPosition(),column:e?i[0]:Yn(i)}:n=t.getCellPosition();const r=this.findNextCellToFocusOn(n,e,!1);if(r===!1)return null;if(r instanceof pg)r.focusCell(!0);else if(r)return this.tryToFocusFullWidthRow(r.getRowPosition(),e);return oi(r)}findNextCellToFocusOn(t,e,i){let n=t;for(;;){t!==n&&(t=n),e||(n=this.getLastCellOfColSpan(n)),n=this.cellNavigationService.getNextTabbedCell(n,e);const r=this.gos.getCallback("tabToNextCell");if(oi(r)){const l=r({backwards:e,editing:i,previousCellPosition:t,nextCellPosition:n||null});if(l===!0||l===null)l===null&&Wt("Returning `null` from tabToNextCell is deprecated. Return `true` to stay on the current cell, or `false` to let the browser handle the tab behaviour."),n=t;else{if(l===!1)return!1;n={rowIndex:l.rowIndex,column:l.column,rowPinned:l.rowPinned}}}if(!n)return null;if(n.rowIndex<0){const a=this.headerNavigationService.getHeaderRowCount();return this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:a+n.rowIndex,column:n.column},fromCell:!0}),null}const s=this.gos.get("editType")==="fullRow";if(i&&!s&&!this.isCellEditable(n))continue;this.ensureCellVisible(n);const o=this.getCellByPosition(n);if(!o){const a=this.rowRenderer.getRowByPosition(n);if(!a||!a.isFullWidth()||i)continue;return a}if(!o.isSuppressNavigable())return this.rangeService?.setRangeToCell(n),o}}isCellEditable(t){const e=this.lookupRowNodeForCell(t);return e?t.column.isCellEditable(e):!1}getCellByPosition(t){const e=this.rowRenderer.getRowByPosition(t);return e?e.getCellCtrl(t.column):null}lookupRowNodeForCell(t){return t.rowPinned==="top"?this.pinnedRowModel.getPinnedTopRow(t.rowIndex):t.rowPinned==="bottom"?this.pinnedRowModel.getPinnedBottomRow(t.rowIndex):this.rowModel.getRow(t.rowIndex)}navigateToNextCell(t,e,i,n){let r=i,s=!1;for(;r&&(r===i||!this.isValidNavigateCell(r));)this.gos.get("enableRtl")?e===St.LEFT&&(r=this.getLastCellOfColSpan(r)):e===St.RIGHT&&(r=this.getLastCellOfColSpan(r)),r=this.cellNavigationService.getNextCellToFocus(e,r),s=Wn(r);if(s&&t&&t.key===St.UP&&(r={rowIndex:-1,rowPinned:null,column:i.column}),n){const a=this.gos.getCallback("navigateToNextCell");if(oi(a)){const u=a({key:e,previousCellPosition:i,nextCellPosition:r||null,event:t});oi(u)?r={rowPinned:u.rowPinned,rowIndex:u.rowIndex,column:u.column}:r=null}}if(!r)return;if(r.rowIndex<0){const a=this.headerNavigationService.getHeaderRowCount();this.focusService.focusHeaderPosition({headerPosition:{headerRowIndex:a+r.rowIndex,column:i.column},event:t||void 0,fromCell:!0});return}const o=this.getNormalisedPosition(r);o?this.focusPosition(o):this.tryToFocusFullWidthRow(r)}getNormalisedPosition(t){this.ensureCellVisible(t);const e=this.getCellByPosition(t);return e?(t=e.getCellPosition(),this.ensureCellVisible(t),t):null}tryToFocusFullWidthRow(t,e){const i=this.visibleColsService.getAllCols(),n=this.rowRenderer.getRowByPosition(t);if(!n||!n.isFullWidth())return!1;const r=this.focusService.getFocusedCell(),s={rowIndex:t.rowIndex,rowPinned:t.rowPinned,column:t.column||(e?Yn(i):i[0])};this.focusPosition(s);const o=e??(r!=null&&this.rowPositionUtils.before(s,r));return this.eventService.dispatchEvent({type:"fullWidthRowFocused",rowIndex:s.rowIndex,rowPinned:s.rowPinned,column:s.column,isFullWidthCell:!0,fromBelow:o}),!0}focusPosition(t){this.focusService.setFocusedCell({rowIndex:t.rowIndex,column:t.column,rowPinned:t.rowPinned,forceBrowserFocus:!0}),this.rangeService?.setRangeToCell(t)}isValidNavigateCell(t){return!!this.rowPositionUtils.getRowNode(t)}getLastCellOfColSpan(t){const e=this.getCellByPosition(t);if(!e)return t;const i=e.getColSpanningList();return i.length===1?t:{rowIndex:t.rowIndex,column:Yn(i),rowPinned:t.rowPinned}}ensureCellVisible(t){const e=vP(this.gos),i=this.rowModel.getRow(t.rowIndex);!(e&&i?.sticky)&&Wn(t.rowPinned)&&this.gridBodyCon.getScrollFeature().ensureIndexVisible(t.rowIndex),t.column.isPinned()||this.gridBodyCon.getScrollFeature().ensureColumnVisible(t.column)}},FCe=class extends kt{constructor(){super(...arguments),this.beanName="horizontalResizeService"}wireBeans(t){this.dragService=t.dragService,this.ctrlsService=t.ctrlsService}addResizeBar(t){const e={dragStartPixels:t.dragStartPixels||0,eElement:t.eResizeBar,onDragStart:this.onDragStart.bind(this,t),onDragStop:this.onDragStop.bind(this,t),onDragging:this.onDragging.bind(this,t),onDragCancel:this.onDragStop.bind(this,t),includeTouch:!0,stopPropagationForTouch:!0};return this.dragService.addDragSource(e),()=>this.dragService.removeDragSource(e)}onDragStart(t,e){this.dragStartX=e.clientX,this.setResizeIcons();const i=e instanceof MouseEvent&&e.shiftKey===!0;t.onResizeStart(i)}setResizeIcons(){const t=this.ctrlsService.get("gridCtrl");t.setResizeCursor(!0),t.disableUserSelect(!0)}onDragStop(t){t.onResizeEnd(this.resizeAmount),this.resetIcons()}resetIcons(){const t=this.ctrlsService.get("gridCtrl");t.setResizeCursor(!1),t.disableUserSelect(!1)}onDragging(t,e){this.resizeAmount=e.clientX-this.dragStartX,t.onResizing(this.resizeAmount)}},NCe=class extends kt{constructor(){super(...arguments),this.beanName="filterMenuFactory"}wireBeans(t){this.popupService=t.popupService,this.focusService=t.focusService,this.ctrlsService=t.ctrlsService,this.menuService=t.menuService}hideActiveMenu(){this.hidePopup&&this.hidePopup()}showMenuAfterMouseEvent(t,e,i){this.showPopup(t,n=>{this.popupService.positionPopupUnderMouseEvent({column:t,type:i,mouseEvent:e,ePopup:n})},i,e.target,this.menuService.isLegacyMenuEnabled())}showMenuAfterButtonClick(t,e,i){let n=-1,r="left";const s=this.menuService.isLegacyMenuEnabled();!s&&this.gos.get("enableRtl")&&(n=1,r="right");const o=s?void 0:4*n,a=s?void 0:4;this.showPopup(t,l=>{this.popupService.positionPopupByComponent({type:i,eventSource:e,ePopup:l,nudgeX:o,nudgeY:a,alignSide:r,keepWithinBounds:!0,position:"under",column:t})},i,e,s)}showPopup(t,e,i,n,r){const s=t?this.createBean(new jbe(t,"COLUMN_MENU")):void 0;if(this.activeMenu=s,!s?.hasFilter()||!t)throw new Error("AG Grid - unable to show popup filter, filter instantiation failed");const o=document.createElement("div");nc(o,"presentation"),o.classList.add("ag-menu"),r||o.classList.add("ag-filter-menu"),[this.tabListener]=this.addManagedElementListeners(o,{keydown:w=>this.trapFocusWithin(w,o)}),o.appendChild(s?.getGui());let a;const l=()=>s?.afterGuiDetached(),u=this.menuService.isColumnMenuAnchoringEnabled()?n??this.ctrlsService.getGridBodyCtrl().getGui():void 0,d=w=>{t.setMenuVisible(!1,"contextMenu");const R=w instanceof KeyboardEvent;if(this.tabListener&&(this.tabListener=this.tabListener()),R&&n&&Ou(n)){const O=this.focusService.findTabbableParent(n);O&&O.focus()}l(),this.destroyBean(this.activeMenu),this.dispatchVisibleChangedEvent(!1,i,t)},p=this.localeService.getLocaleTextFunc(),v=r&&i!=="columnFilter"?p("ariaLabelColumnMenu","Column Menu"):p("ariaLabelColumnFilter","Column Filter"),y=this.popupService.addPopup({modal:!0,eChild:o,closeOnEsc:!0,closedCallback:d,positionCallback:()=>e(o),anchorToElement:u,ariaLabel:v});y&&(this.hidePopup=a=y.hideFunc),s.afterInit().then(()=>{e(o),s.afterGuiAttached({container:i,hidePopup:a})}),t.setMenuVisible(!0,"contextMenu"),this.dispatchVisibleChangedEvent(!0,i,t)}trapFocusWithin(t,e){t.key!==St.TAB||t.defaultPrevented||this.focusService.findNextFocusableElement(e,!1,t.shiftKey)||(t.preventDefault(),this.focusService.focusInto(e,t.shiftKey))}dispatchVisibleChangedEvent(t,e,i){this.eventService.dispatchEvent({type:"columnMenuVisibleChanged",visible:t,switchingTab:!1,key:e,column:i??null,columnGroup:null})}isMenuEnabled(t){return t.isFilterAllowed()&&(t.getColDef().menuTabs??["filterMenuTab"]).includes("filterMenuTab")}showMenuAfterContextMenuEvent(){}destroy(){this.destroyBean(this.activeMenu),super.destroy()}},BCe=class extends kt{constructor(){super(...arguments),this.beanName="resizeObserverService"}observeResize(t,e){const n=lY(this.gos).ResizeObserver,r=n?new n(e):null;return r?.observe(t),()=>r?.disconnect()}},zCe=class extends kt{constructor(){super(...arguments),this.beanName="animationFrameService",this.createTasksP1={list:[],sorted:!1},this.createTasksP2={list:[],sorted:!1},this.destroyTasks=[],this.ticking=!1,this.scrollGoingDown=!0,this.lastPage=0,this.lastScrollTop=0,this.taskCount=0,this.cancelledTasks=new Set}wireBeans(t){this.ctrlsService=t.ctrlsService,this.paginationService=t.paginationService}setScrollTop(t){const e=this.gos.get("pagination");if(this.scrollGoingDown=t>=this.lastScrollTop,e&&t===0){const i=this.paginationService?.getCurrentPage()??0;i!==this.lastPage&&(this.lastPage=i,this.scrollGoingDown=!0)}this.lastScrollTop=t}postConstruct(){this.useAnimationFrame=!this.gos.get("suppressAnimationFrame")}isOn(){return this.useAnimationFrame}verifyAnimationFrameOn(t){this.useAnimationFrame===!1&&Wt(`AnimationFrameService.${t} called but animation frames are off`)}createTask(t,e,i){this.verifyAnimationFrameOn(i);const n={task:t,index:e,createOrder:++this.taskCount};this.addTaskToList(this[i],n),this.schedule()}cancelTask(t){this.cancelledTasks.add(t)}addTaskToList(t,e){t.list.push(e),t.sorted=!1}sortTaskList(t){if(t.sorted)return;const e=this.scrollGoingDown?1:-1;t.list.sort((i,n)=>i.index!==n.index?e*(n.index-i.index):n.createOrder-i.createOrder),t.sorted=!0}addDestroyTask(t){this.verifyAnimationFrameOn("createTasksP3"),this.destroyTasks.push(t),this.schedule()}executeFrame(t){this.verifyAnimationFrameOn("executeFrame");const e=this.createTasksP1,i=e.list,n=this.createTasksP2,r=n.list,s=this.destroyTasks,o=new Date().getTime();let a=new Date().getTime()-o;const l=t<=0,u=this.ctrlsService.getGridBodyCtrl();for(;l||a<t;){if(!u.getScrollFeature().scrollGridIfNeeded()){let p;if(i.length)this.sortTaskList(e),p=i.pop().task;else if(r.length)this.sortTaskList(n),p=r.pop().task;else if(s.length)p=s.pop();else{this.cancelledTasks.clear();break}this.cancelledTasks.has(p)||p()}a=new Date().getTime()-o}i.length||r.length||s.length?this.requestFrame():this.stopTicking()}stopTicking(){this.ticking=!1}flushAllFrames(){this.useAnimationFrame&&this.executeFrame(-1)}schedule(){this.useAnimationFrame&&(this.ticking||(this.ticking=!0,this.requestFrame()))}requestFrame(){const t=this.executeFrame.bind(this,60);this.requestAnimationFrame(t)}requestAnimationFrame(t){const e=lY(this.gos);e.requestAnimationFrame?e.requestAnimationFrame(t):e.webkitRequestAnimationFrame?e.webkitRequestAnimationFrame(t):e.setTimeout(t,0)}isQueueEmpty(){return!this.ticking}debounce(t){let e=!1;return()=>{if(!this.isOn()){window.setTimeout(t,0);return}e||(e=!0,this.addDestroyTask(()=>{e=!1,t()}))}}},VCe=class extends kt{constructor(){super(...arguments),this.beanName="expansionService"}wireBeans(t){this.rowModel=t.rowModel}postConstruct(){this.isClientSideRowModel=ls(this.gos)}expandRows(t){if(!this.isClientSideRowModel)return;const e=new Set(t);this.rowModel.forEachNode(i=>{i.id&&e.has(i.id)&&(i.expanded=!0)}),this.onGroupExpandedOrCollapsed()}getExpandedRows(){const t=[];return this.rowModel.forEachNode(({expanded:e,id:i})=>{e&&i&&t.push(i)}),t}expandAll(t){this.isClientSideRowModel&&this.rowModel.expandOrCollapseAll(t)}setRowNodeExpanded(t,e,i,n){t&&(i&&t.parent&&t.parent.level!==-1&&this.setRowNodeExpanded(t.parent,e,i,n),t.setExpanded(e,void 0,n))}onGroupExpandedOrCollapsed(){this.isClientSideRowModel&&this.rowModel.refreshModel({step:"map"})}},GCe=class extends kt{constructor(){super(...arguments),this.beanName="menuService"}wireBeans(t){this.valueService=t.valueService,this.filterMenuFactory=t.filterMenuFactory,this.ctrlsService=t.ctrlsService,this.animationFrameService=t.animationFrameService,this.filterManager=t.filterManager,this.rowRenderer=t.rowRenderer,this.columnChooserFactory=t.columnChooserFactory,this.contextMenuFactory=t.contextMenuFactory,this.enterpriseMenuFactory=t.enterpriseMenuFactory}postConstruct(){this.activeMenuFactory=this.enterpriseMenuFactory??this.filterMenuFactory}showColumnMenu(t){this.showColumnMenuCommon(this.activeMenuFactory,t,"columnMenu")}showFilterMenu(t){const e=this.enterpriseMenuFactory&&this.isLegacyMenuEnabled()?this.enterpriseMenuFactory:this.filterMenuFactory;this.showColumnMenuCommon(e,t,t.containerType,!0)}showHeaderContextMenu(t,e,i){this.activeMenuFactory.showMenuAfterContextMenuEvent(t,e,i)}getContextMenuPosition(t,e){const i=this.getRowCtrl(t),n=this.getCellGui(i,e);if(!n)return i?{x:0,y:i.getRowYPosition()}:{x:0,y:0};const r=n.getBoundingClientRect();return{x:r.x+r.width/2,y:r.y+r.height/2}}showContextMenu(t){const e=t.rowNode,i=t.column;let{anchorToElement:n,value:r}=t;e&&i&&r==null&&(r=this.valueService.getValueForDisplay(i,e)),n==null&&(n=this.getContextMenuAnchorElement(e,i)),this.contextMenuFactory?.onContextMenu(t.mouseEvent??null,t.touchEvent??null,e??null,i??null,r,n)}showColumnChooser(t){this.columnChooserFactory?.showColumnChooser(t)}hidePopupMenu(){this.contextMenuFactory?.hideActiveMenu(),this.activeMenuFactory.hideActiveMenu()}hideColumnChooser(){this.columnChooserFactory?.hideActiveColumnChooser()}isColumnMenuInHeaderEnabled(t){const{suppressMenu:e,suppressHeaderMenuButton:i}=t.getColDef();return!(i??e)&&this.activeMenuFactory.isMenuEnabled(t)&&(this.isLegacyMenuEnabled()||!!this.enterpriseMenuFactory)}isFilterMenuInHeaderEnabled(t){return!t.getColDef().suppressHeaderFilterButton&&!!this.filterManager?.isFilterAllowed(t)}isHeaderContextMenuEnabled(t){return!(t&&Tp(t)?t.getColDef():t?.getColGroupDef())?.suppressHeaderContextMenu&&this.getColumnMenuType()==="new"}isHeaderMenuButtonAlwaysShowEnabled(){return this.isSuppressMenuHide()}isHeaderMenuButtonEnabled(){const t=!this.isSuppressMenuHide();return!(Np()&&t)}isHeaderFilterButtonEnabled(t){return this.isFilterMenuInHeaderEnabled(t)&&!this.isLegacyMenuEnabled()&&!this.isFloatingFilterButtonDisplayed(t)}isFilterMenuItemEnabled(t){return!!this.filterManager?.isFilterAllowed(t)&&!this.isLegacyMenuEnabled()&&!this.isFilterMenuInHeaderEnabled(t)&&!this.isFloatingFilterButtonDisplayed(t)}isColumnMenuAnchoringEnabled(){return!this.isLegacyMenuEnabled()}areAdditionalColumnMenuItemsEnabled(){return this.getColumnMenuType()==="new"}isLegacyMenuEnabled(){return this.getColumnMenuType()==="legacy"}isFloatingFilterButtonEnabled(t){const e=t.getColDef(),i=e.floatingFilterComponentParams?.suppressFilterButton;return i!=null&&Wt("As of v31.1, 'colDef.floatingFilterComponentParams.suppressFilterButton' is deprecated. Use 'colDef.suppressFloatingFilterButton' instead."),e.suppressFloatingFilterButton==null?!i:!e.suppressFloatingFilterButton}getColumnMenuType(){return this.gos.get("columnMenu")}isFloatingFilterButtonDisplayed(t){return!!t.getColDef().floatingFilter&&this.isFloatingFilterButtonEnabled(t)}isSuppressMenuHide(){const t=this.gos.get("suppressMenuHide");return this.isLegacyMenuEnabled()?this.gos.exists("suppressMenuHide")?t:!1:t}showColumnMenuCommon(t,e,i,n){const{positionBy:r}=e,s=e.column;if(r==="button"){const{buttonElement:o}=e;t.showMenuAfterButtonClick(s,o,i,n)}else if(r==="mouse"){const{mouseEvent:o}=e;t.showMenuAfterMouseEvent(s,o,i,n)}else s&&(this.ctrlsService.getGridBodyCtrl().getScrollFeature().ensureColumnVisible(s,"auto"),this.animationFrameService.requestAnimationFrame(()=>{const o=this.ctrlsService.getHeaderRowContainerCtrl(s.getPinned())?.getHeaderCtrlForColumn(s);o&&t.showMenuAfterButtonClick(s,o.getAnchorElementForMenu(n),i,!0)}))}getRowCtrl(t){const{rowIndex:e,rowPinned:i}=t||{};if(e!=null)return this.rowRenderer.getRowByPosition({rowIndex:e,rowPinned:i})||void 0}getCellGui(t,e){return!t||!e?void 0:t.getCellCtrl(e)?.getGui()||void 0}getContextMenuAnchorElement(t,e){const i=this.ctrlsService.getGridBodyCtrl().getGridBodyElement(),n=this.getRowCtrl(t);if(!n)return i;const r=this.getCellGui(n,e);return r||(n.isFullWidth()?n.getFullWidthElement():i)}},UCe=class extends Km{constructor(t){super(t,"ag-text-area",null,"textarea")}setValue(t,e){const i=super.setValue(t,e);return this.eInput.value=t,i}setCols(t){return this.eInput.cols=t,this}setRows(t){return this.eInput.rows=t,this}},HCe={selector:"AG-INPUT-TEXT-AREA",component:UCe},$Ce=class extends rx{constructor(){super(`<div class="ag-large-text">
        <ag-input-text-area data-ref="eTextArea" class="ag-large-text-input"></ag-input-text-area>
        </div>`,[HCe]),this.eTextArea=bi}init(t){this.params=t,this.focusAfterAttached=t.cellStartedEdit,this.eTextArea.setMaxLength(t.maxLength||200).setCols(t.cols||60).setRows(t.rows||10),oi(t.value,!0)&&this.eTextArea.setValue(t.value.toString(),!0),this.addGuiEventListener("keydown",this.onKeyDown.bind(this)),this.activateTabIndex()}onKeyDown(t){const e=t.key;(e===St.LEFT||e===St.UP||e===St.RIGHT||e===St.DOWN||t.shiftKey&&e===St.ENTER)&&t.stopPropagation()}afterGuiAttached(){const t=this.localeService.getLocaleTextFunc();this.eTextArea.setInputAriaLabel(t("ariaInputEditor","Input Editor")),this.focusAfterAttached&&this.eTextArea.getFocusableElement().focus()}getValue(){const t=this.eTextArea.getValue();return!oi(t)&&!oi(this.params.value)?this.params.value:this.params.parseValue(t)}},WCe=class extends rx{constructor(t){super('<div class="ag-popup-editor" tabindex="-1"/>'),this.params=t}postConstruct(){Dg(this.gos,this.getGui(),"popupEditorWrapper",!0),this.addKeyDownListener()}addKeyDownListener(){const t=this.getGui(),e=this.params,i=n=>{Oz(this.gos,n,e.node,e.column,!0)||e.onKeyDown(n)};this.addManagedElementListeners(t,{keydown:i})}},qCe=class extends rx{constructor(){super(`<div class="ag-cell-edit-wrapper">
                <ag-select class="ag-cell-editor" data-ref="eSelect"></ag-select>
            </div>`,[ewe]),this.eSelect=bi,this.startedByEnter=!1}wireBeans(t){this.valueService=t.valueService}init(t){this.focusAfterAttached=t.cellStartedEdit;const{eSelect:e,valueService:i,gos:n}=this,{values:r,value:s,eventKey:o}=t;if(Wn(r)){Wt("no values found for select cellEditor");return}this.startedByEnter=o!=null?o===St.ENTER:!1;let a=!1;r.forEach(p=>{const v={value:p},y=i.formatValue(t.column,null,p),w=y!=null;v.text=w?y:p,e.addOption(v),a=a||s===p}),a?e.setValue(t.value,!0):t.values.length&&e.setValue(t.values[0],!0);const{valueListGap:l,valueListMaxWidth:u,valueListMaxHeight:d}=t;l!=null&&e.setPickerGap(l),d!=null&&e.setPickerMaxHeight(d),u!=null&&e.setPickerMaxWidth(u),n.get("editType")!=="fullRow"&&this.addManagedListeners(this.eSelect,{selectedItem:()=>t.stopEditing()})}afterGuiAttached(){this.focusAfterAttached&&this.eSelect.getFocusableElement().focus(),this.startedByEnter&&setTimeout(()=>{this.isAlive()&&this.eSelect.showPicker()})}focusIn(){this.eSelect.getFocusableElement().focus()}getValue(){return this.eSelect.getValue()}isPopup(){return!1}},CP=class extends rx{constructor(t){super(`
            <div class="ag-cell-edit-wrapper">
                ${t.getTemplate()}
            </div>`,t.getAgComponents()),this.cellEditorInput=t,this.eInput=bi}init(t){this.params=t;const{cellStartedEdit:e,eventKey:i,suppressPreventDefault:n}=t,r=this.eInput;this.cellEditorInput.init(r,t);let s,o=!0;e?(this.focusAfterAttached=!0,i===St.BACKSPACE||i===St.DELETE?s="":i&&i.length===1?n?o=!1:s=i:(s=this.cellEditorInput.getStartValue(),i!==St.F2&&(this.highlightAllOnFocus=!0))):(this.focusAfterAttached=!1,s=this.cellEditorInput.getStartValue()),o&&s!=null&&r.setStartValue(s),this.addManagedElementListeners(r.getGui(),{keydown:a=>{const{key:l}=a;(l===St.PAGE_UP||l===St.PAGE_DOWN)&&a.preventDefault()}})}afterGuiAttached(){const t=this.localeService.getLocaleTextFunc(),e=this.eInput;if(e.setInputAriaLabel(t("ariaInputEditor","Input Editor")),!this.focusAfterAttached)return;Th()||e.getFocusableElement().focus();const i=e.getInputElement();this.highlightAllOnFocus?i.select():this.cellEditorInput.setCaret?.()}focusIn(){const t=this.eInput,e=t.getFocusableElement(),i=t.getInputElement();e.focus(),i.select()}getValue(){return this.cellEditorInput.getValue()}isPopup(){return!1}},jCe=class{getTemplate(){return'<ag-input-text-field class="ag-cell-editor" data-ref="eInput"></ag-input-text-field>'}getAgComponents(){return[wP]}init(t,e){this.eInput=t,this.params=e,e.maxLength!=null&&t.setMaxLength(e.maxLength)}getValue(){const t=this.eInput.getValue();return!oi(t)&&!oi(this.params.value)?this.params.value:this.params.parseValue(t)}getStartValue(){return this.params.useFormatter||this.params.column.getColDef().refData?this.params.formatValue(this.params.value):this.params.value}setCaret(){const t=this.eInput.getValue(),e=oi(t)&&t.length||0;e&&this.eInput.getInputElement().setSelectionRange(e,e)}},NJ=class extends CP{constructor(){super(new jCe)}},QCe=class{getTemplate(){return'<ag-input-number-field class="ag-cell-editor" data-ref="eInput"></ag-input-number-field>'}getAgComponents(){return[uwe]}init(t,e){this.eInput=t,this.params=e,e.max!=null&&t.setMax(e.max),e.min!=null&&t.setMin(e.min),e.precision!=null&&t.setPrecision(e.precision),e.step!=null&&t.setStep(e.step);const i=t.getInputElement();e.preventStepping?t.addManagedElementListeners(i,{keydown:this.preventStepping}):e.showStepperButtons&&i.classList.add("ag-number-field-input-stepper")}preventStepping(t){(t.key===St.UP||t.key===St.DOWN)&&t.preventDefault()}getValue(){const t=this.eInput.getValue();if(!oi(t)&&!oi(this.params.value))return this.params.value;let e=this.params.parseValue(t);if(e==null)return e;if(typeof e=="string"){if(e==="")return null;e=Number(e)}return isNaN(e)?null:e}getStartValue(){return this.params.value}setCaret(){Th()&&this.eInput.getInputElement().focus({preventScroll:!0})}},ZCe=class extends CP{constructor(){super(new QCe)}},XCe=class extends Yg{constructor(t){super(t,"ag-date-field","date")}postConstruct(){super.postConstruct();const t=Th();this.addManagedListeners(this.eInput,{wheel:this.onWheel.bind(this),mousedown:()=>{this.isDisabled()||t||this.eInput.focus()}}),this.eInput.step="any"}onWheel(t){Jr(this.gos)===this.eInput&&t.preventDefault()}setMin(t){const e=t instanceof Date?Gc(t??null,!1)??void 0:t;return this.min===e?this:(this.min=e,Vc(this.eInput,"min",e),this)}setMax(t){const e=t instanceof Date?Gc(t??null,!1)??void 0:t;return this.max===e?this:(this.max=e,Vc(this.eInput,"max",e),this)}setStep(t){return this.step===t?this:(this.step=t,Vc(this.eInput,"step",t),this)}getDate(){if(this.eInput.validity.valid)return ml(this.getValue())??void 0}setDate(t,e){this.setValue(Gc(t??null,!1),e)}},BJ={selector:"AG-INPUT-DATE-FIELD",component:XCe},KCe=class{getTemplate(){return'<ag-input-date-field class="ag-cell-editor" data-ref="eInput"></ag-input-date-field>'}getAgComponents(){return[BJ]}init(t,e){this.eInput=t,this.params=e,e.min!=null&&t.setMin(e.min),e.max!=null&&t.setMax(e.max),e.step!=null&&t.setStep(e.step)}getValue(){const t=this.eInput.getDate();return!oi(t)&&!oi(this.params.value)?this.params.value:t??null}getStartValue(){const{value:t}=this.params;if(t instanceof Date)return Gc(t,!1)}},YCe=class extends CP{constructor(){super(new KCe)}},JCe=class{constructor(t){this.getDataTypeService=t}getTemplate(){return'<ag-input-date-field class="ag-cell-editor" data-ref="eInput"></ag-input-date-field>'}getAgComponents(){return[BJ]}init(t,e){this.eInput=t,this.params=e,e.min!=null&&t.setMin(e.min),e.max!=null&&t.setMax(e.max),e.step!=null&&t.setStep(e.step)}getValue(){const t=this.formatDate(this.eInput.getDate());return!oi(t)&&!oi(this.params.value)?this.params.value:this.params.parseValue(t??"")}getStartValue(){return Gc(this.parseDate(this.params.value??void 0)??null,!1)}parseDate(t){const e=this.getDataTypeService();return e?e.getDateParserFunction(this.params.column)(t):ml(t)??void 0}formatDate(t){const e=this.getDataTypeService();return e?e.getDateFormatterFunction(this.params.column)(t):Gc(t??null,!1)??void 0}},eSe=class extends CP{wireBeans(t){this.dataTypeService=t.dataTypeService}constructor(){super(new JCe(()=>this.dataTypeService))}},tSe=class extends rx{constructor(){super(`
            <div class="ag-cell-wrapper ag-cell-edit-wrapper ag-checkbox-edit">
                <ag-checkbox role="presentation" data-ref="eCheckbox"></ag-checkbox>
            </div>`,[mU]),this.eCheckbox=bi}init(t){this.params=t;const e=t.value??void 0;this.eCheckbox.setValue(e),this.eCheckbox.getInputElement().setAttribute("tabindex","-1"),this.setAriaLabel(e),this.addManagedListeners(this.eCheckbox,{fieldValueChanged:n=>this.setAriaLabel(n.selected)})}getValue(){return this.eCheckbox.getValue()}focusIn(){this.eCheckbox.getFocusableElement().focus()}afterGuiAttached(){this.params.cellStartedEdit&&this.focusIn()}isPopup(){return!1}setAriaLabel(t){const e=this.localeService.getLocaleTextFunc(),i=oU(e,t),n=e("ariaToggleCellValue","Press SPACE to toggle cell value");this.eCheckbox.setInputAriaLabel(`${n} (${i})`)}},ww=class{constructor(t){this.cellValueChanges=t}},aN=class extends ww{constructor(t,e,i,n){super(t),this.initialRange=e,this.finalRange=i,this.ranges=n}},iSe=10,g6=class{constructor(t){this.actionStack=[],this.maxStackSize=t||iSe,this.actionStack=new Array(this.maxStackSize)}pop(){return this.actionStack.pop()}push(t){t.cellValueChanges&&t.cellValueChanges.length>0&&(this.actionStack.length===this.maxStackSize&&this.actionStack.shift(),this.actionStack.push(t))}clear(){this.actionStack=[]}getCurrentStackSize(){return this.actionStack.length}},nSe=class extends kt{constructor(){super(...arguments),this.beanName="undoRedoService",this.cellValueChanges=[],this.activeCellEdit=null,this.activeRowEdit=null,this.isPasting=!1,this.isRangeInAction=!1,this.onCellValueChanged=t=>{const e={column:t.column,rowIndex:t.rowIndex,rowPinned:t.rowPinned},i=this.activeCellEdit!==null&&this.cellPositionUtils.equals(this.activeCellEdit,e),n=this.activeRowEdit!==null&&this.rowPositionUtils.sameRow(this.activeRowEdit,e);if(!(i||n||this.isPasting||this.isRangeInAction))return;const{rowPinned:s,rowIndex:o,column:a,oldValue:l,value:u}=t,d={rowPinned:s,rowIndex:o,columnId:a.getColId(),newValue:u,oldValue:l};this.cellValueChanges.push(d)},this.clearStacks=()=>{this.undoStack.clear(),this.redoStack.clear()}}wireBeans(t){this.focusService=t.focusService,this.ctrlsService=t.ctrlsService,this.cellPositionUtils=t.cellPositionUtils,this.rowPositionUtils=t.rowPositionUtils,this.columnModel=t.columnModel,this.rangeService=t.rangeService}postConstruct(){if(!this.gos.get("undoRedoCellEditing"))return;const t=this.gos.get("undoRedoCellEditingLimit");if(t<=0)return;this.undoStack=new g6(t),this.redoStack=new g6(t),this.addListeners();const e=this.clearStacks.bind(this);this.addManagedEventListeners({cellValueChanged:this.onCellValueChanged.bind(this),modelUpdated:i=>{i.keepUndoRedoStack||this.clearStacks()},columnPivotModeChanged:e,newColumnsLoaded:e,columnGroupOpened:e,columnRowGroupChanged:e,columnMoved:e,columnPinned:e,columnVisible:e,rowDragEnd:e}),this.ctrlsService.whenReady(this,i=>{this.gridBodyCtrl=i.gridBodyCtrl})}getCurrentUndoStackSize(){return this.undoStack?this.undoStack.getCurrentStackSize():0}getCurrentRedoStackSize(){return this.redoStack?this.redoStack.getCurrentStackSize():0}undo(t){this.eventService.dispatchEvent({type:"undoStarted",source:t});const e=this.undoRedo(this.undoStack,this.redoStack,"initialRange","oldValue","undo");this.eventService.dispatchEvent({type:"undoEnded",source:t,operationPerformed:e})}redo(t){this.eventService.dispatchEvent({type:"redoStarted",source:t});const e=this.undoRedo(this.redoStack,this.undoStack,"finalRange","newValue","redo");this.eventService.dispatchEvent({type:"redoEnded",source:t,operationPerformed:e})}undoRedo(t,e,i,n,r){if(!t)return!1;const s=t.pop();return!s||!s.cellValueChanges?!1:(this.processAction(s,o=>o[n],r),s instanceof aN?this.processRange(this.rangeService,s.ranges||[s[i]]):this.processCell(s.cellValueChanges),e.push(s),!0)}processAction(t,e,i){t.cellValueChanges.forEach(n=>{const{rowIndex:r,rowPinned:s,columnId:o}=n,a={rowIndex:r,rowPinned:s},l=this.rowPositionUtils.getRowNode(a);l.displayed&&l.setDataValue(o,e(n),i)})}processRange(t,e){let i;t.removeAllCellRanges(!0),e.forEach((n,r)=>{if(!n)return;const s=n.startRow,o=n.endRow;r===e.length-1&&(i={rowPinned:s.rowPinned,rowIndex:s.rowIndex,columnId:n.startColumn.getColId()},this.setLastFocusedCell(i));const a={rowStartIndex:s.rowIndex,rowStartPinned:s.rowPinned,rowEndIndex:o.rowIndex,rowEndPinned:o.rowPinned,columnStart:n.startColumn,columns:n.columns};t.addCellRange(a)})}processCell(t){const e=t[0],{rowIndex:i,rowPinned:n}=e,r={rowIndex:i,rowPinned:n},s=this.rowPositionUtils.getRowNode(r),o={rowPinned:e.rowPinned,rowIndex:s.rowIndex,columnId:e.columnId};this.setLastFocusedCell(o,this.rangeService)}setLastFocusedCell(t,e){const{rowIndex:i,columnId:n,rowPinned:r}=t,s=this.gridBodyCtrl.getScrollFeature(),o=this.columnModel.getCol(n);if(!o)return;s.ensureIndexVisible(i),s.ensureColumnVisible(o);const a={rowIndex:i,column:o,rowPinned:r};this.focusService.setFocusedCell({...a,forceBrowserFocus:!0}),e?.setRangeToCell(a)}addListeners(){this.addManagedEventListeners({rowEditingStarted:t=>{this.activeRowEdit={rowIndex:t.rowIndex,rowPinned:t.rowPinned}},rowEditingStopped:()=>{const t=new ww(this.cellValueChanges);this.pushActionsToUndoStack(t),this.activeRowEdit=null},cellEditingStarted:t=>{this.activeCellEdit={column:t.column,rowIndex:t.rowIndex,rowPinned:t.rowPinned}},cellEditingStopped:t=>{if(this.activeCellEdit=null,t.valueChanged&&!this.activeRowEdit&&!this.isPasting&&!this.isRangeInAction){const i=new ww(this.cellValueChanges);this.pushActionsToUndoStack(i)}},pasteStart:()=>{this.isPasting=!0},pasteEnd:()=>{const t=new ww(this.cellValueChanges);this.pushActionsToUndoStack(t),this.isPasting=!1},fillStart:()=>{this.isRangeInAction=!0},fillEnd:t=>{const e=new aN(this.cellValueChanges,t.initialRange,t.finalRange);this.pushActionsToUndoStack(e),this.isRangeInAction=!1},keyShortcutChangedCellStart:()=>{this.isRangeInAction=!0},keyShortcutChangedCellEnd:()=>{let t;this.rangeService&&Mh(this.gos)?t=new aN(this.cellValueChanges,void 0,void 0,[...this.rangeService.getCellRanges()]):t=new ww(this.cellValueChanges),this.pushActionsToUndoStack(t),this.isRangeInAction=!1}})}pushActionsToUndoStack(t){this.undoStack.push(t),this.cellValueChanges=[],this.redoStack.clear()}};function rSe(t){return t.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition()}function sSe(t){return t.ctrlsService.getGridBodyCtrl().getScrollFeature().getHScrollPosition()}function zJ(t,e,i="auto"){t.frameworkOverrides.wrapIncoming(()=>t.ctrlsService.getGridBodyCtrl().getScrollFeature().ensureColumnVisible(e,i),"ensureVisible")}function VJ(t,e,i){t.frameworkOverrides.wrapIncoming(()=>t.ctrlsService.getGridBodyCtrl().getScrollFeature().ensureIndexVisible(e,i),"ensureVisible")}function oSe(t,e,i=null){t.frameworkOverrides.wrapIncoming(()=>t.ctrlsService.getGridBodyCtrl().getScrollFeature().ensureNodeVisible(e,i),"ensureVisible")}function aSe(t){t.undoRedoService?.undo("api")}function lSe(t){t.undoRedoService?.redo("api")}function cSe(t,e={}){return t.rowRenderer.getCellEditorInstances(e).map(Qw)}function uSe(t){return t.rowRenderer.getEditingCells()}function hSe(t,e=!1){t.rowRenderer.stopEditing(e)}function dSe(t,e){const i=t.columnModel.getCol(e.colKey);if(!i){Wt(`no column found for ${e.colKey}`);return}const n={rowIndex:e.rowIndex,rowPinned:e.rowPinned||null,column:i};e.rowPinned==null&&VJ(t,e.rowIndex),zJ(t,e.colKey);const s=t.navigationService.getCellByPosition(n);if(!s)return;const{focusService:o,gos:a}=t,l=()=>{const d=Jr(a),p=s.getGui();return d!==p&&!!p?.contains(d)},u=a.get("stopEditingWhenCellsLoseFocus")&&l();(u||!o.isCellFocused(n))&&o.setFocusedCell({...n,forceBrowserFocus:u,preventScrollOnBrowserFocus:!0}),s.startRowOrCellEdit(e.key)}function fSe(t){return t.undoRedoService?.getCurrentUndoStackSize()??0}function pSe(t){return t.undoRedoService?.getCurrentRedoStackSize()??0}var mSe=class extends kt{constructor(){super(...arguments),this.beanName="editService"}wireBeans(t){this.navigationService=t.navigationService,this.userComponentFactory=t.userComponentFactory,this.valueService=t.valueService}startEditing(t,e=null,i=!1,n=null){const r=this.createCellEditorParams(t,e,i),s=t.getColumn().getColDef(),o=this.userComponentFactory.getCellEditorDetails(s,r),a=o?.popupFromSelector!=null?o.popupFromSelector:!!s.cellEditorPopup,l=o?.popupPositionFromSelector!=null?o.popupPositionFromSelector:s.cellEditorPopupPosition;return t.setEditing(!0,o),t.getComp().setEditDetails(o,a,l,this.gos.get("reactiveCustomComponents")),this.eventService.dispatchEvent(t.createEvent(n,"cellEditingStarted")),!o?.params?.suppressPreventDefault}stopEditing(t,e){const i=t.getComp(),{newValue:n,newValueExists:r}=this.takeValueFromCellEditor(e,i),s=t.getRowNode(),o=t.getColumn(),a=this.valueService.getValueForDisplay(o,s);let l=!1;return r&&(l=this.saveNewValue(t,a,n,s,o)),t.setEditing(!1,void 0),i.setEditDetails(),t.updateAndFormatValue(!1),t.refreshCell({forceRefresh:!0,suppressFlash:!0}),this.eventService.dispatchEvent({...t.createEvent(null,"cellEditingStopped"),oldValue:a,newValue:n,valueChanged:l}),l}handleColDefChanged(t){const e=t.getCellEditor();if(e?.refresh){const{eventKey:i,cellStartedEdit:n}=t.getEditCompDetails().params,r=this.createCellEditorParams(t,i,n),s=t.getColumn().getColDef(),o=this.userComponentFactory.getCellEditorDetails(s,r);e.refresh(o.params)}}setFocusOutOnEditor(t){const e=t.getComp().getCellEditor();e&&e.focusOut&&e.focusOut()}setFocusInOnEditor(t){const e=t.getComp(),i=e.getCellEditor();i?.focusIn?i.focusIn():(t.focusCell(!0),t.onCellEditorAttached(()=>e.getCellEditor()?.focusIn?.()))}stopEditingAndFocus(t,e=!1,i=!1){t.stopRowOrCellEdit(),t.focusCell(!0),e||this.navigateAfterEdit(i,t.getCellPosition())}createPopupEditorWrapper(t){return new WCe(t)}takeValueFromCellEditor(t,e){const i={newValueExists:!1};if(t)return i;const n=e.getCellEditor();return!n||n.isCancelAfterEnd&&n.isCancelAfterEnd()?i:{newValue:n.getValue(),newValueExists:!0}}saveNewValue(t,e,i,n,r){if(i===e)return!1;t.setSuppressRefreshCell(!0);const s=n.setDataValue(r,i,"edit");return t.setSuppressRefreshCell(!1),s}createCellEditorParams(t,e,i){const n=t.getColumn(),r=t.getRowNode();return this.gos.addGridCommonParams({value:this.valueService.getValueForDisplay(n,r),eventKey:e,column:n,colDef:n.getColDef(),rowIndex:t.getCellPosition().rowIndex,node:r,data:r.data,cellStartedEdit:i,onKeyDown:t.onKeyDown.bind(t),stopEditing:t.stopEditingAndFocus.bind(t),eGridCell:t.getGui(),parseValue:s=>this.valueService.parseValue(n,r,s,t.getValue()),formatValue:t.formatValue.bind(t)})}navigateAfterEdit(t,e){if(this.gos.get("enterNavigatesVerticallyAfterEdit")){const n=t?St.UP:St.DOWN;this.navigationService.navigateToNextCell(null,n,e,!1)}}},gSe=class extends kt{constructor(){super(...arguments),this.beanName="rowEditService"}startEditing(t,e=null,i=null,n=null){let r=!0;return t.getAllCellCtrls().reduce((o,a)=>{const l=a===i;return l?r=a.startEditing(e,l,n):a.startEditing(null,l,n),o?!0:a.isEditing()},!1)&&this.setEditing(t,!0),r}stopEditing(t,e=!1){const i=t.getAllCellCtrls(),n=t.isEditing();t.setStoppingRowEdit(!0);let r=!1;for(const s of i){const o=s.stopEditing(e);n&&!e&&!r&&o&&(r=!0)}r&&this.eventService.dispatchEvent(t.createRowEvent("rowValueChanged")),n&&this.setEditing(t,!1),t.setStoppingRowEdit(!1)}setEditing(t,e){t.setEditingRow(e),t.forEachGui(void 0,n=>n.rowComp.addOrRemoveCssClass("ag-row-editing",e));const i=e?t.createRowEvent("rowEditingStarted"):t.createRowEvent("rowEditingStopped");this.eventService.dispatchEvent(i)}},Jg={version:fn,moduleName:"@ag-grid-community/edit-core",beans:[mSe]},vSe={version:fn,moduleName:"@ag-grid-community/edit-api",apiFunctions:{undoCellEditing:aSe,redoCellEditing:lSe,getCellEditorInstances:cSe,getEditingCells:uSe,stopEditing:hSe,startEditingCell:dSe,getCurrentUndoSize:fSe,getCurrentRedoSize:pSe},dependantModules:[Jg]},ySe={version:fn,moduleName:"@ag-grid-community/undo-redo-edit",beans:[nSe],dependantModules:[Jg]},xSe={version:fn,moduleName:"@ag-grid-community/full-row-edit",beans:[gSe],dependantModules:[Jg]},GJ={version:fn,moduleName:"@ag-grid-community/default-editor",userComponents:[{name:"agCellEditor",classImp:NJ}],dependantModules:[Jg]},bSe={version:fn,moduleName:"@ag-grid-community/data-type-editors",userComponents:[{name:"agTextCellEditor",classImp:NJ},{name:"agNumberCellEditor",classImp:ZCe,params:{suppressPreventDefault:!0}},{name:"agDateCellEditor",classImp:YCe},{name:"agDateStringCellEditor",classImp:eSe},{name:"agCheckboxCellEditor",classImp:tSe}],dependantModules:[GJ]},wSe={version:fn,moduleName:"@ag-grid-community/select-editor",userComponents:[{name:"agSelectCellEditor",classImp:qCe}],dependantModules:[Jg]},_Se={version:fn,moduleName:"@ag-grid-community/large-text-editor",userComponents:[{name:"agLargeTextCellEditor",classImp:$Ce}],dependantModules:[Jg]},CSe={version:fn,moduleName:"@ag-grid-community/all-editors",dependantModules:[GJ,bSe,wSe,_Se]},SSe={version:fn,moduleName:"@ag-grid-community/editing",dependantModules:[Jg,ySe,xSe,CSe,vSe]},OSe=class extends kt{constructor(){super(...arguments),this.beanName="autoWidthCalculator"}wireBeans(t){this.rowRenderer=t.rowRenderer,this.ctrlsService=t.ctrlsService}postConstruct(){this.ctrlsService.whenReady(this,t=>{this.centerRowContainerCtrl=t.center})}getPreferredWidthForColumn(t,e){const i=this.getHeaderCellForColumn(t);if(!i)return-1;const n=this.rowRenderer.getAllCellsForColumn(t);return e||n.push(i),this.addElementsToContainerAndGetWidth(n)}getPreferredWidthForColumnGroup(t){const e=this.getHeaderCellForColumn(t);return e?this.addElementsToContainerAndGetWidth([e]):-1}addElementsToContainerAndGetWidth(t){const e=document.createElement("form");e.style.position="fixed";const i=this.centerRowContainerCtrl.getContainerElement();t.forEach(s=>this.cloneItemIntoDummy(s,e)),i.appendChild(e);const n=e.offsetWidth;i.removeChild(e);const r=this.getAutoSizePadding();return n+r}getAutoSizePadding(){return this.gos.get("autoSizePadding")}getHeaderCellForColumn(t){let e=null;return this.ctrlsService.getHeaderRowContainerCtrls().forEach(i=>{const n=i.getHtmlElementForColumnHeader(t);n!=null&&(e=n)}),e}cloneItemIntoDummy(t,e){const i=t.cloneNode(!0);i.style.width="",i.style.position="static",i.style.left="";const n=document.createElement("div"),r=n.classList;["ag-header-cell","ag-header-group-cell"].some(a=>i.classList.contains(a))?(r.add("ag-header","ag-header-row"),n.style.position="static"):r.add("ag-row");let o=t.parentElement;for(;o;){if(["ag-header-row","ag-row"].some(l=>o.classList.contains(l))){for(let l=0;l<o.classList.length;l++){const u=o.classList[l];u!="ag-row-position-absolute"&&r.add(u)}break}o=o.parentElement}n.appendChild(i),e.appendChild(n)}},MSe=class extends kt{constructor(t,e){super(),this.createRowCon=t,this.destroyRowCtrls=e,this.stickyTopRowCtrls=[],this.stickyBottomRowCtrls=[],this.extraTopHeight=0,this.extraBottomHeight=0}wireBeans(t){this.rowModel=t.rowModel,this.rowRenderer=t.rowRenderer,this.ctrlsService=t.ctrlsService,this.pageBoundsService=t.pageBoundsService}postConstruct(){this.isClientSide=ls(this.gos),this.ctrlsService.whenReady(this,t=>{this.gridBodyCtrl=t.gridBodyCtrl}),this.resetStickyContainers()}getStickyTopRowCtrls(){return this.stickyTopRowCtrls}getStickyBottomRowCtrls(){return this.stickyBottomRowCtrls}setOffsetTop(t){this.extraTopHeight!==t&&(this.extraTopHeight=t,this.eventService.dispatchEvent({type:"stickyTopOffsetChanged",offset:t}))}setOffsetBottom(t){this.extraBottomHeight!==t&&(this.extraBottomHeight=t)}resetOffsets(){this.setOffsetBottom(0),this.setOffsetTop(0)}getExtraTopHeight(){return this.extraTopHeight}getExtraBottomHeight(){return this.extraBottomHeight}getLastPixelOfGroup(t){return this.isClientSide?this.getClientSideLastPixelOfGroup(t):this.getServerSideLastPixelOfGroup(t)}getFirstPixelOfGroup(t){return t.footer?t.sibling.rowTop+t.sibling.rowHeight-1:t.hasChildren()?t.rowTop-1:0}getServerSideLastPixelOfGroup(t){if(this.isClientSide)throw new Error("This func should only be called in server side row model.");if(t.isExpandable()||t.footer){if(t.master)return t.detailNode.rowTop+t.detailNode.rowHeight;if(!t.sibling||Math.abs(t.sibling.rowIndex-t.rowIndex)===1){let i=t.childStore?.getStoreBounds();return t.footer&&(i=t.sibling.childStore?.getStoreBounds()),(i?.heightPx??0)+(i?.topPx??0)}return t.footer?t.rowTop+t.rowHeight:t.sibling.rowTop+t.sibling.rowHeight}return Number.MAX_SAFE_INTEGER}getClientSideLastPixelOfGroup(t){if(!this.isClientSide)throw new Error("This func should only be called in client side row model.");if(t.isExpandable()||t.footer){if(t.footer&&t.rowIndex===0)return Number.MAX_SAFE_INTEGER;if(!t.sibling||Math.abs(t.sibling.rowIndex-t.rowIndex)===1){let n=t.footer?t.sibling:t;for(;n.isExpandable()&&n.expanded;)if(n.master)n=n.detailNode;else if(n.childrenAfterSort){if(n.childrenAfterSort.length===0)break;n=Yn(n.childrenAfterSort)}return n.rowTop+n.rowHeight}return t.footer?t.rowTop+t.rowHeight:t.sibling.rowTop+t.sibling.rowHeight}return Number.MAX_SAFE_INTEGER}updateStickyRows(t){const e=t==="top";let i=0;if(!this.canRowsBeSticky())return this.refreshNodesAndContainerHeight(t,new Set,i);const n=e?this.rowRenderer.getFirstVisibleVerticalPixel()-this.extraTopHeight:this.rowRenderer.getLastVisibleVerticalPixel()-this.extraTopHeight,r=new Set,s=u=>{if(r.add(u),e){const d=this.getLastPixelOfGroup(u),p=n+i+u.rowHeight;d<p?u.stickyRowTop=i+(d-p):u.stickyRowTop=i}else{const d=this.getFirstPixelOfGroup(u),p=n-(i+u.rowHeight);d>p?u.stickyRowTop=i-(d-p):u.stickyRowTop=i}i=0,r.forEach(d=>{const p=d.stickyRowTop+d.rowHeight;i<p&&(i=p)})},o=this.areFooterRowsStickySuppressed(),a=this.gos.get("suppressGroupRowsSticky"),l=u=>{if(!u.displayed)return!1;if(u.footer){if(o===!0||o==="grand"&&u.level===-1||o==="group"&&u.level>-1)return!1;const d=u.sibling.rowIndex?u.sibling.rowIndex+1===u.rowIndex:!1;return t==="bottom"&&d?!1:!r.has(u)}return u.isExpandable()?a===!0||t==="bottom"?!1:!r.has(u)&&u.expanded:!1};for(let u=0;u<100;u++){let d=n+i;e||(d=n-i);const p=this.rowModel.getRowIndexAtPixel(d),v=this.rowModel.getRow(p);if(v==null)break;const w=this.getStickyAncestors(v).find(O=>(e?O.rowIndex<p:O.rowIndex>p)&&l(O));if(w){s(w);continue}if((e?v.rowTop<d:v.rowTop+v.rowHeight>d)&&l(v)){s(v);continue}break}return e||r.forEach(u=>{u.stickyRowTop=i-(u.stickyRowTop+u.rowHeight)}),this.refreshNodesAndContainerHeight(t,r,i)}areFooterRowsStickySuppressed(){const t=this.gos.get("suppressStickyTotalRow");if(t===!0)return!0;const e=!!this.gos.get("groupIncludeFooter")||t==="group",i=!!this.gos.get("groupIncludeTotalFooter")||t==="grand";return e&&i?!0:i?"grand":e?"group":!1}canRowsBeSticky(){const t=vP(this.gos),e=this.areFooterRowsStickySuppressed(),i=this.gos.get("suppressGroupRowsSticky");return t&&(!e||!i)}getStickyAncestors(t){const e=[];let i=t.footer?t.sibling:t.parent;for(;i;)i.sibling&&e.push(i.sibling),e.push(i),i=i.parent;return e.reverse()}checkStickyRows(){const t=this.updateStickyRows("top"),e=this.updateStickyRows("bottom");return t||e}destroyStickyCtrls(){this.resetStickyContainers()}resetStickyContainers(){this.refreshNodesAndContainerHeight("top",new Set,0),this.refreshNodesAndContainerHeight("bottom",new Set,0)}refreshStickyNode(t){const e=new Set;if(this.stickyTopRowCtrls.some(i=>i.getRowNode()===t)){for(let i=0;i<this.stickyTopRowCtrls.length;i++){const n=this.stickyTopRowCtrls[i].getRowNode();n!==t&&e.add(n)}this.refreshNodesAndContainerHeight("top",e,this.topContainerHeight)&&this.checkStickyRows();return}for(let i=0;i<this.stickyBottomRowCtrls.length;i++){const n=this.stickyBottomRowCtrls[i].getRowNode();n!==t&&e.add(n)}this.refreshNodesAndContainerHeight("bottom",e,this.bottomContainerHeight)&&this.checkStickyRows()}refreshNodesAndContainerHeight(t,e,i){const n=t==="top",r=n?this.stickyTopRowCtrls:this.stickyBottomRowCtrls,s={},o=[];for(let v=0;v<r.length;v++){const y=r[v].getRowNode();if(!e.has(y)){s[y.id]=r[v],y.sticky=!1;continue}o.push(r[v])}const a=new Set;for(let v=0;v<o.length;v++)a.add(o[v].getRowNode());const l=[];e.forEach(v=>{a.has(v)||(v.sticky=!0,l.push(this.createRowCon(v,!1,!1)))});let u=!!l.length||o.length!==r.length;n?this.topContainerHeight!==i&&(this.topContainerHeight=i,this.gridBodyCtrl.setStickyTopHeight(i),u=!0):this.bottomContainerHeight!==i&&(this.bottomContainerHeight=i,this.gridBodyCtrl.setStickyBottomHeight(i),u=!0),this.destroyRowCtrls(s,!1);const d=[...o,...l];d.sort((v,y)=>y.getRowNode().rowIndex-v.getRowNode().rowIndex),n||d.reverse(),d.forEach(v=>v.setRowTop(v.getRowNode().stickyRowTop));let p=0;return n?(e.forEach(v=>{v.rowIndex<this.pageBoundsService.getFirstRow()&&(p+=v.rowHeight)}),p>this.topContainerHeight&&(p=this.topContainerHeight),this.setOffsetTop(p)):(e.forEach(v=>{v.rowIndex>this.pageBoundsService.getLastRow()&&(p+=v.rowHeight)}),p>this.bottomContainerHeight&&(p=this.bottomContainerHeight),this.setOffsetBottom(p)),u?(n?this.stickyTopRowCtrls=d:this.stickyBottomRowCtrls=d,!0):!1}ensureRowHeightsValid(){let t=!1;const e=i=>{const n=i.getRowNode();if(n.rowHeightEstimated){const r=Mp(this.gos,n);n.setRowHeight(r.height),t=!0}};return this.stickyTopRowCtrls.forEach(e),this.stickyBottomRowCtrls.forEach(e),t}},TSe=class extends kt{constructor(){super(...arguments),this.beanName="rowRenderer",this.destroyFuncsForColumnListeners=[],this.rowCtrlsByRowIndex={},this.zombieRowCtrls={},this.allRowCtrls=[],this.topRowCtrls=[],this.bottomRowCtrls=[],this.refreshInProgress=!1,this.dataFirstRenderedFired=!1,this.setupRangeSelectionListeners=()=>{const t=()=>{this.getAllCellCtrls().forEach(s=>s.onCellSelectionChanged())},e=()=>{this.getAllCellCtrls().forEach(s=>s.updateRangeBordersIfRangeCount())},i=()=>{this.eventService.addEventListener("cellSelectionChanged",t),this.eventService.addEventListener("columnMoved",e),this.eventService.addEventListener("columnPinned",e),this.eventService.addEventListener("columnVisible",e)},n=()=>{this.eventService.removeEventListener("cellSelectionChanged",t),this.eventService.removeEventListener("columnMoved",e),this.eventService.removeEventListener("columnPinned",e),this.eventService.removeEventListener("columnVisible",e)};this.addDestroyFunc(()=>n()),this.addManagedPropertyListeners(["enableRangeSelection","cellSelection"],()=>{Mh(this.gos)?i():n()}),Mh(this.gos)&&i()}}wireBeans(t){this.animationFrameService=t.animationFrameService,this.paginationService=t.paginationService,this.pageBoundsService=t.pageBoundsService,this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.pinnedRowModel=t.pinnedRowModel,this.rowModel=t.rowModel,this.focusService=t.focusService,this.beans=t,this.rowContainerHeightService=t.rowContainerHeightService,this.ctrlsService=t.ctrlsService,this.environment=t.environment}postConstruct(){this.ctrlsService.whenReady(this,t=>{this.gridBodyCtrl=t.gridBodyCtrl,this.initialise()})}initialise(){this.addManagedEventListeners({paginationChanged:this.onPageLoaded.bind(this),pinnedRowDataChanged:this.onPinnedRowDataChanged.bind(this),displayedColumnsChanged:this.onDisplayedColumnsChanged.bind(this),bodyScroll:this.onBodyScroll.bind(this),bodyHeightChanged:this.redraw.bind(this,{})}),this.addManagedPropertyListeners(["domLayout","embedFullWidthRows"],()=>this.onDomLayoutChanged()),this.addManagedPropertyListeners(["suppressMaxRenderedRowRestriction","rowBuffer"],()=>this.redraw()),this.addManagedPropertyListener("suppressCellFocus",t=>this.onSuppressCellFocusChanged(t.currentValue)),this.addManagedPropertyListeners(["groupSuppressBlankHeader","getBusinessKeyForNode","fullWidthCellRenderer","fullWidthCellRendererParams","suppressStickyTotalRow","groupRowRenderer","groupRowRendererParams","loadingCellRenderer","loadingCellRendererParams","detailCellRenderer","detailCellRendererParams","enableRangeSelection","enableCellTextSelection","rowSelection"],()=>this.redrawRows()),vP(this.gos)&&(ls(this.gos)||tf(this.gos))&&(this.stickyRowFeature=this.createManagedBean(new MSe(this.createRowCon.bind(this),this.destroyRowCtrls.bind(this)))),this.registerCellEventListeners(),this.initialiseCache(),this.printLayout=Zo(this.gos,"print"),this.embedFullWidthRows=this.printLayout||this.gos.get("embedFullWidthRows"),this.redrawAfterModelUpdate()}initialiseCache(){if(this.gos.get("keepDetailRows")){const t=this.getKeepDetailRowsCount(),e=t??3;this.cachedRowCtrls=new RSe(e)}}getKeepDetailRowsCount(){return this.gos.get("keepDetailRowsCount")}getStickyTopRowCtrls(){return this.stickyRowFeature?this.stickyRowFeature.getStickyTopRowCtrls():[]}getStickyBottomRowCtrls(){return this.stickyRowFeature?this.stickyRowFeature.getStickyBottomRowCtrls():[]}updateAllRowCtrls(){const t=Fg(this.rowCtrlsByRowIndex),e=Fg(this.zombieRowCtrls),i=this.cachedRowCtrls?this.cachedRowCtrls.getEntries():[];e.length>0||i.length>0?this.allRowCtrls=[...t,...e,...i]:this.allRowCtrls=t}onCellFocusChanged(t){this.getAllCellCtrls().forEach(e=>e.onCellFocused(t)),this.getFullWidthRowCtrls().forEach(e=>e.onFullWidthRowFocused(t))}onSuppressCellFocusChanged(t){this.getAllCellCtrls().forEach(e=>e.onSuppressCellFocusChanged(t)),this.getFullWidthRowCtrls().forEach(e=>e.onSuppressCellFocusChanged(t))}registerCellEventListeners(){this.addManagedEventListeners({cellFocused:t=>{this.onCellFocusChanged(t)},cellFocusCleared:()=>this.onCellFocusChanged(),flashCells:t=>{this.getAllCellCtrls().forEach(e=>e.onFlashCells(t))},columnHoverChanged:()=>{this.getAllCellCtrls().forEach(t=>t.onColumnHover())},displayedColumnsChanged:()=>{this.getAllCellCtrls().forEach(t=>t.onDisplayedColumnsChanged())},displayedColumnsWidthChanged:()=>{this.printLayout&&this.getAllCellCtrls().forEach(t=>t.onLeftChanged())}}),this.setupRangeSelectionListeners(),this.refreshListenersToColumnsForCellComps(),this.addManagedEventListeners({gridColumnsChanged:this.refreshListenersToColumnsForCellComps.bind(this)}),this.addDestroyFunc(this.removeGridColumnListeners.bind(this))}removeGridColumnListeners(){this.destroyFuncsForColumnListeners.forEach(t=>t()),this.destroyFuncsForColumnListeners.length=0}refreshListenersToColumnsForCellComps(){this.removeGridColumnListeners(),this.columnModel.getCols().forEach(e=>{const i=l=>{this.getAllCellCtrls().forEach(u=>{u.getColumn()===e&&l(u)})},n=()=>{i(l=>l.onLeftChanged())},r=()=>{i(l=>l.onWidthChanged())},s=()=>{i(l=>l.onFirstRightPinnedChanged())},o=()=>{i(l=>l.onLastLeftPinnedChanged())},a=()=>{i(l=>l.onColDefChanged())};e.addEventListener("leftChanged",n),e.addEventListener("widthChanged",r),e.addEventListener("firstRightPinnedChanged",s),e.addEventListener("lastLeftPinnedChanged",o),e.addEventListener("colDefChanged",a),this.destroyFuncsForColumnListeners.push(()=>{e.removeEventListener("leftChanged",n),e.removeEventListener("widthChanged",r),e.removeEventListener("firstRightPinnedChanged",s),e.removeEventListener("lastLeftPinnedChanged",o),e.removeEventListener("colDefChanged",a)})})}onDomLayoutChanged(){const t=Zo(this.gos,"print"),e=t||this.gos.get("embedFullWidthRows"),i=e!==this.embedFullWidthRows||this.printLayout!==t;this.printLayout=t,this.embedFullWidthRows=e,i&&this.redrawAfterModelUpdate({domLayoutChanged:!0})}datasourceChanged(){this.firstRenderedRow=0,this.lastRenderedRow=-1;const t=Object.keys(this.rowCtrlsByRowIndex);this.removeRowCtrls(t)}onPageLoaded(t){const e={recycleRows:t.keepRenderedRows,animate:t.animate,newData:t.newData,newPage:t.newPage,onlyBody:!0};this.redrawAfterModelUpdate(e)}getAllCellsForColumn(t){const e=[];return this.getAllRowCtrls().forEach(i=>{const n=i.getCellElement(t);n&&e.push(n)}),e}refreshFloatingRowComps(){this.refreshFloatingRows(this.topRowCtrls,"top"),this.refreshFloatingRows(this.bottomRowCtrls,"bottom")}getTopRowCtrls(){return this.topRowCtrls}getCentreRowCtrls(){return this.allRowCtrls}getBottomRowCtrls(){return this.bottomRowCtrls}refreshFloatingRows(t,e){const{pinnedRowModel:i,beans:n,printLayout:r}=this,s=Object.fromEntries(t.map(a=>[a.getRowNode().id,a]));i.forEachPinnedRow(e,(a,l)=>{const u=t[l];u&&i.getPinnedRowById(u.getRowNode().id,e)===void 0&&(u.destroyFirstPass(),u.destroySecondPass()),a.id in s?(t[l]=s[a.id],delete s[a.id]):t[l]=new mg(a,n,!1,!1,r)});const o=e==="top"?i.getPinnedTopRowCount():i.getPinnedBottomRowCount();t.length=o}onPinnedRowDataChanged(){const t={recycleRows:!0};this.redrawAfterModelUpdate(t)}redrawRow(t,e=!1){if(t.sticky)this.stickyRowFeature.refreshStickyNode(t);else if(this.cachedRowCtrls?.has(t)){this.cachedRowCtrls.removeRow(t);return}else{const i=n=>{const r=n[t.rowIndex];r&&r.getRowNode()===t&&(r.destroyFirstPass(),r.destroySecondPass(),n[t.rowIndex]=this.createRowCon(t,!1,!1))};switch(t.rowPinned){case"top":i(this.topRowCtrls);break;case"bottom":i(this.bottomRowCtrls);break;default:i(this.rowCtrlsByRowIndex),this.updateAllRowCtrls()}}e||this.dispatchDisplayedRowsChanged(!1)}redrawRows(t){if(t!=null){t?.forEach(i=>this.redrawRow(i,!0)),this.dispatchDisplayedRowsChanged(!1);return}this.redrawAfterModelUpdate()}getCellToRestoreFocusToAfterRefresh(t){const e=t?.suppressKeepFocus?null:this.focusService.getFocusCellToUseAfterRefresh();if(e==null)return null;const i=Jr(this.gos),n=G_(this.gos,i,pg.DOM_DATA_KEY_CELL_CTRL),r=G_(this.gos,i,mg.DOM_DATA_KEY_ROW_CTRL);return n||r?e:null}redrawAfterModelUpdate(t={}){this.getLockOnRefresh();const e=this.getCellToRestoreFocusToAfterRefresh(t);this.updateContainerHeights(),this.scrollToTopIfNewData(t);const i=!t.domLayoutChanged&&!!t.recycleRows,n=t.animate&&Jy(this.gos),r=i?this.getRowsToRecycle():null;if(i||this.removeAllRowComps(),this.workOutFirstAndLastRowsToRender(),this.stickyRowFeature){this.stickyRowFeature.checkStickyRows();const s=this.stickyRowFeature.getExtraTopHeight()+this.stickyRowFeature.getExtraBottomHeight();s&&this.updateContainerHeights(s)}this.recycleRows(r,n),this.gridBodyCtrl.updateRowCount(),t.onlyBody||this.refreshFloatingRowComps(),this.dispatchDisplayedRowsChanged(),e!=null&&this.restoreFocusedCell(e),this.releaseLockOnRefresh()}scrollToTopIfNewData(t){const e=t.newData||t.newPage,i=this.gos.get("suppressScrollOnNewData");e&&!i&&(this.gridBodyCtrl.getScrollFeature().scrollToTop(),this.stickyRowFeature?.resetOffsets())}updateContainerHeights(t=0){if(this.printLayout){this.rowContainerHeightService.setModelHeight(null);return}let e=this.pageBoundsService.getCurrentPageHeight();e===0&&(e=1),this.rowContainerHeightService.setModelHeight(e+t)}getLockOnRefresh(){if(this.refreshInProgress)throw new Error("AG Grid: cannot get grid to draw rows when it is in the middle of drawing rows. Your code probably called a grid API method while the grid was in the render stage. To overcome this, put the API call into a timeout, e.g. instead of api.redrawRows(), call setTimeout(function() { api.redrawRows(); }, 0). To see what part of your code that caused the refresh check this stacktrace.");this.refreshInProgress=!0,this.frameworkOverrides.getLockOnRefresh?.()}releaseLockOnRefresh(){this.refreshInProgress=!1,this.frameworkOverrides.releaseLockOnRefresh?.()}isRefreshInProgress(){return this.refreshInProgress}restoreFocusedCell(t){t&&this.focusService.restoreFocusedCell(t,()=>{this.onCellFocusChanged(this.gos.addGridCommonParams({rowIndex:t.rowIndex,column:t.column,rowPinned:t.rowPinned,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!0,type:"cellFocused"}))})}stopEditing(t=!1){this.getAllRowCtrls().forEach(e=>{e.stopEditing(t)})}getAllCellCtrls(){const t=[],e=this.getAllRowCtrls(),i=e.length;for(let n=0;n<i;n++){const r=e[n].getAllCellCtrls(),s=r.length;for(let o=0;o<s;o++)t.push(r[o])}return t}getAllRowCtrls(){const t=this.stickyRowFeature&&this.stickyRowFeature.getStickyTopRowCtrls()||[],e=this.stickyRowFeature&&this.stickyRowFeature.getStickyBottomRowCtrls()||[],i=[...this.topRowCtrls,...this.bottomRowCtrls,...t,...e];for(const n in this.rowCtrlsByRowIndex)i.push(this.rowCtrlsByRowIndex[n]);return i}addRenderedRowListener(t,e,i){const n=this.rowCtrlsByRowIndex[e];n&&n.addEventListener(t,i)}flashCells(t={}){this.getCellCtrls(t.rowNodes,t.columns).forEach(e=>e.flashCell(t))}refreshCells(t={}){const e={forceRefresh:t.force,newData:!1,suppressFlash:t.suppressFlash};for(const i of this.getCellCtrls(t.rowNodes,t.columns))i.refreshOrDestroyCell(e);this.refreshFullWidth(t.rowNodes)}refreshFullWidth(t){if(!t)return;let e=null;this.stickyRowFeature&&wz()&&(e=this.getCellToRestoreFocusToAfterRefresh()||null);for(const i of this.getRowCtrls(t)){if(!i.isFullWidth())continue;i.refreshFullWidth()||this.redrawRow(i.getRowNode(),!0)}this.dispatchDisplayedRowsChanged(!1),e&&this.restoreFocusedCell(e)}getCellRendererInstances(t){const e=this.getCellCtrls(t.rowNodes,t.columns).map(r=>r.getCellRenderer()).filter(r=>r!=null);if(t.columns?.length)return e;const i=[],n=this.mapRowNodes(t.rowNodes);return this.getAllRowCtrls().forEach(r=>{if(n&&!this.isRowInMap(r.getRowNode(),n)||!r.isFullWidth())return;const s=r.getFullWidthCellRenderers();for(let o=0;o<s.length;o++){const a=s[o];a!=null&&i.push(a)}}),[...i,...e]}getCellEditorInstances(t){const e=[];return this.getCellCtrls(t.rowNodes,t.columns).forEach(i=>{const n=i.getCellEditor();n&&e.push(n)}),e}getEditingCells(){const t=[];return this.getAllCellCtrls().forEach(e=>{if(e.isEditing()){const i=e.getCellPosition();t.push(i)}}),t}mapRowNodes(t){if(!t)return;const e={top:{},bottom:{},normal:{}};return t.forEach(i=>{const n=i.id;switch(i.rowPinned){case"top":e.top[n]=i;break;case"bottom":e.bottom[n]=i;break;default:e.normal[n]=i;break}}),e}isRowInMap(t,e){const i=t.id;switch(t.rowPinned){case"top":return e.top[i]!=null;case"bottom":return e.bottom[i]!=null;default:return e.normal[i]!=null}}getRowCtrls(t){const e=this.mapRowNodes(t),i=this.getAllRowCtrls();return!t||!e?i:i.filter(n=>{const r=n.getRowNode();return this.isRowInMap(r,e)})}getCellCtrls(t,e){let i;oi(e)&&(i={},e.forEach(r=>{const s=this.columnModel.getCol(r);oi(s)&&(i[s.getId()]=!0)}));const n=[];return this.getRowCtrls(t).forEach(r=>{r.getAllCellCtrls().forEach(s=>{const o=s.getColumn().getId();i&&!i[o]||n.push(s)})}),n}destroy(){this.removeAllRowComps(!0),super.destroy()}removeAllRowComps(t=!1){const e=Object.keys(this.rowCtrlsByRowIndex);this.removeRowCtrls(e,t),this.stickyRowFeature&&this.stickyRowFeature.destroyStickyCtrls()}getRowsToRecycle(){const t=[];gu(this.rowCtrlsByRowIndex,(i,n)=>{n.getRowNode().id==null&&t.push(i)}),this.removeRowCtrls(t);const e={};return gu(this.rowCtrlsByRowIndex,(i,n)=>{const r=n.getRowNode();e[r.id]=n}),this.rowCtrlsByRowIndex={},e}removeRowCtrls(t,e=!1){t.forEach(i=>{const n=this.rowCtrlsByRowIndex[i];n&&(n.destroyFirstPass(e),n.destroySecondPass()),delete this.rowCtrlsByRowIndex[i]})}onBodyScroll(t){t.direction==="vertical"&&this.redraw({afterScroll:!0})}redraw(t={}){const{afterScroll:e}=t;let i;this.stickyRowFeature&&wz()&&(i=this.getCellToRestoreFocusToAfterRefresh()||void 0);const n=this.firstRenderedRow,r=this.lastRenderedRow;this.workOutFirstAndLastRowsToRender();let s=!1;if(this.stickyRowFeature){s=this.stickyRowFeature.checkStickyRows();const a=this.stickyRowFeature.getExtraTopHeight()+this.stickyRowFeature.getExtraBottomHeight();a&&this.updateContainerHeights(a)}const o=this.firstRenderedRow!==n||this.lastRenderedRow!==r;if(!(e&&!s&&!o)&&(this.getLockOnRefresh(),this.recycleRows(null,!1,e),this.releaseLockOnRefresh(),this.dispatchDisplayedRowsChanged(e&&!s),i!=null)){const a=this.getCellToRestoreFocusToAfterRefresh();i!=null&&a==null&&(this.animationFrameService.flushAllFrames(),this.restoreFocusedCell(i))}}removeRowCompsNotToDraw(t,e){const i={};t.forEach(s=>i[s]=!0);const r=Object.keys(this.rowCtrlsByRowIndex).filter(s=>!i[s]);this.removeRowCtrls(r,e)}calculateIndexesToDraw(t){const e=fwe(this.firstRenderedRow,this.lastRenderedRow),i=(r,s)=>{const o=s.getRowNode().rowIndex;o!=null&&(o<this.firstRenderedRow||o>this.lastRenderedRow)&&this.doNotUnVirtualiseRow(s)&&e.push(o)};gu(this.rowCtrlsByRowIndex,i),gu(t,i),e.sort((r,s)=>r-s);const n=[];for(let r=0;r<e.length;r++){const s=e[r],o=this.rowModel.getRow(s);o&&!o.sticky&&n.push(s)}return n}recycleRows(t,e=!1,i=!1){const n=this.calculateIndexesToDraw(t);(this.printLayout||i)&&(e=!1),this.removeRowCompsNotToDraw(n,!e),n.forEach(r=>{this.createOrUpdateRowCtrl(r,t,e,i)}),t&&(i&&!this.gos.get("suppressAnimationFrame")&&!this.printLayout?this.beans.animationFrameService.addDestroyTask(()=>{this.destroyRowCtrls(t,e),this.updateAllRowCtrls(),this.dispatchDisplayedRowsChanged()}):this.destroyRowCtrls(t,e)),this.updateAllRowCtrls()}dispatchDisplayedRowsChanged(t=!1){this.eventService.dispatchEvent({type:"displayedRowsChanged",afterScroll:t})}onDisplayedColumnsChanged(){const t=this.visibleColsService.isPinningLeft(),e=this.visibleColsService.isPinningRight();(this.pinningLeft!==t||e!==this.pinningRight)&&(this.pinningLeft=t,this.pinningRight=e,this.embedFullWidthRows&&this.redrawFullWidthEmbeddedRows())}redrawFullWidthEmbeddedRows(){const t=[];this.getFullWidthRowCtrls().forEach(e=>{const i=e.getRowNode().rowIndex;t.push(i.toString())}),this.refreshFloatingRowComps(),this.removeRowCtrls(t),this.redraw({afterScroll:!0})}getFullWidthRowCtrls(t){const e=this.mapRowNodes(t);return this.getAllRowCtrls().filter(i=>{if(!i.isFullWidth())return!1;const n=i.getRowNode();return!(e!=null&&!this.isRowInMap(n,e))})}createOrUpdateRowCtrl(t,e,i,n){let r,s=this.rowCtrlsByRowIndex[t];if(s||(r=this.rowModel.getRow(t),oi(r)&&oi(e)&&e[r.id]&&r.alreadyRendered&&(s=e[r.id],e[r.id]=null)),!s)if(r||(r=this.rowModel.getRow(t)),oi(r))s=this.createRowCon(r,i,n);else return;return r&&(r.alreadyRendered=!0),this.rowCtrlsByRowIndex[t]=s,s}destroyRowCtrls(t,e){const i=[];gu(t,(n,r)=>{if(r){if(this.cachedRowCtrls&&r.isCacheable()){this.cachedRowCtrls.addRow(r);return}if(r.destroyFirstPass(!e),e){const s=r.instanceId;this.zombieRowCtrls[s]=r,i.push(()=>{r.destroySecondPass(),delete this.zombieRowCtrls[s]})}else r.destroySecondPass()}}),e&&(i.push(()=>{this.updateAllRowCtrls(),this.dispatchDisplayedRowsChanged()}),I0e(i))}getRowBuffer(){return this.gos.get("rowBuffer")}getRowBufferInPixels(){const t=this.getRowBuffer(),e=dg(this.gos);return t*e}workOutFirstAndLastRowsToRender(){this.rowContainerHeightService.updateOffset();let t,e;if(!this.rowModel.isRowsToRender())t=0,e=-1;else if(this.printLayout)this.environment.refreshRowHeightVariable(),t=this.pageBoundsService.getFirstRow(),e=this.pageBoundsService.getLastRow();else{const a=this.getRowBufferInPixels(),l=this.ctrlsService.getGridBodyCtrl(),u=this.gos.get("suppressRowVirtualisation");let d=!1,p,v;do{const P=this.pageBoundsService.getPixelOffset(),{pageFirstPixel:N,pageLastPixel:F}=this.pageBoundsService.getCurrentPagePixelRange(),k=this.rowContainerHeightService.getDivStretchOffset(),$=l.getScrollFeature().getVScrollPosition(),W=$.top,Q=$.bottom;u?(p=N+k,v=F+k):(p=Math.max(W+P-a,N)+k,v=Math.min(Q+P+a,F)+k),this.firstVisibleVPixel=Math.max(W+P,N)+k,this.lastVisibleVPixel=Math.min(Q+P,F)+k,d=this.ensureAllRowsInRangeHaveHeightsCalculated(p,v)}while(d);let y=this.rowModel.getRowIndexAtPixel(p),w=this.rowModel.getRowIndexAtPixel(v);const R=this.pageBoundsService.getFirstRow(),O=this.pageBoundsService.getLastRow();y<R&&(y=R),w>O&&(w=O),t=y,e=w}const i=Zo(this.gos,"normal"),n=this.gos.get("suppressMaxRenderedRowRestriction"),r=Math.max(this.getRowBuffer(),500);i&&!n&&e-t>r&&(e=t+r);const s=t!==this.firstRenderedRow,o=e!==this.lastRenderedRow;(s||o)&&(this.firstRenderedRow=t,this.lastRenderedRow=e,this.eventService.dispatchEvent({type:"viewportChanged",firstRow:t,lastRow:e}))}dispatchFirstDataRenderedEvent(){this.dataFirstRenderedFired||(this.dataFirstRenderedFired=!0,window.requestAnimationFrame(()=>{this.beans.eventService.dispatchEvent({type:"firstDataRendered",firstRow:this.firstRenderedRow,lastRow:this.lastRenderedRow})}))}ensureAllRowsInRangeHaveHeightsCalculated(t,e){const i=this.pinnedRowModel?.ensureRowHeightsValid(),n=this.stickyRowFeature?.ensureRowHeightsValid(),r=this.rowModel.ensureRowHeightsValid(t,e,this.pageBoundsService.getFirstRow(),this.pageBoundsService.getLastRow());return(r||n)&&this.eventService.dispatchEvent({type:"recalculateRowBounds"}),n||r||i?(this.updateContainerHeights(),!0):!1}getFirstVisibleVerticalPixel(){return this.firstVisibleVPixel}getLastVisibleVerticalPixel(){return this.lastVisibleVPixel}getFirstVirtualRenderedRow(){return this.firstRenderedRow}getLastVirtualRenderedRow(){return this.lastRenderedRow}doNotUnVirtualiseRow(t){const n=t.getRowNode(),r=this.focusService.isRowNodeFocused(n),s=t.isEditing(),o=n.detail;return r||s||o?!!this.isRowPresent(n):!1}isRowPresent(t){return this.rowModel.isRowPresent(t)?this.paginationService?this.paginationService.isRowPresent(t):!0:!1}createRowCon(t,e,i){const n=this.cachedRowCtrls?this.cachedRowCtrls.getRow(t):null;if(n)return n;const r=this.gos.get("suppressAnimationFrame"),s=i&&!r&&!this.printLayout;return new mg(t,this.beans,e,s,this.printLayout)}getRenderedNodes(){const t=this.rowCtrlsByRowIndex;return Object.values(t).map(e=>e.getRowNode())}getRowByPosition(t){let e;const{rowIndex:i}=t;switch(t.rowPinned){case"top":e=this.topRowCtrls[i];break;case"bottom":e=this.bottomRowCtrls[i];break;default:e=this.rowCtrlsByRowIndex[i],e||(e=this.getStickyTopRowCtrls().find(n=>n.getRowNode().rowIndex===i)||null,e||(e=this.getStickyBottomRowCtrls().find(n=>n.getRowNode().rowIndex===i)||null));break}return e}isRangeInRenderedViewport(t,e){if(t==null||e==null)return!1;const n=t>this.lastRenderedRow;return!(e<this.firstRenderedRow)&&!n}},RSe=class{constructor(t){this.entriesMap={},this.entriesList=[],this.maxCount=t}addRow(t){if(this.entriesMap[t.getRowNode().id]=t,this.entriesList.push(t),t.setCached(!0),this.entriesList.length>this.maxCount){const e=this.entriesList[0];e.destroyFirstPass(),e.destroySecondPass(),this.removeFromCache(e)}}getRow(t){if(t==null||t.id==null)return null;const e=this.entriesMap[t.id];return e?(this.removeFromCache(e),e.setCached(!1),e.getRowNode()!=t?null:e):null}has(t){return this.entriesMap[t.id]!=null}removeRow(t){const e=t.id,i=this.entriesMap[e];delete this.entriesMap[e],Na(this.entriesList,i)}removeFromCache(t){const e=t.getRowNode().id;delete this.entriesMap[e],Na(this.entriesList,t)}getEntries(){return this.entriesList}},PSe=class extends kt{constructor(){super(...arguments),this.beanName="pinnedRowModel",this.nextId=0,this.pinnedTopRows=new v6,this.pinnedBottomRows=new v6}wireBeans(t){this.beans=t}postConstruct(){this.setPinnedRowData(this.gos.get("pinnedTopRowData"),"top"),this.setPinnedRowData(this.gos.get("pinnedBottomRowData"),"bottom"),this.addManagedPropertyListener("pinnedTopRowData",t=>this.setPinnedRowData(t.currentValue,"top")),this.addManagedPropertyListener("pinnedBottomRowData",t=>this.setPinnedRowData(t.currentValue,"bottom")),this.addManagedEventListeners({gridStylesChanged:this.onGridStylesChanges.bind(this)})}isEmpty(t){return(t==="top"?this.pinnedTopRows:this.pinnedBottomRows).isEmpty()}isRowsToRender(t){return!this.isEmpty(t)}onGridStylesChanges(t){if(t.rowHeightChanged){const e=i=>{i.setRowHeight(i.rowHeight,!0)};this.pinnedBottomRows.forEach(e),this.pinnedTopRows.forEach(e)}}ensureRowHeightsValid(){let t=!1,e=0;const i=n=>{if(n.rowHeightEstimated){const r=Mp(this.gos,n);n.setRowTop(e),n.setRowHeight(r.height),e+=r.height,t=!0}};return this.pinnedBottomRows?.forEach(i),e=0,this.pinnedTopRows?.forEach(i),this.eventService.dispatchEvent({type:"pinnedHeightChanged"}),t}setPinnedRowData(t,e){this.updateNodesFromRowData(t,e),this.eventService.dispatchEvent({type:"pinnedRowDataChanged"})}updateNodesFromRowData(t,e){const i=e==="top"?this.pinnedTopRows:this.pinnedBottomRows;if(t===void 0){i.clear();return}const n=ix(this.gos),r=e==="top"?Ad.ID_PREFIX_TOP_PINNED:Ad.ID_PREFIX_BOTTOM_PINNED,s=i.getIds(),o=[],a=new Set;let l=0,u=-1;for(const d of t){const p=n?.({data:d,level:0,rowPinned:e})??r+this.nextId++;if(a.has(p)){Wt("Duplicate ID",p,"found for pinned row with data",d,"When `getRowId` is defined, it must return unique IDs for all pinned rows. Use the `rowPinned` parameter.");continue}u++,a.add(p),o.push(p);const v=i.getById(p);if(v!==void 0)v.data!==d&&v.setData(d),l+=this.setRowTopAndRowIndex(v,l,u),s.delete(p);else{const y=new Ad(this.beans);y.id=p,y.data=d,y.rowPinned=e,l+=this.setRowTopAndRowIndex(y,l,u),i.push(y)}}s.forEach(d=>{i.getById(d)?.clearRowTopAndRowIndex()}),i.removeAllById(s),i.setOrder(o)}setRowTopAndRowIndex(t,e,i){return t.setRowTop(e),t.setRowHeight(Mp(this.gos,t).height),t.setRowIndex(i),t.rowHeight}getPinnedTopTotalHeight(){return this.getTotalHeight(this.pinnedTopRows)}getPinnedBottomTotalHeight(){return this.getTotalHeight(this.pinnedBottomRows)}getPinnedTopRowCount(){return this.pinnedTopRows.getSize()}getPinnedBottomRowCount(){return this.pinnedBottomRows.getSize()}getPinnedTopRow(t){return this.pinnedTopRows.getByIndex(t)}getPinnedBottomRow(t){return this.pinnedBottomRows.getByIndex(t)}getPinnedRowById(t,e){return e==="top"?this.pinnedTopRows.getById(t):this.pinnedBottomRows.getById(t)}forEachPinnedRow(t,e){return t==="top"?this.pinnedTopRows.forEach(e):this.pinnedBottomRows.forEach(e)}getTotalHeight(t){const e=t.getSize();if(e===0)return 0;const i=t.getByIndex(e-1);return i===void 0?0:i.rowTop+i.rowHeight}},v6=class{constructor(){this.cache={},this.ordering=[]}getById(t){return this.cache[t]}getByIndex(t){const e=this.ordering[t];return this.cache[e]}push(t){this.cache[t.id]=t,this.ordering.push(t.id)}removeAllById(t){for(const e of t)delete this.cache[e];this.ordering=this.ordering.filter(e=>!t.has(e))}setOrder(t){this.ordering=t}forEach(t){this.ordering.forEach((e,i)=>{const n=this.cache[e];n&&t(n,i)})}clear(){this.ordering.length=0,this.cache={}}isEmpty(){return this.ordering.length===0}getSize(){return this.ordering.length}getIds(){return new Set(this.ordering)}},ESe=class extends kt{constructor(t){super(),this.state="needsLoading",this.version=0,this.id=t}getId(){return this.id}load(){this.state="loading",this.loadFromDatasource()}getVersion(){return this.version}setStateWaitingToLoad(){this.version++,this.state="needsLoading"}getState(){return this.state}pageLoadFailed(t){this.isRequestMostRecentAndLive(t)&&(this.state="failed",this.processServerFail()),this.dispatchLoadCompleted(!1)}success(t,e){this.successCommon(t,e)}pageLoaded(t,e,i){this.successCommon(t,{rowData:e,rowCount:i})}isRequestMostRecentAndLive(t){const e=t===this.version,i=this.isAlive();return e&&i}successCommon(t,e){this.dispatchLoadCompleted(),this.isRequestMostRecentAndLive(t)&&(this.state="loaded",this.processServerResult(e))}dispatchLoadCompleted(t=!0){const e={type:"loadComplete",success:t,block:this};this.dispatchLocalEvent(e)}},ASe=class extends kt{constructor(){super(...arguments),this.beanName="rowNodeBlockLoader",this.activeBlockLoadsCount=0,this.blocks=[],this.active=!0}wireBeans(t){this.rowModel=t.rowModel}postConstruct(){this.maxConcurrentRequests=this.getMaxConcurrentDatasourceRequests();const t=this.gos.get("blockLoadDebounceMillis");t&&t>0&&(this.checkBlockToLoadDebounce=Fa(this.performCheckBlocksToLoad.bind(this),t))}getMaxConcurrentDatasourceRequests(){const t=this.gos.get("maxConcurrentDatasourceRequests");if(t==null)return 2;if(!(t<=0))return t}addBlock(t){this.blocks.push(t),t.addEventListener("loadComplete",this.loadComplete.bind(this)),this.checkBlockToLoad()}removeBlock(t){Na(this.blocks,t)}destroy(){super.destroy(),this.active=!1}loadComplete(){this.activeBlockLoadsCount--,this.checkBlockToLoad(),this.dispatchLocalEvent({type:"blockLoaded"}),this.activeBlockLoadsCount==0&&this.dispatchLocalEvent({type:"blockLoaderFinished"})}checkBlockToLoad(){this.checkBlockToLoadDebounce?this.checkBlockToLoadDebounce():this.performCheckBlocksToLoad()}performCheckBlocksToLoad(){if(!this.active)return;if(this.printCacheStatus(),this.maxConcurrentRequests!=null&&this.activeBlockLoadsCount>=this.maxConcurrentRequests){this.gos.get("debug")&&Ic("RowNodeBlockLoader - checkBlockToLoad: max loads exceeded");return}const t=this.getAvailableLoadingCount(),e=this.blocks.filter(i=>i.getState()==="needsLoading").slice(0,t);this.registerLoads(e.length),e.forEach(i=>i.load()),this.printCacheStatus()}getBlockState(){if(tf(this.gos))return this.rowModel.getBlockStates();const t={};return this.blocks.forEach(e=>{const{id:i,state:n}=e.getBlockStateJson();t[i]=n}),t}printCacheStatus(){this.gos.get("debug")&&Ic(`RowNodeBlockLoader - printCacheStatus: activePageLoadsCount = ${this.activeBlockLoadsCount}, blocks = ${JSON.stringify(this.getBlockState())}`)}isLoading(){return this.activeBlockLoadsCount>0}registerLoads(t){this.activeBlockLoadsCount+=t}getAvailableLoadingCount(){return this.maxConcurrentRequests!==void 0?this.maxConcurrentRequests-this.activeBlockLoadsCount:void 0}},ISe={version:fn,moduleName:"@ag-grid-community/row-node-block",beans:[ASe]},kSe=class{constructor(){this.root=null,this.end=null,this.cachedRange=[]}init(t){this.rowModel=t}reset(){this.root=null,this.end=null,this.cachedRange.length=0}setRoot(t){this.root=t,this.end=null,this.cachedRange.length=0}setEndRange(t){this.end=t,this.cachedRange.length=0}getRange(){if(this.cachedRange.length===0){const t=this.getRoot(),e=this.getEnd();if(t==null||e==null)return this.cachedRange;this.cachedRange=this.rowModel.getNodesInRangeForSelection(t,e)}return this.cachedRange}isInRange(t){return this.root===null?!1:this.getRange().some(e=>e.id===t.id)}getRoot(){return this.root&&this.root?.key===null&&(this.root=this.rowModel.getRowNode(this.root.id)??null),this.root}getEnd(){return this.end&&this.end?.key===null&&(this.end=this.rowModel.getRowNode(this.end.id)??null),this.end}truncate(t){const e=this.getRange();if(e.length===0)return{keep:[],discard:[]};const i=e[0].id===this.root.id,n=e.findIndex(r=>r.id===t.id);if(n>-1){const r=e.slice(0,n),s=e.slice(n+1);return this.setEndRange(t),i?{keep:r,discard:s}:{keep:s,discard:r}}else return{keep:e,discard:[]}}extend(t,e=!1){const i=this.getRoot();if(i==null){const r=this.getRange().slice();return e&&t.depthFirstSearch(s=>!s.group&&r.push(s)),r.push(t),this.setRoot(t),{keep:r,discard:[]}}if(this.rowModel.getNodesInRangeForSelection(i,t).find(r=>r.id===this.end?.id))return this.setEndRange(t),{keep:this.getRange(),discard:[]};{const r=this.getRange().slice();return this.setEndRange(t),{keep:this.getRange(),discard:r}}}},DSe=class extends kt{constructor(){super(...arguments),this.beanName="stylingService"}wireBeans(t){this.expressionService=t.expressionService}processAllCellClasses(t,e,i,n){this.processClassRules(void 0,t.cellClassRules,e,i,n),this.processStaticCellClasses(t,e,i)}processClassRules(t,e,i,n,r){if(e==null&&t==null)return;const s={},o={},a=(l,u)=>{l.split(" ").forEach(d=>{d.trim()!=""&&u(d)})};if(e){const l=Object.keys(e);for(let u=0;u<l.length;u++){const d=l[u],p=e[d];let v;typeof p=="string"?v=this.expressionService.evaluate(p,i):typeof p=="function"&&(v=p(i)),a(d,y=>{v?s[y]=!0:o[y]=!0})}}t&&r&&Object.keys(t).forEach(l=>a(l,u=>{s[u]||(o[u]=!0)})),r&&Object.keys(o).forEach(r),Object.keys(s).forEach(n)}getStaticCellClasses(t,e){const{cellClass:i}=t;if(!i)return[];let n;return typeof i=="function"?n=i(e):n=i,typeof n=="string"&&(n=[n]),n||[]}processStaticCellClasses(t,e,i){this.getStaticCellClasses(t,e).forEach(r=>{i(r)})}},LSe=class extends kt{constructor(t){super(),this.skipTabGuardFocus=!1,this.forcingFocusOut=!1,this.allowFocus=!1;const{comp:e,eTopGuard:i,eBottomGuard:n,focusTrapActive:r,forceFocusOutWhenTabGuardsAreEmpty:s,isFocusableContainer:o,focusInnerElement:a,onFocusIn:l,onFocusOut:u,shouldStopEventPropagation:d,onTabKeyDown:p,handleKeyDown:v,eFocusableElement:y}=t;this.comp=e,this.eTopGuard=i,this.eBottomGuard=n,this.providedFocusInnerElement=a,this.eFocusableElement=y,this.focusTrapActive=!!r,this.forceFocusOutWhenTabGuardsAreEmpty=!!s,this.isFocusableContainer=!!o,this.providedFocusIn=l,this.providedFocusOut=u,this.providedShouldStopEventPropagation=d,this.providedOnTabKeyDown=p,this.providedHandleKeyDown=v}wireBeans(t){this.focusService=t.focusService}postConstruct(){this.createManagedBean(new Kg(this.eFocusableElement,{shouldStopEventPropagation:()=>this.shouldStopEventPropagation(),onTabKeyDown:t=>this.onTabKeyDown(t),handleKeyDown:t=>this.handleKeyDown(t),onFocusIn:t=>this.onFocusIn(t),onFocusOut:t=>this.onFocusOut(t)})),this.activateTabGuards(),[this.eTopGuard,this.eBottomGuard].forEach(t=>this.addManagedElementListeners(t,{focus:this.onFocus.bind(this)}))}handleKeyDown(t){this.providedHandleKeyDown&&this.providedHandleKeyDown(t)}tabGuardsAreActive(){return!!this.eTopGuard&&this.eTopGuard.hasAttribute("tabIndex")}shouldStopEventPropagation(){return this.providedShouldStopEventPropagation?this.providedShouldStopEventPropagation():!1}activateTabGuards(){if(this.forcingFocusOut)return;const t=this.gos.get("tabIndex");this.comp.setTabIndex(t.toString())}deactivateTabGuards(){this.comp.setTabIndex()}onFocus(t){if(this.isFocusableContainer&&!this.eFocusableElement.contains(t.relatedTarget)&&!this.allowFocus){this.findNextElementOutsideAndFocus(t.target===this.eBottomGuard);return}if(this.skipTabGuardFocus){this.skipTabGuardFocus=!1;return}if(this.forceFocusOutWhenTabGuardsAreEmpty&&this.focusService.findFocusableElements(this.eFocusableElement,".ag-tab-guard").length===0){this.findNextElementOutsideAndFocus(t.target===this.eBottomGuard);return}if(this.isFocusableContainer&&this.eFocusableElement.contains(t.relatedTarget))return;const e=t.target===this.eBottomGuard;this.providedFocusInnerElement?this.providedFocusInnerElement(e):this.focusInnerElement(e)}findNextElementOutsideAndFocus(t){const e=Rs(this.gos),i=this.focusService.findFocusableElements(e.body,null,!0),n=i.indexOf(t?this.eTopGuard:this.eBottomGuard);if(n===-1)return;let r,s;t?(r=0,s=n):(r=n+1,s=i.length);const o=i.slice(r,s),a=this.gos.get("tabIndex");o.sort((l,u)=>{const d=parseInt(l.getAttribute("tabindex")||"0"),p=parseInt(u.getAttribute("tabindex")||"0");return p===a?1:d===a?-1:d===0?1:p===0?-1:d-p}),o[t?o.length-1:0]?.focus()}onFocusIn(t){this.focusTrapActive||this.forcingFocusOut||(this.providedFocusIn&&this.providedFocusIn(t),this.isFocusableContainer||this.deactivateTabGuards())}onFocusOut(t){this.focusTrapActive||(this.providedFocusOut&&this.providedFocusOut(t),this.eFocusableElement.contains(t.relatedTarget)||this.activateTabGuards())}onTabKeyDown(t){if(this.providedOnTabKeyDown){this.providedOnTabKeyDown(t);return}if(this.focusTrapActive||t.defaultPrevented)return;const e=this.tabGuardsAreActive();e&&this.deactivateTabGuards();const i=this.getNextFocusableElement(t.shiftKey);e&&setTimeout(()=>this.activateTabGuards(),0),i&&(i.focus(),t.preventDefault())}focusInnerElement(t=!1){const e=this.focusService.findFocusableElements(this.eFocusableElement);this.tabGuardsAreActive()&&(e.splice(0,1),e.splice(e.length-1,1)),e.length&&e[t?e.length-1:0].focus({preventScroll:!0})}getNextFocusableElement(t){return this.focusService.findNextFocusableElement(this.eFocusableElement,!1,t)}forceFocusOutOfContainer(t=!1){if(this.forcingFocusOut)return;const e=t?this.eTopGuard:this.eBottomGuard;this.activateTabGuards(),this.skipTabGuardFocus=!0,this.forcingFocusOut=!0,e.focus(),window.setTimeout(()=>{this.forcingFocusOut=!1,this.activateTabGuards()})}isTabGuard(t,e){return t===this.eTopGuard&&!e||t===this.eBottomGuard&&(e??!0)}setAllowFocus(t){this.allowFocus=t}},FSe=class extends kt{constructor(t){super(),this.comp=t}initialiseTabGuard(t){this.eTopGuard=this.createTabGuard("top"),this.eBottomGuard=this.createTabGuard("bottom"),this.eFocusableElement=this.comp.getFocusableElement();const{eTopGuard:e,eBottomGuard:i,eFocusableElement:n}=this,r=[e,i],s={setTabIndex:R=>{r.forEach(O=>R!=null?O.setAttribute("tabindex",R):O.removeAttribute("tabindex"))}};this.addTabGuards(e,i);const{focusTrapActive:o=!1,onFocusIn:a,onFocusOut:l,focusInnerElement:u,handleKeyDown:d,onTabKeyDown:p,shouldStopEventPropagation:v,forceFocusOutWhenTabGuardsAreEmpty:y,isFocusableContainer:w}=t;this.tabGuardCtrl=this.createManagedBean(new LSe({comp:s,focusTrapActive:o,eTopGuard:e,eBottomGuard:i,eFocusableElement:n,onFocusIn:a,onFocusOut:l,focusInnerElement:u,handleKeyDown:d,onTabKeyDown:p,shouldStopEventPropagation:v,forceFocusOutWhenTabGuardsAreEmpty:y,isFocusableContainer:w}))}getTabGuardCtrl(){return this.tabGuardCtrl}createTabGuard(t){const e=Rs(this.gos).createElement("div"),i=t==="top"?"ag-tab-guard-top":"ag-tab-guard-bottom";return e.classList.add("ag-tab-guard",i),nc(e,"presentation"),e}addTabGuards(t,e){this.eFocusableElement.insertAdjacentElement("afterbegin",t),this.eFocusableElement.insertAdjacentElement("beforeend",e)}removeAllChildrenExceptTabGuards(){const t=[this.eTopGuard,this.eBottomGuard];fa(this.comp.getFocusableElement()),this.addTabGuards(...t)}forceFocusOutOfContainer(t=!1){this.tabGuardCtrl.forceFocusOutOfContainer(t)}appendChild(t,e,i){dU(e)||(e=e.getGui());const{eBottomGuard:n}=this;n?n.insertAdjacentElement("beforebegin",e):t(e,i)}},UJ=class extends ir{initialiseTabGuard(t){this.tabGuardFeature=this.createManagedBean(new FSe(this)),this.tabGuardFeature.initialiseTabGuard(t)}forceFocusOutOfContainer(t=!1){this.tabGuardFeature.forceFocusOutOfContainer(t)}appendChild(t,e){this.tabGuardFeature.appendChild(super.appendChild.bind(this),t,e)}},NSe=0,BSe=200,zSe=class extends kt{constructor(){super(...arguments),this.beanName="popupService",this.popupList=[]}wireBeans(t){this.ctrlsService=t.ctrlsService,this.resizeObserverService=t.resizeObserverService,this.environment=t.environment}postConstruct(){this.ctrlsService.whenReady(this,t=>{this.gridCtrl=t.gridCtrl}),this.addManagedEventListeners({gridStylesChanged:this.handleThemeChange.bind(this)})}getPopupParent(){const t=this.gos.get("popupParent");return t||this.gridCtrl.getGui()}positionPopupForMenu(t){const{eventSource:e,ePopup:i}=t,n=this.getPopupIndex(i);if(n!==-1){const y=this.popupList[n];y.alignedToElement=e}const r=e.getBoundingClientRect(),s=this.getParentRect(),o=this.keepXYWithinBounds(i,r.top-s.top,0),a=i.clientWidth>0?i.clientWidth:200;i.style.minWidth=`${a}px`;const u=s.right-s.left-a;let d;this.gos.get("enableRtl")?(d=v(),d<0&&(d=p(),this.setAlignedStyles(i,"left")),d>u&&(d=0,this.setAlignedStyles(i,"right"))):(d=p(),d>u&&(d=v(),this.setAlignedStyles(i,"right")),d<0&&(d=0,this.setAlignedStyles(i,"left"))),i.style.left=`${d}px`,i.style.top=`${o}px`;function p(){return r.right-s.left-2}function v(){return r.left-s.left-a}}positionPopupUnderMouseEvent(t){const{ePopup:e,nudgeX:i,nudgeY:n,skipObserver:r}=t;this.positionPopup({ePopup:e,nudgeX:i,nudgeY:n,keepWithinBounds:!0,skipObserver:r,updatePosition:()=>this.calculatePointerAlign(t.mouseEvent),postProcessCallback:()=>this.callPostProcessPopup(t.type,t.ePopup,null,t.mouseEvent,t.column,t.rowNode)})}calculatePointerAlign(t){const e=this.getParentRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}positionPopupByComponent(t){const{ePopup:e,nudgeX:i,nudgeY:n,keepWithinBounds:r,eventSource:s,alignSide:o="left",position:a="over",column:l,rowNode:u,type:d}=t,p=s.getBoundingClientRect(),v=this.getParentRect(),y=this.getPopupIndex(e);if(y!==-1){const R=this.popupList[y];R.alignedToElement=s}const w=()=>{let R=p.left-v.left;o==="right"&&(R-=e.offsetWidth-p.width);let O;return a==="over"?(O=p.top-v.top,this.setAlignedStyles(e,"over")):(this.setAlignedStyles(e,"under"),this.shouldRenderUnderOrAbove(e,p,v,t.nudgeY||0)==="under"?O=p.top-v.top+p.height:O=p.top-e.offsetHeight-(n||0)*2-v.top),{x:R,y:O}};this.positionPopup({ePopup:e,nudgeX:i,nudgeY:n,keepWithinBounds:r,updatePosition:w,postProcessCallback:()=>this.callPostProcessPopup(d,e,s,null,l,u)})}shouldRenderUnderOrAbove(t,e,i,n){const r=i.bottom-e.bottom,s=e.top-i.top,o=t.offsetHeight+n;return r>o?"under":s>o||s>r?"above":"under"}setAlignedStyles(t,e){const i=this.getPopupIndex(t);if(i===-1)return;const n=this.popupList[i],{alignedToElement:r}=n;!r||(["right","left","over","above","under"].forEach(o=>{r.classList.remove(`ag-has-popup-positioned-${o}`),t.classList.remove(`ag-popup-positioned-${o}`)}),!e)||(r.classList.add(`ag-has-popup-positioned-${e}`),t.classList.add(`ag-popup-positioned-${e}`))}callPostProcessPopup(t,e,i,n,r,s){const o=this.gos.getCallback("postProcessPopup");o&&o({column:r,rowNode:s,ePopup:e,type:t,eventSource:i,mouseEvent:n})}positionPopup(t){const{ePopup:e,keepWithinBounds:i,nudgeX:n,nudgeY:r,skipObserver:s,updatePosition:o}=t,a={width:0,height:0},l=(u=!1)=>{let{x:d,y:p}=o();u&&e.clientWidth===a.width&&e.clientHeight===a.height||(a.width=e.clientWidth,a.height=e.clientHeight,n&&(d+=n),r&&(p+=r),i&&(d=this.keepXYWithinBounds(e,d,1),p=this.keepXYWithinBounds(e,p,0)),e.style.left=`${d}px`,e.style.top=`${p}px`,t.postProcessCallback&&t.postProcessCallback())};if(l(),!s){const u=this.resizeObserverService.observeResize(e,()=>l(!0));setTimeout(()=>u(),BSe)}}getActivePopups(){return this.popupList.map(t=>t.element)}getPopupList(){return this.popupList}getParentRect(){const t=Rs(this.gos);let e=this.getPopupParent();return e===t.body?e=t.documentElement:getComputedStyle(e).position==="static"&&(e=e.offsetParent),BY(e)}keepXYWithinBounds(t,e,i){const n=i===0,r=n?"clientHeight":"clientWidth",s=n?"top":"left",o=n?"height":"width",a=n?"scrollTop":"scrollLeft",l=Rs(this.gos),u=l.documentElement,d=this.getPopupParent(),p=t.getBoundingClientRect(),v=d.getBoundingClientRect(),y=l.documentElement.getBoundingClientRect(),w=d===l.body,R=Math.ceil(p[o]);let P=w?(n?NY:RT)(u)+u[a]:d[r];w&&(P-=Math.abs(y[s]-v[s]));const N=P-R;return Math.min(Math.max(e,0),Math.abs(N))}addPopup(t){const e=Rs(this.gos),{eChild:i,ariaLabel:n,alwaysOnTop:r,positionCallback:s,anchorToElement:o}=t;if(!e)return Wt("could not find the document, document is empty"),{hideFunc:()=>{}};const a=this.getPopupIndex(i);if(a!==-1)return{hideFunc:this.popupList[a].hideFunc};this.initialisePopupPosition(i);const l=this.createPopupWrapper(i,n,!!r),u=this.addEventListenersToPopup({...t,wrapperEl:l});return s&&s(),this.addPopupToPopupList(i,l,u,o),{hideFunc:u}}initialisePopupPosition(t){const i=this.getPopupParent().getBoundingClientRect();oi(t.style.top)||(t.style.top=`${i.top*-1}px`),oi(t.style.left)||(t.style.left=`${i.left*-1}px`)}createPopupWrapper(t,e,i){const n=this.getPopupParent(),r=document.createElement("div");return this.environment.applyThemeClasses(r),r.classList.add("ag-popup"),t.classList.add(this.gos.get("enableRtl")?"ag-rtl":"ag-ltr","ag-popup-child"),t.hasAttribute("role")||nc(t,"dialog"),O0(t,e),r.appendChild(t),n.appendChild(r),i?this.setAlwaysOnTop(t,!0):this.bringPopupToFront(t),r}handleThemeChange(t){if(t.themeChanged)for(const e of this.popupList)this.environment.applyThemeClasses(e.wrapper)}addEventListenersToPopup(t){const e=Rs(this.gos),i=this.getPopupParent(),{wrapperEl:n,eChild:r,closedCallback:s,afterGuiAttached:o,closeOnEsc:a,modal:l}=t;let u=!1;const d=w=>{if(!n.contains(Jr(this.gos)))return;w.key===St.ESCAPE&&!Ed(w)&&y({keyboardEvent:w})},p=w=>y({mouseEvent:w}),v=w=>y({touchEvent:w}),y=(w={})=>{const{mouseEvent:R,touchEvent:O,keyboardEvent:P,forceHide:N}=w;!N&&(this.isEventFromCurrentPopup({mouseEvent:R,touchEvent:O},r)||u)||(u=!0,i.removeChild(n),e.removeEventListener("keydown",d),e.removeEventListener("mousedown",p),e.removeEventListener("touchstart",v),e.removeEventListener("contextmenu",p),this.eventService.removeEventListener("dragStarted",p),s&&s(R||O||P),this.removePopupFromPopupList(r))};return o&&o({hidePopup:y}),window.setTimeout(()=>{a&&e.addEventListener("keydown",d),l&&(e.addEventListener("mousedown",p),this.eventService.addEventListener("dragStarted",p),e.addEventListener("touchstart",v),e.addEventListener("contextmenu",p))},0),y}addPopupToPopupList(t,e,i,n){this.popupList.push({element:t,wrapper:e,hideFunc:i,instanceId:NSe++,isAnchored:!!n}),n&&this.setPopupPositionRelatedToElement(t,n)}getPopupIndex(t){return this.popupList.findIndex(e=>e.element===t)}setPopupPositionRelatedToElement(t,e){const i=this.getPopupIndex(t);if(i===-1)return;const n=this.popupList[i];if(n.stopAnchoringPromise&&n.stopAnchoringPromise.then(s=>s&&s()),n.stopAnchoringPromise=void 0,n.isAnchored=!1,!e)return;const r=this.keepPopupPositionedRelativeTo({element:e,ePopup:t,hidePopup:n.hideFunc});return n.stopAnchoringPromise=r,n.isAnchored=!0,r}removePopupFromPopupList(t){this.setAlignedStyles(t,null),this.setPopupPositionRelatedToElement(t,null),this.popupList=this.popupList.filter(e=>e.element!==t)}keepPopupPositionedRelativeTo(t){const e=this.getPopupParent(),i=e.getBoundingClientRect(),{element:n,ePopup:r}=t,s=n.getBoundingClientRect(),o=p=>parseInt(p.substring(0,p.length-1),10),a=(p,v)=>{const y=i[p]-s[p],w=o(r.style[p]);return{initialDiff:y,lastDiff:y,initial:w,last:w,direction:v}},l=a("top",0),u=a("left",1),d=this.getFrameworkOverrides();return new Hl(p=>{d.wrapIncoming(()=>{d.setInterval(()=>{const v=e.getBoundingClientRect(),y=n.getBoundingClientRect();if(y.top==0&&y.left==0&&y.height==0&&y.width==0){t.hidePopup();return}const R=(O,P)=>{const N=o(r.style[P]);O.last!==N&&(O.initial=N,O.last=N);const F=v[P]-y[P];if(F!=O.lastDiff){const k=this.keepXYWithinBounds(r,O.initial+O.initialDiff-F,O.direction);r.style[P]=`${k}px`,O.last=k}O.lastDiff=F};R(l,"top"),R(u,"left")},200).then(v=>{p(()=>{v!=null&&window.clearInterval(v)})})},"popupPositioning")})}hasAnchoredPopup(){return this.popupList.some(t=>t.isAnchored)}isEventFromCurrentPopup(t,e){const{mouseEvent:i,touchEvent:n}=t,r=i||n;if(!r)return!1;const s=this.getPopupIndex(e);if(s===-1)return!1;for(let o=s;o<this.popupList.length;o++){const a=this.popupList[o];if(K0e(a.element,r))return!0}return this.isElementWithinCustomPopup(r.target)}isElementWithinCustomPopup(t){const e=Rs(this.gos);for(;t&&t!==e.body;){if(t.classList.contains("ag-custom-component-popup")||t.parentElement===null)return!0;t=t.parentElement}return!1}getWrapper(t){for(;!t.classList.contains("ag-popup")&&t.parentElement;)t=t.parentElement;return t.classList.contains("ag-popup")?t:null}setAlwaysOnTop(t,e){const i=this.getWrapper(t);i&&(i.classList.toggle("ag-always-on-top",!!e),e&&this.bringPopupToFront(i))}bringPopupToFront(t){const e=this.getPopupParent(),i=Array.prototype.slice.call(e.querySelectorAll(".ag-popup")),n=i.length,r=this.getWrapper(t);if(!r||n<=1||!e.contains(t))return;const s=[],o=[];for(const v of i)v!==r&&(v.classList.contains("ag-always-on-top")?o.push(v):s.push(v));const a=[],l=o.length,p=r.classList.contains("ag-always-on-top")||!l?[...s,...o,r]:[...s,r,...o];for(let v=0;v<=n;v++){const y=p[v];if(i[v]===p[v]||y===r)continue;y.querySelectorAll("div").forEach(R=>{R.scrollTop!==0&&a.push([R,R.scrollTop])}),v===0?e.insertAdjacentElement("afterbegin",y):p[v-1].insertAdjacentElement("afterend",y)}for(;a.length;){const v=a.pop();v[0].scrollTop=v[1]}}},VSe=["touchstart","touchend","touchmove","touchcancel"],GSe=class{constructor(t="javascript"){this.frameworkName=t,this.renderingEngine="vanilla",this.wrapIncoming=e=>e(),this.wrapOutgoing=e=>e()}setInterval(t,e){return new Hl(i=>{i(window.setInterval(t,e))})}addEventListener(t,e,i,n){const r=fg(VSe,e);t.addEventListener(e,i,{capture:!!n,passive:r})}get shouldWrapOutgoing(){return!1}frameworkComponent(t){return null}isFrameworkComponent(t){return!1}getDocLink(t){return`https://www.ag-grid.com/${this.frameworkName==="solid"?"react":this.frameworkName}-data-grid${t?`/${t}`:""}`}},USe=class extends kt{constructor(){super(...arguments),this.beanName="cellNavigationService"}wireBeans(t){this.visibleColsService=t.visibleColsService,this.rowModel=t.rowModel,this.rowRenderer=t.rowRenderer,this.pinnedRowModel=t.pinnedRowModel,this.paginationService=t.paginationService,this.pageBoundsService=t.pageBoundsService}getNextCellToFocus(t,e,i=!1){return i?this.getNextCellToFocusWithCtrlPressed(t,e):this.getNextCellToFocusWithoutCtrlPressed(t,e)}getNextCellToFocusWithCtrlPressed(t,e){const i=t===St.UP,n=t===St.DOWN,r=t===St.LEFT;let s,o;if(i||n)o=i?this.pageBoundsService.getFirstRow():this.pageBoundsService.getLastRow(),s=e.column;else{const a=this.visibleColsService.getAllCols(),l=this.gos.get("enableRtl");o=e.rowIndex,s=r!==l?a[0]:Yn(a)}return{rowIndex:o,rowPinned:null,column:s}}getNextCellToFocusWithoutCtrlPressed(t,e){let i=e,n=!1;for(;!n;){switch(t){case St.UP:i=this.getCellAbove(i);break;case St.DOWN:i=this.getCellBelow(i);break;case St.RIGHT:this.gos.get("enableRtl")?i=this.getCellToLeft(i):i=this.getCellToRight(i);break;case St.LEFT:this.gos.get("enableRtl")?i=this.getCellToRight(i):i=this.getCellToLeft(i);break;default:i=null,Wt("unknown key for navigation ",t);break}i?n=this.isCellGoodToFocusOn(i):n=!0}return i}isCellGoodToFocusOn(t){const e=t.column;let i;switch(t.rowPinned){case"top":i=this.pinnedRowModel.getPinnedTopRow(t.rowIndex);break;case"bottom":i=this.pinnedRowModel.getPinnedBottomRow(t.rowIndex);break;default:i=this.rowModel.getRow(t.rowIndex);break}return i?!e.isSuppressNavigable(i):!1}getCellToLeft(t){if(!t)return null;const e=this.visibleColsService.getColBefore(t.column);return e?{rowIndex:t.rowIndex,column:e,rowPinned:t.rowPinned}:null}getCellToRight(t){if(!t)return null;const e=this.visibleColsService.getColAfter(t.column);return e?{rowIndex:t.rowIndex,column:e,rowPinned:t.rowPinned}:null}getRowBelow(t){const e=t.rowIndex,i=t.rowPinned;let n=!1;if(this.isLastRowInContainer(t))switch(i){case"bottom":return null;case"top":return this.rowModel.isRowsToRender()?{rowIndex:this.pageBoundsService.getFirstRow(),rowPinned:null}:this.pinnedRowModel.isRowsToRender("bottom")?{rowIndex:0,rowPinned:"bottom"}:null;default:return this.pinnedRowModel.isRowsToRender("bottom")?{rowIndex:0,rowPinned:"bottom"}:null}else i&&(n=!0);const r=this.rowModel.getRow(t.rowIndex),s=n?void 0:this.getNextStickyPosition(r);return s||{rowIndex:e+1,rowPinned:i}}getNextStickyPosition(t,e){if(!vP(this.gos)||!t||!t.sticky)return;const i=this.rowRenderer.getStickyTopRowCtrls().some(a=>a.getRowNode().rowIndex===t.rowIndex);let n=[];i?n=[...this.rowRenderer.getStickyTopRowCtrls()].sort((a,l)=>a.getRowNode().rowIndex-l.getRowNode().rowIndex):n=[...this.rowRenderer.getStickyBottomRowCtrls()].sort((a,l)=>l.getRowNode().rowIndex-a.getRowNode().rowIndex);const r=e?-1:1,s=n.findIndex(a=>a.getRowNode().rowIndex===t.rowIndex),o=n[s+r];if(o)return{rowIndex:o.getRowNode().rowIndex,rowPinned:null}}getCellBelow(t){if(!t)return null;const e=this.getRowBelow(t);return e?{rowIndex:e.rowIndex,column:t.column,rowPinned:e.rowPinned}:null}isLastRowInContainer(t){const e=t.rowPinned,i=t.rowIndex;return e==="top"?this.pinnedRowModel.getPinnedTopRowCount()-1<=i:e==="bottom"?this.pinnedRowModel.getPinnedBottomRowCount()-1<=i:this.pageBoundsService.getLastRow()<=i}getRowAbove(t){const e=t.rowIndex,i=t.rowPinned,n=i?e===0:e===this.pageBoundsService.getFirstRow();let r=!1;if(n)return i==="top"?null:i?this.rowModel.isRowsToRender()?this.getLastBodyCell():this.pinnedRowModel.isRowsToRender("top")?this.getLastFloatingTopRow():null:this.pinnedRowModel.isRowsToRender("top")?this.getLastFloatingTopRow():null;i&&(r=!0);const s=this.rowModel.getRow(t.rowIndex),o=r?void 0:this.getNextStickyPosition(s,!0);return o||{rowIndex:e-1,rowPinned:i}}getCellAbove(t){if(!t)return null;const e=this.getRowAbove({rowIndex:t.rowIndex,rowPinned:t.rowPinned});return e?{rowIndex:e.rowIndex,column:t.column,rowPinned:e.rowPinned}:null}getLastBodyCell(){return{rowIndex:this.pageBoundsService.getLastRow(),rowPinned:null}}getLastFloatingTopRow(){return{rowIndex:this.pinnedRowModel.getPinnedTopRowCount()-1,rowPinned:"top"}}getNextTabbedCell(t,e){return e?this.getNextTabbedCellBackwards(t):this.getNextTabbedCellForwards(t)}getNextTabbedCellForwards(t){const e=this.visibleColsService.getAllCols();let i=t.rowIndex,n=t.rowPinned,r=this.visibleColsService.getColAfter(t.column);if(!r){r=e[0];const s=this.getRowBelow(t);if(Wn(s)||!s.rowPinned&&!(this.paginationService?.isRowInPage(s)??!0))return null;i=s?s.rowIndex:null,n=s?s.rowPinned:null}return{rowIndex:i,column:r,rowPinned:n}}getNextTabbedCellBackwards(t){const e=this.visibleColsService.getAllCols();let i=t.rowIndex,n=t.rowPinned,r=this.visibleColsService.getColBefore(t.column);if(!r){r=Yn(e);const s=this.getRowAbove({rowIndex:t.rowIndex,rowPinned:t.rowPinned});if(Wn(s)||!s.rowPinned&&!(this.paginationService?.isRowInPage(s)??!0))return null;i=s?s.rowIndex:null,n=s?s.rowPinned:null}return{rowIndex:i,column:r,rowPinned:n}}},Ma=(t,e)=>{for(const i in e)e[i]=t;return e},y6={...Ma("@ag-grid-community/core",{dispatchEvent:0,destroy:0,getGridId:0,getGridOption:0,isDestroyed:0,setGridOption:0,updateGridOptions:0,getState:0,setNodesSelected:0,selectAll:0,deselectAll:0,selectAllFiltered:0,deselectAllFiltered:0,selectAllOnCurrentPage:0,deselectAllOnCurrentPage:0,getSelectedNodes:0,getSelectedRows:0,redrawRows:0,setRowNodeExpanded:0,getRowNode:0,addRenderedRowListener:0,getRenderedNodes:0,forEachNode:0,getFirstDisplayedRow:0,getFirstDisplayedRowIndex:0,getLastDisplayedRow:0,getLastDisplayedRowIndex:0,getDisplayedRowAtIndex:0,getDisplayedRowCount:0,getModel:0,getVerticalPixelRange:0,getHorizontalPixelRange:0,ensureColumnVisible:0,ensureIndexVisible:0,ensureNodeVisible:0,getFocusedCell:0,clearFocusedCell:0,setFocusedCell:0,tabToNextCell:0,tabToPreviousCell:0,setFocusedHeader:0,addEventListener:0,addGlobalListener:0,removeEventListener:0,removeGlobalListener:0,expireValueCache:0,getValue:0,getCellValue:0,showColumnMenuAfterButtonClick:0,showColumnMenuAfterMouseClick:0,showColumnMenu:0,hidePopupMenu:0,onSortChanged:0,getPinnedTopRowCount:0,getPinnedBottomRowCount:0,getPinnedTopRow:0,getPinnedBottomRow:0,showLoadingOverlay:0,showNoRowsOverlay:0,hideOverlay:0,setGridAriaProperty:0,refreshCells:0,flashCells:0,refreshHeader:0,isAnimationFrameQueueEmpty:0,flushAllAnimationFrames:0,getSizesForCurrentTheme:0,getCellRendererInstances:0,addRowDropZone:0,removeRowDropZone:0,getRowDropZoneParams:0,getColumnDef:0,getColumnDefs:0,sizeColumnsToFit:0,setColumnGroupOpened:0,getColumnGroup:0,getProvidedColumnGroup:0,getDisplayNameForColumn:0,getDisplayNameForColumnGroup:0,getColumn:0,getColumns:0,applyColumnState:0,getColumnState:0,resetColumnState:0,getColumnGroupState:0,setColumnGroupState:0,resetColumnGroupState:0,isPinning:0,isPinningLeft:0,isPinningRight:0,getDisplayedColAfter:0,getDisplayedColBefore:0,setColumnVisible:0,setColumnsVisible:0,setColumnPinned:0,setColumnsPinned:0,getAllGridColumns:0,getDisplayedLeftColumns:0,getDisplayedCenterColumns:0,getDisplayedRightColumns:0,getAllDisplayedColumns:0,getAllDisplayedVirtualColumns:0,moveColumn:0,moveColumnByIndex:0,moveColumns:0,setColumnWidth:0,setColumnWidths:0,getLeftDisplayedColumnGroups:0,getCenterDisplayedColumnGroups:0,getRightDisplayedColumnGroups:0,getAllDisplayedColumnGroups:0,autoSizeColumn:0,autoSizeColumns:0,autoSizeAllColumns:0,undoCellEditing:0,redoCellEditing:0,getCellEditorInstances:0,getEditingCells:0,stopEditing:0,startEditingCell:0,getCurrentUndoSize:0,getCurrentRedoSize:0,isAnyFilterPresent:0,onFilterChanged:0,isColumnFilterPresent:0,getFilterInstance:0,getColumnFilterInstance:0,destroyFilter:0,setFilterModel:0,getFilterModel:0,getColumnFilterModel:0,setColumnFilterModel:0,showColumnFilter:0,isQuickFilterPresent:0,getQuickFilter:0,resetQuickFilter:0,paginationIsLastPageFound:0,paginationGetPageSize:0,paginationGetCurrentPage:0,paginationGetTotalPages:0,paginationGetRowCount:0,paginationGoToNextPage:0,paginationGoToPreviousPage:0,paginationGoToFirstPage:0,paginationGoToLastPage:0,paginationGoToPage:0,expandAll:0,collapseAll:0,onRowHeightChanged:0,setRowCount:0,getCacheBlockState:0,isLastRowIndexKnown:0}),...Ma("@ag-grid-community/client-side-row-model",{onGroupExpandedOrCollapsed:0,refreshClientSideRowModel:0,isRowDataEmpty:0,forEachLeafNode:0,forEachNodeAfterFilter:0,forEachNodeAfterFilterAndSort:0,resetRowHeights:0,applyTransaction:0,applyTransactionAsync:0,flushAsyncTransactions:0,getBestCostNodeSelection:0}),...Ma("@ag-grid-community/csv-export",{getDataAsCsv:0,exportDataAsCsv:0}),...Ma("@ag-grid-community/infinite-row-model",{refreshInfiniteCache:0,purgeInfiniteCache:0,getInfiniteRowCount:0}),...Ma("@ag-grid-enterprise/advanced-filter",{getAdvancedFilterModel:0,setAdvancedFilterModel:0,showAdvancedFilterBuilder:0,hideAdvancedFilterBuilder:0}),...Ma("@ag-grid-enterprise/charts",{getChartModels:0,getChartRef:0,getChartImageDataURL:0,downloadChart:0,openChartToolPanel:0,closeChartToolPanel:0,createRangeChart:0,createPivotChart:0,createCrossFilterChart:0,updateChart:0,restoreChart:0}),...Ma("@ag-grid-enterprise/clipboard",{copyToClipboard:0,cutToClipboard:0,copySelectedRowsToClipboard:0,copySelectedRangeToClipboard:0,copySelectedRangeDown:0,pasteFromClipboard:0}),...Ma("@ag-grid-enterprise/excel-export",{getDataAsExcel:0,exportDataAsExcel:0,getSheetDataForExcel:0,getMultipleSheetsAsExcel:0,exportMultipleSheetsAsExcel:0}),...Ma("@ag-grid-enterprise/master-detail",{addDetailGridInfo:0,removeDetailGridInfo:0,getDetailGridInfo:0,forEachDetailGridInfo:0}),...Ma("@ag-grid-enterprise/menu",{showContextMenu:0,showColumnChooser:0,hideColumnChooser:0}),...Ma("@ag-grid-enterprise/range-selection",{getCellRanges:0,addCellRange:0,clearRangeSelection:0,clearCellSelection:0}),...Ma("@ag-grid-enterprise/row-grouping",{addAggFunc:0,addAggFuncs:0,clearAggFuncs:0,setColumnAggFunc:0,isPivotMode:0,getPivotResultColumn:0,setValueColumns:0,getValueColumns:0,removeValueColumn:0,removeValueColumns:0,addValueColumn:0,addValueColumns:0,setRowGroupColumns:0,removeRowGroupColumn:0,removeRowGroupColumns:0,addRowGroupColumn:0,addRowGroupColumns:0,getRowGroupColumns:0,moveRowGroupColumn:0,setPivotColumns:0,removePivotColumn:0,removePivotColumns:0,addPivotColumn:0,addPivotColumns:0,getPivotColumns:0,setPivotResultColumns:0,getPivotResultColumns:0}),...Ma("@ag-grid-enterprise/server-side-row-model",{getServerSideSelectionState:0,setServerSideSelectionState:0,applyServerSideTransaction:0,applyServerSideTransactionAsync:0,applyServerSideRowData:0,retryServerSideLoads:0,flushServerSideAsyncTransactions:0,refreshServerSide:0,getServerSideGroupLevelState:0}),...Ma("@ag-grid-enterprise/side-bar",{isSideBarVisible:0,setSideBarVisible:0,setSideBarPosition:0,openToolPanel:0,closeToolPanel:0,getOpenedToolPanel:0,refreshToolPanel:0,isToolPanelShowing:0,getToolPanelInstance:0,getSideBar:0}),...Ma("@ag-grid-enterprise/status-bar",{getStatusPanel:0})},lN={isDestroyed:()=>!0,destroy(){},preConstruct(){},postConstruct(){},preWireBeans(){},wireBeans(){}},HSe=(t,e)=>t.eventService.dispatchEvent(e),HJ=class{};Reflect.defineProperty(HJ,"name",{value:"GridApi"});var $Se=class extends kt{constructor(){super(),this.beanName="apiFunctionService",this.api=new HJ,this.fns={...lN,dispatchEvent:HSe},this.beans=null,this.preDestroyLink="";const{api:t}=this;for(const e in y6)t[e]=this.makeApi(e)[e]}wireBeans(t){this.beans=t}postConstruct(){this.preDestroyLink=this.frameworkOverrides.getDocLink("grid-lifecycle/#grid-pre-destroyed")}addFunction(t,e){const{fns:i,beans:n}=this;i!==lN&&(i[t]=n?.validationService?.validateApiFunction(t,e)??e)}makeApi(t){return{[t]:(...e)=>{const{beans:i,fns:{[t]:n}}=this;return n?n(i,...e):this.apiNotFound(t)}}}apiNotFound(t){const{beans:e,gos:i,preDestroyLink:n}=this;if(!e)Wt(`Grid API function ${t}() cannot be called as the grid has been destroyed.
Either clear local references to the grid api, when it is destroyed, or check gridApi.isDestroyed() to avoid calling methods against a destroyed grid.
To run logic when the grid is about to be destroyed use the gridPreDestroy event. See: ${n}`);else{const r=y6[t];i.assertModuleRegistered(r,`api.${t}`)&&Wt(`API function '${t}' not registered to module '${r}'`)}}destroy(){super.destroy(),this.fns=lN,this.beans=null}};function WSe(t){return{beanName:"gridApi",bean:t.getBean("apiFunctionService").api}}var qSe=class extends kt{constructor(){super(...arguments),this.beanName="columnDefFactory"}buildColumnDefs(t,e,i){const n=[],r={};return t.forEach(s=>{const o=this.createDefFromColumn(s,e,i);let a=!0,l=o,u=s.getOriginalParent(),d=null;for(;u;){let p=null;if(u.isPadding()){u=u.getOriginalParent();continue}const v=r[u.getGroupId()];if(v){v.children.push(l),a=!1;break}if(p=this.createDefFromGroup(u),p&&(p.children=[l],r[p.groupId]=p,l=p,u=u.getOriginalParent()),u!=null&&d===u){a=!1;break}d=u}a&&n.push(l)}),n}createDefFromGroup(t){const e=vz(t.getColGroupDef(),["children"]);return e&&(e.groupId=t.getGroupId()),e}createDefFromColumn(t,e,i){const n=vz(t.getColDef());return n.colId=t.getColId(),n.width=t.getActualWidth(),n.rowGroup=t.isRowGroupActive(),n.rowGroupIndex=t.isRowGroupActive()?e.indexOf(t):null,n.pivot=t.isPivotActive(),n.pivotIndex=t.isPivotActive()?i.indexOf(t):null,n.aggFunc=t.isValueActive()?t.getAggFunc():null,n.hide=t.isVisible()?void 0:!0,n.pinned=t.isPinned()?t.getPinned():null,n.sort=t.getSort()?t.getSort():null,n.sortIndex=t.getSortIndex()!=null?t.getSortIndex():null,n}},jSe=class extends kt{constructor(){super(...arguments),this.beanName="columnEventDispatcher"}visibleCols(t){this.eventService.dispatchEvent({type:"displayedColumnsChanged",source:t})}gridColumns(){this.eventService.dispatchEvent({type:"gridColumnsChanged"})}headerHeight(t){this.eventService.dispatchEvent({type:"columnHeaderHeightChanged",column:t,columns:[t],source:"autosizeColumnHeaderHeight"})}groupHeaderHeight(t){this.eventService.dispatchEvent({type:"columnGroupHeaderHeightChanged",columnGroup:t,source:"autosizeColumnGroupHeaderHeight"})}groupOpened(t){this.eventService.dispatchEvent({type:"columnGroupOpened",columnGroup:t.length===1?t[0]:void 0,columnGroups:t})}rowGroupChanged(t,e){this.eventService.dispatchEvent({type:"columnRowGroupChanged",columns:t,column:t.length===1?t[0]:null,source:e})}genericColumnEvent(t,e,i){this.eventService.dispatchEvent({type:t,columns:e,column:e.length===1?e[0]:null,source:i})}pivotModeChanged(){this.eventService.dispatchEvent({type:"columnPivotModeChanged"})}virtualColumnsChanged(t){this.eventService.dispatchEvent({type:"virtualColumnsChanged",afterScroll:t})}newColumnsLoaded(t){this.eventService.dispatchEvent({type:"newColumnsLoaded",source:t})}everythingChanged(t){this.eventService.dispatchEvent({type:"columnEverythingChanged",source:t})}columnMoved(t){const{movedColumns:e,source:i,toIndex:n,finished:r}=t;this.eventService.dispatchEvent({type:"columnMoved",columns:e,column:e&&e.length===1?e[0]:null,toIndex:n,finished:r,source:i})}columnPinned(t,e){if(!t.length)return;const i=t.length===1?t[0]:null,n=this.getCommonValue(t,r=>r.getPinned());this.eventService.dispatchEvent({type:"columnPinned",pinned:n??null,columns:t,column:i,source:e})}columnVisible(t,e){if(!t.length)return;const i=t.length===1?t[0]:null,n=this.getCommonValue(t,r=>r.isVisible());this.eventService.dispatchEvent({type:"columnVisible",visible:n,columns:t,column:i,source:e})}getCommonValue(t,e){if(!t||t.length==0)return;const i=e(t[0]);for(let n=1;n<t.length;n++)if(i!==e(t[n]))return;return i}columnChanged(t,e,i){this.eventService.dispatchEvent({type:t,columns:e,column:e&&e.length==1?e[0]:null,source:i})}columnResized(t,e,i,n=null){t&&t.length&&this.eventService.dispatchEvent({type:"columnResized",columns:t,column:t.length===1?t[0]:null,flexColumns:n,finished:e,source:i})}},QSe=class extends kt{constructor(){super(...arguments),this.beanName="columnGetStateService"}wireBeans(t){this.columnModel=t.columnModel,this.funcColsService=t.funcColsService}getColumnState(){const t=this.columnModel.getColDefCols();if(Wn(t)||!this.columnModel.isAlive())return[];const i=this.columnModel.getAllCols().map(n=>this.createStateItemFromColumn(n));return this.orderColumnStateList(i),i}createStateItemFromColumn(t){const e=this.funcColsService.getRowGroupColumns(),i=this.funcColsService.getPivotColumns(),n=t.isRowGroupActive()?e.indexOf(t):null,r=t.isPivotActive()?i.indexOf(t):null,s=t.isValueActive()?t.getAggFunc():null,o=t.getSort()!=null?t.getSort():null,a=t.getSortIndex()!=null?t.getSortIndex():null,l=t.getFlex()!=null&&t.getFlex()>0?t.getFlex():null;return{colId:t.getColId(),width:t.getActualWidth(),hide:!t.isVisible(),pinned:t.getPinned(),sort:o,sortIndex:a,aggFunc:s,rowGroup:t.isRowGroupActive(),rowGroupIndex:n,pivot:t.isPivotActive(),pivotIndex:r,flex:l}}orderColumnStateList(t){const e=this.columnModel.getCols(),i=new Map(e.map((n,r)=>[n.getColId(),r]));t.sort((n,r)=>{const s=i.has(n.colId)?i.get(n.colId):-1,o=i.has(r.colId)?i.get(r.colId):-1;return s-o})}},ZSe=class extends kt{constructor(){super(...arguments),this.beanName="columnGroupStateService"}wireBeans(t){this.columnModel=t.columnModel,this.columnAnimationService=t.columnAnimationService,this.eventDispatcher=t.columnEventDispatcher,this.visibleColsService=t.visibleColsService}getColumnGroupState(){const t=[],e=this.columnModel.getColTree();return Wd(null,e,i=>{Aa(i)&&t.push({groupId:i.getGroupId(),open:i.isExpanded()})}),t}resetColumnGroupState(t){const e=this.columnModel.getColDefColTree();if(!e)return;const i=[];Wd(null,e,n=>{if(Aa(n)){const r=n.getColGroupDef(),s={groupId:n.getGroupId(),open:r?r.openByDefault:void 0};i.push(s)}}),this.setColumnGroupState(i,t)}setColumnGroupState(t,e){if(!this.columnModel.getColTree())return;this.columnAnimationService.start();const n=[];t.forEach(r=>{const s=r.groupId,o=r.open,a=this.columnModel.getProvidedColGroup(s);a&&a.isExpanded()!==o&&(a.setExpanded(o),n.push(a))}),this.visibleColsService.refresh(e,!0),n.length&&this.eventDispatcher.groupOpened(n),this.columnAnimationService.finish()}},XSe=class extends kt{constructor(){super(...arguments),this.beanName="columnViewportService",this.colsWithinViewport=[],this.headerColsWithinViewport=[],this.colsWithinViewportHash="",this.rowsOfHeadersToRenderLeft={},this.rowsOfHeadersToRenderRight={},this.rowsOfHeadersToRenderCenter={}}wireBeans(t){this.visibleColsService=t.visibleColsService,this.columnModel=t.columnModel,this.eventDispatcher=t.columnEventDispatcher}postConstruct(){this.suppressColumnVirtualisation=this.gos.get("suppressColumnVirtualisation")}setScrollPosition(t,e,i=!1){const n=this.visibleColsService.isBodyWidthDirty();if(!(t===this.scrollWidth&&e===this.scrollPosition&&!n)){if(this.scrollWidth=t,this.scrollPosition=e,this.visibleColsService.setBodyWidthDirty(),this.gos.get("enableRtl")){const s=this.visibleColsService.getBodyContainerWidth();this.viewportLeft=s-this.scrollPosition-this.scrollWidth,this.viewportRight=s-this.scrollPosition}else this.viewportLeft=this.scrollPosition,this.viewportRight=this.scrollWidth+this.scrollPosition;this.columnModel.isReady()&&this.checkViewportColumns(i)}}getHeadersToRender(t,e){let i;switch(t){case"left":i=this.rowsOfHeadersToRenderLeft[e];break;case"right":i=this.rowsOfHeadersToRenderRight[e];break;default:i=this.rowsOfHeadersToRenderCenter[e];break}return i||[]}extractViewportColumns(){const t=this.visibleColsService.getCenterCols();this.isColumnVirtualisationSuppressed()?(this.colsWithinViewport=t,this.headerColsWithinViewport=t):(this.colsWithinViewport=t.filter(this.isColumnInRowViewport.bind(this)),this.headerColsWithinViewport=t.filter(this.isColumnInHeaderViewport.bind(this)))}isColumnVirtualisationSuppressed(){return this.suppressColumnVirtualisation||this.viewportRight===0}clear(){this.rowsOfHeadersToRenderLeft={},this.rowsOfHeadersToRenderRight={},this.rowsOfHeadersToRenderCenter={},this.colsWithinViewportHash=""}isColumnInHeaderViewport(t){return t.isAutoHeaderHeight()||this.isAnyParentAutoHeaderHeight(t)?!0:this.isColumnInRowViewport(t)}isAnyParentAutoHeaderHeight(t){for(;t;){if(t.isAutoHeaderHeight())return!0;t=t.getParent()}return!1}isColumnInRowViewport(t){if(t.isAutoHeight())return!0;const e=t.getLeft()||0,i=e+t.getActualWidth(),n=this.viewportLeft-200,r=this.viewportRight+200,s=e<n&&i<n,o=e>r&&i>r;return!s&&!o}getViewportColumns(){const t=this.visibleColsService.getLeftCols(),e=this.visibleColsService.getRightCols();return this.colsWithinViewport.concat(t).concat(e)}getColsWithinViewport(t){if(!this.columnModel.isColSpanActive())return this.colsWithinViewport;const e=r=>{const s=r.getLeft();return oi(s)&&s>this.viewportLeft},i=this.isColumnVirtualisationSuppressed()?void 0:this.isColumnInRowViewport.bind(this),n=this.visibleColsService.getColsCenter();return this.visibleColsService.getColsForRow(t,n,i,e)}checkViewportColumns(t=!1){this.extractViewport()&&this.eventDispatcher.virtualColumnsChanged(t)}calculateHeaderRows(){this.rowsOfHeadersToRenderLeft={},this.rowsOfHeadersToRenderRight={},this.rowsOfHeadersToRenderCenter={};const t={},e=this.visibleColsService.getLeftCols(),i=this.visibleColsService.getRightCols();this.headerColsWithinViewport.concat(e).concat(i).forEach(s=>t[s.getId()]=!0);const r=(s,o,a)=>{let l=!1;for(let u=0;u<s.length;u++){const d=s[u];let p=!1;if(Tp(d))p=t[d.getId()]===!0;else{const y=d.getDisplayedChildren();y&&(p=r(y,o,a+1))}p&&(l=!0,o[a]||(o[a]=[]),o[a].push(d))}return l};r(this.visibleColsService.getTreeLeft(),this.rowsOfHeadersToRenderLeft,0),r(this.visibleColsService.getTreeRight(),this.rowsOfHeadersToRenderRight,0),r(this.visibleColsService.getTreeCenter(),this.rowsOfHeadersToRenderCenter,0)}extractViewport(){const t=n=>`${n.getId()}-${n.getPinned()||"normal"}`;this.extractViewportColumns();const e=this.getViewportColumns().map(t).join("#"),i=this.colsWithinViewportHash!==e;return i&&(this.colsWithinViewportHash=e,this.calculateHeaderRows()),i}},KSe=class extends kt{constructor(){super(...arguments),this.beanName="agComponentUtils"}wireBeans(t){this.componentMetadataProvider=t.componentMetadataProvider}adaptFunction(t,e){const i=this.componentMetadataProvider.retrieve(t);return i&&i.functionAdapter?i.functionAdapter(e):null}adaptCellRendererFunction(t){class e{refresh(){return!1}getGui(){return this.eGui}init(n){const r=t(n),s=typeof r;if(s==="string"||s==="number"||s==="boolean"){this.eGui=q_("<span>"+r+"</span>");return}if(r==null){this.eGui=q_("<span></span>");return}this.eGui=r}}return e}doesImplementIComponent(t){return t?t.prototype&&"getGui"in t.prototype:!1}},YSe=class extends kt{constructor(){super(...arguments),this.beanName="componentMetadataProvider"}wireBeans(t){this.agComponentUtils=t.agComponentUtils}postConstruct(){this.componentMetaData={dateComponent:{mandatoryMethodList:["getDate","setDate"],optionalMethodList:["afterGuiAttached","setInputPlaceholder","setInputAriaLabel","setDisabled","onParamsUpdated","refresh"]},detailCellRenderer:{mandatoryMethodList:[],optionalMethodList:["refresh"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},dragAndDropImageComponent:{mandatoryMethodList:["setIcon","setLabel"],optionalMethodList:[]},headerComponent:{mandatoryMethodList:[],optionalMethodList:["refresh"]},headerGroupComponent:{mandatoryMethodList:[],optionalMethodList:[]},loadingCellRenderer:{mandatoryMethodList:[],optionalMethodList:[],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},loadingOverlayComponent:{mandatoryMethodList:[],optionalMethodList:["refresh"]},noRowsOverlayComponent:{mandatoryMethodList:[],optionalMethodList:["refresh"]},floatingFilterComponent:{mandatoryMethodList:["onParentModelChanged"],optionalMethodList:["afterGuiAttached","onParamsUpdated","refresh"]},cellRenderer:{mandatoryMethodList:[],optionalMethodList:["refresh","afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},cellEditor:{mandatoryMethodList:["getValue"],optionalMethodList:["isPopup","isCancelBeforeStart","isCancelAfterEnd","getPopupPosition","focusIn","focusOut","afterGuiAttached","refresh"]},innerRenderer:{mandatoryMethodList:[],optionalMethodList:["afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},fullWidthCellRenderer:{mandatoryMethodList:[],optionalMethodList:["refresh","afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},groupRowRenderer:{mandatoryMethodList:[],optionalMethodList:["afterGuiAttached"],functionAdapter:this.agComponentUtils.adaptCellRendererFunction.bind(this.agComponentUtils)},filter:{mandatoryMethodList:["isFilterActive","doesFilterPass","getModel","setModel"],optionalMethodList:["afterGuiAttached","afterGuiDetached","onNewRowsLoaded","getModelAsString","onFloatingFilterChanged","onAnyFilterChanged","refresh"]},statusPanel:{mandatoryMethodList:[],optionalMethodList:["refresh"]},toolPanel:{mandatoryMethodList:[],optionalMethodList:["refresh","getState"]},tooltipComponent:{mandatoryMethodList:[],optionalMethodList:[]},menuItem:{mandatoryMethodList:[],optionalMethodList:["setActive","select","setExpanded","configureDefaults"]}}}retrieve(t){return this.componentMetaData[t]}},JSe=["rowPositionUtils","cellPositionUtils","headerPositionUtils","paginationAutoPageSizeService","apiFunctionService","gridApi","userComponentRegistry","agComponentUtils","componentMetadataProvider","resizeObserverService","userComponentFactory","rowContainerHeightService","horizontalResizeService","localeService","validationService","pinnedRowModel","dragService","visibleColsService","eventService","gos","popupService","selectionService","columnFilterService","quickFilterService","filterManager","columnModel","headerNavigationService","pageBoundsService","paginationService","pageBoundsListener","rowRenderer","expressionService","columnFactory","alignedGridsService","navigationService","valueCache","valueService","loggerFactory","autoWidthCalculator","filterMenuFactory","dragAndDropService","focusService","mouseEventService","environment","cellNavigationService","stylingService","scrollVisibleService","sortController","columnHoverService","columnAnimationService","selectableService","autoColService","controlsColService","changeDetectionService","animationFrameService","undoRedoService","columnDefFactory","rowCssClassCalculator","rowNodeBlockLoader","rowNodeSorter","ctrlsService","pinnedWidthService","rowNodeEventThrottle","ctrlsFactory","dataTypeService","syncService","overlayService","stateService","expansionService","apiEventService","ariaAnnouncementService","menuService","columnApplyStateService","columnEventDispatcher","columnMoveService","columnAutosizeService","columnGetStateService","columnGroupStateService","columnSizeService","funcColsService","columnNameService","columnViewportService","pivotResultColsService","showRowGroupColsService"],x6=Object.fromEntries(JSe.map((t,e)=>[t,e]));function e1e(t,e){const i=(t.beanName?x6[t.beanName]:void 0)??Number.MAX_SAFE_INTEGER,n=(e.beanName?x6[e.beanName]:void 0)??Number.MAX_SAFE_INTEGER;return i-n}function t1e(t,e){return t?.beanName==="gridDestroyService"?-1:0}var i1e=class extends kt{constructor(){super(...arguments),this.beanName="ctrlsFactory",this.registry={}}register(t){this.registry[t.name]=t.classImp}getInstance(t,...e){const i=this.registry[t];if(i!=null)return new i(...e)}},n1e=class extends kt{constructor(){super(...arguments),this.beanName="ctrlsService",this.params={gridCtrl:void 0,gridBodyCtrl:void 0,center:void 0,left:void 0,right:void 0,bottomCenter:void 0,bottomLeft:void 0,bottomRight:void 0,topCenter:void 0,topLeft:void 0,topRight:void 0,stickyTopCenter:void 0,stickyTopLeft:void 0,stickyTopRight:void 0,stickyBottomCenter:void 0,stickyBottomLeft:void 0,stickyBottomRight:void 0,fakeHScrollComp:void 0,fakeVScrollComp:void 0,gridHeaderCtrl:void 0,centerHeader:void 0,leftHeader:void 0,rightHeader:void 0},this.ready=!1,this.readyCallbacks=[],this.runReadyCallbacksAsync=!1}wireBeans(t){this.runReadyCallbacksAsync=t.frameworkOverrides.runWhenReadyAsync?.()??!1}postConstruct(){this.addEventListener("ready",()=>{this.updateReady(),this.ready&&(this.readyCallbacks.forEach(t=>t(this.params)),this.readyCallbacks.length=0)},this.runReadyCallbacksAsync)}updateReady(){this.ready=Object.values(this.params).every(t=>t?.isAlive()??!1)}whenReady(t,e){this.ready?e(this.params):this.readyCallbacks.push(e),t.addDestroyFunc(()=>{const i=this.readyCallbacks.indexOf(e);i>=0&&this.readyCallbacks.splice(i,1)})}register(t,e){this.params[t]=e,this.updateReady(),this.ready&&this.dispatchLocalEvent({type:"ready"}),e.addDestroyFunc(()=>{this.updateReady()})}get(t){return this.params[t]}getGridBodyCtrl(){return this.params.gridBodyCtrl}getHeaderRowContainerCtrls(){const{leftHeader:t,centerHeader:e,rightHeader:i}=this.params;return[t,i,e]}getHeaderRowContainerCtrl(t){const e=this.params;switch(t){case"left":return e.leftHeader;case"right":return e.rightHeader;default:return e.centerHeader}}},r1e=class extends kt{constructor(){super(...arguments),this.beanName="cellPositionUtils"}createId(t){const{rowIndex:e,rowPinned:i,column:n}=t;return this.createIdFromValues({rowIndex:e,column:n,rowPinned:i})}createIdFromValues(t){const{rowIndex:e,rowPinned:i,column:n}=t;return`${e}.${i??"null"}.${n.getId()}`}equals(t,e){const i=t.column===e.column,n=t.rowPinned===e.rowPinned,r=t.rowIndex===e.rowIndex;return i&&n&&r}},s1e=class extends kt{constructor(){super(...arguments),this.beanName="rowNodeEventThrottle",this.events=[]}wireBeans(t){this.animationFrameService=t.animationFrameService,this.rowModel=t.rowModel}postConstruct(){ls(this.gos)&&(this.clientSideRowModel=this.rowModel)}dispatchExpanded(t,e){if(this.clientSideRowModel==null){this.eventService.dispatchEvent(t);return}this.events.push(t);const i=()=>{this.clientSideRowModel&&this.clientSideRowModel.onRowGroupOpened(),this.events.forEach(n=>this.eventService.dispatchEvent(n)),this.events=[]};e?i():(this.dispatchExpandedDebounced==null&&(this.dispatchExpandedDebounced=this.animationFrameService.debounce(i)),this.dispatchExpandedDebounced())}},o1e=class extends kt{constructor(){super(...arguments),this.beanName="rowPositionUtils"}wireBeans(t){this.rowModel=t.rowModel,this.pinnedRowModel=t.pinnedRowModel,this.pageBoundsService=t.pageBoundsService}getFirstRow(){let t=0,e;return this.pinnedRowModel.getPinnedTopRowCount()?e="top":this.rowModel.getRowCount()?(e=null,t=this.pageBoundsService.getFirstRow()):this.pinnedRowModel.getPinnedBottomRowCount()&&(e="bottom"),e===void 0?null:{rowIndex:t,rowPinned:e}}getLastRow(){let t,e=null;const i=this.pinnedRowModel.getPinnedBottomRowCount(),n=this.pinnedRowModel.getPinnedTopRowCount();return i?(e="bottom",t=i-1):this.rowModel.getRowCount()?(e=null,t=this.pageBoundsService.getLastRow()):n&&(e="top",t=n-1),t===void 0?null:{rowIndex:t,rowPinned:e}}getRowNode(t){switch(t.rowPinned){case"top":return this.pinnedRowModel.getPinnedTopRow(t.rowIndex);case"bottom":return this.pinnedRowModel.getPinnedBottomRow(t.rowIndex);default:return this.rowModel.getRow(t.rowIndex)}}sameRow(t,e){return!t&&!e?!0:t&&!e||!t&&e?!1:t.rowIndex===e.rowIndex&&t.rowPinned==e.rowPinned}before(t,e){switch(t.rowPinned){case"top":if(e.rowPinned!=="top")return!0;break;case"bottom":if(e.rowPinned!=="bottom")return!1;break;default:if(oi(e.rowPinned))return e.rowPinned!=="top";break}return t.rowIndex<e.rowIndex}},b6={cssName:"--ag-row-height",changeKey:"rowHeightChanged",defaultValue:42},w6={cssName:"--ag-header-height",changeKey:"headerHeightChanged",defaultValue:48},_6={cssName:"--ag-list-item-height",changeKey:"listItemHeightChanged",defaultValue:24},a1e=class extends kt{constructor(){super(...arguments),this.beanName="environment",this.sizeEls=new Map,this.lastKnownValues=new Map,this.ancestorThemeClasses=[],this.sizesMeasured=!1,this.gridTheme=null}wireBeans(t){this.resizeObserverService=t.resizeObserverService,this.eGridDiv=t.eGridDiv}postConstruct(){this.addManagedPropertyListener("theme",()=>this.handleThemeGridOptionChange()),this.handleThemeGridOptionChange(),this.addDestroyFunc(()=>this.stopUsingTheme()),this.addManagedPropertyListener("rowHeight",()=>this.refreshRowHeightVariable()),this.ancestorThemeClasses=this.readAncestorThemeClasses(),this.setUpThemeClassObservers(),this.getSizeEl(b6),this.getSizeEl(w6),this.getSizeEl(_6)}getDefaultRowHeight(){return this.getCSSVariablePixelValue(b6)}getDefaultHeaderHeight(){return this.getCSSVariablePixelValue(w6)}getDefaultColumnMinWidth(){return Math.min(36,this.getDefaultRowHeight())}getDefaultListItemHeight(){return this.getCSSVariablePixelValue(_6)}hasMeasuredSizes(){return this.sizesMeasured}getGridThemeClass(){return this.gridTheme?.getCssClass()||null}getThemeClasses(){return this.gridTheme?[this.gridTheme.getCssClass()]:this.ancestorThemeClasses}applyThemeClasses(t){const e=this.getThemeClasses();for(const i of Array.from(t.classList))i.startsWith("ag-theme-")&&!e.includes(i)&&t.classList.remove(i);t.classList.add(...e)}refreshRowHeightVariable(){const t=this.eGridDiv.style.getPropertyValue("--ag-line-height").trim(),e=this.gos.get("rowHeight");if(e==null||isNaN(e)||!isFinite(e))return t!==null&&this.eGridDiv.style.setProperty("--ag-line-height",null),-1;const i=`${e}px`;return t!=i?(this.eGridDiv.style.setProperty("--ag-line-height",i),e):t!=""?parseFloat(t):-1}getCSSVariablePixelValue(t){const e=this.lastKnownValues.get(t);if(e!=null)return e;const i=this.measureSizeEl(t);return i==="detached"||i==="no-styles"?t.defaultValue:(this.lastKnownValues.set(t,i),i)}measureSizeEl(t){const e=this.getSizeEl(t);if(e.offsetParent==null)return"detached";const i=e.offsetWidth;return i===C6?"no-styles":(this.sizesMeasured=!0,i)}getSizeEl(t){let e=this.sizeEls.get(t);if(e)return e;let i=this.eMeasurementContainer;i||(i=this.eMeasurementContainer=document.createElement("div"),i.className="ag-measurement-container",this.gos.get("theme")&&this.applyThemeClasses(i),this.eGridDiv.appendChild(i)),e=document.createElement("div"),e.style.width=`var(${t.cssName}, ${C6}px)`,i.appendChild(e),this.sizeEls.set(t,e);let n=this.measureSizeEl(t);n==="no-styles"&&Wt(`no value for ${t.cssName}. This usually means that the grid has been initialised before styles have been loaded. The default value of ${t.defaultValue} will be used and updated when styles load.`);const r=this.resizeObserverService.observeResize(e,()=>{const s=this.measureSizeEl(t);s==="detached"||s==="no-styles"||(this.lastKnownValues.set(t,s),s!==n&&(n=s,this.fireGridStylesChangedEvent(t.changeKey)))});return this.addDestroyFunc(()=>r()),e}fireGridStylesChangedEvent(t){this.eventService.dispatchEvent({type:"gridStylesChanged",[t]:!0})}setUpThemeClassObservers(){const t=new MutationObserver(()=>{const i=this.readAncestorThemeClasses();l1e(i,this.ancestorThemeClasses)||(this.ancestorThemeClasses=i,this.fireGridStylesChangedEvent("themeChanged"))});let e=this.eGridDiv;for(;e;)t.observe(e||this.eGridDiv,{attributes:!0,attributeFilter:["class"]}),e=e.parentElement;this.addDestroyFunc(()=>t.disconnect())}readAncestorThemeClasses(){let t=this.eGridDiv;const e=[];for(;t;){const i=Array.from(t.classList).filter(n=>n.startsWith("ag-theme-"));for(const n of i)e.includes(n)||e.unshift(n);t=t.parentElement}return Object.freeze(e)}handleThemeGridOptionChange(){const{gos:t,eMeasurementContainer:e,gridTheme:i}=this,n=t.get("theme")||null;n!==i&&(i?.stopUse(),this.gridTheme=n,n?.startUse({loadThemeGoogleFonts:t.get("loadThemeGoogleFonts"),container:this.eGridDiv}),e&&this.applyThemeClasses(e),this.fireGridStylesChangedEvent("themeChanged"))}stopUsingTheme(){this.gridTheme?.stopUse(),this.gridTheme=null}},l1e=(t,e)=>t.length===e.length&&t.findIndex((i,n)=>t[n]!==e[n])===-1,C6=15538,c1e=class extends kt{constructor(){super(...arguments),this.beanName="eventService",this.globalEventService=new tx}wireBeans(t){this.globalEventListener=t.globalEventListener,this.globalSyncEventListener=t.globalSyncEventListener}postConstruct(){if(this.globalEventListener){const t=_T(this.gos);this.addGlobalListener(this.globalEventListener,t)}this.globalSyncEventListener&&this.addGlobalListener(this.globalSyncEventListener,!1)}addEventListener(t,e,i){this.globalEventService.addEventListener(t,e,i)}removeEventListener(t,e,i){this.globalEventService.removeEventListener(t,e,i)}addGlobalListener(t,e=!1){this.globalEventService.addGlobalListener(t,e)}removeGlobalListener(t,e=!1){this.globalEventService.removeGlobalListener(t,e)}dispatchLocalEvent(){}dispatchEvent(t){this.globalEventService.dispatchEvent(this.gos.addGridCommonParams(t))}dispatchEventOnce(t){this.globalEventService.dispatchEventOnce(this.gos.addGridCommonParams(t))}},PU=class bc extends kt{constructor(){super(...arguments),this.beanName="focusService"}wireBeans(e){this.eGridDiv=e.eGridDiv,this.columnModel=e.columnModel,this.visibleColsService=e.visibleColsService,this.headerNavigationService=e.headerNavigationService,this.headerPositionUtils=e.headerPositionUtils,this.rowRenderer=e.rowRenderer,this.rowPositionUtils=e.rowPositionUtils,this.cellPositionUtils=e.cellPositionUtils,this.navigationService=e.navigationService,this.ctrlsService=e.ctrlsService,this.filterManager=e.filterManager,this.rangeService=e.rangeService,this.advancedFilterService=e.advancedFilterService,this.overlayService=e.overlayService}static addKeyboardModeEvents(e){this.instanceCount>0||(e.addEventListener("keydown",bc.toggleKeyboardMode),e.addEventListener("mousedown",bc.toggleKeyboardMode))}static removeKeyboardModeEvents(e){this.instanceCount>0||(e.removeEventListener("keydown",bc.toggleKeyboardMode),e.removeEventListener("mousedown",bc.toggleKeyboardMode))}static toggleKeyboardMode(e){const i=bc.keyboardModeActive,n=e.type==="keydown";n&&(e.ctrlKey||e.metaKey||e.altKey)||i!==n&&(bc.keyboardModeActive=n)}postConstruct(){const e=this.clearFocusedCell.bind(this);this.addManagedEventListeners({columnPivotModeChanged:e,newColumnsLoaded:this.onColumnEverythingChanged.bind(this),columnGroupOpened:e,columnRowGroupChanged:e}),this.registerKeyboardFocusEvents(),this.ctrlsService.whenReady(this,i=>{this.gridCtrl=i.gridCtrl})}registerKeyboardFocusEvents(){const e=Rs(this.gos);bc.addKeyboardModeEvents(e),bc.instanceCount++,this.addDestroyFunc(()=>{bc.instanceCount--,bc.removeKeyboardModeEvents(e)})}onColumnEverythingChanged(){if(!this.focusedCellPosition)return;const e=this.focusedCellPosition.column,i=this.columnModel.getCol(e.getId());e!==i&&this.clearFocusedCell()}isKeyboardMode(){return bc.keyboardModeActive}getFocusCellToUseAfterRefresh(){return this.gos.get("suppressFocusAfterRefresh")||!this.focusedCellPosition||this.isDomDataMissingInHierarchy(Jr(this.gos),mg.DOM_DATA_KEY_ROW_CTRL)?null:this.focusedCellPosition}getFocusHeaderToUseAfterRefresh(){return this.gos.get("suppressFocusAfterRefresh")||!this.focusedHeaderPosition||this.isDomDataMissingInHierarchy(Jr(this.gos),_P.DOM_DATA_KEY_HEADER_CTRL)?null:this.focusedHeaderPosition}isDomDataMissingInHierarchy(e,i){let n=e;for(;n;){if(G_(this.gos,n,i))return!1;n=n.parentNode}return!0}getFocusedCell(){return this.focusedCellPosition}shouldRestoreFocus(e){return this.isCellRestoreFocused(e)?(setTimeout(()=>{this.restoredFocusedCellPosition=null},0),!0):!1}clearRestoreFocus(){this.restoredFocusedCellPosition=null,this.awaitRestoreFocusedCell=!1}restoreFocusedCell(e,i){this.awaitRestoreFocusedCell=!0,setTimeout(()=>{this.awaitRestoreFocusedCell&&(this.setRestoreFocusedCell(e),i())})}isCellRestoreFocused(e){return this.restoredFocusedCellPosition==null?!1:this.cellPositionUtils.equals(e,this.restoredFocusedCellPosition)}setRestoreFocusedCell(e){this.getFrameworkOverrides().renderingEngine==="react"&&(this.restoredFocusedCellPosition=e)}getFocusEventParams(e){const{rowIndex:i,rowPinned:n,column:r}=e,s={rowIndex:i,rowPinned:n,column:r,isFullWidthCell:!1},o=this.rowRenderer.getRowByPosition({rowIndex:i,rowPinned:n});return o&&(s.isFullWidthCell=o.isFullWidth()),s}clearFocusedCell(){if(this.restoredFocusedCellPosition=null,this.focusedCellPosition==null)return;const e=this.getFocusEventParams(this.focusedCellPosition);this.focusedCellPosition=null,this.eventService.dispatchEvent({type:"cellFocusCleared",...e})}setFocusedCell(e){const{column:i,rowIndex:n,rowPinned:r,forceBrowserFocus:s=!1,preventScrollOnBrowserFocus:o=!1}=e,a=this.columnModel.getCol(i);if(!a){this.focusedCellPosition=null;return}this.focusedCellPosition={rowIndex:n,rowPinned:Pd(r),column:a},this.eventService.dispatchEvent({type:"cellFocused",...this.getFocusEventParams(this.focusedCellPosition),forceBrowserFocus:s,preventScrollOnBrowserFocus:o})}isCellFocused(e){return this.focusedCellPosition==null?!1:this.cellPositionUtils.equals(e,this.focusedCellPosition)}isRowNodeFocused(e){return this.isRowFocused(e.rowIndex,e.rowPinned)}isHeaderWrapperFocused(e){if(this.focusedHeaderPosition==null)return!1;const i=e.getColumnGroupChild(),n=e.getRowIndex(),r=e.getPinned(),{column:s,headerRowIndex:o}=this.focusedHeaderPosition;return i===s&&n===o&&r==s.getPinned()}clearFocusedHeader(){this.focusedHeaderPosition=null}getFocusedHeader(){return this.focusedHeaderPosition}setFocusedHeader(e,i){this.focusedHeaderPosition={headerRowIndex:e,column:i}}isHeaderFocusSuppressed(){return this.gos.get("suppressHeaderFocus")||this.overlayService.isExclusive()}isCellFocusSuppressed(){return this.gos.get("suppressCellFocus")||this.overlayService.isExclusive()}focusHeaderPosition(e){if(this.isHeaderFocusSuppressed())return!1;const{direction:i,fromTab:n,allowUserOverride:r,event:s,fromCell:o,rowWithoutSpanValue:a}=e;let{headerPosition:l}=e;if(o&&this.filterManager?.isAdvancedFilterHeaderActive())return this.focusAdvancedFilter(l);if(r){const u=this.getFocusedHeader(),d=this.headerNavigationService.getHeaderRowCount();if(n){const p=this.gos.getCallback("tabToNextHeader");p&&(l=this.getHeaderPositionFromUserFunc({userFunc:p,direction:i,currentPosition:u,headerPosition:l,headerRowCount:d}))}else{const p=this.gos.getCallback("navigateToNextHeader");if(p&&s){const v={key:s.key,previousHeaderPosition:u,nextHeaderPosition:l,headerRowCount:d,event:s};l=p(v)}}}return l?this.focusProvidedHeaderPosition({headerPosition:l,direction:i,event:s,fromCell:o,rowWithoutSpanValue:a}):!1}focusHeaderPositionFromUserFunc(e){if(this.isHeaderFocusSuppressed())return!1;const{userFunc:i,headerPosition:n,direction:r,event:s}=e,o=this.getFocusedHeader(),a=this.headerNavigationService.getHeaderRowCount(),l=this.getHeaderPositionFromUserFunc({userFunc:i,direction:r,currentPosition:o,headerPosition:n,headerRowCount:a});return!!l&&this.focusProvidedHeaderPosition({headerPosition:l,direction:r,event:s})}getHeaderPositionFromUserFunc(e){const{userFunc:i,direction:n,currentPosition:r,headerPosition:s,headerRowCount:o}=e,l=i({backwards:n==="Before",previousHeaderPosition:r,nextHeaderPosition:s,headerRowCount:o});return l===!0||l===null?(l===null&&Wt("Since v31.3 Returning `null` from tabToNextHeader is deprecated. Return `true` to stay on the current header, or `false` to let the browser handle the tab behaviour."),r):l===!1?null:l}focusProvidedHeaderPosition(e){const{headerPosition:i,direction:n,fromCell:r,rowWithoutSpanValue:s,event:o}=e,{column:a,headerRowIndex:l}=i;if(l===-1)return this.filterManager?.isAdvancedFilterHeaderActive()?this.focusAdvancedFilter(i):this.focusGridView(a);this.headerNavigationService.scrollToColumn(a,n);const d=this.ctrlsService.getHeaderRowContainerCtrl(a.getPinned())?.focusHeader(i.headerRowIndex,a,o)||!1;return d&&(s!=null||r)&&this.headerNavigationService.setCurrentHeaderRowWithoutSpan(s??-1),d}focusFirstHeader(){if(this.overlayService.isExclusive()&&this.focusOverlay())return!0;let e=this.visibleColsService.getAllCols()[0];if(!e)return!1;e.getParent()&&(e=this.visibleColsService.getColGroupAtLevel(e,0));const i=this.headerPositionUtils.getHeaderIndexToFocus(e,0);return this.focusHeaderPosition({headerPosition:i,rowWithoutSpanValue:0})}focusLastHeader(e){if(this.overlayService.isExclusive()&&this.focusOverlay(!0))return!0;const i=this.headerNavigationService.getHeaderRowCount()-1,n=Yn(this.visibleColsService.getAllCols());return this.focusHeaderPosition({headerPosition:{headerRowIndex:i,column:n},rowWithoutSpanValue:-1,event:e})}focusPreviousFromFirstCell(e){return this.filterManager?.isAdvancedFilterHeaderActive()?this.focusAdvancedFilter(null):this.focusLastHeader(e)}isAnyCellFocused(){return!!this.focusedCellPosition}isRowFocused(e,i){return this.focusedCellPosition==null?!1:this.focusedCellPosition.rowIndex===e&&this.focusedCellPosition.rowPinned===Pd(i)}findFocusableElements(e,i,n=!1){const r=Uxe;let s=FY;i&&(s+=", "+i),n&&(s+=', [tabindex="-1"]');const o=Array.prototype.slice.apply(e.querySelectorAll(r)).filter(u=>Ou(u)),a=Array.prototype.slice.apply(e.querySelectorAll(s));return a.length?((u,d)=>u.filter(p=>d.indexOf(p)===-1))(o,a):o}focusInto(e,i=!1,n=!1){const r=this.findFocusableElements(e,null,n),s=i?Yn(r):r[0];return s?(s.focus({preventScroll:!0}),!0):!1}findFocusableElementBeforeTabGuard(e,i){if(!i)return null;const n=this.findFocusableElements(e),r=n.indexOf(i);if(r===-1)return null;let s=-1;for(let o=r-1;o>=0;o--)if(n[o].classList.contains("ag-tab-guard-top")){s=o;break}return s<=0?null:n[s-1]}findNextFocusableElement(e=this.eGridDiv,i,n){const r=this.findFocusableElements(e,i?':not([tabindex="-1"])':null),s=Jr(this.gos);let o;i?o=r.findIndex(l=>l.contains(s)):o=r.indexOf(s);const a=o+(n?-1:1);return a<0||a>=r.length?null:r[a]}isTargetUnderManagedComponent(e,i){if(!i)return!1;const n=e.querySelectorAll(`.${Kg.FOCUS_MANAGED_CLASS}`);if(!n.length)return!1;for(let r=0;r<n.length;r++)if(n[r].contains(i))return!0;return!1}findTabbableParent(e,i=5){let n=0;for(;e&&_z(e)===null&&++n<=i;)e=e.parentElement;return _z(e)===null?null:e}focusOverlay(e){const i=this.overlayService.isVisible()&&this.overlayService.getOverlayWrapper()?.getGui();return!!i&&this.focusInto(i,e)}focusGridViewFailed(e,i){return i&&this.focusOverlay(e)||e&&this.focusLastHeader()}focusGridView(e,i=!1,n=!0){if(this.overlayService.isExclusive())return n&&this.focusOverlay(i);if(this.isCellFocusSuppressed())return i&&!this.isHeaderFocusSuppressed()?this.focusLastHeader():n&&this.focusOverlay(i)?!0:this.focusNextGridCoreContainer(!1);const r=i?this.rowPositionUtils.getLastRow():this.rowPositionUtils.getFirstRow();if(r){const{rowIndex:s,rowPinned:o}=r;if(e??(e=this.getFocusedHeader()?.column),e&&s!==void 0&&s!==null)return this.navigationService.ensureCellVisible({rowIndex:s,column:e,rowPinned:o}),i&&this.rowRenderer.getRowByPosition(r)?.isFullWidth()&&this.navigationService.tryToFocusFullWidthRow(r,i)||(this.setFocusedCell({rowIndex:s,column:e,rowPinned:Pd(o),forceBrowserFocus:!0}),this.rangeService?.setRangeToCell({rowIndex:s,rowPinned:o,column:e})),!0}return!!(n&&this.focusOverlay(i)||i&&this.focusLastHeader())}isGridFocused(){const e=Jr(this.gos);return!!e&&this.eGridDiv.contains(e)}focusNextGridCoreContainer(e,i=!1){return!i&&this.gridCtrl.focusNextInnerContainer(e)?!0:((i||!e&&!this.gridCtrl.isDetailGrid())&&this.gridCtrl.forceFocusOutOfContainer(e),!1)}focusAdvancedFilter(e){return this.advancedFilterFocusColumn=e?.column,this.advancedFilterService?.getCtrl().focusHeaderComp()??!1}focusNextFromAdvancedFilter(e,i){const n=(i?void 0:this.advancedFilterFocusColumn)??this.visibleColsService.getAllCols()?.[0];return e?this.focusHeaderPosition({headerPosition:{column:n,headerRowIndex:this.headerNavigationService.getHeaderRowCount()-1}}):this.focusGridView(n)}clearAdvancedFilterColumn(){this.advancedFilterFocusColumn=void 0}addFocusableContainer(e){this.gridCtrl.addFocusableContainer(e)}removeFocusableContainer(e){this.gridCtrl.removeFocusableContainer(e)}focusGridInnerElement(e){return this.gridCtrl.focusInnerElement(e)}allowFocusForNextGridCoreContainer(e){this.gridCtrl.allowFocusForNextCoreContainer(e)}};PU.keyboardModeActive=!1;PU.instanceCount=0;var u1e=PU,h1e=class extends kt{constructor(){super(...arguments),this.beanName="pinnedWidthService"}wireBeans(t){this.visibleColsService=t.visibleColsService}postConstruct(){const t=this.checkContainerWidths.bind(this);this.addManagedEventListeners({displayedColumnsChanged:t,displayedColumnsWidthChanged:t}),this.addManagedPropertyListener("domLayout",t)}checkContainerWidths(){const t=Zo(this.gos,"print"),e=t?0:this.visibleColsService.getColsLeftWidth(),i=t?0:this.visibleColsService.getDisplayedColumnsRightWidth();e!=this.leftWidth&&(this.leftWidth=e,this.eventService.dispatchEvent({type:"leftPinnedWidthChanged"})),i!=this.rightWidth&&(this.rightWidth=i,this.eventService.dispatchEvent({type:"rightPinnedWidthChanged"}))}getPinnedRightWidth(){return this.rightWidth}getPinnedLeftWidth(){return this.leftWidth}},d1e=class extends kt{constructor(){super(...arguments),this.additionalFocusableContainers=new Set}wireBeans(t){this.beans=t,this.focusService=t.focusService,this.visibleColsService=t.visibleColsService}setComp(t,e,i){this.view=t,this.eGridHostDiv=e,this.eGui=i,this.eGui.setAttribute("grid-id",this.beans.context.getGridId());const{dragAndDropService:n,mouseEventService:r,ctrlsService:s,resizeObserverService:o}=this.beans,a={getContainer:()=>this.eGui,isInterestedIn:u=>u===1||u===0,getIconName:()=>"notAllowed"};n.addDropTarget(a),this.addDestroyFunc(()=>n.removeDropTarget(a)),r.stampTopLevelGridCompWithGridInstance(e),this.createManagedBean(new RU(this.view)),this.view.setRtlClass(this.gos.get("enableRtl")?"ag-rtl":"ag-ltr"),this.updateGridThemeClass(),this.addManagedEventListeners({gridStylesChanged:this.handleThemeChange.bind(this)});const l=o.observeResize(this.eGridHostDiv,this.onGridSizeChanged.bind(this));this.addDestroyFunc(()=>l()),s.register("gridCtrl",this)}isDetailGrid(){return this.focusService.findTabbableParent(this.getGui())?.getAttribute("row-id")?.startsWith("detail")||!1}getOptionalSelectors(){const t=this.beans;return{paginationSelector:t.paginationService?.getPaginationSelector(),gridHeaderDropZonesSelector:t.columnDropZonesService?.getDropZoneSelector(),sideBarSelector:t.sideBarService?.getSideBarSelector(),statusBarSelector:t.statusBarService?.getStatusPanelSelector(),watermarkSelector:t.licenseManager?.getWatermarkSelector()}}onGridSizeChanged(){this.eventService.dispatchEvent({type:"gridSizeChanged",clientWidth:this.eGridHostDiv.clientWidth,clientHeight:this.eGridHostDiv.clientHeight})}destroyGridUi(){this.view.destroyGridUi()}getGui(){return this.eGui}setResizeCursor(t){this.view.setCursor(t?"ew-resize":null)}disableUserSelect(t){this.view.setUserSelect(t?"none":null)}focusNextInnerContainer(t){const e=this.getFocusableContainers(),{indexWithFocus:i,nextIndex:n}=this.getNextFocusableIndex(e,t);if(n<0||n>=e.length)return!1;if(n===0){if(i>0){const r=this.visibleColsService.getAllCols(),s=Yn(r);if(this.focusService.focusGridView(s,!0))return!0}return!1}return this.focusContainer(e[n],t)}focusInnerElement(t){const e=this.gos.getCallback("focusGridInnerElement");if(e&&e({fromBottom:!!t}))return!0;const i=this.getFocusableContainers(),n=this.visibleColsService.getAllCols();if(t){if(i.length>1)return this.focusContainer(Yn(i),!0);const r=Yn(n);if(this.focusService.focusGridView(r,!0))return!0}if(this.gos.get("headerHeight")===0||this.focusService.isHeaderFocusSuppressed()){if(this.focusService.focusGridView(n[0]))return!0;for(let r=1;r<i.length;r++)if(this.focusService.focusInto(i[r].getGui()))return!0;return!1}return this.focusService.focusFirstHeader()}forceFocusOutOfContainer(t=!1){this.view.forceFocusOutOfContainer(t)}addFocusableContainer(t){this.additionalFocusableContainers.add(t)}removeFocusableContainer(t){this.additionalFocusableContainers.delete(t)}allowFocusForNextCoreContainer(t){const e=this.view.getFocusableContainers(),{nextIndex:i,indexWithFocus:n}=this.getNextFocusableIndex(e,t);if(n===-1||i<0||i>=e.length)return;const r=e[i];r.setAllowFocus?.(!0),setTimeout(()=>{r.setAllowFocus?.(!1)})}getNextFocusableIndex(t,e){const i=Jr(this.gos),n=t.findIndex(s=>s.getGui().contains(i)),r=n+(e?-1:1);return{indexWithFocus:n,nextIndex:r}}focusContainer(t,e){t.setAllowFocus?.(!0);const i=this.focusService.focusInto(t.getGui(),e);return t.setAllowFocus?.(!1),i}getFocusableContainers(){return[...this.view.getFocusableContainers(),...this.additionalFocusableContainers]}updateGridThemeClass(){const t=this.beans.environment.getGridThemeClass();t&&this.view.setGridThemeClass(t)}handleThemeChange(t){t.themeChanged&&this.updateGridThemeClass()}destroy(){this.additionalFocusableContainers.clear(),super.destroy()}},f1e=class extends UJ{constructor(t){super(),this.gridBody=bi,this.sideBar=bi,this.pagination=bi,this.rootWrapperBody=bi,this.eGridDiv=t}postConstruct(){const t={destroyGridUi:()=>this.destroyBean(this),setRtlClass:s=>this.addCssClass(s),setGridThemeClass:s=>this.addCssClass(s),forceFocusOutOfContainer:this.forceFocusOutOfContainer.bind(this),updateLayoutClasses:this.updateLayoutClasses.bind(this),getFocusableContainers:this.getFocusableContainers.bind(this),setUserSelect:s=>{this.getGui().style.userSelect=s??"",this.getGui().style.webkitUserSelect=s??""},setCursor:s=>{this.getGui().style.cursor=s??""}},e=this.createManagedBean(new d1e),i=e.getOptionalSelectors(),n=this.createTemplate(i),r=[ICe,...Object.values(i).filter(s=>!!s)];this.setTemplate(n,r),e.setComp(t,this.eGridDiv,this.getGui()),this.insertGridIntoDom(),this.initialiseTabGuard({onTabKeyDown:()=>{},focusInnerElement:s=>e.focusInnerElement(s),forceFocusOutWhenTabGuardsAreEmpty:!0})}insertGridIntoDom(){const t=this.getGui();this.eGridDiv.appendChild(t),this.addDestroyFunc(()=>{this.eGridDiv.removeChild(t),this.gos.get("debug")&&Ic("Grid removed from DOM")})}updateLayoutClasses(t,e){const i=this.rootWrapperBody.classList;i.toggle("ag-layout-auto-height",e.autoHeight),i.toggle("ag-layout-normal",e.normal),i.toggle("ag-layout-print",e.print),this.addOrRemoveCssClass("ag-layout-auto-height",e.autoHeight),this.addOrRemoveCssClass("ag-layout-normal",e.normal),this.addOrRemoveCssClass("ag-layout-print",e.print)}createTemplate(t){const e=t.gridHeaderDropZonesSelector?"<ag-grid-header-drop-zones></ag-grid-header-drop-zones>":"",i=t.sideBarSelector?'<ag-side-bar data-ref="sideBar"></ag-side-bar>':"",n=t.statusBarSelector?"<ag-status-bar></ag-status-bar>":"",r=t.watermarkSelector?"<ag-watermark></ag-watermark>":"",s=t.paginationSelector?'<ag-pagination data-ref="pagination"></ag-pagination>':"";return`<div class="ag-root-wrapper" role="presentation">
                ${e}
                <div class="ag-root-wrapper-body" data-ref="rootWrapperBody" role="presentation">
                    <ag-grid-body data-ref="gridBody"></ag-grid-body>
                    ${i}
                </div>
                ${n}
                ${s}
                ${r}
            </div>`}getFocusableElement(){return this.rootWrapperBody}forceFocusOutOfContainer(t=!1){if(!t&&this.pagination?.isDisplayed()){this.pagination.forceFocusOutOfContainer(t);return}super.forceFocusOutOfContainer(t)}getFocusableContainers(){const t=[this.gridBody];return[this.sideBar,this.pagination].forEach(e=>{e&&t.push(e)}),t.filter(e=>Ou(e.getGui()))}},p1e=class extends kt{constructor(){super(...arguments),this.beanName="alignedGridsService",this.consuming=!1}wireBeans(t){this.columnModel=t.columnModel,this.columnSizeService=t.columnSizeService,this.ctrlsService=t.ctrlsService,this.columnApplyStateService=t.columnApplyStateService}getAlignedGridApis(){let t=this.gos.get("alignedGrids")??[];const e=typeof t=="function";typeof t=="function"&&(t=t());const i=()=>`See ${this.getFrameworkOverrides().getDocLink("aligned-grids")}`;return t.map(r=>{if(!r){ar("alignedGrids contains an undefined option."),e||ar(`You may want to configure via a callback to avoid setup race conditions:
                     "alignedGrids: () => [linkedGrid]"`),ar(i());return}if(this.isGridApi(r))return r;const s=r;return"current"in s?s.current?.api:(s.api||ar(`alignedGrids - No api found on the linked grid. If you are passing gridOptions to alignedGrids since v31 this is no longer valid. ${i()}`),s.api)}).filter(r=>!!r&&!r.isDestroyed())}isGridApi(t){return!!t&&!!t.dispatchEvent}postConstruct(){const t=this.fireColumnEvent.bind(this);this.addManagedEventListeners({columnMoved:t,columnVisible:t,columnPinned:t,columnGroupOpened:t,columnResized:t,bodyScroll:this.fireScrollEvent.bind(this),alignedGridColumn:({event:e})=>this.onColumnEvent(e),alignedGridScroll:({event:e})=>this.onScrollEvent(e)})}fireEvent(t){this.consuming||this.getAlignedGridApis().forEach(e=>{e.isDestroyed()||e.dispatchEvent(t)})}onEvent(t){this.consuming=!0,t(),this.consuming=!1}fireColumnEvent(t){this.fireEvent({type:"alignedGridColumn",event:t})}fireScrollEvent(t){t.direction==="horizontal"&&this.fireEvent({type:"alignedGridScroll",event:t})}onScrollEvent(t){this.onEvent(()=>{this.ctrlsService.getGridBodyCtrl().getScrollFeature().setHorizontalScrollPosition(t.left,!0)})}extractDataFromEvent(t,e){const i=[];return t.columns?t.columns.forEach(n=>{i.push(e(n))}):t.column&&i.push(e(t.column)),i}getMasterColumns(t){return this.extractDataFromEvent(t,e=>e)}getColumnIds(t){return this.extractDataFromEvent(t,e=>e.getColId())}onColumnEvent(t){this.onEvent(()=>{switch(t.type){case"columnMoved":case"columnVisible":case"columnPinned":case"columnResized":{this.processColumnEvent(t);break}case"columnGroupOpened":{this.processGroupOpenedEvent(t);break}case"columnPivotChanged":Wt("pivoting is not supported with aligned grids. You can only use one of these features at a time in a grid.");break}})}processGroupOpenedEvent(t){const{columnModel:e}=this;t.columnGroups.forEach(i=>{let n=null;i&&(n=e.getProvidedColGroup(i.getGroupId())),!(i&&!n)&&e.setColumnGroupOpened(n,i.isExpanded(),"alignedGridChanged")})}processColumnEvent(t){const e=t.column;let i=null;if(e&&(i=this.columnModel.getColDefCol(e.getColId())),e&&!i)return;const n=this.getMasterColumns(t),{columnApplyStateService:r,columnSizeService:s,ctrlsService:o}=this;switch(t.type){case"columnMoved":{const d=t.api.getColumnState().map(p=>({colId:p.colId}));r.applyColumnState({state:d,applyOrder:!0},"alignedGridChanged")}break;case"columnVisible":{const d=t.api.getColumnState().map(p=>({colId:p.colId,hide:p.hide}));r.applyColumnState({state:d},"alignedGridChanged")}break;case"columnPinned":{const d=t.api.getColumnState().map(p=>({colId:p.colId,pinned:p.pinned}));r.applyColumnState({state:d},"alignedGridChanged")}break;case"columnResized":{const u=t,d={};n.forEach(p=>{d[p.getId()]={key:p.getColId(),newWidth:p.getActualWidth()}}),u.flexColumns?.forEach(p=>{d[p.getId()]&&delete d[p.getId()]}),s.setColumnWidths(Object.values(d),!1,u.finished,"alignedGridChanged");break}}const l=o.getGridBodyCtrl().isVerticalScrollShowing();this.getAlignedGridApis().forEach(u=>{u.setGridOption("alwaysShowVerticalScroll",l)})}},m1e={version:fn,moduleName:"@ag-grid-community/aligned-grid",beans:[p1e]};function g1e(t,e){const i=t.columnModel.getColDefCol(e);return i?i.getColDef():null}function v1e(t){return t.columnModel.getColumnDefs()}function y1e(t,e){typeof e=="number"?t.columnSizeService.sizeColumnsToFit(e,"api"):t.ctrlsService.getGridBodyCtrl().sizeColumnsToFit(e)}function x1e(t,e,i){t.columnModel.setColumnGroupOpened(e,i,"api")}function b1e(t,e,i){return t.visibleColsService.getColumnGroup(e,i)}function w1e(t,e){return t.columnModel.getProvidedColGroup(e)}function _1e(t,e,i){return t.columnNameService.getDisplayNameForColumn(e,i)||""}function C1e(t,e,i){return t.columnNameService.getDisplayNameForColumnGroup(e,i)||""}function S1e(t,e){return t.columnModel.getColDefCol(e)}function O1e(t){return t.columnModel.getColDefCols()}function M1e(t,e){return t.columnApplyStateService.applyColumnState(e,"api")}function T1e(t){return t.columnGetStateService.getColumnState()}function R1e(t){t.columnApplyStateService.resetColumnState("api")}function P1e(t){return t.columnGroupStateService.getColumnGroupState()}function E1e(t,e){t.columnGroupStateService.setColumnGroupState(e,"api")}function A1e(t){t.columnGroupStateService.resetColumnGroupState("api")}function I1e(t){return t.visibleColsService.isPinningLeft()||t.visibleColsService.isPinningRight()}function k1e(t){return t.visibleColsService.isPinningLeft()}function D1e(t){return t.visibleColsService.isPinningRight()}function L1e(t,e){return t.visibleColsService.getColAfter(e)}function F1e(t,e){return t.visibleColsService.getColBefore(e)}function N1e(t,e,i){t.columnModel.setColsVisible([e],i,"api")}function B1e(t,e,i){t.columnModel.setColsVisible(e,i,"api")}function z1e(t,e,i){t.columnModel.setColsPinned([e],i,"api")}function V1e(t,e,i){t.columnModel.setColsPinned(e,i,"api")}function G1e(t){return t.columnModel.getCols()}function U1e(t){return t.visibleColsService.getLeftCols()}function H1e(t){return t.visibleColsService.getCenterCols()}function $1e(t){return t.visibleColsService.getRightCols()}function W1e(t){return t.visibleColsService.getAllCols()}function q1e(t){return t.columnViewportService.getViewportColumns()}function j1e(t,e,i){t.columnMoveService.moveColumns([e],i,"api")}function Q1e(t,e,i){t.columnMoveService.moveColumnByIndex(e,i,"api")}function Z1e(t,e,i){t.columnMoveService.moveColumns(e,i,"api")}function X1e(t,e,i,n=!0,r="api"){t.columnSizeService.setColumnWidths([{key:e,newWidth:i}],!1,n,r)}function K1e(t,e,i=!0,n="api"){t.columnSizeService.setColumnWidths(e,!1,i,n)}function Y1e(t){return t.visibleColsService.getTreeLeft()}function J1e(t){return t.visibleColsService.getTreeCenter()}function eOe(t){return t.visibleColsService.getTreeRight()}function tOe(t){return t.visibleColsService.getAllTrees()}function iOe(t,e,i){return t.columnAutosizeService.autoSizeCols({colKeys:[e],skipHeader:i,source:"api"})}function nOe(t,e,i){t.columnAutosizeService.autoSizeCols({colKeys:e,skipHeader:i,source:"api"})}function rOe(t,e){t.columnAutosizeService.autoSizeAllColumns("api",e)}var sOe=class extends kt{constructor(){super(...arguments),this.beanName="dataTypeService",this.dataTypeDefinitions={},this.isWaitingForRowData=!1,this.isColumnTypeOverrideInDataTypeDefinitions=!1,this.columnStateUpdatesPendingInference={},this.columnStateUpdateListenerDestroyFuncs=[]}wireBeans(t){this.rowModel=t.rowModel,this.columnModel=t.columnModel,this.funcColsService=t.funcColsService,this.valueService=t.valueService,this.columnApplyStateService=t.columnApplyStateService,this.filterManager=t.filterManager}postConstruct(){this.groupHideOpenParents=this.gos.get("groupHideOpenParents"),this.addManagedPropertyListener("groupHideOpenParents",()=>{this.groupHideOpenParents=this.gos.get("groupHideOpenParents")}),this.processDataTypeDefinitions(),this.addManagedPropertyListener("dataTypeDefinitions",t=>{this.processDataTypeDefinitions(),this.columnModel.recreateColumnDefs(Wm(t.source))})}processDataTypeDefinitions(){const t=this.getDefaultDataTypes();this.dataTypeDefinitions={},this.formatValueFuncs={};const e=n=>r=>{const{column:s,node:o,value:a}=r;let l=s.getColDef().valueFormatter;return l===n.groupSafeValueFormatter&&(l=n.valueFormatter),this.valueService.formatValue(s,o,a,l)};Object.entries(t).forEach(([n,r])=>{const s={...r,groupSafeValueFormatter:this.createGroupSafeValueFormatter(r)};this.dataTypeDefinitions[n]=s,this.formatValueFuncs[n]=e(s)});const i=this.gos.get("dataTypeDefinitions")??{};this.dataTypeMatchers={},Object.entries(i).forEach(([n,r])=>{const s=this.processDataTypeDefinition(r,i,[n],t);s&&(this.dataTypeDefinitions[n]=s,r.dataTypeMatcher&&(this.dataTypeMatchers[n]=r.dataTypeMatcher),this.formatValueFuncs[n]=e(s))}),this.checkObjectValueHandlers(t),["dateString","text","number","boolean","date"].forEach(n=>{const r=this.dataTypeMatchers[n];r&&delete this.dataTypeMatchers[n],this.dataTypeMatchers[n]=r??t[n].dataTypeMatcher})}mergeDataTypeDefinitions(t,e){const i={...t,...e};return t.columnTypes&&e.columnTypes&&e.appendColumnTypes&&(i.columnTypes=[...TM(t.columnTypes),...TM(e.columnTypes)]),i}processDataTypeDefinition(t,e,i,n){let r;const s=t.extendsDataType;if(t.columnTypes&&(this.isColumnTypeOverrideInDataTypeDefinitions=!0),t.extendsDataType===t.baseDataType){let o=n[s];const a=e[s];if(o&&a&&(o=a),!this.validateDataTypeDefinition(t,o,s))return;r=this.mergeDataTypeDefinitions(o,t)}else{if(i.includes(s)){Wt('Data type definition hierarchies (via the "extendsDataType" property) cannot contain circular references.');return}const o=e[s];if(!this.validateDataTypeDefinition(t,o,s))return;const a=this.processDataTypeDefinition(o,e,[...i,s],n);if(!a)return;r=this.mergeDataTypeDefinitions(a,t)}return{...r,groupSafeValueFormatter:this.createGroupSafeValueFormatter(r)}}validateDataTypeDefinition(t,e,i){return e?e.baseDataType!==t.baseDataType?(Wt('The "baseDataType" property of a data type definition must match that of its parent.'),!1):!0:(Wt(`The data type definition ${i} does not exist.`),!1)}createGroupSafeValueFormatter(t){if(t.valueFormatter)return e=>{if(e.node?.group){const i=(e.colDef.pivotValueColumn??e.column).getAggFunc();if(i){if(i==="first"||i==="last")return t.valueFormatter(e);if(t.baseDataType==="number"&&i!=="count"){if(typeof e.value=="number")return t.valueFormatter(e);if(typeof e.value=="object"){if(!e.value)return;if("toNumber"in e.value)return t.valueFormatter({...e,value:e.value.toNumber()});if("value"in e.value)return t.valueFormatter({...e,value:e.value.value})}}return}if((this.gos.get("suppressGroupMaintainValueType")||this.gos.get("groupDisplayType")==="groupRows")&&!this.gos.get("treeData"))return}else if(this.groupHideOpenParents&&e.column.isRowGroupActive()&&typeof e.value=="string"&&!t.dataTypeMatcher?.(e.value))return;return t.valueFormatter(e)}}updateColDefAndGetColumnType(t,e,i){let{cellDataType:n}=e;const{field:r}=e;if(n===void 0&&(n=t.cellDataType),(n==null||n===!0)&&(n=this.canInferCellDataType(t,e)?this.inferCellDataType(r,i):!1),!n){t.cellDataType=!1;return}const s=this.dataTypeDefinitions[n];if(!s){Wt(`Missing data type definition - "${n}"`);return}return t.cellDataType=n,s.groupSafeValueFormatter&&(t.valueFormatter=s.groupSafeValueFormatter),s.valueParser&&(t.valueParser=s.valueParser),s.suppressDefaultProperties||this.setColDefPropertiesForBaseDataType(t,n,s,i),s.columnTypes}addColumnListeners(t){if(!this.isWaitingForRowData)return;const e=this.columnStateUpdatesPendingInference[t.getColId()];if(!e)return;const i=n=>{e.add(n.key)};t.addEventListener("columnStateUpdated",i),this.columnStateUpdateListenerDestroyFuncs.push(()=>t.removeEventListener("columnStateUpdated",i))}canInferCellDataType(t,e){if(!ls(this.gos))return!1;const i={cellRenderer:!0,valueGetter:!0,valueParser:!0,refData:!0};if(this.doColDefPropsPreventInference(e,i))return!1;const n=e.type===null?t.type:e.type;if(n){const r=this.gos.get("columnTypes")??{};if(TM(n).some(o=>{const a=r[o.trim()];return a&&this.doColDefPropsPreventInference(a,i)}))return!1}return!this.doColDefPropsPreventInference(t,i)}doColDefPropsPreventInference(t,e){return[["cellRenderer","agSparklineCellRenderer"],["valueGetter",void 0],["valueParser",void 0],["refData",void 0]].some(([i,n])=>this.doesColDefPropPreventInference(t,e,i,n))}doesColDefPropPreventInference(t,e,i,n){if(!e[i])return!1;const r=t[i];return r===null?(e[i]=!1,!1):n===void 0?!!r:r===n}inferCellDataType(t,e){if(!t)return;let i;const n=this.getInitialData();if(n){const s=t.indexOf(".")>=0&&!this.gos.get("suppressFieldDotNotation");i=qw(n,t,s)}else this.initWaitForRowData(e);if(i==null)return;const[r]=Object.entries(this.dataTypeMatchers).find(([s,o])=>o(i))??["object"];return r}getInitialData(){const t=this.gos.get("rowData");if(t?.length)return t[0];if(this.initialData)return this.initialData;{const e=this.rowModel.getRootNode().allLeafChildren;if(e?.length)return e[0].data}return null}initWaitForRowData(t){if(this.columnStateUpdatesPendingInference[t]=new Set,this.isWaitingForRowData)return;this.isWaitingForRowData=!0;const e=this.isColumnTypeOverrideInDataTypeDefinitions;e&&this.columnModel.queueResizeOperations();const[i]=this.addManagedEventListeners({rowDataUpdateStarted:n=>{const{firstRowData:r}=n;r&&(i?.(),this.isWaitingForRowData=!1,this.processColumnsPendingInference(r,e),this.columnStateUpdatesPendingInference={},e&&this.columnModel.processResizeOperations(),this.eventService.dispatchEvent({type:"dataTypesInferred"}))}})}isPendingInference(){return this.isWaitingForRowData}processColumnsPendingInference(t,e){this.initialData=t;const i=[];this.destroyColumnStateUpdateListeners();const n={},r={};Object.entries(this.columnStateUpdatesPendingInference).forEach(([s,o])=>{const a=this.columnModel.getCol(s);if(!a)return;const l=a.getColDef();if(!this.columnModel.resetColDefIntoCol(a,"cellDataTypeInferred"))return;const u=a.getColDef();if(e&&u.type&&u.type!==l.type){const d=this.getUpdatedColumnState(a,o);d.rowGroup&&d.rowGroupIndex==null&&(n[s]=d),d.pivot&&d.pivotIndex==null&&(r[s]=d),i.push(d)}}),e&&i.push(...this.funcColsService.generateColumnStateForRowGroupAndPivotIndexes(n,r)),i.length&&this.columnApplyStateService.applyColumnState({state:i},"cellDataTypeInferred"),this.initialData=null}getUpdatedColumnState(t,e){const i=this.columnApplyStateService.getColumnStateFromColDef(t);return e.forEach(n=>{delete i[n],n==="rowGroup"?delete i.rowGroupIndex:n==="pivot"&&delete i.pivotIndex}),i}checkObjectValueHandlers(t){const e=this.dataTypeDefinitions.object,i=t.object;this.hasObjectValueParser=e.valueParser!==i.valueParser,this.hasObjectValueFormatter=e.valueFormatter!==i.valueFormatter}getDateStringTypeDefinition(t){return t?this.getDataTypeDefinition(t)??this.dataTypeDefinitions.dateString:this.dataTypeDefinitions.dateString}getDateParserFunction(t){return this.getDateStringTypeDefinition(t).dateParser}getDateFormatterFunction(t){return this.getDateStringTypeDefinition(t).dateFormatter}getDataTypeDefinition(t){const e=t.getColDef();if(e.cellDataType)return this.dataTypeDefinitions[e.cellDataType]}getBaseDataType(t){return this.getDataTypeDefinition(t)?.baseDataType}checkType(t,e){if(e==null)return!0;const i=this.getDataTypeDefinition(t)?.dataTypeMatcher;return i?i(e):!0}validateColDef(t){const e=i=>Wt(`Cell data type is "object" but no Value ${i} has been provided. Please either provide an object data type definition with a Value ${i}, or set "colDef.value${i}"`);t.cellDataType==="object"&&(t.valueFormatter===this.dataTypeDefinitions.object.groupSafeValueFormatter&&!this.hasObjectValueFormatter&&e("Formatter"),t.editable&&t.valueParser===this.dataTypeDefinitions.object.valueParser&&!this.hasObjectValueParser&&e("Parser"))}getFormatValue(t){return this.formatValueFuncs[t]}setColDefPropertiesForBaseDataType(t,e,i,n){const r=this.formatValueFuncs[e];switch(i.baseDataType){case"number":{t.cellEditor="agNumberCellEditor";break}case"boolean":{t.cellEditor="agCheckboxCellEditor",t.cellRenderer="agCheckboxCellRenderer",t.suppressKeyboardEvent=s=>!!s.colDef.editable&&s.event.key===St.SPACE;break}case"date":{t.cellEditor="agDateCellEditor",t.keyCreator=r;break}case"dateString":{t.cellEditor="agDateStringCellEditor",t.keyCreator=r;break}case"object":{t.cellEditorParams={useFormatter:!0},t.comparator=(s,o)=>{const a=this.columnModel.getColDefCol(n),l=a?.getColDef();if(!a||!l)return 0;const u=s==null?"":r({column:a,node:null,value:s}),d=o==null?"":r({column:a,node:null,value:o});return u===d?0:u>d?1:-1},t.keyCreator=r;break}}this.filterManager?.setColDefPropertiesForDataType(t,i,r)}getDefaultDataTypes(){const t=i=>!!i.match("^\\d{4}-\\d{2}-\\d{2}$"),e=this.localeService.getLocaleTextFunc();return{number:{baseDataType:"number",valueParser:i=>i.newValue?.trim?.()===""?null:Number(i.newValue),valueFormatter:i=>i.value==null?"":typeof i.value!="number"||isNaN(i.value)?e("invalidNumber","Invalid Number"):String(i.value),dataTypeMatcher:i=>typeof i=="number"},text:{baseDataType:"text",valueParser:i=>i.newValue===""?null:uz(i.newValue),dataTypeMatcher:i=>typeof i=="string"},boolean:{baseDataType:"boolean",valueParser:i=>i.newValue==null?i.newValue:i.newValue?.trim?.()===""?null:String(i.newValue).toLowerCase()==="true",valueFormatter:i=>i.value==null?"":String(i.value),dataTypeMatcher:i=>typeof i=="boolean"},date:{baseDataType:"date",valueParser:i=>ml(i.newValue==null?null:String(i.newValue)),valueFormatter:i=>i.value==null?"":!(i.value instanceof Date)||isNaN(i.value.getTime())?e("invalidDate","Invalid Date"):Gc(i.value,!1)??"",dataTypeMatcher:i=>i instanceof Date},dateString:{baseDataType:"dateString",dateParser:i=>ml(i)??void 0,dateFormatter:i=>Gc(i??null,!1)??void 0,valueParser:i=>t(String(i.newValue))?i.newValue:null,valueFormatter:i=>t(String(i.value))?i.value:"",dataTypeMatcher:i=>typeof i=="string"&&t(i)},object:{baseDataType:"object",valueParser:()=>null,valueFormatter:i=>uz(i.value)??""}}}destroyColumnStateUpdateListeners(){this.columnStateUpdateListenerDestroyFuncs.forEach(t=>t()),this.columnStateUpdateListenerDestroyFuncs=[]}destroy(){this.dataTypeDefinitions={},this.dataTypeMatchers={},this.formatValueFuncs={},this.columnStateUpdatesPendingInference={},this.destroyColumnStateUpdateListeners(),super.destroy()}},oOe={version:fn,moduleName:"@ag-grid-community/data-type",beans:[sOe]},aOe={version:fn,moduleName:"@ag-grid-community/column-api",apiFunctions:{getColumnDef:g1e,getColumnDefs:v1e,sizeColumnsToFit:y1e,setColumnGroupOpened:x1e,getColumnGroup:b1e,getProvidedColumnGroup:w1e,getDisplayNameForColumn:_1e,getDisplayNameForColumnGroup:C1e,getColumn:S1e,getColumns:O1e,applyColumnState:M1e,getColumnState:T1e,resetColumnState:R1e,getColumnGroupState:P1e,setColumnGroupState:E1e,resetColumnGroupState:A1e,isPinning:I1e,isPinningLeft:k1e,isPinningRight:D1e,getDisplayedColAfter:L1e,getDisplayedColBefore:F1e,setColumnVisible:N1e,setColumnsVisible:B1e,setColumnPinned:z1e,setColumnsPinned:V1e,getAllGridColumns:G1e,getDisplayedLeftColumns:U1e,getDisplayedCenterColumns:H1e,getDisplayedRightColumns:$1e,getAllDisplayedColumns:W1e,getAllDisplayedVirtualColumns:q1e,moveColumn:j1e,moveColumnByIndex:Q1e,moveColumns:Z1e,setColumnWidth:X1e,setColumnWidths:K1e,getLeftDisplayedColumnGroups:Y1e,getCenterDisplayedColumnGroups:J1e,getRightDisplayedColumnGroups:eOe,getAllDisplayedColumnGroups:tOe,autoSizeColumn:iOe,autoSizeColumns:nOe,autoSizeAllColumns:rOe}};function lOe(t,e){t.ctrlsService.getGridBodyCtrl().getRowDragFeature().addRowDropZone(e)}function cOe(t,e){const i=t.dragAndDropService.findExternalZone(e);i&&t.dragAndDropService.removeDropTarget(i)}function uOe(t,e){return t.ctrlsService.getGridBodyCtrl().getRowDragFeature().getRowDropZone(e)}var hOe={version:fn,moduleName:"@ag-grid-community/drag-api",apiFunctions:{addRowDropZone:lOe,removeRowDropZone:cOe,getRowDropZoneParams:uOe}};function dOe(t){return t.pinnedRowModel.getPinnedTopRowCount()}function fOe(t){return t.pinnedRowModel.getPinnedBottomRowCount()}function pOe(t,e){return t.pinnedRowModel.getPinnedTopRow(e)}function mOe(t,e){return t.pinnedRowModel.getPinnedBottomRow(e)}var gOe={version:fn,moduleName:"@ag-grid-community/pinned-row-api",apiFunctions:{getPinnedTopRowCount:dOe,getPinnedBottomRowCount:fOe,getPinnedTopRow:pOe,getPinnedBottomRow:mOe}};function vOe(t){t.overlayService.showLoadingOverlay()}function yOe(t){t.overlayService.showNoRowsOverlay()}function xOe(t){t.overlayService.hideOverlay()}var bOe={version:fn,moduleName:"@ag-grid-community/overlay-api",apiFunctions:{showLoadingOverlay:vOe,showNoRowsOverlay:yOe,hideOverlay:xOe}};function wOe(t,e,i){if(!e)return;const n=t.ctrlsService.getGridBodyCtrl().getGui(),r=`aria-${e}`;i===null?n.removeAttribute(r):n.setAttribute(r,i)}function _Oe(t,e={}){t.frameworkOverrides.wrapIncoming(()=>t.rowRenderer.refreshCells(e))}function COe(t,e={}){const i=n=>Wt(`Since v31.1 api.flashCells parameter '${n}Delay' is deprecated. Please use '${n}Duration' instead.`);oi(e.fadeDelay)&&i("fade"),oi(e.flashDelay)&&i("flash"),t.frameworkOverrides.wrapIncoming(()=>t.rowRenderer.flashCells(e))}function SOe(t){t.frameworkOverrides.wrapIncoming(()=>t.ctrlsService.getHeaderRowContainerCtrls().forEach(e=>e.refresh()))}function OOe(t){return t.animationFrameService.isQueueEmpty()}function MOe(t){t.animationFrameService.flushAllFrames()}function TOe(t){return{rowHeight:dg(t.gos),headerHeight:t.columnModel.getHeaderHeight()}}function ROe(t,e={}){return t.rowRenderer.getCellRendererInstances(e).map(Qw)}var POe={version:fn,moduleName:"@ag-grid-community/render-api",apiFunctions:{setGridAriaProperty:wOe,refreshCells:_Oe,flashCells:COe,refreshHeader:SOe,isAnimationFrameQueueEmpty:OOe,flushAllAnimationFrames:MOe,getSizesForCurrentTheme:TOe,getCellRendererInstances:ROe}};function EOe(t){t.valueCache.expire()}function AOe(t,e,i){return $J(t,{colKey:e,rowNode:i})}function $J(t,e){const{colKey:i,rowNode:n,useFormatter:r}=e,s=t.columnModel.getColDefCol(i)??t.columnModel.getCol(i);if(Wn(s))return null;const o=t.valueService.getValueForDisplay(s,n);return r?t.valueService.formatValue(s,n,o)??yh(o,!0):o}function IOe(t){return t.context.getGridId()}function kOe(t){t.gridDestroyService.destroy()}function DOe(t){return t.gridDestroyService.isDestroyCalled()}function LOe(t,e){return t.gos.get(e)}function FOe(t,e,i){WJ(t,{[e]:i})}function WJ(t,e){t.gos.updateGridOptions({options:e})}function NOe(t,e,i){t.apiEventService.addEventListener(e,i)}function BOe(t,e,i){t.apiEventService.removeEventListener(e,i)}function zOe(t,e){t.apiEventService.addGlobalListener(e)}function VOe(t,e){t.apiEventService.removeGlobalListener(e)}function GOe(t){return t.focusService.getFocusedCell()}function UOe(t){return t.focusService.clearFocusedCell()}function HOe(t,e,i,n){t.focusService.setFocusedCell({rowIndex:e,column:i,rowPinned:n,forceBrowserFocus:!0})}function $Oe(t,e){return t.navigationService.tabToNextCell(!1,e)}function WOe(t,e){return t.navigationService.tabToNextCell(!0,e)}function qOe(t,e,i=!1){const n=t.headerNavigationService.getHeaderPositionForColumn(e,i);n&&t.focusService.focusHeaderPosition({headerPosition:n})}function jOe(t,e,i){const n=t.columnModel.getCol(e);t.menuService.showColumnMenu({column:n,buttonElement:i,positionBy:"button"})}function QOe(t,e,i){let n=t.columnModel.getCol(e);if(n||(n=t.columnModel.getColDefCol(e)),!n){ar(`column '${e}' not found`);return}t.menuService.showColumnMenu({column:n,mouseEvent:i,positionBy:"mouse"})}function ZOe(t,e){const i=t.columnModel.getCol(e);if(!i){ar(`column '${e}' not found`);return}t.menuService.showColumnMenu({column:i,positionBy:"auto"})}function XOe(t){t.menuService.hidePopupMenu()}function KOe(t,e={}){const i=e?e.rowNodes:void 0;t.frameworkOverrides.wrapIncoming(()=>t.rowRenderer.redrawRows(i))}function YOe(t,e,i,n,r){t.expansionService.setRowNodeExpanded(e,i,n,r)}function JOe(t,e){return t.rowModel.getRowNode(e)}function eMe(t,e,i,n){t.rowRenderer.addRenderedRowListener(e,i,n)}function tMe(t){return t.rowRenderer.getRenderedNodes()}function iMe(t,e,i){t.rowModel.forEachNode(e,i)}function nMe(t){return qJ(t)}function qJ(t){return t.rowRenderer.getFirstVirtualRenderedRow()}function rMe(t){return jJ(t)}function jJ(t){return t.rowRenderer.getLastVirtualRenderedRow()}function sMe(t,e){return t.rowModel.getRow(e)}function oMe(t){return t.rowModel.getRowCount()}function aMe(t){return t.rowModel}function lMe(t,e){if(!e.nodes.every(a=>a.rowPinned?(Wt("cannot select pinned rows"),!1):a.id===void 0?(Wt("cannot select node until id for node is known"),!1):!0))return;const{nodes:n,source:r,newValue:s}=e,o=n;t.selectionService.setNodesSelected({nodes:o,source:r??"api",newValue:s})}function cMe(t,e="apiSelectAll"){t.selectionService.selectAllRowNodes({source:e})}function uMe(t,e="apiSelectAll"){t.selectionService.deselectAllRowNodes({source:e})}function hMe(t,e="apiSelectAllFiltered"){t.selectionService.selectAllRowNodes({source:e,justFiltered:!0})}function dMe(t,e="apiSelectAllFiltered"){t.selectionService.deselectAllRowNodes({source:e,justFiltered:!0})}function fMe(t,e="apiSelectAllCurrentPage"){t.selectionService.selectAllRowNodes({source:e,justCurrentPage:!0})}function pMe(t,e="apiSelectAllCurrentPage"){t.selectionService.deselectAllRowNodes({source:e,justCurrentPage:!0})}function mMe(t){return t.selectionService.getSelectedNodes()}function gMe(t){return t.selectionService.getSelectedRows()}function vMe(t){t.sortController.onSortChanged("api")}var yMe={version:fn,moduleName:"@ag-grid-community/core-api",apiFunctions:{getGridId:IOe,destroy:kOe,isDestroyed:DOe,getGridOption:LOe,setGridOption:FOe,updateGridOptions:WJ}},xMe={version:fn,moduleName:"@ag-grid-community/row-selection-api",apiFunctions:{setNodesSelected:lMe,selectAll:cMe,deselectAll:uMe,selectAllFiltered:hMe,deselectAllFiltered:dMe,selectAllOnCurrentPage:fMe,deselectAllOnCurrentPage:pMe,getSelectedNodes:mMe,getSelectedRows:gMe}},bMe={version:fn,moduleName:"@ag-grid-community/row-api",apiFunctions:{redrawRows:KOe,setRowNodeExpanded:YOe,getRowNode:JOe,addRenderedRowListener:eMe,getRenderedNodes:tMe,forEachNode:iMe,getFirstDisplayedRow:nMe,getFirstDisplayedRowIndex:qJ,getLastDisplayedRow:rMe,getLastDisplayedRowIndex:jJ,getDisplayedRowAtIndex:sMe,getDisplayedRowCount:oMe,getModel:aMe}},wMe={version:fn,moduleName:"@ag-grid-community/scroll-api",apiFunctions:{getVerticalPixelRange:rSe,getHorizontalPixelRange:sSe,ensureColumnVisible:zJ,ensureIndexVisible:VJ,ensureNodeVisible:oSe}},_Me={version:fn,moduleName:"@ag-grid-community/keyboard-navigation-api",apiFunctions:{getFocusedCell:GOe,clearFocusedCell:UOe,setFocusedCell:HOe,setFocusedHeader:qOe,tabToNextCell:$Oe,tabToPreviousCell:WOe}},CMe={version:fn,moduleName:"@ag-grid-community/event-api",apiFunctions:{addEventListener:NOe,addGlobalListener:zOe,removeEventListener:BOe,removeGlobalListener:VOe}},SMe={version:fn,moduleName:"@ag-grid-community/cell-api",apiFunctions:{expireValueCache:EOe,getValue:AOe,getCellValue:$J}},OMe={version:fn,moduleName:"@ag-grid-community/menu-api",apiFunctions:{showColumnMenuAfterButtonClick:jOe,showColumnMenuAfterMouseClick:QOe,showColumnMenu:ZOe,hidePopupMenu:XOe}},MMe={version:fn,moduleName:"@ag-grid-community/sort-api",apiFunctions:{onSortChanged:vMe}},TMe={version:fn,moduleName:"@ag-grid-community/api",dependantModules:[yMe,gOe,xMe,aOe,bMe,hOe,wMe,bOe,_Me,CMe,POe,SMe,OMe,MMe]};function RMe(t){return t.stateService?.getState()??{}}function PMe(t){switch(t={...t},t.version||(t.version="32.1.0"),t.version){case"32.1.0":t=EMe(t)}return t}function EMe(t){return t.cellSelection=AMe(t,"rangeSelection"),t}function AMe(t,e){if(t&&typeof t=="object")return t[e]}var IMe=class extends kt{constructor(){super(...arguments),this.beanName="stateService",this.suppressEvents=!0,this.queuedUpdateSources=new Set,this.dispatchStateUpdateEventDebounced=Fa(()=>this.dispatchQueuedStateUpdateEvents(),0),this.onRowGroupOpenedDebounced=Fa(()=>this.updateCachedState("rowGroupExpansion",this.getRowGroupExpansionState()),0),this.onRowSelectedDebounced=Fa(()=>{this.staleStateKeys.delete("rowSelection"),this.updateCachedState("rowSelection",this.getRowSelectionState())},0),this.staleStateKeys=new Set}wireBeans(t){this.filterManager=t.filterManager,this.ctrlsService=t.ctrlsService,this.pivotResultColsService=t.pivotResultColsService,this.focusService=t.focusService,this.columnModel=t.columnModel,this.visibleColsService=t.visibleColsService,this.columnGroupStateService=t.columnGroupStateService,this.columnGetStateService=t.columnGetStateService,this.paginationService=t.paginationService,this.selectionService=t.selectionService,this.expansionService=t.expansionService,this.columnAnimationService=t.columnAnimationService,this.columnApplyStateService=t.columnApplyStateService,this.sideBarService=t.sideBarService,this.rangeService=t.rangeService}postConstruct(){this.isClientSideRowModel=ls(this.gos),this.cachedState=this.getInitialState(),this.setCachedStateValue("version",fn),this.ctrlsService.whenReady(this,()=>this.suppressEventsAndDispatchInitEvent(()=>this.setupStateOnGridReady()));const[t,e,i]=this.addManagedEventListeners({newColumnsLoaded:({source:n})=>{n==="gridInitializing"&&(t(),this.suppressEventsAndDispatchInitEvent(()=>this.setupStateOnColumnsInitialised()))},rowCountReady:()=>{e?.(),this.suppressEventsAndDispatchInitEvent(()=>this.setupStateOnRowCountReady())},firstDataRendered:()=>{i?.(),this.suppressEventsAndDispatchInitEvent(()=>this.setupStateOnFirstDataRendered())}})}getInitialState(){return PMe(this.gos.get("initialState")??{})}getState(){return this.staleStateKeys.size&&this.refreshStaleState(),this.cachedState}setupStateOnGridReady(){this.updateCachedState("sideBar",this.getSideBarState());const t=()=>this.updateCachedState("sideBar",this.getSideBarState());this.addManagedEventListeners({toolPanelVisibleChanged:t,sideBarUpdated:t})}setupStateOnColumnsInitialised(){const t=this.getInitialState();this.setColumnState(t),this.setColumnGroupState(t),this.updateColumnState(["aggregation","columnOrder","columnPinning","columnSizing","columnVisibility","pivot","pivot","rowGroup","sort"]),this.updateCachedState("columnGroup",this.getColumnGroupState());const e=i=>()=>this.updateColumnState([i]);this.addManagedEventListeners({columnValueChanged:e("aggregation"),columnMoved:e("columnOrder"),columnPinned:e("columnPinning"),columnResized:e("columnSizing"),columnVisible:e("columnVisibility"),columnPivotChanged:e("pivot"),columnPivotModeChanged:e("pivot"),columnRowGroupChanged:e("rowGroup"),sortChanged:e("sort"),newColumnsLoaded:()=>this.updateColumnState(["aggregation","columnOrder","columnPinning","columnSizing","columnVisibility","pivot","rowGroup","sort"]),columnGroupOpened:()=>this.updateCachedState("columnGroup",this.getColumnGroupState())})}setupStateOnRowCountReady(){const{filter:t,rowGroupExpansion:e,rowSelection:i,pagination:n}=this.getInitialState(),r=this.gos.get("advancedFilterModel");(t||r)&&this.setFilterState(t,r),e&&this.setRowGroupExpansionState(e),i&&this.setRowSelectionState(i),n&&this.setPaginationState(n),this.updateCachedState("filter",this.getFilterState()),this.updateCachedState("rowGroupExpansion",this.getRowGroupExpansionState()),this.updateCachedState("rowSelection",this.getRowSelectionState()),this.updateCachedState("pagination",this.getPaginationState());const s=()=>this.updateCachedState("rowGroupExpansion",this.getRowGroupExpansionState());this.addManagedEventListeners({filterChanged:()=>this.updateCachedState("filter",this.getFilterState()),rowGroupOpened:()=>this.onRowGroupOpenedDebounced(),expandOrCollapseAll:s,columnRowGroupChanged:s,rowDataUpdated:()=>{this.gos.get("groupDefaultExpanded")!==0&&setTimeout(()=>{s()})},selectionChanged:()=>{this.staleStateKeys.add("rowSelection"),this.onRowSelectedDebounced()},paginationChanged:o=>{(o.newPage||o.newPageSize)&&this.updateCachedState("pagination",this.getPaginationState())}})}setupStateOnFirstDataRendered(){const{scroll:t,cellSelection:e,focusedCell:i,columnOrder:n}=this.getInitialState();i&&this.setFocusedCellState(i),e&&this.setCellSelectionState(e),t&&this.setScrollState(t),this.setColumnPivotState(!!n?.orderedColIds),this.updateCachedState("sideBar",this.getSideBarState()),this.updateCachedState("focusedCell",this.getFocusedCellState());const r=this.getRangeSelectionState();this.updateCachedState("rangeSelection",r),this.updateCachedState("cellSelection",r),this.updateCachedState("scroll",this.getScrollState()),this.addManagedEventListeners({cellFocused:()=>this.updateCachedState("focusedCell",this.getFocusedCellState()),cellSelectionChanged:s=>{if(s.finished){const o=this.getRangeSelectionState();this.updateCachedState("rangeSelection",o),this.updateCachedState("cellSelection",o)}},bodyScrollEnd:()=>this.updateCachedState("scroll",this.getScrollState())})}getColumnState(){const t=this.columnModel.isPivotMode(),e=[],i=[],n=[],r=[],s=[],o=[],a=[],l=[],u=[];let d=0;const p=this.columnGetStateService.getColumnState();for(let v=0;v<p.length;v++){const{colId:y,sort:w,sortIndex:R,rowGroup:O,rowGroupIndex:P,aggFunc:N,pivot:F,pivotIndex:k,pinned:$,hide:W,width:Q,flex:Y}=p[v];u.push(y),w&&(e[R??d++]={colId:y,sort:w}),O&&(i[P??0]=y),typeof N=="string"&&n.push({colId:y,aggFunc:N}),F&&(r[k??0]=y),$&&($==="right"?o:s).push(y),W&&a.push(y),(Y||Q)&&l.push({colId:y,flex:Y??void 0,width:Q})}return{sort:e.length?{sortModel:e}:void 0,rowGroup:i.length?{groupColIds:i}:void 0,aggregation:n.length?{aggregationModel:n}:void 0,pivot:r.length||t?{pivotMode:t,pivotColIds:r}:void 0,columnPinning:s.length||o.length?{leftColIds:s,rightColIds:o}:void 0,columnVisibility:a.length?{hiddenColIds:a}:void 0,columnSizing:l.length?{columnSizingModel:l}:void 0,columnOrder:u.length?{orderedColIds:u}:void 0}}setColumnState(t){const{sort:e,rowGroup:i,aggregation:n,pivot:r,columnPinning:s,columnVisibility:o,columnSizing:a,columnOrder:l,partialColumnState:u}=t,d={},p=O=>{let P=d[O];return P||(P={colId:O},d[O]=P,P)},v=u?{}:{sort:null,sortIndex:null,rowGroup:null,rowGroupIndex:null,aggFunc:null,pivot:null,pivotIndex:null,pinned:null,hide:null,flex:null};e&&(e.sortModel.forEach(({colId:O,sort:P},N)=>{const F=p(O);F.sort=P,F.sortIndex=N}),v.sort=null,v.sortIndex=null),i&&(i.groupColIds.forEach((O,P)=>{const N=p(O);N.rowGroup=!0,N.rowGroupIndex=P}),v.rowGroup=null,v.rowGroupIndex=null),n&&(n.aggregationModel.forEach(({colId:O,aggFunc:P})=>{p(O).aggFunc=P}),v.aggFunc=null),r&&(r.pivotColIds.forEach((O,P)=>{const N=p(O);N.pivot=!0,N.pivotIndex=P}),this.gos.updateGridOptions({options:{pivotMode:r.pivotMode},source:"gridInitializing"}),v.pivot=null,v.pivotIndex=null),s&&(s.leftColIds.forEach(O=>{p(O).pinned="left"}),s.rightColIds.forEach(O=>{p(O).pinned="right"}),v.pinned=null),o&&(o.hiddenColIds.forEach(O=>{p(O).hide=!0}),v.hide=null),a&&(a.columnSizingModel.forEach(({colId:O,flex:P,width:N})=>{const F=p(O);F.flex=P??null,F.width=N}),v.flex=null);const y=l?.orderedColIds,w=!!y?.length,R=w?y.map(O=>p(O)):Object.values(d);R.length&&(this.columnStates=R,this.columnApplyStateService.applyColumnState({state:R,applyOrder:w,defaultState:v},"gridInitializing"))}setColumnPivotState(t){const e=this.columnStates;this.columnStates=void 0;const i=this.columnGroupStates;if(this.columnGroupStates=void 0,!!this.pivotResultColsService.isPivotResultColsPresent()){if(e){const n=[];for(const r of e)this.pivotResultColsService.getPivotResultCol(r.colId)&&n.push(r);this.columnApplyStateService.applyColumnState({state:n,applyOrder:t},"gridInitializing")}i&&this.columnGroupStateService.setColumnGroupState(i,"gridInitializing")}}getColumnGroupState(){const t=this.columnGroupStateService.getColumnGroupState(),e=[];return t.forEach(({groupId:i,open:n})=>{n&&e.push(i)}),e.length?{openColumnGroupIds:e}:void 0}setColumnGroupState(t){if(!Object.prototype.hasOwnProperty.call(t,"columnGroup"))return;const e=new Set(t.columnGroup?.openColumnGroupIds),n=this.columnGroupStateService.getColumnGroupState().map(({groupId:r})=>{const s=e.has(r);return s&&e.delete(r),{groupId:r,open:s}});e.forEach(r=>{n.push({groupId:r,open:!0})}),n.length&&(this.columnGroupStates=n),this.columnGroupStateService.setColumnGroupState(n,"gridInitializing")}getFilterState(){let t=this.filterManager?.getFilterModel();t&&Object.keys(t).length===0&&(t=void 0);const e=this.filterManager?.getAdvancedFilterModel()??void 0;return t||e?{filterModel:t,advancedFilterModel:e}:void 0}setFilterState(t,e){const{filterModel:i,advancedFilterModel:n}=t??{advancedFilterModel:e};i&&this.filterManager?.setFilterModel(i,"columnFilter"),n&&this.filterManager?.setAdvancedFilterModel(n)}getRangeSelectionState(){const t=this.rangeService?.getCellRanges().map(e=>{const{id:i,type:n,startRow:r,endRow:s,columns:o,startColumn:a}=e;return{id:i,type:n,startRow:r,endRow:s,colIds:o.map(l=>l.getColId()),startColId:a.getColId()}});return t?.length?{cellRanges:t}:void 0}setCellSelectionState(t){const{gos:e,rangeService:i,columnModel:n,visibleColsService:r}=this;if(!Mh(e)||!i)return;const s=[];if(t.cellRanges.forEach(o=>{const a=[];if(o.colIds.forEach(u=>{const d=n.getCol(u);d&&a.push(d)}),!a.length)return;let l=n.getCol(o.startColId);if(!l){const u=r.getAllCols(),d=new Set(a);l=u.find(p=>d.has(p))}s.push({...o,columns:a,startColumn:l})}),G0e(e)&&U0e(e)&&s.length>1)return Wt("cannot add multiple ranges when `cellSelection.suppressMultiRanges = true`");i.setCellRanges(s)}getScrollState(){if(!this.isClientSideRowModel)return;const t=this.ctrlsService.getGridBodyCtrl()?.getScrollFeature(),{left:e}=t?.getHScrollPosition()??{left:0},{top:i}=t?.getVScrollPosition()??{top:0};return i||e?{top:i,left:e}:void 0}setScrollState(t){if(!this.isClientSideRowModel)return;const{top:e,left:i}=t;this.ctrlsService.getGridBodyCtrl()?.getScrollFeature().setScrollPosition(e,i)}getSideBarState(){return this.sideBarService?.getSideBarComp()?.getState()}getFocusedCellState(){if(!this.isClientSideRowModel)return;const t=this.focusService.getFocusedCell();if(t){const{column:e,rowIndex:i,rowPinned:n}=t;return{colId:e.getColId(),rowIndex:i,rowPinned:n}}}setFocusedCellState(t){if(!this.isClientSideRowModel)return;const{colId:e,rowIndex:i,rowPinned:n}=t;this.focusService.setFocusedCell({column:this.columnModel.getCol(e),rowIndex:i,rowPinned:n,forceBrowserFocus:!0,preventScrollOnBrowserFocus:!0})}getPaginationState(){if(!this.paginationService)return;const t=this.paginationService.getCurrentPage(),e=this.gos.get("paginationAutoPageSize")?void 0:this.paginationService.getPageSize();if(!(!t&&!e))return{page:t,pageSize:e}}setPaginationState(t){this.paginationService&&(t.pageSize&&!this.gos.get("paginationAutoPageSize")&&this.paginationService.setPageSize(t.pageSize,"initialState"),typeof t.page=="number"&&this.paginationService.setPage(t.page))}getRowSelectionState(){const t=this.selectionService.getSelectionState();return!t||!Array.isArray(t)&&(t.selectAll===!1||t.selectAllChildren===!1)&&!t?.toggledNodes?.length?void 0:t}setRowSelectionState(t){this.selectionService.setSelectionState(t,"gridInitializing")}getRowGroupExpansionState(){const t=this.expansionService.getExpandedRows();return t.length?{expandedRowGroupIds:t}:void 0}setRowGroupExpansionState(t){this.expansionService.expandRows(t.expandedRowGroupIds)}updateColumnState(t){const e=this.getColumnState();let i=!1;Object.entries(e).forEach(([n,r])=>{V_(r,this.cachedState[n])||(i=!0)}),this.cachedState={...this.cachedState,...e},i&&this.dispatchStateUpdateEvent(t)}updateCachedState(t,e){const i=this.cachedState[t];this.setCachedStateValue(t,e),V_(e,i)||this.dispatchStateUpdateEvent([t])}setCachedStateValue(t,e){this.cachedState={...this.cachedState,[t]:e}}refreshStaleState(){this.staleStateKeys.forEach(t=>{switch(t){case"rowSelection":this.setCachedStateValue(t,this.getRowSelectionState());break}}),this.staleStateKeys.clear()}dispatchStateUpdateEvent(t){this.suppressEvents||(t.forEach(e=>this.queuedUpdateSources.add(e)),this.dispatchStateUpdateEventDebounced())}dispatchQueuedStateUpdateEvents(){const t=Array.from(this.queuedUpdateSources);this.queuedUpdateSources.clear(),this.eventService.dispatchEvent({type:"stateUpdated",sources:t,state:this.cachedState})}suppressEventsAndDispatchInitEvent(t){this.suppressEvents=!0,this.columnAnimationService.setSuppressAnimation(!0),t(),setTimeout(()=>{this.suppressEvents=!1,this.queuedUpdateSources.clear(),this.isAlive()&&(this.columnAnimationService.setSuppressAnimation(!1),this.dispatchStateUpdateEvent(["gridInitializing"]))})}},QJ={version:fn,moduleName:"@ag-grid-community/state-core",beans:[IMe]},kMe={version:fn,moduleName:"@ag-grid-community/state-api",apiFunctions:{getState:RMe},dependantModules:[QJ]},DMe={version:fn,moduleName:"@ag-grid-community/state",dependantModules:[QJ,kMe]};function LMe(t){return t.rowModel.isLastRowIndexKnown()}function FMe(t){return t.paginationService?.getPageSize()??100}function NMe(t){return t.paginationService?.getCurrentPage()??0}function BMe(t){return t.paginationService?.getTotalPages()??1}function zMe(t){return t.paginationService?t.paginationService.getMasterRowCount():t.rowModel.getRowCount()}function VMe(t){t.paginationService?.goToNextPage()}function GMe(t){t.paginationService?.goToPreviousPage()}function UMe(t){t.paginationService?.goToFirstPage()}function HMe(t){t.paginationService?.goToLastPage()}function $Me(t,e){t.paginationService?.goToPage(e)}var WMe=class extends kt{constructor(){super(...arguments),this.beanName="paginationAutoPageSizeService"}wireBeans(t){this.ctrlsService=t.ctrlsService,this.paginationService=t.paginationService}postConstruct(){this.ctrlsService.whenReady(this,t=>{this.centerRowsCtrl=t.center;const e=this.checkPageSize.bind(this);this.addManagedEventListeners({bodyHeightChanged:e,scrollVisibilityChanged:e}),this.addManagedPropertyListener("paginationAutoPageSize",this.onPaginationAutoSizeChanged.bind(this)),this.checkPageSize()})}notActive(){return!this.gos.get("paginationAutoPageSize")||this.centerRowsCtrl==null}onPaginationAutoSizeChanged(){this.notActive()?this.paginationService.unsetAutoCalculatedPageSize():this.checkPageSize()}checkPageSize(){if(this.notActive())return;const t=this.centerRowsCtrl.getViewportSizeFeature().getBodyHeight();if(t>0){const e=()=>{const i=Math.max(dg(this.gos),1),n=Math.floor(t/i);this.paginationService.setPageSize(n,"autoCalculated")};this.isBodyRendered?Fa(()=>e(),50)():(e(),this.isBodyRendered=!0)}else this.isBodyRendered=!1}};function qMe(t,e,i){t.addManagedElementListeners(e,{keydown:n=>{if(!n.defaultPrevented&&n.key===St.TAB){const r=n.shiftKey;i.findNextFocusableElement(e,!1,r)||i.focusNextGridCoreContainer(r)&&n.preventDefault()}}})}var Wb="paginationPageSizeSelector",jMe=class extends ir{constructor(){super('<span class="ag-paging-page-size"></span>'),this.hasEmptyOption=!1,this.handlePageSizeItemSelected=()=>{if(!this.selectPageSizeComp)return;const t=this.selectPageSizeComp.getValue();if(!t)return;const e=Number(t);isNaN(e)||e<1||e===this.paginationService.getPageSize()||(this.paginationService.setPageSize(e,"pageSizeSelector"),this.hasEmptyOption&&this.toggleSelectDisplay(!0),this.selectPageSizeComp.getFocusableElement().focus())}}wireBeans(t){this.paginationService=t.paginationService}postConstruct(){this.addManagedPropertyListener(Wb,()=>{this.onPageSizeSelectorValuesChange()}),this.addManagedEventListeners({paginationChanged:t=>this.handlePaginationChanged(t)})}handlePaginationChanged(t){if(!this.selectPageSizeComp||!t?.newPageSize)return;const e=this.paginationService.getPageSize();this.getPageSizeSelectorValues().includes(e)?this.selectPageSizeComp.setValue(e.toString()):this.hasEmptyOption?this.selectPageSizeComp.setValue(""):this.toggleSelectDisplay(!0)}toggleSelectDisplay(t){this.selectPageSizeComp&&!t&&this.reset(),t&&(this.reloadPageSizesSelector(),this.selectPageSizeComp)}reset(){fa(this.getGui()),this.selectPageSizeComp&&(this.selectPageSizeComp=this.destroyBean(this.selectPageSizeComp))}onPageSizeSelectorValuesChange(){this.selectPageSizeComp&&this.shouldShowPageSizeSelector()&&this.reloadPageSizesSelector()}shouldShowPageSizeSelector(){return this.gos.get("pagination")&&!this.gos.get("suppressPaginationPanel")&&!this.gos.get("paginationAutoPageSize")&&this.gos.get(Wb)!==!1}reloadPageSizesSelector(){const t=this.getPageSizeSelectorValues(),e=this.paginationService.getPageSize(),i=!e||!t.includes(e);if(i){const r=this.gos.exists("paginationPageSize"),s=this.gos.get(Wb)!==!0;Wt(`'paginationPageSize=${e}'${r?"":" (default value)"}, but ${e} is not included in${s?"":" the default"} paginationPageSizeSelector=[${t.join(", ")}].`),s||Wt(`Either set '${Wb}' to an array that includes ${e} or to 'false' to disable the page size selector.`),t.unshift("")}const n=String(i?"":e);this.selectPageSizeComp?(Fp(this.pageSizeOptions,t)||(this.selectPageSizeComp.clearOptions().addOptions(this.createPageSizeSelectOptions(t)),this.pageSizeOptions=t),this.selectPageSizeComp.setValue(n,!0)):this.createPageSizeSelectorComp(t,n),this.hasEmptyOption=i}createPageSizeSelectOptions(t){return t.map(e=>({value:String(e)}))}createPageSizeSelectorComp(t,e){const i=this.localeService.getLocaleTextFunc(),n=i("pageSizeSelectorLabel","Page Size:"),r=i("ariaPageSizeSelectorLabel","Page Size");this.selectPageSizeComp=this.createManagedBean(new yU).addOptions(this.createPageSizeSelectOptions(t)).setValue(e).setAriaLabel(r).setLabel(n).onValueChange(()=>this.handlePageSizeItemSelected()),this.appendChild(this.selectPageSizeComp)}getPageSizeSelectorValues(){const t=[20,50,100],e=this.gos.get(Wb);return!Array.isArray(e)||Kl(e)?t:[...e].sort((i,n)=>i-n)}destroy(){this.toggleSelectDisplay(!1),super.destroy()}},QMe={selector:"AG-PAGE-SIZE-SELECTOR",component:jMe},ZMe=class extends UJ{constructor(){super(),this.btFirst=bi,this.btPrevious=bi,this.btNext=bi,this.btLast=bi,this.lbRecordCount=bi,this.lbFirstRowOnPage=bi,this.lbLastRowOnPage=bi,this.lbCurrent=bi,this.lbTotal=bi,this.pageSizeComp=bi,this.previousAndFirstButtonsDisabled=!1,this.nextButtonDisabled=!1,this.lastButtonDisabled=!1,this.areListenersSetup=!1,this.allowFocusInnerElement=!1}wireBeans(t){this.rowModel=t.rowModel,this.paginationService=t.paginationService,this.focusService=t.focusService,this.ariaAnnouncementService=t.ariaAnnouncementService}postConstruct(){const t=this.gos.get("enableRtl");this.setTemplate(this.getTemplate(),[QMe]);const{btFirst:e,btPrevious:i,btNext:n,btLast:r}=this;this.activateTabIndex([e,i,n,r]),e.insertAdjacentElement("afterbegin",Ql(t?"last":"first",this.gos)),i.insertAdjacentElement("afterbegin",Ql(t?"next":"previous",this.gos)),n.insertAdjacentElement("afterbegin",Ql(t?"previous":"next",this.gos)),r.insertAdjacentElement("afterbegin",Ql(t?"first":"last",this.gos)),this.addManagedPropertyListener("pagination",this.onPaginationChanged.bind(this)),this.addManagedPropertyListener("suppressPaginationPanel",this.onPaginationChanged.bind(this)),this.addManagedPropertyListeners(["paginationPageSizeSelector","paginationAutoPageSize","suppressPaginationPanel"],()=>this.onPageSizeRelatedOptionsChange()),this.pageSizeComp.toggleSelectDisplay(this.pageSizeComp.shouldShowPageSizeSelector()),this.initialiseTabGuard({onTabKeyDown:()=>{},focusInnerElement:s=>{this.allowFocusInnerElement?this.tabGuardFeature.getTabGuardCtrl().focusInnerElement(s):this.focusService.focusGridInnerElement(s)},forceFocusOutWhenTabGuardsAreEmpty:!0}),this.onPaginationChanged()}setAllowFocus(t){this.allowFocusInnerElement=t}onPaginationChanged(){const e=this.gos.get("pagination")&&!this.gos.get("suppressPaginationPanel");this.setDisplayed(e),e&&(this.setupListeners(),this.enableOrDisableButtons(),this.updateLabels(),this.onPageSizeRelatedOptionsChange())}onPageSizeRelatedOptionsChange(){this.pageSizeComp.toggleSelectDisplay(this.pageSizeComp.shouldShowPageSizeSelector())}setupListeners(){this.areListenersSetup||(this.addManagedEventListeners({paginationChanged:this.onPaginationChanged.bind(this)}),[{el:this.btFirst,fn:this.onBtFirst.bind(this)},{el:this.btPrevious,fn:this.onBtPrevious.bind(this)},{el:this.btNext,fn:this.onBtNext.bind(this)},{el:this.btLast,fn:this.onBtLast.bind(this)}].forEach(t=>{const{el:e,fn:i}=t;this.addManagedListeners(e,{click:i,keydown:n=>{(n.key===St.ENTER||n.key===St.SPACE)&&(n.preventDefault(),i())}})}),qMe(this,this.getGui(),this.focusService),this.areListenersSetup=!0)}onBtFirst(){this.previousAndFirstButtonsDisabled||this.paginationService.goToFirstPage()}formatNumber(t){const e=this.gos.getCallback("paginationNumberFormatter");if(e)return e({value:t});const i=this.localeService.getLocaleTextFunc(),n=i("thousandSeparator",","),r=i("decimalSeparator",".");return pwe(t,n,r)}getTemplate(){const t=this.localeService.getLocaleTextFunc(),e=t("page","Page"),i=t("to","to"),n=t("of","of"),r=t("firstPage","First Page"),s=t("previousPage","Previous Page"),o=t("nextPage","Next Page"),a=t("lastPage","Last Page"),l=this.getCompId();return`<div class="ag-paging-panel ag-unselectable" id="ag-${l}">
                <ag-page-size-selector data-ref="pageSizeComp"></ag-page-size-selector>
                <span class="ag-paging-row-summary-panel">
                    <span id="ag-${l}-first-row" data-ref="lbFirstRowOnPage" class="ag-paging-row-summary-panel-number"></span>
                    <span id="ag-${l}-to">${i}</span>
                    <span id="ag-${l}-last-row" data-ref="lbLastRowOnPage" class="ag-paging-row-summary-panel-number"></span>
                    <span id="ag-${l}-of">${n}</span>
                    <span id="ag-${l}-row-count" data-ref="lbRecordCount" class="ag-paging-row-summary-panel-number"></span>
                </span>
                <span class="ag-paging-page-summary-panel" role="presentation">
                    <div data-ref="btFirst" class="ag-button ag-paging-button" role="button" aria-label="${r}"></div>
                    <div data-ref="btPrevious" class="ag-button ag-paging-button" role="button" aria-label="${s}"></div>
                    <span class="ag-paging-description">
                        <span id="ag-${l}-start-page">${e}</span>
                        <span id="ag-${l}-start-page-number" data-ref="lbCurrent" class="ag-paging-number"></span>
                        <span id="ag-${l}-of-page">${n}</span>
                        <span id="ag-${l}-of-page-number" data-ref="lbTotal" class="ag-paging-number"></span>
                    </span>
                    <div data-ref="btNext" class="ag-button ag-paging-button" role="button" aria-label="${o}"></div>
                    <div data-ref="btLast" class="ag-button ag-paging-button" role="button" aria-label="${a}"></div>
                </span>
            </div>`}onBtNext(){this.nextButtonDisabled||this.paginationService.goToNextPage()}onBtPrevious(){this.previousAndFirstButtonsDisabled||this.paginationService.goToPreviousPage()}onBtLast(){this.lastButtonDisabled||this.paginationService.goToLastPage()}enableOrDisableButtons(){const t=this.paginationService.getCurrentPage(),e=this.rowModel.isLastRowIndexKnown(),i=this.paginationService.getTotalPages();this.previousAndFirstButtonsDisabled=t===0,this.toggleButtonDisabled(this.btFirst,this.previousAndFirstButtonsDisabled),this.toggleButtonDisabled(this.btPrevious,this.previousAndFirstButtonsDisabled);const n=this.isZeroPagesToDisplay(),r=t===i-1;this.nextButtonDisabled=r||n,this.lastButtonDisabled=!e||n||t===i-1,this.toggleButtonDisabled(this.btNext,this.nextButtonDisabled),this.toggleButtonDisabled(this.btLast,this.lastButtonDisabled)}toggleButtonDisabled(t,e){Rxe(t,e),t.classList.toggle("ag-disabled",e)}isZeroPagesToDisplay(){const t=this.rowModel.isLastRowIndexKnown(),e=this.paginationService.getTotalPages();return t&&e===0}updateLabels(){const t=this.rowModel.isLastRowIndexKnown(),e=this.paginationService.getTotalPages(),i=this.paginationService.getMasterRowCount(),n=t?i:null;if(n===1){const N=this.rowModel.getRow(0);if(N&&N.group&&!(N.groupData||N.aggData)){this.setTotalLabelsToZero();return}}const r=this.paginationService.getCurrentPage(),s=this.paginationService.getPageSize();let o,a;this.isZeroPagesToDisplay()?o=a=0:(o=s*r+1,a=o+s-1,t&&a>n&&(a=n));const l=o+s-1,u=!t&&i<l,d=this.formatNumber(o);this.lbFirstRowOnPage.textContent=d;let p;const v=this.localeService.getLocaleTextFunc();u?p=v("pageLastRowUnknown","?"):p=this.formatNumber(a),this.lbLastRowOnPage.textContent=p;const w=e>0?r+1:0,R=this.formatNumber(w);this.lbCurrent.textContent=R;let O,P;if(t)O=this.formatNumber(e),P=this.formatNumber(n);else{const N=v("more","more");O=N,P=N}this.lbTotal.textContent=O,this.lbRecordCount.textContent=P,this.announceAriaStatus(d,p,P,R,O)}announceAriaStatus(t,e,i,n,r){const s=this.localeService.getLocaleTextFunc(),o=s("page","Page"),a=s("to","to"),l=s("of","of"),u=`${t} ${a} ${e} ${l} ${i}`,d=`${o} ${n} ${l} ${r}`;u!==this.ariaRowStatus&&(this.ariaRowStatus=u,this.ariaAnnouncementService.announceValue(u,"paginationRow")),d!==this.ariaPageStatus&&(this.ariaPageStatus=d,this.ariaAnnouncementService.announceValue(d,"paginationPage"))}setTotalLabelsToZero(){const t=this.formatNumber(0);this.lbFirstRowOnPage.textContent=t,this.lbCurrent.textContent=t,this.lbLastRowOnPage.textContent=t,this.lbTotal.textContent=t,this.lbRecordCount.textContent=t,this.announceAriaStatus(t,t,t,t,t)}},XMe={selector:"AG-PAGINATION",component:ZMe},KMe=class extends kt{constructor(){super(...arguments),this.beanName="paginationService",this.currentPage=0,this.topDisplayedRowIndex=0,this.bottomDisplayedRowIndex=0,this.masterRowCount=0}wireBeans(t){this.rowModel=t.rowModel,this.pageBoundsService=t.pageBoundsService}postConstruct(){this.active=this.gos.get("pagination"),this.pageSizeFromGridOptions=this.gos.get("paginationPageSize"),this.paginateChildRows=this.isPaginateChildRows(),this.addManagedPropertyListener("pagination",this.onPaginationGridOptionChanged.bind(this)),this.addManagedPropertyListener("paginationPageSize",this.onPageSizeGridOptionChanged.bind(this))}getPaginationSelector(){return XMe}isPaginateChildRows(){return this.gos.get("groupRemoveSingleChildren")||this.gos.get("groupRemoveLowestSingleChildren")?!0:this.gos.get("paginateChildRows")}onPaginationGridOptionChanged(){this.active=this.gos.get("pagination"),this.calculatePages(),this.dispatchPaginationChangedEvent({keepRenderedRows:!0})}onPageSizeGridOptionChanged(){this.setPageSize(this.gos.get("paginationPageSize"),"gridOptions")}goToPage(t){!this.active||this.currentPage===t||typeof this.currentPage!="number"||(this.currentPage=t,this.calculatePages(),this.dispatchPaginationChangedEvent({newPage:!0}))}isRowPresent(t){return t.rowIndex>=this.topDisplayedRowIndex&&t.rowIndex<=this.bottomDisplayedRowIndex}getPageForIndex(t){return Math.floor(t/this.pageSize)}goToPageWithIndex(t){if(!this.active)return;const e=this.getPageForIndex(t);this.goToPage(e)}isRowInPage(t){return this.active?this.getPageForIndex(t.rowIndex)===this.currentPage:!0}getCurrentPage(){return this.currentPage}goToNextPage(){this.goToPage(this.currentPage+1)}goToPreviousPage(){this.goToPage(this.currentPage-1)}goToFirstPage(){this.goToPage(0)}goToLastPage(){const t=this.rowModel.getRowCount(),e=Math.floor(t/this.pageSize);this.goToPage(e)}getPageSize(){return this.pageSize}getTotalPages(){return this.totalPages}setPage(t){this.currentPage=t}get pageSize(){return oi(this.pageSizeAutoCalculated)&&this.gos.get("paginationAutoPageSize")?this.pageSizeAutoCalculated:oi(this.pageSizeFromPageSizeSelector)?this.pageSizeFromPageSizeSelector:oi(this.pageSizeFromInitialState)?this.pageSizeFromInitialState:oi(this.pageSizeFromGridOptions)?this.pageSizeFromGridOptions:this.defaultPageSize}calculatePages(){this.active?this.paginateChildRows?this.calculatePagesAllRows():this.calculatePagesMasterRowsOnly():this.calculatedPagesNotActive(),this.pageBoundsService.calculateBounds(this.topDisplayedRowIndex,this.bottomDisplayedRowIndex)}unsetAutoCalculatedPageSize(){if(this.pageSizeAutoCalculated===void 0)return;const t=this.pageSizeAutoCalculated;this.pageSizeAutoCalculated=void 0,this.pageSize!==t&&(this.calculatePages(),this.dispatchPaginationChangedEvent({newPageSize:!0}))}setPageSize(t,e){const i=this.pageSize;switch(e){case"autoCalculated":this.pageSizeAutoCalculated=t;break;case"pageSizeSelector":this.pageSizeFromPageSizeSelector=t,this.currentPage!==0&&this.goToFirstPage();break;case"initialState":this.pageSizeFromInitialState=t;break;case"gridOptions":this.pageSizeFromGridOptions=t,this.pageSizeFromInitialState=void 0,this.pageSizeFromPageSizeSelector=void 0,this.currentPage!==0&&this.goToFirstPage();break}i!==this.pageSize&&(this.calculatePages(),this.dispatchPaginationChangedEvent({newPageSize:!0,keepRenderedRows:!0}))}setZeroRows(){this.masterRowCount=0,this.topDisplayedRowIndex=0,this.bottomDisplayedRowIndex=-1,this.currentPage=0,this.totalPages=0}adjustCurrentPageIfInvalid(){this.currentPage>=this.totalPages&&(this.currentPage=this.totalPages-1),(!isFinite(this.currentPage)||isNaN(this.currentPage)||this.currentPage<0)&&(this.currentPage=0)}calculatePagesMasterRowsOnly(){if(this.masterRowCount=this.rowModel.getTopLevelRowCount(),this.masterRowCount<=0){this.setZeroRows();return}const t=this.masterRowCount-1;this.totalPages=Math.floor(t/this.pageSize)+1,this.adjustCurrentPageIfInvalid();const e=this.pageSize*this.currentPage;let i=this.pageSize*(this.currentPage+1)-1;if(i>t&&(i=t),this.topDisplayedRowIndex=this.rowModel.getTopLevelRowDisplayedIndex(e),i===t)this.bottomDisplayedRowIndex=this.rowModel.getRowCount()-1;else{const n=this.rowModel.getTopLevelRowDisplayedIndex(i+1);this.bottomDisplayedRowIndex=n-1}}getMasterRowCount(){return this.masterRowCount}calculatePagesAllRows(){if(this.masterRowCount=this.rowModel.getRowCount(),this.masterRowCount===0){this.setZeroRows();return}const t=this.masterRowCount-1;this.totalPages=Math.floor(t/this.pageSize)+1,this.adjustCurrentPageIfInvalid(),this.topDisplayedRowIndex=this.pageSize*this.currentPage,this.bottomDisplayedRowIndex=this.pageSize*(this.currentPage+1)-1,this.bottomDisplayedRowIndex>t&&(this.bottomDisplayedRowIndex=t)}calculatedPagesNotActive(){this.setPageSize(void 0,"autoCalculated"),this.totalPages=1,this.currentPage=0,this.topDisplayedRowIndex=0,this.bottomDisplayedRowIndex=this.rowModel.getRowCount()-1}dispatchPaginationChangedEvent(t){const{keepRenderedRows:e=!1,newPage:i=!1,newPageSize:n=!1}=t;this.eventService.dispatchEvent({type:"paginationChanged",animate:!1,newData:!1,newPage:i,newPageSize:n,keepRenderedRows:e})}},ZJ={version:fn,moduleName:"@ag-grid-community/pagination-core",beans:[KMe,WMe]},YMe={version:fn,moduleName:"@ag-grid-community/pagination-api",dependantModules:[ZJ],apiFunctions:{paginationIsLastPageFound:LMe,paginationGetPageSize:FMe,paginationGetCurrentPage:NMe,paginationGetTotalPages:BMe,paginationGetRowCount:zMe,paginationGoToNextPage:VMe,paginationGoToPreviousPage:GMe,paginationGoToFirstPage:UMe,paginationGoToLastPage:HMe,paginationGoToPage:$Me}},JMe={version:fn,moduleName:"@ag-grid-community/pagination",dependantModules:[ZJ,YMe]},il="clientSide",Ta="serverSide",ny="infinite",eTe={onGroupExpandedOrCollapsed:[il],refreshClientSideRowModel:[il],isRowDataEmpty:[il],forEachLeafNode:[il],forEachNodeAfterFilter:[il],forEachNodeAfterFilterAndSort:[il],resetRowHeights:[il],applyTransaction:[il],applyTransactionAsync:[il],flushAsyncTransactions:[il],getBestCostNodeSelection:[il],getServerSideSelectionState:[Ta],setServerSideSelectionState:[Ta],applyServerSideTransaction:[Ta],applyServerSideTransactionAsync:[Ta],applyServerSideRowData:[Ta],retryServerSideLoads:[Ta],flushServerSideAsyncTransactions:[Ta],refreshServerSide:[Ta],getServerSideGroupLevelState:[Ta],refreshInfiniteCache:[ny],purgeInfiniteCache:[ny],getInfiniteRowCount:[ny],isLastRowIndexKnown:[ny,Ta],expandAll:[il,Ta],collapseAll:[il,Ta],onRowHeightChanged:[il,Ta],setRowCount:[ny,Ta],getCacheBlockState:[ny,Ta]},tTe={getValue:{version:"v31.3",new:"getCellValue"},getFirstDisplayedRow:{version:"v31.1",new:"getFirstDisplayedRowIndex"},getLastDisplayedRow:{version:"v31.1",new:"getLastDisplayedRowIndex"},getModel:{version:"v31.1",message:"Please use the appropriate grid API methods instead."},setColumnVisible:{version:"v31.1",old:"setColumnVisible(key,visible)",new:"setColumnsVisible([key],visible)"},setColumnPinned:{version:"v31.1",old:"setColumnPinned(key,pinned)",new:"setColumnsPinned([key],pinned)"},moveColumn:{version:"v31.1",old:"moveColumn(key, toIndex)",new:"moveColumns([key], toIndex)"},setColumnWidth:{version:"v31.1",old:"setColumnWidth(col, width)",new:"setColumnWidths([{key: col, newWidth: width}])"},autoSizeColumn:{version:"v31.1",old:"autoSizeColumn(key, skipHeader)",new:"autoSizeColumns([key], skipHeader)"},addAggFunc:{version:"v31.1",old:"addAggFunc(key, func)",new:"addAggFuncs({ key: func })"},removeValueColumn:{version:"v31.1",old:"removeValueColumn(colKey)",new:"removeValueColumns([colKey])"},addValueColumn:{version:"v31.1",old:"addValueColumn(colKey)",new:"addValueColumns([colKey])"},removeRowGroupColumn:{version:"v31.1",old:"removeRowGroupColumn(colKey)",new:"removeRowGroupColumns([colKey])"},addRowGroupColumn:{version:"v31.1",old:"addRowGroupColumn(colKey)",new:"addRowGroupColumns([colKey])"},removePivotColumn:{version:"v31.1",old:"removePivotColumn(colKey)",new:"removePivotColumns([colKey])"},addPivotColumn:{version:"v31.1",old:"addPivotColumn(colKey)",new:"addPivotColumns([colKey])"},showColumnMenuAfterButtonClick:{version:"v31.1",message:"Use 'IHeaderParams.showColumnMenu' within a header component, or 'api.showColumnMenu' elsewhere."},showColumnMenuAfterMouseClick:{version:"v31.1",message:"Use 'IHeaderParams.showColumnMenuAfterMouseClick' within a header component, or 'api.showColumnMenu' elsewhere."},getFilterInstance:{version:"v31.1",message:"'getFilterInstance' is deprecated. To get/set individual filter models, use 'getColumnFilterModel' or 'setColumnFilterModel' instead. To get hold of the filter instance, use 'getColumnFilterInstance' which returns the instance asynchronously."},showLoadingOverlay:{version:"v32",message:'`showLoadingOverlay` is deprecated. Use the grid option "loading"=true instead or setGridOption("loading", true).'},clearRangeSelection:{version:"v32.2",message:"Use `clearCellSelection` instead."},getInfiniteRowCount:{version:"v32.2",old:"getInfiniteRowCount()",new:"getDisplayedRowCount()"}};function iTe(t,e,i){const n=tTe[t];if(n){const{version:s,new:o,old:a,message:l}=n,u=a??t;return(...d)=>{const p=o?`Please use ${o} instead. `:"";return Wt(`Since ${s} api.${u} is deprecated. ${p}${l??""}`),e.apply(e,d)}}const r=eTe[t];return r?(...s)=>{const o=i.rowModel.getType();if(!r.includes(o)){ar(`api.${t} can only be called when gridOptions.rowModelType is ${r.join(" or ")}`);return}return e.apply(e,s)}:e}var nTe={columnsMenuParams:{version:"31.1",message:"Use `columnChooserParams` instead."},suppressMenu:{version:"31.1",message:"Use `suppressHeaderMenuButton` instead."},suppressCellFlash:{version:"31.2",message:"Use `enableCellChangeFlash={false}` in the ColDef"},checkboxSelection:{version:"32.2",message:"Use `rowSelection.checkboxes` in `GridOptions` instead."},headerCheckboxSelection:{version:"32.2",message:"Use `rowSelection.headerCheckbox = true` in `GridOptions` instead."},headerCheckboxSelectionFilteredOnly:{version:"32.2",message:'Use `rowSelection.selectAll = "filtered"` in `GridOptions` instead.'},headerCheckboxSelectionCurrentPageOnly:{version:"32.2",message:'Use `rowSelection.selectAll = "currentPage"` in `GridOptions` instead.'},showDisabledCheckboxes:{version:"32.2",message:"Use `rowSelection.hideDisabledCheckboxes = true` in `GridOptions` instead."}},Lf=(t,e)=>{const i=e.rowModelType??"clientSide";return i==="clientSide"||i==="serverSide"?{module:"@ag-grid-enterprise/row-grouping"}:null},rTe={enableRowGroup:Lf,rowGroup:Lf,rowGroupIndex:Lf,enablePivot:Lf,enableValue:Lf,pivot:Lf,pivotIndex:Lf,aggFunc:Lf,cellEditor:t=>t.cellEditor==="agRichSelect"||t.cellEditor==="agRichSelectCellEditor"?{module:"@ag-grid-enterprise/rich-select"}:null,menuTabs:t=>{const e=["columnsMenuTab","generalMenuTab"];return t.menuTabs?.some(i=>e.includes(i))?{module:"@ag-grid-enterprise/menu"}:null},columnsMenuParams:{module:["@ag-grid-enterprise/menu","@ag-grid-enterprise/column-tool-panel"]},columnChooserParams:{module:["@ag-grid-enterprise/menu","@ag-grid-enterprise/column-tool-panel"]},headerCheckboxSelection:{supportedRowModels:["clientSide","serverSide"],validate:(t,{rowSelection:e})=>e==="multiple"?null:"headerCheckboxSelection is only supported with rowSelection=multiple"},headerCheckboxSelectionFilteredOnly:{supportedRowModels:["clientSide"],validate:(t,{rowSelection:e})=>e==="multiple"?null:"headerCheckboxSelectionFilteredOnly is only supported with rowSelection=multiple"},headerCheckboxSelectionCurrentPageOnly:{supportedRowModels:["clientSide"],validate:(t,{rowSelection:e})=>e==="multiple"?null:"headerCheckboxSelectionCurrentPageOnly is only supported with rowSelection=multiple"},children:()=>ky},sTe={headerName:void 0,columnGroupShow:void 0,headerClass:void 0,toolPanelClass:void 0,headerValueGetter:void 0,pivotKeys:void 0,groupId:void 0,colId:void 0,sort:void 0,initialSort:void 0,field:void 0,type:void 0,cellDataType:void 0,tooltipComponent:void 0,tooltipField:void 0,headerTooltip:void 0,cellClass:void 0,showRowGroup:void 0,filter:void 0,initialAggFunc:void 0,defaultAggFunc:void 0,aggFunc:void 0,pinned:void 0,initialPinned:void 0,chartDataType:void 0,cellAriaRole:void 0,cellEditorPopupPosition:void 0,headerGroupComponent:void 0,headerGroupComponentParams:void 0,cellStyle:void 0,cellRenderer:void 0,cellRendererParams:void 0,cellEditor:void 0,cellEditorParams:void 0,filterParams:void 0,pivotValueColumn:void 0,headerComponent:void 0,headerComponentParams:void 0,floatingFilterComponent:void 0,floatingFilterComponentParams:void 0,tooltipComponentParams:void 0,refData:void 0,columnsMenuParams:void 0,columnChooserParams:void 0,children:void 0,sortingOrder:void 0,allowedAggFuncs:void 0,menuTabs:void 0,pivotTotalColumnIds:void 0,cellClassRules:void 0,icons:void 0,sortIndex:void 0,initialSortIndex:void 0,flex:void 0,initialFlex:void 0,width:void 0,initialWidth:void 0,minWidth:void 0,maxWidth:void 0,rowGroupIndex:void 0,initialRowGroupIndex:void 0,pivotIndex:void 0,initialPivotIndex:void 0,suppressCellFlash:void 0,suppressColumnsToolPanel:void 0,suppressFiltersToolPanel:void 0,openByDefault:void 0,marryChildren:void 0,suppressStickyLabel:void 0,hide:void 0,initialHide:void 0,rowGroup:void 0,initialRowGroup:void 0,pivot:void 0,initialPivot:void 0,checkboxSelection:void 0,showDisabledCheckboxes:void 0,headerCheckboxSelection:void 0,headerCheckboxSelectionFilteredOnly:void 0,headerCheckboxSelectionCurrentPageOnly:void 0,suppressMenu:void 0,suppressHeaderMenuButton:void 0,suppressMovable:void 0,lockPosition:void 0,lockVisible:void 0,lockPinned:void 0,unSortIcon:void 0,suppressSizeToFit:void 0,suppressAutoSize:void 0,enableRowGroup:void 0,enablePivot:void 0,enableValue:void 0,editable:void 0,suppressPaste:void 0,suppressNavigable:void 0,enableCellChangeFlash:void 0,rowDrag:void 0,dndSource:void 0,autoHeight:void 0,wrapText:void 0,sortable:void 0,resizable:void 0,singleClickEdit:void 0,floatingFilter:void 0,cellEditorPopup:void 0,suppressFillHandle:void 0,wrapHeaderText:void 0,autoHeaderHeight:void 0,dndSourceOnRowDrag:void 0,valueGetter:void 0,valueSetter:void 0,filterValueGetter:void 0,keyCreator:void 0,valueFormatter:void 0,valueParser:void 0,comparator:void 0,equals:void 0,pivotComparator:void 0,suppressKeyboardEvent:void 0,suppressHeaderKeyboardEvent:void 0,colSpan:void 0,rowSpan:void 0,getQuickFilterText:void 0,onCellValueChanged:void 0,onCellClicked:void 0,onCellDoubleClicked:void 0,onCellContextMenu:void 0,rowDragText:void 0,tooltipValueGetter:void 0,cellRendererSelector:void 0,cellEditorSelector:void 0,suppressSpanHeaderHeight:void 0,useValueFormatterForExport:void 0,useValueParserForImport:void 0,mainMenuItems:void 0,contextMenuItems:void 0,suppressFloatingFilterButton:void 0,suppressHeaderFilterButton:void 0,suppressHeaderContextMenu:void 0,loadingCellRenderer:void 0,loadingCellRendererParams:void 0,loadingCellRendererSelector:void 0,context:void 0},oTe=Object.keys(sTe),ky={objectName:"colDef",allProperties:oTe,docsUrl:"column-properties/",deprecations:nTe,validations:rTe},aTe=()=>({advancedFilterModel:{version:"31",message:"Use `initialState.filter.advancedFilterModel` instead."},suppressAsyncEvents:{version:"31",message:"Events should be handled asynchronously."},cellFadeDelay:{version:"31.1",renamed:"cellFadeDuration"},cellFlashDelay:{version:"31.1",renamed:"cellFlashDuration"},suppressServerSideInfiniteScroll:{version:"31.1"},serverSideSortOnServer:{version:"31.1"},serverSideFilterOnServer:{version:"31.1"},enableCellChangeFlash:{version:"31.2",message:"Use `enableCellChangeFlash` in the `ColDef` or `defaultColDef` for all columns."},groupIncludeFooter:{version:"31.3",message:"Use `groupTotalRow` instead."},groupIncludeTotalFooter:{version:"31.3",message:"Use `grandTotalRow` instead."},suppressLoadingOverlay:{version:"32",message:"Use `loading`=false instead."},enableFillHandle:{version:"32.2",message:"Use `cellSelection.handle` instead."},enableRangeHandle:{version:"32.2",message:"Use `cellSelection.handle` instead."},enableRangeSelection:{version:"32.2",message:"Use `cellSelection = true` instead."},suppressMultiRangeSelection:{version:"32.2",message:"Use `cellSelection.suppressMultiRanges` instead."},suppressClearOnFillReduction:{version:"32.2",message:"Use `cellSelection.handle.suppressClearOnFillReduction` instead."},fillHandleDirection:{version:"32.2",message:"Use `cellSelection.handle.direction` instead."},fillOperation:{version:"32.2",message:"Use `cellSelection.handle.setFillValue` instead."},suppressRowClickSelection:{version:"32.2",message:"Use `rowSelection.enableClickSelection` instead."},suppressRowDeselection:{version:"32.2",message:"Use `rowSelection.enableClickSelection` instead."},rowMultiSelectWithClick:{version:"32.2",message:"Use `rowSelection.enableSelectionWithoutKeys` instead."},groupSelectsChildren:{version:"32.2",message:'Use `rowSelection.groupSelects = "descendants"` instead.'},groupSelectsFiltered:{version:"32.2",message:'Use `rowSelection.groupSelects = "filteredDescendants"` instead.'},isRowSelectable:{version:"32.2",message:"Use `selectionOptions.isRowSelectable` instead."},suppressCopySingleCellRanges:{version:"32.2",message:"Use `rowSelection.copySelectedRows` instead."},suppressCopyRowsToClipboard:{version:"32.2",message:"Use `rowSelection.copySelectedRows` instead."},onRangeSelectionChanged:{version:"32.2",message:"Use `onCellSelectionChanged` instead."},onRangeDeleteStart:{version:"32.2",message:"Use `onCellSelectionDeleteStart` instead."},onRangeDeleteEnd:{version:"32.2",message:"Use `onCellSelectionDeleteEnd` instead."},suppressBrowserResizeObserver:{version:"32.2",message:"The grid always uses the browser's ResizeObserver, this grid option has no effect."},onColumnEverythingChanged:{version:"32.2",message:"Either use `onDisplayedColumnsChanged` which is fired at the same time, or use one of the more specific column events."}}),lTe={suppressContextMenu:!1,preventDefaultOnContextMenu:!1,allowContextMenuWithControlKey:!1,suppressMenuHide:!0,enableBrowserTooltips:!1,tooltipTrigger:"hover",tooltipShowDelay:2e3,tooltipHideDelay:1e4,tooltipMouseTrack:!1,tooltipShowMode:"standard",tooltipInteraction:!1,copyHeadersToClipboard:!1,copyGroupHeadersToClipboard:!1,clipboardDelimiter:"	",suppressCopyRowsToClipboard:!1,suppressCopySingleCellRanges:!1,suppressLastEmptyLineOnPaste:!1,suppressClipboardPaste:!1,suppressClipboardApi:!1,suppressCutToClipboard:!1,maintainColumnOrder:!1,enableStrictPivotColumnOrder:!1,suppressFieldDotNotation:!1,allowDragFromColumnsToolPanel:!1,suppressMovableColumns:!1,suppressColumnMoveAnimation:!1,suppressMoveWhenColumnDragging:!1,suppressDragLeaveHidesColumns:!1,suppressRowGroupHidesColumns:!1,suppressAutoSize:!1,autoSizePadding:20,skipHeaderOnAutoSize:!1,singleClickEdit:!1,suppressClickEdit:!1,readOnlyEdit:!1,stopEditingWhenCellsLoseFocus:!1,enterNavigatesVertically:!1,enterNavigatesVerticallyAfterEdit:!1,enableCellEditingOnBackspace:!1,undoRedoCellEditing:!1,undoRedoCellEditingLimit:10,suppressCsvExport:!1,suppressExcelExport:!1,cacheQuickFilter:!1,includeHiddenColumnsInQuickFilter:!1,excludeChildrenWhenTreeDataFiltering:!1,enableAdvancedFilter:!1,includeHiddenColumnsInAdvancedFilter:!1,enableCharts:!1,masterDetail:!1,keepDetailRows:!1,keepDetailRowsCount:10,detailRowAutoHeight:!1,tabIndex:0,rowBuffer:10,valueCache:!1,valueCacheNeverExpires:!1,enableCellExpressions:!1,suppressTouch:!1,suppressFocusAfterRefresh:!1,suppressAsyncEvents:!1,suppressBrowserResizeObserver:!1,suppressPropertyNamesCheck:!1,suppressChangeDetection:!1,debug:!1,suppressLoadingOverlay:!1,suppressNoRowsOverlay:!1,pagination:!1,paginationPageSize:100,paginationPageSizeSelector:!0,paginationAutoPageSize:!1,paginateChildRows:!1,suppressPaginationPanel:!1,pivotMode:!1,pivotPanelShow:"never",pivotDefaultExpanded:0,pivotSuppressAutoColumn:!1,suppressExpandablePivotGroups:!1,functionsReadOnly:!1,suppressAggFuncInHeader:!1,alwaysAggregateAtRootLevel:!1,aggregateOnlyChangedColumns:!1,suppressAggFilteredOnly:!1,removePivotHeaderRowWhenSingleValueColumn:!1,animateRows:!0,enableCellChangeFlash:!1,cellFlashDelay:500,cellFlashDuration:500,cellFadeDelay:1e3,cellFadeDuration:1e3,allowShowChangeAfterFilter:!1,domLayout:"normal",ensureDomOrder:!1,enableRtl:!1,suppressColumnVirtualisation:!1,suppressMaxRenderedRowRestriction:!1,suppressRowVirtualisation:!1,rowDragManaged:!1,suppressRowDrag:!1,suppressMoveWhenRowDragging:!1,rowDragEntireRow:!1,rowDragMultiRow:!1,embedFullWidthRows:!1,groupDisplayType:"singleColumn",groupDefaultExpanded:0,groupMaintainOrder:!1,groupSelectsChildren:!1,groupIncludeTotalFooter:!1,groupSuppressBlankHeader:!1,groupSelectsFiltered:!1,showOpenedGroup:!1,groupRemoveSingleChildren:!1,groupRemoveLowestSingleChildren:!1,groupHideOpenParents:!1,groupAllowUnbalanced:!1,rowGroupPanelShow:"never",suppressMakeColumnVisibleAfterUnGroup:!1,treeData:!1,rowGroupPanelSuppressSort:!1,suppressGroupRowsSticky:!1,rowModelType:"clientSide",asyncTransactionWaitMillis:50,suppressModelUpdateAfterUpdateTransaction:!1,cacheOverflowSize:1,infiniteInitialRowCount:1,serverSideInitialRowCount:1,suppressServerSideInfiniteScroll:!1,cacheBlockSize:100,maxBlocksInCache:-1,maxConcurrentDatasourceRequests:2,blockLoadDebounceMillis:0,purgeClosedRowNodes:!1,serverSideSortAllLevels:!1,serverSideOnlyRefreshFilteredGroups:!1,serverSideSortOnServer:!1,serverSideFilterOnServer:!1,serverSidePivotResultFieldSeparator:"_",viewportRowModelPageSize:5,viewportRowModelBufferSize:5,alwaysShowHorizontalScroll:!1,alwaysShowVerticalScroll:!1,debounceVerticalScrollbar:!1,suppressHorizontalScroll:!1,suppressScrollOnNewData:!1,suppressScrollWhenPopupsAreOpen:!1,suppressAnimationFrame:!1,suppressMiddleClickScrolls:!1,suppressPreventDefaultOnMouseWheel:!1,rowMultiSelectWithClick:!1,suppressRowDeselection:!1,suppressRowClickSelection:!1,suppressCellFocus:!1,suppressHeaderFocus:!1,suppressMultiRangeSelection:!1,enableCellTextSelection:!1,enableRangeSelection:!1,enableRangeHandle:!1,enableFillHandle:!1,fillHandleDirection:"xy",suppressClearOnFillReduction:!1,accentedSort:!1,unSortIcon:!1,suppressMultiSort:!1,alwaysMultiSort:!1,suppressMaintainUnsortedOrder:!1,suppressRowHoverHighlight:!1,suppressRowTransform:!1,columnHoverHighlight:!1,deltaSort:!1,enableGroupEdit:!1,suppressGroupMaintainValueType:!1,groupLockGroupColumns:0,serverSideEnableClientSideSort:!1,suppressServerSideFullWidthLoadingRow:!1,pivotMaxGeneratedColumns:-1,columnMenu:"new",reactiveCustomComponents:!0,suppressSetFilterByDefault:!1},cTe=()=>({sideBar:{module:"@ag-grid-enterprise/side-bar"},statusBar:{module:"@ag-grid-enterprise/status-bar"},enableCharts:{module:"@ag-grid-enterprise/charts"},getMainMenuItems:{module:"@ag-grid-enterprise/menu"},getContextMenuItems:{module:"@ag-grid-enterprise/menu"},allowContextMenuWithControlKey:{module:"@ag-grid-enterprise/menu"},enableAdvancedFilter:{module:"@ag-grid-enterprise/advanced-filter"},treeData:{supportedRowModels:["clientSide","serverSide"],module:"@ag-grid-enterprise/row-grouping",validate:t=>{const e=t.rowModelType??"clientSide";switch(e){case"clientSide":{const i=`treeData requires 'getDataPath' in the ${e} row model.`;return t.getDataPath?null:i}case"serverSide":{const i=`treeData requires 'isServerSideGroup' and 'getServerSideGroupKey' in the ${e} row model.`;return t.isServerSideGroup&&t.getServerSideGroupKey?null:i}}return null}},masterDetail:{module:"@ag-grid-enterprise/master-detail"},enableRangeSelection:{module:"@ag-grid-enterprise/range-selection"},enableRangeHandle:{dependencies:{enableRangeSelection:[!0]}},enableFillHandle:{dependencies:{enableRangeSelection:[!0]}},groupDefaultExpanded:{supportedRowModels:["clientSide"]},groupIncludeFooter:{supportedRowModels:["clientSide","serverSide"],validate:t=>{switch(t.rowModelType??"clientSide"){case"clientSide":return null;case"serverSide":return t.suppressServerSideInfiniteScroll?"groupIncludeFooter is not supported alongside suppressServerSideInfiniteScroll":null}return null}},groupHideOpenParents:{supportedRowModels:["clientSide","serverSide"],dependencies:{groupTotalRow:[void 0,"bottom"]}},groupIncludeTotalFooter:{supportedRowModels:["clientSide"]},groupRemoveSingleChildren:{dependencies:{groupHideOpenParents:[void 0,!1],groupRemoveLowestSingleChildren:[void 0,!1]}},groupRemoveLowestSingleChildren:{dependencies:{groupHideOpenParents:[void 0,!1],groupRemoveSingleChildren:[void 0,!1]}},groupSelectsChildren:{dependencies:{rowSelection:["multiple"]}},viewportDatasource:{supportedRowModels:["viewport"],module:"@ag-grid-enterprise/viewport-row-model"},serverSideDatasource:{supportedRowModels:["serverSide"],module:"@ag-grid-enterprise/server-side-row-model"},cacheBlockSize:{supportedRowModels:["serverSide","infinite"]},datasource:{supportedRowModels:["infinite"],module:"@ag-grid-community/infinite-row-model"},rowData:{supportedRowModels:["clientSide"],module:"@ag-grid-community/client-side-row-model"},paginationPageSizeSelector:{validate:t=>{const e=t.paginationPageSizeSelector;return typeof e=="boolean"||e==null||e.length?null:`'paginationPageSizeSelector' cannot be an empty array.
                    If you want to hide the page size selector, set paginationPageSizeSelector to false.`}},rowSelection:{validate({rowSelection:t}){return t&&typeof t=="string"?'As of version 32.2.1, using `rowSelection` with the values "single" or "multiple" has been deprecated. Use the object value instead.':t&&typeof t!="object"?"Expected `RowSelectionOptions` object for the `rowSelection` property.":null}},cellSelection:{module:"@ag-grid-enterprise/range-selection"},columnDefs:()=>ky,defaultColDef:()=>ky,defaultColGroupDef:()=>ky,autoGroupColumnDef:()=>ky,selectionColumnDef:()=>ky}),uTe=()=>({objectName:"gridOptions",allProperties:[...H_.ALL_PROPERTIES,...OY.EVENT_CALLBACKS],propertyExceptions:["api"],docsUrl:"grid-options/",deprecations:aTe(),validations:cTe()}),hTe=class extends kt{constructor(){super(...arguments),this.beanName="validationService"}wireBeans(t){this.beans=t,this.gridOptions=t.gridOptions}postConstruct(){this.processGridOptions(this.gridOptions)}processGridOptions(t){this.processOptions(t,uTe())}validateApiFunction(t,e){return iTe(t,e,this.beans)}processOptions(t,e){const{validations:i,deprecations:n,allProperties:r,propertyExceptions:s,objectName:o,docsUrl:a}=e;r&&this.gridOptions.suppressPropertyNamesCheck!==!0&&this.checkProperties(t,[...s??[],...Object.keys(n)],r,o,a);const l=new Set;Object.keys(t).forEach(d=>{const p=n[d];if(p)if("renamed"in p){const{renamed:F,version:k}=p;l.add(`As of v${k}, ${String(d)} is deprecated. Please use ${String(F)} instead.`),t[F]=t[d]}else{const{message:F,version:k}=p;l.add(`As of v${k}, ${String(d)} is deprecated. ${F??""}`)}const v=t[d];if(v==null||v===!1)return;const y=i[d];let w;if(y)if(typeof y=="function"){const F=y(t,this.gridOptions);if(!F)return;if("objectName"in F){const k=t[d];if(Array.isArray(k)){k.forEach($=>{this.processOptions($,F)});return}this.processOptions(t[d],F);return}w=F}else w=y;else return;const{module:R,dependencies:O,validate:P,supportedRowModels:N}=w;if(N){const F=this.gridOptions.rowModelType??"clientSide";if(!N.includes(F)){l.add(`${String(d)} is not supported with the '${F}' row model.`);return}}if(R){const F=Array.isArray(R)?R:[R];let k=!0;if(F.forEach($=>{this.gos.assertModuleRegistered($,String(d))||(k=!1,l.add(`${String(d)} is only available when ${$} is loaded.`))}),!k)return}if(O){const F=this.checkForRequiredDependencies(d,O,t);if(F){l.add(F);return}}if(P){const F=P(t,this.gridOptions);if(F){l.add(F);return}}}),l.size>0&&l.forEach(d=>{Wt(d)})}checkForRequiredDependencies(t,e,i){const r=Object.entries(e).find(([a,l])=>{const u=i[a];return!l.includes(u)});if(!r)return null;const[s,o]=r;return o.length>1?`'${String(t)}' requires '${s}' to be one of [${o.join(", ")}].`:`'${String(t)}' requires '${s}' to be ${o[0]}.`}checkProperties(t,e,i,n,r){const s=["__ob__","__v_skip","__metadata__"],o=dTe(Object.getOwnPropertyNames(t),[...s,...e,...i],i);if(gu(o,(a,l)=>{let u=`invalid ${n} property '${a}' did you mean any of these: ${l.slice(0,8).join(", ")}.`;i.includes("context")&&(u+=`
If you are trying to annotate ${n} with application data, use the '${n}.context' property instead.`),Wt(u)}),Object.keys(o).length>0&&r){const a=this.getFrameworkOverrides().getDocLink(r);Wt(`to see all the valid ${n} properties please check: ${a}`)}}};function dTe(t,e,i){const n={},r=t.filter(s=>!e.some(o=>o===s));return r.length>0&&r.forEach(s=>n[s]=XY({inputValue:s,allSuggestions:i}).values),n}var fTe={version:fn,moduleName:"@ag-grid-community/core"},pTe={version:fn,moduleName:"@ag-grid-community/core-validations",beans:[hTe]},XJ={version:fn,moduleName:"@ag-grid-community/core-community-features",dependantModules:[fTe,pTe,SSe,Ywe,DMe,oOe,m1e,JMe,TMe]},mTe=class extends kt{constructor(){super(...arguments),this.beanName="gridDestroyService",this.destroyCalled=!1}wireBeans(t){this.beans=t}destroy(){this.destroyCalled||(this.eventService.dispatchEvent({type:"gridPreDestroyed",state:this.beans.stateService?.getState()??{}}),this.destroyCalled=!0,this.beans.ctrlsService.get("gridCtrl")?.destroyGridUi(),this.beans.context.destroy(),super.destroy())}isDestroyCalled(){return this.destroyCalled}},RM=new Set(["gridPreDestroyed","fillStart","pasteStart"]),gTe=t=>t==="checkboxSelected"||t==="rowClicked"||t==="spaceKey"||t==="uiSelectAll"||t==="uiSelectAllCurrentPage"||t==="uiSelectAllFiltered",vTe=new Map([...H_.BOOLEAN_PROPERTIES.map(t=>[t,dz]),...H_.NUMBER_PROPERTIES.map(t=>[t,pJ]),["groupAggFiltering",t=>typeof t=="function"?t:dz(t)],["pageSize",Qu(1)],["autoSizePadding",Qu(0)],["keepDetailRowsCount",Qu(1)],["rowBuffer",Qu(0)],["infiniteInitialRowCount",Qu(1)],["cacheOverflowSize",Qu(1)],["cacheBlockSize",Qu(1)],["serverSideInitialRowCount",Qu(1)],["viewportRowModelPageSize",Qu(1)],["viewportRowModelBufferSize",Qu(0)]]);function KJ(t,e){const i=vTe.get(t);return i?i(e):e}function yTe(t){const e={};return Object.entries(t).forEach(([i,n])=>{const r=KJ(i,n);e[i]=r}),e}var YJ=class JJ extends kt{constructor(){super(...arguments),this.beanName="gos",this.domDataKey="__AG_"+Math.random().toString(),this.propertyEventService=new tx,this.globalEventHandlerFactory=e=>(i,n)=>{if(!this.isAlive())return;const r=RM.has(i);if(r&&!e||!r&&e)return;const s=OY.getCallbackForEvent(i),o=this.gridOptions[s];typeof o=="function"&&this.frameworkOverrides.wrapOutgoing(()=>{o(n)})}}wireBeans(e){this.gridOptions=e.gridOptions,this.eGridDiv=e.eGridDiv,this.validationService=e.validationService,this.environment=e.environment,this.api=e.gridApi,this.gridId=e.context.getGridId()}get gridOptionsContext(){return this.gridOptions.context}postConstruct(){const e=!this.get("suppressAsyncEvents");this.eventService.addGlobalListener(this.globalEventHandlerFactory().bind(this),e),this.eventService.addGlobalListener(this.globalEventHandlerFactory(!0).bind(this),!1),this.propertyEventService.setFrameworkOverrides(this.frameworkOverrides),this.addManagedEventListeners({gridOptionsChanged:({options:i})=>{this.updateGridOptions({options:i,force:!0,source:"gridOptionsUpdated"})}})}get(e){return this.gridOptions[e]??lTe[e]}getCallback(e){return this.mergeGridCommonParams(this.gridOptions[e])}exists(e){return oi(this.gridOptions[e])}mergeGridCommonParams(e){return e&&(n=>{const r=n;return r.api=this.api,r.context=this.gridOptionsContext,e(r)})}updateGridOptions({options:e,force:i,source:n="api"}){const r={id:JJ.changeSetId++,properties:[]},s=[];Object.entries(e).forEach(([o,a])=>{n==="api"&&_xe[o]&&Wt(`${o} is an initial property and cannot be updated.`);const l=KJ(o,a),u=i||typeof l=="object"&&n==="api",d=this.gridOptions[o];if(u||d!==l){this.gridOptions[o]=l;const p={type:o,currentValue:l,previousValue:d,changeSet:r,source:n};s.push(p)}}),this.validationService?.processGridOptions(this.gridOptions),r.properties=s.map(o=>o.type),s.forEach(o=>{this.gridOptions.debug&&Ic(`Updated property ${o.type} from`,o.previousValue," to ",o.currentValue),this.propertyEventService.dispatchEvent(o)})}addPropertyEventListener(e,i){this.propertyEventService.addEventListener(e,i)}removePropertyEventListener(e,i){this.propertyEventService.removeEventListener(e,i)}getDomDataKey(){return this.domDataKey}getGridCommonParams(){return{api:this.api,context:this.gridOptionsContext}}addGridCommonParams(e){const i=e;return i.api=this.api,i.context=this.gridOptionsContext,i}assertModuleRegistered(e,i){return bd.__assertRegistered(e,i,this.gridId)}isModuleRegistered(e){return bd.__isRegistered(e,this.gridId)}};YJ.changeSetId=0;var xTe=YJ,bTe=class extends kt{constructor(){super(...arguments),this.beanName="headerPositionUtils"}wireBeans(t){this.visibleColsService=t.visibleColsService,this.ctrlsService=t.ctrlsService}findHeader(t,e){let i,n;if(Vs(t.column)?i=this.visibleColsService.getGroupAtDirection(t.column,e):(n=`getCol${e}`,i=this.visibleColsService[n](t.column)),!i)return;const{headerRowIndex:r}=t;if(this.getHeaderRowType(r)!=="filter"){const a=[i];for(;i.getParent();)i=i.getParent(),a.push(i);i=a[a.length-1-r]}const{column:s,headerRowIndex:o}=this.getHeaderIndexToFocus(i,r);return{column:s,headerRowIndex:o}}getHeaderIndexToFocus(t,e){let i;if(Vs(t)&&this.isAnyChildSpanningHeaderHeight(t)&&t.isPadding()){const n=t;i=n.getLeafColumns()[0];let r=i;for(;r!==n;)e++,r=r.getParent()}return{column:i||t,headerRowIndex:e}}isAnyChildSpanningHeaderHeight(t){return t?t.getLeafColumns().some(e=>e.isSpanHeaderHeight()):!1}getColumnVisibleParent(t,e){const i=this.getHeaderRowType(e),n=i==="filter",r=i==="column";let s=n?t:t.getParent(),o=e-1,a=o;if(r&&this.isAnyChildSpanningHeaderHeight(t.getParent())){for(;s&&s.isPadding();)s=s.getParent(),o--;a=o,o<0&&(s=t,o=e,a=void 0)}return{column:s,headerRowIndex:o,headerRowIndexWithoutSpan:a}}getColumnVisibleChild(t,e,i="After"){const n=this.getHeaderRowType(e);let r=t,s=e+1;const o=s;if(n==="group"){const a=t.getDisplayedLeafColumns(),l=i==="After"?a[0]:Yn(a),u=[];let d=l;for(;d.getParent()!==t;)d=d.getParent(),u.push(d);if(r=l,l.isSpanHeaderHeight())for(let p=u.length-1;p>=0;p--){const v=u[p];if(!v.isPadding()){r=v;break}s++}else r=Yn(u),r||(r=l)}return{column:r,headerRowIndex:s,headerRowIndexWithoutSpan:o}}getHeaderRowType(t){const e=this.ctrlsService.getHeaderRowContainerCtrl();if(e)return e.getRowType(t)}findColAtEdgeForHeaderRow(t,e){const i=this.visibleColsService.getAllCols(),n=i[e==="start"?0:i.length-1];if(!n)return;const s=this.ctrlsService.getHeaderRowContainerCtrl(n.getPinned())?.getRowType(t);if(s=="group"){const o=this.visibleColsService.getColGroupAtLevel(n,t);return{headerRowIndex:t,column:o}}return{headerRowIndex:s==null?-1:t,column:n}}},wTe=class extends kt{constructor(){super(...arguments),this.beanName="localeService"}getLocaleTextFunc(){const t=this.gos.getCallback("getLocaleText");if(t)return(i,n,r)=>t({key:i,defaultValue:n,variableValues:r});const e=this.gos.get("localeText");return(i,n,r)=>{let s=e&&e[i];if(s&&r&&r.length){let o=0;for(;!(o>=r.length||s.indexOf("${variable}")===-1);)s=s.replace("${variable}",r[o++])}return s??n}}},_Te=class extends kt{constructor(){super(...arguments),this.beanName="apiEventService",this.syncEventListeners=new Map,this.asyncEventListeners=new Map,this.syncGlobalEventListeners=new Set,this.globalEventListenerPairs=new Map}postConstruct(){this.frameworkEventWrappingService=new nU(this.getFrameworkOverrides())}addEventListener(t,e){const i=this.frameworkEventWrappingService.wrap(e),n=_T(this.gos)&&!RM.has(t),r=n?this.asyncEventListeners:this.syncEventListeners;r.has(t)||r.set(t,new Set),r.get(t).add(i),this.eventService.addEventListener(t,i,n)}removeEventListener(t,e){const i=this.frameworkEventWrappingService.unwrap(e),r=!!this.asyncEventListeners.get(t)?.delete(i);r||this.syncEventListeners.get(t)?.delete(i),this.eventService.removeEventListener(t,i,r)}addGlobalListener(t){const e=this.frameworkEventWrappingService.wrapGlobal(t);if(_T(this.gos)){const n=(s,o)=>{RM.has(s)&&e(s,o)},r=(s,o)=>{RM.has(s)||e(s,o)};this.globalEventListenerPairs.set(t,{syncListener:n,asyncListener:r}),this.eventService.addGlobalListener(n,!1),this.eventService.addGlobalListener(r,!0)}else this.syncGlobalEventListeners.add(e),this.eventService.addGlobalListener(e,!1)}removeGlobalListener(t){const e=this.frameworkEventWrappingService.unwrapGlobal(t);if(this.globalEventListenerPairs.has(e)){const{syncListener:n,asyncListener:r}=this.globalEventListenerPairs.get(e);this.eventService.removeGlobalListener(n,!1),this.eventService.removeGlobalListener(r,!0),this.globalEventListenerPairs.delete(t)}else this.syncGlobalEventListeners.delete(e),this.eventService.removeGlobalListener(e,!1)}destroyEventListeners(t,e){t.forEach((i,n)=>{i.forEach(r=>this.eventService.removeEventListener(n,r,e)),i.clear()}),t.clear()}destroyGlobalListeners(t,e){t.forEach(i=>this.eventService.removeGlobalListener(i,e)),t.clear()}destroy(){super.destroy(),this.destroyEventListeners(this.syncEventListeners,!1),this.destroyEventListeners(this.asyncEventListeners,!0),this.destroyGlobalListeners(this.syncGlobalEventListeners,!1),this.globalEventListenerPairs.forEach(({syncListener:t,asyncListener:e})=>{this.eventService.removeGlobalListener(t,!1),this.eventService.removeGlobalListener(e,!0)}),this.globalEventListenerPairs.clear()}},CTe=class extends kt{constructor(){super(...arguments),this.beanName="pageBoundsListener"}wireBeans(t){this.rowModel=t.rowModel,this.paginationService=t.paginationService,this.pageBoundsService=t.pageBoundsService}postConstruct(){this.addManagedEventListeners({modelUpdated:this.onModelUpdated.bind(this),recalculateRowBounds:this.calculatePages.bind(this)}),this.onModelUpdated()}onModelUpdated(t){this.calculatePages(),this.eventService.dispatchEvent({type:"paginationChanged",animate:t?.animate??!1,newData:t?.newData??!1,newPage:t?.newPage??!1,newPageSize:t?.newPageSize??!1,keepRenderedRows:t?.keepRenderedRows??!1})}calculatePages(){this.paginationService?this.paginationService.calculatePages():this.pageBoundsService.calculateBounds(0,this.rowModel.getRowCount()-1)}},STe=class extends kt{constructor(){super(...arguments),this.beanName="pageBoundsService",this.pixelOffset=0}wireBeans(t){this.rowModel=t.rowModel}getFirstRow(){return this.topRowBounds?this.topRowBounds.rowIndex:-1}getLastRow(){return this.bottomRowBounds?this.bottomRowBounds.rowIndex:-1}getCurrentPageHeight(){return Wn(this.topRowBounds)||Wn(this.bottomRowBounds)?0:Math.max(this.bottomRowBounds.rowTop+this.bottomRowBounds.rowHeight-this.topRowBounds.rowTop,0)}getCurrentPagePixelRange(){const t=this.topRowBounds?this.topRowBounds.rowTop:0,e=this.bottomRowBounds?this.bottomRowBounds.rowTop+this.bottomRowBounds.rowHeight:0;return{pageFirstPixel:t,pageLastPixel:e}}calculateBounds(t,e){this.topRowBounds=this.rowModel.getRowBounds(t),this.topRowBounds&&(this.topRowBounds.rowIndex=t),this.bottomRowBounds=this.rowModel.getRowBounds(e),this.bottomRowBounds&&(this.bottomRowBounds.rowIndex=e),this.calculatePixelOffset()}getPixelOffset(){return this.pixelOffset}calculatePixelOffset(){const t=oi(this.topRowBounds)?this.topRowBounds.rowTop:0;this.pixelOffset!==t&&(this.pixelOffset=t,this.eventService.dispatchEvent({type:"paginationPixelOffsetChanged"}))}},OTe=class extends kt{constructor(){super(),this.beanName="ariaAnnouncementService",this.descriptionContainer=null,this.pendingAnnouncements=new Map,this.updateAnnouncement=Fa(this.updateAnnouncement.bind(this),200)}wireBeans(t){this.eGridDiv=t.eGridDiv}postConstruct(){const t=Rs(this.gos),e=this.descriptionContainer=t.createElement("div");e.classList.add("ag-aria-description-container"),RY(e,"polite"),Txe(e,"additions text"),Mxe(e,!0),this.eGridDiv.appendChild(e)}announceValue(t,e){this.pendingAnnouncements.set(e,t),this.updateAnnouncement()}updateAnnouncement(){if(!this.descriptionContainer)return;const t=Array.from(this.pendingAnnouncements.values()).join(". ");this.pendingAnnouncements.clear(),this.descriptionContainer.textContent="",setTimeout(()=>{this.isAlive()&&this.descriptionContainer&&(this.descriptionContainer.textContent=t)},50)}destroy(){super.destroy();const{descriptionContainer:t}=this;t&&(fa(t),t.parentElement&&t.parentElement.removeChild(t)),this.descriptionContainer=null,this.eGridDiv=null,this.pendingAnnouncements.clear()}},MTe=class extends kt{constructor(){super(...arguments),this.beanName="columnAnimationService",this.executeNextFuncs=[],this.executeLaterFuncs=[],this.active=!1,this.activeNext=!1,this.suppressAnimation=!1,this.animationThreadCount=0}wireBeans(t){this.ctrlsService=t.ctrlsService}postConstruct(){this.ctrlsService.whenReady(this,t=>this.gridBodyCtrl=t.gridBodyCtrl)}isActive(){return this.active&&!this.suppressAnimation}setSuppressAnimation(t){this.suppressAnimation=t}start(){this.active||this.gos.get("suppressColumnMoveAnimation")||this.gos.get("enableRtl")||(this.ensureAnimationCssClassPresent(),this.active=!0,this.activeNext=!0)}finish(){this.active&&this.flush(()=>this.activeNext=!1,()=>this.active=!1)}executeNextVMTurn(t){this.activeNext?this.executeNextFuncs.push(t):t()}executeLaterVMTurn(t){this.active?this.executeLaterFuncs.push(t):t()}ensureAnimationCssClassPresent(){this.animationThreadCount++;const t=this.animationThreadCount;this.gridBodyCtrl.setColumnMovingCss(!0),this.executeLaterFuncs.push(()=>{this.animationThreadCount===t&&this.gridBodyCtrl.setColumnMovingCss(!1)})}flush(t,e){if(this.executeNextFuncs.length===0&&this.executeLaterFuncs.length===0){t(),e();return}const i=n=>{for(;n.length;){const r=n.pop();r&&r()}};this.getFrameworkOverrides().wrapIncoming(()=>{window.setTimeout(()=>{t(),i(this.executeNextFuncs)},0),window.setTimeout(()=>{e(),i(this.executeLaterFuncs)},200)})}},TTe=class extends kt{constructor(){super(...arguments),this.beanName="columnHoverService"}setMouseOver(t){this.updateState(t)}clearMouseOver(){this.updateState(null)}isHovered(t){return!!this.selectedColumns&&this.selectedColumns.indexOf(t)>=0}updateState(t){this.selectedColumns=t,this.eventService.dispatchEvent({type:"columnHoverChanged"})}},RTe=class extends kt{constructor(){super(...arguments),this.beanName="overlayService",this.state=0,this.showInitialOverlay=!0,this.wrapperPadding=0}wireBeans(t){this.userComponentFactory=t.userComponentFactory,this.rowModel=t.rowModel,this.columnModel=t.columnModel,this.ctrlsService=t.ctrlsService}postConstruct(){this.isClientSide=ls(this.gos);const t=()=>this.updateOverlayVisibility();this.addManagedEventListeners({newColumnsLoaded:t,rowDataUpdated:t,gridSizeChanged:this.onGridSizeChanged.bind(this),rowCountReady:()=>{this.showInitialOverlay=!1,this.updateOverlayVisibility()}}),this.addManagedPropertyListener("loading",t)}setOverlayWrapperComp(t){this.overlayWrapperComp=t,this.updateOverlayVisibility()}isVisible(){return this.state!==0&&!!this.overlayWrapperComp}isExclusive(){return this.state===1&&!!this.overlayWrapperComp}getOverlayWrapper(){return this.overlayWrapperComp}showLoadingOverlay(){this.showInitialOverlay=!1;const t=this.gos.get("loading");!t&&(t!==void 0||this.gos.get("suppressLoadingOverlay"))||this.doShowLoadingOverlay()}showNoRowsOverlay(){this.showInitialOverlay=!1,!(this.gos.get("loading")||this.gos.get("suppressNoRowsOverlay"))&&this.doShowNoRowsOverlay()}hideOverlay(){if(this.showInitialOverlay=!1,this.gos.get("loading")){Wt("Since v32, `api.hideOverlay()` does not hide the loading overlay when `loading=true`. Set `loading=false` instead.");return}this.doHideOverlay()}updateOverlayVisibility(){if(!this.overlayWrapperComp){this.state=0;return}let t=this.gos.get("loading");this.showInitialOverlay&&t===void 0&&!this.gos.get("suppressLoadingOverlay")&&(t=!this.gos.get("columnDefs")||!this.columnModel.isReady()||!this.gos.get("rowData")&&this.isClientSide),t?this.state!==1&&this.doShowLoadingOverlay():(this.showInitialOverlay=!1,this.rowModel.isEmpty()&&!this.gos.get("suppressNoRowsOverlay")&&this.isClientSide?this.state!==2&&this.doShowNoRowsOverlay():this.state!==0&&this.doHideOverlay())}doShowLoadingOverlay(){this.overlayWrapperComp&&(this.state=1,this.showOverlay(this.userComponentFactory.getLoadingOverlayCompDetails({}),"ag-overlay-loading-wrapper","loadingOverlayComponentParams"),this.updateExclusive())}doShowNoRowsOverlay(){this.overlayWrapperComp&&(this.state=2,this.showOverlay(this.userComponentFactory.getNoRowsOverlayCompDetails({}),"ag-overlay-no-rows-wrapper","noRowsOverlayComponentParams"),this.updateExclusive())}doHideOverlay(){this.overlayWrapperComp&&(this.state=0,this.overlayWrapperComp.hideOverlay(),this.updateExclusive())}showOverlay(t,e,i){const n=t.newAgStackInstance();this.overlayWrapperComp?.showOverlay(n,e,this.isExclusive(),i),this.refreshWrapperPadding()}updateExclusive(){const t=this.exclusive;this.exclusive=this.isExclusive(),this.exclusive!==t&&this.eventService.dispatchEvent({type:"overlayExclusiveChanged"})}onGridSizeChanged(){this.refreshWrapperPadding()}refreshWrapperPadding(){if(!this.overlayWrapperComp)return;let t=0;this.state===2?t=this.ctrlsService.get("gridHeaderCtrl")?.getHeaderHeight()||0:this.wrapperPadding!==0&&(t=0),this.wrapperPadding!==t&&(this.wrapperPadding=t,this.overlayWrapperComp.updateOverlayWrapperPaddingTop(t))}},PTe=class extends kt{constructor(){super(...arguments),this.beanName="rowCssClassCalculator"}wireBeans(t){this.stylingService=t.stylingService}getInitialRowClasses(t){const e=[];return oi(t.extraCssClass)&&e.push(t.extraCssClass),e.push("ag-row"),e.push(t.rowFocused?"ag-row-focus":"ag-row-no-focus"),t.fadeRowIn&&e.push("ag-opacity-zero"),e.push(t.rowIsEven?"ag-row-even":"ag-row-odd"),t.rowNode.isRowPinned()&&e.push("ag-row-pinned"),t.rowNode.isSelected()&&e.push("ag-row-selected"),t.rowNode.footer&&e.push("ag-row-footer"),e.push("ag-row-level-"+t.rowLevel),t.rowNode.stub&&e.push("ag-row-loading"),t.fullWidthRow&&e.push("ag-full-width-row"),t.expandable&&(e.push("ag-row-group"),e.push(t.rowNode.expanded?"ag-row-group-expanded":"ag-row-group-contracted")),t.rowNode.dragging&&e.push("ag-row-dragging"),i6(e,this.processClassesFromGridOptions(t.rowNode)),i6(e,this.preProcessRowClassRules(t.rowNode)),e.push(t.printLayout?"ag-row-position-relative":"ag-row-position-absolute"),t.firstRowOnPage&&e.push("ag-row-first"),t.lastRowOnPage&&e.push("ag-row-last"),t.fullWidthRow&&(t.pinned==="left"&&e.push("ag-cell-last-left-pinned"),t.pinned==="right"&&e.push("ag-cell-first-right-pinned")),e}processClassesFromGridOptions(t){const e=[],i=s=>{typeof s=="string"?e.push(s):Array.isArray(s)&&s.forEach(o=>e.push(o))},n=this.gos.get("rowClass");if(n){if(typeof n=="function")return Wt("rowClass should not be a function, please use getRowClass instead"),[];i(n)}const r=this.gos.getCallback("getRowClass");if(r){const s={data:t.data,node:t,rowIndex:t.rowIndex},o=r(s);i(o)}return e}preProcessRowClassRules(t){const e=[];return this.processRowClassRules(t,i=>{e.push(i)},()=>{}),e}processRowClassRules(t,e,i){const n=this.gos.addGridCommonParams({data:t.data,node:t,rowIndex:t.rowIndex});this.stylingService.processClassRules(void 0,this.gos.get("rowClassRules"),n,e,i)}calculateRowLevel(t){return t.group?t.level:t.parent?t.parent.level+1:0}},ETe=class extends kt{constructor(){super(...arguments),this.beanName="rowContainerHeightService",this.scrollY=0,this.uiBodyHeight=0}wireBeans(t){this.ctrlsService=t.ctrlsService}postConstruct(){this.addManagedEventListeners({bodyHeightChanged:this.updateOffset.bind(this)}),this.maxDivHeight=Bxe(),this.gos.get("debug")&&Ic("RowContainerHeightService - maxDivHeight = "+this.maxDivHeight)}isStretching(){return this.stretching}getDivStretchOffset(){return this.divStretchOffset}updateOffset(){if(!this.stretching)return;const e=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition().top,i=this.getUiBodyHeight();(e!==this.scrollY||i!==this.uiBodyHeight)&&(this.scrollY=e,this.uiBodyHeight=i,this.calculateOffset())}calculateOffset(){this.setUiContainerHeight(this.maxDivHeight),this.pixelsToShave=this.modelHeight-this.uiContainerHeight,this.maxScrollY=this.uiContainerHeight-this.uiBodyHeight;const t=this.scrollY/this.maxScrollY,e=t*this.pixelsToShave;this.gos.get("debug")&&Ic(`RowContainerHeightService - Div Stretch Offset = ${e} (${this.pixelsToShave} * ${t})`),this.setDivStretchOffset(e)}setUiContainerHeight(t){t!==this.uiContainerHeight&&(this.uiContainerHeight=t,this.eventService.dispatchEvent({type:"rowContainerHeightChanged"}))}clearOffset(){this.setUiContainerHeight(this.modelHeight),this.pixelsToShave=0,this.setDivStretchOffset(0)}setDivStretchOffset(t){const e=typeof t=="number"?Math.floor(t):null;this.divStretchOffset!==e&&(this.divStretchOffset=e,this.eventService.dispatchEvent({type:"heightScaleChanged"}))}setModelHeight(t){this.modelHeight=t,this.stretching=t!=null&&this.maxDivHeight>0&&t>this.maxDivHeight,this.stretching?this.calculateOffset():this.clearOffset()}getUiContainerHeight(){return this.uiContainerHeight}getRealPixelPosition(t){return t-this.divStretchOffset}getUiBodyHeight(){const e=this.ctrlsService.getGridBodyCtrl().getScrollFeature().getVScrollPosition();return e.bottom-e.top}getScrollPositionForPixel(t){if(this.pixelsToShave<=0)return t;const e=this.modelHeight-this.getUiBodyHeight(),i=t/e;return this.maxScrollY*i}},ATe=class extends kt{constructor(){super(...arguments),this.beanName="rowNodeSorter"}wireBeans(t){this.valueService=t.valueService,this.columnModel=t.columnModel,this.showRowGroupColsService=t.showRowGroupColsService}postConstruct(){this.isAccentedSort=this.gos.get("accentedSort"),this.primaryColumnsSortGroups=ah(this.gos),this.addManagedPropertyListener("accentedSort",t=>this.isAccentedSort=t.currentValue),this.addManagedPropertyListener("autoGroupColumnDef",()=>this.primaryColumnsSortGroups=ah(this.gos))}doFullSort(t,e){const i=(r,s)=>({currentPos:s,rowNode:r}),n=t.map(i);return n.sort(this.compareRowNodes.bind(this,e)),n.map(r=>r.rowNode)}compareRowNodes(t,e,i){const n=e.rowNode,r=i.rowNode;for(let s=0,o=t.length;s<o;s++){const a=t[s],l=a.sort==="desc",u=this.getValue(n,a.column),d=this.getValue(r,a.column);let p;const v=this.getComparator(a,n);if(v?p=v(u,d,n,r,l):p=F0e(u,d,this.isAccentedSort),!isNaN(p)&&p!==0)return a.sort==="asc"?p:p*-1}return e.currentPos-i.currentPos}getComparator(t,e){const i=t.column,n=i.getColDef().comparator;if(n!=null)return n;if(!i.getColDef().showRowGroup)return;const r=!e.group&&i.getColDef().field;if(!r)return;const s=this.columnModel.getColDefCol(r);if(s)return s.getColDef().comparator}getValue(t,e){if(!this.primaryColumnsSortGroups)return this.valueService.getValue(e,t,!1,!1);if(t.rowGroupColumn===e){if(yP(this.gos,this.columnModel.isPivotActive())){const s=t.allLeafChildren?.[0];return s?this.valueService.getValue(e,s,!1,!1):void 0}const r=this.showRowGroupColsService?.getShowRowGroupCol(e.getId());return r?t.groupData?.[r.getId()]:void 0}if(!(t.group&&e.getColDef().showRowGroup))return this.valueService.getValue(e,t,!1,!1)}},SP=class{constructor(t,e){this.active=!0,this.nodeIdsToColumns={},this.mapToItems={},this.keepingColumns=t,this.pathRoot={rowNode:e,children:null},this.mapToItems[e.id]=this.pathRoot}setInactive(){this.active=!1}isActive(){return this.active}depthFirstSearchChangedPath(t,e){if(t.children)for(let i=0;i<t.children.length;i++)this.depthFirstSearchChangedPath(t.children[i],e);e(t.rowNode)}depthFirstSearchEverything(t,e,i){if(t.childrenAfterGroup)for(let n=0;n<t.childrenAfterGroup.length;n++){const r=t.childrenAfterGroup[n];r.childrenAfterGroup?this.depthFirstSearchEverything(t.childrenAfterGroup[n],e,i):i&&e(r)}e(t)}forEachChangedNodeDepthFirst(t,e=!1,i=!1){this.active&&!i?this.depthFirstSearchChangedPath(this.pathRoot,t):this.depthFirstSearchEverything(this.pathRoot.rowNode,t,e)}executeFromRootNode(t){t(this.pathRoot.rowNode)}createPathItems(t){let e=t,i=0;for(;!this.mapToItems[e.id];){const n={rowNode:e,children:null};this.mapToItems[e.id]=n,i++,e=e.parent}return i}populateColumnsMap(t,e){if(!this.keepingColumns||!e)return;let i=t;for(;i;)this.nodeIdsToColumns[i.id]||(this.nodeIdsToColumns[i.id]={}),e.forEach(n=>this.nodeIdsToColumns[i.id][n.getId()]=!0),i=i.parent}linkPathItems(t,e){let i=t;for(let n=0;n<e;n++){const r=this.mapToItems[i.id],s=this.mapToItems[i.parent.id];s.children||(s.children=[]),s.children.push(r),i=i.parent}}addParentNode(t,e){if(!t||t.isRowPinned())return;const i=this.createPathItems(t);this.linkPathItems(t,i),this.populateColumnsMap(t,e)}canSkip(t){return this.active&&!this.mapToItems[t.id]}getValueColumnsForNode(t,e){if(!this.keepingColumns)return e;const i=this.nodeIdsToColumns[t.id];return e.filter(r=>i[r.getId()])}getNotValueColumnsForNode(t,e){if(!this.keepingColumns)return null;const i=this.nodeIdsToColumns[t.id];return e.filter(r=>!i[r.getId()])}},eee=class extends kt{constructor(){super(...arguments),this.beanName="selectionService",this.selectedNodes=new Map,this.selectionCtx=new kSe,this.rowSelectionMode=void 0}wireBeans(t){this.rowModel=t.rowModel,this.pageBoundsService=t.pageBoundsService}postConstruct(){const{gos:t,rowModel:e,onRowSelected:i}=this;this.selectionCtx.init(e),this.rowSelectionMode=ST(t),this.groupSelectsChildren=Lg(t),this.addManagedPropertyListeners(["groupSelectsChildren","rowSelection"],()=>{const n=Lg(t),r=ST(t);(n!==this.groupSelectsChildren||r!==this.rowSelectionMode)&&(this.groupSelectsChildren=n,this.rowSelectionMode=r,this.deselectAllRowNodes({source:"api"}))}),this.addManagedEventListeners({rowSelected:i.bind(this)})}destroy(){super.destroy(),this.resetNodes(),this.selectionCtx.reset()}isMultiSelect(){return this.rowSelectionMode==="multiRow"}overrideSelectionValue(t,e){if(!gTe(e))return t;const i=this.selectionCtx.getRoot();return i?i.isSelected()??!1:!0}setNodesSelected(t){const{newValue:e,clearSelection:i,suppressFinishActions:n,rangeSelect:r,nodes:s,event:o,source:a}=t;if(s.length===0)return 0;if(s.length>1&&!this.isMultiSelect())return Wt("cannot multi select unless selection mode is 'multiRow'"),0;const l=this.groupSelectsChildren&&t.groupSelectsFiltered===!0,u=s.map(p=>p.footer?p.sibling:p);if(r){if(u.length>1)return Wt("cannot range select while selecting multiple rows"),0;const p=u[0],v=this.overrideSelectionValue(e,a);if(this.isMultiSelect()){if(this.selectionCtx.isInRange(p)){const y=this.selectionCtx.truncate(p);return v&&this.selectRange(y.discard,!1,a),this.selectRange(y.keep,v,a)}else if(this.selectionCtx.getRoot()!==p){const R=this.selectionCtx.extend(p,this.groupSelectsChildren);return v&&this.selectRange(R.discard,!1,a),this.selectRange(R.keep,v,a)}}}n||this.selectionCtx.setRoot(u[0]);let d=0;for(let p=0;p<u.length;p++){const v=u[p];l&&v.group||v.selectThisNode(e,o,a)&&d++,this.groupSelectsChildren&&v.childrenAfterGroup?.length&&(d+=this.selectChildren(v,e,l,a))}return n||(e&&(i||!this.isMultiSelect())&&(d+=this.clearOtherNodes(u[0],a)),d>0&&(this.updateGroupsFromChildrenSelections(a),this.dispatchSelectionChanged(a))),d}selectRange(t,e,i){let n=0;return t.forEach(r=>{if(r.group&&this.groupSelectsChildren)return;r.selectThisNode(e,void 0,i)&&n++}),n>0&&(this.updateGroupsFromChildrenSelections(i),this.dispatchSelectionChanged(i)),n}selectChildren(t,e,i,n){const r=i?t.childrenAfterAggFilter:t.childrenAfterGroup;return Wn(r)?0:this.setNodesSelected({newValue:e,clearSelection:!1,suppressFinishActions:!0,groupSelectsFiltered:i,source:n,nodes:r})}getSelectedNodes(){const t=[];return this.selectedNodes.forEach(e=>{e&&t.push(e)}),t}getSelectedRows(){const t=[];return this.selectedNodes.forEach(e=>{e&&e.data&&t.push(e.data)}),t}getSelectionCount(){return this.selectedNodes.size}filterFromSelection(t){const e=new Map;this.selectedNodes.forEach((i,n)=>{i&&t(i)&&e.set(n,i)}),this.selectedNodes=e}updateGroupsFromChildrenSelections(t,e){if(!this.groupSelectsChildren||!ls(this.gos))return!1;const n=this.rowModel.getRootNode();e||(e=new SP(!0,n),e.setInactive());let r=!1;return e.forEachChangedNodeDepthFirst(s=>{if(s!==n){const o=s.calculateSelectedFromChildren();r=s.selectThisNode(o===null?!1:o,void 0,t)||r}}),r}clearOtherNodes(t,e){const i=new Map;let n=0;return this.selectedNodes.forEach(r=>{if(r&&r.id!==t.id){const s=this.selectedNodes.get(r.id);n+=s.setSelectedParams({newValue:!1,clearSelection:!1,suppressFinishActions:!0,source:e}),this.groupSelectsChildren&&r.parent&&i.set(r.parent.id,r.parent)}}),i.forEach(r=>{const s=r.calculateSelectedFromChildren();r.selectThisNode(s===null?!1:s,void 0,e)}),n}onRowSelected(t){const e=t.node;this.groupSelectsChildren&&e.group||(e.isSelected()?this.selectedNodes.set(e.id,e):this.selectedNodes.delete(e.id))}syncInRowNode(t,e){this.syncInOldRowNode(t,e),this.syncInNewRowNode(t)}syncInOldRowNode(t,e){if(oi(e)&&t.id!==e.id&&e){const n=e.id;this.selectedNodes.get(n)==t&&this.selectedNodes.set(e.id,e)}}syncInNewRowNode(t){this.selectedNodes.has(t.id)?(t.setSelectedInitialValue(!0),this.selectedNodes.set(t.id,t)):t.setSelectedInitialValue(!1)}reset(t){const e=this.getSelectionCount();this.resetNodes(),e&&this.dispatchSelectionChanged(t)}resetNodes(){this.selectedNodes?.clear()}getBestCostNodeSelection(){if(!ls(this.gos))return;const e=this.rowModel.getTopLevelNodes();if(e===null)return;const i=[];function n(r){for(let s=0,o=r.length;s<o;s++){const a=r[s];if(a.isSelected())i.push(a);else{const l=a;l.group&&l.children&&n(l.children)}}}return n(e),i}isEmpty(){let t=0;return this.selectedNodes.forEach(e=>{e&&t++}),t===0}deselectAllRowNodes(t){const e=o=>o.selectThisNode(!1,void 0,n),i=ls(this.gos),{source:n,justFiltered:r,justCurrentPage:s}=t;if(s||r){if(!i){ar("selecting just filtered only works when gridOptions.rowModelType='clientSide'");return}this.getNodesToSelect(r,s).forEach(e)}else this.selectedNodes.forEach(o=>{o&&e(o)}),this.reset(n);this.selectionCtx.reset(),i&&this.groupSelectsChildren&&this.updateGroupsFromChildrenSelections(n),this.dispatchSelectionChanged(n)}getSelectedCounts(t,e){let i=0,n=0;const r=s=>{this.groupSelectsChildren&&s.group||(s.isSelected()?i++:s.selectable&&n++)};return this.getNodesToSelect(t,e).forEach(r),{selectedCount:i,notSelectedCount:n}}getSelectAllState(t,e){const{selectedCount:i,notSelectedCount:n}=this.getSelectedCounts(t,e);return i===0&&n===0?!1:i>0&&n>0?null:i>0}hasNodesToSelect(t=!1,e=!1){return this.getNodesToSelect(t,e).filter(i=>i.selectable).length>0}getNodesToSelect(t=!1,e=!1){this.validateSelectAllType();const i=[];if(e)return this.forEachNodeOnPage(r=>{if(!r.group){i.push(r);return}if(!r.expanded){const s=o=>{i.push(o),o.childrenAfterFilter?.length&&o.childrenAfterFilter.forEach(s)};s(r);return}this.groupSelectsChildren||i.push(r)}),i;const n=this.rowModel;return t?(n.forEachNodeAfterFilter(r=>{i.push(r)}),i):(n.forEachNode(r=>{i.push(r)}),i)}forEachNodeOnPage(t){const e=this.pageBoundsService.getFirstRow(),i=this.pageBoundsService.getLastRow();for(let n=e;n<=i;n++){const r=this.rowModel.getRow(n);r&&t(r)}}selectAllRowNodes(t){if(V0e(this.gos)&&!eU(this.gos))return Wt("cannot multi select unless selection mode is 'multiRow'");this.validateSelectAllType();const{source:e,justFiltered:i,justCurrentPage:n}=t,r=this.getNodesToSelect(i,n);r.forEach(s=>s.selectThisNode(!0,void 0,e)),this.selectionCtx.setRoot(r[0]??null),this.selectionCtx.setEndRange(Yn(r)??null),ls(this.gos)&&this.groupSelectsChildren&&this.updateGroupsFromChildrenSelections(e),this.dispatchSelectionChanged(e)}getSelectionState(){const t=[];return this.selectedNodes.forEach(e=>{e?.id&&t.push(e.id)}),t.length?t:null}setSelectionState(t,e){if(!Array.isArray(t))return ar("Invalid selection state. When using client-side row model, the state must conform to `string[]`.");const i=new Set(t),n=[];this.rowModel.forEachNode(r=>{i.has(r.id)&&n.push(r)}),this.setNodesSelected({newValue:!0,nodes:n,source:e})}dispatchSelectionChanged(t){this.eventService.dispatchEvent({type:"selectionChanged",source:t})}validateSelectAllType(){if(!ls(this.gos))throw new Error(`selectAll only available when rowModelType='clientSide', ie not ${this.rowModel.getType()}`)}},ITe=class extends kt{constructor(){super(...arguments),this.beanName="selectableService"}wireBeans(t){this.rowModel=t.rowModel,this.selectionService=t.selectionService}postConstruct(){this.addManagedPropertyListeners(["isRowSelectable","rowSelection"],()=>this.updateSelectable())}updateSelectableAfterGrouping(){this.updateSelectable(!0)}updateSelectable(t=!1){const{gos:e}=this,i=wT(e),n=JG(e);if(!i||!n)return;const r=Lg(e),s=ls(e)&&r,o=[],a=l=>{if(t&&!l.group)return;if(s&&l.group){const d=l.childrenAfterGroup.some(p=>p.selectable===!0);l.setRowSelectable(d,!0);return}const u=n?.(l)??!0;l.setRowSelectable(u,!0),!u&&l.isSelected()&&o.push(l)};if(s){const l=this.rowModel;new SP(!1,l.getRootNode()).forEachChangedNodeDepthFirst(a,!0,!0)}else this.rowModel.forEachNode(a);o.length&&this.selectionService.setNodesSelected({nodes:o,newValue:!1,source:"selectableChanged"}),s&&this.selectionService instanceof eee&&this.selectionService.updateGroupsFromChildrenSelections("selectableChanged")}},S6=["asc","desc",null],kTe=class extends kt{constructor(){super(...arguments),this.beanName="sortController"}wireBeans(t){this.columnModel=t.columnModel,this.funcColsService=t.funcColsService,this.showRowGroupColsService=t.showRowGroupColsService}progressSort(t,e,i){const n=this.getNextSortDirection(t);this.setSortForColumn(t,n,e,i)}setSortForColumn(t,e,i,n){e!=="asc"&&e!=="desc"&&(e=null);const r=ah(this.gos);let s=[t];if(r&&t.getColDef().showRowGroup){const u=this.funcColsService.getSourceColumnsForGroupColumn(t)?.filter(d=>d.isSortable());u&&(s=[t,...u])}s.forEach(l=>l.setSort(e,n));const o=(i||this.gos.get("alwaysMultiSort"))&&!this.gos.get("suppressMultiSort"),a=[];if(!o){const l=this.clearSortBarTheseColumns(s,n);a.push(...l)}this.updateSortIndex(t),a.push(...s),this.dispatchSortChangedEvents(n,a)}updateSortIndex(t){const e=ah(this.gos),i=this.showRowGroupColsService?.getShowRowGroupCol(t.getId()),n=e&&i||t,r=this.getColumnsWithSortingOrdered();this.columnModel.getAllCols().forEach(a=>a.setSortIndex(null));const s=r.filter(a=>e&&a.getColDef().showRowGroup?!1:a!==n);(n.getSort()?[...s,n]:s).forEach((a,l)=>{a.setSortIndex(l)})}onSortChanged(t,e){this.dispatchSortChangedEvents(t,e)}isSortActive(){const e=this.columnModel.getAllCols().filter(i=>!!i.getSort());return e&&e.length>0}dispatchSortChangedEvents(t,e){const i={type:"sortChanged",source:t};e&&(i.columns=e),this.eventService.dispatchEvent(i)}clearSortBarTheseColumns(t,e){const i=[];return this.columnModel.getAllCols().forEach(n=>{t.includes(n)||(n.getSort()&&i.push(n),n.setSort(void 0,e))}),i}getNextSortDirection(t){let e;if(t.getColDef().sortingOrder?e=t.getColDef().sortingOrder:this.gos.get("sortingOrder")?e=this.gos.get("sortingOrder"):e=S6,!Array.isArray(e)||e.length<=0)return Wt(`sortingOrder must be an array with at least one element, currently it's ${e}`),null;const i=e.indexOf(t.getSort()),n=i<0,r=i==e.length-1;let s;return n||r?s=e[0]:s=e[i+1],S6.indexOf(s)<0?(Wt("invalid sort type ",s),null):s}getIndexedSortMap(){let t=this.columnModel.getAllCols().filter(s=>!!s.getSort());if(this.columnModel.isPivotMode()){const s=ah(this.gos);t=t.filter(o=>{const a=!!o.getAggFunc(),l=!o.isPrimary(),u=s?this.showRowGroupColsService?.getShowRowGroupCol(o.getId()):o.getColDef().showRowGroup;return a||l||u})}const e=this.funcColsService.getRowGroupColumns().filter(s=>!!s.getSort()),i={};t.forEach((s,o)=>i[s.getId()]=o),t.sort((s,o)=>{const a=s.getSortIndex(),l=o.getSortIndex();if(a!=null&&l!=null)return a-l;if(a==null&&l==null){const u=i[s.getId()],d=i[o.getId()];return u>d?1:-1}else return l==null?-1:1});const n=ah(this.gos)&&!!e.length;n&&(t=[...new Set(t.map(s=>this.showRowGroupColsService?.getShowRowGroupCol(s.getId())??s))]);const r=new Map;return t.forEach((s,o)=>r.set(s,o)),n&&e.forEach(s=>{const o=this.showRowGroupColsService.getShowRowGroupCol(s.getId());r.set(s,r.get(o))}),r}getColumnsWithSortingOrdered(){return[...this.getIndexedSortMap().entries()].sort(([t,e],[i,n])=>e-n).map(([t])=>t)}getSortModel(){return this.getColumnsWithSortingOrdered().filter(t=>t.getSort()).map(t=>({sort:t.getSort(),colId:t.getId()}))}getSortOptions(){return this.getColumnsWithSortingOrdered().filter(t=>t.getSort()).map(t=>({sort:t.getSort(),column:t}))}canColumnDisplayMixedSort(t){const e=ah(this.gos),i=!!t.getColDef().showRowGroup;return e&&i}getDisplaySortForColumn(t){const e=this.funcColsService.getSourceColumnsForGroupColumn(t);if(!this.canColumnDisplayMixedSort(t)||!e?.length)return t.getSort();const n=t.getColDef().field!=null||!!t.getColDef().valueGetter?[t,...e]:e,r=n[0].getSort();return n.every(o=>o.getSort()==r)?r:"mixed"}getDisplaySortIndexForColumn(t){return this.getIndexedSortMap().get(t)}},DTe=class extends kt{constructor(){super(...arguments),this.beanName="syncService",this.waitingForColumns=!1}wireBeans(t){this.ctrlsService=t.ctrlsService,this.columnModel=t.columnModel,this.rowModel=t.rowModel}postConstruct(){this.addManagedPropertyListener("columnDefs",t=>this.setColumnDefs(t))}start(){this.ctrlsService.whenReady(this,()=>{const t=this.gos.get("columnDefs");t?this.setColumnsAndData(t):this.waitingForColumns=!0,this.gridReady()})}setColumnsAndData(t){this.columnModel.setColumnDefs(t??[],"gridInitializing"),this.rowModel.start()}gridReady(){this.eventService.dispatchEvent({type:"gridReady"});const t=this.gos.isModuleRegistered("@ag-grid-enterprise/core");this.gos.get("debug")&&Ic(`initialised successfully, enterprise = ${t}`)}setColumnDefs(t){const e=this.gos.get("columnDefs");if(e){if(this.waitingForColumns){this.waitingForColumns=!1,this.setColumnsAndData(e);return}this.columnModel.setColumnDefs(e,Wm(t.source))}}},LTe="paste",FTe=class extends kt{constructor(){super(...arguments),this.beanName="changeDetectionService"}wireBeans(t){this.rowModel=t.rowModel,this.rowRenderer=t.rowRenderer}postConstruct(){ls(this.gos)&&(this.clientSideRowModel=this.rowModel),this.addManagedEventListeners({cellValueChanged:this.onCellValueChanged.bind(this)})}onCellValueChanged(t){t.source!==LTe&&this.doChangeDetection(t.node,t.column)}doChangeDetection(t,e){if(this.gos.get("suppressChangeDetection"))return;const i=[t];if(this.clientSideRowModel&&!t.isRowPinned()){const n=this.gos.get("aggregateOnlyChangedColumns"),r=new SP(n,this.clientSideRowModel.getRootNode());r.addParentNode(t.parent,[e]),this.clientSideRowModel.doAggregate(r),r.forEachChangedNodeDepthFirst(s=>{i.push(s)})}this.rowRenderer.refreshCells({rowNodes:i})}},NTe=class extends kt{constructor(){super(...arguments),this.beanName="expressionService",this.expressionToFunctionCache={}}evaluate(t,e){if(typeof t=="string")return this.evaluateExpression(t,e);ar("value should be either a string or a function",t)}evaluateExpression(t,e){try{return this.createExpressionFunction(t)(e.value,e.context,e.oldValue,e.newValue,e.value,e.node,e.data,e.colDef,e.rowIndex,e.api,e.getValue,e.column,e.columnGroup)}catch(i){return Ic("Processing of the expression failed"),Ic("Expression = ",t),Ic("Params = ",e),Ic("Exception = ",i),null}}createExpressionFunction(t){if(this.expressionToFunctionCache[t])return this.expressionToFunctionCache[t];const e=this.createFunctionBody(t),i=new Function("x, ctx, oldValue, newValue, value, node, data, colDef, rowIndex, api, getValue, column, columnGroup",e);return this.expressionToFunctionCache[t]=i,i}createFunctionBody(t){return t.indexOf("return")>=0?t:"return "+t+";"}},BTe=class extends kt{constructor(){super(...arguments),this.beanName="valueCache",this.cacheVersion=0}postConstruct(){this.active=this.gos.get("valueCache"),this.neverExpires=this.gos.get("valueCacheNeverExpires")}onDataChanged(){this.neverExpires||this.expire()}expire(){this.cacheVersion++}setValue(t,e,i){this.active&&(t.__cacheVersion!==this.cacheVersion&&(t.__cacheVersion=this.cacheVersion,t.__cacheData={}),t.__cacheData[e]=i)}getValue(t,e){if(!(!this.active||t.__cacheVersion!==this.cacheVersion))return t.__cacheData[e]}},zTe=class extends kt{constructor(){super(...arguments),this.beanName="valueService",this.initialised=!1,this.isSsrm=!1}wireBeans(t){this.expressionService=t.expressionService,this.columnModel=t.columnModel,this.valueCache=t.valueCache,this.dataTypeService=t.dataTypeService}postConstruct(){this.initialised||this.init()}init(){this.isSsrm=tf(this.gos),this.cellExpressions=this.gos.get("enableCellExpressions"),this.isTreeData=this.gos.get("treeData"),this.initialised=!0;const t=i=>this.callColumnCellValueChangedHandler(i),e=_T(this.gos);this.eventService.addEventListener("cellValueChanged",t,e),this.addDestroyFunc(()=>this.eventService.removeEventListener("cellValueChanged",t,e)),this.addManagedPropertyListener("treeData",i=>this.isTreeData=i.currentValue)}getValueForDisplay(t,e){const i=e.leafGroup&&this.columnModel.isPivotMode(),n=e.group&&e.expanded&&!e.footer&&!i,r=this.gos.get("groupSuppressBlankHeader");if(!n||r)return this.getValue(t,e);let s=!1;const o=this.gos.get("groupTotalRow")??this.gos.get("groupIncludeFooter");typeof o!="function"?s=!!o:s=!!(this.gos.getCallback("groupTotalRow")??this.gos.getCallback("groupIncludeFooter"))({node:this});const a=n&&s;return this.getValue(t,e,!1,a)}getValue(t,e,i=!1,n=!1){if(this.initialised||this.init(),!e)return;const r=t.getColDef(),s=r.field,o=t.getColId(),a=e.data;let l;const u=e.groupData&&e.groupData[o]!==void 0,d=!n&&e.aggData&&e.aggData[o]!==void 0,p=this.isSsrm&&n&&!!t.getColDef().aggFunc,v=this.isSsrm&&e.footer&&e.field&&(t.getColDef().showRowGroup===!0||t.getColDef().showRowGroup===e.field);if(i&&r.filterValueGetter?l=this.executeFilterValueGetter(r.filterValueGetter,a,t,e):this.isTreeData&&d?l=e.aggData[o]:this.isTreeData&&r.valueGetter?l=this.executeValueGetter(r.valueGetter,a,t,e):this.isTreeData&&s&&a?l=qw(a,s,t.isFieldContainsDots()):u?l=e.groupData[o]:d?l=e.aggData[o]:r.valueGetter?l=this.executeValueGetter(r.valueGetter,a,t,e):v?l=qw(a,e.field,t.isFieldContainsDots()):s&&a&&!p&&(l=qw(a,s,t.isFieldContainsDots())),this.cellExpressions&&typeof l=="string"&&l.indexOf("=")===0){const y=l.substring(1);l=this.executeValueGetter(y,a,t,e)}if(l==null){const y=this.getOpenedGroup(e,t);if(y!=null)return y}return l}parseValue(t,e,i,n){const r=t.getColDef(),s=r.valueParser;if(oi(s)){const o=this.gos.addGridCommonParams({node:e,data:e?.data,oldValue:n,newValue:i,colDef:r,column:t});return typeof s=="function"?s(o):this.expressionService.evaluate(s,o)}return i}getDeleteValue(t,e){return oi(t.getColDef().valueParser)?this.parseValue(t,e,"",this.getValueForDisplay(t,e))??null:null}formatValue(t,e,i,n,r=!0){let s=null,o;const a=t.getColDef();if(n?o=n:r&&(o=a.valueFormatter),o){const l=this.gos.addGridCommonParams({value:i,node:e,data:e?e.data:null,colDef:a,column:t});typeof o=="function"?s=o(l):s=this.expressionService.evaluate(o,l)}else if(a.refData)return a.refData[i]||"";return s==null&&Array.isArray(i)&&(s=i.join(", ")),s}getOpenedGroup(t,e){if(!this.gos.get("showOpenedGroup")||!e.getColDef().showRowGroup)return;const n=e.getColDef().showRowGroup;let r=t.parent;for(;r!=null;){if(r.rowGroupColumn&&(n===!0||n===r.rowGroupColumn.getColId()))return r.key;r=r.parent}}setValue(t,e,i,n){const r=this.columnModel.getColDefCol(e);if(!t||!r)return!1;Wn(t.data)&&(t.data={});const{field:s,valueSetter:o}=r.getColDef();if(Wn(s)&&Wn(o))return Wt("you need either field or valueSetter set on colDef for editing to work"),!1;if(this.dataTypeService&&!this.dataTypeService.checkType(r,i))return Wt("Data type of the new value does not match the cell data type of the column"),!1;const a=this.gos.addGridCommonParams({node:t,data:t.data,oldValue:this.getValue(r,t),newValue:i,colDef:r.getColDef(),column:r});a.newValue=i;let l;if(oi(o)?typeof o=="function"?l=o(a):l=this.expressionService.evaluate(o,a):l=this.setValueUsingField(t.data,s,i,r.isFieldContainsDots()),l===void 0&&(l=!0),!l)return!1;t.resetQuickFilterAggregateText(),this.valueCache.onDataChanged();const u=this.getValue(r,t);return this.eventService.dispatchEvent({type:"cellValueChanged",event:null,rowIndex:t.rowIndex,rowPinned:t.rowPinned,column:a.column,colDef:a.colDef,data:t.data,node:t,oldValue:a.oldValue,newValue:u,value:u,source:n}),!0}callColumnCellValueChangedHandler(t){const e=t.colDef.onCellValueChanged;typeof e=="function"&&this.getFrameworkOverrides().wrapOutgoing(()=>{e({node:t.node,data:t.data,oldValue:t.oldValue,newValue:t.newValue,colDef:t.colDef,column:t.column,api:t.api,context:t.context})})}setValueUsingField(t,e,i,n){if(!e)return!1;let r=!1;if(!n)r=t[e]===i,r||(t[e]=i);else{const s=e.split(".");let o=t;for(;s.length>0&&o;){const a=s.shift();s.length===0?(r=o[a]===i,r||(o[a]=i)):o=o[a]}}return!r}executeFilterValueGetter(t,e,i,n){const r=this.gos.addGridCommonParams({data:e,node:n,column:i,colDef:i.getColDef(),getValue:this.getValueCallback.bind(this,n)});return typeof t=="function"?t(r):this.expressionService.evaluate(t,r)}executeValueGetter(t,e,i,n){const r=i.getColId(),s=this.valueCache.getValue(n,r);if(s!==void 0)return s;const o=this.gos.addGridCommonParams({data:e,node:n,column:i,colDef:i.getColDef(),getValue:this.getValueCallback.bind(this,n)});let a;return typeof t=="function"?a=t(o):a=this.expressionService.evaluate(t,o),this.valueCache.setValue(n,r,a),a}getValueCallback(t,e){const i=this.columnModel.getColDefCol(e);return i?this.getValue(i,t):null}getKeyForNode(t,e){const i=this.getValue(t,e),n=t.getColDef().keyCreator;let r=i;if(n){const s=this.gos.addGridCommonParams({value:i,colDef:t.getColDef(),column:t,node:e,data:e.data});r=n(s)}return typeof r=="string"||r==null||(r=String(r),r==="[object Object]"&&Wt("a column you are grouping or pivoting by has objects as values. If you want to group by complex objects then either a) use a colDef.keyCreator (se AG Grid docs) or b) to toString() on the object to return a key")),r}},EU=class zm{static applyGlobalGridOptions(e){if(!zm.gridOptions)return e;let i={};return ka(i,zm.gridOptions,!0,!0),zm.mergeStrategy==="deep"?ka(i,e,!0,!0):i={...i,...e},zm.gridOptions.context&&(i.context=zm.gridOptions.context),e.context&&(zm.mergeStrategy==="deep"&&i.context&&ka(e.context,i.context,!0,!0),i.context=e.context),i}};EU.gridOptions=void 0;EU.mergeStrategy="shallow";var VTe=EU;function GTe(t,e,i){if(!e)return ar("No gridOptions provided to createGrid"),{};const n=new HTe().create(t,e,r=>{const s=new f1e(t);r.createBean(s)},void 0,i);if(!Object.isFrozen(e)){const r="https://ag-grid.com/javascript-data-grid/grid-interface/#grid-api";Object.defineProperty(e,"api",{get:()=>{ar(`gridOptions.api is no longer supported. See ${r}.`)},configurable:!0})}return n}var UTe=1,HTe=class{create(t,e,i,n,r){const s=VTe.applyGlobalGridOptions(e),o=yTe(s),a=o.gridId??String(UTe++),l=this.getRegisteredModules(r,a),u=this.createBeansList(o.rowModelType,l,a),d=this.createProvidedBeans(t,o,r);if(!u){ar("Failed to create grid.");return}const p={providedBeanInstances:d,beanClasses:u,gridId:a,beanInitComparator:e1e,beanDestroyComparator:t1e,derivedBeans:[WSe]},v=new Bbe(p);return this.registerModuleUserComponents(v,l),this.registerControllers(v,l),this.registerModuleApiFunctions(v,l),i(v),v.getBean("syncService").start(),n&&n(v),v.getBean("gridApi")}registerControllers(t,e){const i=t.getBean("ctrlsFactory");e.forEach(n=>{n.controllers&&n.controllers.forEach(r=>i.register(r))})}getRegisteredModules(t,e){const i=t?t.modules:null,n=bd.__getRegisteredModules(e),r=[],s={},o=(a,l,u)=>{(p=>{s[p.moduleName]||(s[p.moduleName]=!0,r.push(p),bd.__register(p,a,u))})(l),l.dependantModules&&l.dependantModules.forEach(p=>o(a,p,u))};return o(!!i?.length||!bd.__isPackageBased(),XJ,void 0),i&&i.forEach(a=>o(!0,a,e)),n&&n.forEach(a=>o(!bd.__isPackageBased(),a,void 0)),r}registerModuleUserComponents(t,e){const i=this.extractModuleEntity(e,r=>r.userComponents?r.userComponents:[]),n=t.getBean("userComponentRegistry");i.forEach(({name:r,classImp:s,params:o})=>{n.registerDefaultComponent(r,s,o)})}registerModuleApiFunctions(t,e){const i=t.getBean("apiFunctionService");e.forEach(n=>{const r=n.apiFunctions;r&&Object.keys(r).forEach(o=>{i?.addFunction(o,r[o])})})}createProvidedBeans(t,e,i){let n=i?i.frameworkOverrides:null;Wn(n)&&(n=new GSe);const r={gridOptions:e,eGridDiv:t,globalEventListener:i?i.globalEventListener:null,globalSyncEventListener:i?i.globalSyncEventListener:null,frameworkOverrides:n};return i&&i.providedBeanInstances&&Object.assign(r,i.providedBeanInstances),r}createBeansList(t="clientSide",e,i){const n=e.filter(l=>!l.rowModel||l.rowModel===t),r={clientSide:"@ag-grid-community/client-side-row-model",infinite:"@ag-grid-community/infinite-row-model",serverSide:"@ag-grid-enterprise/server-side-row-model",viewport:"@ag-grid-enterprise/viewport-row-model"};if(!r[t]){ar("Could not find row model for rowModelType = ",t);return}if(!bd.__assertRegistered(r[t],`rowModelType = '${t}'`,i))return;const s=[o1e,r1e,bTe,mTe,$Se,ybe,KSe,YSe,BCe,KY,ETe,FCe,wTe,PSe,Ube,xxe,c1e,xTe,zSe,eee,axe,n_e,STe,CTe,TSe,NTe,oxe,LCe,BTe,zTe,OSe,NCe,zbe,u1e,DCe,a1e,USe,DSe,kCe,kTe,TTe,MTe,ITe,FTe,zCe,qSe,PTe,ATe,n1e,h1e,s1e,i1e,DTe,RTe,VCe,_Te,OTe,GCe,uxe,jSe,hxe,lxe,QSe,ZSe,yxe,cxe,gxe,XSe,vxe,txe],o=this.extractModuleEntity(n,l=>l.beans?l.beans:[]);s.push(...o);const a=[];return s.forEach(l=>{a.indexOf(l)<0&&a.push(l)}),a}extractModuleEntity(t,e){return[].concat(...t.map(e))}},tee=class extends kt{constructor(){super(...arguments),this.beanName="rowModelHelperService"}wireBeans(t){this.rowModel=t.rowModel}postConstruct(){const t=this.rowModel;switch(t.getType()){case"clientSide":this.clientSideRowModel=t;break;case"infinite":this.infiniteRowModel=t;break;case"serverSide":this.serverSideRowModel=t;break}}getClientSideRowModel(){return this.clientSideRowModel}getInfiniteRowModel(){return this.infiniteRowModel}getServerSideRowModel(){return this.serverSideRowModel}};function $Te(t){t.expansionService.expandAll(!0)}function WTe(t){t.expansionService.expandAll(!1)}function qTe(t){const e=t.rowModelHelperService?.getClientSideRowModel(),i=t.rowModelHelperService?.getServerSideRowModel();e?e.onRowHeightChanged():i&&i.onRowHeightChanged()}function jTe(t,e,i){const n=t.rowModelHelperService?.getServerSideRowModel();if(n){if(t.funcColsService.isRowGroupEmpty()){n.setRowCount(e,i);return}ar("setRowCount cannot be used while using row grouping.");return}const r=t.rowModelHelperService?.getInfiniteRowModel();if(r){r.setRowCount(e,i);return}}function QTe(t){return t.rowNodeBlockLoader?.getBlockState()??{}}function ZTe(t){return t.rowModel.isLastRowIndexKnown()}var XTe={version:fn,moduleName:"@ag-grid-community/csrm-ssrm-shared-api",apiFunctions:{expandAll:$Te,collapseAll:WTe,onRowHeightChanged:qTe}},KTe={version:fn,moduleName:"@ag-grid-community/ssrm-infinite-shared-api",apiFunctions:{setRowCount:jTe,getCacheBlockState:QTe,isLastRowIndexKnown:ZTe}},sx=typeof global>"u"?{}:global;sx.HTMLElement=typeof HTMLElement>"u"?{}:HTMLElement;sx.HTMLButtonElement=typeof HTMLButtonElement>"u"?{}:HTMLButtonElement;sx.HTMLSelectElement=typeof HTMLSelectElement>"u"?{}:HTMLSelectElement;sx.HTMLInputElement=typeof HTMLInputElement>"u"?{}:HTMLInputElement;sx.Node=typeof Node>"u"?{}:Node;sx.MouseEvent=typeof MouseEvent>"u"?{}:MouseEvent;var YTe="ROOT_NODE_ID",cN=0,JTe=class{constructor(t,e,i,n,r,s){this.nextId=0,this.rowCountReady=!1,this.allNodesMap={},this.rootNode=t,this.gos=e,this.eventService=i,this.funcColsService=n,this.beans=s,this.selectionService=r,this.rootNode.group=!0,this.rootNode.level=-1,this.rootNode.id=YTe,this.rootNode.allLeafChildren=[],this.rootNode.childrenAfterGroup=[],this.rootNode.childrenAfterSort=[],this.rootNode.childrenAfterAggFilter=[],this.rootNode.childrenAfterFilter=[]}getCopyOfNodesMap(){return xY(this.allNodesMap)}getRowNode(t){return this.allNodesMap[t]}setRowData(t){if(typeof t=="string"){Wt("rowData must be an array.");return}this.rowCountReady=!0,this.dispatchRowDataUpdateStartedEvent(t);const e=this.rootNode,i=this.rootNode.sibling;e.childrenAfterFilter=null,e.childrenAfterGroup=null,e.childrenAfterAggFilter=null,e.childrenAfterSort=null,e.childrenMapped=null,e.updateHasChildren(),this.nextId=0,this.allNodesMap={},t?e.allLeafChildren=t.map((n,r)=>this.createNode(n,this.rootNode,cN,r)):(e.allLeafChildren=[],e.childrenAfterGroup=[]),i&&(i.childrenAfterFilter=e.childrenAfterFilter,i.childrenAfterGroup=e.childrenAfterGroup,i.childrenAfterAggFilter=e.childrenAfterAggFilter,i.childrenAfterSort=e.childrenAfterSort,i.childrenMapped=e.childrenMapped,i.allLeafChildren=e.allLeafChildren)}updateRowData(t){this.rowCountReady=!0,this.dispatchRowDataUpdateStartedEvent(t.add);const e={rowNodeTransaction:{remove:[],update:[],add:[]},rowsInserted:!1},i=[];return this.executeRemove(t,e,i),this.executeUpdate(t,e,i),this.executeAdd(t,e),this.updateSelection(i,"rowDataChanged"),e}updateRowOrderFromRowData(t){const e=this.rootNode.allLeafChildren,i=e?.length??0,n=new Map;let r=-1,s=-1;for(let o=0;o<i;++o){const a=e[o],l=a.data;l!==t[o]&&(s<0&&(r=o),s=o,n.set(l,a))}if(r<0)return!1;for(let o=r;o<=s;++o){const a=n.get(t[o]);a!==void 0&&(e[o]=a,a.sourceRowIndex=o)}return!0}isRowCountReady(){return this.rowCountReady}dispatchRowDataUpdateStartedEvent(t){this.eventService.dispatchEvent({type:"rowDataUpdateStarted",firstRowData:t?.length?t[0]:null})}updateSelection(t,e){const i=t.length>0;i&&this.selectionService.setNodesSelected({newValue:!1,nodes:t,suppressFinishActions:!0,source:e}),this.selectionService.updateGroupsFromChildrenSelections(e),i&&this.eventService.dispatchEvent({type:"selectionChanged",source:e})}executeAdd(t,e){const i=t.add;if(Kl(i))return;const n=this.rootNode.allLeafChildren;let r=n.length;if(typeof t.addIndex=="number"&&(r=this.sanitizeAddIndex(t.addIndex),r>0&&this.gos.get("treeData"))){for(let l=0;l<n.length;l++)if(n[l]?.rowIndex==r-1){r=l+1;break}}const s=i.map((a,l)=>this.createNode(a,this.rootNode,cN,r+l));if(r<n.length){const a=n.slice(0,r),l=n.slice(r,n.length),u=a.length+s.length;for(let d=0,p=l.length;d<p;++d)l[d].sourceRowIndex=u+d;this.rootNode.allLeafChildren=[...a,...s,...l],e.rowsInserted=!0}else this.rootNode.allLeafChildren=n.concat(s);const o=this.rootNode.sibling;o&&(o.allLeafChildren=n),e.rowNodeTransaction.add=s}sanitizeAddIndex(t){const e=this.rootNode.allLeafChildren?.length??0;return t<0||t>=e||Number.isNaN(t)?e:Math.ceil(t)}executeRemove(t,{rowNodeTransaction:e},i){const{remove:n}=t;if(Kl(n))return;const r={};n.forEach(o=>{const a=this.lookupRowNode(o);a&&(a.isSelected()&&i.push(a),a.clearRowTopAndRowIndex(),r[a.id]=!0,delete this.allNodesMap[a.id],e.remove.push(a))}),this.rootNode.allLeafChildren=this.rootNode.allLeafChildren?.filter(o=>!r[o.id])??null,this.rootNode.allLeafChildren?.forEach((o,a)=>{o.sourceRowIndex=a});const s=this.rootNode.sibling;s&&(s.allLeafChildren=this.rootNode.allLeafChildren)}executeUpdate(t,{rowNodeTransaction:e},i){const{update:n}=t;Kl(n)||n.forEach(r=>{const s=this.lookupRowNode(r);s&&(s.updateData(r),!s.selectable&&s.isSelected()&&i.push(s),this.setMasterForRow(s,r,cN,!1),e.update.push(s))})}lookupRowNode(t){const e=ix(this.gos);let i;if(e){const n=e({data:t,level:0});if(i=this.allNodesMap[n],!i)return ar(`could not find row id=${n}, data item was not found for this id`),null}else if(i=this.rootNode.allLeafChildren?.find(n=>n.data===t),!i)return ar("could not find data item as object was not found",t),ar("Consider using getRowId to help the Grid find matching row data"),null;return i||null}createNode(t,e,i,n){const r=new Ad(this.beans);return r.sourceRowIndex=n,r.group=!1,this.setMasterForRow(r,t,i,!0),e&&(r.parent=e),r.level=i,r.setDataAndId(t,this.nextId.toString()),this.allNodesMap[r.id]&&Wt(`duplicate node id '${r.id}' detected from getRowId callback, this could cause issues in your grid.`),this.allNodesMap[r.id]=r,this.nextId++,r}setMasterForRow(t,e,i,n){if(this.gos.get("treeData"))t.setMaster(!1),n&&(t.expanded=!1);else{if(this.gos.get("masterDetail")){const o=this.gos.get("isRowMaster");o?t.setMaster(o(e)):t.setMaster(!0)}else t.setMaster(!1);if(n){const o=this.funcColsService.getRowGroupColumns(),a=o?o.length:0,l=i+a;t.expanded=t.master?this.isExpanded(l):!1}}}isExpanded(t){const e=this.gos.get("groupDefaultExpanded");return e===-1?!0:t<e}},eRe=class extends kt{constructor(){super(...arguments),this.beanName="rowModel",this.onRowHeightChanged_debounced=Fa(this.onRowHeightChanged.bind(this),100),this.rowsToDisplay=[],this.hasStarted=!1,this.shouldSkipSettingDataOnStart=!1,this.isRefreshingModel=!1,this.rowCountReady=!1}wireBeans(t){this.beans=t,this.columnModel=t.columnModel,this.funcColsService=t.funcColsService,this.selectionService=t.selectionService,this.valueCache=t.valueCache,this.environment=t.environment,this.filterStage=t.filterStage,this.sortStage=t.sortStage,this.flattenStage=t.flattenStage,this.groupStage=t.groupStage,this.aggregationStage=t.aggregationStage,this.pivotStage=t.pivotStage,this.filterAggregatesStage=t.filterAggregatesStage}postConstruct(){const t=this.refreshModel.bind(this,{step:"group"}),e=!this.gos.get("suppressAnimationFrame"),i=this.refreshModel.bind(this,{step:"group",afterColumnsChanged:!0,keepRenderedRows:!0,animate:e});this.addManagedEventListeners({newColumnsLoaded:i,columnRowGroupChanged:t,columnValueChanged:this.onValueChanged.bind(this),columnPivotChanged:this.refreshModel.bind(this,{step:"pivot"}),filterChanged:this.onFilterChanged.bind(this),sortChanged:this.onSortChanged.bind(this),columnPivotModeChanged:t,gridStylesChanged:this.onGridStylesChanges.bind(this),gridReady:this.onGridReady.bind(this)}),this.addPropertyListeners(),this.rootNode=new Ad(this.beans),this.nodeManager=new JTe(this.rootNode,this.gos,this.eventService,this.funcColsService,this.selectionService,this.beans)}addPropertyListeners(){const t=new Set(["treeData","masterDetail"]),e=new Set(["groupDefaultExpanded","groupAllowUnbalanced","initialGroupOrderComparator","groupHideOpenParents","groupDisplayType"]),i=new Set(["excludeChildrenWhenTreeDataFiltering"]),n=new Set(["removePivotHeaderRowWhenSingleValueColumn","pivotRowTotals","pivotColumnGroupTotals","suppressExpandablePivotGroups"]),r=new Set(["getGroupRowAgg","alwaysAggregateAtRootLevel","groupIncludeTotalFooter","suppressAggFilteredOnly","grandTotalRow"]),s=new Set(["postSortRows","groupDisplayType","accentedSort"]),o=new Set([]),a=new Set(["groupRemoveSingleChildren","groupRemoveLowestSingleChildren","groupIncludeFooter","groupTotalRow"]),l=[...t,...e,...i,...n,...n,...r,...s,...o,...a];this.addManagedPropertyListeners(l,u=>{const d=u.changeSet?.properties;if(!d)return;const p=v=>d.some(y=>v.has(y));if(p(t)){this.setRowData(this.rootNode.allLeafChildren.map(v=>v.data));return}if(p(e)){this.refreshModel({step:"group"});return}if(p(i)){this.refreshModel({step:"filter"});return}if(p(n)){this.refreshModel({step:"pivot"});return}if(p(r)){this.refreshModel({step:"aggregate"});return}if(p(s)){this.refreshModel({step:"sort"});return}if(p(o)){this.refreshModel({step:"filter_aggregates"});return}p(a)&&this.refreshModel({step:"map"})}),this.addManagedPropertyListener("rowHeight",()=>this.resetRowHeights())}start(){this.hasStarted=!0,this.shouldSkipSettingDataOnStart?this.dispatchUpdateEventsAndRefresh():this.setInitialData()}setInitialData(){const t=this.gos.get("rowData");t&&(this.shouldSkipSettingDataOnStart=!0,this.setRowData(t))}ensureRowHeightsValid(t,e,i,n){let r,s=!1;do{r=!1;const o=this.getRowIndexAtPixel(t),a=this.getRowIndexAtPixel(e),l=Math.max(o,i),u=Math.min(a,n);for(let d=l;d<=u;d++){const p=this.getRow(d);if(p.rowHeightEstimated){const v=Mp(this.gos,p);p.setRowHeight(v.height),r=!0,s=!0}}r&&this.setRowTopAndRowIndex()}while(r);return s}setRowTopAndRowIndex(){const t=this.environment.getDefaultRowHeight();let e=0;const i=new Set,n=Zo(this.gos,"normal");for(let r=0;r<this.rowsToDisplay.length;r++){const s=this.rowsToDisplay[r];if(s.id!=null&&i.add(s.id),s.rowHeight==null){const o=Mp(this.gos,s,n,t);s.setRowHeight(o.height,o.estimated)}s.setRowTop(e),s.setRowIndex(r),e+=s.rowHeight}return i}clearRowTopAndRowIndex(t,e){const i=t.isActive(),n=s=>{s&&s.id!=null&&!e.has(s.id)&&s.clearRowTopAndRowIndex()},r=s=>{if(n(s),n(s.detailNode),n(s.sibling),s.hasChildren()&&s.childrenAfterGroup){const o=s.level==-1;i&&!o&&!s.expanded||s.childrenAfterGroup.forEach(r)}};r(this.rootNode)}ensureRowsAtPixel(t,e,i=0){const n=this.getRowIndexAtPixel(e),r=this.getRow(n),s=!this.gos.get("suppressAnimationFrame");if(r===t[0])return!1;const o=this.rootNode.allLeafChildren;return t.forEach(a=>{Na(o,a)}),t.forEach((a,l)=>{OT(o,a,Math.max(n+i,0)+l)}),t.forEach((a,l)=>{a.sourceRowIndex=l}),this.refreshModel({step:"group",keepRenderedRows:!0,keepEditingRows:!0,animate:s,rowNodesOrderChanged:!0}),!0}highlightRowAtPixel(t,e){const i=e!=null?this.getRowIndexAtPixel(e):null,n=i!=null?this.getRow(i):null;if(!n||!t||e==null){this.clearHighlightedRow();return}const r=this.getHighlightPosition(e,n),s=this.isHighlightingCurrentPosition(t,n,r),o=this.lastHighlightedRow!=null&&this.lastHighlightedRow!==n;(s||o)&&(this.clearHighlightedRow(),s)||(n.setHighlighted(r),this.lastHighlightedRow=n)}getHighlightPosition(t,e){if(!e){const r=this.getRowIndexAtPixel(t);if(e=this.getRow(r||0),!e)return 1}const{rowTop:i,rowHeight:n}=e;return t-i<n/2?0:1}getLastHighlightedRowNode(){return this.lastHighlightedRow}isHighlightingCurrentPosition(t,e,i){if(t===e)return!0;const n=i===0?-1:1;return this.getRow(e.rowIndex+n)===t}clearHighlightedRow(){this.lastHighlightedRow&&(this.lastHighlightedRow.setHighlighted(null),this.lastHighlightedRow=null)}isLastRowIndexKnown(){return!0}getRowCount(){return this.rowsToDisplay?this.rowsToDisplay.length:0}getTopLevelRowCount(){if(this.rowsToDisplay.length===0)return 0;if(this.rowsToDisplay&&this.rowsToDisplay[0]===this.rootNode)return 1;const e=this.rootNode.childrenAfterAggFilter,i=this.rootNode.sibling?1:0;return(e?e.length:0)+i}getTopLevelRowDisplayedIndex(t){if(this.rowsToDisplay&&this.rowsToDisplay[0]===this.rootNode)return t;let i=t;if(this.rowsToDisplay[0].footer){if(t===0)return 0;i-=1}const n=this.rowsToDisplay[this.rowsToDisplay.length-1],r=i>=this.rootNode.childrenAfterSort.length;if(n.footer&&r)return n.rowIndex;let s=this.rootNode.childrenAfterSort[i];if(this.gos.get("groupHideOpenParents"))for(;s.expanded&&s.childrenAfterSort&&s.childrenAfterSort.length>0;)s=s.childrenAfterSort[0];return s.rowIndex}getRowBounds(t){if(Wn(this.rowsToDisplay))return null;const e=this.rowsToDisplay[t];return e?{rowTop:e.rowTop,rowHeight:e.rowHeight}:null}onRowGroupOpened(){const t=Jy(this.gos);this.refreshModel({step:"map",keepRenderedRows:!0,animate:t})}onFilterChanged(t){if(t.afterDataChange)return;const e=Jy(this.gos),n=t.columns.length===0||t.columns.some(r=>r.isPrimary())?"filter":"filter_aggregates";this.refreshModel({step:n,keepRenderedRows:!0,animate:e})}onSortChanged(){const t=Jy(this.gos);this.refreshModel({step:"sort",keepRenderedRows:!0,animate:t,keepEditingRows:!0})}getType(){return"clientSide"}onValueChanged(){this.columnModel.isPivotActive()?this.refreshModel({step:"pivot"}):this.refreshModel({step:"aggregate"})}createChangePath(t){const e=Kl(t),i=new SP(!1,this.rootNode);return e&&i.setInactive(),i}isSuppressModelUpdateAfterUpdateTransaction(t){if(!this.gos.get("suppressModelUpdateAfterUpdateTransaction")||t.rowNodeTransactions==null)return!1;const e=t.rowNodeTransactions.filter(n=>n.add!=null&&n.add.length>0||n.remove!=null&&n.remove.length>0);return e==null||e.length==0}buildRefreshModelParams(t){let e="group";const i={everything:"group",group:"group",filter:"filter",map:"map",aggregate:"aggregate",filter_aggregates:"filter_aggregates",sort:"sort",pivot:"pivot",nothing:"nothing"};if(oi(t)&&(e=i[t]),Wn(e)){ar(`invalid step ${t}, available steps are ${Object.keys(i).join(", ")}`);return}const n=!this.gos.get("suppressAnimationFrame");return{step:e,keepRenderedRows:!0,keepEditingRows:!0,animate:n}}refreshModel(t){if(!this.hasStarted||this.isRefreshingModel||this.columnModel.isChangeEventsDispatching())return;const e=typeof t=="object"&&"step"in t?t:this.buildRefreshModelParams(t);if(!e||this.isSuppressModelUpdateAfterUpdateTransaction(e))return;const i=this.createChangePath(e.rowNodeTransactions);switch(this.isRefreshingModel=!0,e.step){case"group":this.doRowGrouping(e.rowNodeTransactions,i,!!e.rowNodesOrderChanged,!!e.afterColumnsChanged);case"filter":this.doFilter(i);case"pivot":this.doPivot(i);case"aggregate":this.doAggregate(i);case"filter_aggregates":this.doFilterAggregates(i);case"sort":this.doSort(e.rowNodeTransactions,i);case"map":this.doRowsToDisplay()}const n=this.setRowTopAndRowIndex();this.clearRowTopAndRowIndex(i,n),this.isRefreshingModel=!1,this.eventService.dispatchEvent({type:"modelUpdated",animate:e.animate,keepRenderedRows:e.keepRenderedRows,newData:e.newData,newPage:!1,keepUndoRedoStack:e.keepUndoRedoStack})}isEmpty(){const t=Wn(this.rootNode.allLeafChildren)||this.rootNode.allLeafChildren.length===0;return Wn(this.rootNode)||t||!this.columnModel.isReady()}isRowsToRender(){return oi(this.rowsToDisplay)&&this.rowsToDisplay.length>0}getNodesInRangeForSelection(t,e){let i=!1,n=!1;const r=[],s=Lg(this.gos);return this.forEachNodeAfterFilterAndSort(o=>{if(n)return;if(i&&(o===e||o===t)&&(n=!0,o.group&&s)){r.push(...o.allLeafChildren);return}if(!i){if(o!==e&&o!==t)return;i=!0}if(!o.group||!s){r.push(o);return}}),r}setDatasource(t){ar("should never call setDatasource on clientSideRowController")}getTopLevelNodes(){return this.rootNode?this.rootNode.childrenAfterGroup:null}getRootNode(){return this.rootNode}getRow(t){return this.rowsToDisplay[t]}isRowPresent(t){return this.rowsToDisplay.indexOf(t)>=0}getRowIndexAtPixel(t){if(this.isEmpty()||this.rowsToDisplay.length===0)return-1;let e=0,i=this.rowsToDisplay.length-1;if(t<=0)return 0;if(Yn(this.rowsToDisplay).rowTop<=t)return this.rowsToDisplay.length-1;let r=-1,s=-1;for(;;){const o=Math.floor((e+i)/2),a=this.rowsToDisplay[o];if(this.isRowInPixel(a,t)||(a.rowTop<t?e=o+1:a.rowTop>t&&(i=o-1),r===e&&s===i))return o;r=e,s=i}}isRowInPixel(t,e){const i=t.rowTop,n=t.rowTop+t.rowHeight;return i<=e&&n>e}forEachLeafNode(t){this.rootNode.allLeafChildren&&this.rootNode.allLeafChildren.forEach((e,i)=>t(e,i))}forEachNode(t,e=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterGroup||[]],callback:t,recursionType:0,index:0,includeFooterNodes:e})}forEachNodeAfterFilter(t,e=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterAggFilter||[]],callback:t,recursionType:1,index:0,includeFooterNodes:e})}forEachNodeAfterFilterAndSort(t,e=!1){this.recursivelyWalkNodesAndCallback({nodes:[...this.rootNode.childrenAfterSort||[]],callback:t,recursionType:2,index:0,includeFooterNodes:e})}forEachPivotNode(t,e=!1){this.recursivelyWalkNodesAndCallback({nodes:[this.rootNode],callback:t,recursionType:3,index:0,includeFooterNodes:e})}recursivelyWalkNodesAndCallback(t){const{nodes:e,callback:i,recursionType:n,includeFooterNodes:r}=t;let{index:s}=t;const o=a=>{const l=e[0]?.parent;if(!l)return;const u=r&&uY(this.gos),d=hY(this.gos),p=r&&d({node:l});if(l===this.rootNode){u===a&&(l.createFooter(),i(l.sibling,s++));return}p===a&&(l.createFooter(),i(l.sibling,s++))};o("top");for(let a=0;a<e.length;a++){const l=e[a];if(i(l,s++),l.hasChildren()&&!l.footer){let u=null;switch(n){case 0:u=l.childrenAfterGroup;break;case 1:u=l.childrenAfterAggFilter;break;case 2:u=l.childrenAfterSort;break;case 3:u=l.leafGroup?null:l.childrenAfterSort;break}u&&(s=this.recursivelyWalkNodesAndCallback({nodes:[...u],callback:i,recursionType:n,index:s,includeFooterNodes:r}))}}return o("bottom"),s}doAggregate(t){this.aggregationStage?.execute({rowNode:this.rootNode,changedPath:t})}doFilterAggregates(t){this.filterAggregatesStage?this.filterAggregatesStage.execute({rowNode:this.rootNode,changedPath:t}):this.rootNode.childrenAfterAggFilter=this.rootNode.childrenAfterFilter}expandOrCollapseAll(t){const e=this.gos.get("treeData"),i=this.columnModel.isPivotActive(),n=r=>{r&&r.forEach(s=>{const o=()=>{s.expanded=t,n(s.childrenAfterGroup)};if(e){oi(s.childrenAfterGroup)&&o();return}if(i){!s.leafGroup&&o();return}s.group&&o()})};this.rootNode&&n(this.rootNode.childrenAfterGroup),this.refreshModel({step:"map"}),this.eventService.dispatchEvent({type:"expandOrCollapseAll",source:t?"expandAll":"collapseAll"})}doSort(t,e){this.sortStage.execute({rowNode:this.rootNode,rowNodeTransactions:t,changedPath:e})}doRowGrouping(t,e,i,n){if(this.groupStage)t?this.groupStage.execute({rowNode:this.rootNode,rowNodeTransactions:t,rowNodesOrderChanged:i,changedPath:e}):this.groupStage.execute({rowNode:this.rootNode,changedPath:e,afterColumnsChanged:n}),Lg(this.gos)&&this.selectionService.updateGroupsFromChildrenSelections("rowGroupChanged",e)&&this.eventService.dispatchEvent({type:"selectionChanged",source:"rowGroupChanged"});else{const r=this.rootNode,s=r.sibling;r.childrenAfterGroup=r.allLeafChildren,s&&(s.childrenAfterGroup=r.childrenAfterGroup),this.rootNode.updateHasChildren()}this.nodeManager.isRowCountReady()&&(this.rowCountReady=!0,this.eventService.dispatchEventOnce({type:"rowCountReady"}))}doFilter(t){this.filterStage.execute({rowNode:this.rootNode,changedPath:t})}doPivot(t){this.pivotStage?.execute({rowNode:this.rootNode,changedPath:t})}getNodeManager(){return this.nodeManager}getRowNode(t){if(typeof t=="string"&&t.indexOf(Ad.ID_PREFIX_ROW_GROUP)==0){let i;return this.forEachNode(n=>{n.id===t&&(i=n)}),i}return this.nodeManager.getRowNode(t)}setRowData(t){this.selectionService.reset("rowDataChanged"),this.nodeManager.setRowData(t),this.hasStarted&&this.dispatchUpdateEventsAndRefresh()}dispatchUpdateEventsAndRefresh(){this.eventService.dispatchEvent({type:"rowDataUpdated"}),this.refreshModel({step:"group",newData:!0})}batchUpdateRowData(t,e){if(this.applyAsyncTransactionsTimeout==null){this.rowDataTransactionBatch=[];const i=this.gos.get("asyncTransactionWaitMillis");this.applyAsyncTransactionsTimeout=window.setTimeout(()=>{this.isAlive()&&this.executeBatchUpdateRowData()},i)}this.rowDataTransactionBatch.push({rowDataTransaction:t,callback:e})}flushAsyncTransactions(){this.applyAsyncTransactionsTimeout!=null&&(clearTimeout(this.applyAsyncTransactionsTimeout),this.executeBatchUpdateRowData())}executeBatchUpdateRowData(){this.valueCache.onDataChanged();const t=[],e=[];let i=!1;this.rowDataTransactionBatch?.forEach(n=>{const{rowNodeTransaction:r,rowsInserted:s}=this.nodeManager.updateRowData(n.rowDataTransaction);s&&(i=!0),e.push(r),n.callback&&t.push(n.callback.bind(null,r))}),this.commonUpdateRowData(e,i),t.length>0&&window.setTimeout(()=>{t.forEach(n=>n())},0),e.length>0&&this.eventService.dispatchEvent({type:"asyncTransactionsFlushed",results:e}),this.rowDataTransactionBatch=null,this.applyAsyncTransactionsTimeout=void 0}updateRowData(t){this.valueCache.onDataChanged();const{rowNodeTransaction:e,rowsInserted:i}=this.nodeManager.updateRowData(t);return this.commonUpdateRowData([e],i),e}afterImmutableDataChange(t,e){this.commonUpdateRowData([t],e)}commonUpdateRowData(t,e){if(!this.hasStarted)return;const i=!this.gos.get("suppressAnimationFrame");this.eventService.dispatchEvent({type:"rowDataUpdated"}),this.refreshModel({step:"group",rowNodeTransactions:t,rowNodesOrderChanged:e,keepRenderedRows:!0,keepEditingRows:!0,animate:i})}doRowsToDisplay(){this.rowsToDisplay=this.flattenStage.execute({rowNode:this.rootNode})}onRowHeightChanged(){this.refreshModel({step:"map",keepRenderedRows:!0,keepEditingRows:!0,keepUndoRedoStack:!0})}onRowHeightChangedDebounced(){this.onRowHeightChanged_debounced()}resetRowHeights(){const t=this.resetRowHeightsForAllRowNodes();this.rootNode.setRowHeight(this.rootNode.rowHeight,!0),this.rootNode.sibling&&this.rootNode.sibling.setRowHeight(this.rootNode.sibling.rowHeight,!0),t&&this.onRowHeightChanged()}resetRowHeightsForAllRowNodes(){let t=!1;return this.forEachNode(e=>{e.setRowHeight(e.rowHeight,!0);const i=e.detailNode;i&&i.setRowHeight(i.rowHeight,!0),e.sibling&&e.sibling.setRowHeight(e.sibling.rowHeight,!0),t=!0}),t}onGridStylesChanges(t){if(t.rowHeightChanged){if(this.columnModel.isAutoRowHeightActive())return;this.resetRowHeights()}}onGridReady(){this.hasStarted||this.setInitialData()}isRowDataLoaded(){return this.rowCountReady}destroy(){super.destroy(),this.clearHighlightedRow()}};function tRe(t){t.expansionService.onGroupExpandedOrCollapsed()}function iRe(t,e){t.rowModelHelperService?.getClientSideRowModel()?.refreshModel(e)}function nRe(t){return t.rowModelHelperService?.getClientSideRowModel()?.isEmpty()??!0}function rRe(t,e){t.rowModelHelperService?.getClientSideRowModel()?.forEachLeafNode(e)}function sRe(t,e){t.rowModelHelperService?.getClientSideRowModel()?.forEachNodeAfterFilter(e)}function oRe(t,e){t.rowModelHelperService?.getClientSideRowModel()?.forEachNodeAfterFilterAndSort(e)}function aRe(t){if(t.columnModel.isAutoRowHeightActive()){Wt("calling gridApi.resetRowHeights() makes no sense when using Auto Row Height.");return}t.rowModelHelperService?.getClientSideRowModel()?.resetRowHeights()}function lRe(t,e){return t.frameworkOverrides.wrapIncoming(()=>t.rowModelHelperService?.getClientSideRowModel()?.updateRowData(e))}function cRe(t,e,i){t.frameworkOverrides.wrapIncoming(()=>t.rowModelHelperService?.getClientSideRowModel()?.batchUpdateRowData(e,i))}function uRe(t){t.frameworkOverrides.wrapIncoming(()=>t.rowModelHelperService?.getClientSideRowModel()?.flushAsyncTransactions())}function hRe(t){return t.selectionService.getBestCostNodeSelection()}var dRe=class extends kt{constructor(){super(...arguments),this.beanName="filterStage"}wireBeans(t){this.filterManager=t.filterManager}execute(t){const{changedPath:e}=t;this.filter(e)}filter(t){const e=!!this.filterManager?.isChildFilterPresent();this.filterNodes(e,t)}filterNodes(t,e){const i=(n,r)=>{n.hasChildren()&&t&&!r?n.childrenAfterFilter=n.childrenAfterGroup.filter(s=>{const o=s.childrenAfterFilter&&s.childrenAfterFilter.length>0,a=s.data&&this.filterManager.doesRowPassFilter({rowNode:s});return o||a}):n.childrenAfterFilter=n.childrenAfterGroup,n.sibling&&(n.sibling.childrenAfterFilter=n.childrenAfterFilter)};if(this.doingTreeDataFiltering()){const n=(s,o)=>{if(s.childrenAfterGroup)for(let a=0;a<s.childrenAfterGroup.length;a++){const l=s.childrenAfterGroup[a],u=o||this.filterManager.doesRowPassFilter({rowNode:l});l.childrenAfterGroup?n(s.childrenAfterGroup[a],u):i(l,u)}i(s,o)},r=s=>n(s,!1);e.executeFromRootNode(r)}else{const n=r=>i(r,!1);e.forEachChangedNodeDepthFirst(n,!0)}}doingTreeDataFiltering(){return this.gos.get("treeData")&&!this.gos.get("excludeChildrenWhenTreeDataFiltering")}},fRe=class extends kt{constructor(){super(...arguments),this.beanName="flattenStage"}wireBeans(t){this.beans=t,this.columnModel=t.columnModel}execute(t){const e=t.rowNode,i=[],n=this.columnModel.isPivotMode(),r=n&&e.leafGroup,s=r?[e]:e.childrenAfterSort,o=this.getFlattenDetails();this.recursivelyAddToRowsToDisplay(o,s,i,n,0);const a=i.length>0;if(!r&&a&&o.grandTotalRow){e.createFooter();const u=o.grandTotalRow==="top";this.addRowNodeToRowsToDisplay(o,e.sibling,i,0,u)}return i}getFlattenDetails(){const t=this.gos.get("groupRemoveSingleChildren");return{groupRemoveLowestSingleChildren:!t&&this.gos.get("groupRemoveLowestSingleChildren"),groupRemoveSingleChildren:t,isGroupMultiAutoColumn:dY(this.gos),hideOpenParents:this.gos.get("groupHideOpenParents"),grandTotalRow:uY(this.gos),groupTotalRow:hY(this.gos)}}recursivelyAddToRowsToDisplay(t,e,i,n,r){if(!Kl(e))for(let s=0;s<e.length;s++){const o=e[s],a=o.hasChildren(),l=n&&!a,u=t.groupRemoveSingleChildren&&a&&o.childrenAfterGroup.length===1,d=t.groupRemoveLowestSingleChildren&&a&&o.leafGroup&&o.childrenAfterGroup.length===1,p=n&&o.leafGroup,v=t.hideOpenParents&&o.expanded&&!o.master&&!p;if(!l&&!v&&!u&&!d&&this.addRowNodeToRowsToDisplay(t,o,i,r),!(n&&o.leafGroup)){if(a){const w=u||d;if(o.expanded||w){const R=t.groupTotalRow({node:o});R||o.destroyFooter();const O=w?r:r+1;R==="top"&&(o.createFooter(),this.addRowNodeToRowsToDisplay(t,o.sibling,i,O)),this.recursivelyAddToRowsToDisplay(t,o.childrenAfterSort,i,n,O),R==="bottom"&&(o.createFooter(),this.addRowNodeToRowsToDisplay(t,o.sibling,i,O))}}else if(o.master&&o.expanded){const w=this.createDetailNode(o);this.addRowNodeToRowsToDisplay(t,w,i,r)}}}}addRowNodeToRowsToDisplay(t,e,i,n,r){r?i.unshift(e):i.push(e),e.setUiLevel(t.isGroupMultiAutoColumn?0:n)}createDetailNode(t){if(oi(t.detailNode))return t.detailNode;const e=new Ad(this.beans);return e.detail=!0,e.selectable=!1,e.parent=t,oi(t.id)&&(e.id="detail_"+t.id),e.data=t.data,e.level=t.level+1,t.detailNode=e,e}},pRe=class extends kt{constructor(){super(...arguments),this.beanName="immutableService"}wireBeans(t){this.rowModel=t.rowModel,this.selectionService=t.selectionService}postConstruct(){ls(this.gos)&&(this.clientSideRowModel=this.rowModel,this.addManagedPropertyListener("rowData",()=>this.onRowDataUpdated()))}isActive(){const t=this.gos.exists("getRowId");return this.gos.get("resetRowDataOnUpdate")?!1:t}setRowData(t){const e=this.createTransactionForRowData(t);if(!e)return;const i=this.clientSideRowModel.getNodeManager(),{rowNodeTransaction:n,rowsInserted:r}=i.updateRowData(e);let s=!1;this.gos.get("suppressMaintainUnsortedOrder")||(s=i.updateRowOrderFromRowData(t)),this.clientSideRowModel.afterImmutableDataChange(n,s||r)}createTransactionForRowData(t){if(!ls(this.gos))return ar("ImmutableService only works with ClientSideRowModel"),null;const e=ix(this.gos);if(e==null)return ar("ImmutableService requires getRowId() callback to be implemented, your row data needs IDs!"),null;const i=this.clientSideRowModel.getNodeManager().getCopyOfNodesMap(),n=[],r=[],s=[];return oi(t)&&t.forEach(o=>{const a=e({data:o,level:0}),l=i[a];l?(l.data!==o&&r.push(o),i[a]=void 0):s.push(o)}),gu(i,(o,a)=>{a&&n.push(a.data)}),{remove:n,update:r,add:s}}onRowDataUpdated(){const t=this.gos.get("rowData");t&&(this.isActive()?this.setRowData(t):(this.selectionService.reset("rowDataChanged"),this.clientSideRowModel.setRowData(t)))}},mRe=class extends kt{constructor(){super(...arguments),this.beanName="sortService"}wireBeans(t){this.columnModel=t.columnModel,this.funcColsService=t.funcColsService,this.rowNodeSorter=t.rowNodeSorter,this.showRowGroupColsService=t.showRowGroupColsService}sort(t,e,i,n,r,s){const o=this.gos.get("groupMaintainOrder"),a=this.columnModel.getCols().some(v=>v.isRowGroupActive());let l={};i&&n&&(l=this.calculateDirtyNodes(n));const u=this.columnModel.isPivotMode(),d=this.gos.getCallback("postSortRows"),p=v=>{this.pullDownGroupDataForHideOpenParents(v.childrenAfterAggFilter,!0);const y=u&&v.leafGroup;if(o&&a&&!v.leafGroup&&!s){const O=this.funcColsService.getRowGroupColumns()?.[v.level+1]?.getSort()===null,P=v.childrenAfterAggFilter.slice(0);if(v.childrenAfterSort&&!O){const N={};v.childrenAfterSort.forEach((F,k)=>{N[F.id]=k}),P.sort((F,k)=>(N[F.id]??0)-(N[k.id]??0))}v.childrenAfterSort=P}else!e||y?v.childrenAfterSort=v.childrenAfterAggFilter.slice(0):i?v.childrenAfterSort=this.doDeltaSort(v,l,r,t):v.childrenAfterSort=this.rowNodeSorter.doFullSort(v.childrenAfterAggFilter,t);if(v.sibling&&(v.sibling.childrenAfterSort=v.childrenAfterSort),this.updateChildIndexes(v),d){const R={nodes:v.childrenAfterSort};d(R)}};r&&r.forEachChangedNodeDepthFirst(p),this.updateGroupDataForHideOpenParents(r)}calculateDirtyNodes(t){const e={},i=n=>{n&&n.forEach(r=>e[r.id]=!0)};return t&&t.forEach(n=>{i(n.add),i(n.update),i(n.remove)}),e}doDeltaSort(t,e,i,n){const r=t.childrenAfterAggFilter,s=t.childrenAfterSort;if(!s)return this.rowNodeSorter.doFullSort(r,n);const o={},a=[];r.forEach(p=>{e[p.id]||!i.canSkip(p)?a.push(p):o[p.id]=!0});const l=s.filter(p=>o[p.id]),u=(p,v)=>({currentPos:v,rowNode:p}),d=a.map(u).sort((p,v)=>this.rowNodeSorter.compareRowNodes(n,p,v));return this.mergeSortedArrays(n,d,l.map(u)).map(({rowNode:p})=>p)}mergeSortedArrays(t,e,i){const n=[];let r=0,s=0;for(;r<e.length&&s<i.length;)this.rowNodeSorter.compareRowNodes(t,e[r],i[s])<0?n.push(e[r++]):n.push(i[s++]);for(;r<e.length;)n.push(e[r++]);for(;s<i.length;)n.push(i[s++]);return n}updateChildIndexes(t){if(Wn(t.childrenAfterSort))return;const e=t.childrenAfterSort;for(let i=0;i<e.length;i++){const n=e[i],r=i===0,s=i===t.childrenAfterSort.length-1;n.setFirstChild(r),n.setLastChild(s),n.setChildIndex(i)}}updateGroupDataForHideOpenParents(t){if(!this.gos.get("groupHideOpenParents"))return;if(this.gos.get("treeData"))return Wt("The property hideOpenParents dose not work with Tree Data. This is because Tree Data has values at the group level, it doesn't make sense to hide them."),!1;const e=i=>{this.pullDownGroupDataForHideOpenParents(i.childrenAfterSort,!1),i.childrenAfterSort.forEach(n=>{n.hasChildren()&&e(n)})};t&&t.executeFromRootNode(i=>e(i))}pullDownGroupDataForHideOpenParents(t,e){!this.gos.get("groupHideOpenParents")||Wn(t)||t.forEach(i=>{(this.showRowGroupColsService?.getShowRowGroupCols()??[]).forEach(r=>{const s=r.getColDef().showRowGroup;if(typeof s!="string"){ar("groupHideOpenParents only works when specifying specific columns for colDef.showRowGroup");return}const o=s,a=this.columnModel.getColDefCol(o);if(a!==i.rowGroupColumn)if(e)i.setGroupValue(r.getId(),void 0);else{const u=this.getFirstChildOfFirstChild(i,a);u&&i.setGroupValue(r.getId(),u.key)}})})}getFirstChildOfFirstChild(t,e){let i=t;for(;i;){const n=i.parent;if(n&&i.firstChild){if(n.rowGroupColumn===e)return n}else return null;i=n}return null}},gRe=class extends kt{constructor(){super(...arguments),this.beanName="sortStage"}wireBeans(t){this.sortService=t.sortService,this.sortController=t.sortController}execute(t){const e=this.sortController.getSortOptions(),i=oi(e)&&e.length>0,n=i&&oi(t.rowNodeTransactions)&&this.gos.get("deltaSort"),r=e.some(s=>ah(this.gos)?s.column.isPrimary()&&s.column.isRowGroupActive():!!s.column.getColDef().showRowGroup);this.sortService.sort(e,i,n,t.rowNodeTransactions,t.changedPath,r)}},AU="32.3.4",iee={version:AU,moduleName:"@ag-grid-community/client-side-row-model-core",rowModel:"clientSide",beans:[eRe,dRe,gRe,fRe,mRe,pRe]},vRe={version:AU,moduleName:"@ag-grid-community/client-side-row-model-api",beans:[tee],apiFunctions:{onGroupExpandedOrCollapsed:tRe,refreshClientSideRowModel:iRe,isRowDataEmpty:nRe,forEachLeafNode:rRe,forEachNodeAfterFilter:sRe,forEachNodeAfterFilterAndSort:oRe,resetRowHeights:aRe,applyTransaction:lRe,applyTransactionAsync:cRe,flushAsyncTransactions:uRe,getBestCostNodeSelection:hRe},dependantModules:[iee,XTe]},yRe={version:AU,moduleName:"@ag-grid-community/client-side-row-model",dependantModules:[iee,vRe]},xRe=class extends kt{setBeans(t){this.beans=t}getFileName(t){const e=this.getDefaultFileExtension();return(t==null||!t.length)&&(t=this.getDefaultFileName()),t.indexOf(".")===-1?`${t}.${e}`:t}getData(t){const e=this.createSerializingSession(t);return this.beans.gridSerializer.serialize(e,t)}getDefaultFileName(){return`export.${this.getDefaultFileExtension()}`}},bRe=class{constructor(t){this.groupColumns=[];const{columnModel:e,funcColsService:i,columnNameService:n,valueService:r,gos:s,processCellCallback:o,processHeaderCallback:a,processGroupHeaderCallback:l,processRowGroupCallback:u}=t;this.columnModel=e,this.funcColsService=i,this.columnNameService=n,this.valueService=r,this.gos=s,this.processCellCallback=o,this.processHeaderCallback=a,this.processGroupHeaderCallback=l,this.processRowGroupCallback=u}prepare(t){this.groupColumns=t.filter(e=>!!e.getColDef().showRowGroup)}extractHeaderValue(t){return this.getHeaderName(this.processHeaderCallback,t)??""}extractRowCellValue(t,e,i,n,r){const o=(!this.gos.get("groupHideOpenParents")||r.footer)&&this.shouldRenderGroupSummaryCell(r,t,e)?this.createValueForGroupNode(t,r):this.valueService.getValue(t,r);return this.processCell({accumulatedRowIndex:i,rowNode:r,column:t,value:o,processCellCallback:this.processCellCallback,type:n})}shouldRenderGroupSummaryCell(t,e,i){if(!(t&&t.group))return!1;if(this.groupColumns.indexOf(e)!==-1){const o=t.groupData?.[e.getId()],a=this.gos.get("suppressGroupMaintainValueType");if(a&&o!=null||!a&&o!==void 0||tf(this.gos)&&t.group)return!0;if(t.footer&&t.level===-1){const l=e.getColDef();return l==null||l.showRowGroup===!0||l.showRowGroup===this.funcColsService.getRowGroupColumns()[0].getId()}}const s=yP(this.gos,this.columnModel.isPivotMode());return i===0&&s}getHeaderName(t,e){return t?t(this.gos.addGridCommonParams({column:e})):this.columnNameService.getDisplayNameForColumn(e,"csv",!0)}createValueForGroupNode(t,e){if(this.processRowGroupCallback)return this.processRowGroupCallback(this.gos.addGridCommonParams({column:t,node:e}));const i=this.gos.get("treeData"),n=this.gos.get("suppressGroupMaintainValueType"),r=l=>{if(i||n)return l.key;const u=l.groupData?.[t.getId()];return!u||!l.rowGroupColumn||l.rowGroupColumn.getColDef().useValueFormatterForExport===!1?u:this.valueService.formatValue(l.rowGroupColumn,l,u)??u},s=e.footer,o=[r(e)];if(!dY(this.gos))for(;e.parent;)e=e.parent,o.push(r(e));const a=o.reverse().join(" -> ");return s?`Total ${a}`:a}processCell(t){const{accumulatedRowIndex:e,rowNode:i,column:n,value:r,processCellCallback:s,type:o}=t;return s?{value:s(this.gos.addGridCommonParams({accumulatedRowIndex:e,column:n,node:i,value:r,type:o,parseValue:a=>this.valueService.parseValue(n,i,a,this.valueService.getValue(n,i)),formatValue:a=>this.valueService.formatValue(n,i,a)??a}))??""}:n.getColDef().useValueFormatterForExport!==!1?{value:r??"",valueFormatted:this.valueService.formatValue(n,i,r)}:{value:r??""}}},wRe=class{static download(t,e){const i=document.defaultView||window;if(!i){Wt("There is no `window` associated with the current `document`");return}const n=document.createElement("a"),r=i.URL.createObjectURL(e);n.setAttribute("href",r),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.dispatchEvent(new MouseEvent("click",{bubbles:!1,cancelable:!0,view:i})),document.body.removeChild(n),i.setTimeout(()=>{i.URL.revokeObjectURL(r)},0)}},O6=`\r
`,_Re=class extends bRe{constructor(t){super(t),this.isFirstLine=!0,this.result="";const{suppressQuotes:e,columnSeparator:i}=t;this.suppressQuotes=e,this.columnSeparator=i}addCustomContent(t){t&&(typeof t=="string"?(/^\s*\n/.test(t)||this.beginNewLine(),t=t.replace(/\r?\n/g,O6),this.result+=t):t.forEach(e=>{this.beginNewLine(),e.forEach((i,n)=>{n!==0&&(this.result+=this.columnSeparator),this.result+=this.putInQuotes(i.data.value||""),i.mergeAcross&&this.appendEmptyCells(i.mergeAcross)})}))}onNewHeaderGroupingRow(){return this.beginNewLine(),{onColumn:this.onNewHeaderGroupingRowColumn.bind(this)}}onNewHeaderGroupingRowColumn(t,e,i,n){i!=0&&(this.result+=this.columnSeparator),this.result+=this.putInQuotes(e),this.appendEmptyCells(n)}appendEmptyCells(t){for(let e=1;e<=t;e++)this.result+=this.columnSeparator+this.putInQuotes("")}onNewHeaderRow(){return this.beginNewLine(),{onColumn:this.onNewHeaderRowColumn.bind(this)}}onNewHeaderRowColumn(t,e){e!=0&&(this.result+=this.columnSeparator),this.result+=this.putInQuotes(this.extractHeaderValue(t))}onNewBodyRow(){return this.beginNewLine(),{onColumn:this.onNewBodyRowColumn.bind(this)}}onNewBodyRowColumn(t,e,i){e!=0&&(this.result+=this.columnSeparator);const n=this.extractRowCellValue(t,e,e,"csv",i);this.result+=this.putInQuotes(n.valueFormatted??n.value)}putInQuotes(t){if(this.suppressQuotes)return t;if(t==null)return'""';let e;return typeof t=="string"?e=t:typeof t.toString=="function"?e=t.toString():(Wt("unknown value type during csv conversion"),e=""),'"'+e.replace(/"/g,'""')+'"'}parse(){return this.result}beginNewLine(){this.isFirstLine||(this.result+=O6),this.isFirstLine=!1}},CRe=class extends xRe{constructor(){super(...arguments),this.beanName="csvCreator"}wireBeans(t){this.columnModel=t.columnModel,this.columnNameService=t.columnNameService,this.funcColsService=t.funcColsService,this.valueService=t.valueService,this.gridSerializer=t.gridSerializer}postConstruct(){this.setBeans({gridSerializer:this.gridSerializer,gos:this.gos})}getMergedParams(t){const e=this.gos.get("defaultCsvExportParams");return Object.assign({},e,t)}export(t){if(this.isExportSuppressed()){Wt("Export cancelled. Export is not allowed as per your configuration.");return}const e=this.getMergedParams(t),i=this.getData(e),n=new Blob(["\uFEFF",i],{type:"text/plain"}),r=typeof e.fileName=="function"?e.fileName(this.gos.getGridCommonParams()):e.fileName;wRe.download(this.getFileName(r),n)}exportDataAsCsv(t){this.export(t)}getDataAsCsv(t,e=!1){const i=e?Object.assign({},t):this.getMergedParams(t);return this.getData(i)}getDefaultFileExtension(){return"csv"}createSerializingSession(t){const{columnModel:e,columnNameService:i,funcColsService:n,valueService:r,gos:s}=this,{processCellCallback:o,processHeaderCallback:a,processGroupHeaderCallback:l,processRowGroupCallback:u,suppressQuotes:d,columnSeparator:p}=t;return new _Re({columnModel:e,columnNameService:i,funcColsService:n,valueService:r,gos:s,processCellCallback:o||void 0,processHeaderCallback:a||void 0,processGroupHeaderCallback:l||void 0,processRowGroupCallback:u||void 0,suppressQuotes:d||!1,columnSeparator:p||","})}isExportSuppressed(){return this.gos.get("suppressCsvExport")}};function SRe(t,e){return t.csvCreator?.getDataAsCsv(e)}function ORe(t,e){t.csvCreator?.exportDataAsCsv(e)}var MRe=class extends kt{constructor(){super(...arguments),this.beanName="gridSerializer"}wireBeans(t){this.visibleColsService=t.visibleColsService,this.columnModel=t.columnModel,this.columnNameService=t.columnNameService,this.rowModel=t.rowModel,this.pinnedRowModel=t.pinnedRowModel,this.selectionService=t.selectionService,this.rowNodeSorter=t.rowNodeSorter,this.sortController=t.sortController}serialize(t,e={}){const{allColumns:i,columnKeys:n,skipRowGroups:r}=e,s=this.getColumnsToExport(i,r,n);return L0e(this.prepareSession(s),this.prependContent(e),this.exportColumnGroups(e,s),this.exportHeaders(e,s),this.processPinnedTopRows(e,s),this.processRows(e,s),this.processPinnedBottomRows(e,s),this.appendContent(e))(t).parse()}processRow(t,e,i,n){const r=e.shouldRowBeSkipped||(()=>!1),s=this.gos.get("groupRemoveSingleChildren"),o=this.gos.get("groupRemoveLowestSingleChildren"),l=e.rowPositions!=null||!!e.onlySelected,u=this.gos.get("groupHideOpenParents")&&!l,d=this.columnModel.isPivotMode()?n.leafGroup:!n.group,p=!!n.footer,v=o&&n.leafGroup,y=n.allChildrenCount===1&&n.childrenAfterGroup?.length===1&&(s||v);if(!d&&!p&&(e.skipRowGroups||y||u)||e.onlySelected&&!n.isSelected()||e.skipPinnedTop&&n.rowPinned==="top"||e.skipPinnedBottom&&n.rowPinned==="bottom"||n.level===-1&&!d&&!p||r(this.gos.addGridCommonParams({node:n})))return;const O=t.onNewBodyRow(n);if(i.forEach((P,N)=>{O.onColumn(P,N,n)}),e.getCustomContentBelowRow){const P=e.getCustomContentBelowRow(this.gos.addGridCommonParams({node:n}));P&&t.addCustomContent(P)}}appendContent(t){return e=>{const i=t.appendContent;return i&&e.addCustomContent(i),e}}prependContent(t){return e=>{const i=t.prependContent;return i&&e.addCustomContent(i),e}}prepareSession(t){return e=>(e.prepare(t),e)}exportColumnGroups(t,e){return i=>{if(!t.skipColumnGroupHeaders){const n=new CY,r=this.visibleColsService.createGroups({columns:e,idCreator:n,pinned:null,isStandaloneStructure:!0});this.recursivelyAddHeaderGroups(r,i,t.processGroupHeaderCallback)}return i}}exportHeaders(t,e){return i=>{if(!t.skipColumnHeaders){const n=i.onNewHeaderRow();e.forEach((r,s)=>{n.onColumn(r,s,void 0)})}return i}}processPinnedTopRows(t,e){return i=>{const n=this.processRow.bind(this,i,t,e);return t.rowPositions?t.rowPositions.filter(r=>r.rowPinned==="top").sort((r,s)=>r.rowIndex-s.rowIndex).map(r=>this.pinnedRowModel.getPinnedTopRow(r.rowIndex)).forEach(n):this.pinnedRowModel.forEachPinnedRow("top",n),i}}processRows(t,e){return i=>{const n=this.rowModel,r=ls(this.gos),s=tf(this.gos),o=!r&&t.onlySelected,a=this.processRow.bind(this,i,t,e),{exportedRows:l="filteredAndSorted"}=t;if(t.rowPositions)t.rowPositions.filter(u=>u.rowPinned==null).sort((u,d)=>u.rowIndex-d.rowIndex).map(u=>n.getRow(u.rowIndex)).forEach(a);else if(this.columnModel.isPivotMode())r?n.forEachPivotNode(a,!0):s?n.forEachNodeAfterFilterAndSort(a,!0):n.forEachNode(a);else if(t.onlySelectedAllPages||o){const u=this.selectionService.getSelectedNodes();this.replicateSortedOrder(u),u.forEach(a)}else l==="all"?n.forEachNode(a):r||s?n.forEachNodeAfterFilterAndSort(a,!0):n.forEachNode(a);return i}}replicateSortedOrder(t){const e=this.sortController.getSortOptions(),i=(n,r)=>n.rowIndex!=null&&r.rowIndex!=null?n.rowIndex-r.rowIndex:n.level===r.level?n.parent?.id===r.parent?.id?this.rowNodeSorter.compareRowNodes(e,{rowNode:n,currentPos:n.rowIndex??-1},{rowNode:r,currentPos:r.rowIndex??-1}):i(n.parent,r.parent):n.level>r.level?i(n.parent,r):i(n,r.parent);t.sort(i)}processPinnedBottomRows(t,e){return i=>{const n=this.processRow.bind(this,i,t,e);return t.rowPositions?t.rowPositions.filter(r=>r.rowPinned==="bottom").sort((r,s)=>r.rowIndex-s.rowIndex).map(r=>this.pinnedRowModel.getPinnedBottomRow(r.rowIndex)).forEach(n):this.pinnedRowModel.forEachPinnedRow("bottom",n),i}}getColumnsToExport(t=!1,e=!1,i){const n=this.columnModel.isPivotMode();if(i&&i.length)return this.columnModel.getColsForKeys(i);const r=this.gos.get("treeData");let s=[];return t&&!n?s=this.columnModel.getCols():s=this.visibleColsService.getAllCols(),e&&!r&&(s=s.filter(o=>!gz(o)&&!NC(o))),s}recursivelyAddHeaderGroups(t,e,i){const n=[];t.forEach(r=>{const s=r;s.getChildren&&s.getChildren().forEach(o=>n.push(o))}),t.length>0&&Vs(t[0])&&this.doAddHeaderHeader(e,t,i),n&&n.length>0&&this.recursivelyAddHeaderGroups(n,e,i)}doAddHeaderHeader(t,e,i){const n=t.onNewHeaderGroupingRow();let r=0;e.forEach(s=>{const o=s;let a;i?a=i(this.gos.addGridCommonParams({columnGroup:o})):a=this.columnNameService.getDisplayNameForColumnGroup(o,"header");const l=o.getLeafColumns().reduce((u,d,p,v)=>{let y=Yn(u);return d.getColumnGroupShow()==="open"?(!y||y[1]!=null)&&(y=[p],u.push(y)):y&&y[1]==null&&(y[1]=p-1),p===v.length-1&&y&&y[1]==null&&(y[1]=p),u},[]);n.onColumn(o,a||"",r++,o.getLeafColumns().length-1,l)})}},IU="32.3.4",nee={version:IU,moduleName:"@ag-grid-community/csv-export-core",beans:[CRe,MRe]},TRe={version:IU,moduleName:"@ag-grid-community/csv-export-api",apiFunctions:{getDataAsCsv:SRe,exportDataAsCsv:ORe},dependantModules:[nee]},RRe={version:IU,moduleName:"@ag-grid-community/csv-export",dependantModules:[nee,TRe]},PRe=class extends ESe{wireBeans(t){this.beans=t}constructor(t,e,i){super(t),this.parentCache=e,this.params=i,this.startRow=t*i.blockSize,this.endRow=this.startRow+i.blockSize}postConstruct(){this.createRowNodes()}getBlockStateJson(){return{id:""+this.getId(),state:{blockNumber:this.getId(),startRow:this.getStartRow(),endRow:this.getEndRow(),pageStatus:this.getState()}}}setDataAndId(t,e,i){oi(e)?t.setDataAndId(e,i.toString()):t.setDataAndId(void 0,void 0)}loadFromDatasource(){const t=this.createLoadParams();if(Wn(this.params.datasource.getRows)){Wt("datasource is missing getRows method");return}window.setTimeout(()=>{this.params.datasource.getRows(t)},0)}processServerFail(){}createLoadParams(){return{startRow:this.getStartRow(),endRow:this.getEndRow(),successCallback:this.pageLoaded.bind(this,this.getVersion()),failCallback:this.pageLoadFailed.bind(this,this.getVersion()),sortModel:this.params.sortModel,filterModel:this.params.filterModel,context:this.gos.getGridCommonParams().context}}forEachNode(t,e,i){this.rowNodes.forEach((n,r)=>{this.startRow+r<i&&t(n,e.next())})}getLastAccessed(){return this.lastAccessed}getRow(t,e=!1){e||(this.lastAccessed=this.params.lastAccessedSequence.next());const i=t-this.startRow;return this.rowNodes[i]}getStartRow(){return this.startRow}getEndRow(){return this.endRow}createRowNodes(){this.rowNodes=[];for(let t=0;t<this.params.blockSize;t++){const e=this.startRow+t,i=new Ad(this.beans);i.setRowHeight(this.params.rowHeight),i.uiLevel=0,i.setRowIndex(e),i.setRowTop(this.params.rowHeight*e),this.rowNodes.push(i)}}processServerResult(t){this.rowNodes.forEach((i,n)=>{const r=t.rowData?t.rowData[n]:void 0;!i.id&&i.alreadyRendered&&r&&(this.rowNodes[n]=new Ad(this.beans),this.rowNodes[n].setRowIndex(i.rowIndex),this.rowNodes[n].setRowTop(i.rowTop),this.rowNodes[n].setRowHeight(i.rowHeight),i.clearRowTopAndRowIndex()),this.setDataAndId(this.rowNodes[n],r,this.startRow+n)});const e=t.rowCount!=null&&t.rowCount>=0?t.rowCount:void 0;this.parentCache.pageLoaded(this,e)}destroy(){this.rowNodes.forEach(t=>{t.clearRowTopAndRowIndex()}),super.destroy()}},ERe=2,ARe=class extends kt{constructor(t){super(),this.lastRowIndexKnown=!1,this.blocks={},this.blockCount=0,this.rowCount=t.initialRowCount,this.params=t}wireBeans(t){this.rowRenderer=t.rowRenderer,this.focusService=t.focusService}getRow(t,e=!1){const i=Math.floor(t/this.params.blockSize);let n=this.blocks[i];if(!n){if(e)return;n=this.createBlock(i)}return n.getRow(t)}createBlock(t){const e=this.createBean(new PRe(t,this,this.params));return this.blocks[e.getId()]=e,this.blockCount++,this.purgeBlocksIfNeeded(e),this.params.rowNodeBlockLoader.addBlock(e),e}refreshCache(){if(this.blockCount==0){this.purgeCache();return}this.getBlocksInOrder().forEach(e=>e.setStateWaitingToLoad()),this.params.rowNodeBlockLoader.checkBlockToLoad()}destroy(){this.getBlocksInOrder().forEach(t=>this.destroyBlock(t)),super.destroy()}getRowCount(){return this.rowCount}isLastRowIndexKnown(){return this.lastRowIndexKnown}pageLoaded(t,e){this.isAlive()&&(this.gos.get("debug")&&Ic(`InfiniteCache - onPageLoaded: page = ${t.getId()}, lastRow = ${e}`),this.checkRowCount(t,e),this.onCacheUpdated())}purgeBlocksIfNeeded(t){const e=this.getBlocksInOrder().filter(o=>o!=t),i=(o,a)=>a.getLastAccessed()-o.getLastAccessed();e.sort(i);const n=this.params.maxBlocksInCache>0,r=n?this.params.maxBlocksInCache-1:null,s=ERe-1;e.forEach((o,a)=>{const l=o.getState()==="needsLoading"&&a>=s,u=n?a>=r:!1;if(l||u){if(this.isBlockCurrentlyDisplayed(o)||this.isBlockFocused(o))return;this.removeBlockFromCache(o)}})}isBlockFocused(t){const e=this.focusService.getFocusCellToUseAfterRefresh();if(!e||e.rowPinned!=null)return!1;const i=t.getStartRow(),n=t.getEndRow();return e.rowIndex>=i&&e.rowIndex<n}isBlockCurrentlyDisplayed(t){const e=t.getStartRow(),i=t.getEndRow()-1;return this.rowRenderer.isRangeInRenderedViewport(e,i)}removeBlockFromCache(t){t&&this.destroyBlock(t)}checkRowCount(t,e){if(typeof e=="number"&&e>=0)this.rowCount=e,this.lastRowIndexKnown=!0;else if(!this.lastRowIndexKnown){const n=(t.getId()+1)*this.params.blockSize+this.params.overflowSize;this.rowCount<n&&(this.rowCount=n)}}setRowCount(t,e){this.rowCount=t,oi(e)&&(this.lastRowIndexKnown=e),this.lastRowIndexKnown||this.rowCount%this.params.blockSize===0&&this.rowCount++,this.onCacheUpdated()}forEachNodeDeep(t){const e=new M0;this.getBlocksInOrder().forEach(i=>i.forEachNode(t,e,this.rowCount))}getBlocksInOrder(){const t=(i,n)=>i.getId()-n.getId();return Fg(this.blocks).sort(t)}destroyBlock(t){delete this.blocks[t.getId()],this.destroyBean(t),this.blockCount--,this.params.rowNodeBlockLoader.removeBlock(t)}onCacheUpdated(){this.isAlive()&&(this.destroyAllBlocksPastVirtualRowCount(),this.eventService.dispatchEvent({type:"storeUpdated"}))}destroyAllBlocksPastVirtualRowCount(){const t=[];this.getBlocksInOrder().forEach(e=>{e.getId()*this.params.blockSize>=this.rowCount&&t.push(e)}),t.length>0&&t.forEach(e=>this.destroyBlock(e))}purgeCache(){this.getBlocksInOrder().forEach(t=>this.removeBlockFromCache(t)),this.lastRowIndexKnown=!1,this.rowCount===0&&(this.rowCount=this.params.initialRowCount),this.onCacheUpdated()}getRowNodesInRange(t,e){const i=[];let n=-1,r=!1;const s=new M0;let o=!1;return this.getBlocksInOrder().forEach(l=>{if(!o){if(r&&n+1!==l.getId()){o=!0;return}n=l.getId(),l.forEachNode(u=>{const d=u===t||u===e;(r||d)&&i.push(u),d&&(r=!r)},s,this.rowCount)}}),o||r?[]:i}},IRe=class extends kt{constructor(){super(...arguments),this.beanName="rowModel"}wireBeans(t){this.filterManager=t.filterManager,this.sortController=t.sortController,this.selectionService=t.selectionService,this.rowRenderer=t.rowRenderer,this.rowNodeBlockLoader=t.rowNodeBlockLoader}getRowBounds(t){return{rowHeight:this.rowHeight,rowTop:this.rowHeight*t}}ensureRowHeightsValid(){return!1}postConstruct(){this.gos.get("rowModelType")==="infinite"&&(this.rowHeight=dg(this.gos),this.addEventListeners(),this.addDestroyFunc(()=>this.destroyCache()),this.verifyProps())}verifyProps(){this.gos.exists("initialGroupOrderComparator")&&Wt("initialGroupOrderComparator cannot be used with Infinite Row Model as sorting is done on the server side")}start(){this.setDatasource(this.gos.get("datasource"))}destroy(){this.destroyDatasource(),super.destroy()}destroyDatasource(){this.datasource&&(this.destroyBean(this.datasource),this.rowRenderer.datasourceChanged(),this.datasource=null)}addEventListeners(){this.addManagedEventListeners({filterChanged:this.onFilterChanged.bind(this),sortChanged:this.onSortChanged.bind(this),newColumnsLoaded:this.onColumnEverything.bind(this),storeUpdated:this.onCacheUpdated.bind(this)}),this.addManagedPropertyListener("datasource",()=>this.setDatasource(this.gos.get("datasource"))),this.addManagedPropertyListener("cacheBlockSize",()=>this.resetCache()),this.addManagedPropertyListener("rowHeight",()=>{this.rowHeight=dg(this.gos),this.cacheParams.rowHeight=this.rowHeight,this.updateRowHeights()})}onFilterChanged(){this.reset()}onSortChanged(){this.reset()}onColumnEverything(){let t;this.cacheParams?t=this.isSortModelDifferent():t=!0,t&&this.reset()}isSortModelDifferent(){return!V_(this.cacheParams.sortModel,this.sortController.getSortModel())}getType(){return"infinite"}setDatasource(t){this.destroyDatasource(),this.datasource=t,t&&this.reset()}isEmpty(){return!this.infiniteCache}isRowsToRender(){return!!this.infiniteCache}getNodesInRangeForSelection(t,e){return this.infiniteCache?this.infiniteCache.getRowNodesInRange(t,e):[]}reset(){if(!this.datasource)return;ix(this.gos)!=null||this.selectionService.reset("rowDataChanged"),this.resetCache()}dispatchModelUpdatedEvent(){this.eventService.dispatchEvent({type:"modelUpdated",newPage:!1,newPageSize:!1,newData:!1,keepRenderedRows:!0,animate:!1})}resetCache(){this.destroyCache(),this.cacheParams={datasource:this.datasource,filterModel:this.filterManager?.getFilterModel()??{},sortModel:this.sortController.getSortModel(),rowNodeBlockLoader:this.rowNodeBlockLoader,initialRowCount:this.gos.get("infiniteInitialRowCount"),maxBlocksInCache:this.gos.get("maxBlocksInCache"),rowHeight:dg(this.gos),overflowSize:this.gos.get("cacheOverflowSize"),blockSize:this.gos.get("cacheBlockSize"),lastAccessedSequence:new M0},this.infiniteCache=this.createBean(new ARe(this.cacheParams)),this.eventService.dispatchEventOnce({type:"rowCountReady"}),this.dispatchModelUpdatedEvent()}updateRowHeights(){this.forEachNode(t=>{t.setRowHeight(this.rowHeight),t.setRowTop(this.rowHeight*t.rowIndex)}),this.dispatchModelUpdatedEvent()}destroyCache(){this.infiniteCache&&(this.infiniteCache=this.destroyBean(this.infiniteCache))}onCacheUpdated(){this.dispatchModelUpdatedEvent()}getRow(t){if(this.infiniteCache&&!(t>=this.infiniteCache.getRowCount()))return this.infiniteCache.getRow(t)}getRowNode(t){let e;return this.forEachNode(i=>{i.id===t&&(e=i)}),e}forEachNode(t){this.infiniteCache&&this.infiniteCache.forEachNodeDeep(t)}getTopLevelRowCount(){return this.getRowCount()}getTopLevelRowDisplayedIndex(t){return t}getRowIndexAtPixel(t){if(this.rowHeight!==0){const e=Math.floor(t/this.rowHeight),i=this.getRowCount()-1;return e>i?i:e}return 0}getRowCount(){return this.infiniteCache?this.infiniteCache.getRowCount():0}isRowPresent(t){return!!this.getRowNode(t.id)}refreshCache(){this.infiniteCache&&this.infiniteCache.refreshCache()}purgeCache(){this.infiniteCache&&this.infiniteCache.purgeCache()}isLastRowIndexKnown(){return this.infiniteCache?this.infiniteCache.isLastRowIndexKnown():!1}setRowCount(t,e){this.infiniteCache&&this.infiniteCache.setRowCount(t,e)}};function kRe(t){t.rowModelHelperService?.getInfiniteRowModel()?.refreshCache()}function DRe(t){t.rowModelHelperService?.getInfiniteRowModel()?.purgeCache()}function LRe(t){return t.rowModelHelperService?.getInfiniteRowModel()?.getRowCount()}var kU="32.3.4",ree={version:kU,moduleName:"@ag-grid-community/infinite-row-model-core",rowModel:"infinite",beans:[IRe],dependantModules:[ISe]},FRe={version:kU,moduleName:"@ag-grid-community/infinite-row-model-api",beans:[tee],apiFunctions:{refreshInfiniteCache:kRe,purgeInfiniteCache:DRe,getInfiniteRowCount:LRe},dependantModules:[ree,KTe]},NRe={version:kU,moduleName:"@ag-grid-community/infinite-row-model",dependantModules:[ree,FRe]};bd.__registerModules([XJ,yRe,NRe,RRe],!1,void 0);function BRe(t){if(!t||!t[0])return[];let e=[];return Object.keys(t[0]).forEach(i=>{e.push({field:i,sortable:!0,resizable:!0,editable:!0,filter:!0})}),e}var zRe=hi('<div class="ag-theme-alpine" style="height: 500px; width: 100%;"></div>');function see(t,e){Pi(e,!0);let i=ht(e,"rowSelected",11,l=>{}),n,r;function s(){n.setGridOption("columnDefs",BRe(e.rowData)),n.setGridOption("rowData",e.rowData),n.setGridOption("onRowClicked",l=>{i()(l.node.data)}),o(!1)}Xo(()=>{n=GTe(r,{}),s()}),On(()=>{n&&e.rowData&&s()}),As(()=>{n&&n.destroy()});function o(l){const u=[];n.getColumns().forEach(d=>{u.push(d.getId())}),n.autoSizeColumns(u,l)}var a=zRe();es(a,l=>r=l,()=>r),bt(t,a),Ei()}function Grt(t,e){Pi(e,!0);const i=Xi("pageContext");function n(){return e.layoutStructure}function r(){return["onrowselected"]}function s(){return[{name:"dataSource",type:"dataSource"},{name:"selectedRow",type:"string"}]}let o=Vt(()=>i.data[e.layoutStructure.props?.dataSource]);function a(){XG(e.layoutStructure.actions.onrowselected,{page:i,data:e.dataValues,self:e.myself},e.dataValues)}return see(t,{get rowData(){return B(o)},rowSelected:l=>a()}),Ei({getLayout:n,getEvents:r,getProps:s})}function GC(t){return function(e){return e.key==="Enter"||e.key===" "&&!e.preventDefault()?t.call(this,e):void 0}}function Yl(t,e){let i={update(n){typeof n=="string"?t.innerText=n:n?.domNodes?t.replaceChildren(...n.domNodes):n?.html&&(t.innerHTML=n.html)}};return i.update(e),i}function VRe(t,e){const i=n=>{t&&!t.contains(n.target)&&t.dispatchEvent(new CustomEvent(e+"outside",{detail:{jsEvent:n}}))};return document.addEventListener(e,i,!0),{destroy(){document.removeEventListener(e,i,!0)}}}const LT=86400;function Rh(t=void 0){return t!==void 0?t instanceof Date?T6(t):WRe(t):T6(new Date)}function wd(t){if(typeof t=="number")t={seconds:t};else if(typeof t=="string"){let i=0,n=2;for(let r of t.split(":",3))i+=parseInt(r,10)*Math.pow(60,n--);t={seconds:i}}else t instanceof Date&&(t={hours:t.getUTCHours(),minutes:t.getUTCMinutes(),seconds:t.getUTCSeconds()});let e=t.weeks||t.week||0;return{years:t.years||t.year||0,months:t.months||t.month||0,days:e*7+(t.days||t.day||0),seconds:(t.hours||t.hour||0)*60*60+(t.minutes||t.minute||0)*60+(t.seconds||t.second||0),inWeeks:!!e}}function qn(t){return new Date(t.getTime())}function Ba(t,e,i=1){t.setUTCFullYear(t.getUTCFullYear()+i*e.years);let n=t.getUTCMonth()+i*e.months;for(t.setUTCMonth(n),n%=12,n<0&&(n+=12);t.getUTCMonth()!==n;)T0(t);return t.setUTCDate(t.getUTCDate()+i*e.days),t.setUTCSeconds(t.getUTCSeconds()+i*e.seconds),t}function GRe(t,e,i=1){return Ba(t,e,-i)}function Ph(t,e=1){return t.setUTCDate(t.getUTCDate()+e),t}function T0(t,e=1){return Ph(t,-e)}function rc(t){return t.setUTCHours(0,0,0,0),t}function ha(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}function qd(t,e=19){return t.toISOString().substring(0,e)}function To(t,...e){return e.every(i=>t.getTime()===i.getTime())}function URe(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i>=0?i:i+7)),t}function oee(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i<=0?i:i-7)),t}function M6(t){return typeof t=="string"&&t.length<=10}function HRe(t,e){return t.setUTCHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),0),t}function gc(t){return t.seconds}function Az(t,e){return Ba(t,e),t}function Iz(t,e,i){if(GRe(t,e),i.length&&i.length<7)for(;i.includes(t.getUTCDay());)T0(t);return t}function $Re(t,e){t=qn(t),e==0?t.setUTCDate(t.getUTCDate()+6-t.getUTCDay()):t.setUTCDate(t.getUTCDate()+4-(t.getUTCDay()||7));let i=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-i)/1e3/LT+1)/7)}function T6(t){return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()))}function WRe(t){const e=t.match(/\d+/g);return new Date(Date.UTC(Number(e[0]),Number(e[1])-1,Number(e[2]),Number(e[3]||0),Number(e[4]||0),Number(e[5]||0)))}function ox(...t){return Object.assign(...t)}function dh(t){return Object.keys(t)}function qRe(t){return Math.floor(t)}function R6(...t){return Math.min(...t)}function PM(...t){return Math.max(...t)}function jRe(){return Symbol("ec")}function DU(t){return Array.isArray(t)}function Gr(t){return typeof t=="function"}function QRe(t){return t()}function ZRe(t){t.forEach(QRe)}const XRe=t=>t;function OP(t,e,i){i.update(n=>n.set(e,t))}function P6(t){ZRe(t),t.clear()}function MP(t,e,i){e??=t,i.has(e)||i.set(e,setTimeout(()=>{i.delete(e),t()}))}let LU=jRe();function j_(t,e){t[LU]=e}function KRe(t){return!!t?.[LU]}function YRe(t){return t[LU]}function aee(t,e,i,n=[]){let r=document.createElement(t);r.className=e,typeof i=="string"?r.innerText=i:i.domNodes?r.replaceChildren(...i.domNodes):i.html&&(r.innerHTML=i.html);for(let s of n)r.setAttribute(...s);return r}function JRe(t){return t.scrollHeight>t.clientHeight}function Id(t){return t.getBoundingClientRect()}function Q_(t,e){for(;e--;)t=t.parentElement;return t}function _w(t){return Id(t).height}function lee(t,e,i=document){for(let n of i.elementsFromPoint(t,e)){if(KRe(n))return n;if(n.shadowRoot){let r=lee(t,e,n.shadowRoot);if(r)return r}}return null}function ePe(t,e,i,n){return{type:t,title:e,currentStart:i.start,currentEnd:i.end,activeStart:n.start,activeEnd:n.end,calendar:void 0}}function Jl(t){return t=ox({},t),t.currentStart=ha(t.currentStart),t.currentEnd=ha(t.currentEnd),t.activeStart=ha(t.activeStart),t.activeEnd=ha(t.activeEnd),t}function tPe(t){return t.startsWith("list")}let iPe=1;function FT(t){return t.map(e=>{let i={id:"id"in e?String(e.id):`{generated-${iPe++}}`,resourceIds:uN(e,"resourceId").map(String),allDay:e.allDay??(M6(e.start)&&M6(e.end)),start:Rh(e.start),end:Rh(e.end),title:e.title??"",editable:e.editable,startEditable:e.startEditable,durationEditable:e.durationEditable,display:e.display??"auto",extendedProps:e.extendedProps??{},backgroundColor:e.backgroundColor??e.color,textColor:e.textColor,classNames:uN(e,"className"),styles:uN(e,"style")};if(i.allDay){rc(i.start);let n=qn(i.end);rc(i.end),(!To(i.end,n)||To(i.end,i.start))&&Ph(i.end)}return i})}function uN(t,e){let i=t[e+"s"]??t[e]??[];return DU(i)?i:[i]}function nPe(t){return t.map(e=>({events:e.events,url:e.url&&e.url.trimEnd("&")||"",method:e.method&&e.method.toUpperCase()||"GET",extraParams:e.extraParams||{}}))}function gp(t,e,i){let n={start:t.start>e?t.start:e,end:t.end<i?t.end:i,event:t};return n.zeroDuration=To(n.start,n.end),n}function cee(t){t.sort((e,i)=>e.start-i.start||i.event.allDay-e.event.allDay)}function FU(t,e,i,n,r,s){let o=r.formatRange(t.start,e&&t.event.display!=="pointer"&&!t.zeroDuration?HRe(qn(t.start),t.end):t.start),a;if(i&&(a=Gr(i)?i({event:kc(t.event),timeText:o,view:Jl(s)}):i),a===void 0){let l;switch(t.event.display){case"background":l=[];break;case"pointer":l=[E6(o,t,n)];break;default:l=[...t.event.allDay?[]:[E6(o,t,n)],aee("h4",n.eventTitle,t.event.title)]}a={domNodes:l}}return[o,a]}function E6(t,e,i){return aee("time",i.eventTime,t,[["datetime",qd(e.start)]])}function NU(t,e,i){let n=e.classNames;return t&&(Gr(t)&&(t=t({event:kc(e),view:Jl(i)})),n=[...DU(t)?t:[t],...n]),n}function kc(t){return rPe(t,ha)}function rPe(t,e){return t=ox({},t),t.start=e(t.start),t.end=e(t.end),t}function i0(t,e){let i={};if(t.length){cee(t);let n;for(let r of t){let s=[],o=rc(qn(r.start));for(;r.end>o;){if(!e.includes(o.getUTCDay())&&(s.push(qn(o)),s.length>1)){let a=o.getTime();i[a]?i[a].chunks.push(r):i[a]={sorted:!1,chunks:[r]}}Ph(o)}if(s.length){r.date=s[0],r.days=s.length,r.dates=s,r.start<s[0]&&(r.start=s[0]);let a=Ph(qn(s.at(-1)));r.end>a&&(r.end=a)}else r.date=rc(qn(r.start)),r.days=1,r.dates=[r.date];n&&To(n.date,r.date)&&(r.prev=n),n=r}}return i}function uee(t,e,i){t.top=0,t.prev&&(t.top=t.prev.bottom+1),t.bottom=t.top+i;let n=1,r=t.date.getTime();if(e[r]){e[r].sorted||(e[r].chunks.sort((s,o)=>s.top-o.top),e[r].sorted=!0);for(let s of e[r].chunks)if(t.top<s.bottom&&t.bottom>s.top){let o=s.bottom-t.top+1;n+=o,t.top+=o,t.bottom+=o}}return n}function TP(t,e){t.length=e.length;let i=[];for(let n of t)i.push(n?.reposition?.());return i}function R0(t,e,i,n){return t.start<i&&t.end>e?n?(DU(n)||(n=[n]),n.some(r=>t.resourceIds.includes(r.id))):!0:!1}function fh(t){return sPe(t)||hee(t)||oPe(t)}function Dc(t){return t==="background"}function sPe(t){return t==="preview"}function hee(t){return t==="ghost"}function oPe(t){return t==="pointer"}function aPe(t){return BU(t,"day")}function lPe(t){return BU(t,"week")}function cPe(t){return BU(t,"month")}function BU(t,e){return{...t,next:"Next "+e,prev:"Previous "+e}}function kz(t){return e=>({...e,view:t})}function uPe(t){let e,i;return t&&({start:e,end:i}=t,e&&(e=rc(Rh(e))),i&&(i=rc(Rh(i)))),{start:e,end:i}}function RP(t,e){return e.start&&t<e.start||e.end&&t>e.end}function NT(t,e){return e.start&&t<e.start&&(t=e.start),e.end&&t>e.end&&(t=e.end),t}function hPe(t){let e=[];return dee(t,0,e),e}function dee(t,e,i){let n=[];for(let r of t){let s=dPe(r);n.push(s),i.push(s);let o={level:e,children:[],expanded:!0,hidden:!1};j_(s,o),r.children&&(o.children=dee(r.children,e+1,i))}return n}function dPe(t){return{id:String(t.id),title:t.title||"",eventBackgroundColor:t.eventBackgroundColor,eventTextColor:t.eventTextColor,extendedProps:t.extendedProps??{}}}function zU(t,e){return fee(t,e)?.eventBackgroundColor}function VU(t,e){return fee(t,e)?.eventTextColor}function fee(t,e){return e.find(i=>t.resourceIds.includes(i.id))}function Kw(t,e){return ga([t,e],([i,n])=>{let r=Gr(n)?{format:n}:new Intl.DateTimeFormat(i,n);return{format:s=>r.format(ha(s))}})}function A6(t,e){return ga([t,e],([i,n])=>{let r;if(Gr(n))r=n;else{let s=new Intl.DateTimeFormat(i,n);r=(o,a)=>{if(o<=a)return s.formatRange(o,a);{let l=s.formatRangeToParts(a,o),u="",d=["startRange","endRange"],p=[!1,!1];for(let v of l){let y=d.indexOf(v.source);y>=0?p[y]||(u+=fPe(d[1-y],l),p[y]=!0):u+=v.value}return u}}}return{formatRange:(s,o)=>r(ha(s),ha(o))}})}function fPe(t,e){let i="";for(let n of e)n.source==t&&(i+=n.value);return i}function pPe(t,e,i,n){t=qn(t);let r=e.seconds<3600,s=[],o=qn(t),a=1;for(Ba(t,i.min),Ba(o,i.max);t<o;)s.push([qd(t),n.format(t),s.length&&(a||!r)]),Ba(t,e),a=1-a;return s}function mPe(t,e,i,n,r){let s=wd(t),o=wd(e);if(i){let a=wd(R6(gc(s),PM(0,gc(o)-LT))),l=wd(PM(gc(o),gc(a)+LT)),u=Gr(i?.eventFilter)?i.eventFilter:d=>!Dc(d.display);e:for(let d of n){let p=Ba(qn(d),s),v=Ba(qn(d),o),y=Ba(qn(d),a),w=Ba(qn(d),l);for(let R of r)if(!R.allDay&&u(R)&&R.start<w&&R.end>y){if(R.start<p){let O=PM((R.start-d)/1e3,gc(a));O<gc(s)&&(s.seconds=O)}if(R.end>v){let O=R6((R.end-d)/1e3,gc(l));O>gc(o)&&(o.seconds=O)}if(gc(s)===gc(a)&&gc(o)===gc(l))break e}}}return{min:s,max:o}}function gPe(t){let e={allDayContent:void 0,allDaySlot:!0,buttonText:{today:"today"},customButtons:{},date:new Date,datesSet:void 0,dayHeaderFormat:{weekday:"short",month:"numeric",day:"numeric"},dayHeaderAriaLabelFormat:{dateStyle:"full"},displayEventEnd:!0,duration:{weeks:1},events:[],eventAllUpdated:void 0,eventBackgroundColor:void 0,eventTextColor:void 0,eventClassNames:void 0,eventClick:void 0,eventColor:void 0,eventContent:void 0,eventDidMount:void 0,eventMouseEnter:void 0,eventMouseLeave:void 0,eventSources:[],eventTimeFormat:{hour:"numeric",minute:"2-digit"},filterEventsWithResources:!1,filterResourcesWithEvents:!1,firstDay:0,flexibleSlotTimeLimits:!1,headerToolbar:{start:"title",center:"",end:"today prev,next"},height:void 0,hiddenDays:[],highlightedDates:[],lazyFetching:!0,loading:void 0,locale:void 0,nowIndicator:!1,resourceLabelContent:void 0,resourceLabelDidMount:void 0,resources:[],selectable:!1,scrollTime:"06:00:00",slotDuration:"00:30:00",slotEventOverlap:!0,slotHeight:24,slotLabelFormat:{hour:"numeric",minute:"2-digit"},slotMaxTime:"24:00:00",slotMinTime:"00:00:00",slotWidth:72,theme:{allDay:"ec-all-day",active:"ec-active",bgEvent:"ec-bg-event",bgEvents:"ec-bg-events",body:"ec-body",button:"ec-button",buttonGroup:"ec-button-group",calendar:"ec",compact:"ec-compact",content:"ec-content",day:"ec-day",dayHead:"ec-day-head",days:"ec-days",disabled:"ec-disabled",event:"ec-event",eventBody:"ec-event-body",eventTime:"ec-event-time",eventTitle:"ec-event-title",events:"ec-events",extra:"ec-extra",handle:"ec-handle",header:"ec-header",hiddenScroll:"ec-hidden-scroll",highlight:"ec-highlight",icon:"ec-icon",line:"ec-line",lines:"ec-lines",nowIndicator:"ec-now-indicator",otherMonth:"ec-other-month",resource:"ec-resource",sidebar:"ec-sidebar",sidebarTitle:"ec-sidebar-title",today:"ec-today",time:"ec-time",title:"ec-title",toolbar:"ec-toolbar",view:"",weekdays:["ec-sun","ec-mon","ec-tue","ec-wed","ec-thu","ec-fri","ec-sat"],withScroll:"ec-with-scroll"},titleFormat:{year:"numeric",month:"short",day:"numeric"},validRange:void 0,view:void 0,viewDidMount:void 0,views:{}};for(let i of t)i.createOptions?.(e);return e}function vPe(t){let e={date:i=>rc(Rh(i)),duration:wd,events:FT,eventSources:nPe,hiddenDays:i=>[...new Set(i)],highlightedDates:i=>i.map(n=>rc(Rh(n))),resources:hPe,scrollTime:wd,slotDuration:wd,slotMaxTime:wd,slotMinTime:wd,validRange:uPe};for(let i of t)i.createParsers?.(e);return e}function yPe(t,e){let i=[];for(let n of dh(t))t[n]!==e[n]&&i.push([n,t[n]]);return ox(e,t),i}function xPe(t){return ga(t.view,e=>e?.startsWith("dayGrid"))}function bPe(t){return ga([t._currentRange,t.firstDay,t.slotMaxTime,t._dayGrid],([e,i,n,r])=>{let s=qn(e.start),o=qn(e.end);if(r)oee(s,i),URe(o,i);else if(n.days||n.seconds>LT){Ba(T0(o),n);let a=T0(qn(o));a<s&&(s=a)}return{start:s,end:o}})}function wPe(t){return ga([t.date,t.duration,t.firstDay],([e,i,n])=>{let r=qn(e),s;return i.months?r.setUTCDate(1):i.inWeeks&&oee(r,n),s=Ba(qn(r),i),{start:r,end:s}})}function _Pe(t){return ga([t._activeRange,t.hiddenDays],([e,i])=>{let n=[],r=rc(qn(e.start)),s=rc(qn(e.end));for(;r<s;)i.includes(r.getUTCDay())||n.push(qn(r)),Ph(r);return!n.length&&i.length&&i.length<7&&(t.date.update(o=>{for(;i.includes(o.getUTCDay());)Ph(o);return o}),n=Mg(t._viewDates)),n})}function CPe(t){return ga([t.date,t._activeRange,t._intlTitle,t._dayGrid],([e,i,n,r])=>r?n.formatRange(e,e):n.formatRange(i.start,T0(qn(i.end))))}function SPe(t){return ga([t.view,t._viewTitle,t._currentRange,t._activeRange],e=>ePe(...e))}function OPe(t){let e=gr([]),i,n=0,r={};return ga([t.events,t.eventSources,t._activeRange,t._fetchedRange,t.lazyFetching,t.loading],(s,o)=>OP(()=>{let[a,l,u,d,p,v]=s;if(!l.length){o(a);return}if(!d.start||d.start>u.start||d.end<u.end||!p){i&&i.abort(),i=new AbortController,Gr(v)&&!n&&v(!0);let y=()=>{--n===0&&Gr(v)&&v(!1)},w=[],R=F=>y(),O=F=>{w=w.concat(FT(F)),o(w),y()},P=qd(u.start),N=qd(u.end);for(let F of l){if(Gr(F.events)){let k=F.events({start:ha(u.start),end:ha(u.end),startStr:P,endStr:N},O,R);k!==void 0&&Promise.resolve(k).then(O,R)}else{let k=Gr(F.extraParams)?F.extraParams():ox({},F.extraParams);k.start=P,k.end=N,k=new URLSearchParams(k);let $=F.url,W={},Q;["GET","HEAD"].includes(F.method)?$+=($.includes("?")?"&":"?")+k:(W["content-type"]="application/x-www-form-urlencoded;charset=UTF-8",Q=String(k)),fetch($,{method:F.method,headers:W,body:Q,signal:i.signal,credentials:"same-origin"}).then(Y=>Y.json()).then(O).catch(R)}++n}d.start=u.start,d.end=u.end}},r,t._queue),[]).subscribe(e.set),e}function MPe(){return KV(Rh(),t=>{let e=setInterval(()=>{t(Rh())},1e3);return()=>clearInterval(e)})}function TPe(t){return ga(t._now,e=>rc(qn(e)))}class RPe{constructor(e,i){e=e||[];let n=gPe(e),r=vPe(e);n=Dz(n,r),i=Dz(i,r);for(let[o,a]of Object.entries(n))this[o]=gr(a);this._queue=gr(new Map),this._queue2=gr(new Map),this._tasks=new Map,this._auxiliary=gr([]),this._dayGrid=xPe(this),this._currentRange=wPe(this),this._activeRange=bPe(this),this._fetchedRange=gr({start:void 0,end:void 0}),this._events=OPe(this),this._now=MPe(),this._today=TPe(this),this._intlEventTime=A6(this.locale,this.eventTimeFormat),this._intlSlotLabel=Kw(this.locale,this.slotLabelFormat),this._intlDayHeader=Kw(this.locale,this.dayHeaderFormat),this._intlDayHeaderAL=Kw(this.locale,this.dayHeaderAriaLabelFormat),this._intlTitle=A6(this.locale,this.titleFormat),this._bodyEl=gr(void 0),this._scrollable=gr(!1),this._viewTitle=CPe(this),this._viewDates=_Pe(this),this._view=SPe(this),this._viewComponent=gr(void 0),this._interaction=gr({}),this._iEvents=gr([null,null]),this._iClasses=gr(XRe),this._iClass=gr(void 0),this._set=(o,a)=>{Lz(o,this)&&(r[o]&&(a=r[o](a)),this[o].set(a))},this._get=o=>Lz(o,this)?Mg(this[o]):void 0;for(let o of e)o.createStores?.(this);i.view&&this.view.set(i.view);let s=new Set([...dh(n.views),...dh(i.views??{})]);for(let o of s){let a=I6(n,n.views[o]??{}),l=I6(a,i,i.views?.[o]??{}),u=l.component;PPe(l,this);for(let d of dh(l)){let{set:p,_set:v=p,...y}=this[d];this[d]={set:["buttonText","theme"].includes(d)?w=>{if(Gr(w)){let R=w(a[d]);l[d]=R,p(p===v?R:w)}else l[d]=w,p(w)}:w=>{l[d]=w,p(w)},_set:v,...y}}this.view.subscribe(d=>{if(d===o){this._viewComponent.set(u),Gr(l.viewDidMount)&&Hc().then(()=>l.viewDidMount(Mg(this._view)));for(let p of dh(l))this[p]._set(l[p])}})}}}function Dz(t,e){let i={...t};for(let n of dh(e))n in i&&(i[n]=e[n](i[n]));if(t.views){i.views={};for(let n of dh(t.views))i.views[n]=Dz(t.views[n],e)}return i}function I6(...t){let e={};for(let i of t){let n={};for(let r of["buttonText","theme"])Gr(i[r])&&(n[r]=i[r](e[r]));e={...e,...i,...n}}return e}function PPe(t,e){dh(t).filter(i=>!Lz(i,e)||i=="view").forEach(i=>delete t[i])}function Lz(t,e){return e.hasOwnProperty(t)&&t[0]!=="_"}var EPe=hi("<h2></h2>"),APe=hi("<button><i></i></button>"),IPe=hi("<button><i></i></button>"),kPe=hi("<button> </button>"),DPe=hi("<button></button>"),LPe=hi("<button> </button>");function k6(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(M,"$validRange",i),s=()=>dt($,"$date",i),o=()=>dt(W,"$duration",i),a=()=>dt(Q,"$hiddenDays",i),l=()=>dt(O,"$_currentRange",i),u=()=>dt(N,"$_viewDates",i),d=()=>dt(Y,"$theme",i),p=()=>dt(P,"$_viewTitle",i),v=()=>dt(F,"$buttonText",i),y=()=>dt(k,"$customButtons",i),w=()=>dt(D,"$view",i);let R=ht(e,"buttons",8),{_currentRange:O,_viewTitle:P,_viewDates:N,buttonText:F,customButtons:k,date:$,duration:W,hiddenDays:Q,theme:Y,validRange:M,view:D}=Xi("state"),G=rc(Rh()),j=Gt(),Z=Gt(),ie=Gt(),le=Gt(!1);function me(){return B(le)}function be(){return u().every(qe=>RP(qe,r()))}function fe(){Lr($,Iz(s(),o(),a()))}function Fe(){Lr($,Az(s(),o()))}Ui(()=>(r(),s(),o(),a(),B(ie),l(),Hc),()=>{if(!me()){if(rt(le,!0),rt(j,!1),rt(Z,!1),r().start){let qe=qn(s());Lr($,Iz(s(),o(),a())),rt(j,be()),Lr($,qe)}if(r().end){let qe=qn(s());Lr($,Az(s(),o())),rt(Z,be()),Lr($,qe)}if(rt(ie,G>=l().start&&G<l().end),!B(ie)&&(r().start||r().end)){let qe=qn(s());Lr($,qn(G)),rt(ie,be()),Lr($,qe)}Hc().then(()=>rt(le,!1))}}),Is(),ts();var He=nn(),je=pi(He);Ur(je,1,R,Sl,(qe,ct)=>{var Ge=nn(),Je=pi(Ge);{var mt=Ot=>{var Qt=EPe();Us(Qt,(ei,Jt)=>Yl?.(ei,Jt),p),Gi(()=>xi(Qt,1,d().title)),bt(Ot,Qt)},wt=(Ot,Qt)=>{{var ei=Yt=>{var Ut=APe(),Re=Di(Ut);_i(Ut),Gi(()=>{xi(Ut,1,`${d().button??""} ec-${B(ct)??""}`),yr(Ut,"aria-label",v().prev),yr(Ut,"title",v().prev),Ut.disabled=B(j),xi(Re,1,`${d().icon??""} ec-${B(ct)??""}`)}),Tn("click",Ut,fe),bt(Yt,Ut)},Jt=(Yt,Ut)=>{{var Re=it=>{var Pe=IPe(),Ye=Di(Pe);_i(Pe),Gi(()=>{xi(Pe,1,`${d().button??""} ec-${B(ct)??""}`),yr(Pe,"aria-label",v().next),yr(Pe,"title",v().next),Pe.disabled=B(Z),xi(Ye,1,`${d().icon??""} ec-${B(ct)??""}`)}),Tn("click",Pe,Fe),bt(it,Pe)},gi=(it,Pe)=>{{var Ye=st=>{var we=kPe(),he=Di(we,!0);_i(we),Gi(()=>{xi(we,1,`${d().button??""} ec-${B(ct)??""}`),we.disabled=B(ie),zd(he,v()[B(ct)])}),Tn("click",we,()=>Lr($,qn(G))),bt(st,we)},Ct=(st,we)=>{{var he=Be=>{var $e=DPe();mh(()=>Tn("click",$e,function(...Ze){y()[B(ct)].click?.apply(this,Ze)})),Us($e,(Ze,Lt)=>Yl?.(Ze,Lt),()=>y()[B(ct)].text),Gi(()=>xi($e,1,`${d().button??""} ec-${B(ct)??""}${(y()[B(ct)].active?" "+d().active:"")??""}`)),bt(Be,$e)},xe=(Be,$e)=>{{var Ze=Lt=>{var ot=LPe(),Nt=Di(ot,!0);_i(ot),Gi(()=>{xi(ot,1,`${d().button??""}${(w()===B(ct)?" "+d().active:"")??""} ec-${B(ct)??""}`),zd(Nt,v()[B(ct)])}),Tn("click",ot,()=>Lr(D,B(ct))),bt(Lt,ot)};Yi(Be,Lt=>{B(ct)!=""&&Lt(Ze)},$e)}};Yi(st,Be=>{y()[B(ct)]?Be(he):Be(xe,!1)},we)}};Yi(it,st=>{B(ct)=="today"?st(Ye):st(Ct,!1)},Pe)}};Yi(Yt,it=>{B(ct)=="next"?it(Re):it(gi,!1)},Ut)}};Yi(Ot,Yt=>{B(ct)=="prev"?Yt(ei):Yt(Jt,!1)},Qt)}};Yi(Je,Ot=>{B(ct)=="title"?Ot(mt):Ot(wt,!1)})}bt(qe,Ge)}),bt(t,He),Ei(),n()}var FPe=hi("<div><!></div>"),NPe=hi("<div></div>"),BPe=hi("<nav></nav>");function zPe(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(o,"$headerToolbar",i),s=()=>dt(a,"$theme",i);let{headerToolbar:o,theme:a}=Xi("state"),l=Gt({start:[],center:[],end:[]});Ui(()=>(B(l),r()),()=>{for(let d of dh(B(l)))xl(l,B(l)[d]=r()[d].split(" ").map(p=>p.split(",")))}),Is(),ts();var u=BPe();Ur(u,5,()=>dh(B(l)),Sl,(d,p)=>{var v=NPe();Ur(v,5,()=>B(l)[B(p)],Sl,(y,w)=>{var R=nn(),O=pi(R);{var P=F=>{var k=FPe(),$=Di(k);k6($,{get buttons(){return B(w)}}),_i(k),Gi(()=>xi(k,1,s().buttonGroup)),bt(F,k)},N=F=>{k6(F,{get buttons(){return B(w)}})};Yi(O,F=>{B(w).length>1?F(P):F(N,!1)})}bt(y,R)}),_i(v),Gi(()=>xi(v,1,`ec-${B(p)??""}`)),bt(d,v)}),_i(u),Gi(()=>xi(u,1,s().toolbar)),bt(t,u),Ei(),n()}function VPe(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(d,"$_activeRange",i),s=()=>dt(l,"$datesSet",i),o=()=>dt(v,"$_view",i),a=()=>dt(u,"$_auxiliary",i);let{datesSet:l,_auxiliary:u,_activeRange:d,_queue:p,_view:v}=Xi("state"),y={};function w(P){Gr(s())&&OP(()=>s()({start:ha(P.start),end:ha(P.end),startStr:qd(P.start),endStr:qd(P.end),view:Jl(o())}),y,p)}Ui(()=>r(),()=>{w(r())}),Is(),ts();var R=nn(),O=pi(R);Ur(O,1,a,Sl,(P,N)=>{var F=nn(),k=pi(F);dl(k,()=>B(N),($,W)=>{W($,{})}),bt(P,F)}),bt(t,R),Ei(),n()}var GPe=hi("<div><!> <!></div> <!>",1);function UPe(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(M,"$_events",i),s=()=>dt(Q,"$_interaction",i),o=()=>dt(ie,"$date",i),a=()=>dt(le,"$duration",i),l=()=>dt(me,"$hiddenDays",i),u=()=>dt(D,"$_queue",i),d=()=>dt(G,"$_queue2",i),p=()=>dt(W,"$_bodyEl",i),v=()=>dt(Z,"$_scrollable",i),y=()=>dt(fe,"$theme",i),w=()=>dt(Y,"$_iClass",i),R=()=>dt(be,"$height",i),O=()=>dt(Fe,"$view",i),P=()=>dt($,"$_viewComponent",i);let N=ht(e,"plugins",24,()=>[]),F=ht(e,"options",24,()=>({})),k=new RPe(N(),F());ks("state",k);let{_viewComponent:$,_bodyEl:W,_interaction:Q,_iClass:Y,_events:M,_queue:D,_queue2:G,_tasks:j,_scrollable:Z,date:ie,duration:le,hiddenDays:me,height:be,theme:fe,view:Fe}=k,He={...F()};function je(he,xe){return k._set(he,xe),this}function qe(he){let xe=k._get(he);return xe instanceof Date?ha(xe):xe}function ct(){return k._fetchedRange.set({start:void 0,end:void 0}),this}function Ge(){return r().map(kc)}function Je(he){for(let xe of r())if(xe.id==he)return kc(xe);return null}function mt(he){return he=FT([he])[0],r().push(he),Lr(M,r()),kc(he)}function wt(he){for(let xe of r())if(xe.id==he.id)return he=FT([he])[0],ox(xe,he),Lr(M,r()),kc(he);return null}function Ot(he){let xe=r().findIndex(Be=>Be.id==he);return xe>=0&&(r().splice(xe,1),Lr(M,r())),this}function Qt(){return Jl(Mg(k._view))}function ei(){return s().action?.unselect(),this}function Jt(he,xe){let Be=lee(he,xe);if(Be){let $e=YRe(Be)(he,xe);return $e.date=ha($e.date),$e}return null}function Yt(){return Lr(ie,Az(o(),a())),this}function Ut(){return Lr(ie,Iz(o(),a(),l())),this}ble(()=>{P6(u())}),eP(()=>{P6(d()),MP(Re,null,j)});function Re(){p()&&Lr(Z,JRe(p()))}Ui(()=>en(F()),()=>{for(let[he,xe]of yPe(F(),He))je(he,xe)}),Is(),ts();var gi=GPe();Tn("resize",JR,Re);var it=pi(gi);let Pe;var Ye=Di(it);zPe(Ye,{});var Ct=vi(Ye,2);dl(Ct,P,(he,xe)=>{xe(he,{})}),_i(it);var st=vi(it,2);VPe(st,{}),Gi(he=>{xi(it,1,`${y().calendar??""} ${y().view??""}${(v()?" "+y().withScroll:"")??""}${(w()?" "+y()[w()]:"")??""}`),yr(it,"role",he),Pe=Jd(it,"",Pe,{height:R()})},[()=>tPe(O())?"list":"table"],_h),bt(t,gi),Ks(e,"setOption",je),Ks(e,"getOption",qe),Ks(e,"refetchEvents",ct),Ks(e,"getEvents",Ge),Ks(e,"getEventById",Je),Ks(e,"addEvent",mt),Ks(e,"updateEvent",wt),Ks(e,"removeEventById",Ot),Ks(e,"getView",Qt),Ks(e,"unselect",ei),Ks(e,"dateFromPoint",Jt),Ks(e,"next",Yt),Ks(e,"prev",Ut);var we=Ei({setOption:je,getOption:qe,refetchEvents:ct,getEvents:Ge,getEventById:Je,addEvent:mt,updateEvent:wt,removeEventById:Ot,getView:Qt,unselect:ei,dateFromPoint:Jt,next:Yt,prev:Ut});return n(),we}function HPe(t){return ga([t.slotDuration,t._slotTimeLimits,t._intlSlotLabel],e=>pPe(rc(Rh()),...e))}function $Pe(t){return ga([t.slotMinTime,t.slotMaxTime,t.flexibleSlotTimeLimits,t._viewDates,t._events],e=>mPe(...e))}function D6(t){if(!t.length)return;cee(t);let e={columns:[],end:t[0].end};for(let i of t){let n=0;if(i.start<e.end){for(;n<e.columns.length&&!(e.columns[n].at(-1).end<=i.start);++n);i.end>e.end&&(e.end=i.end)}else e={columns:[],end:i.end};e.columns.length<n+1&&e.columns.push([]),e.columns[n].push(i),i.group=e,i.column=n}}function WPe(t){let e="all-day",i;return t?(i=Gr(t)?t({text:e}):t,typeof i=="string"&&(i={html:i})):i={html:e},i}var qPe=hi("<time></time>"),jPe=hi('<div><div></div> <!></div> <div role="row"><div><!></div> <!></div>',1);function Fz(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(a,"$allDayContent",i),s=()=>dt(l,"$theme",i),o=()=>dt(u,"$_times",i);let{allDayContent:a,theme:l,_times:u}=Xi("state"),d=Gt();Ui(()=>r(),()=>{rt(d,WPe(r()))}),Is(),ts();var p=jPe(),v=pi(p),y=Di(v);Us(y,(F,k)=>Yl?.(F,k),()=>B(d));var w=vi(y,2);Ur(w,1,o,Sl,(F,k)=>{var $=qPe();Us($,(W,Q)=>Yl?.(W,Q),()=>B(k)[2]?B(k)[1]:""),Gi(()=>{xi($,1,s().time),yr($,"datetime",B(k)[0])}),bt(F,$)}),_i(v);var R=vi(v,2),O=Di(R),P=Di(O);c0(P,e,"lines",{},null),_i(O);var N=vi(O,2);c0(N,e,"default",{},null),_i(R),Gi(()=>{xi(v,1,s().sidebar),xi(y,1,s().sidebarTitle),xi(R,1,s().days),xi(O,1,s().lines)}),bt(t,p),Ei(),n()}var QPe=hi("<div></div>"),ZPe=hi("<div><div><!></div></div>");function XPe(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(O,"$slotDuration",i),s=()=>dt(w,"$_times",i),o=()=>dt(v,"$_viewDates",i),a=()=>dt(R,"$scrollTime",i),l=()=>dt(y,"$_slotTimeLimits",i),u=()=>dt(P,"$slotHeight",i),d=()=>dt(N,"$theme",i);let{_bodyEl:p,_viewDates:v,_slotTimeLimits:y,_times:w,scrollTime:R,slotDuration:O,slotHeight:P,theme:N}=Xi("state"),F=Gt(),k=Gt(),$=Gt([]);function W(){xl(F,B(F).scrollTop=((a().seconds-l().min.seconds)/r().seconds-.5)*u())}Ui(()=>B(F),()=>{Lr(p,B(F))}),Ui(()=>(r(),s()),()=>{rt(k,r().seconds>=3600),xl($,B($).length=s().length)}),Ui(()=>(B(F),o(),a()),()=>{B(F)&&(o(),a(),W())}),Is(),ts();var Q=ZPe(),Y=Di(Q),M=Di(Y);Fz(M,{children:(D,G)=>{var j=nn(),Z=pi(j);c0(Z,e,"default",{},null),bt(D,j)},$$slots:{default:!0,lines:(D,G)=>{var j=nn(),Z=pi(j);Ur(Z,1,()=>B($),Sl,(ie,le)=>{var me=QPe();Gi(()=>xi(me,1,d().line)),bt(ie,me)}),bt(D,j)}}}),_i(Y),_i(Q),es(Q,D=>rt(F,D),()=>B(F)),Gi(()=>{xi(Q,1,`${d().body??""}${(B(k)?" "+d().compact:"")??""}`),xi(Y,1,d().content)}),bt(t,Q),Ei(),n()}var KPe=hi("<article><!> <div></div> <!></article>");function Y1(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(ct,"$slotDuration",i),s=()=>dt(Jt,"$_slotTimeLimits",i),o=()=>dt(Ge,"$slotHeight",i),a=()=>dt(Je,"$resources",i),l=()=>dt(Z,"$eventBackgroundColor",i),u=()=>dt(le,"$eventColor",i),d=()=>dt(ie,"$eventTextColor",i),p=()=>dt(qe,"$slotEventOverlap",i),v=()=>dt(mt,"$theme",i),y=()=>dt(ei,"$_iClasses",i),w=()=>dt(Fe,"$eventClassNames",i),R=()=>dt(wt,"$_view",i),O=()=>dt(G,"$displayEventEnd",i),P=()=>dt(me,"$eventContent",i),N=()=>dt(Ot,"$_intlEventTime",i),F=()=>dt(fe,"$eventDidMount",i),k=()=>dt(j,"$eventAllUpdated",i),$=()=>dt(be,"$eventClick",i),W=()=>dt(He,"$eventMouseEnter",i),Q=()=>dt(je,"$eventMouseLeave",i),Y=()=>dt(Qt,"$_interaction",i);let M=ht(e,"date",8),D=ht(e,"chunk",8),{displayEventEnd:G,eventAllUpdated:j,eventBackgroundColor:Z,eventTextColor:ie,eventColor:le,eventContent:me,eventClick:be,eventDidMount:fe,eventClassNames:Fe,eventMouseEnter:He,eventMouseLeave:je,slotEventOverlap:qe,slotDuration:ct,slotHeight:Ge,resources:Je,theme:mt,_view:wt,_intlEventTime:Ot,_interaction:Qt,_iClasses:ei,_slotTimeLimits:Jt,_tasks:Yt}=Xi("state"),Ut=Gt(),Re=Gt(),gi=Gt(),it=Gt(),Pe=Gt(),Ye=Gt(),Ct=Gt(),st=Gt();Xo(()=>{Gr(F())&&F()({event:kc(B(Re)),timeText:B(Ct),el:B(Ut),view:Jl(R())})}),eP(()=>{Gr(k())&&!fh(B(gi))&&MP(()=>k()({view:Jl(R())}),"eau",Yt)});function we(ti,nt){return!fh(nt)&&Gr(ti)?Ce=>ti({event:kc(B(Re)),el:B(Ut),jsEvent:Ce,view:Jl(R())}):void 0}function he(ti,nt){return ti.action?Ce=>ti.action.drag(B(Re),Ce,nt,void 0,void 0,D().zeroDuration):void 0}Ui(()=>en(D()),()=>{rt(Re,D().event)}),Ui(()=>(B(gi),B(Re),r(),s(),en(D()),en(M()),o(),a(),l(),u(),d(),B(Pe),p(),v(),y(),w(),R()),()=>{rt(gi,B(Re).display);let ti=r().seconds,nt=s().min.seconds,Ce=(D().start-M())/1e3,oe=(D().end-M())/1e3,re=(Ce-nt)/ti*o(),ee=(oe-Ce)/ti*o()||o(),te=(s().max.seconds-Ce)/ti*o(),Se=B(Re).backgroundColor||zU(B(Re),a())||l()||u(),ve=B(Re).textColor||VU(B(Re),a())||d();rt(Pe,`top:${re}px;min-height:${ee}px;height:${ee}px;max-height:${te}px;`),Se&&rt(Pe,B(Pe)+`background-color:${Se};`),ve&&rt(Pe,B(Pe)+`color:${ve};`),(!Dc(B(gi))&&!fh(B(gi))||hee(B(gi)))&&rt(Pe,B(Pe)+`z-index:${D().column+1};left:${100/D().group.columns.length*D().column}%;width:${100/D().group.columns.length*(p()?.5*(1+D().group.columns.length-D().column):1)}%;`),rt(Pe,B(Pe)+B(Re).styles.join(";")),rt(it,[Dc(B(gi))?v().bgEvent:v().event,...y()([],B(Re)),...NU(w(),B(Re),R())].join(" "))}),Ui(()=>(B(Ct),B(Ye),en(D()),O(),P(),v(),N(),R()),()=>{(ti=>(rt(Ct,ti[0]),rt(Ye,ti[1])))(FU(D(),O(),P(),v(),N(),R()))}),Ui(()=>(B(gi),$()),()=>{rt(st,!Dc(B(gi))&&we($(),B(gi)))}),Is(),ts();var xe=KPe(),Be=Vt(()=>B(st)&&GC(B(st))),$e=Vt(()=>we(W(),B(gi))),Ze=Vt(()=>we(Q(),B(gi))),Lt=Vt(()=>!Dc(B(gi))&&!fh(B(gi))&&he(Y())),ot=Di(xe),Nt=Vt(()=>he(Y(),["y","start"]));dl(ot,()=>Y().resizer,(ti,nt)=>{nt(ti,{start:!0,get event(){return B(Re)},$$events:{pointerdown(...Ce){B(Nt)?.apply(this,Ce)}}})});var fi=vi(ot,2);Us(fi,(ti,nt)=>Yl?.(ti,nt),()=>B(Ye));var Pt=vi(fi,2),ni=Vt(()=>he(Y(),["y","end"]));dl(Pt,()=>Y().resizer,(ti,nt)=>{nt(ti,{get event(){return B(Re)},$$events:{pointerdown(...Ce){B(ni)?.apply(this,Ce)}}})}),_i(xe),es(xe,ti=>rt(Ut,ti),()=>B(Ut)),Gi(()=>{xi(xe,1,B(it)),Jd(xe,B(Pe)),yr(xe,"role",B(st)?"button":void 0),yr(xe,"tabindex",B(st)?0:void 0),xi(fi,1,v().eventBody)}),Tn("click",xe,function(...ti){B(st)?.apply(this,ti)}),Tn("keydown",xe,function(...ti){B(Be)?.apply(this,ti)}),Tn("mouseenter",xe,function(...ti){B($e)?.apply(this,ti)}),Tn("mouseleave",xe,function(...ti){B(Ze)?.apply(this,ti)}),Tn("pointerdown",xe,function(...ti){B(Lt)?.apply(this,ti)}),bt(t,xe),Ei(),n()}var YPe=hi("<div></div>");function JPe(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(y,"$_now",i),s=()=>dt(w,"$_today",i),o=()=>dt(d,"$slotDuration",i),a=()=>dt(R,"$_slotTimeLimits",i),l=()=>dt(p,"$slotHeight",i),u=()=>dt(v,"$theme",i);let{slotDuration:d,slotHeight:p,theme:v,_now:y,_today:w,_slotTimeLimits:R}=Xi("state"),O=Gt(),P=Gt(0);Ui(()=>(r(),s()),()=>{rt(O,(r()-s())/1e3/60)}),Ui(()=>(o(),a(),B(O),l()),()=>{let F=o().seconds/60,k=a().min.seconds/60;rt(P,(B(O)-k)/F*l())}),Is(),ts();var N=YPe();Gi(()=>{xi(N,1,u().nowIndicator),Jd(N,`top:${B(P)??""}px`)}),bt(t,N),Ei(),n()}var eEe=hi("<!> <!> <!>",1),tEe=hi('<div role="cell"><div><!></div> <div><!></div> <div><!></div></div>');function iEe(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(ie,"$_today",i),s=()=>dt($,"$highlightedDates",i),o=()=>dt(j,"$validRange",i),a=()=>dt(le,"$_slotTimeLimits",i),l=()=>dt(M,"$filterEventsWithResources",i),u=()=>dt(G,"$resources",i),d=()=>dt(F,"$_events",i),p=()=>dt(k,"$_iEvents",i),v=()=>dt(Q,"$slotDuration",i),y=()=>dt(Y,"$slotHeight",i),w=()=>dt(D,"$theme",i),R=()=>dt(Z,"$_interaction",i),O=()=>dt(W,"$nowIndicator",i);let P=ht(e,"date",8),N=ht(e,"resource",8,void 0),{_events:F,_iEvents:k,highlightedDates:$,nowIndicator:W,slotDuration:Q,slotHeight:Y,filterEventsWithResources:M,theme:D,resources:G,validRange:j,_interaction:Z,_today:ie,_slotTimeLimits:le}=Xi("state"),me=Gt(),be=Gt(),fe=Gt(),Fe=Gt([]),He=Gt(),je=Gt(),qe=Gt(),ct=Gt(),Ge=Gt(),Je=Gt();function mt(Pe,Ye){return Ye-=Id(B(me)).top,{allDay:!1,date:Ba(Ba(qn(P()),a().min),v(),qRe(Ye/y())),resource:N(),dayEl:B(me),disabled:B(qe)}}Ui(()=>(en(P()),r()),()=>{rt(He,To(P(),r()))}),Ui(()=>(s(),en(P())),()=>{rt(je,s().some(Pe=>To(Pe,P())))}),Ui(()=>(en(P()),o()),()=>{rt(qe,RP(P(),o()))}),Ui(()=>(B(qe),en(P()),a()),()=>{B(qe)||(rt(Ge,Ba(qn(P()),a().min)),rt(Je,Ba(qn(P()),a().max)))}),Ui(()=>(en(N()),l(),u()),()=>{rt(ct,N()??(l()?u():void 0))}),Ui(()=>(B(qe),B(be),B(fe),d(),B(Ge),B(Je),B(ct),D6),()=>{if(!B(qe)){rt(be,[]),rt(fe,[]);for(let Pe of d())if((!Pe.allDay||Dc(Pe.display))&&R0(Pe,B(Ge),B(Je),B(ct))){let Ye=gp(Pe,B(Ge),B(Je));switch(Pe.display){case"background":B(fe).push(Ye);break;default:B(be).push(Ye)}}D6(B(be))}}),Ui(()=>(B(qe),p(),B(Ge),B(Je),en(N()),gp),()=>{B(qe)||rt(Fe,p().map(Pe=>Pe&&R0(Pe,B(Ge),B(Je),N())?gp(Pe,B(Ge),B(Je)):null))}),Ui(()=>(B(me),j_),()=>{B(me)&&j_(B(me),mt)}),Is(),ts();var wt=tEe(),Ot=Di(wt),Qt=Di(Ot);{var ei=Pe=>{var Ye=nn(),Ct=pi(Ye);Ur(Ct,1,()=>B(fe),st=>st.event,(st,we)=>{Y1(st,{get date(){return P()},get chunk(){return B(we)}})}),bt(Pe,Ye)};Yi(Qt,Pe=>{B(qe)||Pe(ei)})}_i(Ot);var Jt=vi(Ot,2),Yt=Di(Jt);{var Ut=Pe=>{var Ye=eEe(),Ct=pi(Ye);{var st=Be=>{Y1(Be,{get date(){return P()},get chunk(){return B(Fe)[1]}})};Yi(Ct,Be=>{B(Fe)[1]&&Be(st)})}var we=vi(Ct,2);Ur(we,1,()=>B(be),Be=>Be.event,(Be,$e)=>{Y1(Be,{get date(){return P()},get chunk(){return B($e)}})});var he=vi(we,2);{var xe=Be=>{Y1(Be,{get date(){return P()},get chunk(){return B(Fe)[0]}})};Yi(he,Be=>{B(Fe)[0]&&!B(Fe)[0].event.allDay&&Be(xe)})}bt(Pe,Ye)};Yi(Yt,Pe=>{B(qe)||Pe(Ut)})}_i(Jt);var Re=vi(Jt,2),gi=Di(Re);{var it=Pe=>{JPe(Pe,{})};Yi(gi,Pe=>{O()&&B(He)&&!B(qe)&&Pe(it)})}_i(Re),_i(wt),es(wt,Pe=>rt(me,Pe),()=>B(me)),Gi(Pe=>{xi(wt,1,`${w().day??""} ${Pe??""}${(B(He)?" "+w().today:"")??""}${(B(je)?" "+w().highlight:"")??""}${(B(qe)?" "+w().disabled:"")??""}`),xi(Ot,1,w().bgEvents),xi(Jt,1,w().events),xi(Re,1,w().extra)},[()=>w().weekdays?.[P().getUTCDay()]],_h),Tn("pointerdown",wt,function(...Pe){(B(qe)?void 0:R().action?.select)?.apply(this,Pe)}),bt(t,wt),Ei(),n()}var nEe=hi("<article><!> <div></div> <!></article>");function hN(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(fe,"$resources",i),s=()=>dt(M,"$eventBackgroundColor",i),o=()=>dt(j,"$eventColor",i),a=()=>dt(D,"$eventTextColor",i),l=()=>dt(Fe,"$theme",i),u=()=>dt(ct,"$_iClasses",i),d=()=>dt(ie,"$eventClassNames",i),p=()=>dt(He,"$_view",i),v=()=>dt(Q,"$displayEventEnd",i),y=()=>dt(Z,"$eventContent",i),w=()=>dt(je,"$_intlEventTime",i),R=()=>dt(le,"$eventDidMount",i),O=()=>dt(Y,"$eventAllUpdated",i),P=()=>dt(G,"$eventClick",i),N=()=>dt(me,"$eventMouseEnter",i),F=()=>dt(be,"$eventMouseLeave",i),k=()=>dt(qe,"$_interaction",i);let $=ht(e,"chunk",8),W=ht(e,"longChunks",24,()=>({})),{displayEventEnd:Q,eventAllUpdated:Y,eventBackgroundColor:M,eventTextColor:D,eventClick:G,eventColor:j,eventContent:Z,eventClassNames:ie,eventDidMount:le,eventMouseEnter:me,eventMouseLeave:be,resources:fe,theme:Fe,_view:He,_intlEventTime:je,_interaction:qe,_iClasses:ct,_tasks:Ge}=Xi("state"),Je=Gt(),mt=Gt(),wt=Gt(),Ot=Gt(),Qt=Gt(),ei=Gt(),Jt=Gt(1),Yt=Gt(),Ut=Gt();Xo(()=>{Gr(R())&&R()({event:kc(B(mt)),timeText:B(ei),el:B(Je),view:Jl(p())})}),eP(()=>{Gr(O())&&!fh(B(Yt))&&MP(()=>O()({view:Jl(p())}),"eau",Ge)});function Re(ot,Nt){return!fh(Nt)&&Gr(ot)?fi=>ot({event:kc(B(mt)),el:B(Je),jsEvent:fi,view:Jl(p())}):void 0}function gi(ot,Nt){return ot.action?fi=>ot.action.drag(B(mt),fi,Nt,null,Id(B(Je)).top-Id(Q_(B(Je),1)).top,$().zeroDuration):void 0}function it(){B(Je)&&rt(Jt,uee($(),W(),_w(B(Je))))}Ui(()=>en($()),()=>{rt(mt,$().event)}),Ui(()=>(B(Yt),B(mt),r(),s(),o(),a(),B(Ot),en($()),B(Jt),l(),u(),d(),p()),()=>{rt(Yt,B(mt).display);let ot=B(mt).backgroundColor||zU(B(mt),r())||s()||o(),Nt=B(mt).textColor||VU(B(mt),r())||a();Dc(B(Yt))?rt(Ot,`width:calc(${$().days*100}% + ${$().days-1}px);`):rt(Ot,`width:calc(${$().days*100}% + ${($().days-1)*7}px);margin-top:${B(mt)._margin??B(Jt)}px;`),ot&&rt(Ot,B(Ot)+`background-color:${ot};`),Nt&&rt(Ot,B(Ot)+`color:${Nt};`),rt(Ot,B(Ot)+B(mt).styles.join(";")),rt(wt,[Dc(B(Yt))?l().bgEvent:l().event,...u()([],B(mt)),...NU(d(),B(mt),p())].join(" "))}),Ui(()=>(B(ei),B(Qt),en($()),v(),y(),l(),w(),p()),()=>{(ot=>(rt(ei,ot[0]),rt(Qt,ot[1])))(FU($(),v(),y(),l(),w(),p()))}),Ui(()=>(P(),B(Yt)),()=>{rt(Ut,Re(P(),B(Yt)))}),Is(),ts();var Pe=nEe(),Ye=Vt(()=>B(Ut)&&GC(B(Ut))),Ct=Vt(()=>Re(N(),B(Yt))),st=Vt(()=>Re(F(),B(Yt))),we=Vt(()=>!fh(B(Yt))&&gi(k())),he=Di(Pe),xe=Vt(()=>gi(k(),["x","start"]));dl(he,()=>k().resizer,(ot,Nt)=>{Nt(ot,{start:!0,get event(){return B(mt)},$$events:{pointerdown(...fi){B(xe)?.apply(this,fi)}}})});var Be=vi(he,2);Us(Be,(ot,Nt)=>Yl?.(ot,Nt),()=>B(Qt));var $e=vi(Be,2),Ze=Vt(()=>gi(k(),["x","end"]));dl($e,()=>k().resizer,(ot,Nt)=>{Nt(ot,{get event(){return B(mt)},$$events:{pointerdown(...fi){B(Ze)?.apply(this,fi)}}})}),_i(Pe),es(Pe,ot=>rt(Je,ot),()=>B(Je)),Gi(()=>{xi(Pe,1,B(wt)),Jd(Pe,B(Ot)),yr(Pe,"role",B(Ut)?"button":void 0),yr(Pe,"tabindex",B(Ut)?0:void 0),xi(Be,1,l().eventBody)}),Tn("click",Pe,function(...ot){B(Ut)?.apply(this,ot)}),Tn("keydown",Pe,function(...ot){B(Ye)?.apply(this,ot)}),Tn("mouseenter",Pe,function(...ot){B(Ct)?.apply(this,ot)}),Tn("mouseleave",Pe,function(...ot){B(st)?.apply(this,ot)}),Tn("pointerdown",Pe,function(...ot){B(we)?.apply(this,ot)}),bt(t,Pe),Ks(e,"reposition",it);var Lt=Ei({reposition:it});return n(),Lt}var rEe=hi("<div><!></div>"),sEe=hi('<div role="cell"><div><!></div> <!> <div><!></div></div>');function oEe(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(F,"$_today",i),s=()=>dt(R,"$highlightedDates",i),o=()=>dt(P,"$validRange",i),a=()=>dt(O,"$theme",i),l=()=>dt(N,"$_interaction",i);let u=ht(e,"date",8),d=ht(e,"chunks",8),p=ht(e,"bgChunks",8),v=ht(e,"longChunks",8),y=ht(e,"iChunks",24,()=>[]),w=ht(e,"resource",8,void 0),{highlightedDates:R,theme:O,validRange:P,_interaction:N,_today:F}=Xi("state"),k=Gt(),$=Gt(),W=Gt(),Q=Gt(),Y=Gt(),M=Gt(),D=Gt([]);function G(){B(M)||TP(B(D),B($))}Ui(()=>(en(d()),en(u())),()=>{rt($,d().filter(qe=>To(qe.date,u())))}),Ui(()=>(en(p()),en(u())),()=>{rt(W,p().filter(qe=>To(qe.date,u())))}),Ui(()=>(en(u()),r()),()=>{rt(Q,To(u(),r()))}),Ui(()=>(s(),en(u())),()=>{rt(Y,s().some(qe=>To(qe,u())))}),Ui(()=>(en(u()),o()),()=>{rt(M,RP(u(),o()))}),Ui(()=>(B(k),en(u()),en(w()),B(M)),()=>{B(k)&&j_(B(k),()=>({allDay:!0,date:u(),resource:w(),dayEl:B(k),disabled:B(M)}))}),Is(),ts();var j=sEe(),Z=Di(j),ie=Di(Z);{var le=qe=>{var ct=nn(),Ge=pi(ct);Ur(Ge,1,()=>B(W),Je=>Je.event,(Je,mt)=>{hN(Je,{get chunk(){return B(mt)}})}),bt(qe,ct)};Yi(ie,qe=>{B(M)||qe(le)})}_i(Z);var me=vi(Z,2);{var be=qe=>{var ct=rEe(),Ge=Di(ct);hN(Ge,{get chunk(){return y()[0]}}),_i(ct),Gi(()=>xi(ct,1,`${a().events??""} ${a().preview??""}`)),bt(qe,ct)};Yi(me,qe=>{y()[0]&&To(y()[0].date,u())&&!B(M)&&qe(be)})}var fe=vi(me,2),Fe=Di(fe);{var He=qe=>{var ct=nn(),Ge=pi(ct);Ur(Ge,3,()=>B($),Je=>Je.event,(Je,mt,wt)=>{es(hN(Je,{get chunk(){return B(mt)},get longChunks(){return v()},$$legacy:!0}),(Ot,Qt)=>xl(D,B(D)[Qt]=Ot),Ot=>B(D)?.[Ot],()=>[B(wt)])}),bt(qe,ct)};Yi(Fe,qe=>{B(M)||qe(He)})}_i(fe),_i(j),es(j,qe=>rt(k,qe),()=>B(k)),Gi(qe=>{xi(j,1,`${a().day??""} ${qe??""}${(B(Q)?" "+a().today:"")??""}${(B(Y)?" "+a().highlight:"")??""}${(B(M)?" "+a().disabled:"")??""}`),xi(Z,1,a().bgEvents),xi(fe,1,a().events)},[()=>a().weekdays?.[u().getUTCDay()]],_h),Tn("pointerdown",j,function(...qe){(B(M)?void 0:l().action?.select)?.apply(this,qe)}),bt(t,j),Ks(e,"reposition",G);var je=Ei({reposition:G});return n(),je}function aEe(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(N,"$validRange",i),s=()=>dt(P,"$filterEventsWithResources",i),o=()=>dt(O,"$resources",i),a=()=>dt(v,"$_events",i),l=()=>dt(R,"$hiddenDays",i),u=()=>dt(y,"$_iEvents",i);let d=ht(e,"dates",8),p=ht(e,"resource",8,void 0),{_events:v,_iEvents:y,_queue2:w,hiddenDays:R,resources:O,filterEventsWithResources:P,validRange:N}=Xi("state"),F=Gt(),k=Gt(),$=Gt(),W=Gt([]),Q=Gt(),Y=Gt(),M=Gt([]),D=Gt(),G={};function j(){OP(()=>TP(B(M),d()),G,w)}Ui(()=>(en(d()),r(),qn),()=>{rt(Q,NT(d()[0],r())),rt(Y,Ph(qn(NT(d().at(-1),r()))))}),Ui(()=>(en(p()),s(),o()),()=>{rt(D,p()??(s()?o():void 0))}),Ui(()=>(B(F),B(k),a(),B(Q),B(Y),B(D),l()),()=>{rt(F,[]),rt(k,[]);for(let le of a())if(le.allDay&&R0(le,B(Q),B(Y),B(D))){let me=gp(le,B(Q),B(Y));Dc(le.display)?B(k).push(me):B(F).push(me)}i0(B(k),l()),rt($,i0(B(F),l())),j()}),Ui(()=>(u(),B(Q),B(Y),en(p()),l()),()=>{rt(W,u().map(le=>{let me;return le&&le.allDay&&R0(le,B(Q),B(Y),p())?(me=gp(le,B(Q),B(Y)),i0([me],l())):me=null,me}))}),Is(),ts();var Z=nn();Tn("resize",JR,j);var ie=pi(Z);Ur(ie,1,d,Sl,(le,me,be)=>{es(oEe(le,{get date(){return B(me)},get chunks(){return B(F)},get bgChunks(){return B(k)},get longChunks(){return B($)},get iChunks(){return B(W)},get resource(){return p()},$$legacy:!0}),(fe,Fe)=>xl(M,B(M)[Fe]=fe),fe=>B(M)?.[fe],()=>[be])}),bt(t,Z),Ei(),n()}var lEe=hi('<div role="columnheader"><time></time></div>'),cEe=hi("<div><div><!> <div></div></div></div>"),uEe=hi("<div><!> <div></div></div> <!> <!>",1);function L6(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(y,"$theme",i),s=()=>dt(u,"$_viewDates",i),o=()=>dt(p,"$_intlDayHeaderAL",i),a=()=>dt(d,"$_intlDayHeader",i),l=()=>dt(v,"$allDaySlot",i);let{_viewDates:u,_intlDayHeader:d,_intlDayHeaderAL:p,allDaySlot:v,theme:y}=Xi("state");ts();var w=uEe(),R=pi(w),O=Di(R);Fz(O,{children:($,W)=>{var Q=nn(),Y=pi(Q);Ur(Y,1,s,Sl,(M,D)=>{var G=lEe(),j=Di(G);Us(j,(Z,ie)=>Yl?.(Z,ie),()=>a().format(B(D))),_i(G),Gi((Z,ie,le)=>{xi(G,1,`${r().day??""} ${Z??""}`),yr(j,"datetime",ie),yr(j,"aria-label",le)},[()=>r().weekdays?.[B(D).getUTCDay()],()=>qd(B(D),10),()=>o().format(B(D))],_h),bt(M,G)}),bt($,Q)},$$slots:{default:!0}});var P=vi(O,2);_i(R);var N=vi(R,2);{var F=$=>{var W=cEe(),Q=Di(W),Y=Di(Q);Fz(Y,{children:(D,G)=>{aEe(D,{get dates(){return s()}})},$$slots:{default:!0}});var M=vi(Y,2);_i(Q),_i(W),Gi(()=>{xi(W,1,r().allDay),xi(Q,1,r().content),xi(M,1,r().hiddenScroll)}),bt($,W)};Yi(N,$=>{l()&&$(F)})}var k=vi(N,2);XPe(k,{children:($,W)=>{var Q=nn(),Y=pi(Q);Ur(Y,1,s,Sl,(M,D)=>{iEe(M,{get date(){return B(D)}})}),bt($,Q)},$$slots:{default:!0}}),Gi(()=>{xi(R,1,r().header),xi(P,1,r().hiddenScroll)}),bt(t,w),Ei(),n()}const hEe={createOptions(t){t.buttonText.timeGridDay="day",t.buttonText.timeGridWeek="week",t.view="timeGridWeek",t.views.timeGridDay={buttonText:aPe,component:L6,dayHeaderFormat:{weekday:"long"},duration:{days:1},theme:kz("ec-time-grid ec-day-view"),titleFormat:{year:"numeric",month:"long",day:"numeric"}},t.views.timeGridWeek={buttonText:lPe,component:L6,duration:{weeks:1},theme:kz("ec-time-grid ec-week-view")}},createStores(t){t._slotTimeLimits=$Pe(t),t._times=HPe(t)}};function dEe(t){return ga([t.date,t.firstDay,t.hiddenDays],([e,i,n])=>{let r=[],s=qn(e),o=7;for(;s.getUTCDay()!==i&&o;)T0(s),--o;for(let a=0;a<7;++a)n.includes(s.getUTCDay())||r.push(qn(s)),Ph(s);return r})}var fEe=hi('<div role="columnheader"><span></span></div>'),pEe=hi('<div><div role="row"></div> <div></div></div>');function mEe(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(l,"$theme",i),s=()=>dt(p,"$_days",i),o=()=>dt(d,"$_intlDayHeaderAL",i),a=()=>dt(u,"$_intlDayHeader",i);let{theme:l,_intlDayHeader:u,_intlDayHeaderAL:d,_days:p}=Xi("state");ts();var v=pEe(),y=Di(v);Ur(y,5,s,Sl,(R,O)=>{var P=fEe(),N=Di(P);Us(N,(F,k)=>Yl?.(F,k),()=>a().format(B(O))),_i(P),Gi((F,k)=>{xi(P,1,`${r().day??""} ${F??""}`),yr(N,"aria-label",k)},[()=>r().weekdays?.[B(O).getUTCDay()],()=>o().format(B(O))],_h),bt(R,P)}),_i(y);var w=vi(y,2);_i(v),Gi(()=>{xi(v,1,r().header),xi(y,1,r().days),xi(w,1,r().hiddenScroll)}),bt(t,v),Ei(),n()}var gEe=hi("<article><!> <div></div> <!></article>");function Cw(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(Ge,"$resources",i),s=()=>dt(le,"$eventBackgroundColor",i),o=()=>dt(fe,"$eventColor",i),a=()=>dt(me,"$eventTextColor",i),l=()=>dt(Je,"$theme",i),u=()=>dt(Qt,"$_iClasses",i),d=()=>dt(He,"$eventClassNames",i),p=()=>dt(mt,"$_view",i),v=()=>dt(Z,"$displayEventEnd",i),y=()=>dt(Fe,"$eventContent",i),w=()=>dt(wt,"$_intlEventTime",i),R=()=>dt(je,"$eventDidMount",i),O=()=>dt(ie,"$eventAllUpdated",i),P=()=>dt(Ot,"$_interaction",i),N=()=>dt(Jt,"$_popupDate",i),F=()=>dt(j,"$dayMaxEvents",i),k=()=>dt(ei,"$_hiddenEvents",i),$=()=>dt(be,"$eventClick",i),W=()=>dt(qe,"$eventMouseEnter",i),Q=()=>dt(ct,"$eventMouseLeave",i);let Y=ht(e,"chunk",8),M=ht(e,"longChunks",24,()=>({})),D=ht(e,"inPopup",8,!1),G=ht(e,"dates",24,()=>[]),{dayMaxEvents:j,displayEventEnd:Z,eventAllUpdated:ie,eventBackgroundColor:le,eventTextColor:me,eventClick:be,eventColor:fe,eventContent:Fe,eventClassNames:He,eventDidMount:je,eventMouseEnter:qe,eventMouseLeave:ct,resources:Ge,theme:Je,_view:mt,_intlEventTime:wt,_interaction:Ot,_iClasses:Qt,_hiddenEvents:ei,_popupDate:Jt,_tasks:Yt}=Xi("state"),Ut=Gt(),Re=Gt(),gi=Gt(),it=Gt(),Pe=Gt(),Ye=Gt(),Ct=Gt(1),st=Gt(!1),we=Gt(),he=Gt();Xo(()=>{Gr(R())&&R()({event:kc(B(Re)),timeText:B(Ye),el:B(Ut),view:Jl(p())})}),eP(()=>{Gr(O())&&!fh(B(we))&&MP(()=>O()({view:Jl(p())}),"eau",Yt)});function xe(te,Se){return!fh(Se)&&Gr(te)?ve=>te({event:kc(B(Re)),el:B(Ut),jsEvent:ve,view:Jl(p())}):void 0}function Be(te,Se){return te.action?ve=>P().action.drag(B(Re),ve,Se,D()?N():null,[Id(B(Ut)).top-Id(Q_(B(Ut),1)).top,G()],Y().zeroDuration):void 0}function $e(){B(Ut)&&(rt(Ct,uee(Y(),M(),_w(B(Ut)))),F()===!0?Ze():rt(st,!1))}function Ze(){let te=Q_(B(Ut),2),Se=_w(te)-_w(te.firstElementChild)-Lt(te);rt(st,Y().bottom>Se);let ve=!1;for(let Ae of Y().dates){let ke=k()[Ae.getTime()];if(ke){let Xe=ke.size;B(st)?ke.add(Y().event):ke.delete(Y().event),Xe!==ke.size&&(ve=!0)}}ve&&Lr(ei,k())}function Lt(te){let Se=0;for(let ve=0;ve<Y().days&&(Se=PM(Se,_w(te.lastElementChild)),te=te.nextElementSibling,!!te);++ve);return Se}Ui(()=>en(Y()),()=>{rt(Re,Y().event)}),Ui(()=>(B(we),B(Re),r(),s(),o(),a(),B(it),en(Y()),B(Ct),B(st),l(),u(),d(),p()),()=>{rt(we,B(Re).display);let te=B(Re).backgroundColor||zU(B(Re),r())||s()||o(),Se=B(Re).textColor||VU(B(Re),r())||a();if(Dc(B(we)))rt(it,`width:calc(${Y().days*100}% + ${Y().days-1}px);`);else{let ve=B(Ct);if(B(Re)._margin){let[Ae,ke]=B(Re)._margin;Y().date>=ke[0]&&Y().date<=ke.at(-1)&&(ve=Ae)}rt(it,`width:calc(${Y().days*100}% + ${(Y().days-1)*7}px);margin-top:${ve}px;`)}te&&rt(it,B(it)+`background-color:${te};`),Se&&rt(it,B(it)+`color:${Se};`),B(st)&&rt(it,B(it)+"visibility:hidden;"),rt(it,B(it)+B(Re).styles.join(";")),rt(gi,[Dc(B(we))?l().bgEvent:l().event,...u()([],B(Re)),...NU(d(),B(Re),p())].join(" "))}),Ui(()=>(B(Ye),B(Pe),en(Y()),v(),y(),l(),w(),p()),()=>{(te=>(rt(Ye,te[0]),rt(Pe,te[1])))(FU(Y(),v(),y(),l(),w(),p()))}),Ui(()=>($(),B(we)),()=>{rt(he,xe($(),B(we)))}),Is(),ts();var ot=gEe(),Nt=Vt(()=>B(he)&&GC(B(he))),fi=Vt(()=>xe(W(),B(we))),Pt=Vt(()=>xe(Q(),B(we))),ni=Vt(()=>!fh(B(we))&&Be(P())),ti=Di(ot),nt=Vt(()=>Be(P(),["x","start"]));dl(ti,()=>P().resizer,(te,Se)=>{Se(te,{start:!0,get event(){return B(Re)},$$events:{pointerdown(...ve){B(nt)?.apply(this,ve)}}})});var Ce=vi(ti,2);Us(Ce,(te,Se)=>Yl?.(te,Se),()=>B(Pe));var oe=vi(Ce,2),re=Vt(()=>Be(P(),["x","end"]));dl(oe,()=>P().resizer,(te,Se)=>{Se(te,{get event(){return B(Re)},$$events:{pointerdown(...ve){B(re)?.apply(this,ve)}}})}),_i(ot),es(ot,te=>rt(Ut,te),()=>B(Ut)),Gi(()=>{xi(ot,1,B(gi)),Jd(ot,B(it)),yr(ot,"role",B(he)?"button":void 0),yr(ot,"tabindex",B(he)?0:void 0),xi(Ce,1,l().eventBody)}),Tn("click",ot,function(...te){(B(he)||void 0)?.apply(this,te)}),Tn("keydown",ot,function(...te){B(Nt)?.apply(this,te)}),Tn("mouseenter",ot,function(...te){B(fi)?.apply(this,te)}),Tn("mouseleave",ot,function(...te){B(Pt)?.apply(this,te)}),Tn("pointerdown",ot,function(...te){B(ni)?.apply(this,te)}),bt(t,ot),Ks(e,"reposition",$e);var ee=Ei({reposition:$e});return n(),ee}var vEe=hi('<div><div><time></time> <a role="button" tabindex="0">&times;</a></div> <div></div></div>');function yEe(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(R,"$_popupChunks",i),s=()=>dt(w,"$_popupDate",i),o=()=>dt(v,"$_interaction",i),a=()=>dt(p,"$theme",i),l=()=>dt(y,"$_intlDayPopover",i),u=()=>dt(d,"$buttonText",i);let{buttonText:d,theme:p,_interaction:v,_intlDayPopover:y,_popupDate:w,_popupChunks:R}=Xi("state"),O=Gt(),P=Gt("");function N(){let j=Q_(B(O),1),Z=Q_(j,3),ie=Id(B(O)),le=Id(j),me=Id(Z);rt(P,"");let be;if(ie.width>=me.width){be=me.left-le.left;let Fe=le.right-me.right;rt(P,B(P)+`right:${Fe}px;`)}else be=(le.width-ie.width)/2,le.left+be<me.left?be=me.left-le.left:le.left+be+ie.width>me.right&&(be=me.right-le.left-ie.width);rt(P,B(P)+`left:${be}px;`);let fe;if(ie.height>=me.height){fe=me.top-le.top;let Fe=le.bottom-me.bottom;rt(P,B(P)+`bottom:${Fe}px;`)}else fe=(le.height-ie.height)/2,le.top+fe<me.top?fe=me.top-le.top:le.top+fe+ie.height>me.bottom&&(fe=me.bottom-le.top-ie.height);rt(P,B(P)+`top:${fe}px;`)}function F(){B(O)&&(rt(P,""),Hc().then(()=>{r().length?N():k()}))}function k(j){Lr(w,null)}function $(j){k(),o().action?.noClick()}Ui(()=>r(),()=>{r()&&F()}),Is(),ts();var W=vEe(),Q=Di(W),Y=Di(Q);Us(Y,(j,Z)=>Yl?.(j,Z),()=>l().format(s()));var M=vi(Y,2),D=Vt(()=>GC(k));_i(Q);var G=vi(Q,2);Ur(G,5,r,j=>j.event,(j,Z)=>{Cw(j,{get chunk(){return B(Z)},inPopup:!0})}),_i(G),_i(W),es(W,j=>rt(O,j),()=>B(O)),Us(W,(j,Z)=>VRe?.(j,Z),()=>"pointerdown"),mh(()=>Tn("pointerdown",W,WM(function(j){gZ.call(this,e,j)}))),mh(()=>Tn("pointerdownoutside",W,$)),Gi(j=>{xi(W,1,a().popup),Jd(W,B(P)),xi(Q,1,a().dayHead),yr(Y,"datetime",j),yr(M,"aria-label",u().close),xi(G,1,a().events)},[()=>qd(s(),10)],_h),Tn("click",M,WM(k)),Tn("keydown",M,function(...j){B(D)?.apply(this,j)}),bt(t,W),Ei(),n()}var xEe=hi("<span></span>"),bEe=hi("<div><!></div>"),wEe=hi("<div><!></div>"),_Ee=hi("<!> <!>",1),CEe=hi('<a role="button" tabindex="0" aria-haspopup="true"></a>'),SEe=hi('<div role="cell"><div><time></time> <!></div> <div><!></div> <!> <div><!></div> <!> <div><!></div></div>');function OEe(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(me,"$_hiddenEvents",i),s=()=>dt(He,"$_today",i),o=()=>dt(Q,"$currentDate",i),a=()=>dt(M,"$highlightedDates",i),l=()=>dt(Z,"$validRange",i),u=()=>dt(G,"$moreLinkContent",i),d=()=>dt(fe,"$_popupDate",i),p=()=>dt(ie,"$weekNumbers",i),v=()=>dt(D,"$firstDay",i),y=()=>dt(le,"$weekNumberContent",i),w=()=>dt(j,"$theme",i),R=()=>dt(je,"$_interaction",i),O=()=>dt(be,"$_intlDayCell",i);let P=ht(e,"date",8),N=ht(e,"chunks",8),F=ht(e,"bgChunks",8),k=ht(e,"longChunks",8),$=ht(e,"iChunks",24,()=>[]),W=ht(e,"dates",8),{date:Q,dayMaxEvents:Y,highlightedDates:M,firstDay:D,moreLinkContent:G,theme:j,validRange:Z,weekNumbers:ie,weekNumberContent:le,_hiddenEvents:me,_intlDayCell:be,_popupDate:fe,_popupChunks:Fe,_today:He,_interaction:je}=Xi("state"),qe=Gt(),ct=Gt(),Ge=Gt(),Je=Gt(),mt=Gt(),wt=Gt(),Ot=Gt(),Qt=Gt(new Set),ei=Gt(""),Jt=Gt(),Yt=Gt(),Ut=Gt(),Re=Gt([]);function gi(){Lr(fe,P())}function it(){let re=Ph(qn(P())),ee=B(ct).concat(k()[P().getTime()]?.chunks||[]);Lr(Fe,ee.map(te=>ox({},te,gp(te.event,P(),re),{days:1,dates:[P()]})).sort((te,Se)=>te.top-Se.top))}function Pe(){B(Ot)||TP(B(Re),B(ct))}Ui(()=>(en(P()),l()),()=>{rt(Ot,RP(P(),l()))}),Ui(()=>(B(Ot),B(ct),en(F()),en(P()),B(Qt),en(N())),()=>{if(!B(Ot)){rt(ct,[]),rt(Ge,F().filter(re=>To(re.date,P()))),B(Qt).clear(),rt(Qt,B(Qt));for(let re of N())To(re.date,P())&&B(ct).push(re)}}),Ui(()=>(en(P()),B(Qt)),()=>{xle(me,Og(r)[P().getTime()]=B(Qt),Og(r))}),Ui(()=>(en(P()),s()),()=>{rt(Je,To(P(),s()))}),Ui(()=>(en(P()),o()),()=>{rt(mt,P().getUTCMonth()!==o().getUTCMonth())}),Ui(()=>(a(),en(P())),()=>{rt(wt,a().some(re=>To(re,P())))}),Ui(()=>(B(Ot),r(),B(Qt),u(),Gr),()=>{if(!B(Ot)&&r()&&B(Qt).size){let re="+"+B(Qt).size+" more";u()?rt(ei,Gr(u())?u()({num:B(Qt).size,text:re}):u()):rt(ei,re)}}),Ui(()=>(d(),en(P())),()=>{rt(Jt,d()&&To(P(),d()))}),Ui(()=>(B(Jt),en(k()),B(ct),Hc),()=>{B(Jt)&&k()&&B(ct)&&Hc().then(it)}),Ui(()=>(B(qe),en(P()),B(Ot)),()=>{B(qe)&&j_(B(qe),()=>({allDay:!0,date:P(),resource:void 0,dayEl:B(qe),disabled:B(Ot)}))}),Ui(()=>(B(Yt),p(),en(P()),v(),y(),ha),()=>{if(rt(Yt,p()&&P().getUTCDay()==(v()?1:0)),B(Yt)){let re=$Re(P(),v());y()?rt(Ut,Gr(y())?y()({date:ha(P()),week:re}):y()):rt(Ut,"W"+String(re).padStart(2,"0"))}}),Is(),ts();var Ye=SEe(),Ct=Di(Ye),st=Di(Ct);Us(st,(re,ee)=>Yl?.(re,ee),()=>O().format(P()));var we=vi(st,2);{var he=re=>{var ee=xEe();Us(ee,(te,Se)=>Yl?.(te,Se),()=>B(Ut)),Gi(()=>xi(ee,1,w().weekNumber)),bt(re,ee)};Yi(we,re=>{B(Yt)&&re(he)})}_i(Ct);var xe=vi(Ct,2),Be=Di(xe);{var $e=re=>{var ee=nn(),te=pi(ee);Ur(te,1,()=>B(Ge),Se=>Se.event,(Se,ve)=>{Cw(Se,{get chunk(){return B(ve)}})}),bt(re,ee)};Yi(Be,re=>{B(Ot)||re($e)})}_i(xe);var Ze=vi(xe,2);{var Lt=re=>{var ee=_Ee(),te=pi(ee);{var Se=ke=>{var Xe=bEe(),ut=Di(Xe);Cw(ut,{get chunk(){return $()[2]}}),_i(Xe),Gi(()=>xi(Xe,1,w().events)),bt(ke,Xe)};Yi(te,ke=>{$()[2]&&To($()[2].date,P())&&ke(Se)})}var ve=vi(te,2);{var Ae=ke=>{var Xe=wEe(),ut=Di(Xe);Cw(ut,{get chunk(){return $()[0]}}),_i(Xe),Gi(()=>xi(Xe,1,`${w().events??""} ${w().preview??""}`)),bt(ke,Xe)};Yi(ve,ke=>{$()[0]&&To($()[0].date,P())&&ke(Ae)})}bt(re,ee)};Yi(Ze,re=>{B(Ot)||re(Lt)})}var ot=vi(Ze,2),Nt=Di(ot);{var fi=re=>{var ee=nn(),te=pi(ee);Ur(te,3,()=>B(ct),Se=>Se.event,(Se,ve,Ae)=>{es(Cw(Se,{get chunk(){return B(ve)},get longChunks(){return k()},get dates(){return W()},$$legacy:!0}),(ke,Xe)=>xl(Re,B(Re)[Xe]=ke),ke=>B(Re)?.[ke],()=>[B(Ae)])}),bt(re,ee)};Yi(Nt,re=>{B(Ot)||re(fi)})}_i(ot);var Pt=vi(ot,2);{var ni=re=>{yEe(re,{})};Yi(Pt,re=>{B(Jt)&&re(ni)})}var ti=vi(Pt,2),nt=Di(ti);{var Ce=re=>{var ee=CEe(),te=Vt(()=>GC(gi));mh(()=>Tn("click",ee,WM(gi))),mh(()=>Tn("keydown",ee,function(...Se){B(te)?.apply(this,Se)})),mh(()=>Tn("pointerdown",ee,WM(function(Se){gZ.call(this,e,Se)}))),Us(ee,(Se,ve)=>Yl?.(Se,ve),()=>B(ei)),bt(re,ee)};Yi(nt,re=>{!B(Ot)&&B(Qt).size&&re(Ce)})}_i(ti),_i(Ye),es(Ye,re=>rt(qe,re),()=>B(qe)),Gi((re,ee)=>{xi(Ye,1,`${w().day??""} ${re??""}${(B(Je)?" "+w().today:"")??""}${(B(mt)?" "+w().otherMonth:"")??""}${(B(wt)?" "+w().highlight:"")??""}${(B(Ot)?" "+w().disabled:"")??""}`),xi(Ct,1,w().dayHead),yr(st,"datetime",ee),xi(xe,1,w().bgEvents),xi(ot,1,w().events),xi(ti,1,w().dayFoot)},[()=>w().weekdays?.[P().getUTCDay()],()=>qd(P(),10)],_h),Tn("pointerdown",Ye,function(...re){R().action?.select?.apply(this,re)}),bt(t,Ye),Ks(e,"reposition",Pe);var oe=Ei({reposition:Pe});return n(),oe}var MEe=hi('<div role="row"></div>');function TEe(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt($,"$validRange",i),s=()=>dt(y,"$_events",i),o=()=>dt(N,"$filterEventsWithResources",i),a=()=>dt(P,"$resources",i),l=()=>dt(F,"$hiddenDays",i),u=()=>dt(w,"$_iEvents",i),d=()=>dt(O,"$_hiddenEvents",i),p=()=>dt(k,"$theme",i);let v=ht(e,"dates",8),{_events:y,_iEvents:w,_queue2:R,_hiddenEvents:O,resources:P,filterEventsWithResources:N,hiddenDays:F,theme:k,validRange:$}=Xi("state"),W=Gt(),Q=Gt(),Y=Gt(),M=Gt([]),D=Gt(),G=Gt(),j=Gt([]),Z={};function ie(){OP(()=>TP(B(j),v()),Z,R)}Ui(()=>(en(v()),r(),qn),()=>{rt(D,NT(v()[0],r())),rt(G,Ph(qn(NT(v().at(-1),r()))))}),Ui(()=>(B(W),B(Q),s(),B(D),B(G),o(),a(),l()),()=>{rt(W,[]),rt(Q,[]);for(let me of s())if(R0(me,B(D),B(G),o()?a():void 0)){let be=gp(me,B(D),B(G));Dc(me.display)?me.allDay&&B(Q).push(be):B(W).push(be)}i0(B(Q),l()),rt(Y,i0(B(W),l())),ie()}),Ui(()=>(u(),B(D),B(G),l()),()=>{rt(M,u().map(me=>{let be;return me&&R0(me,B(D),B(G))?(be=gp(me,B(D),B(G)),i0([be],l())):be=null,be}))}),Ui(()=>(d(),Hc),()=>{d()&&Hc().then(ie)}),Is(),ts();var le=MEe();Tn("resize",JR,ie),Ur(le,5,v,Sl,(me,be,fe)=>{es(OEe(me,{get date(){return B(be)},get chunks(){return B(W)},get bgChunks(){return B(Q)},get longChunks(){return B(Y)},get iChunks(){return B(M)},get dates(){return v()},$$legacy:!0}),(Fe,He)=>xl(j,B(j)[He]=Fe),Fe=>B(j)?.[Fe],()=>[fe])}),_i(le),Gi(()=>xi(le,1,p().days)),bt(t,le),Ei(),n()}var REe=hi("<div><div></div></div>");function PEe(t,e){Pi(e,!1);const[i,n]=Hr(),r=()=>dt(y,"$hiddenDays",i),s=()=>dt(v,"$dayMaxEvents",i),o=()=>dt(d,"$_viewDates",i),a=()=>dt(u,"$_bodyEl",i),l=()=>dt(w,"$theme",i);let{_bodyEl:u,_viewDates:d,_hiddenEvents:p,dayMaxEvents:v,hiddenDays:y,theme:w}=Xi("state"),R=Gt(),O=Gt();Ui(()=>(B(R),B(O),r(),s(),o()),()=>{rt(R,[]),rt(O,7-r().length),Lr(p,{}),s();for(let F=0;F<o().length/B(O);++F){let k=[];for(let $=0;$<B(O);++$)k.push(o()[F*B(O)+$]);B(R).push(k)}}),Is(),ts();var P=REe(),N=Di(P);Ur(N,5,()=>B(R),Sl,(F,k)=>{TEe(F,{get dates(){return B(k)}})}),_i(N),_i(P),es(P,F=>Lr(u,F),()=>a()),Gi(()=>{xi(P,1,`${l().body??""}${(s()===!0?" "+l().uniform:"")??""}`),xi(N,1,l().content)}),bt(t,P),Ei(),n()}var EEe=hi("<!> <!>",1);function AEe(t){var e=EEe(),i=pi(e);mEe(i,{});var n=vi(i,2);PEe(n,{}),bt(t,e)}const IEe={createOptions(t){t.dayMaxEvents=!1,t.dayCellFormat={day:"numeric"},t.dayPopoverFormat={month:"long",day:"numeric",year:"numeric"},t.moreLinkContent=void 0,t.buttonText.dayGridMonth="month",t.buttonText.close="Close",t.theme.uniform="ec-uniform",t.theme.dayFoot="ec-day-foot",t.theme.popup="ec-popup",t.theme.weekNumber="ec-week-number",t.view="dayGridMonth",t.weekNumbers=!1,t.weekNumberContent=void 0,t.views.dayGridMonth={buttonText:cPe,component:AEe,dayHeaderFormat:{weekday:"short"},dayHeaderAriaLabelFormat:{weekday:"long"},displayEventEnd:!1,duration:{months:1},theme:kz("ec-day-grid ec-month-view"),titleFormat:{year:"numeric",month:"long"}}},createStores(t){t._days=dEe(t),t._intlDayCell=Kw(t.locale,t.dayCellFormat),t._intlDayPopover=Kw(t.locale,t.dayPopoverFormat),t._hiddenEvents=gr({}),t._popupDate=gr(null),t._popupChunks=gr([])}};var kEe=hi("<div><!></div>");function Urt(t,e){Pi(e,!0);const i=Xi("pageContext");function n(){return e.layoutStructure}function r(){return["onclick"]}function s(){return[{name:"dataSource",type:"dataSource"}]}function o(w){alert(w.event.title+`

`+w.event.titleHTML)}function a(){return u}let l=[hEe,IEe],u=kn({view:"dayGridMonth",height:"50vh",headerToolbar:{start:"today prev,next",center:"title",end:"timeGridDay,timeGridWeek,dayGridMonth"},scrollTime:"09:00:00",eventClick:o,views:{timeGridWeek:{pointer:!0},resourceTimeGridWeek:{pointer:!0}},dayMaxEvents:!0,nowIndicator:!0,selectable:!0,editable:!0,events:p(i.data[e.layoutStructure.props?.dataSource])});function d(w){if(!w)return null;try{const R=new Date(w.replace(" ","T")+"Z");return isNaN(R.getTime())?null:R.toLocaleString("sv",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone}).replace(",","")}catch(R){return console.error("Error converting date:",R),null}}function p(w){return Array.isArray(w)?w.map(O=>{if(!O)return console.warn("Skipping null/undefined event element"),null;const P=e.layoutStructure?.props?.idField,N=e.layoutStructure?.props?.startTimeField,F=e.layoutStructure?.props?.endTimeField,k=e.layoutStructure?.props?.titleField;return!N||!O[N]||!F||!O[F]?(console.warn("Missing required start or end time for event:",O),null):{id:O[P]??crypto.randomUUID(),start:d(O[N]),end:d(O[F]),title:O[k]??`<< titleField '${k}' not found in data>>`}}).filter(O=>O!==null):(console.error("Invalid events data: expected an array"),[])}On(()=>{u.events=p(i.data[e.layoutStructure.props?.dataSource])});var v=kEe(),y=Di(v);return UPe(y,{plugins:l,get options(){return u}}),_i(v),Gi(()=>xi(v,1,Ol(e.layoutStructure.props?.class))),bt(t,v),Ei({getLayout:n,getEvents:r,getProps:s,getOptions:a})}var DEe=hi("<div></div>");function Hrt(t,e){Pi(e,!1);const i=Xi("pageContext");function n(){return o()}function r(){return[]}function s(){return[{name:"dataSource",type:"dataSource"},{name:"type",type:"choice",choices:["area","bar","bubble","candlestick","donut","heatmap","line","pie","scatter","treemap"]},{name:"title",type:"string"},{name:"color",type:"color"},{name:"xColumn",type:"string"},{name:"yColumn",type:"string"}]}let o=ht(e,"layoutStructure",8),a=Gt();function l(y){const w={chart:{type:o().props?.type,toolbar:{show:!1}},title:{text:o().props?.title,align:"left"},colors:[o().props?.color],series:[{data:i.data[o().props?.dataSource].map(R=>({x:R[o().props?.xColumn],y:R[o().props?.yColumn]}))}]};rt(a,new(B(u))(y,w)),B(a).render()}let u=Gt();Xo(async()=>{rt(u,(await rZ(async()=>{const{default:y}=await import("./DBseb6uJ.js");return{default:y}},[],import.meta.url)).default)}),Ui(()=>(B(a),en(o())),()=>{B(a)&&o().props?.title&&B(a).updateOptions({chart:{type:o().props?.type},title:{text:o().props?.title},colors:[o().props?.color],series:[{data:i.data[o().props?.dataSource].map(y=>({x:y[o().props?.xColumn],y:y[o().props?.yColumn]}))}]})}),Is(),ts();var d=nn(),p=pi(d);{var v=y=>{var w=DEe();Us(w,R=>l?.(R)),Gi(()=>xi(w,1,Ol(o()?.props?.class))),bt(y,w)};Yi(p,y=>{B(u)&&y(v)})}return bt(t,d),Ks(e,"getLayout",n),Ks(e,"getEvents",r),Ks(e,"getProps",s),Ei({getLayout:n,getEvents:r,getProps:s})}var LEe=hi("<option> </option>"),FEe=hi("<select></select>");function $rt(t,e){Pi(e,!0);let i=ht(e,"layoutStructure",7);const n=Xi("pageContext");function r(){return i()}function s(){return["oninput","onchange"]}function o(){return[{name:"disabled",type:"boolean"},{name:"dataSource",type:"dataSource"},{name:"optionValueField",type:"string"},{name:"optionTitleField",type:"string"},{name:"value",type:"string"}]}var a=FEe();let l;return Ur(a,21,()=>n.data[i().props?.dataSource],Sl,(u,d)=>{var p=LEe(),v={},y=Di(p,!0);_i(p),Gi(()=>{hZ(p,B(d)[i().props.optionValueField]==i().props.value),v!==(v=B(d)[i().props.optionValueField])&&(p.value=(p.__value=B(d)[i().props.optionValueField])==null?"":B(d)[i().props.optionValueField]),zd(y,B(d)[i().props.optionTitleField])}),bt(u,p)}),_i(a),Us(a,(u,d)=>ZG?.(u,d),()=>({content:$n(i().props?.tooltip,e.dataValues,!1)})),mh(()=>Ile(a,()=>i().props.value,u=>i().props.value=u)),Gi(u=>l=Ch(a,l,{...u,disabled:i().props?.disabled,class:i().props?.class}),[()=>ex(i().actions,{page:n,data:e.dataValues,self:e.myself},e.dataValues)]),bt(t,a),Ei({getLayout:r,getEvents:s,getProps:o})}var NEe=hi("<iframe></iframe>");function Wrt(t,e){Pi(e,!0);const i=Xi("pageContext"),n=Vt(()=>$n(e.layoutStructure.props?.class,i,e.dataValues,!1)+(e.layoutStructure.props?.background?` bg-[url(${e.layoutStructure.props?.background})] bg-no-repeat bg-cover bg-center`:"")),r=Vt(()=>$n(e.layoutStructure.props?.url,i,e.dataValues,!1));var s=NEe();Gi(()=>{xi(s,1,Ol(B(n))),yr(s,"src",B(r))}),bt(t,s),Ei()}const BEe="2.3.0";function zEe(t,e){return t.start<=e&&e<t.end}function VEe(t,e={}){const{offsetLine:i=0,offsetColumn:n=0}=e;let r=0;const s=t.split(`
`).map((l,u)=>{const d=r+l.length+1,p={start:r,end:d,line:u};return r=d,p});let o=0;function a(l,u){if(typeof l=="string"&&(l=t.indexOf(l,u??0)),l===-1)return;let d=s[o];const p=l>=d.end?1:-1;for(;d;){if(zEe(d,l))return{line:i+d.line,column:n+l-d.start,character:l};o+=p,d=s[o]}}return a}let GEe,F6=VEe("",{offsetLine:1}),UEe,N6=[],HEe=new Map;const $Ee=/^\t+/;function dN(t){return t.replace($Ee,e=>e.split("	").join("  "))}function WEe(t,e,i){const n=t.split(`
`),r=Math.max(0,e-2),s=Math.min(e+3,n.length),o=String(s+1).length;return n.slice(r,s).map((a,l)=>{const u=r+l===e,d=String(l+r+1).padStart(o," ");if(u){const p=" ".repeat(o+2+dN(a.slice(0,i)).length)+"^";return`${d}: ${dN(a)}
${p}`}return`${d}: ${dN(a)}`}).join(`
`)}class pee{name="CompileDiagnostic";constructor(e,i,n){this.code=e,this.message=i,n&&(this.position=n,this.start=F6(n[0]),this.end=F6(n[1]),this.start&&this.end&&(this.frame=WEe(GEe,this.start.line-1,this.end.column)))}toString(){let e=`${this.code}: ${this.message}`;return this.filename&&(e+=`
${this.filename}`,this.start&&(e+=`:${this.start.line}:${this.start.column}`)),this.frame&&(e+=`
${this.frame}`),e}toJSON(){return{code:this.code,message:this.message,filename:this.filename,start:this.start,end:this.end,position:this.position,frame:this.frame}}}class qEe extends pee{name="CompileWarning";constructor(e,i,n){super(e,i,n)}}function ax(t,e,i){let n=N6;if(t&&(n=HEe.get(t)??N6),n&&n.at(-1)?.has(e))return;const r=new qEe(e,i,t&&t.start!==void 0?[t.start,t.end??t.start]:void 0);UEe(r)}function jEe(t){ax(t,"options_deprecated_accessors","The `accessors` option has been deprecated. It will have no effect in runes mode\nhttps://svelte.dev/e/options_deprecated_accessors")}function QEe(t){ax(t,"options_deprecated_immutable","The `immutable` option has been deprecated. It will have no effect in runes mode\nhttps://svelte.dev/e/options_deprecated_immutable")}function ZEe(t){ax(t,"options_removed_enable_sourcemap","The `enableSourcemap` option has been removed. Source maps are always generated now, and tooling can choose to ignore them\nhttps://svelte.dev/e/options_removed_enable_sourcemap")}function XEe(t){ax(t,"options_removed_hydratable","The `hydratable` option has been removed. Svelte components are always hydratable now\nhttps://svelte.dev/e/options_removed_hydratable")}function KEe(t){ax(t,"options_removed_loop_guard_timeout","The `loopGuardTimeout` option has been removed\nhttps://svelte.dev/e/options_removed_loop_guard_timeout")}function YEe(t){ax(t,"options_renamed_ssr_dom",'`generate: "dom"` and `generate: "ssr"` options have been renamed to "client" and "server" respectively\nhttps://svelte.dev/e/options_renamed_ssr_dom')}var JEe=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,7,9,32,4,318,1,80,3,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,68,8,2,0,3,0,2,3,2,4,2,0,15,1,83,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,7,19,58,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,343,9,54,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,10,5350,0,7,14,11465,27,2343,9,87,9,39,4,60,6,26,9,535,9,470,0,2,54,8,3,82,0,12,1,19628,1,4178,9,519,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,245,1,2,9,726,6,110,6,6,9,4759,9,787719,239],mee=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,4,51,13,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,39,27,10,22,251,41,7,1,17,2,60,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,31,9,2,0,3,0,2,37,2,0,26,0,2,0,45,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,200,32,32,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,26,3994,6,582,6842,29,1763,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,433,44,212,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,42,9,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,229,29,3,0,496,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],eAe="ââÂ·Ì-Í¯ÎÒ-ÒÖ-Ö½Ö¿×××××Ø-ØÙ-Ù©Ù°Û-ÛÛ-Û¤Û§Û¨Ûª-Û­Û°-Û¹ÜÜ°-ÝÞ¦-Þ°ß-ßß«-ß³ß½à -à à -à £à ¥-à §à ©-à ­à¡-à¡à¢-à¢à£-à£¡à££-à¤à¤º-à¤¼à¤¾-à¥à¥-à¥à¥¢à¥£à¥¦-à¥¯à¦-à¦à¦¼à¦¾-à§à§à§à§-à§à§à§¢à§£à§¦-à§¯à§¾à¨-à¨à¨¼à¨¾-à©à©à©à©-à©à©à©¦-à©±à©µàª-àªàª¼àª¾-à«à«-à«à«-à«à«¢à«£à«¦-à«¯à«º-à«¿à¬-à¬à¬¼à¬¾-à­à­à­à­-à­à­-à­à­¢à­£à­¦-à­¯à®à®¾-à¯à¯-à¯à¯-à¯à¯à¯¦-à¯¯à°-à°à°¼à°¾-à±à±-à±à±-à±à±à±à±¢à±£à±¦-à±¯à²-à²à²¼à²¾-à³à³-à³à³-à³à³à³à³¢à³£à³¦-à³¯à³³à´-à´à´»à´¼à´¾-àµàµ-àµàµ-àµàµàµ¢àµ£àµ¦-àµ¯à¶-à¶à·à·-à·à·à·-à·à·¦-à·¯à·²à·³à¸±à¸´-à¸ºà¹-à¹à¹-à¹àº±àº´-àº¼à»-à»à»-à»à¼à¼à¼ -à¼©à¼µà¼·à¼¹à¼¾à¼¿à½±-à¾à¾à¾à¾-à¾à¾-à¾¼à¿á«-á¾á-áá-áá-á á¢-á¤á§-á­á±-á´á-áá-áá-áá©-á±á-áá²-á´ááá²á³á´-ááá -á©á -á á -á á¢©á¤ -á¤«á¤°-á¤»á¥-á¥á§-á§á¨-á¨á©-á©á© -á©¼á©¿-áªáª-áªáª°-áª½áª¿-á«á¬-á¬á¬´-á­á­-á­á­«-á­³á®-á®á®¡-á®­á®°-á®¹á¯¦-á¯³á°¤-á°·á±-á±á±-á±á³-á³á³-á³¨á³­á³´á³·-á³¹á·-á·¿âââ¿âââ-ââ¡â¥-â°â³¯-â³±âµ¿â· -â·¿ãª-ã¯ããã»ê -ê©ê¯ê´-ê½êêê°ê±ê ê ê ê £-ê §ê ¬ê¢ê¢ê¢´-ê£ê£-ê£ê£ -ê£±ê£¿-ê¤ê¤¦-ê¤­ê¥-ê¥ê¦-ê¦ê¦³-ê§ê§-ê§ê§¥ê§°-ê§¹ê¨©-ê¨¶ê©ê©ê©ê©-ê©ê©»-ê©½êª°êª²-êª´êª·êª¸êª¾êª¿ê«ê««-ê«¯ê«µê«¶ê¯£-ê¯ªê¯¬ê¯­ê¯°-ê¯¹ï¬ï¸-ï¸ï¸ -ï¸¯ï¸³ï¸´ï¹-ï¹ï¼-ï¼ï¼¿ï½¥",gee="ÂªÂµÂºÃ-ÃÃ-Ã¶Ã¸-ËË-ËË -Ë¤Ë¬Ë®Í°-Í´Í¶Í·Íº-Í½Í¿ÎÎ-ÎÎÎ-Î¡Î£-ÏµÏ·-ÒÒ-Ô¯Ô±-ÕÕÕ -Ö×-×ª×¯-×²Ø -ÙÙ®Ù¯Ù±-ÛÛÛ¥Û¦Û®Û¯Ûº-Û¼Û¿ÜÜ-Ü¯Ý-Þ¥Þ±ß-ßªß´ßµßºà -à à à ¤à ¨à¡-à¡à¡ -à¡ªà¡°-à¢à¢-à¢à¢ -à£à¤-à¤¹à¤½à¥à¥-à¥¡à¥±-à¦à¦-à¦à¦à¦à¦-à¦¨à¦ª-à¦°à¦²à¦¶-à¦¹à¦½à§à§à§à§-à§¡à§°à§±à§¼à¨-à¨à¨à¨à¨-à¨¨à¨ª-à¨°à¨²à¨³à¨µà¨¶à¨¸à¨¹à©-à©à©à©²-à©´àª-àªàª-àªàª-àª¨àªª-àª°àª²àª³àªµ-àª¹àª½à«à« à«¡à«¹à¬-à¬à¬à¬à¬-à¬¨à¬ª-à¬°à¬²à¬³à¬µ-à¬¹à¬½à­à­à­-à­¡à­±à®à®-à®à®-à®à®-à®à®à®à®à®à®à®£à®¤à®¨-à®ªà®®-à®¹à¯à°-à°à°-à°à°-à°¨à°ª-à°¹à°½à±-à±à±à± à±¡à²à²-à²à²-à²à²-à²¨à²ª-à²³à²µ-à²¹à²½à³à³à³ à³¡à³±à³²à´-à´à´-à´à´-à´ºà´½àµàµ-àµàµ-àµ¡àµº-àµ¿à¶-à¶à¶-à¶±à¶³-à¶»à¶½à·-à·à¸-à¸°à¸²à¸³à¹-à¹àºàºàºàº-àºàº-àº£àº¥àº§-àº°àº²àº³àº½à»-à»à»à»-à»à¼à½-à½à½-à½¬à¾-à¾á-áªá¿á-áá-áá¡á¥á¦á®-á°áµ-ááá -áááá-áºá¼-áá-áá-ááá-áá -áá-áá-á°á²-áµá¸-á¾áá-áá-áá-áá-áá-áá-áá -áµá¸-á½á-á¬á¯-á¿á-áá -áªá®-á¸á-áá-á±á-áá -á¬á®-á°á-á³ááá  -á¡¸á¢-á¢¨á¢ªá¢°-á£µá¤-á¤á¥-á¥­á¥°-á¥´á¦-á¦«á¦°-á§á¨-á¨á¨ -á©áª§á¬-á¬³á­-á­á®-á® á®®á®¯á®º-á¯¥á°-á°£á±-á±á±-á±½á²-á²á²-á²ºá²½-á²¿á³©-á³¬á³®-á³³á³µá³¶á³ºá´-á¶¿á¸-á¼á¼-á¼á¼ -á½á½-á½á½-á½á½á½á½á½-á½½á¾-á¾´á¾¶-á¾¼á¾¾á¿-á¿á¿-á¿á¿-á¿á¿-á¿á¿ -á¿¬á¿²-á¿´á¿¶-á¿¼â±â¿â-ââââ-âââ-ââ¤â¦â¨âª-â¹â¼-â¿â-âââ -ââ°-â³¤â³«-â³®â³²â³³â´-â´¥â´§â´­â´°-âµ§âµ¯â¶-â¶â¶ -â¶¦â¶¨-â¶®â¶°-â¶¶â¶¸-â¶¾â·-â·â·-â·â·-â·â·-â·ã-ãã¡-ã©ã±-ãµã¸-ã¼ã-ãã-ãã¡-ãºã¼-ã¿ã-ã¯ã±-ãã -ã¿ã°-ã¿ã-ä¶¿ä¸-êê-ê½ê-êê-êêªê«ê-ê®ê¿-êê -ê¯ê-êê¢-êê-êêêêê-êê²-ê ê -ê ê -ê ê -ê ¢ê¡-ê¡³ê¢-ê¢³ê£²-ê£·ê£»ê£½ê£¾ê¤-ê¤¥ê¤°-ê¥ê¥ -ê¥¼ê¦-ê¦²ê§ê§ -ê§¤ê§¦-ê§¯ê§º-ê§¾ê¨-ê¨¨ê©-ê©ê©-ê©ê© -ê©¶ê©ºê©¾-êª¯êª±êªµêª¶êª¹-êª½ê«ê«ê«-ê«ê« -ê«ªê«²-ê«´ê¬-ê¬ê¬-ê¬ê¬-ê¬ê¬ -ê¬¦ê¬¨-ê¬®ê¬°-ê­ê­-ê­©ê­°-ê¯¢ê°-í£í°-íí-í»ï¤-ï©­ï©°-ï«ï¬-ï¬ï¬-ï¬ï¬ï¬-ï¬¨ï¬ª-ï¬¶ï¬¸-ï¬¼ï¬¾ï­ï­ï­ï­ï­-ï®±ï¯-ï´½ïµ-ï¶ï¶-ï·ï·°-ï·»ï¹°-ï¹´ï¹¶-ï»¼ï¼¡-ï¼ºï½-ï½ï½¦-ï¾¾ï¿-ï¿ï¿-ï¿ï¿-ï¿ï¿-ï¿",fN={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},pN="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",tAe={5:pN,"5module":pN+" export import",6:pN+" const class extends export import super"},iAe=/^in(stanceof)?$/,nAe=new RegExp("["+gee+"]"),rAe=new RegExp("["+gee+eAe+"]");function Nz(t,e){for(var i=65536,n=0;n<e.length;n+=2){if(i+=e[n],i>t)return!1;if(i+=e[n+1],i>=t)return!0}return!1}function Eh(t,e){return t<65?t===36:t<91?!0:t<97?t===95:t<123?!0:t<=65535?t>=170&&nAe.test(String.fromCharCode(t)):e===!1?!1:Nz(t,mee)}function Ng(t,e){return t<48?t===36:t<58?!0:t<65?!1:t<91?!0:t<97?t===95:t<123?!0:t<=65535?t>=170&&rAe.test(String.fromCharCode(t)):e===!1?!1:Nz(t,mee)||Nz(t,JEe)}var zn=function(e,i){i===void 0&&(i={}),this.label=e,this.keyword=i.keyword,this.beforeExpr=!!i.beforeExpr,this.startsExpr=!!i.startsExpr,this.isLoop=!!i.isLoop,this.isAssign=!!i.isAssign,this.prefix=!!i.prefix,this.postfix=!!i.postfix,this.binop=i.binop||null,this.updateContext=null};function vc(t,e){return new zn(t,{beforeExpr:!0,binop:e})}var yc={beforeExpr:!0},nl={startsExpr:!0},P0={};function sr(t,e){return e===void 0&&(e={}),e.keyword=t,P0[t]=new zn(t,e)}var _e={num:new zn("num",nl),regexp:new zn("regexp",nl),string:new zn("string",nl),name:new zn("name",nl),privateId:new zn("privateId",nl),eof:new zn("eof"),bracketL:new zn("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new zn("]"),braceL:new zn("{",{beforeExpr:!0,startsExpr:!0}),braceR:new zn("}"),parenL:new zn("(",{beforeExpr:!0,startsExpr:!0}),parenR:new zn(")"),comma:new zn(",",yc),semi:new zn(";",yc),colon:new zn(":",yc),dot:new zn("."),question:new zn("?",yc),questionDot:new zn("?."),arrow:new zn("=>",yc),template:new zn("template"),invalidTemplate:new zn("invalidTemplate"),ellipsis:new zn("...",yc),backQuote:new zn("`",nl),dollarBraceL:new zn("${",{beforeExpr:!0,startsExpr:!0}),eq:new zn("=",{beforeExpr:!0,isAssign:!0}),assign:new zn("_=",{beforeExpr:!0,isAssign:!0}),incDec:new zn("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new zn("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:vc("||",1),logicalAND:vc("&&",2),bitwiseOR:vc("|",3),bitwiseXOR:vc("^",4),bitwiseAND:vc("&",5),equality:vc("==/!=/===/!==",6),relational:vc("</>/<=/>=",7),bitShift:vc("<</>>/>>>",8),plusMin:new zn("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:vc("%",10),star:vc("*",10),slash:vc("/",10),starstar:new zn("**",{beforeExpr:!0}),coalesce:vc("??",1),_break:sr("break"),_case:sr("case",yc),_catch:sr("catch"),_continue:sr("continue"),_debugger:sr("debugger"),_default:sr("default",yc),_do:sr("do",{isLoop:!0,beforeExpr:!0}),_else:sr("else",yc),_finally:sr("finally"),_for:sr("for",{isLoop:!0}),_function:sr("function",nl),_if:sr("if"),_return:sr("return",yc),_switch:sr("switch"),_throw:sr("throw",yc),_try:sr("try"),_var:sr("var"),_const:sr("const"),_while:sr("while",{isLoop:!0}),_with:sr("with"),_new:sr("new",{beforeExpr:!0,startsExpr:!0}),_this:sr("this",nl),_super:sr("super",nl),_class:sr("class",nl),_extends:sr("extends",yc),_export:sr("export"),_import:sr("import",nl),_null:sr("null",nl),_true:sr("true",nl),_false:sr("false",nl),_in:sr("in",{beforeExpr:!0,binop:7}),_instanceof:sr("instanceof",{beforeExpr:!0,binop:7}),_typeof:sr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:sr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:sr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},oc=/\r\n?|\n|\u2028|\u2029/,vee=new RegExp(oc.source,"g");function ev(t){return t===10||t===13||t===8232||t===8233}function yee(t,e,i){i===void 0&&(i=t.length);for(var n=e;n<i;n++){var r=t.charCodeAt(n);if(ev(r))return n<i-1&&r===13&&t.charCodeAt(n+1)===10?n+2:n+1}return-1}var GU=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Sc=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,xee=Object.prototype,sAe=xee.hasOwnProperty,oAe=xee.toString,lx=Object.hasOwn||function(t,e){return sAe.call(t,e)},B6=Array.isArray||function(t){return oAe.call(t)==="[object Array]"},z6=Object.create(null);function lp(t){return z6[t]||(z6[t]=new RegExp("^(?:"+t.replace(/ /g,"|")+")$"))}function jd(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10)+55296,(t&1023)+56320))}var aAe=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,E0=function(e,i){this.line=e,this.column=i};E0.prototype.offset=function(e){return new E0(this.line,this.column+e)};var UC=function(e,i,n){this.start=i,this.end=n,e.sourceFile!==null&&(this.source=e.sourceFile)};function UU(t,e){for(var i=1,n=0;;){var r=yee(t,n,e);if(r<0)return new E0(i,e-n);++i,n=r}}var BT={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},V6=!1;function lAe(t){var e={};for(var i in BT)e[i]=t&&lx(t,i)?t[i]:BT[i];if(e.ecmaVersion==="latest"?e.ecmaVersion=1e8:e.ecmaVersion==null?(!V6&&typeof console=="object"&&console.warn&&(V6=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),e.ecmaVersion=11):e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),e.allowReserved==null&&(e.allowReserved=e.ecmaVersion<5),(!t||t.allowHashBang==null)&&(e.allowHashBang=e.ecmaVersion>=14),B6(e.onToken)){var n=e.onToken;e.onToken=function(r){return n.push(r)}}return B6(e.onComment)&&(e.onComment=cAe(e,e.onComment)),e}function cAe(t,e){return function(i,n,r,s,o,a){var l={type:i?"Block":"Line",value:n,start:r,end:s};t.locations&&(l.loc=new UC(this,o,a)),t.ranges&&(l.range=[r,s]),e.push(l)}}var Z_=1,cx=2,HU=4,bee=8,$U=16,wee=32,PP=64,_ee=128,tv=256,HC=512,EP=Z_|cx|tv;function WU(t,e){return cx|(t?HU:0)|(e?bee:0)}var zT=0,qU=1,rf=2,Cee=3,See=4,Oee=5,bs=function(e,i,n){this.options=e=lAe(e),this.sourceFile=e.sourceFile,this.keywords=lp(tAe[e.ecmaVersion>=6?6:e.sourceType==="module"?"5module":5]);var r="";e.allowReserved!==!0&&(r=fN[e.ecmaVersion>=6?6:e.ecmaVersion===5?5:3],e.sourceType==="module"&&(r+=" await")),this.reservedWords=lp(r);var s=(r?r+" ":"")+fN.strict;this.reservedWordsStrict=lp(s),this.reservedWordsStrictBind=lp(s+" "+fN.strictBind),this.input=String(i),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf(`
`,n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(oc).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=_e.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=e.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&e.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Z_),this.regexpState=null,this.privateNameStack=[]},zh={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};bs.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)};zh.inFunction.get=function(){return(this.currentVarScope().flags&cx)>0};zh.inGenerator.get=function(){return(this.currentVarScope().flags&bee)>0};zh.inAsync.get=function(){return(this.currentVarScope().flags&HU)>0};zh.canAwait.get=function(){for(var t=this.scopeStack.length-1;t>=0;t--){var e=this.scopeStack[t],i=e.flags;if(i&(tv|HC))return!1;if(i&cx)return(i&HU)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction};zh.allowSuper.get=function(){var t=this.currentThisScope(),e=t.flags;return(e&PP)>0||this.options.allowSuperOutsideMethod};zh.allowDirectSuper.get=function(){return(this.currentThisScope().flags&_ee)>0};zh.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())};zh.allowNewDotTarget.get=function(){for(var t=this.scopeStack.length-1;t>=0;t--){var e=this.scopeStack[t],i=e.flags;if(i&(tv|HC)||i&cx&&!(i&$U))return!0}return!1};zh.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&tv)>0};bs.extend=function(){for(var e=[],i=arguments.length;i--;)e[i]=arguments[i];for(var n=this,r=0;r<e.length;r++)n=e[r](n);return n};bs.parse=function(e,i){return new this(i,e).parse()};bs.parseExpressionAt=function(e,i,n){var r=new this(n,e,i);return r.nextToken(),r.parseExpression()};bs.tokenizer=function(e,i){return new this(i,e)};Object.defineProperties(bs.prototype,zh);var Qa=bs.prototype,uAe=/^(?:'((?:\\[^]|[^'\\])*?)'|"((?:\\[^]|[^"\\])*?)")/;Qa.strictDirective=function(t){if(this.options.ecmaVersion<5)return!1;for(;;){Sc.lastIndex=t,t+=Sc.exec(this.input)[0].length;var e=uAe.exec(this.input.slice(t));if(!e)return!1;if((e[1]||e[2])==="use strict"){Sc.lastIndex=t+e[0].length;var i=Sc.exec(this.input),n=i.index+i[0].length,r=this.input.charAt(n);return r===";"||r==="}"||oc.test(i[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(r)||r==="!"&&this.input.charAt(n+1)==="=")}t+=e[0].length,Sc.lastIndex=t,t+=Sc.exec(this.input)[0].length,this.input[t]===";"&&t++}};Qa.eat=function(t){return this.type===t?(this.next(),!0):!1};Qa.isContextual=function(t){return this.type===_e.name&&this.value===t&&!this.containsEsc};Qa.eatContextual=function(t){return this.isContextual(t)?(this.next(),!0):!1};Qa.expectContextual=function(t){this.eatContextual(t)||this.unexpected()};Qa.canInsertSemicolon=function(){return this.type===_e.eof||this.type===_e.braceR||oc.test(this.input.slice(this.lastTokEnd,this.start))};Qa.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0};Qa.semicolon=function(){!this.eat(_e.semi)&&!this.insertSemicolon()&&this.unexpected()};Qa.afterTrailingComma=function(t,e){if(this.type===t)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0};Qa.expect=function(t){this.eat(t)||this.unexpected()};Qa.unexpected=function(t){this.raise(t??this.start,"Unexpected token")};var AP=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};Qa.checkPatternErrors=function(t,e){if(t){t.trailingComma>-1&&this.raiseRecoverable(t.trailingComma,"Comma is not permitted after the rest element");var i=e?t.parenthesizedAssign:t.parenthesizedBind;i>-1&&this.raiseRecoverable(i,e?"Assigning to rvalue":"Parenthesized pattern")}};Qa.checkExpressionErrors=function(t,e){if(!t)return!1;var i=t.shorthandAssign,n=t.doubleProto;if(!e)return i>=0||n>=0;i>=0&&this.raise(i,"Shorthand property assignments are valid only in destructuring patterns"),n>=0&&this.raiseRecoverable(n,"Redefinition of __proto__ property")};Qa.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")};Qa.isSimpleAssignTarget=function(t){return t.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(t.expression):t.type==="Identifier"||t.type==="MemberExpression"};var rn=bs.prototype;rn.parseTopLevel=function(t){var e=Object.create(null);for(t.body||(t.body=[]);this.type!==_e.eof;){var i=this.parseStatement(null,!0,e);t.body.push(i)}if(this.inModule)for(var n=0,r=Object.keys(this.undefinedExports);n<r.length;n+=1){var s=r[n];this.raiseRecoverable(this.undefinedExports[s].start,"Export '"+s+"' is not defined")}return this.adaptDirectivePrologue(t.body),this.next(),t.sourceType=this.options.sourceType,this.finishNode(t,"Program")};var jU={kind:"loop"},hAe={kind:"switch"};rn.isLet=function(t){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Sc.lastIndex=this.pos;var e=Sc.exec(this.input),i=this.pos+e[0].length,n=this.input.charCodeAt(i);if(n===91||n===92)return!0;if(t)return!1;if(n===123||n>55295&&n<56320)return!0;if(Eh(n,!0)){for(var r=i+1;Ng(n=this.input.charCodeAt(r),!0);)++r;if(n===92||n>55295&&n<56320)return!0;var s=this.input.slice(i,r);if(!iAe.test(s))return!0}return!1};rn.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Sc.lastIndex=this.pos;var t=Sc.exec(this.input),e=this.pos+t[0].length,i;return!oc.test(this.input.slice(this.pos,e))&&this.input.slice(e,e+8)==="function"&&(e+8===this.input.length||!(Ng(i=this.input.charCodeAt(e+8))||i>55295&&i<56320))};rn.parseStatement=function(t,e,i){var n=this.type,r=this.startNode(),s;switch(this.isLet(t)&&(n=_e._var,s="let"),n){case _e._break:case _e._continue:return this.parseBreakContinueStatement(r,n.keyword);case _e._debugger:return this.parseDebuggerStatement(r);case _e._do:return this.parseDoStatement(r);case _e._for:return this.parseForStatement(r);case _e._function:return t&&(this.strict||t!=="if"&&t!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(r,!1,!t);case _e._class:return t&&this.unexpected(),this.parseClass(r,!0);case _e._if:return this.parseIfStatement(r);case _e._return:return this.parseReturnStatement(r);case _e._switch:return this.parseSwitchStatement(r);case _e._throw:return this.parseThrowStatement(r);case _e._try:return this.parseTryStatement(r);case _e._const:case _e._var:return s=s||this.value,t&&s!=="var"&&this.unexpected(),this.parseVarStatement(r,s);case _e._while:return this.parseWhileStatement(r);case _e._with:return this.parseWithStatement(r);case _e.braceL:return this.parseBlock(!0,r);case _e.semi:return this.parseEmptyStatement(r);case _e._export:case _e._import:if(this.options.ecmaVersion>10&&n===_e._import){Sc.lastIndex=this.pos;var o=Sc.exec(this.input),a=this.pos+o[0].length,l=this.input.charCodeAt(a);if(l===40||l===46)return this.parseExpressionStatement(r,this.parseExpression())}return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),n===_e._import?this.parseImport(r):this.parseExport(r,i);default:if(this.isAsyncFunction())return t&&this.unexpected(),this.next(),this.parseFunctionStatement(r,!0,!t);var u=this.value,d=this.parseExpression();return n===_e.name&&d.type==="Identifier"&&this.eat(_e.colon)?this.parseLabeledStatement(r,u,d,t):this.parseExpressionStatement(r,d)}};rn.parseBreakContinueStatement=function(t,e){var i=e==="break";this.next(),this.eat(_e.semi)||this.insertSemicolon()?t.label=null:this.type!==_e.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());for(var n=0;n<this.labels.length;++n){var r=this.labels[n];if((t.label==null||r.name===t.label.name)&&(r.kind!=null&&(i||r.kind==="loop")||t.label&&i))break}return n===this.labels.length&&this.raise(t.start,"Unsyntactic "+e),this.finishNode(t,i?"BreakStatement":"ContinueStatement")};rn.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")};rn.parseDoStatement=function(t){return this.next(),this.labels.push(jU),t.body=this.parseStatement("do"),this.labels.pop(),this.expect(_e._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(_e.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")};rn.parseForStatement=function(t){this.next();var e=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(jU),this.enterScope(0),this.expect(_e.parenL),this.type===_e.semi)return e>-1&&this.unexpected(e),this.parseFor(t,null);var i=this.isLet();if(this.type===_e._var||this.type===_e._const||i){var n=this.startNode(),r=i?"let":this.value;return this.next(),this.parseVar(n,!0,r),this.finishNode(n,"VariableDeclaration"),(this.type===_e._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&n.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===_e._in?e>-1&&this.unexpected(e):t.await=e>-1),this.parseForIn(t,n)):(e>-1&&this.unexpected(e),this.parseFor(t,n))}var s=this.isContextual("let"),o=!1,a=this.containsEsc,l=new AP,u=this.start,d=e>-1?this.parseExprSubscripts(l,"await"):this.parseExpression(!0,l);return this.type===_e._in||(o=this.options.ecmaVersion>=6&&this.isContextual("of"))?(e>-1?(this.type===_e._in&&this.unexpected(e),t.await=!0):o&&this.options.ecmaVersion>=8&&(d.start===u&&!a&&d.type==="Identifier"&&d.name==="async"?this.unexpected():this.options.ecmaVersion>=9&&(t.await=!1)),s&&o&&this.raise(d.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(d,!1,l),this.checkLValPattern(d),this.parseForIn(t,d)):(this.checkExpressionErrors(l,!0),e>-1&&this.unexpected(e),this.parseFor(t,d))};rn.parseFunctionStatement=function(t,e,i){return this.next(),this.parseFunction(t,Yw|(i?0:Bz),!1,e)};rn.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement("if"),t.alternate=this.eat(_e._else)?this.parseStatement("if"):null,this.finishNode(t,"IfStatement")};rn.parseReturnStatement=function(t){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(_e.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")};rn.parseSwitchStatement=function(t){this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(_e.braceL),this.labels.push(hAe),this.enterScope(0);for(var e,i=!1;this.type!==_e.braceR;)if(this.type===_e._case||this.type===_e._default){var n=this.type===_e._case;e&&this.finishNode(e,"SwitchCase"),t.cases.push(e=this.startNode()),e.consequent=[],this.next(),n?e.test=this.parseExpression():(i&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),i=!0,e.test=null),this.expect(_e.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(t,"SwitchStatement")};rn.parseThrowStatement=function(t){return this.next(),oc.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};var dAe=[];rn.parseCatchClauseParam=function(){var t=this.parseBindingAtom(),e=t.type==="Identifier";return this.enterScope(e?wee:0),this.checkLValPattern(t,e?See:rf),this.expect(_e.parenR),t};rn.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===_e._catch){var e=this.startNode();this.next(),this.eat(_e.parenL)?e.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0)),e.body=this.parseBlock(!1),this.exitScope(),t.handler=this.finishNode(e,"CatchClause")}return t.finalizer=this.eat(_e._finally)?this.parseBlock():null,!t.handler&&!t.finalizer&&this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")};rn.parseVarStatement=function(t,e,i){return this.next(),this.parseVar(t,!1,e,i),this.semicolon(),this.finishNode(t,"VariableDeclaration")};rn.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(jU),t.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(t,"WhileStatement")};rn.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement("with"),this.finishNode(t,"WithStatement")};rn.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")};rn.parseLabeledStatement=function(t,e,i,n){for(var r=0,s=this.labels;r<s.length;r+=1){var o=s[r];o.name===e&&this.raise(i.start,"Label '"+e+"' is already declared")}for(var a=this.type.isLoop?"loop":this.type===_e._switch?"switch":null,l=this.labels.length-1;l>=0;l--){var u=this.labels[l];if(u.statementStart===t.start)u.statementStart=this.start,u.kind=a;else break}return this.labels.push({name:e,kind:a,statementStart:this.start}),t.body=this.parseStatement(n?n.indexOf("label")===-1?n+"label":n:"label"),this.labels.pop(),t.label=i,this.finishNode(t,"LabeledStatement")};rn.parseExpressionStatement=function(t,e){return t.expression=e,this.semicolon(),this.finishNode(t,"ExpressionStatement")};rn.parseBlock=function(t,e,i){for(t===void 0&&(t=!0),e===void 0&&(e=this.startNode()),e.body=[],this.expect(_e.braceL),t&&this.enterScope(0);this.type!==_e.braceR;){var n=this.parseStatement(null);e.body.push(n)}return i&&(this.strict=!1),this.next(),t&&this.exitScope(),this.finishNode(e,"BlockStatement")};rn.parseFor=function(t,e){return t.init=e,this.expect(_e.semi),t.test=this.type===_e.semi?null:this.parseExpression(),this.expect(_e.semi),t.update=this.type===_e.parenR?null:this.parseExpression(),this.expect(_e.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,"ForStatement")};rn.parseForIn=function(t,e){var i=this.type===_e._in;return this.next(),e.type==="VariableDeclaration"&&e.declarations[0].init!=null&&(!i||this.options.ecmaVersion<8||this.strict||e.kind!=="var"||e.declarations[0].id.type!=="Identifier")&&this.raise(e.start,(i?"for-in":"for-of")+" loop variable declaration may not have an initializer"),t.left=e,t.right=i?this.parseExpression():this.parseMaybeAssign(),this.expect(_e.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,i?"ForInStatement":"ForOfStatement")};rn.parseVar=function(t,e,i,n){for(t.declarations=[],t.kind=i;;){var r=this.startNode();if(this.parseVarId(r,i),this.eat(_e.eq)?r.init=this.parseMaybeAssign(e):!n&&i==="const"&&!(this.type===_e._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():!n&&r.id.type!=="Identifier"&&!(e&&(this.type===_e._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):r.init=null,t.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(_e.comma))break}return t};rn.parseVarId=function(t,e){t.id=this.parseBindingAtom(),this.checkLValPattern(t.id,e==="var"?qU:rf,!1)};var Yw=1,Bz=2,Mee=4;rn.parseFunction=function(t,e,i,n,r){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!n)&&(this.type===_e.star&&e&Bz&&this.unexpected(),t.generator=this.eat(_e.star)),this.options.ecmaVersion>=8&&(t.async=!!n),e&Yw&&(t.id=e&Mee&&this.type!==_e.name?null:this.parseIdent(),t.id&&!(e&Bz)&&this.checkLValSimple(t.id,this.strict||t.generator||t.async?this.treatFunctionsAsVar?qU:rf:Cee));var s=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(WU(t.async,t.generator)),e&Yw||(t.id=this.type===_e.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,i,!1,r),this.yieldPos=s,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(t,e&Yw?"FunctionDeclaration":"FunctionExpression")};rn.parseFunctionParams=function(t){this.expect(_e.parenL),t.params=this.parseBindingList(_e.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()};rn.parseClass=function(t,e){this.next();var i=this.strict;this.strict=!0,this.parseClassId(t,e),this.parseClassSuper(t);var n=this.enterClassBody(),r=this.startNode(),s=!1;for(r.body=[],this.expect(_e.braceL);this.type!==_e.braceR;){var o=this.parseClassElement(t.superClass!==null);o&&(r.body.push(o),o.type==="MethodDefinition"&&o.kind==="constructor"?(s&&this.raiseRecoverable(o.start,"Duplicate constructor in the same class"),s=!0):o.key&&o.key.type==="PrivateIdentifier"&&fAe(n,o)&&this.raiseRecoverable(o.key.start,"Identifier '#"+o.key.name+"' has already been declared"))}return this.strict=i,this.next(),t.body=this.finishNode(r,"ClassBody"),this.exitClassBody(),this.finishNode(t,e?"ClassDeclaration":"ClassExpression")};rn.parseClassElement=function(t){if(this.eat(_e.semi))return null;var e=this.options.ecmaVersion,i=this.startNode(),n="",r=!1,s=!1,o="method",a=!1;if(this.eatContextual("static")){if(e>=13&&this.eat(_e.braceL))return this.parseClassStaticBlock(i),i;this.isClassElementNameStart()||this.type===_e.star?a=!0:n="static"}if(i.static=a,!n&&e>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===_e.star)&&!this.canInsertSemicolon()?s=!0:n="async"),!n&&(e>=9||!s)&&this.eat(_e.star)&&(r=!0),!n&&!s&&!r){var l=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?o=l:n=l)}if(n?(i.computed=!1,i.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),i.key.name=n,this.finishNode(i.key,"Identifier")):this.parseClassElementName(i),e<13||this.type===_e.parenL||o!=="method"||r||s){var u=!i.static&&VT(i,"constructor"),d=u&&t;u&&o!=="method"&&this.raise(i.key.start,"Constructor can't have get/set modifier"),i.kind=u?"constructor":o,this.parseClassMethod(i,r,s,d)}else this.parseClassField(i);return i};rn.isClassElementNameStart=function(){return this.type===_e.name||this.type===_e.privateId||this.type===_e.num||this.type===_e.string||this.type===_e.bracketL||this.type.keyword};rn.parseClassElementName=function(t){this.type===_e.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),t.computed=!1,t.key=this.parsePrivateIdent()):this.parsePropertyName(t)};rn.parseClassMethod=function(t,e,i,n){var r=t.key;t.kind==="constructor"?(e&&this.raise(r.start,"Constructor can't be a generator"),i&&this.raise(r.start,"Constructor can't be an async method")):t.static&&VT(t,"prototype")&&this.raise(r.start,"Classes may not have a static property named prototype");var s=t.value=this.parseMethod(e,i,n);return t.kind==="get"&&s.params.length!==0&&this.raiseRecoverable(s.start,"getter should have no params"),t.kind==="set"&&s.params.length!==1&&this.raiseRecoverable(s.start,"setter should have exactly one param"),t.kind==="set"&&s.params[0].type==="RestElement"&&this.raiseRecoverable(s.params[0].start,"Setter cannot use rest params"),this.finishNode(t,"MethodDefinition")};rn.parseClassField=function(t){return VT(t,"constructor")?this.raise(t.key.start,"Classes can't have a field named 'constructor'"):t.static&&VT(t,"prototype")&&this.raise(t.key.start,"Classes can't have a static field named 'prototype'"),this.eat(_e.eq)?(this.enterScope(HC|PP),t.value=this.parseMaybeAssign(),this.exitScope()):t.value=null,this.semicolon(),this.finishNode(t,"PropertyDefinition")};rn.parseClassStaticBlock=function(t){t.body=[];var e=this.labels;for(this.labels=[],this.enterScope(tv|PP);this.type!==_e.braceR;){var i=this.parseStatement(null);t.body.push(i)}return this.next(),this.exitScope(),this.labels=e,this.finishNode(t,"StaticBlock")};rn.parseClassId=function(t,e){this.type===_e.name?(t.id=this.parseIdent(),e&&this.checkLValSimple(t.id,rf,!1)):(e===!0&&this.unexpected(),t.id=null)};rn.parseClassSuper=function(t){t.superClass=this.eat(_e._extends)?this.parseExprSubscripts(null,!1):null};rn.enterClassBody=function(){var t={declared:Object.create(null),used:[]};return this.privateNameStack.push(t),t.declared};rn.exitClassBody=function(){var t=this.privateNameStack.pop(),e=t.declared,i=t.used;if(this.options.checkPrivateFields)for(var n=this.privateNameStack.length,r=n===0?null:this.privateNameStack[n-1],s=0;s<i.length;++s){var o=i[s];lx(e,o.name)||(r?r.used.push(o):this.raiseRecoverable(o.start,"Private field '#"+o.name+"' must be declared in an enclosing class"))}};function fAe(t,e){var i=e.key.name,n=t[i],r="true";return e.type==="MethodDefinition"&&(e.kind==="get"||e.kind==="set")&&(r=(e.static?"s":"i")+e.kind),n==="iget"&&r==="iset"||n==="iset"&&r==="iget"||n==="sget"&&r==="sset"||n==="sset"&&r==="sget"?(t[i]="true",!1):n?!0:(t[i]=r,!1)}function VT(t,e){var i=t.computed,n=t.key;return!i&&(n.type==="Identifier"&&n.name===e||n.type==="Literal"&&n.value===e)}rn.parseExportAllDeclaration=function(t,e){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(t.exported=this.parseModuleExportName(),this.checkExport(e,t.exported,this.lastTokStart)):t.exported=null),this.expectContextual("from"),this.type!==_e.string&&this.unexpected(),t.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(t.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(t,"ExportAllDeclaration")};rn.parseExport=function(t,e){if(this.next(),this.eat(_e.star))return this.parseExportAllDeclaration(t,e);if(this.eat(_e._default))return this.checkExport(e,"default",this.lastTokStart),t.declaration=this.parseExportDefaultDeclaration(),this.finishNode(t,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())t.declaration=this.parseExportDeclaration(t),t.declaration.type==="VariableDeclaration"?this.checkVariableExport(e,t.declaration.declarations):this.checkExport(e,t.declaration.id,t.declaration.id.start),t.specifiers=[],t.source=null,this.options.ecmaVersion>=16&&(t.attributes=[]);else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==_e.string&&this.unexpected(),t.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(t.attributes=this.parseWithClause());else{for(var i=0,n=t.specifiers;i<n.length;i+=1){var r=n[i];this.checkUnreserved(r.local),this.checkLocalExport(r.local),r.local.type==="Literal"&&this.raise(r.local.start,"A string literal cannot be used as an exported binding without `from`.")}t.source=null,this.options.ecmaVersion>=16&&(t.attributes=[])}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")};rn.parseExportDeclaration=function(t){return this.parseStatement(null)};rn.parseExportDefaultDeclaration=function(){var t;if(this.type===_e._function||(t=this.isAsyncFunction())){var e=this.startNode();return this.next(),t&&this.next(),this.parseFunction(e,Yw|Mee,!1,t)}else if(this.type===_e._class){var i=this.startNode();return this.parseClass(i,"nullableID")}else{var n=this.parseMaybeAssign();return this.semicolon(),n}};rn.checkExport=function(t,e,i){t&&(typeof e!="string"&&(e=e.type==="Identifier"?e.name:e.value),lx(t,e)&&this.raiseRecoverable(i,"Duplicate export '"+e+"'"),t[e]=!0)};rn.checkPatternExport=function(t,e){var i=e.type;if(i==="Identifier")this.checkExport(t,e,e.start);else if(i==="ObjectPattern")for(var n=0,r=e.properties;n<r.length;n+=1){var s=r[n];this.checkPatternExport(t,s)}else if(i==="ArrayPattern")for(var o=0,a=e.elements;o<a.length;o+=1){var l=a[o];l&&this.checkPatternExport(t,l)}else i==="Property"?this.checkPatternExport(t,e.value):i==="AssignmentPattern"?this.checkPatternExport(t,e.left):i==="RestElement"&&this.checkPatternExport(t,e.argument)};rn.checkVariableExport=function(t,e){if(t)for(var i=0,n=e;i<n.length;i+=1){var r=n[i];this.checkPatternExport(t,r.id)}};rn.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()};rn.parseExportSpecifier=function(t){var e=this.startNode();return e.local=this.parseModuleExportName(),e.exported=this.eatContextual("as")?this.parseModuleExportName():e.local,this.checkExport(t,e.exported,e.exported.start),this.finishNode(e,"ExportSpecifier")};rn.parseExportSpecifiers=function(t){var e=[],i=!0;for(this.expect(_e.braceL);!this.eat(_e.braceR);){if(i)i=!1;else if(this.expect(_e.comma),this.afterTrailingComma(_e.braceR))break;e.push(this.parseExportSpecifier(t))}return e};rn.parseImport=function(t){return this.next(),this.type===_e.string?(t.specifiers=dAe,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===_e.string?this.parseExprAtom():this.unexpected()),this.options.ecmaVersion>=16&&(t.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(t,"ImportDeclaration")};rn.parseImportSpecifier=function(){var t=this.startNode();return t.imported=this.parseModuleExportName(),this.eatContextual("as")?t.local=this.parseIdent():(this.checkUnreserved(t.imported),t.local=t.imported),this.checkLValSimple(t.local,rf),this.finishNode(t,"ImportSpecifier")};rn.parseImportDefaultSpecifier=function(){var t=this.startNode();return t.local=this.parseIdent(),this.checkLValSimple(t.local,rf),this.finishNode(t,"ImportDefaultSpecifier")};rn.parseImportNamespaceSpecifier=function(){var t=this.startNode();return this.next(),this.expectContextual("as"),t.local=this.parseIdent(),this.checkLValSimple(t.local,rf),this.finishNode(t,"ImportNamespaceSpecifier")};rn.parseImportSpecifiers=function(){var t=[],e=!0;if(this.type===_e.name&&(t.push(this.parseImportDefaultSpecifier()),!this.eat(_e.comma)))return t;if(this.type===_e.star)return t.push(this.parseImportNamespaceSpecifier()),t;for(this.expect(_e.braceL);!this.eat(_e.braceR);){if(e)e=!1;else if(this.expect(_e.comma),this.afterTrailingComma(_e.braceR))break;t.push(this.parseImportSpecifier())}return t};rn.parseWithClause=function(){var t=[];if(!this.eat(_e._with))return t;this.expect(_e.braceL);for(var e={},i=!0;!this.eat(_e.braceR);){if(i)i=!1;else if(this.expect(_e.comma),this.afterTrailingComma(_e.braceR))break;var n=this.parseImportAttribute(),r=n.key.type==="Identifier"?n.key.name:n.key.value;lx(e,r)&&this.raiseRecoverable(n.key.start,"Duplicate attribute key '"+r+"'"),e[r]=!0,t.push(n)}return t};rn.parseImportAttribute=function(){var t=this.startNode();return t.key=this.type===_e.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never"),this.expect(_e.colon),this.type!==_e.string&&this.unexpected(),t.value=this.parseExprAtom(),this.finishNode(t,"ImportAttribute")};rn.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===_e.string){var t=this.parseLiteral(this.value);return aAe.test(t.value)&&this.raise(t.start,"An export name cannot include a lone surrogate."),t}return this.parseIdent(!0)};rn.adaptDirectivePrologue=function(t){for(var e=0;e<t.length&&this.isDirectiveCandidate(t[e]);++e)t[e].directive=t[e].expression.raw.slice(1,-1)};rn.isDirectiveCandidate=function(t){return this.options.ecmaVersion>=5&&t.type==="ExpressionStatement"&&t.expression.type==="Literal"&&typeof t.expression.value=="string"&&(this.input[t.start]==='"'||this.input[t.start]==="'")};var Xc=bs.prototype;Xc.toAssignable=function(t,e,i){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"Identifier":this.inAsync&&t.name==="await"&&this.raise(t.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":t.type="ObjectPattern",i&&this.checkPatternErrors(i,!0);for(var n=0,r=t.properties;n<r.length;n+=1){var s=r[n];this.toAssignable(s,e),s.type==="RestElement"&&(s.argument.type==="ArrayPattern"||s.argument.type==="ObjectPattern")&&this.raise(s.argument.start,"Unexpected token")}break;case"Property":t.kind!=="init"&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,e);break;case"ArrayExpression":t.type="ArrayPattern",i&&this.checkPatternErrors(i,!0),this.toAssignableList(t.elements,e);break;case"SpreadElement":t.type="RestElement",this.toAssignable(t.argument,e),t.argument.type==="AssignmentPattern"&&this.raise(t.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":t.operator!=="="&&this.raise(t.left.end,"Only '=' operator can be used for specifying default value."),t.type="AssignmentPattern",delete t.operator,this.toAssignable(t.left,e);break;case"ParenthesizedExpression":this.toAssignable(t.expression,e,i);break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!e)break;default:this.raise(t.start,"Assigning to rvalue")}else i&&this.checkPatternErrors(i,!0);return t};Xc.toAssignableList=function(t,e){for(var i=t.length,n=0;n<i;n++){var r=t[n];r&&this.toAssignable(r,e)}if(i){var s=t[i-1];this.options.ecmaVersion===6&&e&&s&&s.type==="RestElement"&&s.argument.type!=="Identifier"&&this.unexpected(s.argument.start)}return t};Xc.parseSpread=function(t){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,t),this.finishNode(e,"SpreadElement")};Xc.parseRestBinding=function(){var t=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==_e.name&&this.unexpected(),t.argument=this.parseBindingAtom(),this.finishNode(t,"RestElement")};Xc.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case _e.bracketL:var t=this.startNode();return this.next(),t.elements=this.parseBindingList(_e.bracketR,!0,!0),this.finishNode(t,"ArrayPattern");case _e.braceL:return this.parseObj(!0)}return this.parseIdent()};Xc.parseBindingList=function(t,e,i,n){for(var r=[],s=!0;!this.eat(t);)if(s?s=!1:this.expect(_e.comma),e&&this.type===_e.comma)r.push(null);else{if(i&&this.afterTrailingComma(t))break;if(this.type===_e.ellipsis){var o=this.parseRestBinding();this.parseBindingListItem(o),r.push(o),this.type===_e.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(t);break}else r.push(this.parseAssignableListItem(n))}return r};Xc.parseAssignableListItem=function(t){var e=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(e),e};Xc.parseBindingListItem=function(t){return t};Xc.parseMaybeDefault=function(t,e,i){if(i=i||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(_e.eq))return i;var n=this.startNodeAt(t,e);return n.left=i,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")};Xc.checkLValSimple=function(t,e,i){e===void 0&&(e=zT);var n=e!==zT;switch(t.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(t.name)&&this.raiseRecoverable(t.start,(n?"Binding ":"Assigning to ")+t.name+" in strict mode"),n&&(e===rf&&t.name==="let"&&this.raiseRecoverable(t.start,"let is disallowed as a lexically bound name"),i&&(lx(i,t.name)&&this.raiseRecoverable(t.start,"Argument name clash"),i[t.name]=!0),e!==Oee&&this.declareName(t.name,e,t.start));break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":n&&this.raiseRecoverable(t.start,"Binding member expression");break;case"ParenthesizedExpression":return n&&this.raiseRecoverable(t.start,"Binding parenthesized expression"),this.checkLValSimple(t.expression,e,i);default:this.raise(t.start,(n?"Binding":"Assigning to")+" rvalue")}};Xc.checkLValPattern=function(t,e,i){switch(e===void 0&&(e=zT),t.type){case"ObjectPattern":for(var n=0,r=t.properties;n<r.length;n+=1){var s=r[n];this.checkLValInnerPattern(s,e,i)}break;case"ArrayPattern":for(var o=0,a=t.elements;o<a.length;o+=1){var l=a[o];l&&this.checkLValInnerPattern(l,e,i)}break;default:this.checkLValSimple(t,e,i)}};Xc.checkLValInnerPattern=function(t,e,i){switch(e===void 0&&(e=zT),t.type){case"Property":this.checkLValInnerPattern(t.value,e,i);break;case"AssignmentPattern":this.checkLValPattern(t.left,e,i);break;case"RestElement":this.checkLValPattern(t.argument,e,i);break;default:this.checkLValPattern(t,e,i)}};var Ea=function(e,i,n,r,s){this.token=e,this.isExpr=!!i,this.preserveSpace=!!n,this.override=r,this.generator=!!s},Kr={b_stat:new Ea("{",!1),b_expr:new Ea("{",!0),b_tmpl:new Ea("${",!1),p_stat:new Ea("(",!1),p_expr:new Ea("(",!0),q_tmpl:new Ea("`",!0,!0,function(t){return t.tryReadTemplateToken()}),f_stat:new Ea("function",!1),f_expr:new Ea("function",!0),f_expr_gen:new Ea("function",!0,!1,null,!0),f_gen:new Ea("function",!1,!1,null,!0)},ux=bs.prototype;ux.initialContext=function(){return[Kr.b_stat]};ux.curContext=function(){return this.context[this.context.length-1]};ux.braceIsBlock=function(t){var e=this.curContext();return e===Kr.f_expr||e===Kr.f_stat?!0:t===_e.colon&&(e===Kr.b_stat||e===Kr.b_expr)?!e.isExpr:t===_e._return||t===_e.name&&this.exprAllowed?oc.test(this.input.slice(this.lastTokEnd,this.start)):t===_e._else||t===_e.semi||t===_e.eof||t===_e.parenR||t===_e.arrow?!0:t===_e.braceL?e===Kr.b_stat:t===_e._var||t===_e._const||t===_e.name?!1:!this.exprAllowed};ux.inGeneratorContext=function(){for(var t=this.context.length-1;t>=1;t--){var e=this.context[t];if(e.token==="function")return e.generator}return!1};ux.updateContext=function(t){var e,i=this.type;i.keyword&&t===_e.dot?this.exprAllowed=!1:(e=i.updateContext)?e.call(this,t):this.exprAllowed=i.beforeExpr};ux.overrideContext=function(t){this.curContext()!==t&&(this.context[this.context.length-1]=t)};_e.parenR.updateContext=_e.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var t=this.context.pop();t===Kr.b_stat&&this.curContext().token==="function"&&(t=this.context.pop()),this.exprAllowed=!t.isExpr};_e.braceL.updateContext=function(t){this.context.push(this.braceIsBlock(t)?Kr.b_stat:Kr.b_expr),this.exprAllowed=!0};_e.dollarBraceL.updateContext=function(){this.context.push(Kr.b_tmpl),this.exprAllowed=!0};_e.parenL.updateContext=function(t){var e=t===_e._if||t===_e._for||t===_e._with||t===_e._while;this.context.push(e?Kr.p_stat:Kr.p_expr),this.exprAllowed=!0};_e.incDec.updateContext=function(){};_e._function.updateContext=_e._class.updateContext=function(t){t.beforeExpr&&t!==_e._else&&!(t===_e.semi&&this.curContext()!==Kr.p_stat)&&!(t===_e._return&&oc.test(this.input.slice(this.lastTokEnd,this.start)))&&!((t===_e.colon||t===_e.braceL)&&this.curContext()===Kr.b_stat)?this.context.push(Kr.f_expr):this.context.push(Kr.f_stat),this.exprAllowed=!1};_e.colon.updateContext=function(){this.curContext().token==="function"&&this.context.pop(),this.exprAllowed=!0};_e.backQuote.updateContext=function(){this.curContext()===Kr.q_tmpl?this.context.pop():this.context.push(Kr.q_tmpl),this.exprAllowed=!1};_e.star.updateContext=function(t){if(t===_e._function){var e=this.context.length-1;this.context[e]===Kr.f_expr?this.context[e]=Kr.f_expr_gen:this.context[e]=Kr.f_gen}this.exprAllowed=!0};_e.name.updateContext=function(t){var e=!1;this.options.ecmaVersion>=6&&t!==_e.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var yn=bs.prototype;yn.checkPropClash=function(t,e,i){if(!(this.options.ecmaVersion>=9&&t.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(t.computed||t.method||t.shorthand))){var n=t.key,r;switch(n.type){case"Identifier":r=n.name;break;case"Literal":r=String(n.value);break;default:return}var s=t.kind;if(this.options.ecmaVersion>=6){r==="__proto__"&&s==="init"&&(e.proto&&(i?i.doubleProto<0&&(i.doubleProto=n.start):this.raiseRecoverable(n.start,"Redefinition of __proto__ property")),e.proto=!0);return}r="$"+r;var o=e[r];if(o){var a;s==="init"?a=this.strict&&o.init||o.get||o.set:a=o.init||o[s],a&&this.raiseRecoverable(n.start,"Redefinition of property")}else o=e[r]={init:!1,get:!1,set:!1};o[s]=!0}};yn.parseExpression=function(t,e){var i=this.start,n=this.startLoc,r=this.parseMaybeAssign(t,e);if(this.type===_e.comma){var s=this.startNodeAt(i,n);for(s.expressions=[r];this.eat(_e.comma);)s.expressions.push(this.parseMaybeAssign(t,e));return this.finishNode(s,"SequenceExpression")}return r};yn.parseMaybeAssign=function(t,e,i){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(t);this.exprAllowed=!1}var n=!1,r=-1,s=-1,o=-1;e?(r=e.parenthesizedAssign,s=e.trailingComma,o=e.doubleProto,e.parenthesizedAssign=e.trailingComma=-1):(e=new AP,n=!0);var a=this.start,l=this.startLoc;(this.type===_e.parenL||this.type===_e.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=t==="await");var u=this.parseMaybeConditional(t,e);if(i&&(u=i.call(this,u,a,l)),this.type.isAssign){var d=this.startNodeAt(a,l);return d.operator=this.value,this.type===_e.eq&&(u=this.toAssignable(u,!1,e)),n||(e.parenthesizedAssign=e.trailingComma=e.doubleProto=-1),e.shorthandAssign>=u.start&&(e.shorthandAssign=-1),this.type===_e.eq?this.checkLValPattern(u):this.checkLValSimple(u),d.left=u,this.next(),d.right=this.parseMaybeAssign(t),o>-1&&(e.doubleProto=o),this.finishNode(d,"AssignmentExpression")}else n&&this.checkExpressionErrors(e,!0);return r>-1&&(e.parenthesizedAssign=r),s>-1&&(e.trailingComma=s),u};yn.parseMaybeConditional=function(t,e){var i=this.start,n=this.startLoc,r=this.parseExprOps(t,e);if(this.checkExpressionErrors(e))return r;if(this.eat(_e.question)){var s=this.startNodeAt(i,n);return s.test=r,s.consequent=this.parseMaybeAssign(),this.expect(_e.colon),s.alternate=this.parseMaybeAssign(t),this.finishNode(s,"ConditionalExpression")}return r};yn.parseExprOps=function(t,e){var i=this.start,n=this.startLoc,r=this.parseMaybeUnary(e,!1,!1,t);return this.checkExpressionErrors(e)||r.start===i&&r.type==="ArrowFunctionExpression"?r:this.parseExprOp(r,i,n,-1,t)};yn.parseExprOp=function(t,e,i,n,r){var s=this.type.binop;if(s!=null&&(!r||this.type!==_e._in)&&s>n){var o=this.type===_e.logicalOR||this.type===_e.logicalAND,a=this.type===_e.coalesce;a&&(s=_e.logicalAND.binop);var l=this.value;this.next();var u=this.start,d=this.startLoc,p=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,r),u,d,s,r),v=this.buildBinary(e,i,t,p,l,o||a);return(o&&this.type===_e.coalesce||a&&(this.type===_e.logicalOR||this.type===_e.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(v,e,i,n,r)}return t};yn.buildBinary=function(t,e,i,n,r,s){n.type==="PrivateIdentifier"&&this.raise(n.start,"Private identifier can only be left side of binary expression");var o=this.startNodeAt(t,e);return o.left=i,o.operator=r,o.right=n,this.finishNode(o,s?"LogicalExpression":"BinaryExpression")};yn.parseMaybeUnary=function(t,e,i,n){var r=this.start,s=this.startLoc,o;if(this.isContextual("await")&&this.canAwait)o=this.parseAwait(n),e=!0;else if(this.type.prefix){var a=this.startNode(),l=this.type===_e.incDec;a.operator=this.value,a.prefix=!0,this.next(),a.argument=this.parseMaybeUnary(null,!0,l,n),this.checkExpressionErrors(t,!0),l?this.checkLValSimple(a.argument):this.strict&&a.operator==="delete"&&Tee(a.argument)?this.raiseRecoverable(a.start,"Deleting local variable in strict mode"):a.operator==="delete"&&zz(a.argument)?this.raiseRecoverable(a.start,"Private fields can not be deleted"):e=!0,o=this.finishNode(a,l?"UpdateExpression":"UnaryExpression")}else if(!e&&this.type===_e.privateId)(n||this.privateNameStack.length===0)&&this.options.checkPrivateFields&&this.unexpected(),o=this.parsePrivateIdent(),this.type!==_e._in&&this.unexpected();else{if(o=this.parseExprSubscripts(t,n),this.checkExpressionErrors(t))return o;for(;this.type.postfix&&!this.canInsertSemicolon();){var u=this.startNodeAt(r,s);u.operator=this.value,u.prefix=!1,u.argument=o,this.checkLValSimple(o),this.next(),o=this.finishNode(u,"UpdateExpression")}}if(!i&&this.eat(_e.starstar))if(e)this.unexpected(this.lastTokStart);else return this.buildBinary(r,s,o,this.parseMaybeUnary(null,!1,!1,n),"**",!1);else return o};function Tee(t){return t.type==="Identifier"||t.type==="ParenthesizedExpression"&&Tee(t.expression)}function zz(t){return t.type==="MemberExpression"&&t.property.type==="PrivateIdentifier"||t.type==="ChainExpression"&&zz(t.expression)||t.type==="ParenthesizedExpression"&&zz(t.expression)}yn.parseExprSubscripts=function(t,e){var i=this.start,n=this.startLoc,r=this.parseExprAtom(t,e);if(r.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return r;var s=this.parseSubscripts(r,i,n,!1,e);return t&&s.type==="MemberExpression"&&(t.parenthesizedAssign>=s.start&&(t.parenthesizedAssign=-1),t.parenthesizedBind>=s.start&&(t.parenthesizedBind=-1),t.trailingComma>=s.start&&(t.trailingComma=-1)),s};yn.parseSubscripts=function(t,e,i,n,r){for(var s=this.options.ecmaVersion>=8&&t.type==="Identifier"&&t.name==="async"&&this.lastTokEnd===t.end&&!this.canInsertSemicolon()&&t.end-t.start===5&&this.potentialArrowAt===t.start,o=!1;;){var a=this.parseSubscript(t,e,i,n,s,o,r);if(a.optional&&(o=!0),a===t||a.type==="ArrowFunctionExpression"){if(o){var l=this.startNodeAt(e,i);l.expression=a,a=this.finishNode(l,"ChainExpression")}return a}t=a}};yn.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(_e.arrow)};yn.parseSubscriptAsyncArrow=function(t,e,i,n){return this.parseArrowExpression(this.startNodeAt(t,e),i,!0,n)};yn.parseSubscript=function(t,e,i,n,r,s,o){var a=this.options.ecmaVersion>=11,l=a&&this.eat(_e.questionDot);n&&l&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var u=this.eat(_e.bracketL);if(u||l&&this.type!==_e.parenL&&this.type!==_e.backQuote||this.eat(_e.dot)){var d=this.startNodeAt(e,i);d.object=t,u?(d.property=this.parseExpression(),this.expect(_e.bracketR)):this.type===_e.privateId&&t.type!=="Super"?d.property=this.parsePrivateIdent():d.property=this.parseIdent(this.options.allowReserved!=="never"),d.computed=!!u,a&&(d.optional=l),t=this.finishNode(d,"MemberExpression")}else if(!n&&this.eat(_e.parenL)){var p=new AP,v=this.yieldPos,y=this.awaitPos,w=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var R=this.parseExprList(_e.parenR,this.options.ecmaVersion>=8,!1,p);if(r&&!l&&this.shouldParseAsyncArrow())return this.checkPatternErrors(p,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=v,this.awaitPos=y,this.awaitIdentPos=w,this.parseSubscriptAsyncArrow(e,i,R,o);this.checkExpressionErrors(p,!0),this.yieldPos=v||this.yieldPos,this.awaitPos=y||this.awaitPos,this.awaitIdentPos=w||this.awaitIdentPos;var O=this.startNodeAt(e,i);O.callee=t,O.arguments=R,a&&(O.optional=l),t=this.finishNode(O,"CallExpression")}else if(this.type===_e.backQuote){(l||s)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var P=this.startNodeAt(e,i);P.tag=t,P.quasi=this.parseTemplate({isTagged:!0}),t=this.finishNode(P,"TaggedTemplateExpression")}return t};yn.parseExprAtom=function(t,e,i){this.type===_e.slash&&this.readRegexp();var n,r=this.potentialArrowAt===this.start;switch(this.type){case _e._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),n=this.startNode(),this.next(),this.type===_e.parenL&&!this.allowDirectSuper&&this.raise(n.start,"super() call outside constructor of a subclass"),this.type!==_e.dot&&this.type!==_e.bracketL&&this.type!==_e.parenL&&this.unexpected(),this.finishNode(n,"Super");case _e._this:return n=this.startNode(),this.next(),this.finishNode(n,"ThisExpression");case _e.name:var s=this.start,o=this.startLoc,a=this.containsEsc,l=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!a&&l.name==="async"&&!this.canInsertSemicolon()&&this.eat(_e._function))return this.overrideContext(Kr.f_expr),this.parseFunction(this.startNodeAt(s,o),0,!1,!0,e);if(r&&!this.canInsertSemicolon()){if(this.eat(_e.arrow))return this.parseArrowExpression(this.startNodeAt(s,o),[l],!1,e);if(this.options.ecmaVersion>=8&&l.name==="async"&&this.type===_e.name&&!a&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return l=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(_e.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(s,o),[l],!0,e)}return l;case _e.regexp:var u=this.value;return n=this.parseLiteral(u.value),n.regex={pattern:u.pattern,flags:u.flags},n;case _e.num:case _e.string:return this.parseLiteral(this.value);case _e._null:case _e._true:case _e._false:return n=this.startNode(),n.value=this.type===_e._null?null:this.type===_e._true,n.raw=this.type.keyword,this.next(),this.finishNode(n,"Literal");case _e.parenL:var d=this.start,p=this.parseParenAndDistinguishExpression(r,e);return t&&(t.parenthesizedAssign<0&&!this.isSimpleAssignTarget(p)&&(t.parenthesizedAssign=d),t.parenthesizedBind<0&&(t.parenthesizedBind=d)),p;case _e.bracketL:return n=this.startNode(),this.next(),n.elements=this.parseExprList(_e.bracketR,!0,!0,t),this.finishNode(n,"ArrayExpression");case _e.braceL:return this.overrideContext(Kr.b_expr),this.parseObj(!1,t);case _e._function:return n=this.startNode(),this.next(),this.parseFunction(n,0);case _e._class:return this.parseClass(this.startNode(),!1);case _e._new:return this.parseNew();case _e.backQuote:return this.parseTemplate();case _e._import:return this.options.ecmaVersion>=11?this.parseExprImport(i):this.unexpected();default:return this.parseExprAtomDefault()}};yn.parseExprAtomDefault=function(){this.unexpected()};yn.parseExprImport=function(t){var e=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===_e.parenL&&!t)return this.parseDynamicImport(e);if(this.type===_e.dot){var i=this.startNodeAt(e.start,e.loc&&e.loc.start);return i.name="import",e.meta=this.finishNode(i,"Identifier"),this.parseImportMeta(e)}else this.unexpected()};yn.parseDynamicImport=function(t){if(this.next(),t.source=this.parseMaybeAssign(),this.options.ecmaVersion>=16)this.eat(_e.parenR)?t.options=null:(this.expect(_e.comma),this.afterTrailingComma(_e.parenR)?t.options=null:(t.options=this.parseMaybeAssign(),this.eat(_e.parenR)||(this.expect(_e.comma),this.afterTrailingComma(_e.parenR)||this.unexpected())));else if(!this.eat(_e.parenR)){var e=this.start;this.eat(_e.comma)&&this.eat(_e.parenR)?this.raiseRecoverable(e,"Trailing comma is not allowed in import()"):this.unexpected(e)}return this.finishNode(t,"ImportExpression")};yn.parseImportMeta=function(t){this.next();var e=this.containsEsc;return t.property=this.parseIdent(!0),t.property.name!=="meta"&&this.raiseRecoverable(t.property.start,"The only valid meta property for import is 'import.meta'"),e&&this.raiseRecoverable(t.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(t.start,"Cannot use 'import.meta' outside a module"),this.finishNode(t,"MetaProperty")};yn.parseLiteral=function(t){var e=this.startNode();return e.value=t,e.raw=this.input.slice(this.start,this.end),e.raw.charCodeAt(e.raw.length-1)===110&&(e.bigint=e.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(e,"Literal")};yn.parseParenExpression=function(){this.expect(_e.parenL);var t=this.parseExpression();return this.expect(_e.parenR),t};yn.shouldParseArrow=function(t){return!this.canInsertSemicolon()};yn.parseParenAndDistinguishExpression=function(t,e){var i=this.start,n=this.startLoc,r,s=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var o=this.start,a=this.startLoc,l=[],u=!0,d=!1,p=new AP,v=this.yieldPos,y=this.awaitPos,w;for(this.yieldPos=0,this.awaitPos=0;this.type!==_e.parenR;)if(u?u=!1:this.expect(_e.comma),s&&this.afterTrailingComma(_e.parenR,!0)){d=!0;break}else if(this.type===_e.ellipsis){w=this.start,l.push(this.parseParenItem(this.parseRestBinding())),this.type===_e.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}else l.push(this.parseMaybeAssign(!1,p,this.parseParenItem));var R=this.lastTokEnd,O=this.lastTokEndLoc;if(this.expect(_e.parenR),t&&this.shouldParseArrow(l)&&this.eat(_e.arrow))return this.checkPatternErrors(p,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=v,this.awaitPos=y,this.parseParenArrowList(i,n,l,e);(!l.length||d)&&this.unexpected(this.lastTokStart),w&&this.unexpected(w),this.checkExpressionErrors(p,!0),this.yieldPos=v||this.yieldPos,this.awaitPos=y||this.awaitPos,l.length>1?(r=this.startNodeAt(o,a),r.expressions=l,this.finishNodeAt(r,"SequenceExpression",R,O)):r=l[0]}else r=this.parseParenExpression();if(this.options.preserveParens){var P=this.startNodeAt(i,n);return P.expression=r,this.finishNode(P,"ParenthesizedExpression")}else return r};yn.parseParenItem=function(t){return t};yn.parseParenArrowList=function(t,e,i,n){return this.parseArrowExpression(this.startNodeAt(t,e),i,!1,n)};var pAe=[];yn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var t=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===_e.dot){var e=this.startNodeAt(t.start,t.loc&&t.loc.start);e.name="new",t.meta=this.finishNode(e,"Identifier"),this.next();var i=this.containsEsc;return t.property=this.parseIdent(!0),t.property.name!=="target"&&this.raiseRecoverable(t.property.start,"The only valid meta property for new is 'new.target'"),i&&this.raiseRecoverable(t.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(t.start,"'new.target' can only be used in functions and class static block"),this.finishNode(t,"MetaProperty")}var n=this.start,r=this.startLoc;return t.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),n,r,!0,!1),this.eat(_e.parenL)?t.arguments=this.parseExprList(_e.parenR,this.options.ecmaVersion>=8,!1):t.arguments=pAe,this.finishNode(t,"NewExpression")};yn.parseTemplateElement=function(t){var e=t.isTagged,i=this.startNode();return this.type===_e.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),i.value={raw:this.value.replace(/\r\n?/g,`
`),cooked:null}):i.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),i.tail=this.type===_e.backQuote,this.finishNode(i,"TemplateElement")};yn.parseTemplate=function(t){t===void 0&&(t={});var e=t.isTagged;e===void 0&&(e=!1);var i=this.startNode();this.next(),i.expressions=[];var n=this.parseTemplateElement({isTagged:e});for(i.quasis=[n];!n.tail;)this.type===_e.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(_e.dollarBraceL),i.expressions.push(this.parseExpression()),this.expect(_e.braceR),i.quasis.push(n=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(i,"TemplateLiteral")};yn.isAsyncProp=function(t){return!t.computed&&t.key.type==="Identifier"&&t.key.name==="async"&&(this.type===_e.name||this.type===_e.num||this.type===_e.string||this.type===_e.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===_e.star)&&!oc.test(this.input.slice(this.lastTokEnd,this.start))};yn.parseObj=function(t,e){var i=this.startNode(),n=!0,r={};for(i.properties=[],this.next();!this.eat(_e.braceR);){if(n)n=!1;else if(this.expect(_e.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(_e.braceR))break;var s=this.parseProperty(t,e);t||this.checkPropClash(s,r,e),i.properties.push(s)}return this.finishNode(i,t?"ObjectPattern":"ObjectExpression")};yn.parseProperty=function(t,e){var i=this.startNode(),n,r,s,o;if(this.options.ecmaVersion>=9&&this.eat(_e.ellipsis))return t?(i.argument=this.parseIdent(!1),this.type===_e.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(i,"RestElement")):(i.argument=this.parseMaybeAssign(!1,e),this.type===_e.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(i,"SpreadElement"));this.options.ecmaVersion>=6&&(i.method=!1,i.shorthand=!1,(t||e)&&(s=this.start,o=this.startLoc),t||(n=this.eat(_e.star)));var a=this.containsEsc;return this.parsePropertyName(i),!t&&!a&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(i)?(r=!0,n=this.options.ecmaVersion>=9&&this.eat(_e.star),this.parsePropertyName(i)):r=!1,this.parsePropertyValue(i,t,n,r,s,o,e,a),this.finishNode(i,"Property")};yn.parseGetterSetter=function(t){var e=t.key.name;this.parsePropertyName(t),t.value=this.parseMethod(!1),t.kind=e;var i=t.kind==="get"?0:1;if(t.value.params.length!==i){var n=t.value.start;t.kind==="get"?this.raiseRecoverable(n,"getter should have no params"):this.raiseRecoverable(n,"setter should have exactly one param")}else t.kind==="set"&&t.value.params[0].type==="RestElement"&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params")};yn.parsePropertyValue=function(t,e,i,n,r,s,o,a){(i||n)&&this.type===_e.colon&&this.unexpected(),this.eat(_e.colon)?(t.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,o),t.kind="init"):this.options.ecmaVersion>=6&&this.type===_e.parenL?(e&&this.unexpected(),t.method=!0,t.value=this.parseMethod(i,n),t.kind="init"):!e&&!a&&this.options.ecmaVersion>=5&&!t.computed&&t.key.type==="Identifier"&&(t.key.name==="get"||t.key.name==="set")&&this.type!==_e.comma&&this.type!==_e.braceR&&this.type!==_e.eq?((i||n)&&this.unexpected(),this.parseGetterSetter(t)):this.options.ecmaVersion>=6&&!t.computed&&t.key.type==="Identifier"?((i||n)&&this.unexpected(),this.checkUnreserved(t.key),t.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=r),e?t.value=this.parseMaybeDefault(r,s,this.copyNode(t.key)):this.type===_e.eq&&o?(o.shorthandAssign<0&&(o.shorthandAssign=this.start),t.value=this.parseMaybeDefault(r,s,this.copyNode(t.key))):t.value=this.copyNode(t.key),t.kind="init",t.shorthand=!0):this.unexpected()};yn.parsePropertyName=function(t){if(this.options.ecmaVersion>=6){if(this.eat(_e.bracketL))return t.computed=!0,t.key=this.parseMaybeAssign(),this.expect(_e.bracketR),t.key;t.computed=!1}return t.key=this.type===_e.num||this.type===_e.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")};yn.initFunction=function(t){t.id=null,this.options.ecmaVersion>=6&&(t.generator=t.expression=!1),this.options.ecmaVersion>=8&&(t.async=!1)};yn.parseMethod=function(t,e,i){var n=this.startNode(),r=this.yieldPos,s=this.awaitPos,o=this.awaitIdentPos;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=t),this.options.ecmaVersion>=8&&(n.async=!!e),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(WU(e,n.generator)|PP|(i?_ee:0)),this.expect(_e.parenL),n.params=this.parseBindingList(_e.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(n,!1,!0,!1),this.yieldPos=r,this.awaitPos=s,this.awaitIdentPos=o,this.finishNode(n,"FunctionExpression")};yn.parseArrowExpression=function(t,e,i,n){var r=this.yieldPos,s=this.awaitPos,o=this.awaitIdentPos;return this.enterScope(WU(i,!1)|$U),this.initFunction(t),this.options.ecmaVersion>=8&&(t.async=!!i),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,t.params=this.toAssignableList(e,!0),this.parseFunctionBody(t,!0,!1,n),this.yieldPos=r,this.awaitPos=s,this.awaitIdentPos=o,this.finishNode(t,"ArrowFunctionExpression")};yn.parseFunctionBody=function(t,e,i,n){var r=e&&this.type!==_e.braceL,s=this.strict,o=!1;if(r)t.body=this.parseMaybeAssign(n),t.expression=!0,this.checkParams(t,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(t.params);(!s||a)&&(o=this.strictDirective(this.end),o&&a&&this.raiseRecoverable(t.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var l=this.labels;this.labels=[],o&&(this.strict=!0),this.checkParams(t,!s&&!o&&!e&&!i&&this.isSimpleParamList(t.params)),this.strict&&t.id&&this.checkLValSimple(t.id,Oee),t.body=this.parseBlock(!1,void 0,o&&!s),t.expression=!1,this.adaptDirectivePrologue(t.body.body),this.labels=l}this.exitScope()};yn.isSimpleParamList=function(t){for(var e=0,i=t;e<i.length;e+=1){var n=i[e];if(n.type!=="Identifier")return!1}return!0};yn.checkParams=function(t,e){for(var i=Object.create(null),n=0,r=t.params;n<r.length;n+=1){var s=r[n];this.checkLValInnerPattern(s,qU,e?null:i)}};yn.parseExprList=function(t,e,i,n){for(var r=[],s=!0;!this.eat(t);){if(s)s=!1;else if(this.expect(_e.comma),e&&this.afterTrailingComma(t))break;var o=void 0;i&&this.type===_e.comma?o=null:this.type===_e.ellipsis?(o=this.parseSpread(n),n&&this.type===_e.comma&&n.trailingComma<0&&(n.trailingComma=this.start)):o=this.parseMaybeAssign(!1,n),r.push(o)}return r};yn.checkUnreserved=function(t){var e=t.start,i=t.end,n=t.name;if(this.inGenerator&&n==="yield"&&this.raiseRecoverable(e,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&n==="await"&&this.raiseRecoverable(e,"Cannot use 'await' as identifier inside an async function"),!(this.currentThisScope().flags&EP)&&n==="arguments"&&this.raiseRecoverable(e,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(n==="arguments"||n==="await")&&this.raise(e,"Cannot use "+n+" in class static initialization block"),this.keywords.test(n)&&this.raise(e,"Unexpected keyword '"+n+"'"),!(this.options.ecmaVersion<6&&this.input.slice(e,i).indexOf("\\")!==-1)){var r=this.strict?this.reservedWordsStrict:this.reservedWords;r.test(n)&&(!this.inAsync&&n==="await"&&this.raiseRecoverable(e,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+n+"' is reserved"))}};yn.parseIdent=function(t){var e=this.parseIdentNode();return this.next(!!t),this.finishNode(e,"Identifier"),t||(this.checkUnreserved(e),e.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=e.start)),e};yn.parseIdentNode=function(){var t=this.startNode();return this.type===_e.name?t.name=this.value:this.type.keyword?(t.name=this.type.keyword,(t.name==="class"||t.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop(),this.type=_e.name):this.unexpected(),t};yn.parsePrivateIdent=function(){var t=this.startNode();return this.type===_e.privateId?t.name=this.value:this.unexpected(),this.next(),this.finishNode(t,"PrivateIdentifier"),this.options.checkPrivateFields&&(this.privateNameStack.length===0?this.raise(t.start,"Private field '#"+t.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(t)),t};yn.parseYield=function(t){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===_e.semi||this.canInsertSemicolon()||this.type!==_e.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(_e.star),e.argument=this.parseMaybeAssign(t)),this.finishNode(e,"YieldExpression")};yn.parseAwait=function(t){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0,!1,t),this.finishNode(e,"AwaitExpression")};var GT=bs.prototype;GT.raise=function(t,e){var i=UU(this.input,t);e+=" ("+i.line+":"+i.column+")",this.sourceFile&&(e+=" in "+this.sourceFile);var n=new SyntaxError(e);throw n.pos=t,n.loc=i,n.raisedAt=this.pos,n};GT.raiseRecoverable=GT.raise;GT.curPosition=function(){if(this.options.locations)return new E0(this.curLine,this.pos-this.lineStart)};var Bp=bs.prototype,mAe=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[]};Bp.enterScope=function(t){this.scopeStack.push(new mAe(t))};Bp.exitScope=function(){this.scopeStack.pop()};Bp.treatFunctionsAsVarInScope=function(t){return t.flags&cx||!this.inModule&&t.flags&Z_};Bp.declareName=function(t,e,i){var n=!1;if(e===rf){var r=this.currentScope();n=r.lexical.indexOf(t)>-1||r.functions.indexOf(t)>-1||r.var.indexOf(t)>-1,r.lexical.push(t),this.inModule&&r.flags&Z_&&delete this.undefinedExports[t]}else if(e===See){var s=this.currentScope();s.lexical.push(t)}else if(e===Cee){var o=this.currentScope();this.treatFunctionsAsVar?n=o.lexical.indexOf(t)>-1:n=o.lexical.indexOf(t)>-1||o.var.indexOf(t)>-1,o.functions.push(t)}else for(var a=this.scopeStack.length-1;a>=0;--a){var l=this.scopeStack[a];if(l.lexical.indexOf(t)>-1&&!(l.flags&wee&&l.lexical[0]===t)||!this.treatFunctionsAsVarInScope(l)&&l.functions.indexOf(t)>-1){n=!0;break}if(l.var.push(t),this.inModule&&l.flags&Z_&&delete this.undefinedExports[t],l.flags&EP)break}n&&this.raiseRecoverable(i,"Identifier '"+t+"' has already been declared")};Bp.checkLocalExport=function(t){this.scopeStack[0].lexical.indexOf(t.name)===-1&&this.scopeStack[0].var.indexOf(t.name)===-1&&(this.undefinedExports[t.name]=t)};Bp.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]};Bp.currentVarScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(e.flags&(EP|HC|tv))return e}};Bp.currentThisScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(e.flags&(EP|HC|tv)&&!(e.flags&$U))return e}};var $C=function(e,i,n){this.type="",this.start=i,this.end=0,e.options.locations&&(this.loc=new UC(e,n)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[i,0])},WC=bs.prototype;WC.startNode=function(){return new $C(this,this.start,this.startLoc)};WC.startNodeAt=function(t,e){return new $C(this,t,e)};function Ree(t,e,i,n){return t.type=e,t.end=i,this.options.locations&&(t.loc.end=n),this.options.ranges&&(t.range[1]=i),t}WC.finishNode=function(t,e){return Ree.call(this,t,e,this.lastTokEnd,this.lastTokEndLoc)};WC.finishNodeAt=function(t,e,i,n){return Ree.call(this,t,e,i,n)};WC.copyNode=function(t){var e=new $C(this,t.start,this.startLoc);for(var i in t)e[i]=t[i];return e};var gAe="Gara Garay Gukh Gurung_Khema Hrkt Katakana_Or_Hiragana Kawi Kirat_Rai Krai Nag_Mundari Nagm Ol_Onal Onao Sunu Sunuwar Todhri Todr Tulu_Tigalari Tutg Unknown Zzzz",Pee="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",Eee=Pee+" Extended_Pictographic",Aee=Eee,Iee=Aee+" EBase EComp EMod EPres ExtPict",kee=Iee,vAe=kee,yAe={9:Pee,10:Eee,11:Aee,12:Iee,13:kee,14:vAe},xAe="Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji",bAe={9:"",10:"",11:"",12:"",13:"",14:xAe},G6="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Dee="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Lee=Dee+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Fee=Lee+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Nee=Fee+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",Bee=Nee+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",wAe=Bee+" "+gAe,_Ae={9:Dee,10:Lee,11:Fee,12:Nee,13:Bee,14:wAe},zee={};function CAe(t){var e=zee[t]={binary:lp(yAe[t]+" "+G6),binaryOfStrings:lp(bAe[t]),nonBinary:{General_Category:lp(G6),Script:lp(_Ae[t])}};e.nonBinary.Script_Extensions=e.nonBinary.Script,e.nonBinary.gc=e.nonBinary.General_Category,e.nonBinary.sc=e.nonBinary.Script,e.nonBinary.scx=e.nonBinary.Script_Extensions}for(var mN=0,U6=[9,10,11,12,13,14];mN<U6.length;mN+=1){var SAe=U6[mN];CAe(SAe)}var $i=bs.prototype,UT=function(e,i){this.parent=e,this.base=i||this};UT.prototype.separatedFrom=function(e){for(var i=this;i;i=i.parent)for(var n=e;n;n=n.parent)if(i.base===n.base&&i!==n)return!0;return!1};UT.prototype.sibling=function(){return new UT(this.parent,this.base)};var Vh=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":"")+(e.options.ecmaVersion>=13?"d":"")+(e.options.ecmaVersion>=15?"v":""),this.unicodeProperties=zee[e.options.ecmaVersion>=14?14:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=Object.create(null),this.backReferenceNames=[],this.branchID=null};Vh.prototype.reset=function(e,i,n){var r=n.indexOf("v")!==-1,s=n.indexOf("u")!==-1;this.start=e|0,this.source=i+"",this.flags=n,r&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=s&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=s&&this.parser.options.ecmaVersion>=9)};Vh.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)};Vh.prototype.at=function(e,i){i===void 0&&(i=!1);var n=this.source,r=n.length;if(e>=r)return-1;var s=n.charCodeAt(e);if(!(i||this.switchU)||s<=55295||s>=57344||e+1>=r)return s;var o=n.charCodeAt(e+1);return o>=56320&&o<=57343?(s<<10)+o-56613888:s};Vh.prototype.nextIndex=function(e,i){i===void 0&&(i=!1);var n=this.source,r=n.length;if(e>=r)return r;var s=n.charCodeAt(e),o;return!(i||this.switchU)||s<=55295||s>=57344||e+1>=r||(o=n.charCodeAt(e+1))<56320||o>57343?e+1:e+2};Vh.prototype.current=function(e){return e===void 0&&(e=!1),this.at(this.pos,e)};Vh.prototype.lookahead=function(e){return e===void 0&&(e=!1),this.at(this.nextIndex(this.pos,e),e)};Vh.prototype.advance=function(e){e===void 0&&(e=!1),this.pos=this.nextIndex(this.pos,e)};Vh.prototype.eat=function(e,i){return i===void 0&&(i=!1),this.current(i)===e?(this.advance(i),!0):!1};Vh.prototype.eatChars=function(e,i){i===void 0&&(i=!1);for(var n=this.pos,r=0,s=e;r<s.length;r+=1){var o=s[r],a=this.at(n,i);if(a===-1||a!==o)return!1;n=this.nextIndex(n,i)}return this.pos=n,!0};$i.validateRegExpFlags=function(t){for(var e=t.validFlags,i=t.flags,n=!1,r=!1,s=0;s<i.length;s++){var o=i.charAt(s);e.indexOf(o)===-1&&this.raise(t.start,"Invalid regular expression flag"),i.indexOf(o,s+1)>-1&&this.raise(t.start,"Duplicate regular expression flag"),o==="u"&&(n=!0),o==="v"&&(r=!0)}this.options.ecmaVersion>=15&&n&&r&&this.raise(t.start,"Invalid regular expression flag")};function OAe(t){for(var e in t)return!0;return!1}$i.validateRegExpPattern=function(t){this.regexp_pattern(t),!t.switchN&&this.options.ecmaVersion>=9&&OAe(t.groupNames)&&(t.switchN=!0,this.regexp_pattern(t))};$i.regexp_pattern=function(t){t.pos=0,t.lastIntValue=0,t.lastStringValue="",t.lastAssertionIsQuantifiable=!1,t.numCapturingParens=0,t.maxBackReference=0,t.groupNames=Object.create(null),t.backReferenceNames.length=0,t.branchID=null,this.regexp_disjunction(t),t.pos!==t.source.length&&(t.eat(41)&&t.raise("Unmatched ')'"),(t.eat(93)||t.eat(125))&&t.raise("Lone quantifier brackets")),t.maxBackReference>t.numCapturingParens&&t.raise("Invalid escape");for(var e=0,i=t.backReferenceNames;e<i.length;e+=1){var n=i[e];t.groupNames[n]||t.raise("Invalid named capture referenced")}};$i.regexp_disjunction=function(t){var e=this.options.ecmaVersion>=16;for(e&&(t.branchID=new UT(t.branchID,null)),this.regexp_alternative(t);t.eat(124);)e&&(t.branchID=t.branchID.sibling()),this.regexp_alternative(t);e&&(t.branchID=t.branchID.parent),this.regexp_eatQuantifier(t,!0)&&t.raise("Nothing to repeat"),t.eat(123)&&t.raise("Lone quantifier brackets")};$i.regexp_alternative=function(t){for(;t.pos<t.source.length&&this.regexp_eatTerm(t););};$i.regexp_eatTerm=function(t){return this.regexp_eatAssertion(t)?(t.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(t)&&t.switchU&&t.raise("Invalid quantifier"),!0):(t.switchU?this.regexp_eatAtom(t):this.regexp_eatExtendedAtom(t))?(this.regexp_eatQuantifier(t),!0):!1};$i.regexp_eatAssertion=function(t){var e=t.pos;if(t.lastAssertionIsQuantifiable=!1,t.eat(94)||t.eat(36))return!0;if(t.eat(92)){if(t.eat(66)||t.eat(98))return!0;t.pos=e}if(t.eat(40)&&t.eat(63)){var i=!1;if(this.options.ecmaVersion>=9&&(i=t.eat(60)),t.eat(61)||t.eat(33))return this.regexp_disjunction(t),t.eat(41)||t.raise("Unterminated group"),t.lastAssertionIsQuantifiable=!i,!0}return t.pos=e,!1};$i.regexp_eatQuantifier=function(t,e){return e===void 0&&(e=!1),this.regexp_eatQuantifierPrefix(t,e)?(t.eat(63),!0):!1};$i.regexp_eatQuantifierPrefix=function(t,e){return t.eat(42)||t.eat(43)||t.eat(63)||this.regexp_eatBracedQuantifier(t,e)};$i.regexp_eatBracedQuantifier=function(t,e){var i=t.pos;if(t.eat(123)){var n=0,r=-1;if(this.regexp_eatDecimalDigits(t)&&(n=t.lastIntValue,t.eat(44)&&this.regexp_eatDecimalDigits(t)&&(r=t.lastIntValue),t.eat(125)))return r!==-1&&r<n&&!e&&t.raise("numbers out of order in {} quantifier"),!0;t.switchU&&!e&&t.raise("Incomplete quantifier"),t.pos=i}return!1};$i.regexp_eatAtom=function(t){return this.regexp_eatPatternCharacters(t)||t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)};$i.regexp_eatReverseSolidusAtomEscape=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatAtomEscape(t))return!0;t.pos=e}return!1};$i.regexp_eatUncapturingGroup=function(t){var e=t.pos;if(t.eat(40)){if(t.eat(63)){if(this.options.ecmaVersion>=16){var i=this.regexp_eatModifiers(t),n=t.eat(45);if(i||n){for(var r=0;r<i.length;r++){var s=i.charAt(r);i.indexOf(s,r+1)>-1&&t.raise("Duplicate regular expression modifiers")}if(n){var o=this.regexp_eatModifiers(t);!i&&!o&&t.current()===58&&t.raise("Invalid regular expression modifiers");for(var a=0;a<o.length;a++){var l=o.charAt(a);(o.indexOf(l,a+1)>-1||i.indexOf(l)>-1)&&t.raise("Duplicate regular expression modifiers")}}}}if(t.eat(58)){if(this.regexp_disjunction(t),t.eat(41))return!0;t.raise("Unterminated group")}}t.pos=e}return!1};$i.regexp_eatCapturingGroup=function(t){if(t.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(t):t.current()===63&&t.raise("Invalid group"),this.regexp_disjunction(t),t.eat(41))return t.numCapturingParens+=1,!0;t.raise("Unterminated group")}return!1};$i.regexp_eatModifiers=function(t){for(var e="",i=0;(i=t.current())!==-1&&MAe(i);)e+=jd(i),t.advance();return e};function MAe(t){return t===105||t===109||t===115}$i.regexp_eatExtendedAtom=function(t){return t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)||this.regexp_eatInvalidBracedQuantifier(t)||this.regexp_eatExtendedPatternCharacter(t)};$i.regexp_eatInvalidBracedQuantifier=function(t){return this.regexp_eatBracedQuantifier(t,!0)&&t.raise("Nothing to repeat"),!1};$i.regexp_eatSyntaxCharacter=function(t){var e=t.current();return Vee(e)?(t.lastIntValue=e,t.advance(),!0):!1};function Vee(t){return t===36||t>=40&&t<=43||t===46||t===63||t>=91&&t<=94||t>=123&&t<=125}$i.regexp_eatPatternCharacters=function(t){for(var e=t.pos,i=0;(i=t.current())!==-1&&!Vee(i);)t.advance();return t.pos!==e};$i.regexp_eatExtendedPatternCharacter=function(t){var e=t.current();return e!==-1&&e!==36&&!(e>=40&&e<=43)&&e!==46&&e!==63&&e!==91&&e!==94&&e!==124?(t.advance(),!0):!1};$i.regexp_groupSpecifier=function(t){if(t.eat(63)){this.regexp_eatGroupName(t)||t.raise("Invalid group");var e=this.options.ecmaVersion>=16,i=t.groupNames[t.lastStringValue];if(i)if(e)for(var n=0,r=i;n<r.length;n+=1){var s=r[n];s.separatedFrom(t.branchID)||t.raise("Duplicate capture group name")}else t.raise("Duplicate capture group name");e?(i||(t.groupNames[t.lastStringValue]=[])).push(t.branchID):t.groupNames[t.lastStringValue]=!0}};$i.regexp_eatGroupName=function(t){if(t.lastStringValue="",t.eat(60)){if(this.regexp_eatRegExpIdentifierName(t)&&t.eat(62))return!0;t.raise("Invalid capture group name")}return!1};$i.regexp_eatRegExpIdentifierName=function(t){if(t.lastStringValue="",this.regexp_eatRegExpIdentifierStart(t)){for(t.lastStringValue+=jd(t.lastIntValue);this.regexp_eatRegExpIdentifierPart(t);)t.lastStringValue+=jd(t.lastIntValue);return!0}return!1};$i.regexp_eatRegExpIdentifierStart=function(t){var e=t.pos,i=this.options.ecmaVersion>=11,n=t.current(i);return t.advance(i),n===92&&this.regexp_eatRegExpUnicodeEscapeSequence(t,i)&&(n=t.lastIntValue),TAe(n)?(t.lastIntValue=n,!0):(t.pos=e,!1)};function TAe(t){return Eh(t,!0)||t===36||t===95}$i.regexp_eatRegExpIdentifierPart=function(t){var e=t.pos,i=this.options.ecmaVersion>=11,n=t.current(i);return t.advance(i),n===92&&this.regexp_eatRegExpUnicodeEscapeSequence(t,i)&&(n=t.lastIntValue),RAe(n)?(t.lastIntValue=n,!0):(t.pos=e,!1)};function RAe(t){return Ng(t,!0)||t===36||t===95||t===8204||t===8205}$i.regexp_eatAtomEscape=function(t){return this.regexp_eatBackReference(t)||this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)||t.switchN&&this.regexp_eatKGroupName(t)?!0:(t.switchU&&(t.current()===99&&t.raise("Invalid unicode escape"),t.raise("Invalid escape")),!1)};$i.regexp_eatBackReference=function(t){var e=t.pos;if(this.regexp_eatDecimalEscape(t)){var i=t.lastIntValue;if(t.switchU)return i>t.maxBackReference&&(t.maxBackReference=i),!0;if(i<=t.numCapturingParens)return!0;t.pos=e}return!1};$i.regexp_eatKGroupName=function(t){if(t.eat(107)){if(this.regexp_eatGroupName(t))return t.backReferenceNames.push(t.lastStringValue),!0;t.raise("Invalid named reference")}return!1};$i.regexp_eatCharacterEscape=function(t){return this.regexp_eatControlEscape(t)||this.regexp_eatCControlLetter(t)||this.regexp_eatZero(t)||this.regexp_eatHexEscapeSequence(t)||this.regexp_eatRegExpUnicodeEscapeSequence(t,!1)||!t.switchU&&this.regexp_eatLegacyOctalEscapeSequence(t)||this.regexp_eatIdentityEscape(t)};$i.regexp_eatCControlLetter=function(t){var e=t.pos;if(t.eat(99)){if(this.regexp_eatControlLetter(t))return!0;t.pos=e}return!1};$i.regexp_eatZero=function(t){return t.current()===48&&!IP(t.lookahead())?(t.lastIntValue=0,t.advance(),!0):!1};$i.regexp_eatControlEscape=function(t){var e=t.current();return e===116?(t.lastIntValue=9,t.advance(),!0):e===110?(t.lastIntValue=10,t.advance(),!0):e===118?(t.lastIntValue=11,t.advance(),!0):e===102?(t.lastIntValue=12,t.advance(),!0):e===114?(t.lastIntValue=13,t.advance(),!0):!1};$i.regexp_eatControlLetter=function(t){var e=t.current();return Gee(e)?(t.lastIntValue=e%32,t.advance(),!0):!1};function Gee(t){return t>=65&&t<=90||t>=97&&t<=122}$i.regexp_eatRegExpUnicodeEscapeSequence=function(t,e){e===void 0&&(e=!1);var i=t.pos,n=e||t.switchU;if(t.eat(117)){if(this.regexp_eatFixedHexDigits(t,4)){var r=t.lastIntValue;if(n&&r>=55296&&r<=56319){var s=t.pos;if(t.eat(92)&&t.eat(117)&&this.regexp_eatFixedHexDigits(t,4)){var o=t.lastIntValue;if(o>=56320&&o<=57343)return t.lastIntValue=(r-55296)*1024+(o-56320)+65536,!0}t.pos=s,t.lastIntValue=r}return!0}if(n&&t.eat(123)&&this.regexp_eatHexDigits(t)&&t.eat(125)&&PAe(t.lastIntValue))return!0;n&&t.raise("Invalid unicode escape"),t.pos=i}return!1};function PAe(t){return t>=0&&t<=1114111}$i.regexp_eatIdentityEscape=function(t){if(t.switchU)return this.regexp_eatSyntaxCharacter(t)?!0:t.eat(47)?(t.lastIntValue=47,!0):!1;var e=t.current();return e!==99&&(!t.switchN||e!==107)?(t.lastIntValue=e,t.advance(),!0):!1};$i.regexp_eatDecimalEscape=function(t){t.lastIntValue=0;var e=t.current();if(e>=49&&e<=57){do t.lastIntValue=10*t.lastIntValue+(e-48),t.advance();while((e=t.current())>=48&&e<=57);return!0}return!1};var Uee=0,Qd=1,Tc=2;$i.regexp_eatCharacterClassEscape=function(t){var e=t.current();if(EAe(e))return t.lastIntValue=-1,t.advance(),Qd;var i=!1;if(t.switchU&&this.options.ecmaVersion>=9&&((i=e===80)||e===112)){t.lastIntValue=-1,t.advance();var n;if(t.eat(123)&&(n=this.regexp_eatUnicodePropertyValueExpression(t))&&t.eat(125))return i&&n===Tc&&t.raise("Invalid property name"),n;t.raise("Invalid property name")}return Uee};function EAe(t){return t===100||t===68||t===115||t===83||t===119||t===87}$i.regexp_eatUnicodePropertyValueExpression=function(t){var e=t.pos;if(this.regexp_eatUnicodePropertyName(t)&&t.eat(61)){var i=t.lastStringValue;if(this.regexp_eatUnicodePropertyValue(t)){var n=t.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(t,i,n),Qd}}if(t.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(t)){var r=t.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(t,r)}return Uee};$i.regexp_validateUnicodePropertyNameAndValue=function(t,e,i){lx(t.unicodeProperties.nonBinary,e)||t.raise("Invalid property name"),t.unicodeProperties.nonBinary[e].test(i)||t.raise("Invalid property value")};$i.regexp_validateUnicodePropertyNameOrValue=function(t,e){if(t.unicodeProperties.binary.test(e))return Qd;if(t.switchV&&t.unicodeProperties.binaryOfStrings.test(e))return Tc;t.raise("Invalid property name")};$i.regexp_eatUnicodePropertyName=function(t){var e=0;for(t.lastStringValue="";Hee(e=t.current());)t.lastStringValue+=jd(e),t.advance();return t.lastStringValue!==""};function Hee(t){return Gee(t)||t===95}$i.regexp_eatUnicodePropertyValue=function(t){var e=0;for(t.lastStringValue="";AAe(e=t.current());)t.lastStringValue+=jd(e),t.advance();return t.lastStringValue!==""};function AAe(t){return Hee(t)||IP(t)}$i.regexp_eatLoneUnicodePropertyNameOrValue=function(t){return this.regexp_eatUnicodePropertyValue(t)};$i.regexp_eatCharacterClass=function(t){if(t.eat(91)){var e=t.eat(94),i=this.regexp_classContents(t);return t.eat(93)||t.raise("Unterminated character class"),e&&i===Tc&&t.raise("Negated character class may contain strings"),!0}return!1};$i.regexp_classContents=function(t){return t.current()===93?Qd:t.switchV?this.regexp_classSetExpression(t):(this.regexp_nonEmptyClassRanges(t),Qd)};$i.regexp_nonEmptyClassRanges=function(t){for(;this.regexp_eatClassAtom(t);){var e=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassAtom(t)){var i=t.lastIntValue;t.switchU&&(e===-1||i===-1)&&t.raise("Invalid character class"),e!==-1&&i!==-1&&e>i&&t.raise("Range out of order in character class")}}};$i.regexp_eatClassAtom=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatClassEscape(t))return!0;if(t.switchU){var i=t.current();(i===99||qee(i))&&t.raise("Invalid class escape"),t.raise("Invalid escape")}t.pos=e}var n=t.current();return n!==93?(t.lastIntValue=n,t.advance(),!0):!1};$i.regexp_eatClassEscape=function(t){var e=t.pos;if(t.eat(98))return t.lastIntValue=8,!0;if(t.switchU&&t.eat(45))return t.lastIntValue=45,!0;if(!t.switchU&&t.eat(99)){if(this.regexp_eatClassControlLetter(t))return!0;t.pos=e}return this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)};$i.regexp_classSetExpression=function(t){var e=Qd,i;if(!this.regexp_eatClassSetRange(t))if(i=this.regexp_eatClassSetOperand(t)){i===Tc&&(e=Tc);for(var n=t.pos;t.eatChars([38,38]);){if(t.current()!==38&&(i=this.regexp_eatClassSetOperand(t))){i!==Tc&&(e=Qd);continue}t.raise("Invalid character in character class")}if(n!==t.pos)return e;for(;t.eatChars([45,45]);)this.regexp_eatClassSetOperand(t)||t.raise("Invalid character in character class");if(n!==t.pos)return e}else t.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(t)){if(i=this.regexp_eatClassSetOperand(t),!i)return e;i===Tc&&(e=Tc)}};$i.regexp_eatClassSetRange=function(t){var e=t.pos;if(this.regexp_eatClassSetCharacter(t)){var i=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassSetCharacter(t)){var n=t.lastIntValue;return i!==-1&&n!==-1&&i>n&&t.raise("Range out of order in character class"),!0}t.pos=e}return!1};$i.regexp_eatClassSetOperand=function(t){return this.regexp_eatClassSetCharacter(t)?Qd:this.regexp_eatClassStringDisjunction(t)||this.regexp_eatNestedClass(t)};$i.regexp_eatNestedClass=function(t){var e=t.pos;if(t.eat(91)){var i=t.eat(94),n=this.regexp_classContents(t);if(t.eat(93))return i&&n===Tc&&t.raise("Negated character class may contain strings"),n;t.pos=e}if(t.eat(92)){var r=this.regexp_eatCharacterClassEscape(t);if(r)return r;t.pos=e}return null};$i.regexp_eatClassStringDisjunction=function(t){var e=t.pos;if(t.eatChars([92,113])){if(t.eat(123)){var i=this.regexp_classStringDisjunctionContents(t);if(t.eat(125))return i}else t.raise("Invalid escape");t.pos=e}return null};$i.regexp_classStringDisjunctionContents=function(t){for(var e=this.regexp_classString(t);t.eat(124);)this.regexp_classString(t)===Tc&&(e=Tc);return e};$i.regexp_classString=function(t){for(var e=0;this.regexp_eatClassSetCharacter(t);)e++;return e===1?Qd:Tc};$i.regexp_eatClassSetCharacter=function(t){var e=t.pos;if(t.eat(92))return this.regexp_eatCharacterEscape(t)||this.regexp_eatClassSetReservedPunctuator(t)?!0:t.eat(98)?(t.lastIntValue=8,!0):(t.pos=e,!1);var i=t.current();return i<0||i===t.lookahead()&&IAe(i)||kAe(i)?!1:(t.advance(),t.lastIntValue=i,!0)};function IAe(t){return t===33||t>=35&&t<=38||t>=42&&t<=44||t===46||t>=58&&t<=64||t===94||t===96||t===126}function kAe(t){return t===40||t===41||t===45||t===47||t>=91&&t<=93||t>=123&&t<=125}$i.regexp_eatClassSetReservedPunctuator=function(t){var e=t.current();return DAe(e)?(t.lastIntValue=e,t.advance(),!0):!1};function DAe(t){return t===33||t===35||t===37||t===38||t===44||t===45||t>=58&&t<=62||t===64||t===96||t===126}$i.regexp_eatClassControlLetter=function(t){var e=t.current();return IP(e)||e===95?(t.lastIntValue=e%32,t.advance(),!0):!1};$i.regexp_eatHexEscapeSequence=function(t){var e=t.pos;if(t.eat(120)){if(this.regexp_eatFixedHexDigits(t,2))return!0;t.switchU&&t.raise("Invalid escape"),t.pos=e}return!1};$i.regexp_eatDecimalDigits=function(t){var e=t.pos,i=0;for(t.lastIntValue=0;IP(i=t.current());)t.lastIntValue=10*t.lastIntValue+(i-48),t.advance();return t.pos!==e};function IP(t){return t>=48&&t<=57}$i.regexp_eatHexDigits=function(t){var e=t.pos,i=0;for(t.lastIntValue=0;$ee(i=t.current());)t.lastIntValue=16*t.lastIntValue+Wee(i),t.advance();return t.pos!==e};function $ee(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function Wee(t){return t>=65&&t<=70?10+(t-65):t>=97&&t<=102?10+(t-97):t-48}$i.regexp_eatLegacyOctalEscapeSequence=function(t){if(this.regexp_eatOctalDigit(t)){var e=t.lastIntValue;if(this.regexp_eatOctalDigit(t)){var i=t.lastIntValue;e<=3&&this.regexp_eatOctalDigit(t)?t.lastIntValue=e*64+i*8+t.lastIntValue:t.lastIntValue=e*8+i}else t.lastIntValue=e;return!0}return!1};$i.regexp_eatOctalDigit=function(t){var e=t.current();return qee(e)?(t.lastIntValue=e-48,t.advance(),!0):(t.lastIntValue=0,!1)};function qee(t){return t>=48&&t<=55}$i.regexp_eatFixedHexDigits=function(t,e){var i=t.pos;t.lastIntValue=0;for(var n=0;n<e;++n){var r=t.current();if(!$ee(r))return t.pos=i,!1;t.lastIntValue=16*t.lastIntValue+Wee(r),t.advance()}return!0};var kP=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new UC(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},nr=bs.prototype;nr.next=function(t){!t&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new kP(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()};nr.getToken=function(){return this.next(),new kP(this)};typeof Symbol<"u"&&(nr[Symbol.iterator]=function(){var t=this;return{next:function(){var e=t.getToken();return{done:e.type===_e.eof,value:e}}}});nr.nextToken=function(){var t=this.curContext();if((!t||!t.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(_e.eof);if(t.override)return t.override(this);this.readToken(this.fullCharCodeAtPos())};nr.readToken=function(t){return Eh(t,this.options.ecmaVersion>=6)||t===92?this.readWord():this.getTokenFromCode(t)};nr.fullCharCodeAtPos=function(){var t=this.input.charCodeAt(this.pos);if(t<=55295||t>=56320)return t;var e=this.input.charCodeAt(this.pos+1);return e<=56319||e>=57344?t:(t<<10)+e-56613888};nr.skipBlockComment=function(){var t=this.options.onComment&&this.curPosition(),e=this.pos,i=this.input.indexOf("*/",this.pos+=2);if(i===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=i+2,this.options.locations)for(var n=void 0,r=e;(n=yee(this.input,r,this.pos))>-1;)++this.curLine,r=this.lineStart=n;this.options.onComment&&this.options.onComment(!0,this.input.slice(e+2,i),e,this.pos,t,this.curPosition())};nr.skipLineComment=function(t){for(var e=this.pos,i=this.options.onComment&&this.curPosition(),n=this.input.charCodeAt(this.pos+=t);this.pos<this.input.length&&!ev(n);)n=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+t,this.pos),e,this.pos,i,this.curPosition())};nr.skipSpace=function(){e:for(;this.pos<this.input.length;){var t=this.input.charCodeAt(this.pos);switch(t){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(t>8&&t<14||t>=5760&&GU.test(String.fromCharCode(t)))++this.pos;else break e}}};nr.finishToken=function(t,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var i=this.type;this.type=t,this.value=e,this.updateContext(i)};nr.readToken_dot=function(){var t=this.input.charCodeAt(this.pos+1);if(t>=48&&t<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&t===46&&e===46?(this.pos+=3,this.finishToken(_e.ellipsis)):(++this.pos,this.finishToken(_e.dot))};nr.readToken_slash=function(){var t=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):t===61?this.finishOp(_e.assign,2):this.finishOp(_e.slash,1)};nr.readToken_mult_modulo_exp=function(t){var e=this.input.charCodeAt(this.pos+1),i=1,n=t===42?_e.star:_e.modulo;return this.options.ecmaVersion>=7&&t===42&&e===42&&(++i,n=_e.starstar,e=this.input.charCodeAt(this.pos+2)),e===61?this.finishOp(_e.assign,i+1):this.finishOp(n,i)};nr.readToken_pipe_amp=function(t){var e=this.input.charCodeAt(this.pos+1);if(e===t){if(this.options.ecmaVersion>=12){var i=this.input.charCodeAt(this.pos+2);if(i===61)return this.finishOp(_e.assign,3)}return this.finishOp(t===124?_e.logicalOR:_e.logicalAND,2)}return e===61?this.finishOp(_e.assign,2):this.finishOp(t===124?_e.bitwiseOR:_e.bitwiseAND,1)};nr.readToken_caret=function(){var t=this.input.charCodeAt(this.pos+1);return t===61?this.finishOp(_e.assign,2):this.finishOp(_e.bitwiseXOR,1)};nr.readToken_plus_min=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?e===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||oc.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(_e.incDec,2):e===61?this.finishOp(_e.assign,2):this.finishOp(_e.plusMin,1)};nr.readToken_lt_gt=function(t){var e=this.input.charCodeAt(this.pos+1),i=1;return e===t?(i=t===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+i)===61?this.finishOp(_e.assign,i+1):this.finishOp(_e.bitShift,i)):e===33&&t===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(e===61&&(i=2),this.finishOp(_e.relational,i))};nr.readToken_eq_excl=function(t){var e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(_e.equality,this.input.charCodeAt(this.pos+2)===61?3:2):t===61&&e===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(_e.arrow)):this.finishOp(t===61?_e.eq:_e.prefix,1)};nr.readToken_question=function(){var t=this.options.ecmaVersion;if(t>=11){var e=this.input.charCodeAt(this.pos+1);if(e===46){var i=this.input.charCodeAt(this.pos+2);if(i<48||i>57)return this.finishOp(_e.questionDot,2)}if(e===63){if(t>=12){var n=this.input.charCodeAt(this.pos+2);if(n===61)return this.finishOp(_e.assign,3)}return this.finishOp(_e.coalesce,2)}}return this.finishOp(_e.question,1)};nr.readToken_numberSign=function(){var t=this.options.ecmaVersion,e=35;if(t>=13&&(++this.pos,e=this.fullCharCodeAtPos(),Eh(e,!0)||e===92))return this.finishToken(_e.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+jd(e)+"'")};nr.getTokenFromCode=function(t){switch(t){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(_e.parenL);case 41:return++this.pos,this.finishToken(_e.parenR);case 59:return++this.pos,this.finishToken(_e.semi);case 44:return++this.pos,this.finishToken(_e.comma);case 91:return++this.pos,this.finishToken(_e.bracketL);case 93:return++this.pos,this.finishToken(_e.bracketR);case 123:return++this.pos,this.finishToken(_e.braceL);case 125:return++this.pos,this.finishToken(_e.braceR);case 58:return++this.pos,this.finishToken(_e.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(_e.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(e===120||e===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(e===111||e===79)return this.readRadixNumber(8);if(e===98||e===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(t);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(t);case 124:case 38:return this.readToken_pipe_amp(t);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(t);case 60:case 62:return this.readToken_lt_gt(t);case 61:case 33:return this.readToken_eq_excl(t);case 63:return this.readToken_question();case 126:return this.finishOp(_e.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+jd(t)+"'")};nr.finishOp=function(t,e){var i=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(t,i)};nr.readRegexp=function(){for(var t,e,i=this.pos;;){this.pos>=this.input.length&&this.raise(i,"Unterminated regular expression");var n=this.input.charAt(this.pos);if(oc.test(n)&&this.raise(i,"Unterminated regular expression"),t)t=!1;else{if(n==="[")e=!0;else if(n==="]"&&e)e=!1;else if(n==="/"&&!e)break;t=n==="\\"}++this.pos}var r=this.input.slice(i,this.pos);++this.pos;var s=this.pos,o=this.readWord1();this.containsEsc&&this.unexpected(s);var a=this.regexpState||(this.regexpState=new Vh(this));a.reset(i,r,o),this.validateRegExpFlags(a),this.validateRegExpPattern(a);var l=null;try{l=new RegExp(r,o)}catch{}return this.finishToken(_e.regexp,{pattern:r,flags:o,value:l})};nr.readInt=function(t,e,i){for(var n=this.options.ecmaVersion>=12&&e===void 0,r=i&&this.input.charCodeAt(this.pos)===48,s=this.pos,o=0,a=0,l=0,u=e??1/0;l<u;++l,++this.pos){var d=this.input.charCodeAt(this.pos),p=void 0;if(n&&d===95){r&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),a===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),l===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),a=d;continue}if(d>=97?p=d-97+10:d>=65?p=d-65+10:d>=48&&d<=57?p=d-48:p=1/0,p>=t)break;a=d,o=o*t+p}return n&&a===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===s||e!=null&&this.pos-s!==e?null:o};function LAe(t,e){return e?parseInt(t,8):parseFloat(t.replace(/_/g,""))}function jee(t){return typeof BigInt!="function"?null:BigInt(t.replace(/_/g,""))}nr.readRadixNumber=function(t){var e=this.pos;this.pos+=2;var i=this.readInt(t);return i==null&&this.raise(this.start+2,"Expected number in radix "+t),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(i=jee(this.input.slice(e,this.pos)),++this.pos):Eh(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(_e.num,i)};nr.readNumber=function(t){var e=this.pos;!t&&this.readInt(10,void 0,!0)===null&&this.raise(e,"Invalid number");var i=this.pos-e>=2&&this.input.charCodeAt(e)===48;i&&this.strict&&this.raise(e,"Invalid number");var n=this.input.charCodeAt(this.pos);if(!i&&!t&&this.options.ecmaVersion>=11&&n===110){var r=jee(this.input.slice(e,this.pos));return++this.pos,Eh(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(_e.num,r)}i&&/[89]/.test(this.input.slice(e,this.pos))&&(i=!1),n===46&&!i&&(++this.pos,this.readInt(10),n=this.input.charCodeAt(this.pos)),(n===69||n===101)&&!i&&(n=this.input.charCodeAt(++this.pos),(n===43||n===45)&&++this.pos,this.readInt(10)===null&&this.raise(e,"Invalid number")),Eh(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var s=LAe(this.input.slice(e,this.pos),i);return this.finishToken(_e.num,s)};nr.readCodePoint=function(){var t=this.input.charCodeAt(this.pos),e;if(t===123){this.options.ecmaVersion<6&&this.unexpected();var i=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(i,"Code point out of bounds")}else e=this.readHexChar(4);return e};nr.readString=function(t){for(var e="",i=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var n=this.input.charCodeAt(this.pos);if(n===t)break;n===92?(e+=this.input.slice(i,this.pos),e+=this.readEscapedChar(!1),i=this.pos):n===8232||n===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(ev(n)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(i,this.pos++),this.finishToken(_e.string,e)};var Qee={};nr.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(t){if(t===Qee)this.readInvalidTemplateToken();else throw t}this.inTemplateElement=!1};nr.invalidStringToken=function(t,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Qee;this.raise(t,e)};nr.readTmplToken=function(){for(var t="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var i=this.input.charCodeAt(this.pos);if(i===96||i===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===_e.template||this.type===_e.invalidTemplate)?i===36?(this.pos+=2,this.finishToken(_e.dollarBraceL)):(++this.pos,this.finishToken(_e.backQuote)):(t+=this.input.slice(e,this.pos),this.finishToken(_e.template,t));if(i===92)t+=this.input.slice(e,this.pos),t+=this.readEscapedChar(!0),e=this.pos;else if(ev(i)){switch(t+=this.input.slice(e,this.pos),++this.pos,i){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:t+=`
`;break;default:t+=String.fromCharCode(i);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}};nr.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(_e.invalidTemplate,this.input.slice(this.start,this.pos));case"\r":this.input[this.pos+1]===`
`&&++this.pos;case`
`:case"\u2028":case"\u2029":++this.curLine,this.lineStart=this.pos+1;break}this.raise(this.start,"Unterminated template")};nr.readEscapedChar=function(t){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return jd(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),t){var i=this.pos-1;this.invalidStringToken(i,"Invalid escape sequence in template string")}default:if(e>=48&&e<=55){var n=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],r=parseInt(n,8);return r>255&&(n=n.slice(0,-1),r=parseInt(n,8)),this.pos+=n.length-1,e=this.input.charCodeAt(this.pos),(n!=="0"||e===56||e===57)&&(this.strict||t)&&this.invalidStringToken(this.pos-1-n.length,t?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(r)}return ev(e)?(this.options.locations&&(this.lineStart=this.pos,++this.curLine),""):String.fromCharCode(e)}};nr.readHexChar=function(t){var e=this.pos,i=this.readInt(16,t);return i===null&&this.invalidStringToken(e,"Bad character escape sequence"),i};nr.readWord1=function(){this.containsEsc=!1;for(var t="",e=!0,i=this.pos,n=this.options.ecmaVersion>=6;this.pos<this.input.length;){var r=this.fullCharCodeAtPos();if(Ng(r,n))this.pos+=r<=65535?1:2;else if(r===92){this.containsEsc=!0,t+=this.input.slice(i,this.pos);var s=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var o=this.readCodePoint();(e?Eh:Ng)(o,n)||this.invalidStringToken(s,"Invalid Unicode escape"),t+=jd(o),i=this.pos}else break;e=!1}return t+this.input.slice(i,this.pos)};nr.readWord=function(){var t=this.readWord1(),e=_e.name;return this.keywords.test(t)&&(e=P0[t]),this.finishToken(e,t)};var Zee="8.14.1";bs.acorn={Parser:bs,version:Zee,defaultOptions:BT,Position:E0,SourceLocation:UC,getLineInfo:UU,Node:$C,TokenType:zn,tokTypes:_e,keywordTypes:P0,TokContext:Ea,tokContexts:Kr,isIdentifierChar:Ng,isIdentifierStart:Eh,Token:kP,isNewLine:ev,lineBreak:oc,lineBreakG:vee,nonASCIIwhitespace:GU};function FAe(t,e){return bs.parse(t,e)}function NAe(t,e,i){return bs.parseExpressionAt(t,e,i)}function BAe(t,e){return bs.tokenizer(t,e)}const zAe=Object.freeze(Object.defineProperty({__proto__:null,Node:$C,Parser:bs,Position:E0,SourceLocation:UC,TokContext:Ea,Token:kP,TokenType:zn,defaultOptions:BT,getLineInfo:UU,isIdentifierChar:Ng,isIdentifierStart:Eh,isNewLine:ev,keywordTypes:P0,lineBreak:oc,lineBreakG:vee,nonASCIIwhitespace:GU,parse:FAe,parseExpressionAt:NAe,tokContexts:Kr,tokTypes:_e,tokenizer:BAe,version:Zee},Symbol.toStringTag,{value:"Module"}));var Nl=!0;function Bl(t,e={}){return new zn("name",e)}var VAe=new WeakMap;function GAe(t){const e=t.Parser.acorn||t;let i=VAe.get(e);if(!i){let n=function(y){return[_e.name,_e.string,_e.num,...Object.values(P0),...Object.values(u)].includes(y)},r=function(y){return[_e.name,...Object.values(P0),...Object.values(u)].includes(y)},s=function(y){return[...Object.values(u),_e.name].includes(y)},o=function(y){return[u.abstract,u.declare,u.enum,u.module,u.namespace,u.interface,u.type].includes(y)},a=function(y){return[u.keyof,u.readonly,u.unique].includes(y)},l=function(y){return y===_e.invalidTemplate};const u=$Ae(),d=HAe(),p=UAe(),v=new RegExp(`^(?:${Object.keys(u).join("|")})$`);d.jsxTagStart.updateContext=function(){this.context.push(p.tc_expr),this.context.push(p.tc_oTag),this.exprAllowed=!1},d.jsxTagEnd.updateContext=function(y){let w=this.context.pop();w===p.tc_oTag&&y===_e.slash||w===p.tc_cTag?(this.context.pop(),this.exprAllowed=this.curContext()===p.tc_expr):this.exprAllowed=!0},i={tokTypes:{...u,...d},tokContexts:{...p},keywordsRegExp:v,tokenIsLiteralPropertyName:n,tokenIsKeywordOrIdentifier:r,tokenIsIdentifier:s,tokenIsTSDeclarationStart:o,tokenIsTSTypeOperator:a,tokenIsTemplate:l}}return i}function UAe(){return{tc_oTag:new Ea("<tag",!1,!1),tc_cTag:new Ea("</tag",!1,!1),tc_expr:new Ea("<tag>...</tag>",!0,!0)}}function HAe(){return{at:new zn("@"),jsxName:new zn("jsxName"),jsxText:new zn("jsxText",{beforeExpr:!0}),jsxTagStart:new zn("jsxTagStart",{startsExpr:!0}),jsxTagEnd:new zn("jsxTagEnd")}}function $Ae(){return{assert:Bl("assert",{startsExpr:Nl}),asserts:Bl("asserts",{startsExpr:Nl}),global:Bl("global",{startsExpr:Nl}),keyof:Bl("keyof",{startsExpr:Nl}),readonly:Bl("readonly",{startsExpr:Nl}),unique:Bl("unique",{startsExpr:Nl}),abstract:Bl("abstract",{startsExpr:Nl}),declare:Bl("declare",{startsExpr:Nl}),enum:Bl("enum",{startsExpr:Nl}),module:Bl("module",{startsExpr:Nl}),namespace:Bl("namespace",{startsExpr:Nl}),interface:Bl("interface",{startsExpr:Nl}),type:Bl("type",{startsExpr:Nl})}}var WAe=512,qb=1024,qAe=/(?:[^\S\n\r\u2028\u2029]|\/\/.*|\/\*.*?\*\/)*/y,H6=new RegExp("(?=("+qAe.source+"))\\1"+/(?=[\n\r\u2028\u2029]|\/\*(?!.*?\*\/)|$)/.source,"y"),jb=class{constructor(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}};function jAe(t,e){const i=e.key.name,n=t[i];let r="true";return e.type==="MethodDefinition"&&(e.kind==="get"||e.kind==="set")&&(r=(e.static?"s":"i")+e.kind),n==="iget"&&r==="iset"||n==="iset"&&r==="iget"||n==="sget"&&r==="sset"||n==="sset"&&r==="sget"?(t[i]="true",!1):n?!0:(t[i]=r,!1)}function $6(t,e){const{computed:i,key:n}=t;return!i&&(n.type==="Identifier"&&n.name===e||n.type==="Literal"&&n.value===e)}var Zi={AbstractMethodHasImplementation:({methodName:t})=>`Method '${t}' cannot have an implementation because it is marked abstract.`,AbstractPropertyHasInitializer:({propertyName:t})=>`Property '${t}' cannot have an initializer because it is marked abstract.`,AccesorCannotDeclareThisParameter:"'get' and 'set' accessors cannot declare 'this' parameters.",AccesorCannotHaveTypeParameters:"An accessor cannot have type parameters.",CannotFindName:({name:t})=>`Cannot find name '${t}'.`,ClassMethodHasDeclare:"Class methods cannot have the 'declare' modifier.",ClassMethodHasReadonly:"Class methods cannot have the 'readonly' modifier.",ConstInitiailizerMustBeStringOrNumericLiteralOrLiteralEnumReference:"A 'const' initializer in an ambient context must be a string or numeric literal or literal enum reference.",ConstructorHasTypeParameters:"Type parameters cannot appear on a constructor declaration.",DeclareAccessor:({kind:t})=>`'declare' is not allowed in ${t}ters.`,DeclareClassFieldHasInitializer:"Initializers are not allowed in ambient contexts.",DeclareFunctionHasImplementation:"An implementation cannot be declared in ambient contexts.",DuplicateAccessibilityModifier:()=>"Accessibility modifier already seen.",DuplicateModifier:({modifier:t})=>`Duplicate modifier: '${t}'.`,EmptyHeritageClauseType:({token:t})=>`'${t}' list cannot be empty.`,EmptyTypeArguments:"Type argument list cannot be empty.",EmptyTypeParameters:"Type parameter list cannot be empty.",ExpectedAmbientAfterExportDeclare:"'export declare' must be followed by an ambient declaration.",ImportAliasHasImportType:"An import alias can not use 'import type'.",IncompatibleModifiers:({modifiers:t})=>`'${t[0]}' modifier cannot be used with '${t[1]}' modifier.`,IndexSignatureHasAbstract:"Index signatures cannot have the 'abstract' modifier.",IndexSignatureHasAccessibility:({modifier:t})=>`Index signatures cannot have an accessibility modifier ('${t}').`,IndexSignatureHasDeclare:"Index signatures cannot have the 'declare' modifier.",IndexSignatureHasOverride:"'override' modifier cannot appear on an index signature.",IndexSignatureHasStatic:"Index signatures cannot have the 'static' modifier.",InitializerNotAllowedInAmbientContext:"Initializers are not allowed in ambient contexts.",InvalidModifierOnTypeMember:({modifier:t})=>`'${t}' modifier cannot appear on a type member.`,InvalidModifierOnTypeParameter:({modifier:t})=>`'${t}' modifier cannot appear on a type parameter.`,InvalidModifierOnTypeParameterPositions:({modifier:t})=>`'${t}' modifier can only appear on a type parameter of a class, interface or type alias.`,InvalidModifiersOrder:({orderedModifiers:t})=>`'${t[0]}' modifier must precede '${t[1]}' modifier.`,InvalidPropertyAccessAfterInstantiationExpression:"Invalid property access after an instantiation expression. You can either wrap the instantiation expression in parentheses, or delete the type arguments.",InvalidTupleMemberLabel:"Tuple members must be labeled with a simple identifier.",MissingInterfaceName:"'interface' declarations must be followed by an identifier.",MixedLabeledAndUnlabeledElements:"Tuple members must all have names or all not have names.",NonAbstractClassHasAbstractMethod:"Abstract methods can only appear within an abstract class.",NonClassMethodPropertyHasAbstractModifer:"'abstract' modifier can only appear on a class, method, or property declaration.",OptionalTypeBeforeRequired:"A required element cannot follow an optional element.",OverrideNotInSubClass:"This member cannot have an 'override' modifier because its containing class does not extend another class.",PatternIsOptional:"A binding pattern parameter cannot be optional in an implementation signature.",PrivateElementHasAbstract:"Private elements cannot have the 'abstract' modifier.",PrivateElementHasAccessibility:({modifier:t})=>`Private elements cannot have an accessibility modifier ('${t}').`,PrivateMethodsHasAccessibility:({modifier:t})=>`Private methods cannot have an accessibility modifier ('${t}').`,ReadonlyForMethodSignature:"'readonly' modifier can only appear on a property declaration or index signature.",ReservedArrowTypeParam:"This syntax is reserved in files with the .mts or .cts extension. Add a trailing comma, as in `<T,>() => ...`.",ReservedTypeAssertion:"This syntax is reserved in files with the .mts or .cts extension. Use an `as` expression instead.",SetAccesorCannotHaveOptionalParameter:"A 'set' accessor cannot have an optional parameter.",SetAccesorCannotHaveRestParameter:"A 'set' accessor cannot have rest parameter.",SetAccesorCannotHaveReturnType:"A 'set' accessor cannot have a return type annotation.",SingleTypeParameterWithoutTrailingComma:({typeParameterName:t})=>`Single type parameter ${t} should have a trailing comma. Example usage: <${t},>.`,StaticBlockCannotHaveModifier:"Static class blocks cannot have any modifier.",TypeAnnotationAfterAssign:"Type annotations must come before default assignments, e.g. instead of `age = 25: number` use `age: number = 25`.",TypeImportCannotSpecifyDefaultAndNamed:"A type-only import can specify a default import or named bindings, but not both.",TypeModifierIsUsedInTypeExports:"The 'type' modifier cannot be used on a named export when 'export type' is used on its export statement.",TypeModifierIsUsedInTypeImports:"The 'type' modifier cannot be used on a named import when 'import type' is used on its import statement.",UnexpectedParameterModifier:"A parameter property is only allowed in a constructor implementation.",UnexpectedReadonly:"'readonly' type modifier is only permitted on array and tuple literal types.",GenericsEndWithComma:"Trailing comma is not allowed at the end of generics.",UnexpectedTypeAnnotation:"Did not expect a type annotation here.",UnexpectedTypeCastInParameter:"Unexpected type cast in parameter position.",UnsupportedImportTypeArgument:"Argument in a type import must be a string literal.",UnsupportedParameterPropertyKind:"A parameter property may not be declared using a binding pattern.",UnsupportedSignatureParameterKind:({type:t})=>`Name in a signature must be an Identifier, ObjectPattern or ArrayPattern, instead got ${t}.`,LetInLexicalBinding:"'let' is not allowed to be used as a name in 'let' or 'const' declarations."},EM={UnexpectedLeadingDecorator:"Leading decorators must be attached to a class declaration.",DecoratorConstructor:"Decorators can't be used with a constructor. Did you mean '@dec class { ... }'?",TrailingDecorator:"Decorators must be attached to a class element.",SpreadElementDecorator:"Decorators can't be used with SpreadElement"};function QAe(t,e,i){const{tokTypes:n}=i,{tokTypes:r}=e;return class extends t{takeDecorators(o){const a=this.decoratorStack[this.decoratorStack.length-1];a.length&&(o.decorators=a,this.resetStartLocationFromNode(o,a[0]),this.decoratorStack[this.decoratorStack.length-1]=[])}parseDecorators(o){const a=this.decoratorStack[this.decoratorStack.length-1];for(;this.match(r.at);){const l=this.parseDecorator();a.push(l)}this.match(n._export)?o||this.unexpected():this.canHaveLeadingDecorator()||this.raise(this.start,EM.UnexpectedLeadingDecorator)}parseDecorator(){const o=this.startNode();this.next(),this.decoratorStack.push([]);const a=this.start,l=this.startLoc;let u;if(this.match(n.parenL)){const d=this.start,p=this.startLoc;if(this.next(),u=this.parseExpression(),this.expect(n.parenR),this.options.preserveParens){let v=this.startNodeAt(d,p);v.expression=u,u=this.finishNode(v,"ParenthesizedExpression")}}else for(u=this.parseIdent(!1);this.eat(n.dot);){const d=this.startNodeAt(a,l);d.object=u,d.property=this.parseIdent(!0),d.computed=!1,u=this.finishNode(d,"MemberExpression")}return o.expression=this.parseMaybeDecoratorArguments(u),this.decoratorStack.pop(),this.finishNode(o,"Decorator")}parseMaybeDecoratorArguments(o){if(this.eat(n.parenL)){const a=this.startNodeAtNode(o);return a.callee=o,a.arguments=this.parseExprList(n.parenR,!1),this.finishNode(a,"CallExpression")}return o}}}function ZAe(t,e,i){const{tokTypes:n}=e,{tokTypes:r}=i;return class extends t{parseMaybeImportAttributes(o){if(this.type===r._with||this.type===n.assert){this.next();const a=this.parseImportAttributes();a&&(o.attributes=a)}}parseImportAttributes(){this.expect(r.braceL);const o=this.parseWithEntries();return this.expect(r.braceR),o}parseWithEntries(){const o=[],a=new Set;do{if(this.type===r.braceR)break;const l=this.startNode();let u;this.type===r.string?u=this.parseLiteral(this.value):u=this.parseIdent(!0),this.next(),l.key=u,a.has(l.key.name)&&this.raise(this.pos,"Duplicated key in attributes"),a.add(l.key.name),this.type!==r.string&&this.raise(this.pos,"Only string is supported as an attribute value"),l.value=this.parseLiteral(this.value),o.push(this.finishNode(l,"ImportAttribute"))}while(this.eat(r.comma));return o}}}var gN=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g;function W6(t){if(!t)throw new Error("Assert fail")}function XAe(t){return t==="accessor"}function KAe(t){return t==="in"||t==="out"}var J1=1,q6=2,YAe=4,Sr={SCOPE_TOP:1,SCOPE_FUNCTION:2,SCOPE_ASYNC:4,SCOPE_GENERATOR:8,SCOPE_ARROW:16,SCOPE_SIMPLE_CATCH:32,SCOPE_SUPER:64,SCOPE_DIRECT_SUPER:128,BIND_NONE:0,BIND_VAR:1,BIND_LEXICAL:2,BIND_FUNCTION:3,BIND_SIMPLE_CATCH:4,BIND_TS_TYPE:6,BIND_TS_INTERFACE:7,BIND_TS_NAMESPACE:8,BIND_FLAGS_TS_EXPORT_ONLY:1024,BIND_FLAGS_TS_IMPORT:4096,BIND_FLAGS_TS_ENUM:256,BIND_FLAGS_TS_CONST_ENUM:512,BIND_FLAGS_CLASS:128};function vN(t,e){return Sr.SCOPE_FUNCTION|(t?Sr.SCOPE_ASYNC:0)|(e?Sr.SCOPE_GENERATOR:0)}function JAe(t){if(t.type!=="MemberExpression")return!1;const{computed:e,property:i}=t;return e&&(i.type!=="TemplateLiteral"||i.expressions.length>0)?!1:Xee(t.object)}function Xee(t){return t.type==="Identifier"?!0:t.type!=="MemberExpression"||t.computed?!1:Xee(t.object)}function j6(t){return t==="private"||t==="public"||t==="protected"}function eIe(t){return!!t.startsExpr}function tIe(t){if(t==null)throw new Error(`Unexpected ${t} value.`);return t}function iIe(t){switch(t){case"any":return"TSAnyKeyword";case"boolean":return"TSBooleanKeyword";case"bigint":return"TSBigIntKeyword";case"never":return"TSNeverKeyword";case"number":return"TSNumberKeyword";case"object":return"TSObjectKeyword";case"string":return"TSStringKeyword";case"symbol":return"TSSymbolKeyword";case"undefined":return"TSUndefinedKeyword";case"unknown":return"TSUnknownKeyword";default:return}}function nIe(t){const{dts:e=!1}={},i=!1;return function(n){const r=n.acorn||zAe,s=GAe(r),o=r.tokTypes,a=r.keywordTypes,l=r.isIdentifierStart,u=r.lineBreak,d=r.isNewLine,p=r.tokContexts,v=r.isIdentifierChar,{tokTypes:y,tokContexts:w,keywordsRegExp:R,tokenIsLiteralPropertyName:O,tokenIsTemplate:P,tokenIsTSDeclarationStart:N,tokenIsIdentifier:F,tokenIsKeywordOrIdentifier:k,tokenIsTSTypeOperator:$}=s;function W(Y,M,D=Y.length){for(let G=M;G<D;G++){let j=Y.charCodeAt(G);if(d(j))return G<D-1&&j===13&&Y.charCodeAt(G+1)===10?G+2:G+1}return-1}n=QAe(n,s,r),n=ZAe(n,s,r);class Q extends n{constructor(M,D,G){super(M,D,G),this.preValue=null,this.preToken=null,this.isLookahead=!1,this.isAmbientContext=!1,this.inAbstractClass=!1,this.inType=!1,this.inDisallowConditionalTypesContext=!1,this.maybeInArrowParameters=!1,this.shouldParseArrowReturnType=void 0,this.shouldParseAsyncArrowReturnType=void 0,this.decoratorStack=[[]],this.importsStack=[[]],this.importOrExportOuterKind=void 0,this.tsParseConstModifier=j=>{this.tsParseModifiers({modified:j,allowedModifiers:["const"],disallowedModifiers:["in","out"],errorTemplate:Zi.InvalidModifierOnTypeParameterPositions})},this.ecmaVersion=this.options.ecmaVersion}static get acornTypeScript(){return s}get acornTypeScript(){return s}getTokenFromCodeInType(M){return M===62?this.finishOp(o.relational,1):M===60?this.finishOp(o.relational,1):super.getTokenFromCode(M)}readToken(M){if(!this.inType){let D=this.curContext();if(D===w.tc_expr)return this.jsx_readToken();if(D===w.tc_oTag||D===w.tc_cTag){if(l(M))return this.jsx_readWord();if(M==62)return++this.pos,this.finishToken(y.jsxTagEnd);if((M===34||M===39)&&D==w.tc_oTag)return this.jsx_readString(M)}if(M===60&&this.exprAllowed&&this.input.charCodeAt(this.pos+1)!==33)return++this.pos,this.finishToken(o.relational,"<")}return super.readToken(M)}getTokenFromCode(M){return this.inType?this.getTokenFromCodeInType(M):M===64?(++this.pos,this.finishToken(y.at)):super.getTokenFromCode(M)}isAbstractClass(){return this.ts_isContextual(y.abstract)&&this.lookahead().type===o._class}finishNode(M,D){return M.type!==""&&M.end!==0?M:super.finishNode(M,D)}tryParse(M,D=this.cloneCurLookaheadState()){const G={node:null};try{return{node:M((Z=null)=>{throw G.node=Z,G}),error:null,thrown:!1,aborted:!1,failState:null}}catch(j){const Z=this.getCurLookaheadState();if(this.setLookaheadState(D),j instanceof SyntaxError)return{node:null,error:j,thrown:!0,aborted:!1,failState:Z};if(j===G)return{node:G.node,error:null,thrown:!1,aborted:!0,failState:Z};throw j}}setOptionalParametersError(M,D){M.optionalParametersLoc=D?.loc??this.startLoc}reScan_lt_gt(){this.type===o.relational&&(this.pos-=1,this.readToken_lt_gt(this.fullCharCodeAtPos()))}reScan_lt(){const{type:M}=this;return M===o.bitShift?(this.pos-=2,this.finishOp(o.relational,1),o.relational):M}resetEndLocation(M,D=this.lastTokEnd,G=this.lastTokEndLoc){M.end=D,M.loc.end=G,this.options.ranges&&(M.range[1]=D)}startNodeAtNode(M){return super.startNodeAt(M.start,M.loc.start)}nextTokenStart(){return this.nextTokenStartSince(this.pos)}tsHasSomeModifiers(M,D){return D.some(G=>j6(G)?M.accessibility===G:!!M[G])}tsIsStartOfStaticBlocks(){return this.isContextual("static")&&this.lookaheadCharCode()===123}tsCheckForInvalidTypeCasts(M){M.forEach(D=>{D?.type==="TSTypeCastExpression"&&this.raise(D.typeAnnotation.start,Zi.UnexpectedTypeAnnotation)})}atPossibleAsyncArrow(M){return M.type==="Identifier"&&M.name==="async"&&this.lastTokEndLoc.column===M.end&&!this.canInsertSemicolon()&&M.end-M.start===5&&M.start===this.potentialArrowAt}tsIsIdentifier(){return F(this.type)}tsTryParseTypeOrTypePredicateAnnotation(){return this.match(o.colon)?this.tsParseTypeOrTypePredicateAnnotation(o.colon):void 0}tsTryParseGenericAsyncArrowFunction(M,D,G){if(!this.tsMatchLeftRelational())return;const j=this.maybeInArrowParameters;this.maybeInArrowParameters=!0;const Z=this.tsTryParseAndCatch(()=>{const ie=this.startNodeAt(M,D);return ie.typeParameters=this.tsParseTypeParameters(this.tsParseConstModifier),super.parseFunctionParams(ie),ie.returnType=this.tsTryParseTypeOrTypePredicateAnnotation(),this.expect(o.arrow),ie});if(this.maybeInArrowParameters=j,!!Z)return super.parseArrowExpression(Z,null,!0,G)}tsParseTypeArgumentsInExpression(){if(this.reScan_lt()===o.relational)return this.tsParseTypeArguments()}tsInNoContext(M){const D=this.context;this.context=[D[0]];try{return M()}finally{this.context=D}}tsTryParseTypeAnnotation(){return this.match(o.colon)?this.tsParseTypeAnnotation():void 0}isUnparsedContextual(M,D){const G=M+D.length;if(this.input.slice(M,G)===D){const j=this.input.charCodeAt(G);return!(v(j)||(j&64512)===55296)}return!1}isAbstractConstructorSignature(){return this.ts_isContextual(y.abstract)&&this.lookahead().type===o._new}nextTokenStartSince(M){return gN.lastIndex=M,gN.test(this.input)?gN.lastIndex:M}lookaheadCharCode(){return this.input.charCodeAt(this.nextTokenStart())}compareLookaheadState(M,D){for(const G of Object.keys(M))if(M[G]!==D[G])return!1;return!0}createLookaheadState(){this.value=null,this.context=[this.curContext()]}getCurLookaheadState(){return{endLoc:this.endLoc,lastTokEnd:this.lastTokEnd,lastTokStart:this.lastTokStart,lastTokStartLoc:this.lastTokStartLoc,pos:this.pos,value:this.value,type:this.type,start:this.start,end:this.end,context:this.context,startLoc:this.startLoc,lastTokEndLoc:this.lastTokEndLoc,curLine:this.curLine,lineStart:this.lineStart,curPosition:this.curPosition,containsEsc:this.containsEsc}}cloneCurLookaheadState(){return{pos:this.pos,value:this.value,type:this.type,start:this.start,end:this.end,context:this.context&&this.context.slice(),startLoc:this.startLoc,lastTokEndLoc:this.lastTokEndLoc,endLoc:this.endLoc,lastTokEnd:this.lastTokEnd,lastTokStart:this.lastTokStart,lastTokStartLoc:this.lastTokStartLoc,curLine:this.curLine,lineStart:this.lineStart,curPosition:this.curPosition,containsEsc:this.containsEsc}}setLookaheadState(M){this.pos=M.pos,this.value=M.value,this.endLoc=M.endLoc,this.lastTokEnd=M.lastTokEnd,this.lastTokStart=M.lastTokStart,this.lastTokStartLoc=M.lastTokStartLoc,this.type=M.type,this.start=M.start,this.end=M.end,this.context=M.context,this.startLoc=M.startLoc,this.lastTokEndLoc=M.lastTokEndLoc,this.curLine=M.curLine,this.lineStart=M.lineStart,this.curPosition=M.curPosition,this.containsEsc=M.containsEsc}tsLookAhead(M){const D=this.getCurLookaheadState(),G=M();return this.setLookaheadState(D),G}lookahead(M){const D=this.getCurLookaheadState();if(this.createLookaheadState(),this.isLookahead=!0,M!==void 0)for(let j=0;j<M;j++)this.nextToken();else this.nextToken();this.isLookahead=!1;const G=this.getCurLookaheadState();return this.setLookaheadState(D),G}readWord(){let M=this.readWord1(),D=o.name;return this.keywords.test(M)?D=a[M]:new RegExp(R).test(M)&&(D=y[M]),this.finishToken(D,M)}skipBlockComment(){let M;this.isLookahead||(M=this.options.onComment&&this.curPosition());let D=this.pos,G=this.input.indexOf("*/",this.pos+=2);if(G===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=G+2,this.options.locations)for(let j,Z=D;(j=W(this.input,Z,this.pos))>-1;)++this.curLine,Z=this.lineStart=j;this.isLookahead||this.options.onComment&&this.options.onComment(!0,this.input.slice(D+2,G),D,this.pos,M,this.curPosition())}skipLineComment(M){let D=this.pos,G;this.isLookahead||(G=this.options.onComment&&this.curPosition());let j=this.input.charCodeAt(this.pos+=M);for(;this.pos<this.input.length&&!d(j);)j=this.input.charCodeAt(++this.pos);this.isLookahead||this.options.onComment&&this.options.onComment(!1,this.input.slice(D+M,this.pos),D,this.pos,G,this.curPosition())}finishToken(M,D){this.preValue=this.value,this.preToken=this.type,this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());let G=this.type;this.type=M,this.value=D,this.isLookahead||this.updateContext(G)}resetStartLocation(M,D,G){M.start=D,M.loc.start=G,this.options.ranges&&(M.range[0]=D)}isLineTerminator(){return this.eat(o.semi)||super.canInsertSemicolon()}hasFollowingLineBreak(){return H6.lastIndex=this.end,H6.test(this.input)}addExtra(M,D,G,j=!0){if(!M)return;const Z=M.extra=M.extra||{};j?Z[D]=G:Object.defineProperty(Z,D,{enumerable:j,value:G})}isLiteralPropertyName(){return O(this.type)}hasPrecedingLineBreak(){return u.test(this.input.slice(this.lastTokEnd,this.start))}createIdentifier(M,D){return M.name=D,this.finishNode(M,"Identifier")}resetStartLocationFromNode(M,D){this.resetStartLocation(M,D.start,D.loc.start)}isThisParam(M){return M.type==="Identifier"&&M.name==="this"}isLookaheadContextual(M){const D=this.nextTokenStart();return this.isUnparsedContextual(D,M)}ts_type_isContextual(M,D){return M===D&&!this.containsEsc}ts_isContextual(M){return this.type===M&&!this.containsEsc}ts_isContextualWithState(M,D){return M.type===D&&!M.containsEsc}isContextualWithState(M,D){return D.type===o.name&&D.value===M&&!D.containsEsc}tsIsStartOfMappedType(){return this.next(),this.eat(o.plusMin)?this.ts_isContextual(y.readonly):(this.ts_isContextual(y.readonly)&&this.next(),!this.match(o.bracketL)||(this.next(),!this.tsIsIdentifier())?!1:(this.next(),this.match(o._in)))}tsInDisallowConditionalTypesContext(M){const D=this.inDisallowConditionalTypesContext;this.inDisallowConditionalTypesContext=!0;try{return M()}finally{this.inDisallowConditionalTypesContext=D}}tsTryParseType(){return this.tsEatThenParseType(o.colon)}match(M){return this.type===M}matchJsx(M){return this.type===s.tokTypes[M]}ts_eatWithState(M,D,G){const j=G.type;if(M===j){for(let Z=0;Z<D;Z++)this.next();return!0}else return!1}ts_eatContextualWithState(M,D,G){if(R.test(M)){if(this.ts_isContextualWithState(G,y[M])){for(let j=0;j<D;j++)this.next();return!0}return!1}else{if(!this.isContextualWithState(M,G))return!1;for(let j=0;j<D;j++)this.next();return!0}}canHaveLeadingDecorator(){return this.match(o._class)}eatContextual(M){return R.test(M)?this.ts_isContextual(y[M])?(this.next(),!0):!1:super.eatContextual(M)}tsIsExternalModuleReference(){return this.isContextual("require")&&this.lookaheadCharCode()===40}tsParseExternalModuleReference(){const M=this.startNode();return this.expectContextual("require"),this.expect(o.parenL),this.match(o.string)||this.unexpected(),M.expression=this.parseExprAtom(),this.expect(o.parenR),this.finishNode(M,"TSExternalModuleReference")}tsParseEntityName(M=!0){let D=this.parseIdent(M);for(;this.eat(o.dot);){const G=this.startNodeAtNode(D);G.left=D,G.right=this.parseIdent(M),D=this.finishNode(G,"TSQualifiedName")}return D}tsParseEnumMember(){const M=this.startNode();return M.id=this.match(o.string)?this.parseLiteral(this.value):this.parseIdent(!0),this.eat(o.eq)&&(M.initializer=this.parseMaybeAssign()),this.finishNode(M,"TSEnumMember")}tsParseEnumDeclaration(M,D={}){return D.const&&(M.const=!0),D.declare&&(M.declare=!0),this.expectContextual("enum"),M.id=this.parseIdent(),this.checkLValSimple(M.id),this.expect(o.braceL),M.members=this.tsParseDelimitedList("EnumMembers",this.tsParseEnumMember.bind(this)),this.expect(o.braceR),this.finishNode(M,"TSEnumDeclaration")}tsParseModuleBlock(){const M=this.startNode();for(this.enterScope(WAe),this.expect(o.braceL),M.body=[];this.type!==o.braceR;){let D=this.parseStatement(null,!0);M.body.push(D)}return this.next(),super.exitScope(),this.finishNode(M,"TSModuleBlock")}tsParseAmbientExternalModuleDeclaration(M){return this.ts_isContextual(y.global)?(M.global=!0,M.id=this.parseIdent()):this.match(o.string)?M.id=this.parseLiteral(this.value):this.unexpected(),this.match(o.braceL)?(this.enterScope(qb),M.body=this.tsParseModuleBlock(),super.exitScope()):super.semicolon(),this.finishNode(M,"TSModuleDeclaration")}tsTryParseDeclare(M){if(this.isLineTerminator())return;let D=this.type,G;return this.isContextual("let")&&(D=o._var,G="let"),this.tsInAmbientContext(()=>{if(D===o._function)return M.declare=!0,this.parseFunctionStatement(M,!1,!0);if(D===o._class)return M.declare=!0,this.parseClass(M,!0);if(D===y.enum)return this.tsParseEnumDeclaration(M,{declare:!0});if(D===y.global)return this.tsParseAmbientExternalModuleDeclaration(M);if(D===o._const||D===o._var)return!this.match(o._const)||!this.isLookaheadContextual("enum")?(M.declare=!0,this.parseVarStatement(M,G||this.value,!0)):(this.expect(o._const),this.tsParseEnumDeclaration(M,{const:!0,declare:!0}));if(D===y.interface){const j=this.tsParseInterfaceDeclaration(M,{declare:!0});if(j)return j}if(F(D))return this.tsParseDeclaration(M,this.value,!0)})}tsIsListTerminator(M){switch(M){case"EnumMembers":case"TypeMembers":return this.match(o.braceR);case"HeritageClauseElement":return this.match(o.braceL);case"TupleElementTypes":return this.match(o.bracketR);case"TypeParametersOrArguments":return this.tsMatchRightRelational()}}tsParseDelimitedListWorker(M,D,G,j){const Z=[];let ie=-1;for(;!this.tsIsListTerminator(M);){ie=-1;const le=D();if(le==null)return;if(Z.push(le),this.eat(o.comma)){ie=this.lastTokStart;continue}if(this.tsIsListTerminator(M))break;G&&this.expect(o.comma);return}return j&&(j.value=ie),Z}tsParseDelimitedList(M,D,G){return tIe(this.tsParseDelimitedListWorker(M,D,!0,G))}tsParseBracketedList(M,D,G,j,Z){j||(G?this.expect(o.bracketL):this.expect(o.relational));const ie=this.tsParseDelimitedList(M,D,Z);return G?this.expect(o.bracketR):this.expect(o.relational),ie}tsParseTypeParameterName(){return this.parseIdent().name}tsEatThenParseType(M){return this.match(M)?this.tsNextThenParseType():void 0}tsExpectThenParseType(M){return this.tsDoThenParseType(()=>this.expect(M))}tsNextThenParseType(){return this.tsDoThenParseType(()=>this.next())}tsDoThenParseType(M){return this.tsInType(()=>(M(),this.tsParseType()))}tsSkipParameterStart(){if(F(this.type)||this.match(o._this))return this.next(),!0;if(this.match(o.braceL))try{return this.parseObj(!0),!0}catch{return!1}if(this.match(o.bracketL)){this.next();try{return this.parseBindingList(o.bracketR,!0,!0),!0}catch{return!1}}return!1}tsIsUnambiguouslyStartOfFunctionType(){return this.next(),!!(this.match(o.parenR)||this.match(o.ellipsis)||this.tsSkipParameterStart()&&(this.match(o.colon)||this.match(o.comma)||this.match(o.question)||this.match(o.eq)||this.match(o.parenR)&&(this.next(),this.match(o.arrow))))}tsIsStartOfFunctionType(){return this.tsMatchLeftRelational()?!0:this.match(o.parenL)&&this.tsLookAhead(this.tsIsUnambiguouslyStartOfFunctionType.bind(this))}tsInAllowConditionalTypesContext(M){const D=this.inDisallowConditionalTypesContext;this.inDisallowConditionalTypesContext=!1;try{return M()}finally{this.inDisallowConditionalTypesContext=D}}tsParseBindingListForSignature(){return super.parseBindingList(o.parenR,!0,!0).map(M=>(M.type!=="Identifier"&&M.type!=="RestElement"&&M.type!=="ObjectPattern"&&M.type!=="ArrayPattern"&&this.raise(M.start,Zi.UnsupportedSignatureParameterKind(M.type)),M))}tsParseTypePredicateAsserts(){if(this.type!==y.asserts)return!1;const M=this.containsEsc;return this.next(),!F(this.type)&&!this.match(o._this)?!1:(M&&this.raise(this.lastTokStart,"Escape sequence in keyword asserts"),!0)}tsParseThisTypeNode(){const M=this.startNode();return this.next(),this.finishNode(M,"TSThisType")}tsParseTypeAnnotation(M=!0,D=this.startNode()){return this.tsInType(()=>{M&&this.expect(o.colon),D.typeAnnotation=this.tsParseType()}),this.finishNode(D,"TSTypeAnnotation")}tsParseThisTypePredicate(M){this.next();const D=this.startNodeAtNode(M);return D.parameterName=M,D.typeAnnotation=this.tsParseTypeAnnotation(!1),D.asserts=!1,this.finishNode(D,"TSTypePredicate")}tsParseThisTypeOrThisTypePredicate(){const M=this.tsParseThisTypeNode();return this.isContextual("is")&&!this.hasPrecedingLineBreak()?this.tsParseThisTypePredicate(M):M}tsParseTypePredicatePrefix(){const M=this.parseIdent();if(this.isContextual("is")&&!this.hasPrecedingLineBreak())return this.next(),M}tsParseTypeOrTypePredicateAnnotation(M){return this.tsInType(()=>{const D=this.startNode();this.expect(M);const G=this.startNode(),j=!!this.tsTryParse(this.tsParseTypePredicateAsserts.bind(this));if(j&&this.match(o._this)){let le=this.tsParseThisTypeOrThisTypePredicate();return le.type==="TSThisType"?(G.parameterName=le,G.asserts=!0,G.typeAnnotation=null,le=this.finishNode(G,"TSTypePredicate")):(this.resetStartLocationFromNode(le,G),le.asserts=!0),D.typeAnnotation=le,this.finishNode(D,"TSTypeAnnotation")}const Z=this.tsIsIdentifier()&&this.tsTryParse(this.tsParseTypePredicatePrefix.bind(this));if(!Z)return j?(G.parameterName=this.parseIdent(),G.asserts=j,G.typeAnnotation=null,D.typeAnnotation=this.finishNode(G,"TSTypePredicate"),this.finishNode(D,"TSTypeAnnotation")):this.tsParseTypeAnnotation(!1,D);const ie=this.tsParseTypeAnnotation(!1);return G.parameterName=Z,G.typeAnnotation=ie,G.asserts=j,D.typeAnnotation=this.finishNode(G,"TSTypePredicate"),this.finishNode(D,"TSTypeAnnotation")})}tsFillSignature(M,D){const G=M===o.arrow,j="parameters",Z="typeAnnotation";D.typeParameters=this.tsTryParseTypeParameters(),this.expect(o.parenL),D[j]=this.tsParseBindingListForSignature(),G?D[Z]=this.tsParseTypeOrTypePredicateAnnotation(M):this.match(M)&&(D[Z]=this.tsParseTypeOrTypePredicateAnnotation(M))}tsTryNextParseConstantContext(){if(this.lookahead().type!==o._const)return null;this.next();const M=this.tsParseTypeReference();return(M.typeParameters||M.typeArguments)&&this.raise(M.typeName.start,Zi.CannotFindName({name:"const"})),M}tsParseFunctionOrConstructorType(M,D){const G=this.startNode();return M==="TSConstructorType"&&(G.abstract=!!D,D&&this.next(),this.next()),this.tsInAllowConditionalTypesContext(()=>this.tsFillSignature(o.arrow,G)),this.finishNode(G,M)}tsParseUnionOrIntersectionType(M,D,G){const j=this.startNode(),Z=this.eat(G),ie=[];do ie.push(D());while(this.eat(G));return ie.length===1&&!Z?ie[0]:(j.types=ie,this.finishNode(j,M))}tsCheckTypeAnnotationForReadOnly(M){switch(M.typeAnnotation.type){case"TSTupleType":case"TSArrayType":return;default:this.raise(M.start,Zi.UnexpectedReadonly)}}tsParseTypeOperator(){const M=this.startNode(),D=this.value;return this.next(),M.operator=D,M.typeAnnotation=this.tsParseTypeOperatorOrHigher(),D==="readonly"&&this.tsCheckTypeAnnotationForReadOnly(M),this.finishNode(M,"TSTypeOperator")}tsParseConstraintForInferType(){if(this.eat(o._extends)){const M=this.tsInDisallowConditionalTypesContext(()=>this.tsParseType());if(this.inDisallowConditionalTypesContext||!this.match(o.question))return M}}tsParseInferType(){const M=this.startNode();this.expectContextual("infer");const D=this.startNode();return D.name=this.tsParseTypeParameterName(),D.constraint=this.tsTryParse(()=>this.tsParseConstraintForInferType()),M.typeParameter=this.finishNode(D,"TSTypeParameter"),this.finishNode(M,"TSInferType")}tsParseLiteralTypeNode(){const M=this.startNode();return M.literal=(()=>{switch(this.type){case o.num:case o.string:case o._true:case o._false:return this.parseExprAtom();default:this.unexpected()}})(),this.finishNode(M,"TSLiteralType")}tsParseImportType(){const M=this.startNode();return this.expect(o._import),this.expect(o.parenL),this.match(o.string)||this.raise(this.start,Zi.UnsupportedImportTypeArgument),M.argument=this.parseExprAtom(),this.expect(o.parenR),this.eat(o.dot)&&(M.qualifier=this.tsParseEntityName()),this.tsMatchLeftRelational()&&(M.typeArguments=this.tsParseTypeArguments()),this.finishNode(M,"TSImportType")}tsParseTypeQuery(){const M=this.startNode();return this.expect(o._typeof),this.match(o._import)?M.exprName=this.tsParseImportType():M.exprName=this.tsParseEntityName(),!this.hasPrecedingLineBreak()&&this.tsMatchLeftRelational()&&(M.typeArguments=this.tsParseTypeArguments()),this.finishNode(M,"TSTypeQuery")}tsParseMappedTypeParameter(){const M=this.startNode();return M.name=this.tsParseTypeParameterName(),M.constraint=this.tsExpectThenParseType(o._in),this.finishNode(M,"TSTypeParameter")}tsParseMappedType(){const M=this.startNode();return this.expect(o.braceL),this.match(o.plusMin)?(M.readonly=this.value,this.next(),this.expectContextual("readonly")):this.eatContextual("readonly")&&(M.readonly=!0),this.expect(o.bracketL),M.typeParameter=this.tsParseMappedTypeParameter(),M.nameType=this.eatContextual("as")?this.tsParseType():null,this.expect(o.bracketR),this.match(o.plusMin)?(M.optional=this.value,this.next(),this.expect(o.question)):this.eat(o.question)&&(M.optional=!0),M.typeAnnotation=this.tsTryParseType(),this.semicolon(),this.expect(o.braceR),this.finishNode(M,"TSMappedType")}tsParseTypeLiteral(){const M=this.startNode();return M.members=this.tsParseObjectTypeMembers(),this.finishNode(M,"TSTypeLiteral")}tsParseTupleElementType(){const M=this.startLoc,D=this.start,G=this.eat(o.ellipsis);let j=this.tsParseType();const Z=this.eat(o.question);if(this.eat(o.colon)){const le=this.startNodeAtNode(j);le.optional=Z,j.type==="TSTypeReference"&&!j.typeArguments&&j.typeName.type==="Identifier"?le.label=j.typeName:(this.raise(j.start,Zi.InvalidTupleMemberLabel),le.label=j),le.elementType=this.tsParseType(),j=this.finishNode(le,"TSNamedTupleMember")}else if(Z){const le=this.startNodeAtNode(j);le.typeAnnotation=j,j=this.finishNode(le,"TSOptionalType")}if(G){const le=this.startNodeAt(D,M);le.typeAnnotation=j,j=this.finishNode(le,"TSRestType")}return j}tsParseTupleType(){const M=this.startNode();M.elementTypes=this.tsParseBracketedList("TupleElementTypes",this.tsParseTupleElementType.bind(this),!0,!1);let D=!1,G=null;return M.elementTypes.forEach(j=>{const{type:Z}=j;D&&Z!=="TSRestType"&&Z!=="TSOptionalType"&&!(Z==="TSNamedTupleMember"&&j.optional)&&this.raise(j.start,Zi.OptionalTypeBeforeRequired),D||=Z==="TSNamedTupleMember"&&j.optional||Z==="TSOptionalType";let ie=Z;Z==="TSRestType"&&(j=j.typeAnnotation,ie=j.type);const le=ie==="TSNamedTupleMember";G??=le,G!==le&&this.raise(j.start,Zi.MixedLabeledAndUnlabeledElements)}),this.finishNode(M,"TSTupleType")}tsParseTemplateLiteralType(){const M=this.startNode();return M.literal=this.parseTemplate({isTagged:!1}),this.finishNode(M,"TSLiteralType")}tsParseTypeReference(){const M=this.startNode();return M.typeName=this.tsParseEntityName(),!this.hasPrecedingLineBreak()&&this.tsMatchLeftRelational()&&(M.typeArguments=this.tsParseTypeArguments()),this.finishNode(M,"TSTypeReference")}tsMatchLeftRelational(){return this.match(o.relational)&&this.value==="<"}tsMatchRightRelational(){return this.match(o.relational)&&this.value===">"}tsParseParenthesizedType(){const M=this.startNode();return this.expect(o.parenL),M.typeAnnotation=this.tsParseType(),this.expect(o.parenR),this.finishNode(M,"TSParenthesizedType")}tsParseNonArrayType(){switch(this.type){case o.string:case o.num:case o._true:case o._false:return this.tsParseLiteralTypeNode();case o.plusMin:if(this.value==="-"){const M=this.startNode();return this.lookahead().type!==o.num&&this.unexpected(),M.literal=this.parseMaybeUnary(),this.finishNode(M,"TSLiteralType")}break;case o._this:return this.tsParseThisTypeOrThisTypePredicate();case o._typeof:return this.tsParseTypeQuery();case o._import:return this.tsParseImportType();case o.braceL:return this.tsLookAhead(this.tsIsStartOfMappedType.bind(this))?this.tsParseMappedType():this.tsParseTypeLiteral();case o.bracketL:return this.tsParseTupleType();case o.parenL:return this.tsParseParenthesizedType();case o.backQuote:case o.dollarBraceL:return this.tsParseTemplateLiteralType();default:{const{type:M}=this;if(F(M)||M===o._void||M===o._null){const D=M===o._void?"TSVoidKeyword":M===o._null?"TSNullKeyword":iIe(this.value);if(D!==void 0&&this.lookaheadCharCode()!==46){const G=this.startNode();return this.next(),this.finishNode(G,D)}return this.tsParseTypeReference()}}}this.unexpected()}tsParseArrayTypeOrHigher(){let M=this.tsParseNonArrayType();for(;!this.hasPrecedingLineBreak()&&this.eat(o.bracketL);)if(this.match(o.bracketR)){const D=this.startNodeAtNode(M);D.elementType=M,this.expect(o.bracketR),M=this.finishNode(D,"TSArrayType")}else{const D=this.startNodeAtNode(M);D.objectType=M,D.indexType=this.tsParseType(),this.expect(o.bracketR),M=this.finishNode(D,"TSIndexedAccessType")}return M}tsParseTypeOperatorOrHigher(){return $(this.type)&&!this.containsEsc?this.tsParseTypeOperator():this.isContextual("infer")?this.tsParseInferType():this.tsInAllowConditionalTypesContext(()=>this.tsParseArrayTypeOrHigher())}tsParseIntersectionTypeOrHigher(){return this.tsParseUnionOrIntersectionType("TSIntersectionType",this.tsParseTypeOperatorOrHigher.bind(this),o.bitwiseAND)}tsParseUnionTypeOrHigher(){return this.tsParseUnionOrIntersectionType("TSUnionType",this.tsParseIntersectionTypeOrHigher.bind(this),o.bitwiseOR)}tsParseNonConditionalType(){return this.tsIsStartOfFunctionType()?this.tsParseFunctionOrConstructorType("TSFunctionType"):this.match(o._new)?this.tsParseFunctionOrConstructorType("TSConstructorType"):this.isAbstractConstructorSignature()?this.tsParseFunctionOrConstructorType("TSConstructorType",!0):this.tsParseUnionTypeOrHigher()}tsParseType(){W6(this.inType);const M=this.tsParseNonConditionalType();if(this.inDisallowConditionalTypesContext||this.hasPrecedingLineBreak()||!this.eat(o._extends))return M;const D=this.startNodeAtNode(M);return D.checkType=M,D.extendsType=this.tsInDisallowConditionalTypesContext(()=>this.tsParseNonConditionalType()),this.expect(o.question),D.trueType=this.tsInAllowConditionalTypesContext(()=>this.tsParseType()),this.expect(o.colon),D.falseType=this.tsInAllowConditionalTypesContext(()=>this.tsParseType()),this.finishNode(D,"TSConditionalType")}tsIsUnambiguouslyIndexSignature(){return this.next(),F(this.type)?(this.next(),this.match(o.colon)):!1}tsInType(M){const D=this.inType;this.inType=!0;try{return M()}finally{this.inType=D}}tsTryParseIndexSignature(M){if(!(this.match(o.bracketL)&&this.tsLookAhead(this.tsIsUnambiguouslyIndexSignature.bind(this))))return;this.expect(o.bracketL);const D=this.parseIdent();D.typeAnnotation=this.tsParseTypeAnnotation(),this.resetEndLocation(D),this.expect(o.bracketR),M.parameters=[D];const G=this.tsTryParseTypeAnnotation();return G&&(M.typeAnnotation=G),this.tsParseTypeMemberSemicolon(),this.finishNode(M,"TSIndexSignature")}tsParseNoneModifiers(M){this.tsParseModifiers({modified:M,allowedModifiers:[],disallowedModifiers:["in","out"],errorTemplate:Zi.InvalidModifierOnTypeParameterPositions})}tsParseTypeParameter(M=this.tsParseNoneModifiers.bind(this)){const D=this.startNode();return M(D),D.name=this.tsParseTypeParameterName(),D.constraint=this.tsEatThenParseType(o._extends),D.default=this.tsEatThenParseType(o.eq),this.finishNode(D,"TSTypeParameter")}tsParseTypeParameters(M){const D=this.startNode();this.tsMatchLeftRelational()||this.matchJsx("jsxTagStart")?this.next():this.unexpected();const G={value:-1};return D.params=this.tsParseBracketedList("TypeParametersOrArguments",this.tsParseTypeParameter.bind(this,M),!1,!0,G),D.params.length===0&&this.raise(this.start,Zi.EmptyTypeParameters),G.value!==-1&&this.addExtra(D,"trailingComma",G.value),this.finishNode(D,"TSTypeParameterDeclaration")}tsTryParseTypeParameters(M){if(this.tsMatchLeftRelational())return this.tsParseTypeParameters(M)}tsTryParse(M){const D=this.getCurLookaheadState(),G=M();if(G!==void 0&&G!==!1)return G;this.setLookaheadState(D)}tsTokenCanFollowModifier(){return(this.match(o.bracketL)||this.match(o.braceL)||this.match(o.star)||this.match(o.ellipsis)||this.match(o.privateId)||this.isLiteralPropertyName())&&!this.hasPrecedingLineBreak()}tsNextTokenCanFollowModifier(){return this.next(!0),this.tsTokenCanFollowModifier()}tsParseModifier(M,D){const G=this.value;if(M.indexOf(G)!==-1&&!this.containsEsc){if(D&&this.tsIsStartOfStaticBlocks())return;if(this.tsTryParse(this.tsNextTokenCanFollowModifier.bind(this)))return G}}tsParseModifiersByMap({modified:M,map:D}){for(const G of Object.keys(D))M[G]=D[G]}tsParseModifiers({modified:M,allowedModifiers:D,disallowedModifiers:G,stopOnStartOfClassStaticBlock:j,errorTemplate:Z=Zi.InvalidModifierOnTypeMember}){const ie={},le=(be,fe,Fe,He)=>{fe===Fe&&M[He]&&this.raise(be.column,Zi.InvalidModifiersOrder({orderedModifiers:[Fe,He]}))},me=(be,fe,Fe,He)=>{(M[Fe]&&fe===He||M[He]&&fe===Fe)&&this.raise(be.column,Zi.IncompatibleModifiers({modifiers:[Fe,He]}))};for(;;){const be=this.startLoc,fe=this.tsParseModifier(D.concat(G??[]),j);if(!fe)break;j6(fe)?M.accessibility?this.raise(this.start,Zi.DuplicateAccessibilityModifier()):(le(be,fe,fe,"override"),le(be,fe,fe,"static"),le(be,fe,fe,"readonly"),le(be,fe,fe,"accessor"),ie.accessibility=fe,M.accessibility=fe):KAe(fe)?M[fe]?this.raise(this.start,Zi.DuplicateModifier({modifier:fe})):(le(be,fe,"in","out"),ie[fe]=fe,M[fe]=!0):XAe(fe)?M[fe]?this.raise(this.start,Zi.DuplicateModifier({modifier:fe})):(me(be,fe,"accessor","readonly"),me(be,fe,"accessor","static"),me(be,fe,"accessor","override"),ie[fe]=fe,M[fe]=!0):fe==="const"?M[fe]?this.raise(this.start,Zi.DuplicateModifier({modifier:fe})):(ie[fe]=fe,M[fe]=!0):Object.hasOwnProperty.call(M,fe)?this.raise(this.start,Zi.DuplicateModifier({modifier:fe})):(le(be,fe,"static","readonly"),le(be,fe,"static","override"),le(be,fe,"override","readonly"),le(be,fe,"abstract","override"),me(be,fe,"declare","override"),me(be,fe,"static","abstract"),ie[fe]=fe,M[fe]=!0),G?.includes(fe)&&this.raise(this.start,Z)}return ie}tsParseInOutModifiers(M){this.tsParseModifiers({modified:M,allowedModifiers:["in","out"],disallowedModifiers:["public","private","protected","readonly","declare","abstract","override"],errorTemplate:Zi.InvalidModifierOnTypeParameter})}parseMaybeUnary(M,D,G,j){return this.tsMatchLeftRelational()?this.tsParseTypeAssertion():super.parseMaybeUnary(M,D,G,j)}tsParseTypeAssertion(){const M=this.tryParse(()=>{const D=this.startNode(),G=this.tsTryNextParseConstantContext();return D.typeAnnotation=G||this.tsNextThenParseType(),this.expect(o.relational),D.expression=this.parseMaybeUnary(),this.finishNode(D,"TSTypeAssertion")});return M.error?this.tsParseTypeParameters(this.tsParseConstModifier):M.node}tsParseTypeArguments(){const M=this.startNode();return M.params=this.tsInType(()=>this.tsInNoContext(()=>(this.expect(o.relational),this.tsParseDelimitedList("TypeParametersOrArguments",this.tsParseType.bind(this))))),M.params.length===0&&this.raise(this.start,Zi.EmptyTypeArguments),this.exprAllowed=!1,this.expect(o.relational),this.finishNode(M,"TSTypeParameterInstantiation")}tsParseHeritageClause(M){const D=this.start,G=this.tsParseDelimitedList("HeritageClauseElement",()=>{const j=this.startNode();return j.expression=this.tsParseEntityName(),this.tsMatchLeftRelational()&&(j.typeParameters=this.tsParseTypeArguments()),this.finishNode(j,"TSExpressionWithTypeArguments")});return G.length||this.raise(D,Zi.EmptyHeritageClauseType({token:M})),G}tsParseTypeMemberSemicolon(){!this.eat(o.comma)&&!this.isLineTerminator()&&this.expect(o.semi)}tsTryParseAndCatch(M){const D=this.tryParse(G=>M()||G());if(!(D.aborted||!D.node))return D.error&&this.setLookaheadState(D.failState),D.node}tsParseSignatureMember(M,D){return this.tsFillSignature(o.colon,D),this.tsParseTypeMemberSemicolon(),this.finishNode(D,M)}tsParsePropertyOrMethodSignature(M,D){this.eat(o.question)&&(M.optional=!0);const G=M;if(this.match(o.parenL)||this.tsMatchLeftRelational()){D&&this.raise(M.start,Zi.ReadonlyForMethodSignature);const j=G;j.kind&&this.tsMatchLeftRelational()&&this.raise(this.start,Zi.AccesorCannotHaveTypeParameters),this.tsFillSignature(o.colon,j),this.tsParseTypeMemberSemicolon();const Z="parameters",ie="typeAnnotation";if(j.kind==="get")j[Z].length>0&&(this.raise(this.start,"A 'get' accesor must not have any formal parameters."),this.isThisParam(j[Z][0])&&this.raise(this.start,Zi.AccesorCannotDeclareThisParameter));else if(j.kind==="set"){if(j[Z].length!==1)this.raise(this.start,"A 'get' accesor must not have any formal parameters.");else{const le=j[Z][0];this.isThisParam(le)&&this.raise(this.start,Zi.AccesorCannotDeclareThisParameter),le.type==="Identifier"&&le.optional&&this.raise(this.start,Zi.SetAccesorCannotHaveOptionalParameter),le.type==="RestElement"&&this.raise(this.start,Zi.SetAccesorCannotHaveRestParameter)}j[ie]&&this.raise(j[ie].start,Zi.SetAccesorCannotHaveReturnType)}else j.kind="method";return this.finishNode(j,"TSMethodSignature")}else{const j=G;D&&(j.readonly=!0);const Z=this.tsTryParseTypeAnnotation();return Z&&(j.typeAnnotation=Z),this.tsParseTypeMemberSemicolon(),this.finishNode(j,"TSPropertySignature")}}tsParseTypeMember(){const M=this.startNode();if(this.match(o.parenL)||this.tsMatchLeftRelational())return this.tsParseSignatureMember("TSCallSignatureDeclaration",M);if(this.match(o._new)){const G=this.startNode();return this.next(),this.match(o.parenL)||this.tsMatchLeftRelational()?this.tsParseSignatureMember("TSConstructSignatureDeclaration",M):(M.key=this.createIdentifier(G,"new"),this.tsParsePropertyOrMethodSignature(M,!1))}this.tsParseModifiers({modified:M,allowedModifiers:["readonly"],disallowedModifiers:["declare","abstract","private","protected","public","static","override"]});const D=this.tsTryParseIndexSignature(M);return D||(this.parsePropertyName(M),!M.computed&&M.key.type==="Identifier"&&(M.key.name==="get"||M.key.name==="set")&&this.tsTokenCanFollowModifier()&&(M.kind=M.key.name,this.parsePropertyName(M)),this.tsParsePropertyOrMethodSignature(M,!!M.readonly))}tsParseList(M,D){const G=[];for(;!this.tsIsListTerminator(M);)G.push(D());return G}tsParseObjectTypeMembers(){this.expect(o.braceL);const M=this.tsParseList("TypeMembers",this.tsParseTypeMember.bind(this));return this.expect(o.braceR),M}tsParseInterfaceDeclaration(M,D={}){if(this.hasFollowingLineBreak())return null;this.expectContextual("interface"),D.declare&&(M.declare=!0),F(this.type)?(M.id=this.parseIdent(),this.checkLValSimple(M.id,Sr.BIND_TS_INTERFACE)):(M.id=null,this.raise(this.start,Zi.MissingInterfaceName)),M.typeParameters=this.tsTryParseTypeParameters(this.tsParseInOutModifiers.bind(this)),this.eat(o._extends)&&(M.extends=this.tsParseHeritageClause("extends"));const G=this.startNode();return G.body=this.tsInType(this.tsParseObjectTypeMembers.bind(this)),M.body=this.finishNode(G,"TSInterfaceBody"),this.finishNode(M,"TSInterfaceDeclaration")}tsParseAbstractDeclaration(M){if(this.match(o._class))return M.abstract=!0,this.parseClass(M,!0);if(this.ts_isContextual(y.interface)){if(!this.hasFollowingLineBreak())return M.abstract=!0,this.tsParseInterfaceDeclaration(M)}else this.unexpected(M.start)}tsIsDeclarationStart(){return N(this.type)}tsParseExpressionStatement(M,D){switch(D.name){case"declare":{const G=this.tsTryParseDeclare(M);if(G)return G.declare=!0,G;break}case"global":if(this.match(o.braceL)){this.enterScope(qb);const G=M;return G.global=!0,G.id=D,G.body=this.tsParseModuleBlock(),super.exitScope(),this.finishNode(G,"TSModuleDeclaration")}break;default:return this.tsParseDeclaration(M,D.name,!1)}}tsParseModuleReference(){return this.tsIsExternalModuleReference()?this.tsParseExternalModuleReference():this.tsParseEntityName(!1)}tsIsExportDefaultSpecifier(){const{type:M}=this,D=this.isAsyncFunction(),G=this.isLet();if(F(M)){if(D&&!this.containsEsc||G)return!1;if((M===y.type||M===y.interface)&&!this.containsEsc){const ie=this.lookahead();if(F(ie.type)&&!this.isContextualWithState("from",ie)||ie.type===o.braceL)return!1}}else if(!this.match(o._default))return!1;const j=this.nextTokenStart(),Z=this.isUnparsedContextual(j,"from");if(this.input.charCodeAt(j)===44||F(this.type)&&Z)return!0;if(this.match(o._default)&&Z){const ie=this.input.charCodeAt(this.nextTokenStartSince(j+4));return ie===34||ie===39}return!1}tsInAmbientContext(M){const D=this.isAmbientContext;this.isAmbientContext=!0;try{return M()}finally{this.isAmbientContext=D}}tsCheckLineTerminator(M){return M?this.hasFollowingLineBreak()?!1:(this.next(),!0):!this.isLineTerminator()}tsParseModuleOrNamespaceDeclaration(M,D=!1){if(M.id=this.parseIdent(),D||this.checkLValSimple(M.id,Sr.BIND_TS_NAMESPACE),this.eat(o.dot)){const G=this.startNode();this.tsParseModuleOrNamespaceDeclaration(G,!0),M.body=G}else this.enterScope(qb),M.body=this.tsParseModuleBlock(),super.exitScope();return this.finishNode(M,"TSModuleDeclaration")}checkLValSimple(M,D=Sr.BIND_NONE,G){return(M.type==="TSNonNullExpression"||M.type==="TSAsExpression")&&(M=M.expression),super.checkLValSimple(M,D,G)}tsParseTypeAliasDeclaration(M){return M.id=this.parseIdent(),this.checkLValSimple(M.id,Sr.BIND_TS_TYPE),M.typeAnnotation=this.tsInType(()=>{if(M.typeParameters=this.tsTryParseTypeParameters(this.tsParseInOutModifiers.bind(this)),this.expect(o.eq),this.ts_isContextual(y.interface)&&this.lookahead().type!==o.dot){const D=this.startNode();return this.next(),this.finishNode(D,"TSIntrinsicKeyword")}return this.tsParseType()}),this.semicolon(),this.finishNode(M,"TSTypeAliasDeclaration")}tsParseDeclaration(M,D,G){switch(D){case"abstract":if(this.tsCheckLineTerminator(G)&&(this.match(o._class)||F(this.type)))return this.tsParseAbstractDeclaration(M);break;case"module":if(this.tsCheckLineTerminator(G)){if(this.match(o.string))return this.tsParseAmbientExternalModuleDeclaration(M);if(F(this.type))return this.tsParseModuleOrNamespaceDeclaration(M)}break;case"namespace":if(this.tsCheckLineTerminator(G)&&F(this.type))return this.tsParseModuleOrNamespaceDeclaration(M);break;case"type":if(this.tsCheckLineTerminator(G)&&F(this.type))return this.tsParseTypeAliasDeclaration(M);break}}tsTryParseExportDeclaration(){return this.tsParseDeclaration(this.startNode(),this.value,!0)}tsParseImportEqualsDeclaration(M,D){M.isExport=D||!1,M.id=this.parseIdent(),this.checkLValSimple(M.id,Sr.BIND_LEXICAL),super.expect(o.eq);const G=this.tsParseModuleReference();return M.importKind==="type"&&G.type!=="TSExternalModuleReference"&&this.raise(G.start,Zi.ImportAliasHasImportType),M.moduleReference=G,super.semicolon(),this.finishNode(M,"TSImportEqualsDeclaration")}isExportDefaultSpecifier(){if(this.tsIsDeclarationStart())return!1;const{type:M}=this;if(F(M)){if(this.isContextual("async")||this.isContextual("let"))return!1;if((M===y.type||M===y.interface)&&!this.containsEsc){const j=this.lookahead();if(F(j.type)&&!this.isContextualWithState("from",j)||j.type===o.braceL)return!1}}else if(!this.match(o._default))return!1;const D=this.nextTokenStart(),G=this.isUnparsedContextual(D,"from");if(this.input.charCodeAt(D)===44||F(this.type)&&G)return!0;if(this.match(o._default)&&G){const j=this.input.charCodeAt(this.nextTokenStartSince(D+4));return j===34||j===39}return!1}parseTemplate({isTagged:M=!1}={}){let D=this.startNode();this.next(),D.expressions=[];let G=this.parseTemplateElement({isTagged:M});for(D.quasis=[G];!G.tail;)this.type===o.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(o.dollarBraceL),D.expressions.push(this.inType?this.tsParseType():this.parseExpression()),this.expect(o.braceR),D.quasis.push(G=this.parseTemplateElement({isTagged:M}));return this.next(),this.finishNode(D,"TemplateLiteral")}parseFunction(M,D,G,j,Z){this.initFunction(M),(this.ecmaVersion>=9||this.ecmaVersion>=6&&!j)&&(this.type===o.star&&D&q6&&this.unexpected(),M.generator=this.eat(o.star)),this.ecmaVersion>=8&&(M.async=!!j),D&J1&&(M.id=D&YAe&&this.type!==o.name?null:this.parseIdent());let ie=this.yieldPos,le=this.awaitPos,me=this.awaitIdentPos;const be=this.maybeInArrowParameters;this.maybeInArrowParameters=!1,this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(vN(M.async,M.generator)),D&J1||(M.id=this.type===o.name?this.parseIdent():null),this.parseFunctionParams(M);const fe=D&J1;return this.parseFunctionBody(M,G,!1,Z,{isFunctionDeclaration:fe}),this.yieldPos=ie,this.awaitPos=le,this.awaitIdentPos=me,D&J1&&M.id&&!(D&q6)&&(M.body?this.checkLValSimple(M.id,this.strict||M.generator||M.async?this.treatFunctionsAsVar?Sr.BIND_VAR:Sr.BIND_LEXICAL:Sr.BIND_FUNCTION):this.checkLValSimple(M.id,Sr.BIND_NONE)),this.maybeInArrowParameters=be,this.finishNode(M,fe?"FunctionDeclaration":"FunctionExpression")}parseFunctionBody(M,D=!1,G=!1,j=!1,Z){this.match(o.colon)&&(M.returnType=this.tsParseTypeOrTypePredicateAnnotation(o.colon));const ie=Z?.isFunctionDeclaration?"TSDeclareFunction":Z?.isClassMethod?"TSDeclareMethod":void 0;return ie&&!this.match(o.braceL)&&this.isLineTerminator()?this.finishNode(M,ie):ie==="TSDeclareFunction"&&this.isAmbientContext&&(this.raise(M.start,Zi.DeclareFunctionHasImplementation),M.declare)?(super.parseFunctionBody(M,D,G,!1),this.finishNode(M,ie)):(super.parseFunctionBody(M,D,G,j),M)}parseNew(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");let M=this.startNode(),D=this.parseIdent(!0);if(this.ecmaVersion>=6&&this.eat(o.dot)){M.meta=D;let le=this.containsEsc;return M.property=this.parseIdent(!0),M.property.name!=="target"&&this.raiseRecoverable(M.property.start,"The only valid meta property for new is 'new.target'"),le&&this.raiseRecoverable(M.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(M.start,"'new.target' can only be used in functions and class static block"),this.finishNode(M,"MetaProperty")}let G=this.start,j=this.startLoc,Z=this.type===o._import;M.callee=this.parseSubscripts(this.parseExprAtom(),G,j,!0,!1),Z&&M.callee.type==="ImportExpression"&&this.raise(G,"Cannot use new with import()");const{callee:ie}=M;return ie.type==="TSInstantiationExpression"&&!ie.extra?.parenthesized&&(M.typeArguments=ie.typeArguments,M.callee=ie.expression),this.eat(o.parenL)?M.arguments=this.parseExprList(o.parenR,this.ecmaVersion>=8,!1):M.arguments=[],this.finishNode(M,"NewExpression")}parseExprOp(M,D,G,j,Z){if(o._in.binop>j&&!this.hasPrecedingLineBreak()){let ie;if(this.isContextual("as")&&(ie="TSAsExpression"),this.isContextual("satisfies")&&(ie="TSSatisfiesExpression"),ie){const le=this.startNodeAt(D,G);le.expression=M;const me=this.tsTryNextParseConstantContext();return me?le.typeAnnotation=me:le.typeAnnotation=this.tsNextThenParseType(),this.finishNode(le,ie),this.reScan_lt_gt(),this.parseExprOp(le,D,G,j,Z)}}return super.parseExprOp(M,D,G,j,Z)}parseImportSpecifiers(){let M=[],D=!0;if(s.tokenIsIdentifier(this.type)&&(M.push(this.parseImportDefaultSpecifier()),!this.eat(o.comma)))return M;if(this.type===o.star)return M.push(this.parseImportNamespaceSpecifier()),M;for(this.expect(o.braceL);!this.eat(o.braceR);){if(D)D=!1;else if(this.expect(o.comma),this.afterTrailingComma(o.braceR))break;M.push(this.parseImportSpecifier())}return M}parseImport(M){let D=this.lookahead();if(M.importKind="value",this.importOrExportOuterKind="value",F(D.type)||this.match(o.star)||this.match(o.braceL)){let G=this.lookahead(2);if(G.type!==o.comma&&!this.isContextualWithState("from",G)&&G.type!==o.eq&&this.ts_eatContextualWithState("type",1,D)&&(this.importOrExportOuterKind="type",M.importKind="type",D=this.lookahead(),G=this.lookahead(2)),F(D.type)&&G.type===o.eq){this.next();const j=this.tsParseImportEqualsDeclaration(M);return this.importOrExportOuterKind="value",j}}return this.next(),this.type===o.string?(M.specifiers=[],M.source=this.parseExprAtom()):(M.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),M.source=this.type===o.string?this.parseExprAtom():this.unexpected()),this.parseMaybeImportAttributes(M),this.semicolon(),this.finishNode(M,"ImportDeclaration"),this.importOrExportOuterKind="value",M.importKind==="type"&&M.specifiers.length>1&&M.specifiers[0].type==="ImportDefaultSpecifier"&&this.raise(M.start,Zi.TypeImportCannotSpecifyDefaultAndNamed),M}parseExportDefaultDeclaration(){if(this.isAbstractClass()){const M=this.startNode();return this.next(),M.abstract=!0,this.parseClass(M,!0)}if(this.match(y.interface)){const M=this.tsParseInterfaceDeclaration(this.startNode());if(M)return M}return super.parseExportDefaultDeclaration()}parseExportAllDeclaration(M,D){return this.ecmaVersion>=11&&(this.eatContextual("as")?(M.exported=this.parseModuleExportName(),this.checkExport(D,M.exported,this.lastTokStart)):M.exported=null),this.expectContextual("from"),this.type!==o.string&&this.unexpected(),M.source=this.parseExprAtom(),this.parseMaybeImportAttributes(M),this.semicolon(),this.finishNode(M,"ExportAllDeclaration")}parseDynamicImport(M){if(this.next(),M.source=this.parseMaybeAssign(),this.eat(o.comma)){const D=this.parseExpression();M.arguments=[D]}if(!this.eat(o.parenR)){const D=this.start;this.eat(o.comma)&&this.eat(o.parenR)?this.raiseRecoverable(D,"Trailing comma is not allowed in import()"):this.unexpected(D)}return this.finishNode(M,"ImportExpression")}parseExport(M,D){let G=this.lookahead();if(this.ts_eatWithState(o._import,2,G)){this.ts_isContextual(y.type)&&this.lookaheadCharCode()!==61?(M.importKind="type",this.importOrExportOuterKind="type",this.next()):(M.importKind="value",this.importOrExportOuterKind="value");const j=this.tsParseImportEqualsDeclaration(M,!0);return this.importOrExportOuterKind=void 0,j}else if(this.ts_eatWithState(o.eq,2,G)){const j=M;return j.expression=this.parseExpression(),this.semicolon(),this.importOrExportOuterKind=void 0,this.finishNode(j,"TSExportAssignment")}else if(this.ts_eatContextualWithState("as",2,G)){const j=M;return this.expectContextual("namespace"),j.id=this.parseIdent(),this.semicolon(),this.importOrExportOuterKind=void 0,this.finishNode(j,"TSNamespaceExportDeclaration")}else{if(this.ts_isContextualWithState(G,y.type)&&this.lookahead(2).type===o.braceL?(this.next(),this.importOrExportOuterKind="type",M.exportKind="type"):(this.importOrExportOuterKind="value",M.exportKind="value"),this.next(),this.eat(o.star))return this.parseExportAllDeclaration(M,D);if(this.eat(o._default))return this.checkExport(D,"default",this.lastTokStart),M.declaration=this.parseExportDefaultDeclaration(),this.finishNode(M,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())M.declaration=this.parseExportDeclaration(M),M.declaration.type==="VariableDeclaration"?this.checkVariableExport(D,M.declaration.declarations):this.checkExport(D,M.declaration.id,M.declaration.id.start),M.specifiers=[],M.source=null;else{if(M.declaration=null,M.specifiers=this.parseExportSpecifiers(D),this.eatContextual("from"))this.type!==o.string&&this.unexpected(),M.source=this.parseExprAtom(),this.parseMaybeImportAttributes(M);else{for(let j of M.specifiers)this.checkUnreserved(j.local),this.checkLocalExport(j.local),j.local.type==="Literal"&&this.raise(j.local.start,"A string literal cannot be used as an exported binding without `from`.");M.source=null}this.semicolon()}return this.finishNode(M,"ExportNamedDeclaration")}}checkExport(M,D,G){M&&(typeof D!="string"&&(D=D.type==="Identifier"?D.name:D.value),M[D]=!0)}parseMaybeDefault(M,D,G){const j=super.parseMaybeDefault(M,D,G);return j.type==="AssignmentPattern"&&j.typeAnnotation&&j.right.start<j.typeAnnotation.start&&this.raise(j.typeAnnotation.start,Zi.TypeAnnotationAfterAssign),j}typeCastToParameter(M){return M.expression.typeAnnotation=M.typeAnnotation,this.resetEndLocation(M.expression,M.typeAnnotation.end,M.typeAnnotation.loc?.end),M.expression}toAssignableList(M,D){for(let G=0;G<M.length;G++){const j=M[G];j?.type==="TSTypeCastExpression"&&(M[G]=this.typeCastToParameter(j))}return super.toAssignableList(M,D)}reportReservedArrowTypeParam(M){M.params.length===1&&M.extra?.trailingComma}parseExprAtom(M,D,G){if(this.type===y.jsxText)return this.jsx_parseText();if(this.type===y.jsxTagStart)return this.jsx_parseElement();if(this.type===y.at)return this.parseDecorators(),this.parseExprAtom();if(F(this.type)){let j=this.potentialArrowAt===this.start,Z=this.start,ie=this.startLoc,le=this.containsEsc,me=this.parseIdent(!1);if(this.ecmaVersion>=8&&!le&&me.name==="async"&&!this.canInsertSemicolon()&&this.eat(o._function))return this.overrideContext(p.f_expr),this.parseFunction(this.startNodeAt(Z,ie),0,!1,!0,D);if(j&&!this.canInsertSemicolon()){if(this.eat(o.arrow))return this.parseArrowExpression(this.startNodeAt(Z,ie),[me],!1,D);if(this.ecmaVersion>=8&&me.name==="async"&&this.type===o.name&&!le&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return me=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(o.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(Z,ie),[me],!0,D)}return me}else return super.parseExprAtom(M,D,G)}parseExprAtomDefault(){if(F(this.type)){const M=this.potentialArrowAt===this.start,D=this.containsEsc,G=this.parseIdent();if(!D&&G.name==="async"&&!this.canInsertSemicolon()){const{type:j}=this;if(j===o._function)return this.next(),this.parseFunction(this.startNodeAtNode(G),void 0,!0,!0);if(F(j))if(this.lookaheadCharCode()===61){const Z=this.parseIdent(!1);return(this.canInsertSemicolon()||!this.eat(o.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAtNode(G),[Z],!0)}else return G}return M&&this.match(o.arrow)&&!this.canInsertSemicolon()?(this.next(),this.parseArrowExpression(this.startNodeAtNode(G),[G],!1)):G}else this.unexpected()}parseIdentNode(){let M=this.startNode();if(k(this.type)&&!((this.type.keyword==="class"||this.type.keyword==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)))M.name=this.value;else return super.parseIdentNode();return M}parseVarStatement(M,D,G=!1){const{isAmbientContext:j}=this;this.next(),super.parseVar(M,!1,D,G||j),this.semicolon();const Z=this.finishNode(M,"VariableDeclaration");if(!j)return Z;for(const{id:ie,init:le}of Z.declarations)le&&(D!=="const"||ie.typeAnnotation?this.raise(le.start,Zi.InitializerNotAllowedInAmbientContext):le.type!=="StringLiteral"&&le.type!=="BooleanLiteral"&&le.type!=="NumericLiteral"&&le.type!=="BigIntLiteral"&&(le.type!=="TemplateLiteral"||le.expressions.length>0)&&!JAe(le)&&this.raise(le.start,Zi.ConstInitiailizerMustBeStringOrNumericLiteralOrLiteralEnumReference));return Z}parseStatement(M,D,G){if(this.match(y.at)&&this.parseDecorators(!0),this.match(o._const)&&this.isLookaheadContextual("enum")){const j=this.startNode();return this.expect(o._const),this.tsParseEnumDeclaration(j,{const:!0})}if(this.ts_isContextual(y.enum))return this.tsParseEnumDeclaration(this.startNode());if(this.ts_isContextual(y.interface)){const j=this.tsParseInterfaceDeclaration(this.startNode());if(j)return j}return super.parseStatement(M,D,G)}parseAccessModifier(){return this.tsParseModifier(["public","protected","private"])}parsePostMemberNameModifiers(M){this.eat(o.question)&&(M.optional=!0),M.readonly&&this.match(o.parenL)&&this.raise(M.start,Zi.ClassMethodHasReadonly),M.declare&&this.match(o.parenL)&&this.raise(M.start,Zi.ClassMethodHasDeclare)}parseExpressionStatement(M,D){return(D.type==="Identifier"?this.tsParseExpressionStatement(M,D):void 0)||super.parseExpressionStatement(M,D)}shouldParseExportStatement(){return this.tsIsDeclarationStart()||this.match(y.at)?!0:super.shouldParseExportStatement()}parseConditional(M,D,G,j,Z){if(this.eat(o.question)){let ie=this.startNodeAt(D,G);return ie.test=M,ie.consequent=this.parseMaybeAssign(),this.expect(o.colon),ie.alternate=this.parseMaybeAssign(j),this.finishNode(ie,"ConditionalExpression")}return M}parseMaybeConditional(M,D){let G=this.start,j=this.startLoc,Z=this.parseExprOps(M,D);if(this.checkExpressionErrors(D))return Z;if(!this.maybeInArrowParameters||!this.match(o.question))return this.parseConditional(Z,G,j,M,D);const ie=this.tryParse(()=>this.parseConditional(Z,G,j,M,D));return ie.node?(ie.error&&this.setLookaheadState(ie.failState),ie.node):(ie.error&&this.setOptionalParametersError(D,ie.error),Z)}parseParenItem(M){const D=this.start,G=this.startLoc;if(M=super.parseParenItem(M),this.eat(o.question)&&(M.optional=!0,this.resetEndLocation(M)),this.match(o.colon)){const j=this.startNodeAt(D,G);return j.expression=M,j.typeAnnotation=this.tsParseTypeAnnotation(),this.finishNode(j,"TSTypeCastExpression")}return M}parseExportDeclaration(M){if(!this.isAmbientContext&&this.ts_isContextual(y.declare))return this.tsInAmbientContext(()=>this.parseExportDeclaration(M));const D=this.start,G=this.startLoc,j=this.eatContextual("declare");j&&(this.ts_isContextual(y.declare)||!this.shouldParseExportStatement())&&this.raise(this.start,Zi.ExpectedAmbientAfterExportDeclare);const ie=F(this.type)&&this.tsTryParseExportDeclaration()||this.parseStatement(null);return ie?((ie.type==="TSInterfaceDeclaration"||ie.type==="TSTypeAliasDeclaration"||j)&&(M.exportKind="type"),j&&(this.resetStartLocation(ie,D,G),ie.declare=!0),ie):null}parseClassId(M,D){if(!D&&this.isContextual("implements"))return;super.parseClassId(M,D);const G=this.tsTryParseTypeParameters(this.tsParseInOutModifiers.bind(this));G&&(M.typeParameters=G)}parseClassPropertyAnnotation(M){M.optional||(this.value==="!"&&this.eat(o.prefix)?M.definite=!0:this.eat(o.question)&&(M.optional=!0));const D=this.tsTryParseTypeAnnotation();D&&(M.typeAnnotation=D)}parseClassField(M){if(M.key.type==="PrivateIdentifier")M.abstract&&this.raise(M.start,Zi.PrivateElementHasAbstract),M.accessibility&&this.raise(M.start,Zi.PrivateElementHasAccessibility({modifier:M.accessibility})),this.parseClassPropertyAnnotation(M);else if(this.parseClassPropertyAnnotation(M),this.isAmbientContext&&!(M.readonly&&!M.typeAnnotation)&&this.match(o.eq)&&this.raise(this.start,Zi.DeclareClassFieldHasInitializer),M.abstract&&this.match(o.eq)){const{key:G}=M;this.raise(this.start,Zi.AbstractPropertyHasInitializer({propertyName:G.type==="Identifier"&&!M.computed?G.name:`[${this.input.slice(G.start,G.end)}]`}))}return super.parseClassField(M)}parseClassMethod(M,D,G,j){const Z=M.kind==="constructor",ie=M.key.type==="PrivateIdentifier",le=this.tsTryParseTypeParameters(this.tsParseConstModifier);ie?(le&&(M.typeParameters=le),M.accessibility&&this.raise(M.start,Zi.PrivateMethodsHasAccessibility({modifier:M.accessibility}))):le&&Z&&this.raise(le.start,Zi.ConstructorHasTypeParameters);const{declare:me=!1,kind:be}=M;me&&(be==="get"||be==="set")&&this.raise(M.start,Zi.DeclareAccessor({kind:be})),le&&(M.typeParameters=le);const fe=M.key;M.kind==="constructor"?(D&&this.raise(fe.start,"Constructor can't be a generator"),G&&this.raise(fe.start,"Constructor can't be an async method")):M.static&&$6(M,"prototype")&&this.raise(fe.start,"Classes may not have a static property named prototype");const Fe=M.value=this.parseMethod(D,G,j,!0,M);return M.kind==="get"&&Fe.params.length!==0&&this.raiseRecoverable(Fe.start,"getter should have no params"),M.kind==="set"&&Fe.params.length!==1&&this.raiseRecoverable(Fe.start,"setter should have exactly one param"),M.kind==="set"&&Fe.params[0].type==="RestElement"&&this.raiseRecoverable(Fe.params[0].start,"Setter cannot use rest params"),this.finishNode(M,"MethodDefinition")}isClassMethod(){return this.match(o.relational)}parseClassElement(M){if(this.eat(o.semi))return null;let D=this.startNode(),G="",j=!1,Z=!1,ie="method",le=!1;const me=["declare","private","public","protected","accessor","override","abstract","readonly","static"];le=!!this.tsParseModifiers({modified:D,allowedModifiers:me,disallowedModifiers:["in","out"],stopOnStartOfClassStaticBlock:!0,errorTemplate:Zi.InvalidModifierOnTypeParameterPositions}).static;const fe=()=>{if(this.tsIsStartOfStaticBlocks()){if(this.next(),this.next(),this.tsHasSomeModifiers(D,me)&&this.raise(this.start,Zi.StaticBlockCannotHaveModifier),this.ecmaVersion>=13)return super.parseClassStaticBlock(D),D}else{const Fe=this.tsTryParseIndexSignature(D);if(Fe)return D.abstract&&this.raise(D.start,Zi.IndexSignatureHasAbstract),D.accessibility&&this.raise(D.start,Zi.IndexSignatureHasAccessibility({modifier:D.accessibility})),D.declare&&this.raise(D.start,Zi.IndexSignatureHasDeclare),D.override&&this.raise(D.start,Zi.IndexSignatureHasOverride),Fe;if(!this.inAbstractClass&&D.abstract&&this.raise(D.start,Zi.NonAbstractClassHasAbstractMethod),D.override&&(M||this.raise(D.start,Zi.OverrideNotInSubClass)),D.static=le,le&&(this.isClassElementNameStart()||this.type===o.star||(G="static")),!G&&this.ecmaVersion>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===o.star)&&!this.canInsertSemicolon()?Z=!0:G="async"),!G&&(this.ecmaVersion>=9||!Z)&&this.eat(o.star)&&(j=!0),!G&&!Z&&!j){const He=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?ie=He:G=He)}if(G?(D.computed=!1,D.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),D.key.name=G,this.finishNode(D.key,"Identifier")):this.parseClassElementName(D),this.parsePostMemberNameModifiers(D),this.isClassMethod()||this.ecmaVersion<13||this.type===o.parenL||ie!=="method"||j||Z){const He=!D.static&&$6(D,"constructor"),je=He&&M;He&&ie!=="method"&&this.raise(D.key.start,"Constructor can't have get/set modifier"),D.kind=He?"constructor":ie,this.parseClassMethod(D,j,Z,je)}else this.parseClassField(D);return D}};return D.declare?this.tsInAmbientContext(fe):fe(),D}isClassElementNameStart(){return this.tsIsIdentifier()?!0:super.isClassElementNameStart()}parseClassSuper(M){super.parseClassSuper(M),M.superClass&&(this.tsMatchLeftRelational()||this.match(o.bitShift))&&(M.superTypeParameters=this.tsParseTypeArgumentsInExpression()),this.eatContextual("implements")&&(M.implements=this.tsParseHeritageClause("implements"))}parseFunctionParams(M){const D=this.tsTryParseTypeParameters(this.tsParseConstModifier);D&&(M.typeParameters=D),super.parseFunctionParams(M)}parseVarId(M,D){super.parseVarId(M,D),M.id.type==="Identifier"&&!this.hasPrecedingLineBreak()&&this.value==="!"&&this.eat(o.prefix)&&(M.definite=!0);const G=this.tsTryParseTypeAnnotation();G&&(M.id.typeAnnotation=G,this.resetEndLocation(M.id))}parseArrowExpression(M,D,G,j){this.match(o.colon)&&(M.returnType=this.tsParseTypeAnnotation());let Z=this.yieldPos,ie=this.awaitPos,le=this.awaitIdentPos;this.enterScope(vN(G,!1)|Sr.SCOPE_ARROW),this.initFunction(M);const me=this.maybeInArrowParameters;return this.ecmaVersion>=8&&(M.async=!!G),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.maybeInArrowParameters=!0,M.params=this.toAssignableList(D,!0),this.maybeInArrowParameters=!1,this.parseFunctionBody(M,!0,!1,j),this.yieldPos=Z,this.awaitPos=ie,this.awaitIdentPos=le,this.maybeInArrowParameters=me,this.finishNode(M,"ArrowFunctionExpression")}parseMaybeAssignOrigin(M,D,G){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(M);this.exprAllowed=!1}let j=!1,Z=-1,ie=-1,le=-1;D?(Z=D.parenthesizedAssign,ie=D.trailingComma,le=D.doubleProto,D.parenthesizedAssign=D.trailingComma=-1):(D=new jb,j=!0);let me=this.start,be=this.startLoc;(this.type===o.parenL||F(this.type))&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=M==="await");let fe=this.parseMaybeConditional(M,D);if(G&&(fe=G.call(this,fe,me,be)),this.type.isAssign){let Fe=this.startNodeAt(me,be);return Fe.operator=this.value,this.type===o.eq&&(fe=this.toAssignable(fe,!0,D)),j||(D.parenthesizedAssign=D.trailingComma=D.doubleProto=-1),D.shorthandAssign>=fe.start&&(D.shorthandAssign=-1),this.maybeInArrowParameters||(this.type===o.eq?this.checkLValPattern(fe):this.checkLValSimple(fe)),Fe.left=fe,this.next(),Fe.right=this.parseMaybeAssign(M),le>-1&&(D.doubleProto=le),this.finishNode(Fe,"AssignmentExpression")}else j&&this.checkExpressionErrors(D,!0);return Z>-1&&(D.parenthesizedAssign=Z),ie>-1&&(D.trailingComma=ie),fe}parseMaybeAssign(M,D,G){let j,Z;if(!this.tsMatchLeftRelational())return this.parseMaybeAssignOrigin(M,D,G);(!j||this.compareLookaheadState(j,this.getCurLookaheadState()))&&(j=this.cloneCurLookaheadState());let ie;const le=this.tryParse(me=>{ie=this.tsParseTypeParameters(this.tsParseConstModifier);const be=this.parseMaybeAssignOrigin(M,D,G);return(be.type!=="ArrowFunctionExpression"||be.extra?.parenthesized)&&me(),ie?.params.length!==0&&this.resetStartLocationFromNode(be,ie),be.typeParameters=ie,be},j);if(!le.error&&!le.aborted)return ie&&this.reportReservedArrowTypeParam(ie),le.node;if(W6(!0),Z=this.tryParse(()=>this.parseMaybeAssignOrigin(M,D,G),j),!Z.error)return Z.node;if(le.node)return this.setLookaheadState(le.failState),ie&&this.reportReservedArrowTypeParam(ie),le.node;if(Z?.node)return this.setLookaheadState(Z.failState),Z.node;throw le.thrown?le.error:Z?.thrown?Z.error:le.error||Z?.error}parseAssignableListItem(M){const D=[];for(;this.match(y.at);)D.push(this.parseDecorator());const G=this.start,j=this.startLoc;let Z,ie=!1,le=!1;if(M!==void 0){const fe={};this.tsParseModifiers({modified:fe,allowedModifiers:["public","private","protected","override","readonly"]}),Z=fe.accessibility,le=fe.override,ie=fe.readonly,M===!1&&(Z||ie||le)&&this.raise(j.start,Zi.UnexpectedParameterModifier)}const me=this.parseMaybeDefault(G,j);this.parseBindingListItem(me);const be=this.parseMaybeDefault(me.start,me.loc,me);if(D.length&&(be.decorators=D),Z||ie||le){const fe=this.startNodeAt(G,j);return Z&&(fe.accessibility=Z),ie&&(fe.readonly=ie),le&&(fe.override=le),be.type!=="Identifier"&&be.type!=="AssignmentPattern"&&this.raise(fe.start,Zi.UnsupportedParameterPropertyKind),fe.parameter=be,this.finishNode(fe,"TSParameterProperty")}return be}checkLValInnerPattern(M,D=Sr.BIND_NONE,G){switch(M.type){case"TSParameterProperty":this.checkLValInnerPattern(M.parameter,D,G);break;default:{super.checkLValInnerPattern(M,D,G);break}}}parseBindingListItem(M){this.eat(o.question)&&(M.type!=="Identifier"&&!this.isAmbientContext&&!this.inType&&this.raise(M.start,Zi.PatternIsOptional),M.optional=!0);const D=this.tsTryParseTypeAnnotation();return D&&(M.typeAnnotation=D),this.resetEndLocation(M),M}isAssignable(M,D){switch(M.type){case"TSTypeCastExpression":return this.isAssignable(M.expression,D);case"TSParameterProperty":return!0;case"Identifier":case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":return!0;case"ObjectExpression":{const G=M.properties.length-1;return M.properties.every((j,Z)=>j.type!=="ObjectMethod"&&(Z===G||j.type!=="SpreadElement")&&this.isAssignable(j))}case"Property":case"ObjectProperty":return this.isAssignable(M.value);case"SpreadElement":return this.isAssignable(M.argument);case"ArrayExpression":return M.elements.every(G=>G===null||this.isAssignable(G));case"AssignmentExpression":return M.operator==="=";case"ParenthesizedExpression":return this.isAssignable(M.expression);case"MemberExpression":case"OptionalMemberExpression":return!D;default:return!1}}toAssignable(M,D=!1,G=new jb){switch(M.type){case"ParenthesizedExpression":return this.toAssignableParenthesizedExpression(M,D,G);case"TSAsExpression":case"TSSatisfiesExpression":case"TSNonNullExpression":case"TSTypeAssertion":return D||this.raise(M.start,Zi.UnexpectedTypeCastInParameter),this.toAssignable(M.expression,D,G);case"MemberExpression":break;case"AssignmentExpression":return!D&&M.left.type==="TSTypeCastExpression"&&(M.left=this.typeCastToParameter(M.left)),super.toAssignable(M,D,G);case"TSTypeCastExpression":return this.typeCastToParameter(M);default:return super.toAssignable(M,D,G)}return M}toAssignableParenthesizedExpression(M,D,G){switch(M.expression.type){case"TSAsExpression":case"TSSatisfiesExpression":case"TSNonNullExpression":case"TSTypeAssertion":case"ParenthesizedExpression":return this.toAssignable(M.expression,D,G);default:return super.toAssignable(M,D,G)}}parseBindingAtom(){switch(this.type){case o._this:return this.parseIdent(!0);default:return super.parseBindingAtom()}}shouldParseArrow(M){let D;if(this.match(o.colon)?D=M.every(G=>this.isAssignable(G,!0)):D=!this.canInsertSemicolon(),D){if(this.match(o.colon)){const G=this.tryParse(j=>{const Z=this.tsParseTypeOrTypePredicateAnnotation(o.colon);return(this.canInsertSemicolon()||!this.match(o.arrow))&&j(),Z});if(G.aborted)return this.shouldParseArrowReturnType=void 0,!1;G.thrown||(G.error&&this.setLookaheadState(G.failState),this.shouldParseArrowReturnType=G.node)}return this.match(o.arrow)?!0:(this.shouldParseArrowReturnType=void 0,!1)}return this.shouldParseArrowReturnType=void 0,D}parseParenArrowList(M,D,G,j){const Z=this.startNodeAt(M,D);return Z.returnType=this.shouldParseArrowReturnType,this.shouldParseArrowReturnType=void 0,this.parseArrowExpression(Z,G,!1,j)}parseParenAndDistinguishExpression(M,D){let G=this.start,j=this.startLoc,Z,ie=this.ecmaVersion>=8;if(this.ecmaVersion>=6){const le=this.maybeInArrowParameters;this.maybeInArrowParameters=!0,this.next();let me=this.start,be=this.startLoc,fe=[],Fe=!0,He=!1,je=new jb,qe=this.yieldPos,ct=this.awaitPos,Ge;for(this.yieldPos=0,this.awaitPos=0;this.type!==o.parenR;)if(Fe?Fe=!1:this.expect(o.comma),ie&&this.afterTrailingComma(o.parenR,!0)){He=!0;break}else if(this.type===o.ellipsis){Ge=this.start,fe.push(this.parseParenItem(this.parseRestBinding())),this.type===o.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else fe.push(this.parseMaybeAssign(D,je,this.parseParenItem));let Je=this.lastTokEnd,mt=this.lastTokEndLoc;if(this.expect(o.parenR),this.maybeInArrowParameters=le,M&&this.shouldParseArrow(fe)&&this.eat(o.arrow))return this.checkPatternErrors(je,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=qe,this.awaitPos=ct,this.parseParenArrowList(G,j,fe,D);(!fe.length||He)&&this.unexpected(this.lastTokStart),Ge&&this.unexpected(Ge),this.checkExpressionErrors(je,!0),this.yieldPos=qe||this.yieldPos,this.awaitPos=ct||this.awaitPos,fe.length>1?(Z=this.startNodeAt(me,be),Z.expressions=fe,this.finishNodeAt(Z,"SequenceExpression",Je,mt)):Z=fe[0]}else Z=this.parseParenExpression();if(this.options.preserveParens){let le=this.startNodeAt(G,j);return le.expression=Z,this.finishNode(le,"ParenthesizedExpression")}else return Z}parseTaggedTemplateExpression(M,D,G,j){const Z=this.startNodeAt(D,G);return Z.tag=M,Z.quasi=this.parseTemplate({isTagged:!0}),j&&this.raise(D,"Tagged Template Literals are not allowed in optionalChain."),this.finishNode(Z,"TaggedTemplateExpression")}shouldParseAsyncArrow(){if(this.match(o.colon)){const M=this.tryParse(D=>{const G=this.tsParseTypeOrTypePredicateAnnotation(o.colon);return(this.canInsertSemicolon()||!this.match(o.arrow))&&D(),G});if(M.aborted)return this.shouldParseAsyncArrowReturnType=void 0,!1;if(!M.thrown)return M.error&&this.setLookaheadState(M.failState),this.shouldParseAsyncArrowReturnType=M.node,!this.canInsertSemicolon()&&this.eat(o.arrow)}else return!this.canInsertSemicolon()&&this.eat(o.arrow)}parseSubscriptAsyncArrow(M,D,G,j){const Z=this.startNodeAt(M,D);return Z.returnType=this.shouldParseAsyncArrowReturnType,this.shouldParseAsyncArrowReturnType=void 0,this.parseArrowExpression(Z,G,!0,j)}parseExprList(M,D,G,j){let Z=[],ie=!0;for(;!this.eat(M);){if(ie)ie=!1;else if(this.expect(o.comma),D&&this.afterTrailingComma(M))break;let le;G&&this.type===o.comma?le=null:this.type===o.ellipsis?(le=this.parseSpread(j),this.maybeInArrowParameters&&this.match(o.colon)&&(le.typeAnnotation=this.tsParseTypeAnnotation()),j&&this.type===o.comma&&j.trailingComma<0&&(j.trailingComma=this.start)):le=this.parseMaybeAssign(!1,j,this.parseParenItem),Z.push(le)}return Z}parseSubscript(M,D,G,j,Z,ie,le){let me=ie;if(!this.hasPrecedingLineBreak()&&this.value==="!"&&this.match(o.prefix)){this.exprAllowed=!1,this.next();const je=this.startNodeAt(D,G);return je.expression=M,M=this.finishNode(je,"TSNonNullExpression"),M}let be=!1;if(this.match(o.questionDot)&&this.lookaheadCharCode()===60){if(j)return M;M.optional=!0,me=be=!0,this.next()}if(this.tsMatchLeftRelational()||this.match(o.bitShift)){let je;const qe=this.tsTryParseAndCatch(()=>{if(!j&&this.atPossibleAsyncArrow(M)){const mt=this.tsTryParseGenericAsyncArrowFunction(D,G,le);if(mt)return M=mt,M}const ct=this.tsParseTypeArgumentsInExpression();if(!ct)return M;if(be&&!this.match(o.parenL))return je=this.curPosition(),M;if(P(this.type)||this.type===o.backQuote){const mt=this.parseTaggedTemplateExpression(M,D,G,me);return mt.typeArguments=ct,mt}if(!j&&this.eat(o.parenL)){let mt=new jb;const wt=this.startNodeAt(D,G);return wt.callee=M,wt.arguments=this.parseExprList(o.parenR,this.ecmaVersion>=8,!1,mt),this.tsCheckForInvalidTypeCasts(wt.arguments),wt.typeArguments=ct,me&&(wt.optional=be),this.checkExpressionErrors(mt,!0),M=this.finishNode(wt,"CallExpression"),M}const Ge=this.type;if(this.tsMatchRightRelational()||Ge===o.bitShift||Ge!==o.parenL&&eIe(Ge)&&!this.hasPrecedingLineBreak())return;const Je=this.startNodeAt(D,G);return Je.expression=M,Je.typeArguments=ct,this.finishNode(Je,"TSInstantiationExpression")});if(je&&this.unexpected(je),qe)return qe.type==="TSInstantiationExpression"&&(this.match(o.dot)||this.match(o.questionDot)&&this.lookaheadCharCode()!==40)&&this.raise(this.start,Zi.InvalidPropertyAccessAfterInstantiationExpression),M=qe,M}let fe=this.ecmaVersion>=11,Fe=fe&&this.eat(o.questionDot);j&&Fe&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");let He=this.eat(o.bracketL);if(He||Fe&&this.type!==o.parenL&&this.type!==o.backQuote||this.eat(o.dot)){let je=this.startNodeAt(D,G);je.object=M,He?(je.property=this.parseExpression(),this.expect(o.bracketR)):this.type===o.privateId&&M.type!=="Super"?je.property=this.parsePrivateIdent():je.property=this.parseIdent(this.options.allowReserved!=="never"),je.computed=!!He,fe&&(je.optional=Fe),M=this.finishNode(je,"MemberExpression")}else if(!j&&this.eat(o.parenL)){const je=this.maybeInArrowParameters;this.maybeInArrowParameters=!0;let qe=new jb,ct=this.yieldPos,Ge=this.awaitPos,Je=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;let mt=this.parseExprList(o.parenR,this.ecmaVersion>=8,!1,qe);if(Z&&!Fe&&this.shouldParseAsyncArrow())this.checkPatternErrors(qe,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=ct,this.awaitPos=Ge,this.awaitIdentPos=Je,M=this.parseSubscriptAsyncArrow(D,G,mt,le);else{this.checkExpressionErrors(qe,!0),this.yieldPos=ct||this.yieldPos,this.awaitPos=Ge||this.awaitPos,this.awaitIdentPos=Je||this.awaitIdentPos;let wt=this.startNodeAt(D,G);wt.callee=M,wt.arguments=mt,fe&&(wt.optional=Fe),M=this.finishNode(wt,"CallExpression")}this.maybeInArrowParameters=je}else if(this.type===o.backQuote){(Fe||me)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");let je=this.startNodeAt(D,G);je.tag=M,je.quasi=this.parseTemplate({isTagged:!0}),M=this.finishNode(je,"TaggedTemplateExpression")}return M}parseGetterSetter(M){M.kind=M.key.name,this.parsePropertyName(M),M.value=this.parseMethod(!1);let D=M.kind==="get"?0:1;const G=M.value.params[0];if(D=G&&this.isThisParam(G)?D+1:D,M.value.params.length!==D){let Z=M.value.start;M.kind==="get"?this.raiseRecoverable(Z,"getter should have no params"):this.raiseRecoverable(Z,"setter should have exactly one param")}else M.kind==="set"&&M.value.params[0].type==="RestElement"&&this.raiseRecoverable(M.value.params[0].start,"Setter cannot use rest params")}parseProperty(M,D){if(!M){let G=[];if(this.match(y.at))for(;this.match(y.at);)G.push(this.parseDecorator());const j=super.parseProperty(M,D);return j.type==="SpreadElement"&&G.length&&this.raise(j.start,EM.SpreadElementDecorator),G.length&&(j.decorators=G,G=[]),j}return super.parseProperty(M,D)}parseCatchClauseParam(){const M=this.parseBindingAtom();let D=M.type==="Identifier";this.enterScope(D?Sr.SCOPE_SIMPLE_CATCH:0),this.checkLValPattern(M,D?Sr.BIND_SIMPLE_CATCH:Sr.BIND_LEXICAL);const G=this.tsTryParseTypeAnnotation();return G&&(M.typeAnnotation=G,this.resetEndLocation(M)),this.expect(o.parenR),M}parseClass(M,D){const G=this.inAbstractClass;this.inAbstractClass=!!M.abstract;try{this.next(),this.takeDecorators(M);const j=this.strict;this.strict=!0,this.parseClassId(M,D),this.parseClassSuper(M);const Z=this.enterClassBody(),ie=this.startNode();let le=!1;ie.body=[];let me=[];for(this.expect(o.braceL);this.type!==o.braceR;){if(this.match(y.at)){me.push(this.parseDecorator());continue}const be=this.parseClassElement(M.superClass!==null);me.length&&(be.decorators=me,this.resetStartLocationFromNode(be,me[0]),me=[]),be&&(ie.body.push(be),be.type==="MethodDefinition"&&be.kind==="constructor"&&be.value.type==="FunctionExpression"?(le&&this.raiseRecoverable(be.start,"Duplicate constructor in the same class"),le=!0,be.decorators&&be.decorators.length>0&&this.raise(be.start,EM.DecoratorConstructor)):be.key&&be.key.type==="PrivateIdentifier"&&jAe(Z,be)&&this.raiseRecoverable(be.key.start,`Identifier '#${be.key.name}' has already been declared`))}return this.strict=j,this.next(),me.length&&this.raise(this.start,EM.TrailingDecorator),M.body=this.finishNode(ie,"ClassBody"),this.exitClassBody(),this.finishNode(M,D?"ClassDeclaration":"ClassExpression")}finally{this.inAbstractClass=G}}parseClassFunctionParams(){const M=this.tsTryParseTypeParameters();let D=this.parseBindingList(o.parenR,!1,this.ecmaVersion>=8,!0);return M&&(D.typeParameters=M),D}parseMethod(M,D,G,j,Z){let ie=this.startNode(),le=this.yieldPos,me=this.awaitPos,be=this.awaitIdentPos;if(this.initFunction(ie),this.ecmaVersion>=6&&(ie.generator=M),this.ecmaVersion>=8&&(ie.async=!!D),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(vN(D,ie.generator)|Sr.SCOPE_SUPER|(G?Sr.SCOPE_DIRECT_SUPER:0)),this.expect(o.parenL),ie.params=this.parseClassFunctionParams(),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(ie,!1,!0,!1,{isClassMethod:j}),this.yieldPos=le,this.awaitPos=me,this.awaitIdentPos=be,Z&&Z.abstract&&!!ie.body){const{key:Fe}=Z;this.raise(Z.start,Zi.AbstractMethodHasImplementation({methodName:Fe.type==="Identifier"&&!Z.computed?Fe.name:`[${this.input.slice(Fe.start,Fe.end)}]`}))}return this.finishNode(ie,"FunctionExpression")}static parse(M,D){if(D.locations===!1)throw new Error("You have to enable options.locations while using acorn-typescript");D.locations=!0;const G=new this(D,M);return e&&(G.isAmbientContext=!0),G.parse()}static parseExpressionAt(M,D,G){if(G.locations===!1)throw new Error("You have to enable options.locations while using acorn-typescript");G.locations=!0;const j=new this(G,M,D);return e&&(j.isAmbientContext=!0),j.nextToken(),j.parseExpression()}parseImportSpecifier(){if(this.ts_isContextual(y.type)){let D=this.startNode();return D.imported=this.parseModuleExportName(),this.parseTypeOnlyImportExportSpecifier(D,!0,this.importOrExportOuterKind==="type"),this.finishNode(D,"ImportSpecifier")}else{const D=super.parseImportSpecifier();return D.importKind="value",D}}parseExportSpecifier(M){const D=this.ts_isContextual(y.type);if(!this.match(o.string)&&D){let j=this.startNode();return j.local=this.parseModuleExportName(),this.parseTypeOnlyImportExportSpecifier(j,!1,this.importOrExportOuterKind==="type"),this.finishNode(j,"ExportSpecifier"),this.checkExport(M,j.exported,j.exported.start),j}else{const j=super.parseExportSpecifier(M);return j.exportKind="value",j}}parseTypeOnlyImportExportSpecifier(M,D,G){const j=D?"imported":"local",Z=D?"local":"exported";let ie=M[j],le,me=!1,be=!0;const fe=ie.start;if(this.isContextual("as")){const He=this.parseIdent();if(this.isContextual("as")){const je=this.parseIdent();k(this.type)?(me=!0,ie=He,le=D?this.parseIdent():this.parseModuleExportName(),be=!1):(le=je,be=!1)}else k(this.type)?(be=!1,le=D?this.parseIdent():this.parseModuleExportName()):(me=!0,ie=He)}else k(this.type)&&(me=!0,D?(ie=super.parseIdent(!0),this.isContextual("as")||this.checkUnreserved(ie)):ie=this.parseModuleExportName());me&&G&&this.raise(fe,D?Zi.TypeModifierIsUsedInTypeImports:Zi.TypeModifierIsUsedInTypeExports),M[j]=ie,M[Z]=le;const Fe=D?"importKind":"exportKind";M[Fe]=me?"type":"value",be&&this.eatContextual("as")&&(M[Z]=D?this.parseIdent():this.parseModuleExportName()),M[Z]||(M[Z]=this.copyNode(M[j])),D&&this.checkLValSimple(M[Z],Sr.BIND_LEXICAL)}raiseCommonCheck(M,D,G){switch(D){case"Comma is not permitted after the rest element":if(this.isAmbientContext&&this.match(o.comma)&&this.lookaheadCharCode()===41){this.next();return}else return super.raise(M,D)}return G?super.raiseRecoverable(M,D):super.raise(M,D)}raiseRecoverable(M,D){return this.raiseCommonCheck(M,D,!0)}raise(M,D){return this.raiseCommonCheck(M,D,!0)}updateContext(M){const{type:D}=this;if(D==o.braceL){var G=this.curContext();G==w.tc_oTag?this.context.push(p.b_expr):G==w.tc_expr?this.context.push(p.b_tmpl):super.updateContext(M),this.exprAllowed=!0}else if(D===o.slash&&M===y.jsxTagStart)this.context.length-=2,this.context.push(w.tc_cTag),this.exprAllowed=!1;else return super.updateContext(M)}jsx_parseOpeningElementAt(M,D){let G=this.startNodeAt(M,D),j=this.jsx_parseElementName();if(j&&(G.name=j),this.match(o.relational)||this.match(o.bitShift)){const Z=this.tsTryParseAndCatch(()=>this.tsParseTypeArgumentsInExpression());Z&&(G.typeArguments=Z)}for(G.attributes=[];this.type!==o.slash&&this.type!==y.jsxTagEnd;)G.attributes.push(this.jsx_parseAttribute());return G.selfClosing=this.eat(o.slash),this.expect(y.jsxTagEnd),this.finishNode(G,j?"JSXOpeningElement":"JSXOpeningFragment")}enterScope(M){M===qb&&this.importsStack.push([]),super.enterScope(M);const D=super.currentScope();D.types=[],D.enums=[],D.constEnums=[],D.classes=[],D.exportOnlyBindings=[]}exitScope(){super.currentScope().flags===qb&&this.importsStack.pop(),super.exitScope()}hasImport(M,D){const G=this.importsStack.length;if(this.importsStack[G-1].indexOf(M)>-1)return!0;if(!D&&G>1){for(let j=0;j<G-1;j++)if(this.importsStack[j].indexOf(M)>-1)return!0}return!1}maybeExportDefined(M,D){this.inModule&&M.flags&Sr.SCOPE_TOP&&this.undefinedExports.delete(D)}declareName(M,D,G){if(D&Sr.BIND_FLAGS_TS_IMPORT){this.hasImport(M,!0)&&this.raise(G,`Identifier '${M}' has already been declared.`),this.importsStack[this.importsStack.length-1].push(M);return}const j=this.currentScope();if(D&Sr.BIND_FLAGS_TS_EXPORT_ONLY){this.maybeExportDefined(j,M),j.exportOnlyBindings.push(M);return}D===Sr.BIND_TS_TYPE||D===Sr.BIND_TS_INTERFACE?(D===Sr.BIND_TS_TYPE&&j.types.includes(M)&&this.raise(G,`type '${M}' has already been declared.`),j.types.push(M)):super.declareName(M,D,G),D&Sr.BIND_FLAGS_TS_ENUM&&j.enums.push(M),D&Sr.BIND_FLAGS_TS_CONST_ENUM&&j.constEnums.push(M),D&Sr.BIND_FLAGS_CLASS&&j.classes.push(M)}checkLocalExport(M){const{name:D}=M;if(this.hasImport(D))return;const G=this.scopeStack.length;for(let j=G-1;j>=0;j--){const Z=this.scopeStack[j];if(Z.types.indexOf(D)>-1||Z.exportOnlyBindings.indexOf(D)>-1)return}super.checkLocalExport(M)}}return Q}}bs.extend(nIe());class rIe extends Error{message="";#e;constructor(e,i,n){super(i),this.stack="",this.#e=new pee(e,i,n),Object.assign(this,this.#e),this.name="CompileError"}toString(){return this.#e.toString()}toJSON(){return this.#e.toJSON()}}function QU(t,e,i){throw new rIe(e,i,void 0)}function sIe(t,e){QU(t,"options_invalid_value",`Invalid compiler option: ${e}
https://svelte.dev/e/options_invalid_value`)}function oIe(t,e){QU(t,"options_removed",`Invalid compiler option: ${e}
https://svelte.dev/e/options_removed`)}function aIe(t,e){QU(t,"options_unrecognised",`Unrecognised compiler option ${e}
https://svelte.dev/e/options_unrecognised`)}const lIe={"CounterClockwiseContourIntegral;":8755,"ClockwiseContourIntegral;":8754,"DoubleLongLeftRightArrow;":10234,"NotNestedGreaterGreater;":10914,"DiacriticalDoubleAcute;":733,"NotSquareSupersetEqual;":8931,"CloseCurlyDoubleQuote;":8221,"DoubleContourIntegral;":8751,"FilledVerySmallSquare;":9642,"NegativeVeryThinSpace;":8203,"NotPrecedesSlantEqual;":8928,"NotRightTriangleEqual;":8941,"NotSucceedsSlantEqual;":8929,"CapitalDifferentialD;":8517,"DoubleLeftRightArrow;":8660,"DoubleLongRightArrow;":10233,"EmptyVerySmallSquare;":9643,"NestedGreaterGreater;":8811,"NotDoubleVerticalBar;":8742,"NotGreaterSlantEqual;":10878,"NotLeftTriangleEqual;":8940,"NotSquareSubsetEqual;":8930,"OpenCurlyDoubleQuote;":8220,"ReverseUpEquilibrium;":10607,"DoubleLongLeftArrow;":10232,"DownLeftRightVector;":10576,"LeftArrowRightArrow;":8646,"NegativeMediumSpace;":8203,"NotGreaterFullEqual;":8807,"NotRightTriangleBar;":10704,"RightArrowLeftArrow;":8644,"SquareSupersetEqual;":8850,"leftrightsquigarrow;":8621,"DownRightTeeVector;":10591,"DownRightVectorBar;":10583,"LongLeftRightArrow;":10231,"Longleftrightarrow;":10234,"NegativeThickSpace;":8203,"NotLeftTriangleBar;":10703,"PrecedesSlantEqual;":8828,"ReverseEquilibrium;":8651,"RightDoubleBracket;":10215,"RightDownTeeVector;":10589,"RightDownVectorBar;":10581,"RightTriangleEqual;":8885,"SquareIntersection;":8851,"SucceedsSlantEqual;":8829,"blacktriangleright;":9656,"longleftrightarrow;":10231,"DoubleUpDownArrow;":8661,"DoubleVerticalBar;":8741,"DownLeftTeeVector;":10590,"DownLeftVectorBar;":10582,"FilledSmallSquare;":9724,"GreaterSlantEqual;":10878,"LeftDoubleBracket;":10214,"LeftDownTeeVector;":10593,"LeftDownVectorBar;":10585,"LeftTriangleEqual;":8884,"NegativeThinSpace;":8203,"NotGreaterGreater;":8811,"NotLessSlantEqual;":10877,"NotNestedLessLess;":10913,"NotReverseElement;":8716,"NotSquareSuperset;":8848,"NotTildeFullEqual;":8775,"RightAngleBracket;":10217,"RightUpDownVector;":10575,"SquareSubsetEqual;":8849,"VerticalSeparator;":10072,"blacktriangledown;":9662,"blacktriangleleft;":9666,"leftrightharpoons;":8651,"rightleftharpoons;":8652,"twoheadrightarrow;":8608,"DiacriticalAcute;":180,"DiacriticalGrave;":96,"DiacriticalTilde;":732,"DoubleRightArrow;":8658,"DownArrowUpArrow;":8693,"EmptySmallSquare;":9723,"GreaterEqualLess;":8923,"GreaterFullEqual;":8807,"LeftAngleBracket;":10216,"LeftUpDownVector;":10577,"LessEqualGreater;":8922,"NonBreakingSpace;":160,"NotPrecedesEqual;":10927,"NotRightTriangle;":8939,"NotSucceedsEqual;":10928,"NotSucceedsTilde;":8831,"NotSupersetEqual;":8841,"RightTriangleBar;":10704,"RightUpTeeVector;":10588,"RightUpVectorBar;":10580,"UnderParenthesis;":9181,"UpArrowDownArrow;":8645,"circlearrowright;":8635,"downharpoonright;":8642,"ntrianglerighteq;":8941,"rightharpoondown;":8641,"rightrightarrows;":8649,"twoheadleftarrow;":8606,"vartriangleright;":8883,"CloseCurlyQuote;":8217,"ContourIntegral;":8750,"DoubleDownArrow;":8659,"DoubleLeftArrow;":8656,"DownRightVector;":8641,"LeftRightVector;":10574,"LeftTriangleBar;":10703,"LeftUpTeeVector;":10592,"LeftUpVectorBar;":10584,"LowerRightArrow;":8600,"NotGreaterEqual;":8817,"NotGreaterTilde;":8821,"NotHumpDownHump;":8782,"NotLeftTriangle;":8938,"NotSquareSubset;":8847,"OverParenthesis;":9180,"RightDownVector;":8642,"ShortRightArrow;":8594,"UpperRightArrow;":8599,"bigtriangledown;":9661,"circlearrowleft;":8634,"curvearrowright;":8631,"downharpoonleft;":8643,"leftharpoondown;":8637,"leftrightarrows;":8646,"nLeftrightarrow;":8654,"nleftrightarrow;":8622,"ntrianglelefteq;":8940,"rightleftarrows;":8644,"rightsquigarrow;":8605,"rightthreetimes;":8908,"straightepsilon;":1013,"trianglerighteq;":8885,"vartriangleleft;":8882,"DiacriticalDot;":729,"DoubleRightTee;":8872,"DownLeftVector;":8637,"GreaterGreater;":10914,"HorizontalLine;":9472,"InvisibleComma;":8291,"InvisibleTimes;":8290,"LeftDownVector;":8643,"LeftRightArrow;":8596,"Leftrightarrow;":8660,"LessSlantEqual;":10877,"LongRightArrow;":10230,"Longrightarrow;":10233,"LowerLeftArrow;":8601,"NestedLessLess;":8810,"NotGreaterLess;":8825,"NotLessGreater;":8824,"NotSubsetEqual;":8840,"NotVerticalBar;":8740,"OpenCurlyQuote;":8216,"ReverseElement;":8715,"RightTeeVector;":10587,"RightVectorBar;":10579,"ShortDownArrow;":8595,"ShortLeftArrow;":8592,"SquareSuperset;":8848,"TildeFullEqual;":8773,"UpperLeftArrow;":8598,"ZeroWidthSpace;":8203,"curvearrowleft;":8630,"doublebarwedge;":8966,"downdownarrows;":8650,"hookrightarrow;":8618,"leftleftarrows;":8647,"leftrightarrow;":8596,"leftthreetimes;":8907,"longrightarrow;":10230,"looparrowright;":8620,"nshortparallel;":8742,"ntriangleright;":8939,"rightarrowtail;":8611,"rightharpoonup;":8640,"trianglelefteq;":8884,"upharpoonright;":8638,"ApplyFunction;":8289,"DifferentialD;":8518,"DoubleLeftTee;":10980,"DoubleUpArrow;":8657,"LeftTeeVector;":10586,"LeftVectorBar;":10578,"LessFullEqual;":8806,"LongLeftArrow;":10229,"Longleftarrow;":10232,"NotEqualTilde;":8770,"NotTildeEqual;":8772,"NotTildeTilde;":8777,"Poincareplane;":8460,"PrecedesEqual;":10927,"PrecedesTilde;":8830,"RightArrowBar;":8677,"RightTeeArrow;":8614,"RightTriangle;":8883,"RightUpVector;":8638,"SucceedsEqual;":10928,"SucceedsTilde;":8831,"SupersetEqual;":8839,"UpEquilibrium;":10606,"VerticalTilde;":8768,"VeryThinSpace;":8202,"bigtriangleup;":9651,"blacktriangle;":9652,"divideontimes;":8903,"fallingdotseq;":8786,"hookleftarrow;":8617,"leftarrowtail;":8610,"leftharpoonup;":8636,"longleftarrow;":10229,"looparrowleft;":8619,"measuredangle;":8737,"ntriangleleft;":8938,"shortparallel;":8741,"smallsetminus;":8726,"triangleright;":9657,"upharpoonleft;":8639,"varsubsetneqq;":10955,"varsupsetneqq;":10956,"DownArrowBar;":10515,"DownTeeArrow;":8615,"ExponentialE;":8519,"GreaterEqual;":8805,"GreaterTilde;":8819,"HilbertSpace;":8459,"HumpDownHump;":8782,"Intersection;":8898,"LeftArrowBar;":8676,"LeftTeeArrow;":8612,"LeftTriangle;":8882,"LeftUpVector;":8639,"NotCongruent;":8802,"NotHumpEqual;":8783,"NotLessEqual;":8816,"NotLessTilde;":8820,"Proportional;":8733,"RightCeiling;":8969,"RoundImplies;":10608,"ShortUpArrow;":8593,"SquareSubset;":8847,"UnderBracket;":9141,"VerticalLine;":124,"blacklozenge;":10731,"exponentiale;":8519,"risingdotseq;":8787,"triangledown;":9663,"triangleleft;":9667,"varsubsetneq;":8842,"varsupsetneq;":8843,"CircleMinus;":8854,"CircleTimes;":8855,"Equilibrium;":8652,"GreaterLess;":8823,"LeftCeiling;":8968,"LessGreater;":8822,"MediumSpace;":8287,"NotLessLess;":8810,"NotPrecedes;":8832,"NotSucceeds;":8833,"NotSuperset;":8835,"OverBracket;":9140,"RightVector;":8640,"Rrightarrow;":8667,"RuleDelayed;":10740,"SmallCircle;":8728,"SquareUnion;":8852,"SubsetEqual;":8838,"UpDownArrow;":8597,"Updownarrow;":8661,"VerticalBar;":8739,"backepsilon;":1014,"blacksquare;":9642,"circledcirc;":8858,"circleddash;":8861,"curlyeqprec;":8926,"curlyeqsucc;":8927,"diamondsuit;":9830,"eqslantless;":10901,"expectation;":8496,"nRightarrow;":8655,"nrightarrow;":8603,"preccurlyeq;":8828,"precnapprox;":10937,"quaternions;":8461,"straightphi;":981,"succcurlyeq;":8829,"succnapprox;":10938,"thickapprox;":8776,"updownarrow;":8597,"Bernoullis;":8492,"CirclePlus;":8853,"EqualTilde;":8770,"Fouriertrf;":8497,"ImaginaryI;":8520,"Laplacetrf;":8466,"LeftVector;":8636,"Lleftarrow;":8666,"NotElement;":8713,"NotGreater;":8815,"Proportion;":8759,"RightArrow;":8594,"RightFloor;":8971,"Rightarrow;":8658,"ThickSpace;":8287,"TildeEqual;":8771,"TildeTilde;":8776,"UnderBrace;":9183,"UpArrowBar;":10514,"UpTeeArrow;":8613,"circledast;":8859,"complement;":8705,"curlywedge;":8911,"eqslantgtr;":10902,"gtreqqless;":10892,"lessapprox;":10885,"lesseqqgtr;":10891,"lmoustache;":9136,"longmapsto;":10236,"mapstodown;":8615,"mapstoleft;":8612,"nLeftarrow;":8653,"nleftarrow;":8602,"nsubseteqq;":10949,"nsupseteqq;":10950,"precapprox;":10935,"rightarrow;":8594,"rmoustache;":9137,"sqsubseteq;":8849,"sqsupseteq;":8850,"subsetneqq;":10955,"succapprox;":10936,"supsetneqq;":10956,"upuparrows;":8648,"varepsilon;":1013,"varnothing;":8709,"Backslash;":8726,"CenterDot;":183,"CircleDot;":8857,"Congruent;":8801,"Coproduct;":8720,"DoubleDot;":168,"DownArrow;":8595,"DownBreve;":785,"Downarrow;":8659,"HumpEqual;":8783,"LeftArrow;":8592,"LeftFloor;":8970,"Leftarrow;":8656,"LessTilde;":8818,"Mellintrf;":8499,"MinusPlus;":8723,"NotCupCap;":8813,"NotExists;":8708,"NotSubset;":8834,"OverBrace;":9182,"PlusMinus;":177,"Therefore;":8756,"ThinSpace;":8201,"TripleDot;":8411,"UnionPlus;":8846,"backprime;":8245,"backsimeq;":8909,"bigotimes;":10754,"centerdot;":183,"checkmark;":10003,"complexes;":8450,"dotsquare;":8865,"downarrow;":8595,"gtrapprox;":10886,"gtreqless;":8923,"gvertneqq;":8809,"heartsuit;":9829,"leftarrow;":8592,"lesseqgtr;":8922,"lvertneqq;":8808,"ngeqslant;":10878,"nleqslant;":10877,"nparallel;":8742,"nshortmid;":8740,"nsubseteq;":8840,"nsupseteq;":8841,"pitchfork;":8916,"rationals;":8474,"spadesuit;":9824,"subseteqq;":10949,"subsetneq;":8842,"supseteqq;":10950,"supsetneq;":8843,"therefore;":8756,"triangleq;":8796,"varpropto;":8733,"DDotrahd;":10513,"DotEqual;":8784,"Integral;":8747,"LessLess;":10913,"NotEqual;":8800,"NotTilde;":8769,"PartialD;":8706,"Precedes;":8826,"RightTee;":8866,"Succeeds;":8827,"SuchThat;":8715,"Superset;":8835,"Uarrocir;":10569,"UnderBar;":95,"andslope;":10840,"angmsdaa;":10664,"angmsdab;":10665,"angmsdac;":10666,"angmsdad;":10667,"angmsdae;":10668,"angmsdaf;":10669,"angmsdag;":10670,"angmsdah;":10671,"angrtvbd;":10653,"approxeq;":8778,"awconint;":8755,"backcong;":8780,"barwedge;":8965,"bbrktbrk;":9142,"bigoplus;":10753,"bigsqcup;":10758,"biguplus;":10756,"bigwedge;":8896,"boxminus;":8863,"boxtimes;":8864,"bsolhsub;":10184,"capbrcup;":10825,"circledR;":174,"circledS;":9416,"cirfnint;":10768,"clubsuit;":9827,"cupbrcap;":10824,"curlyvee;":8910,"cwconint;":8754,"doteqdot;":8785,"dotminus;":8760,"drbkarow;":10512,"dzigrarr;":10239,"elinters;":9191,"emptyset;":8709,"eqvparsl;":10725,"fpartint;":10765,"geqslant;":10878,"gesdotol;":10884,"gnapprox;":10890,"hksearow;":10533,"hkswarow;":10534,"imagline;":8464,"imagpart;":8465,"infintie;":10717,"integers;":8484,"intercal;":8890,"intlarhk;":10775,"laemptyv;":10676,"ldrushar;":10571,"leqslant;":10877,"lesdotor;":10883,"llcorner;":8990,"lnapprox;":10889,"lrcorner;":8991,"lurdshar;":10570,"mapstoup;":8613,"multimap;":8888,"naturals;":8469,"ncongdot;":10861,"notindot;":8949,"otimesas;":10806,"parallel;":8741,"plusacir;":10787,"pointint;":10773,"precneqq;":10933,"precnsim;":8936,"profalar;":9006,"profline;":8978,"profsurf;":8979,"raemptyv;":10675,"realpart;":8476,"rppolint;":10770,"rtriltri;":10702,"scpolint;":10771,"setminus;":8726,"shortmid;":8739,"smeparsl;":10724,"sqsubset;":8847,"sqsupset;":8848,"subseteq;":8838,"succneqq;":10934,"succnsim;":8937,"supseteq;":8839,"thetasym;":977,"thicksim;":8764,"timesbar;":10801,"triangle;":9653,"triminus;":10810,"trpezium;":9186,"ulcorner;":8988,"urcorner;":8989,"varkappa;":1008,"varsigma;":962,"vartheta;":977,"Because;":8757,"Cayleys;":8493,"Cconint;":8752,"Cedilla;":184,"Diamond;":8900,"DownTee;":8868,"Element;":8712,"Epsilon;":917,"Implies;":8658,"LeftTee;":8867,"NewLine;":10,"NoBreak;":8288,"NotLess;":8814,"Omicron;":927,"OverBar;":8254,"Product;":8719,"UpArrow;":8593,"Uparrow;":8657,"Upsilon;":933,"alefsym;":8501,"angrtvb;":8894,"angzarr;":9084,"asympeq;":8781,"backsim;":8765,"because;":8757,"bemptyv;":10672,"between;":8812,"bigcirc;":9711,"bigodot;":10752,"bigstar;":9733,"bnequiv;":8801,"boxplus;":8862,"ccupssm;":10832,"cemptyv;":10674,"cirscir;":10690,"coloneq;":8788,"congdot;":10861,"cudarrl;":10552,"cudarrr;":10549,"cularrp;":10557,"curarrm;":10556,"dbkarow;":10511,"ddagger;":8225,"ddotseq;":10871,"demptyv;":10673,"diamond;":8900,"digamma;":989,"dotplus;":8724,"dwangle;":10662,"epsilon;":949,"eqcolon;":8789,"equivDD;":10872,"gesdoto;":10882,"gtquest;":10876,"gtrless;":8823,"harrcir;":10568,"intprod;":10812,"isindot;":8949,"larrbfs;":10527,"larrsim;":10611,"lbrksld;":10639,"lbrkslu;":10637,"ldrdhar;":10599,"lesdoto;":10881,"lessdot;":8918,"lessgtr;":8822,"lesssim;":8818,"lotimes;":10804,"lozenge;":9674,"ltquest;":10875,"luruhar;":10598,"maltese;":10016,"minusdu;":10794,"napprox;":8777,"natural;":9838,"nearrow;":8599,"nexists;":8708,"notinva;":8713,"notinvb;":8951,"notinvc;":8950,"notniva;":8716,"notnivb;":8958,"notnivc;":8957,"npolint;":10772,"npreceq;":10927,"nsqsube;":8930,"nsqsupe;":8931,"nsubset;":8834,"nsucceq;":10928,"nsupset;":8835,"nvinfin;":10718,"nvltrie;":8884,"nvrtrie;":8885,"nwarrow;":8598,"olcross;":10683,"omicron;":959,"orderof;":8500,"orslope;":10839,"pertenk;":8241,"planckh;":8462,"pluscir;":10786,"plussim;":10790,"plustwo;":10791,"precsim;":8830,"quatint;":10774,"questeq;":8799,"rarrbfs;":10528,"rarrsim;":10612,"rbrksld;":10638,"rbrkslu;":10640,"rdldhar;":10601,"realine;":8475,"rotimes;":10805,"ruluhar;":10600,"searrow;":8600,"simplus;":10788,"simrarr;":10610,"subedot;":10947,"submult;":10945,"subplus;":10943,"subrarr;":10617,"succsim;":8831,"supdsub;":10968,"supedot;":10948,"suphsol;":10185,"suphsub;":10967,"suplarr;":10619,"supmult;":10946,"supplus;":10944,"swarrow;":8601,"topfork;":10970,"triplus;":10809,"tritime;":10811,"uparrow;":8593,"upsilon;":965,"uwangle;":10663,"vzigzag;":10650,"zigrarr;":8669,"Aacute;":193,"Abreve;":258,"Agrave;":192,"Assign;":8788,"Atilde;":195,"Barwed;":8966,"Bumpeq;":8782,"Cacute;":262,"Ccaron;":268,"Ccedil;":199,"Colone;":10868,"Conint;":8751,"CupCap;":8781,"Dagger;":8225,"Dcaron;":270,"DotDot;":8412,"Dstrok;":272,"Eacute;":201,"Ecaron;":282,"Egrave;":200,"Exists;":8707,"ForAll;":8704,"Gammad;":988,"Gbreve;":286,"Gcedil;":290,"HARDcy;":1066,"Hstrok;":294,"Iacute;":205,"Igrave;":204,"Itilde;":296,"Jsercy;":1032,"Kcedil;":310,"Lacute;":313,"Lambda;":923,"Lcaron;":317,"Lcedil;":315,"Lmidot;":319,"Lstrok;":321,"Nacute;":323,"Ncaron;":327,"Ncedil;":325,"Ntilde;":209,"Oacute;":211,"Odblac;":336,"Ograve;":210,"Oslash;":216,"Otilde;":213,"Otimes;":10807,"Racute;":340,"Rarrtl;":10518,"Rcaron;":344,"Rcedil;":342,"SHCHcy;":1065,"SOFTcy;":1068,"Sacute;":346,"Scaron;":352,"Scedil;":350,"Square;":9633,"Subset;":8912,"Supset;":8913,"Tcaron;":356,"Tcedil;":354,"Tstrok;":358,"Uacute;":218,"Ubreve;":364,"Udblac;":368,"Ugrave;":217,"Utilde;":360,"Vdashl;":10982,"Verbar;":8214,"Vvdash;":8874,"Yacute;":221,"Zacute;":377,"Zcaron;":381,"aacute;":225,"abreve;":259,"agrave;":224,"andand;":10837,"angmsd;":8737,"angsph;":8738,"apacir;":10863,"approx;":8776,"atilde;":227,"barvee;":8893,"barwed;":8965,"becaus;":8757,"bernou;":8492,"bigcap;":8898,"bigcup;":8899,"bigvee;":8897,"bkarow;":10509,"bottom;":8869,"bowtie;":8904,"boxbox;":10697,"bprime;":8245,"brvbar;":166,"bullet;":8226,"bumpeq;":8783,"cacute;":263,"capand;":10820,"capcap;":10827,"capcup;":10823,"capdot;":10816,"ccaron;":269,"ccedil;":231,"circeq;":8791,"cirmid;":10991,"colone;":8788,"commat;":64,"compfn;":8728,"conint;":8750,"coprod;":8720,"copysr;":8471,"cularr;":8630,"cupcap;":10822,"cupcup;":10826,"cupdot;":8845,"curarr;":8631,"curren;":164,"cylcty;":9005,"dagger;":8224,"daleth;":8504,"dcaron;":271,"dfisht;":10623,"divide;":247,"divonx;":8903,"dlcorn;":8990,"dlcrop;":8973,"dollar;":36,"drcorn;":8991,"drcrop;":8972,"dstrok;":273,"eacute;":233,"easter;":10862,"ecaron;":283,"ecolon;":8789,"egrave;":232,"egsdot;":10904,"elsdot;":10903,"emptyv;":8709,"emsp13;":8196,"emsp14;":8197,"eparsl;":10723,"eqcirc;":8790,"equals;":61,"equest;":8799,"female;":9792,"ffilig;":64259,"ffllig;":64260,"forall;":8704,"frac12;":189,"frac13;":8531,"frac14;":188,"frac15;":8533,"frac16;":8537,"frac18;":8539,"frac23;":8532,"frac25;":8534,"frac34;":190,"frac35;":8535,"frac38;":8540,"frac45;":8536,"frac56;":8538,"frac58;":8541,"frac78;":8542,"gacute;":501,"gammad;":989,"gbreve;":287,"gesdot;":10880,"gesles;":10900,"gtlPar;":10645,"gtrarr;":10616,"gtrdot;":8919,"gtrsim;":8819,"hairsp;":8202,"hamilt;":8459,"hardcy;":1098,"hearts;":9829,"hellip;":8230,"hercon;":8889,"homtht;":8763,"horbar;":8213,"hslash;":8463,"hstrok;":295,"hybull;":8259,"hyphen;":8208,"iacute;":237,"igrave;":236,"iiiint;":10764,"iinfin;":10716,"incare;":8453,"inodot;":305,"intcal;":8890,"iquest;":191,"isinsv;":8947,"itilde;":297,"jsercy;":1112,"kappav;":1008,"kcedil;":311,"kgreen;":312,"lAtail;":10523,"lacute;":314,"lagran;":8466,"lambda;":955,"langle;":10216,"larrfs;":10525,"larrhk;":8617,"larrlp;":8619,"larrpl;":10553,"larrtl;":8610,"latail;":10521,"lbrace;":123,"lbrack;":91,"lcaron;":318,"lcedil;":316,"ldquor;":8222,"lesdot;":10879,"lesges;":10899,"lfisht;":10620,"lfloor;":8970,"lharul;":10602,"llhard;":10603,"lmidot;":320,"lmoust;":9136,"loplus;":10797,"lowast;":8727,"lowbar;":95,"lparlt;":10643,"lrhard;":10605,"lsaquo;":8249,"lsquor;":8218,"lstrok;":322,"lthree;":8907,"ltimes;":8905,"ltlarr;":10614,"ltrPar;":10646,"mapsto;":8614,"marker;":9646,"mcomma;":10793,"midast;":42,"midcir;":10992,"middot;":183,"minusb;":8863,"minusd;":8760,"mnplus;":8723,"models;":8871,"mstpos;":8766,"nVDash;":8879,"nVdash;":8878,"nacute;":324,"nbumpe;":8783,"ncaron;":328,"ncedil;":326,"nearhk;":10532,"nequiv;":8802,"nesear;":10536,"nexist;":8708,"nltrie;":8940,"notinE;":8953,"nparsl;":11005,"nprcue;":8928,"nrarrc;":10547,"nrarrw;":8605,"nrtrie;":8941,"nsccue;":8929,"nsimeq;":8772,"ntilde;":241,"numero;":8470,"nvDash;":8877,"nvHarr;":10500,"nvdash;":8876,"nvlArr;":10498,"nvrArr;":10499,"nwarhk;":10531,"nwnear;":10535,"oacute;":243,"odblac;":337,"odsold;":10684,"ograve;":242,"ominus;":8854,"origof;":8886,"oslash;":248,"otilde;":245,"otimes;":8855,"parsim;":10995,"percnt;":37,"period;":46,"permil;":8240,"phmmat;":8499,"planck;":8463,"plankv;":8463,"plusdo;":8724,"plusdu;":10789,"plusmn;":177,"preceq;":10927,"primes;":8473,"prnsim;":8936,"propto;":8733,"prurel;":8880,"puncsp;":8200,"qprime;":8279,"rAtail;":10524,"racute;":341,"rangle;":10217,"rarrap;":10613,"rarrfs;":10526,"rarrhk;":8618,"rarrlp;":8620,"rarrpl;":10565,"rarrtl;":8611,"ratail;":10522,"rbrace;":125,"rbrack;":93,"rcaron;":345,"rcedil;":343,"rdquor;":8221,"rfisht;":10621,"rfloor;":8971,"rharul;":10604,"rmoust;":9137,"roplus;":10798,"rpargt;":10644,"rsaquo;":8250,"rsquor;":8217,"rthree;":8908,"rtimes;":8906,"sacute;":347,"scaron;":353,"scedil;":351,"scnsim;":8937,"searhk;":10533,"seswar;":10537,"sfrown;":8994,"shchcy;":1097,"sigmaf;":962,"sigmav;":962,"simdot;":10858,"smashp;":10803,"softcy;":1100,"solbar;":9023,"spades;":9824,"sqcaps;":8851,"sqcups;":8852,"sqsube;":8849,"sqsupe;":8850,"square;":9633,"squarf;":9642,"ssetmn;":8726,"ssmile;":8995,"sstarf;":8902,"subdot;":10941,"subset;":8834,"subsim;":10951,"subsub;":10965,"subsup;":10963,"succeq;":10928,"supdot;":10942,"supset;":8835,"supsim;":10952,"supsub;":10964,"supsup;":10966,"swarhk;":10534,"swnwar;":10538,"target;":8982,"tcaron;":357,"tcedil;":355,"telrec;":8981,"there4;":8756,"thetav;":977,"thinsp;":8201,"thksim;":8764,"timesb;":8864,"timesd;":10800,"topbot;":9014,"topcir;":10993,"tprime;":8244,"tridot;":9708,"tstrok;":359,"uacute;":250,"ubreve;":365,"udblac;":369,"ufisht;":10622,"ugrave;":249,"ulcorn;":8988,"ulcrop;":8975,"urcorn;":8989,"urcrop;":8974,"utilde;":361,"vangrt;":10652,"varphi;":981,"varrho;":1009,"veebar;":8891,"vellip;":8942,"verbar;":124,"vsubnE;":10955,"vsubne;":8842,"vsupnE;":10956,"vsupne;":8843,"wedbar;":10847,"wedgeq;":8793,"weierp;":8472,"wreath;":8768,"xoplus;":10753,"xotime;":10754,"xsqcup;":10758,"xuplus;":10756,"xwedge;":8896,"yacute;":253,"zacute;":378,"zcaron;":382,"zeetrf;":8488,"AElig;":198,Aacute:193,"Acirc;":194,Agrave:192,"Alpha;":913,"Amacr;":256,"Aogon;":260,"Aring;":197,Atilde:195,"Breve;":728,Ccedil:199,"Ccirc;":264,"Colon;":8759,"Cross;":10799,"Dashv;":10980,"Delta;":916,Eacute:201,"Ecirc;":202,Egrave:200,"Emacr;":274,"Eogon;":280,"Equal;":10869,"Gamma;":915,"Gcirc;":284,"Hacek;":711,"Hcirc;":292,"IJlig;":306,Iacute:205,"Icirc;":206,Igrave:204,"Imacr;":298,"Iogon;":302,"Iukcy;":1030,"Jcirc;":308,"Jukcy;":1028,"Kappa;":922,Ntilde:209,"OElig;":338,Oacute:211,"Ocirc;":212,Ograve:210,"Omacr;":332,"Omega;":937,Oslash:216,Otilde:213,"Prime;":8243,"RBarr;":10512,"Scirc;":348,"Sigma;":931,"THORN;":222,"TRADE;":8482,"TSHcy;":1035,"Theta;":920,"Tilde;":8764,Uacute:218,"Ubrcy;":1038,"Ucirc;":219,Ugrave:217,"Umacr;":362,"Union;":8899,"Uogon;":370,"UpTee;":8869,"Uring;":366,"VDash;":8875,"Vdash;":8873,"Wcirc;":372,"Wedge;":8896,Yacute:221,"Ycirc;":374,aacute:225,"acirc;":226,"acute;":180,"aelig;":230,agrave:224,"aleph;":8501,"alpha;":945,"amacr;":257,"amalg;":10815,"angle;":8736,"angrt;":8735,"angst;":197,"aogon;":261,"aring;":229,"asymp;":8776,atilde:227,"awint;":10769,"bcong;":8780,"bdquo;":8222,"bepsi;":1014,"blank;":9251,"blk12;":9618,"blk14;":9617,"blk34;":9619,"block;":9608,"boxDL;":9559,"boxDR;":9556,"boxDl;":9558,"boxDr;":9555,"boxHD;":9574,"boxHU;":9577,"boxHd;":9572,"boxHu;":9575,"boxUL;":9565,"boxUR;":9562,"boxUl;":9564,"boxUr;":9561,"boxVH;":9580,"boxVL;":9571,"boxVR;":9568,"boxVh;":9579,"boxVl;":9570,"boxVr;":9567,"boxdL;":9557,"boxdR;":9554,"boxdl;":9488,"boxdr;":9484,"boxhD;":9573,"boxhU;":9576,"boxhd;":9516,"boxhu;":9524,"boxuL;":9563,"boxuR;":9560,"boxul;":9496,"boxur;":9492,"boxvH;":9578,"boxvL;":9569,"boxvR;":9566,"boxvh;":9532,"boxvl;":9508,"boxvr;":9500,"breve;":728,brvbar:166,"bsemi;":8271,"bsime;":8909,"bsolb;":10693,"bumpE;":10926,"bumpe;":8783,"caret;":8257,"caron;":711,"ccaps;":10829,ccedil:231,"ccirc;":265,"ccups;":10828,"cedil;":184,"check;":10003,"clubs;":9827,"colon;":58,"comma;":44,"crarr;":8629,"cross;":10007,"csube;":10961,"csupe;":10962,"ctdot;":8943,"cuepr;":8926,"cuesc;":8927,"cupor;":10821,curren:164,"cuvee;":8910,"cuwed;":8911,"cwint;":8753,"dashv;":8867,"dblac;":733,"ddarr;":8650,"delta;":948,"dharl;":8643,"dharr;":8642,"diams;":9830,"disin;":8946,divide:247,"doteq;":8784,"dtdot;":8945,"dtrif;":9662,"duarr;":8693,"duhar;":10607,"eDDot;":10871,eacute:233,"ecirc;":234,"efDot;":8786,egrave:232,"emacr;":275,"empty;":8709,"eogon;":281,"eplus;":10865,"epsiv;":1013,"eqsim;":8770,"equiv;":8801,"erDot;":8787,"erarr;":10609,"esdot;":8784,"exist;":8707,"fflig;":64256,"filig;":64257,"fjlig;":102,"fllig;":64258,"fltns;":9649,"forkv;":10969,frac12:189,frac14:188,frac34:190,"frasl;":8260,"frown;":8994,"gamma;":947,"gcirc;":285,"gescc;":10921,"gimel;":8503,"gneqq;":8809,"gnsim;":8935,"grave;":96,"gsime;":10894,"gsiml;":10896,"gtcir;":10874,"gtdot;":8919,"harrw;":8621,"hcirc;":293,"hoarr;":8703,iacute:237,"icirc;":238,"iexcl;":161,igrave:236,"iiint;":8749,"iiota;":8489,"ijlig;":307,"imacr;":299,"image;":8465,"imath;":305,"imped;":437,"infin;":8734,"iogon;":303,"iprod;":10812,iquest:191,"isinE;":8953,"isins;":8948,"isinv;":8712,"iukcy;":1110,"jcirc;":309,"jmath;":567,"jukcy;":1108,"kappa;":954,"lAarr;":8666,"lBarr;":10510,"langd;":10641,"laquo;":171,"larrb;":8676,"lates;":10925,"lbarr;":10508,"lbbrk;":10098,"lbrke;":10635,"lceil;":8968,"ldquo;":8220,"lescc;":10920,"lhard;":8637,"lharu;":8636,"lhblk;":9604,"llarr;":8647,"lltri;":9722,"lneqq;":8808,"lnsim;":8934,"loang;":10220,"loarr;":8701,"lobrk;":10214,"lopar;":10629,"lrarr;":8646,"lrhar;":8651,"lrtri;":8895,"lsime;":10893,"lsimg;":10895,"lsquo;":8216,"ltcir;":10873,"ltdot;":8918,"ltrie;":8884,"ltrif;":9666,"mDDot;":8762,"mdash;":8212,"micro;":181,middot:183,"minus;":8722,"mumap;":8888,"nabla;":8711,"napid;":8779,"napos;":329,"natur;":9838,"nbump;":8782,"ncong;":8775,"ndash;":8211,"neArr;":8663,"nearr;":8599,"nedot;":8784,"nesim;":8770,"ngeqq;":8807,"ngsim;":8821,"nhArr;":8654,"nharr;":8622,"nhpar;":10994,"nlArr;":8653,"nlarr;":8602,"nleqq;":8806,"nless;":8814,"nlsim;":8820,"nltri;":8938,"notin;":8713,"notni;":8716,"npart;":8706,"nprec;":8832,"nrArr;":8655,"nrarr;":8603,"nrtri;":8939,"nsime;":8772,"nsmid;":8740,"nspar;":8742,"nsubE;":10949,"nsube;":8840,"nsucc;":8833,"nsupE;":10950,"nsupe;":8841,ntilde:241,"numsp;":8199,"nvsim;":8764,"nwArr;":8662,"nwarr;":8598,oacute:243,"ocirc;":244,"odash;":8861,"oelig;":339,"ofcir;":10687,ograve:242,"ohbar;":10677,"olarr;":8634,"olcir;":10686,"oline;":8254,"omacr;":333,"omega;":969,"operp;":10681,"oplus;":8853,"orarr;":8635,"order;":8500,oslash:248,otilde:245,"ovbar;":9021,"parsl;":11005,"phone;":9742,"plusb;":8862,"pluse;":10866,plusmn:177,"pound;":163,"prcue;":8828,"prime;":8242,"prnap;":10937,"prsim;":8830,"quest;":63,"rAarr;":8667,"rBarr;":10511,"radic;":8730,"rangd;":10642,"range;":10661,"raquo;":187,"rarrb;":8677,"rarrc;":10547,"rarrw;":8605,"ratio;":8758,"rbarr;":10509,"rbbrk;":10099,"rbrke;":10636,"rceil;":8969,"rdquo;":8221,"reals;":8477,"rhard;":8641,"rharu;":8640,"rlarr;":8644,"rlhar;":8652,"rnmid;":10990,"roang;":10221,"roarr;":8702,"robrk;":10215,"ropar;":10630,"rrarr;":8649,"rsquo;":8217,"rtrie;":8885,"rtrif;":9656,"sbquo;":8218,"sccue;":8829,"scirc;":349,"scnap;":10938,"scsim;":8831,"sdotb;":8865,"sdote;":10854,"seArr;":8664,"searr;":8600,"setmn;":8726,"sharp;":9839,"sigma;":963,"simeq;":8771,"simgE;":10912,"simlE;":10911,"simne;":8774,"slarr;":8592,"smile;":8995,"smtes;":10924,"sqcap;":8851,"sqcup;":8852,"sqsub;":8847,"sqsup;":8848,"srarr;":8594,"starf;":9733,"strns;":175,"subnE;":10955,"subne;":8842,"supnE;":10956,"supne;":8843,"swArr;":8665,"swarr;":8601,"szlig;":223,"theta;":952,"thkap;":8776,"thorn;":254,"tilde;":732,"times;":215,"trade;":8482,"trisb;":10701,"tshcy;":1115,"twixt;":8812,uacute:250,"ubrcy;":1118,"ucirc;":251,"udarr;":8645,"udhar;":10606,ugrave:249,"uharl;":8639,"uharr;":8638,"uhblk;":9600,"ultri;":9720,"umacr;":363,"uogon;":371,"uplus;":8846,"upsih;":978,"uring;":367,"urtri;":9721,"utdot;":8944,"utrif;":9652,"uuarr;":8648,"vBarv;":10985,"vDash;":8872,"varpi;":982,"vdash;":8866,"veeeq;":8794,"vltri;":8882,"vnsub;":8834,"vnsup;":8835,"vprop;":8733,"vrtri;":8883,"wcirc;":373,"wedge;":8743,"xcirc;":9711,"xdtri;":9661,"xhArr;":10234,"xharr;":10231,"xlArr;":10232,"xlarr;":10229,"xodot;":10752,"xrArr;":10233,"xrarr;":10230,"xutri;":9651,yacute:253,"ycirc;":375,AElig:198,Acirc:194,"Aopf;":120120,Aring:197,"Ascr;":119964,"Auml;":196,"Barv;":10983,"Beta;":914,"Bopf;":120121,"Bscr;":8492,"CHcy;":1063,"COPY;":169,"Cdot;":266,"Copf;":8450,"Cscr;":119966,"DJcy;":1026,"DScy;":1029,"DZcy;":1039,"Darr;":8609,"Dopf;":120123,"Dscr;":119967,Ecirc:202,"Edot;":278,"Eopf;":120124,"Escr;":8496,"Esim;":10867,"Euml;":203,"Fopf;":120125,"Fscr;":8497,"GJcy;":1027,"Gdot;":288,"Gopf;":120126,"Gscr;":119970,"Hopf;":8461,"Hscr;":8459,"IEcy;":1045,"IOcy;":1025,Icirc:206,"Idot;":304,"Iopf;":120128,"Iota;":921,"Iscr;":8464,"Iuml;":207,"Jopf;":120129,"Jscr;":119973,"KHcy;":1061,"KJcy;":1036,"Kopf;":120130,"Kscr;":119974,"LJcy;":1033,"Lang;":10218,"Larr;":8606,"Lopf;":120131,"Lscr;":8466,"Mopf;":120132,"Mscr;":8499,"NJcy;":1034,"Nopf;":8469,"Nscr;":119977,Ocirc:212,"Oopf;":120134,"Oscr;":119978,"Ouml;":214,"Popf;":8473,"Pscr;":119979,"QUOT;":34,"Qopf;":8474,"Qscr;":119980,"Rang;":10219,"Rarr;":8608,"Ropf;":8477,"Rscr;":8475,"SHcy;":1064,"Sopf;":120138,"Sqrt;":8730,"Sscr;":119982,"Star;":8902,THORN:222,"TScy;":1062,"Topf;":120139,"Tscr;":119983,"Uarr;":8607,Ucirc:219,"Uopf;":120140,"Upsi;":978,"Uscr;":119984,"Uuml;":220,"Vbar;":10987,"Vert;":8214,"Vopf;":120141,"Vscr;":119985,"Wopf;":120142,"Wscr;":119986,"Xopf;":120143,"Xscr;":119987,"YAcy;":1071,"YIcy;":1031,"YUcy;":1070,"Yopf;":120144,"Yscr;":119988,"Yuml;":376,"ZHcy;":1046,"Zdot;":379,"Zeta;":918,"Zopf;":8484,"Zscr;":119989,acirc:226,acute:180,aelig:230,"andd;":10844,"andv;":10842,"ange;":10660,"aopf;":120146,"apid;":8779,"apos;":39,aring:229,"ascr;":119990,"auml;":228,"bNot;":10989,"bbrk;":9141,"beta;":946,"beth;":8502,"bnot;":8976,"bopf;":120147,"boxH;":9552,"boxV;":9553,"boxh;":9472,"boxv;":9474,"bscr;":119991,"bsim;":8765,"bsol;":92,"bull;":8226,"bump;":8782,"caps;":8745,"cdot;":267,cedil:184,"cent;":162,"chcy;":1095,"cirE;":10691,"circ;":710,"cire;":8791,"comp;":8705,"cong;":8773,"copf;":120148,"copy;":169,"cscr;":119992,"csub;":10959,"csup;":10960,"cups;":8746,"dArr;":8659,"dHar;":10597,"darr;":8595,"dash;":8208,"diam;":8900,"djcy;":1106,"dopf;":120149,"dscr;":119993,"dscy;":1109,"dsol;":10742,"dtri;":9663,"dzcy;":1119,"eDot;":8785,"ecir;":8790,ecirc:234,"edot;":279,"emsp;":8195,"ensp;":8194,"eopf;":120150,"epar;":8917,"epsi;":949,"escr;":8495,"esim;":8770,"euml;":235,"euro;":8364,"excl;":33,"flat;":9837,"fnof;":402,"fopf;":120151,"fork;":8916,"fscr;":119995,"gdot;":289,"geqq;":8807,"gesl;":8923,"gjcy;":1107,"gnap;":10890,"gneq;":10888,"gopf;":120152,"gscr;":8458,"gsim;":8819,"gtcc;":10919,"gvnE;":8809,"hArr;":8660,"half;":189,"harr;":8596,"hbar;":8463,"hopf;":120153,"hscr;":119997,icirc:238,"iecy;":1077,iexcl:161,"imof;":8887,"iocy;":1105,"iopf;":120154,"iota;":953,"iscr;":119998,"isin;":8712,"iuml;":239,"jopf;":120155,"jscr;":119999,"khcy;":1093,"kjcy;":1116,"kopf;":120156,"kscr;":12e4,"lArr;":8656,"lHar;":10594,"lang;":10216,laquo:171,"larr;":8592,"late;":10925,"lcub;":123,"ldca;":10550,"ldsh;":8626,"leqq;":8806,"lesg;":8922,"ljcy;":1113,"lnap;":10889,"lneq;":10887,"lopf;":120157,"lozf;":10731,"lpar;":40,"lscr;":120001,"lsim;":8818,"lsqb;":91,"ltcc;":10918,"ltri;":9667,"lvnE;":8808,"macr;":175,"male;":9794,"malt;":10016,micro:181,"mlcp;":10971,"mldr;":8230,"mopf;":120158,"mscr;":120002,"nGtv;":8811,"nLtv;":8810,"nang;":8736,"napE;":10864,"nbsp;":160,"ncap;":10819,"ncup;":10818,"ngeq;":8817,"nges;":10878,"ngtr;":8815,"nisd;":8954,"njcy;":1114,"nldr;":8229,"nleq;":8816,"nles;":10877,"nmid;":8740,"nopf;":120159,"npar;":8742,"npre;":10927,"nsce;":10928,"nscr;":120003,"nsim;":8769,"nsub;":8836,"nsup;":8837,"ntgl;":8825,"ntlg;":8824,"nvap;":8781,"nvge;":8805,"nvgt;":62,"nvle;":8804,"nvlt;":60,"oast;":8859,"ocir;":8858,ocirc:244,"odiv;":10808,"odot;":8857,"ogon;":731,"oint;":8750,"omid;":10678,"oopf;":120160,"opar;":10679,"ordf;":170,"ordm;":186,"oror;":10838,"oscr;":8500,"osol;":8856,"ouml;":246,"para;":182,"part;":8706,"perp;":8869,"phiv;":981,"plus;":43,"popf;":120161,pound:163,"prap;":10935,"prec;":8826,"prnE;":10933,"prod;":8719,"prop;":8733,"pscr;":120005,"qint;":10764,"qopf;":120162,"qscr;":120006,"quot;":34,"rArr;":8658,"rHar;":10596,"race;":8765,"rang;":10217,raquo:187,"rarr;":8594,"rcub;":125,"rdca;":10551,"rdsh;":8627,"real;":8476,"rect;":9645,"rhov;":1009,"ring;":730,"ropf;":120163,"rpar;":41,"rscr;":120007,"rsqb;":93,"rtri;":9657,"scap;":10936,"scnE;":10934,"sdot;":8901,"sect;":167,"semi;":59,"sext;":10038,"shcy;":1096,"sime;":8771,"simg;":10910,"siml;":10909,"smid;":8739,"smte;":10924,"solb;":10692,"sopf;":120164,"spar;":8741,"squf;":9642,"sscr;":120008,"star;":9734,"subE;":10949,"sube;":8838,"succ;":8827,"sung;":9834,"sup1;":185,"sup2;":178,"sup3;":179,"supE;":10950,"supe;":8839,szlig:223,"tbrk;":9140,"tdot;":8411,thorn:254,times:215,"tint;":8749,"toea;":10536,"topf;":120165,"tosa;":10537,"trie;":8796,"tscr;":120009,"tscy;":1094,"uArr;":8657,"uHar;":10595,"uarr;":8593,ucirc:251,"uopf;":120166,"upsi;":965,"uscr;":120010,"utri;":9653,"uuml;":252,"vArr;":8661,"vBar;":10984,"varr;":8597,"vert;":124,"vopf;":120167,"vscr;":120011,"wopf;":120168,"wscr;":120012,"xcap;":8898,"xcup;":8899,"xmap;":10236,"xnis;":8955,"xopf;":120169,"xscr;":120013,"xvee;":8897,"yacy;":1103,"yicy;":1111,"yopf;":120170,"yscr;":120014,"yucy;":1102,"yuml;":255,"zdot;":380,"zeta;":950,"zhcy;":1078,"zopf;":120171,"zscr;":120015,"zwnj;":8204,"AMP;":38,"Acy;":1040,"Afr;":120068,"And;":10835,Auml:196,"Bcy;":1041,"Bfr;":120069,COPY:169,"Cap;":8914,"Cfr;":8493,"Chi;":935,"Cup;":8915,"Dcy;":1044,"Del;":8711,"Dfr;":120071,"Dot;":168,"ENG;":330,"ETH;":208,"Ecy;":1069,"Efr;":120072,"Eta;":919,Euml:203,"Fcy;":1060,"Ffr;":120073,"Gcy;":1043,"Gfr;":120074,"Hat;":94,"Hfr;":8460,"Icy;":1048,"Ifr;":8465,"Int;":8748,Iuml:207,"Jcy;":1049,"Jfr;":120077,"Kcy;":1050,"Kfr;":120078,"Lcy;":1051,"Lfr;":120079,"Lsh;":8624,"Map;":10501,"Mcy;":1052,"Mfr;":120080,"Ncy;":1053,"Nfr;":120081,"Not;":10988,"Ocy;":1054,"Ofr;":120082,Ouml:214,"Pcy;":1055,"Pfr;":120083,"Phi;":934,"Psi;":936,QUOT:34,"Qfr;":120084,"REG;":174,"Rcy;":1056,"Rfr;":8476,"Rho;":929,"Rsh;":8625,"Scy;":1057,"Sfr;":120086,"Sub;":8912,"Sum;":8721,"Sup;":8913,"Tab;":9,"Tau;":932,"Tcy;":1058,"Tfr;":120087,"Ucy;":1059,"Ufr;":120088,Uuml:220,"Vcy;":1042,"Vee;":8897,"Vfr;":120089,"Wfr;":120090,"Xfr;":120091,"Ycy;":1067,"Yfr;":120092,"Zcy;":1047,"Zfr;":8488,"acE;":8766,"acd;":8767,"acy;":1072,"afr;":120094,"amp;":38,"and;":8743,"ang;":8736,"apE;":10864,"ape;":8778,"ast;":42,auml:228,"bcy;":1073,"bfr;":120095,"bne;":61,"bot;":8869,"cap;":8745,cent:162,"cfr;":120096,"chi;":967,"cir;":9675,copy:169,"cup;":8746,"dcy;":1076,"deg;":176,"dfr;":120097,"die;":168,"div;":247,"dot;":729,"ecy;":1101,"efr;":120098,"egs;":10902,"ell;":8467,"els;":10901,"eng;":331,"eta;":951,"eth;":240,euml:235,"fcy;":1092,"ffr;":120099,"gEl;":10892,"gap;":10886,"gcy;":1075,"gel;":8923,"geq;":8805,"ges;":10878,"gfr;":120100,"ggg;":8921,"glE;":10898,"gla;":10917,"glj;":10916,"gnE;":8809,"gne;":10888,"hfr;":120101,"icy;":1080,"iff;":8660,"ifr;":120102,"int;":8747,iuml:239,"jcy;":1081,"jfr;":120103,"kcy;":1082,"kfr;":120104,"lEg;":10891,"lap;":10885,"lat;":10923,"lcy;":1083,"leg;":8922,"leq;":8804,"les;":10877,"lfr;":120105,"lgE;":10897,"lnE;":8808,"lne;":10887,"loz;":9674,"lrm;":8206,"lsh;":8624,macr:175,"map;":8614,"mcy;":1084,"mfr;":120106,"mho;":8487,"mid;":8739,"nGg;":8921,"nGt;":8811,"nLl;":8920,"nLt;":8810,"nap;":8777,nbsp:160,"ncy;":1085,"nfr;":120107,"ngE;":8807,"nge;":8817,"ngt;":8815,"nis;":8956,"niv;":8715,"nlE;":8806,"nle;":8816,"nlt;":8814,"not;":172,"npr;":8832,"nsc;":8833,"num;":35,"ocy;":1086,"ofr;":120108,"ogt;":10689,"ohm;":937,"olt;":10688,"ord;":10845,ordf:170,ordm:186,"orv;":10843,ouml:246,"par;":8741,para:182,"pcy;":1087,"pfr;":120109,"phi;":966,"piv;":982,"prE;":10931,"pre;":10927,"psi;":968,"qfr;":120110,quot:34,"rcy;":1088,"reg;":174,"rfr;":120111,"rho;":961,"rlm;":8207,"rsh;":8625,"scE;":10932,"sce;":10928,"scy;":1089,sect:167,"sfr;":120112,"shy;":173,"sim;":8764,"smt;":10922,"sol;":47,"squ;":9633,"sub;":8834,"sum;":8721,sup1:185,sup2:178,sup3:179,"sup;":8835,"tau;":964,"tcy;":1090,"tfr;":120113,"top;":8868,"ucy;":1091,"ufr;":120114,"uml;":168,uuml:252,"vcy;":1074,"vee;":8744,"vfr;":120115,"wfr;":120116,"xfr;":120117,"ycy;":1099,"yen;":165,"yfr;":120118,yuml:255,"zcy;":1079,"zfr;":120119,"zwj;":8205,AMP:38,"DD;":8517,ETH:208,"GT;":62,"Gg;":8921,"Gt;":8811,"Im;":8465,"LT;":60,"Ll;":8920,"Lt;":8810,"Mu;":924,"Nu;":925,"Or;":10836,"Pi;":928,"Pr;":10939,REG:174,"Re;":8476,"Sc;":10940,"Xi;":926,"ac;":8766,"af;":8289,amp:38,"ap;":8776,"dd;":8518,deg:176,"ee;":8519,"eg;":10906,"el;":10905,eth:240,"gE;":8807,"ge;":8805,"gg;":8811,"gl;":8823,"gt;":62,"ic;":8291,"ii;":8520,"in;":8712,"it;":8290,"lE;":8806,"le;":8804,"lg;":8822,"ll;":8810,"lt;":60,"mp;":8723,"mu;":956,"ne;":8800,"ni;":8715,not:172,"nu;":957,"oS;":9416,"or;":8744,"pi;":960,"pm;":177,"pr;":8826,reg:174,"rx;":8478,"sc;":8827,shy:173,uml:168,"wp;":8472,"wr;":8768,"xi;":958,yen:165,GT:62,LT:60,gt:62,lt:60};function cIe(t,e){return e&&!t.endsWith(";")?`${t}\\b(?!=)`:t}function Kee(t){const e="#(?:x[a-fA-F\\d]+|\\d+)(?:;)?",i=Object.keys(lIe).map(r=>cIe(r,t));return new RegExp(`&(${e}|${i.join("|")})`,"g")}Kee(!1);Kee(!0);const uIe=new Map([["svelte:head","SvelteHead"],["svelte:options","SvelteOptions"],["svelte:window","SvelteWindow"],["svelte:document","SvelteDocument"],["svelte:body","SvelteBody"]]);new Map([...uIe,["svelte:element","SvelteElement"],["svelte:component","SvelteComponent"],["svelte:self","SvelteSelf"],["svelte:fragment","SvelteFragment"],["svelte:boundary","SvelteBoundary"]]);var vu={},DP={},iv={},LP={};Object.defineProperty(LP,"__esModule",{value:!0});LP.default=void 0;function hIe(){var t=this,e=0,i={"@@iterator":function(){return i},next:function(){if(e<t.length){var r=t[e];return e=e+1,{done:!1,value:r}}else return{done:!0}}};return i}LP.default=hIe;Object.defineProperty(iv,"__esModule",{value:!0});iv.default=pIe;var dIe=fIe(LP);function fIe(t){return t&&t.__esModule?t:{default:t}}function Vz(t){"@babel/helpers - typeof";return Vz=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vz(t)}function pIe(t,e){return typeof Symbol=="function"&&Vz(Symbol.iterator)==="symbol"&&Object.defineProperty(t,Symbol.iterator,{value:dIe.default.bind(e)}),t}Object.defineProperty(DP,"__esModule",{value:!0});DP.default=void 0;var mIe=gIe(iv);function gIe(t){return t&&t.__esModule?t:{default:t}}function yN(t,e){return bIe(t)||xIe(t,e)||yIe(t,e)||vIe()}function vIe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yIe(t,e){if(t){if(typeof t=="string")return Q6(t,e);var i={}.toString.call(t).slice(8,-1);return i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set"?Array.from(t):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Q6(t,e):void 0}}function Q6(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function xIe(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var n,r,s,o,a=[],l=!0,u=!1;try{if(s=(i=i.call(t)).next,e===0){if(Object(i)!==i)return;l=!1}else for(;!(l=(n=s.call(i)).done)&&(a.push(n.value),a.length!==e);l=!0);}catch(d){u=!0,r=d}finally{try{if(!l&&i.return!=null&&(o=i.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function bIe(t){if(Array.isArray(t))return t}var ry=[["aria-activedescendant",{type:"id"}],["aria-atomic",{type:"boolean"}],["aria-autocomplete",{type:"token",values:["inline","list","both","none"]}],["aria-braillelabel",{type:"string"}],["aria-brailleroledescription",{type:"string"}],["aria-busy",{type:"boolean"}],["aria-checked",{type:"tristate"}],["aria-colcount",{type:"integer"}],["aria-colindex",{type:"integer"}],["aria-colspan",{type:"integer"}],["aria-controls",{type:"idlist"}],["aria-current",{type:"token",values:["page","step","location","date","time",!0,!1]}],["aria-describedby",{type:"idlist"}],["aria-description",{type:"string"}],["aria-details",{type:"id"}],["aria-disabled",{type:"boolean"}],["aria-dropeffect",{type:"tokenlist",values:["copy","execute","link","move","none","popup"]}],["aria-errormessage",{type:"id"}],["aria-expanded",{type:"boolean",allowundefined:!0}],["aria-flowto",{type:"idlist"}],["aria-grabbed",{type:"boolean",allowundefined:!0}],["aria-haspopup",{type:"token",values:[!1,!0,"menu","listbox","tree","grid","dialog"]}],["aria-hidden",{type:"boolean",allowundefined:!0}],["aria-invalid",{type:"token",values:["grammar",!1,"spelling",!0]}],["aria-keyshortcuts",{type:"string"}],["aria-label",{type:"string"}],["aria-labelledby",{type:"idlist"}],["aria-level",{type:"integer"}],["aria-live",{type:"token",values:["assertive","off","polite"]}],["aria-modal",{type:"boolean"}],["aria-multiline",{type:"boolean"}],["aria-multiselectable",{type:"boolean"}],["aria-orientation",{type:"token",values:["vertical","undefined","horizontal"]}],["aria-owns",{type:"idlist"}],["aria-placeholder",{type:"string"}],["aria-posinset",{type:"integer"}],["aria-pressed",{type:"tristate"}],["aria-readonly",{type:"boolean"}],["aria-relevant",{type:"tokenlist",values:["additions","all","removals","text"]}],["aria-required",{type:"boolean"}],["aria-roledescription",{type:"string"}],["aria-rowcount",{type:"integer"}],["aria-rowindex",{type:"integer"}],["aria-rowspan",{type:"integer"}],["aria-selected",{type:"boolean",allowundefined:!0}],["aria-setsize",{type:"integer"}],["aria-sort",{type:"token",values:["ascending","descending","none","other"]}],["aria-valuemax",{type:"number"}],["aria-valuemin",{type:"number"}],["aria-valuenow",{type:"number"}],["aria-valuetext",{type:"string"}]],Gz={entries:function(){return ry},forEach:function(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=0,r=ry;n<r.length;n++){var s=yN(r[n],2),o=s[0],a=s[1];e.call(i,a,o,ry)}},get:function(e){var i=ry.filter(function(n){return n[0]===e})[0];return i&&i[1]},has:function(e){return!!Gz.get(e)},keys:function(){return ry.map(function(e){var i=yN(e,1),n=i[0];return n})},values:function(){return ry.map(function(e){var i=yN(e,2),n=i[1];return n})}};DP.default=(0,mIe.default)(Gz,Gz.entries());var FP={};Object.defineProperty(FP,"__esModule",{value:!0});FP.default=void 0;var wIe=_Ie(iv);function _Ie(t){return t&&t.__esModule?t:{default:t}}function xN(t,e){return MIe(t)||OIe(t,e)||SIe(t,e)||CIe()}function CIe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SIe(t,e){if(t){if(typeof t=="string")return Z6(t,e);var i={}.toString.call(t).slice(8,-1);return i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set"?Array.from(t):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Z6(t,e):void 0}}function Z6(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function OIe(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var n,r,s,o,a=[],l=!0,u=!1;try{if(s=(i=i.call(t)).next,e===0){if(Object(i)!==i)return;l=!1}else for(;!(l=(n=s.call(i)).done)&&(a.push(n.value),a.length!==e);l=!0);}catch(d){u=!0,r=d}finally{try{if(!l&&i.return!=null&&(o=i.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function MIe(t){if(Array.isArray(t))return t}var sy=[["a",{reserved:!1}],["abbr",{reserved:!1}],["acronym",{reserved:!1}],["address",{reserved:!1}],["applet",{reserved:!1}],["area",{reserved:!1}],["article",{reserved:!1}],["aside",{reserved:!1}],["audio",{reserved:!1}],["b",{reserved:!1}],["base",{reserved:!0}],["bdi",{reserved:!1}],["bdo",{reserved:!1}],["big",{reserved:!1}],["blink",{reserved:!1}],["blockquote",{reserved:!1}],["body",{reserved:!1}],["br",{reserved:!1}],["button",{reserved:!1}],["canvas",{reserved:!1}],["caption",{reserved:!1}],["center",{reserved:!1}],["cite",{reserved:!1}],["code",{reserved:!1}],["col",{reserved:!0}],["colgroup",{reserved:!0}],["content",{reserved:!1}],["data",{reserved:!1}],["datalist",{reserved:!1}],["dd",{reserved:!1}],["del",{reserved:!1}],["details",{reserved:!1}],["dfn",{reserved:!1}],["dialog",{reserved:!1}],["dir",{reserved:!1}],["div",{reserved:!1}],["dl",{reserved:!1}],["dt",{reserved:!1}],["em",{reserved:!1}],["embed",{reserved:!1}],["fieldset",{reserved:!1}],["figcaption",{reserved:!1}],["figure",{reserved:!1}],["font",{reserved:!1}],["footer",{reserved:!1}],["form",{reserved:!1}],["frame",{reserved:!1}],["frameset",{reserved:!1}],["h1",{reserved:!1}],["h2",{reserved:!1}],["h3",{reserved:!1}],["h4",{reserved:!1}],["h5",{reserved:!1}],["h6",{reserved:!1}],["head",{reserved:!0}],["header",{reserved:!1}],["hgroup",{reserved:!1}],["hr",{reserved:!1}],["html",{reserved:!0}],["i",{reserved:!1}],["iframe",{reserved:!1}],["img",{reserved:!1}],["input",{reserved:!1}],["ins",{reserved:!1}],["kbd",{reserved:!1}],["keygen",{reserved:!1}],["label",{reserved:!1}],["legend",{reserved:!1}],["li",{reserved:!1}],["link",{reserved:!0}],["main",{reserved:!1}],["map",{reserved:!1}],["mark",{reserved:!1}],["marquee",{reserved:!1}],["menu",{reserved:!1}],["menuitem",{reserved:!1}],["meta",{reserved:!0}],["meter",{reserved:!1}],["nav",{reserved:!1}],["noembed",{reserved:!0}],["noscript",{reserved:!0}],["object",{reserved:!1}],["ol",{reserved:!1}],["optgroup",{reserved:!1}],["option",{reserved:!1}],["output",{reserved:!1}],["p",{reserved:!1}],["param",{reserved:!0}],["picture",{reserved:!0}],["pre",{reserved:!1}],["progress",{reserved:!1}],["q",{reserved:!1}],["rp",{reserved:!1}],["rt",{reserved:!1}],["rtc",{reserved:!1}],["ruby",{reserved:!1}],["s",{reserved:!1}],["samp",{reserved:!1}],["script",{reserved:!0}],["section",{reserved:!1}],["select",{reserved:!1}],["small",{reserved:!1}],["source",{reserved:!0}],["spacer",{reserved:!1}],["span",{reserved:!1}],["strike",{reserved:!1}],["strong",{reserved:!1}],["style",{reserved:!0}],["sub",{reserved:!1}],["summary",{reserved:!1}],["sup",{reserved:!1}],["table",{reserved:!1}],["tbody",{reserved:!1}],["td",{reserved:!1}],["textarea",{reserved:!1}],["tfoot",{reserved:!1}],["th",{reserved:!1}],["thead",{reserved:!1}],["time",{reserved:!1}],["title",{reserved:!0}],["tr",{reserved:!1}],["track",{reserved:!0}],["tt",{reserved:!1}],["u",{reserved:!1}],["ul",{reserved:!1}],["var",{reserved:!1}],["video",{reserved:!1}],["wbr",{reserved:!1}],["xmp",{reserved:!1}]],Uz={entries:function(){return sy},forEach:function(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=0,r=sy;n<r.length;n++){var s=xN(r[n],2),o=s[0],a=s[1];e.call(i,a,o,sy)}},get:function(e){var i=sy.filter(function(n){return n[0]===e})[0];return i&&i[1]},has:function(e){return!!Uz.get(e)},keys:function(){return sy.map(function(e){var i=xN(e,1),n=i[0];return n})},values:function(){return sy.map(function(e){var i=xN(e,2),n=i[1];return n})}};FP.default=(0,wIe.default)(Uz,Uz.entries());var hx={},NP={},BP={};Object.defineProperty(BP,"__esModule",{value:!0});BP.default=void 0;var TIe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]};BP.default=TIe;var zP={};Object.defineProperty(zP,"__esModule",{value:!0});zP.default=void 0;var RIe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]};zP.default=RIe;var VP={};Object.defineProperty(VP,"__esModule",{value:!0});VP.default=void 0;var PIe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null},relatedConcepts:[{concept:{name:"input"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]};VP.default=PIe;var GP={};Object.defineProperty(GP,"__esModule",{value:!0});GP.default=void 0;var EIe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};GP.default=EIe;var UP={};Object.defineProperty(UP,"__esModule",{value:!0});UP.default=void 0;var AIe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuemax":null,"aria-valuemin":null,"aria-valuenow":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};UP.default=AIe;var HP={};Object.defineProperty(HP,"__esModule",{value:!0});HP.default=void 0;var IIe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{"aria-atomic":null,"aria-busy":null,"aria-controls":null,"aria-current":null,"aria-describedby":null,"aria-details":null,"aria-dropeffect":null,"aria-flowto":null,"aria-grabbed":null,"aria-hidden":null,"aria-keyshortcuts":null,"aria-label":null,"aria-labelledby":null,"aria-live":null,"aria-owns":null,"aria-relevant":null,"aria-roledescription":null},relatedConcepts:[{concept:{name:"role"},module:"XHTML"},{concept:{name:"type"},module:"Dublin Core"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[]};HP.default=IIe;var $P={};Object.defineProperty($P,"__esModule",{value:!0});$P.default=void 0;var kIe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"frontmatter"},module:"DTB"},{concept:{name:"level"},module:"DTB"},{concept:{name:"level"},module:"SMIL"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};$P.default=kIe;var WP={};Object.defineProperty(WP,"__esModule",{value:!0});WP.default=void 0;var DIe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};WP.default=DIe;var qP={};Object.defineProperty(qP,"__esModule",{value:!0});qP.default=void 0;var LIe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","structure","section","group"]]};qP.default=LIe;var jP={};Object.defineProperty(jP,"__esModule",{value:!0});jP.default=void 0;var FIe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]};jP.default=FIe;var QP={};Object.defineProperty(QP,"__esModule",{value:!0});QP.default=void 0;var NIe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]};QP.default=NIe;var ZP={};Object.defineProperty(ZP,"__esModule",{value:!0});ZP.default=void 0;var BIe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-modal":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]};ZP.default=BIe;Object.defineProperty(NP,"__esModule",{value:!0});NP.default=void 0;var zIe=Kc(BP),VIe=Kc(zP),GIe=Kc(VP),UIe=Kc(GP),HIe=Kc(UP),$Ie=Kc(HP),WIe=Kc($P),qIe=Kc(WP),jIe=Kc(qP),QIe=Kc(jP),ZIe=Kc(QP),XIe=Kc(ZP);function Kc(t){return t&&t.__esModule?t:{default:t}}var KIe=[["command",zIe.default],["composite",VIe.default],["input",GIe.default],["landmark",UIe.default],["range",HIe.default],["roletype",$Ie.default],["section",WIe.default],["sectionhead",qIe.default],["select",jIe.default],["structure",QIe.default],["widget",ZIe.default],["window",XIe.default]];NP.default=KIe;var XP={},KP={};Object.defineProperty(KP,"__esModule",{value:!0});KP.default=void 0;var YIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-atomic":"true","aria-live":"assertive"},relatedConcepts:[{concept:{name:"alert"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};KP.default=YIe;var YP={};Object.defineProperty(YP,"__esModule",{value:!0});YP.default=void 0;var JIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"alert"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","alert"],["roletype","window","dialog"]]};YP.default=JIe;var JP={};Object.defineProperty(JP,"__esModule",{value:!0});JP.default=void 0;var eke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"Device Independence Delivery Unit"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};JP.default=eke;var eE={};Object.defineProperty(eE,"__esModule",{value:!0});eE.default=void 0;var tke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"article"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","document"]]};eE.default=tke;var tE={};Object.defineProperty(tE,"__esModule",{value:!0});tE.default=void 0;var ike={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{constraints:["scoped to the body element"],name:"header"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};tE.default=ike;var iE={};Object.defineProperty(iE,"__esModule",{value:!0});iE.default=void 0;var nke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"blockquote"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};iE.default=nke;var nE={};Object.defineProperty(nE,"__esModule",{value:!0});nE.default=void 0;var rke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-pressed":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"button"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"image"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"reset"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"submit"}],name:"input"},module:"HTML"},{concept:{name:"button"},module:"HTML"},{concept:{name:"trigger"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]};nE.default=rke;var rE={};Object.defineProperty(rE,"__esModule",{value:!0});rE.default=void 0;var ske={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"caption"},module:"HTML"}],requireContextRole:["figure","grid","table"],requiredContextRole:["figure","grid","table"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};rE.default=ske;var sE={};Object.defineProperty(sE,"__esModule",{value:!0});sE.default=void 0;var oke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-colindex":null,"aria-colspan":null,"aria-rowindex":null,"aria-rowspan":null},relatedConcepts:[{concept:{constraints:["ancestor table element has table role"],name:"td"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};sE.default=oke;var oE={};Object.defineProperty(oE,"__esModule",{value:!0});oE.default=void 0;var ake={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-errormessage":null,"aria-expanded":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"checkbox"}],name:"input"},module:"HTML"},{concept:{name:"option"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input"]]};oE.default=ake;var aE={};Object.defineProperty(aE,"__esModule",{value:!0});aE.default=void 0;var lke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"code"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};aE.default=lke;var lE={};Object.defineProperty(lE,"__esModule",{value:!0});lE.default=void 0;var cke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-sort":null},relatedConcepts:[{concept:{name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"col"}],name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"colgroup"}],name:"th"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","structure","section","cell","gridcell"],["roletype","widget","gridcell"],["roletype","structure","sectionhead"]]};lE.default=cke;var cE={};Object.defineProperty(cE,"__esModule",{value:!0});cE.default=void 0;var uke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-autocomplete":null,"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-expanded":"false","aria-haspopup":"listbox"},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"email"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"search"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"tel"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"text"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"url"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"url"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"multiple"},{constraints:["undefined"],name:"size"}],constraints:["the multiple attribute is not set and the size attribute does not have a value greater than 1"],name:"select"},module:"HTML"},{concept:{name:"select"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-controls":null,"aria-expanded":"false"},superClass:[["roletype","widget","input"]]};cE.default=uke;var uE={};Object.defineProperty(uE,"__esModule",{value:!0});uE.default=void 0;var hke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{constraints:["scoped to the body element","scoped to the main element"],name:"aside"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-label"}],constraints:["scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"aside"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],constraints:["scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"aside"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};uE.default=hke;var hE={};Object.defineProperty(hE,"__esModule",{value:!0});hE.default=void 0;var dke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{constraints:["scoped to the body element"],name:"footer"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};hE.default=dke;var dE={};Object.defineProperty(dE,"__esModule",{value:!0});dE.default=void 0;var fke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dd"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};dE.default=fke;var fE={};Object.defineProperty(fE,"__esModule",{value:!0});fE.default=void 0;var pke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"del"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};fE.default=pke;var pE={};Object.defineProperty(pE,"__esModule",{value:!0});pE.default=void 0;var mke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dialog"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","window"]]};pE.default=mke;var mE={};Object.defineProperty(mE,"__esModule",{value:!0});mE.default=void 0;var gke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{module:"DAISY Guide"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","list"]]};mE.default=gke;var gE={};Object.defineProperty(gE,"__esModule",{value:!0});gE.default=void 0;var vke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"Device Independence Delivery Unit"}},{concept:{name:"html"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};gE.default=vke;var vE={};Object.defineProperty(vE,"__esModule",{value:!0});vE.default=void 0;var yke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"em"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};vE.default=yke;var yE={};Object.defineProperty(yE,"__esModule",{value:!0});yE.default=void 0;var xke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["article"]],requiredProps:{},superClass:[["roletype","structure","section","list"]]};yE.default=xke;var xE={};Object.defineProperty(xE,"__esModule",{value:!0});xE.default=void 0;var bke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"figure"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};xE.default=bke;var bE={};Object.defineProperty(bE,"__esModule",{value:!0});bE.default=void 0;var wke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"aria-label"}],name:"form"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],name:"form"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"name"}],name:"form"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};bE.default=wke;var wE={};Object.defineProperty(wE,"__esModule",{value:!0});wE.default=void 0;var _ke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"a"},module:"HTML"},{concept:{name:"area"},module:"HTML"},{concept:{name:"aside"},module:"HTML"},{concept:{name:"b"},module:"HTML"},{concept:{name:"bdo"},module:"HTML"},{concept:{name:"body"},module:"HTML"},{concept:{name:"data"},module:"HTML"},{concept:{name:"div"},module:"HTML"},{concept:{constraints:["scoped to the main element","scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"footer"},module:"HTML"},{concept:{constraints:["scoped to the main element","scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"header"},module:"HTML"},{concept:{name:"hgroup"},module:"HTML"},{concept:{name:"i"},module:"HTML"},{concept:{name:"pre"},module:"HTML"},{concept:{name:"q"},module:"HTML"},{concept:{name:"samp"},module:"HTML"},{concept:{name:"section"},module:"HTML"},{concept:{name:"small"},module:"HTML"},{concept:{name:"span"},module:"HTML"},{concept:{name:"u"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};wE.default=_ke;var _E={};Object.defineProperty(_E,"__esModule",{value:!0});_E.default=void 0;var Cke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-multiselectable":null,"aria-readonly":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","structure","section","table"]]};_E.default=Cke;var CE={};Object.defineProperty(CE,"__esModule",{value:!0});CE.default=void 0;var Ske={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-selected":null},relatedConcepts:[{concept:{constraints:["ancestor table element has grid role","ancestor table element has treegrid role"],name:"td"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","widget"]]};CE.default=Ske;var SE={};Object.defineProperty(SE,"__esModule",{value:!0});SE.default=void 0;var Oke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null},relatedConcepts:[{concept:{name:"details"},module:"HTML"},{concept:{name:"fieldset"},module:"HTML"},{concept:{name:"optgroup"},module:"HTML"},{concept:{name:"address"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};SE.default=Oke;var OE={};Object.defineProperty(OE,"__esModule",{value:!0});OE.default=void 0;var Mke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-level":"2"},relatedConcepts:[{concept:{name:"h1"},module:"HTML"},{concept:{name:"h2"},module:"HTML"},{concept:{name:"h3"},module:"HTML"},{concept:{name:"h4"},module:"HTML"},{concept:{name:"h5"},module:"HTML"},{concept:{name:"h6"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-level":"2"},superClass:[["roletype","structure","sectionhead"]]};OE.default=Mke;var ME={};Object.defineProperty(ME,"__esModule",{value:!0});ME.default=void 0;var Tke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"alt"}],name:"img"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"alt"}],name:"img"},module:"HTML"},{concept:{name:"imggroup"},module:"DTB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};ME.default=Tke;var TE={};Object.defineProperty(TE,"__esModule",{value:!0});TE.default=void 0;var Rke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"ins"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};TE.default=Rke;var RE={};Object.defineProperty(RE,"__esModule",{value:!0});RE.default=void 0;var Pke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"href"}],name:"a"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"href"}],name:"area"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]};RE.default=Pke;var PE={};Object.defineProperty(PE,"__esModule",{value:!0});PE.default=void 0;var Eke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menu"},module:"HTML"},{concept:{name:"ol"},module:"HTML"},{concept:{name:"ul"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["listitem"]],requiredProps:{},superClass:[["roletype","structure","section"]]};PE.default=Eke;var EE={};Object.defineProperty(EE,"__esModule",{value:!0});EE.default=void 0;var Ake={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-invalid":null,"aria-multiselectable":null,"aria-readonly":null,"aria-required":null,"aria-orientation":"vertical"},relatedConcepts:[{concept:{attributes:[{constraints:[">1"],name:"size"}],constraints:["the size attribute value is greater than 1"],name:"select"},module:"HTML"},{concept:{attributes:[{name:"multiple"}],name:"select"},module:"HTML"},{concept:{name:"datalist"},module:"HTML"},{concept:{name:"list"},module:"ARIA"},{concept:{name:"select"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["option","group"],["option"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]};EE.default=Ake;var AE={};Object.defineProperty(AE,"__esModule",{value:!0});AE.default=void 0;var Ike={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-level":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{constraints:["direct descendant of ol","direct descendant of ul","direct descendant of menu"],name:"li"},module:"HTML"},{concept:{name:"item"},module:"XForms"}],requireContextRole:["directory","list"],requiredContextRole:["directory","list"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};AE.default=Ike;var IE={};Object.defineProperty(IE,"__esModule",{value:!0});IE.default=void 0;var kke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-live":"polite"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};IE.default=kke;var kE={};Object.defineProperty(kE,"__esModule",{value:!0});kE.default=void 0;var Dke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"main"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};kE.default=Dke;var DE={};Object.defineProperty(DE,"__esModule",{value:!0});DE.default=void 0;var Lke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:[],props:{"aria-braillelabel":null,"aria-brailleroledescription":null,"aria-description":null},relatedConcepts:[{concept:{name:"mark"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};DE.default=Lke;var LE={};Object.defineProperty(LE,"__esModule",{value:!0});LE.default=void 0;var Fke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};LE.default=Fke;var FE={};Object.defineProperty(FE,"__esModule",{value:!0});FE.default=void 0;var Nke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"math"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};FE.default=Nke;var NE={};Object.defineProperty(NE,"__esModule",{value:!0});NE.default=void 0;var Bke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"vertical"},relatedConcepts:[{concept:{name:"MENU"},module:"JAPI"},{concept:{name:"list"},module:"ARIA"},{concept:{name:"select"},module:"XForms"},{concept:{name:"sidebar"},module:"DTB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["menuitem","group"],["menuitemradio","group"],["menuitemcheckbox","group"],["menuitem"],["menuitemcheckbox"],["menuitemradio"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]};NE.default=Bke;var BE={};Object.defineProperty(BE,"__esModule",{value:!0});BE.default=void 0;var zke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"horizontal"},relatedConcepts:[{concept:{name:"toolbar"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["menuitem","group"],["menuitemradio","group"],["menuitemcheckbox","group"],["menuitem"],["menuitemcheckbox"],["menuitemradio"]],requiredProps:{},superClass:[["roletype","widget","composite","select","menu"],["roletype","structure","section","group","select","menu"]]};BE.default=zke;var zE={};Object.defineProperty(zE,"__esModule",{value:!0});zE.default=void 0;var Vke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"MENU_ITEM"},module:"JAPI"},{concept:{name:"listitem"},module:"ARIA"},{concept:{name:"option"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]};zE.default=Vke;var VE={};Object.defineProperty(VE,"__esModule",{value:!0});VE.default=void 0;var Gke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menuitem"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox"],["roletype","widget","command","menuitem"]]};VE.default=Gke;var GE={};Object.defineProperty(GE,"__esModule",{value:!0});GE.default=void 0;var Uke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menuitem"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox","menuitemcheckbox"],["roletype","widget","command","menuitem","menuitemcheckbox"],["roletype","widget","input","radio"]]};GE.default=Uke;var UE={};Object.defineProperty(UE,"__esModule",{value:!0});UE.default=void 0;var Hke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuetext":null,"aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[{concept:{name:"meter"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-valuenow":null},superClass:[["roletype","structure","range"]]};UE.default=Hke;var HE={};Object.defineProperty(HE,"__esModule",{value:!0});HE.default=void 0;var $ke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"nav"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};HE.default=$ke;var $E={};Object.defineProperty($E,"__esModule",{value:!0});$E.default=void 0;var Wke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[]};$E.default=Wke;var WE={};Object.defineProperty(WE,"__esModule",{value:!0});WE.default=void 0;var qke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};WE.default=qke;var qE={};Object.defineProperty(qE,"__esModule",{value:!0});qE.default=void 0;var jke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-posinset":null,"aria-setsize":null,"aria-selected":"false"},relatedConcepts:[{concept:{name:"item"},module:"XForms"},{concept:{name:"listitem"},module:"ARIA"},{concept:{name:"option"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-selected":"false"},superClass:[["roletype","widget","input"]]};qE.default=jke;var jE={};Object.defineProperty(jE,"__esModule",{value:!0});jE.default=void 0;var Qke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"p"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};jE.default=Qke;var QE={};Object.defineProperty(QE,"__esModule",{value:!0});QE.default=void 0;var Zke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{attributes:[{name:"alt",value:""}],name:"img"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};QE.default=Zke;var ZE={};Object.defineProperty(ZE,"__esModule",{value:!0});ZE.default=void 0;var Xke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuetext":null},relatedConcepts:[{concept:{name:"progress"},module:"HTML"},{concept:{name:"status"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","range"],["roletype","widget"]]};ZE.default=Xke;var XE={};Object.defineProperty(XE,"__esModule",{value:!0});XE.default=void 0;var Kke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"radio"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input"]]};XE.default=Kke;var KE={};Object.defineProperty(KE,"__esModule",{value:!0});KE.default=void 0;var Yke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{name:"list"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["radio"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]};KE.default=Yke;var YE={};Object.defineProperty(YE,"__esModule",{value:!0});YE.default=void 0;var Jke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"aria-label"}],name:"section"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],name:"section"},module:"HTML"},{concept:{name:"Device Independence Glossart perceivable unit"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};YE.default=Jke;var JE={};Object.defineProperty(JE,"__esModule",{value:!0});JE.default=void 0;var eDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-colindex":null,"aria-expanded":null,"aria-level":null,"aria-posinset":null,"aria-rowindex":null,"aria-selected":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"tr"},module:"HTML"}],requireContextRole:["grid","rowgroup","table","treegrid"],requiredContextRole:["grid","rowgroup","table","treegrid"],requiredOwnedElements:[["cell"],["columnheader"],["gridcell"],["rowheader"]],requiredProps:{},superClass:[["roletype","structure","section","group"],["roletype","widget"]]};JE.default=eDe;var eA={};Object.defineProperty(eA,"__esModule",{value:!0});eA.default=void 0;var tDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"tbody"},module:"HTML"},{concept:{name:"tfoot"},module:"HTML"},{concept:{name:"thead"},module:"HTML"}],requireContextRole:["grid","table","treegrid"],requiredContextRole:["grid","table","treegrid"],requiredOwnedElements:[["row"]],requiredProps:{},superClass:[["roletype","structure"]]};eA.default=tDe;var tA={};Object.defineProperty(tA,"__esModule",{value:!0});tA.default=void 0;var iDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-sort":null},relatedConcepts:[{concept:{attributes:[{name:"scope",value:"row"}],name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"rowgroup"}],name:"th"},module:"HTML"}],requireContextRole:["row","rowgroup"],requiredContextRole:["row","rowgroup"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","structure","section","cell","gridcell"],["roletype","widget","gridcell"],["roletype","structure","sectionhead"]]};tA.default=iDe;var iA={};Object.defineProperty(iA,"__esModule",{value:!0});iA.default=void 0;var nDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-valuetext":null,"aria-orientation":"vertical","aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-controls":null,"aria-valuenow":null},superClass:[["roletype","structure","range"],["roletype","widget"]]};iA.default=nDe;var nA={};Object.defineProperty(nA,"__esModule",{value:!0});nA.default=void 0;var rDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};nA.default=rDe;var rA={};Object.defineProperty(rA,"__esModule",{value:!0});rA.default=void 0;var sDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"search"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","input","textbox"]]};rA.default=sDe;var sA={};Object.defineProperty(sA,"__esModule",{value:!0});sA.default=void 0;var oDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-orientation":"horizontal","aria-valuemax":"100","aria-valuemin":"0","aria-valuenow":null,"aria-valuetext":null},relatedConcepts:[{concept:{name:"hr"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]};sA.default=oDe;var oA={};Object.defineProperty(oA,"__esModule",{value:!0});oA.default=void 0;var aDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null,"aria-readonly":null,"aria-valuetext":null,"aria-orientation":"horizontal","aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[{concept:{attributes:[{name:"type",value:"range"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-valuenow":null},superClass:[["roletype","widget","input"],["roletype","structure","range"]]};oA.default=aDe;var aA={};Object.defineProperty(aA,"__esModule",{value:!0});aA.default=void 0;var lDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-valuetext":null,"aria-valuenow":"0"},relatedConcepts:[{concept:{attributes:[{name:"type",value:"number"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","widget","input"],["roletype","structure","range"]]};aA.default=lDe;var lA={};Object.defineProperty(lA,"__esModule",{value:!0});lA.default=void 0;var cDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-atomic":"true","aria-live":"polite"},relatedConcepts:[{concept:{name:"output"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};lA.default=cDe;var cA={};Object.defineProperty(cA,"__esModule",{value:!0});cA.default=void 0;var uDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"strong"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};cA.default=uDe;var uA={};Object.defineProperty(uA,"__esModule",{value:!0});uA.default=void 0;var hDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"sub"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};uA.default=hDe;var hA={};Object.defineProperty(hA,"__esModule",{value:!0});hA.default=void 0;var dDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"sup"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};hA.default=dDe;var dA={};Object.defineProperty(dA,"__esModule",{value:!0});dA.default=void 0;var fDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"button"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox"]]};dA.default=fDe;var fA={};Object.defineProperty(fA,"__esModule",{value:!0});fA.default=void 0;var pDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-posinset":null,"aria-setsize":null,"aria-selected":"false"},relatedConcepts:[],requireContextRole:["tablist"],requiredContextRole:["tablist"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","sectionhead"],["roletype","widget"]]};fA.default=pDe;var pA={};Object.defineProperty(pA,"__esModule",{value:!0});pA.default=void 0;var mDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-colcount":null,"aria-rowcount":null},relatedConcepts:[{concept:{name:"table"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","structure","section"]]};pA.default=mDe;var mA={};Object.defineProperty(mA,"__esModule",{value:!0});mA.default=void 0;var gDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-level":null,"aria-multiselectable":null,"aria-orientation":"horizontal"},relatedConcepts:[{module:"DAISY",concept:{name:"guide"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["tab"]],requiredProps:{},superClass:[["roletype","widget","composite"]]};mA.default=gDe;var gA={};Object.defineProperty(gA,"__esModule",{value:!0});gA.default=void 0;var vDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};gA.default=vDe;var vA={};Object.defineProperty(vA,"__esModule",{value:!0});vA.default=void 0;var yDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dfn"},module:"HTML"},{concept:{name:"dt"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};vA.default=yDe;var yA={};Object.defineProperty(yA,"__esModule",{value:!0});yA.default=void 0;var xDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-autocomplete":null,"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null,"aria-multiline":null,"aria-placeholder":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{attributes:[{constraints:["undefined"],name:"type"},{constraints:["undefined"],name:"list"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"email"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"tel"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"text"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"url"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{name:"input"},module:"XForms"},{concept:{name:"textarea"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","input"]]};yA.default=xDe;var xA={};Object.defineProperty(xA,"__esModule",{value:!0});xA.default=void 0;var bDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"time"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};xA.default=bDe;var bA={};Object.defineProperty(bA,"__esModule",{value:!0});bA.default=void 0;var wDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","status"]]};bA.default=wDe;var wA={};Object.defineProperty(wA,"__esModule",{value:!0});wA.default=void 0;var _De={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"horizontal"},relatedConcepts:[{concept:{name:"menubar"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","group"]]};wA.default=_De;var _A={};Object.defineProperty(_A,"__esModule",{value:!0});_A.default=void 0;var CDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};_A.default=CDe;var CA={};Object.defineProperty(CA,"__esModule",{value:!0});CA.default=void 0;var SDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-multiselectable":null,"aria-required":null,"aria-orientation":"vertical"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["treeitem","group"],["treeitem"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]};CA.default=SDe;var SA={};Object.defineProperty(SA,"__esModule",{value:!0});SA.default=void 0;var ODe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","widget","composite","grid"],["roletype","structure","section","table","grid"],["roletype","widget","composite","select","tree"],["roletype","structure","section","group","select","tree"]]};SA.default=ODe;var OA={};Object.defineProperty(OA,"__esModule",{value:!0});OA.default=void 0;var MDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-expanded":null,"aria-haspopup":null},relatedConcepts:[],requireContextRole:["group","tree"],requiredContextRole:["group","tree"],requiredOwnedElements:[],requiredProps:{"aria-selected":null},superClass:[["roletype","structure","section","listitem"],["roletype","widget","input","option"]]};OA.default=MDe;Object.defineProperty(XP,"__esModule",{value:!0});XP.default=void 0;var TDe=yi(KP),RDe=yi(YP),PDe=yi(JP),EDe=yi(eE),ADe=yi(tE),IDe=yi(iE),kDe=yi(nE),DDe=yi(rE),LDe=yi(sE),FDe=yi(oE),NDe=yi(aE),BDe=yi(lE),zDe=yi(cE),VDe=yi(uE),GDe=yi(hE),UDe=yi(dE),HDe=yi(fE),$De=yi(pE),WDe=yi(mE),qDe=yi(gE),jDe=yi(vE),QDe=yi(yE),ZDe=yi(xE),XDe=yi(bE),KDe=yi(wE),YDe=yi(_E),JDe=yi(CE),eLe=yi(SE),tLe=yi(OE),iLe=yi(ME),nLe=yi(TE),rLe=yi(RE),sLe=yi(PE),oLe=yi(EE),aLe=yi(AE),lLe=yi(IE),cLe=yi(kE),uLe=yi(DE),hLe=yi(LE),dLe=yi(FE),fLe=yi(NE),pLe=yi(BE),mLe=yi(zE),gLe=yi(VE),vLe=yi(GE),yLe=yi(UE),xLe=yi(HE),bLe=yi($E),wLe=yi(WE),_Le=yi(qE),CLe=yi(jE),SLe=yi(QE),OLe=yi(ZE),MLe=yi(XE),TLe=yi(KE),RLe=yi(YE),PLe=yi(JE),ELe=yi(eA),ALe=yi(tA),ILe=yi(iA),kLe=yi(nA),DLe=yi(rA),LLe=yi(sA),FLe=yi(oA),NLe=yi(aA),BLe=yi(lA),zLe=yi(cA),VLe=yi(uA),GLe=yi(hA),ULe=yi(dA),HLe=yi(fA),$Le=yi(pA),WLe=yi(mA),qLe=yi(gA),jLe=yi(vA),QLe=yi(yA),ZLe=yi(xA),XLe=yi(bA),KLe=yi(wA),YLe=yi(_A),JLe=yi(CA),e2e=yi(SA),t2e=yi(OA);function yi(t){return t&&t.__esModule?t:{default:t}}var i2e=[["alert",TDe.default],["alertdialog",RDe.default],["application",PDe.default],["article",EDe.default],["banner",ADe.default],["blockquote",IDe.default],["button",kDe.default],["caption",DDe.default],["cell",LDe.default],["checkbox",FDe.default],["code",NDe.default],["columnheader",BDe.default],["combobox",zDe.default],["complementary",VDe.default],["contentinfo",GDe.default],["definition",UDe.default],["deletion",HDe.default],["dialog",$De.default],["directory",WDe.default],["document",qDe.default],["emphasis",jDe.default],["feed",QDe.default],["figure",ZDe.default],["form",XDe.default],["generic",KDe.default],["grid",YDe.default],["gridcell",JDe.default],["group",eLe.default],["heading",tLe.default],["img",iLe.default],["insertion",nLe.default],["link",rLe.default],["list",sLe.default],["listbox",oLe.default],["listitem",aLe.default],["log",lLe.default],["main",cLe.default],["mark",uLe.default],["marquee",hLe.default],["math",dLe.default],["menu",fLe.default],["menubar",pLe.default],["menuitem",mLe.default],["menuitemcheckbox",gLe.default],["menuitemradio",vLe.default],["meter",yLe.default],["navigation",xLe.default],["none",bLe.default],["note",wLe.default],["option",_Le.default],["paragraph",CLe.default],["presentation",SLe.default],["progressbar",OLe.default],["radio",MLe.default],["radiogroup",TLe.default],["region",RLe.default],["row",PLe.default],["rowgroup",ELe.default],["rowheader",ALe.default],["scrollbar",ILe.default],["search",kLe.default],["searchbox",DLe.default],["separator",LLe.default],["slider",FLe.default],["spinbutton",NLe.default],["status",BLe.default],["strong",zLe.default],["subscript",VLe.default],["superscript",GLe.default],["switch",ULe.default],["tab",HLe.default],["table",$Le.default],["tablist",WLe.default],["tabpanel",qLe.default],["term",jLe.default],["textbox",QLe.default],["time",ZLe.default],["timer",XLe.default],["toolbar",KLe.default],["tooltip",YLe.default],["tree",JLe.default],["treegrid",e2e.default],["treeitem",t2e.default]];XP.default=i2e;var MA={},TA={};Object.defineProperty(TA,"__esModule",{value:!0});TA.default=void 0;var n2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"abstract [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};TA.default=n2e;var RA={};Object.defineProperty(RA,"__esModule",{value:!0});RA.default=void 0;var r2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"acknowledgments [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};RA.default=r2e;var PA={};Object.defineProperty(PA,"__esModule",{value:!0});PA.default=void 0;var s2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"afterword [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};PA.default=s2e;var EA={};Object.defineProperty(EA,"__esModule",{value:!0});EA.default=void 0;var o2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"appendix [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};EA.default=o2e;var AA={};Object.defineProperty(AA,"__esModule",{value:!0});AA.default=void 0;var a2e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"referrer [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]};AA.default=a2e;var IA={};Object.defineProperty(IA,"__esModule",{value:!0});IA.default=void 0;var l2e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"EPUB biblioentry [EPUB-SSV]"},module:"EPUB"}],requireContextRole:["doc-bibliography"],requiredContextRole:["doc-bibliography"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","listitem"]]};IA.default=l2e;var kA={};Object.defineProperty(kA,"__esModule",{value:!0});kA.default=void 0;var c2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"bibliography [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["doc-biblioentry"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};kA.default=c2e;var DA={};Object.defineProperty(DA,"__esModule",{value:!0});DA.default=void 0;var u2e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"biblioref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]};DA.default=u2e;var LA={};Object.defineProperty(LA,"__esModule",{value:!0});LA.default=void 0;var h2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"chapter [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};LA.default=h2e;var FA={};Object.defineProperty(FA,"__esModule",{value:!0});FA.default=void 0;var d2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"colophon [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};FA.default=d2e;var NA={};Object.defineProperty(NA,"__esModule",{value:!0});NA.default=void 0;var f2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"conclusion [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};NA.default=f2e;var BA={};Object.defineProperty(BA,"__esModule",{value:!0});BA.default=void 0;var p2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"cover [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","img"]]};BA.default=p2e;var zA={};Object.defineProperty(zA,"__esModule",{value:!0});zA.default=void 0;var m2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"credit [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};zA.default=m2e;var VA={};Object.defineProperty(VA,"__esModule",{value:!0});VA.default=void 0;var g2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"credits [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};VA.default=g2e;var GA={};Object.defineProperty(GA,"__esModule",{value:!0});GA.default=void 0;var v2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"dedication [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};GA.default=v2e;var UA={};Object.defineProperty(UA,"__esModule",{value:!0});UA.default=void 0;var y2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"rearnote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:["doc-endnotes"],requiredContextRole:["doc-endnotes"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","listitem"]]};UA.default=y2e;var HA={};Object.defineProperty(HA,"__esModule",{value:!0});HA.default=void 0;var x2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"rearnotes [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["doc-endnote"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};HA.default=x2e;var $A={};Object.defineProperty($A,"__esModule",{value:!0});$A.default=void 0;var b2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"epigraph [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};$A.default=b2e;var WA={};Object.defineProperty(WA,"__esModule",{value:!0});WA.default=void 0;var w2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"epilogue [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};WA.default=w2e;var qA={};Object.defineProperty(qA,"__esModule",{value:!0});qA.default=void 0;var _2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"errata [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};qA.default=_2e;var jA={};Object.defineProperty(jA,"__esModule",{value:!0});jA.default=void 0;var C2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};jA.default=C2e;var QA={};Object.defineProperty(QA,"__esModule",{value:!0});QA.default=void 0;var S2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"footnote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};QA.default=S2e;var ZA={};Object.defineProperty(ZA,"__esModule",{value:!0});ZA.default=void 0;var O2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"foreword [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};ZA.default=O2e;var XA={};Object.defineProperty(XA,"__esModule",{value:!0});XA.default=void 0;var M2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"glossary [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["definition"],["term"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};XA.default=M2e;var KA={};Object.defineProperty(KA,"__esModule",{value:!0});KA.default=void 0;var T2e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"glossref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]};KA.default=T2e;var YA={};Object.defineProperty(YA,"__esModule",{value:!0});YA.default=void 0;var R2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"index [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]};YA.default=R2e;var JA={};Object.defineProperty(JA,"__esModule",{value:!0});JA.default=void 0;var P2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"introduction [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};JA.default=P2e;var eI={};Object.defineProperty(eI,"__esModule",{value:!0});eI.default=void 0;var E2e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"noteref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]};eI.default=E2e;var tI={};Object.defineProperty(tI,"__esModule",{value:!0});tI.default=void 0;var A2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"notice [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","note"]]};tI.default=A2e;var iI={};Object.defineProperty(iI,"__esModule",{value:!0});iI.default=void 0;var I2e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"pagebreak [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","separator"]]};iI.default=I2e;var nI={};Object.defineProperty(nI,"__esModule",{value:!0});nI.default=void 0;var k2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:[],props:{"aria-braillelabel":null,"aria-brailleroledescription":null,"aria-description":null,"aria-disabled":null,"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};nI.default=k2e;var rI={};Object.defineProperty(rI,"__esModule",{value:!0});rI.default=void 0;var D2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:[],props:{"aria-braillelabel":null,"aria-brailleroledescription":null,"aria-description":null,"aria-disabled":null,"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};rI.default=D2e;var sI={};Object.defineProperty(sI,"__esModule",{value:!0});sI.default=void 0;var L2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"page-list [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]};sI.default=L2e;var oI={};Object.defineProperty(oI,"__esModule",{value:!0});oI.default=void 0;var F2e={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"part [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};oI.default=F2e;var aI={};Object.defineProperty(aI,"__esModule",{value:!0});aI.default=void 0;var N2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"preface [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};aI.default=N2e;var lI={};Object.defineProperty(lI,"__esModule",{value:!0});lI.default=void 0;var B2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"prologue [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]};lI.default=B2e;var cI={};Object.defineProperty(cI,"__esModule",{value:!0});cI.default=void 0;var z2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"pullquote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["none"]]};cI.default=z2e;var uI={};Object.defineProperty(uI,"__esModule",{value:!0});uI.default=void 0;var V2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"qna [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]};uI.default=V2e;var hI={};Object.defineProperty(hI,"__esModule",{value:!0});hI.default=void 0;var G2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"subtitle [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","sectionhead"]]};hI.default=G2e;var dI={};Object.defineProperty(dI,"__esModule",{value:!0});dI.default=void 0;var U2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"help [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","note"]]};dI.default=U2e;var fI={};Object.defineProperty(fI,"__esModule",{value:!0});fI.default=void 0;var H2e={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"toc [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]};fI.default=H2e;Object.defineProperty(MA,"__esModule",{value:!0});MA.default=void 0;var $2e=Bn(TA),W2e=Bn(RA),q2e=Bn(PA),j2e=Bn(EA),Q2e=Bn(AA),Z2e=Bn(IA),X2e=Bn(kA),K2e=Bn(DA),Y2e=Bn(LA),J2e=Bn(FA),eFe=Bn(NA),tFe=Bn(BA),iFe=Bn(zA),nFe=Bn(VA),rFe=Bn(GA),sFe=Bn(UA),oFe=Bn(HA),aFe=Bn($A),lFe=Bn(WA),cFe=Bn(qA),uFe=Bn(jA),hFe=Bn(QA),dFe=Bn(ZA),fFe=Bn(XA),pFe=Bn(KA),mFe=Bn(YA),gFe=Bn(JA),vFe=Bn(eI),yFe=Bn(tI),xFe=Bn(iI),bFe=Bn(nI),wFe=Bn(rI),_Fe=Bn(sI),CFe=Bn(oI),SFe=Bn(aI),OFe=Bn(lI),MFe=Bn(cI),TFe=Bn(uI),RFe=Bn(hI),PFe=Bn(dI),EFe=Bn(fI);function Bn(t){return t&&t.__esModule?t:{default:t}}var AFe=[["doc-abstract",$2e.default],["doc-acknowledgments",W2e.default],["doc-afterword",q2e.default],["doc-appendix",j2e.default],["doc-backlink",Q2e.default],["doc-biblioentry",Z2e.default],["doc-bibliography",X2e.default],["doc-biblioref",K2e.default],["doc-chapter",Y2e.default],["doc-colophon",J2e.default],["doc-conclusion",eFe.default],["doc-cover",tFe.default],["doc-credit",iFe.default],["doc-credits",nFe.default],["doc-dedication",rFe.default],["doc-endnote",sFe.default],["doc-endnotes",oFe.default],["doc-epigraph",aFe.default],["doc-epilogue",lFe.default],["doc-errata",cFe.default],["doc-example",uFe.default],["doc-footnote",hFe.default],["doc-foreword",dFe.default],["doc-glossary",fFe.default],["doc-glossref",pFe.default],["doc-index",mFe.default],["doc-introduction",gFe.default],["doc-noteref",vFe.default],["doc-notice",yFe.default],["doc-pagebreak",xFe.default],["doc-pagefooter",bFe.default],["doc-pageheader",wFe.default],["doc-pagelist",_Fe.default],["doc-part",CFe.default],["doc-preface",SFe.default],["doc-prologue",OFe.default],["doc-pullquote",MFe.default],["doc-qna",TFe.default],["doc-subtitle",RFe.default],["doc-tip",PFe.default],["doc-toc",EFe.default]];MA.default=AFe;var pI={},mI={};Object.defineProperty(mI,"__esModule",{value:!0});mI.default=void 0;var IFe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{module:"GRAPHICS",concept:{name:"graphics-object"}},{module:"ARIA",concept:{name:"img"}},{module:"ARIA",concept:{name:"article"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","document"]]};mI.default=IFe;var gI={};Object.defineProperty(gI,"__esModule",{value:!0});gI.default=void 0;var kFe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{module:"GRAPHICS",concept:{name:"graphics-document"}},{module:"ARIA",concept:{name:"group"}},{module:"ARIA",concept:{name:"img"}},{module:"GRAPHICS",concept:{name:"graphics-symbol"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","group"]]};gI.default=kFe;var vI={};Object.defineProperty(vI,"__esModule",{value:!0});vI.default=void 0;var DFe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","img"]]};vI.default=DFe;Object.defineProperty(pI,"__esModule",{value:!0});pI.default=void 0;var LFe=ZU(mI),FFe=ZU(gI),NFe=ZU(vI);function ZU(t){return t&&t.__esModule?t:{default:t}}var BFe=[["graphics-document",LFe.default],["graphics-object",FFe.default],["graphics-symbol",NFe.default]];pI.default=BFe;Object.defineProperty(hx,"__esModule",{value:!0});hx.default=void 0;var zFe=qC(NP),VFe=qC(XP),GFe=qC(MA),UFe=qC(pI),HFe=qC(iv);function qC(t){return t&&t.__esModule?t:{default:t}}function Hz(t,e){var i=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=Yee(t))||e){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(u){throw u},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var u=i.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{o||i.return==null||i.return()}finally{if(a)throw s}}}}function Jw(t,e){return qFe(t)||WFe(t,e)||Yee(t,e)||$Fe()}function $Fe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yee(t,e){if(t){if(typeof t=="string")return X6(t,e);var i={}.toString.call(t).slice(8,-1);return i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set"?Array.from(t):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?X6(t,e):void 0}}function X6(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function WFe(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var n,r,s,o,a=[],l=!0,u=!1;try{if(s=(i=i.call(t)).next,e===0){if(Object(i)!==i)return;l=!1}else for(;!(l=(n=s.call(i)).done)&&(a.push(n.value),a.length!==e);l=!0);}catch(d){u=!0,r=d}finally{try{if(!l&&i.return!=null&&(o=i.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function qFe(t){if(Array.isArray(t))return t}var Xf=[].concat(zFe.default,VFe.default,GFe.default,UFe.default);Xf.forEach(function(t){var e=Jw(t,2),i=e[1],n=Hz(i.superClass),r;try{for(n.s();!(r=n.n()).done;){var s=r.value,o=Hz(s),a;try{var l=function(){var d=a.value,p=Xf.filter(function(O){var P=Jw(O,1),N=P[0];return N===d})[0];if(p)for(var v=p[1],y=0,w=Object.keys(v.props);y<w.length;y++){var R=w[y];Object.prototype.hasOwnProperty.call(i.props,R)||(i.props[R]=v.props[R])}};for(o.s();!(a=o.n()).done;)l()}catch(u){o.e(u)}finally{o.f()}}}catch(u){n.e(u)}finally{n.f()}});var $z={entries:function(){return Xf},forEach:function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=Hz(Xf),r;try{for(n.s();!(r=n.n()).done;){var s=Jw(r.value,2),o=s[0],a=s[1];e.call(i,a,o,Xf)}}catch(l){n.e(l)}finally{n.f()}},get:function(e){var i=Xf.filter(function(n){return n[0]===e})[0];return i&&i[1]},has:function(e){return!!$z.get(e)},keys:function(){return Xf.map(function(e){var i=Jw(e,1),n=i[0];return n})},values:function(){return Xf.map(function(e){var i=Jw(e,2),n=i[1];return n})}};hx.default=(0,HFe.default)($z,$z.entries());var yI={};Object.defineProperty(yI,"__esModule",{value:!0});yI.default=void 0;var jFe=ete(iv),Jee=ete(hx);function ete(t){return t&&t.__esModule?t:{default:t}}function bN(t,e){return KFe(t)||XFe(t,e)||ZFe(t,e)||QFe()}function QFe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZFe(t,e){if(t){if(typeof t=="string")return K6(t,e);var i={}.toString.call(t).slice(8,-1);return i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set"?Array.from(t):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?K6(t,e):void 0}}function K6(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function XFe(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var n,r,s,o,a=[],l=!0,u=!1;try{if(s=(i=i.call(t)).next,e===0){if(Object(i)!==i)return;l=!1}else for(;!(l=(n=s.call(i)).done)&&(a.push(n.value),a.length!==e);l=!0);}catch(d){u=!0,r=d}finally{try{if(!l&&i.return!=null&&(o=i.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function KFe(t){if(Array.isArray(t))return t}var Kf=[],Y6=Jee.default.keys();for(var wN=0;wN<Y6.length;wN++){var _N=Y6[wN],CN=Jee.default.get(_N);if(CN)for(var J6=[].concat(CN.baseConcepts,CN.relatedConcepts),YFe=function(){var e=J6[SN];if(e.module==="HTML"){var i=e.concept;if(i){var n=Kf.filter(function(a){return JFe(a[0],i)})[0],r;n?r=n[1]:r=[];for(var s=!0,o=0;o<r.length;o++)if(r[o]===_N){s=!1;break}s&&r.push(_N),n||Kf.push([i,r])}}},SN=0;SN<J6.length;SN++)YFe()}var Wz={entries:function(){return Kf},forEach:function(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=0,r=Kf;n<r.length;n++){var s=bN(r[n],2),o=s[0],a=s[1];e.call(i,a,o,Kf)}},get:function(e){var i=Kf.filter(function(n){return e.name===n[0].name&&tte(e.attributes,n[0].attributes)})[0];return i&&i[1]},has:function(e){return!!Wz.get(e)},keys:function(){return Kf.map(function(e){var i=bN(e,1),n=i[0];return n})},values:function(){return Kf.map(function(e){var i=bN(e,2),n=i[1];return n})}};function JFe(t,e){return t.name===e.name&&eNe(t.constraints,e.constraints)&&tte(t.attributes,e.attributes)}function eNe(t,e){if(t===void 0&&e!==void 0||t!==void 0&&e===void 0)return!1;if(t!==void 0&&e!==void 0){if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1}return!0}function tte(t,e){if(t===void 0&&e!==void 0||t!==void 0&&e===void 0)return!1;if(t!==void 0&&e!==void 0){if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++){if(t[i].name!==e[i].name||t[i].value!==e[i].value||t[i].constraints===void 0&&e[i].constraints!==void 0||t[i].constraints!==void 0&&e[i].constraints===void 0)return!1;if(t[i].constraints!==void 0&&e[i].constraints!==void 0){if(t[i].constraints.length!==e[i].constraints.length)return!1;for(var n=0;n<t[i].constraints.length;n++)if(t[i].constraints[n]!==e[i].constraints[n])return!1}}}return!0}yI.default=(0,jFe.default)(Wz,Wz.entries());var xI={};Object.defineProperty(xI,"__esModule",{value:!0});xI.default=void 0;var tNe=nte(iv),ite=nte(hx);function nte(t){return t&&t.__esModule?t:{default:t}}function ON(t,e){return sNe(t)||rNe(t,e)||nNe(t,e)||iNe()}function iNe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nNe(t,e){if(t){if(typeof t=="string")return eq(t,e);var i={}.toString.call(t).slice(8,-1);return i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set"?Array.from(t):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?eq(t,e):void 0}}function eq(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function rNe(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var n,r,s,o,a=[],l=!0,u=!1;try{if(s=(i=i.call(t)).next,e===0){if(Object(i)!==i)return;l=!1}else for(;!(l=(n=s.call(i)).done)&&(a.push(n.value),a.length!==e);l=!0);}catch(d){u=!0,r=d}finally{try{if(!l&&i.return!=null&&(o=i.return(),Object(o)!==o))return}finally{if(u)throw r}}return a}}function sNe(t){if(Array.isArray(t))return t}var Vm=[],tq=ite.default.keys();for(var MN=0;MN<tq.length;MN++){var iq=tq[MN],TN=ite.default.get(iq),RN=[];if(TN){for(var nq=[].concat(TN.baseConcepts,TN.relatedConcepts),PN=0;PN<nq.length;PN++){var rq=nq[PN];if(rq.module==="HTML"){var sq=rq.concept;sq!=null&&RN.push(sq)}}RN.length>0&&Vm.push([iq,RN])}}var qz={entries:function(){return Vm},forEach:function(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=0,r=Vm;n<r.length;n++){var s=ON(r[n],2),o=s[0],a=s[1];e.call(i,a,o,Vm)}},get:function(e){var i=Vm.filter(function(n){return n[0]===e})[0];return i&&i[1]},has:function(e){return!!qz.get(e)},keys:function(){return Vm.map(function(e){var i=ON(e,1),n=i[0];return n})},values:function(){return Vm.map(function(e){var i=ON(e,2),n=i[1];return n})}};xI.default=(0,tNe.default)(qz,qz.entries());var bI;Object.defineProperty(vu,"__esModule",{value:!0});var wI=vu.roles=vu.roleElements=bI=vu.elementRoles=vu.dom=vu.aria=void 0,oNe=jC(DP),aNe=jC(FP),lNe=jC(hx),cNe=jC(yI),uNe=jC(xI);function jC(t){return t&&t.__esModule?t:{default:t}}vu.aria=oNe.default;vu.dom=aNe.default;wI=vu.roles=lNe.default;bI=vu.elementRoles=cNe.default;vu.roleElements=uNe.default;var Sd={},_I={},dx={},CI={};Object.defineProperty(CI,"__esModule",{value:!0});CI.default=void 0;function hNe(){var t=this,e=0,i={"@@iterator":function(){return i},next:function(){if(e<t.length){var r=t[e];return e=e+1,{done:!1,value:r}}else return{done:!0}}};return i}var dNe=hNe;CI.default=dNe;Object.defineProperty(dx,"__esModule",{value:!0});dx.default=mNe;var fNe=pNe(CI);function pNe(t){return t&&t.__esModule?t:{default:t}}function jz(t){"@babel/helpers - typeof";return jz=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jz(t)}function mNe(t,e){return typeof Symbol=="function"&&jz(Symbol.iterator)==="symbol"&&Object.defineProperty(t,Symbol.iterator,{value:fNe.default.bind(e)}),t}var nv={},SI={};Object.defineProperty(SI,"__esModule",{value:!0});SI.default=void 0;var gNe={relatedConcepts:[{module:"HTML",concept:{name:"abbr"}}],type:"structure"},vNe=gNe;SI.default=vNe;var OI={};Object.defineProperty(OI,"__esModule",{value:!0});OI.default=void 0;var yNe={relatedConcepts:[{module:"ARIA",concept:{name:"alertdialog"}}],type:"window"},xNe=yNe;OI.default=xNe;var MI={};Object.defineProperty(MI,"__esModule",{value:!0});MI.default=void 0;var bNe={relatedConcepts:[{module:"ARIA",concept:{name:"alert"}}],type:"structure"},wNe=bNe;MI.default=wNe;var TI={};Object.defineProperty(TI,"__esModule",{value:!0});TI.default=void 0;var _Ne={relatedConcepts:[],type:"structure"},CNe=_Ne;TI.default=CNe;var RI={};Object.defineProperty(RI,"__esModule",{value:!0});RI.default=void 0;var SNe={relatedConcepts:[{module:"ARIA",concept:{name:"application"}}],type:"window"},ONe=SNe;RI.default=ONe;var PI={};Object.defineProperty(PI,"__esModule",{value:!0});PI.default=void 0;var MNe={relatedConcepts:[{module:"ARIA",concept:{name:"article"}},{module:"HTML",concept:{name:"article"}}],type:"structure"},TNe=MNe;PI.default=TNe;var EI={};Object.defineProperty(EI,"__esModule",{value:!0});EI.default=void 0;var RNe={relatedConcepts:[{module:"HTML",concept:{name:"audio"}}],type:"widget"},PNe=RNe;EI.default=PNe;var AI={};Object.defineProperty(AI,"__esModule",{value:!0});AI.default=void 0;var ENe={relatedConcepts:[{module:"ARIA",concept:{name:"banner"}}],type:"structure"},ANe=ENe;AI.default=ANe;var II={};Object.defineProperty(II,"__esModule",{value:!0});II.default=void 0;var INe={relatedConcepts:[{module:"HTML",concept:{name:"blockquote"}}],type:"structure"},kNe=INe;II.default=kNe;var kI={};Object.defineProperty(kI,"__esModule",{value:!0});kI.default=void 0;var DNe={relatedConcepts:[{module:"ARIA",concept:{attributes:[{name:"aria-busy",value:"true"}]}}],type:"widget"},LNe=DNe;kI.default=LNe;var DI={};Object.defineProperty(DI,"__esModule",{value:!0});DI.default=void 0;var FNe={relatedConcepts:[{module:"ARIA",concept:{name:"button"}},{module:"HTML",concept:{name:"button"}}],type:"widget"},NNe=FNe;DI.default=NNe;var LI={};Object.defineProperty(LI,"__esModule",{value:!0});LI.default=void 0;var BNe={relatedConcepts:[{module:"HTML",concept:{name:"canvas"}}],type:"widget"},zNe=BNe;LI.default=zNe;var FI={};Object.defineProperty(FI,"__esModule",{value:!0});FI.default=void 0;var VNe={relatedConcepts:[{module:"HTML",concept:{name:"caption"}}],type:"structure"},GNe=VNe;FI.default=GNe;var NI={};Object.defineProperty(NI,"__esModule",{value:!0});NI.default=void 0;var UNe={relatedConcepts:[{module:"ARIA",concept:{name:"cell"}},{module:"ARIA",concept:{name:"gridcell"}},{module:"HTML",concept:{name:"td"}}],type:"widget"},HNe=UNe;NI.default=HNe;var BI={};Object.defineProperty(BI,"__esModule",{value:!0});BI.default=void 0;var $Ne={relatedConcepts:[{module:"ARIA",concept:{name:"checkbox"}},{module:"HTML",concept:{name:"input",attributes:[{name:"type",value:"checkbox"}]}}],type:"widget"},WNe=$Ne;BI.default=WNe;var zI={};Object.defineProperty(zI,"__esModule",{value:!0});zI.default=void 0;var qNe={relatedConcepts:[{module:"HTML",concept:{name:"input",attributes:[{name:"type",value:"color"}]}}],type:"widget"},jNe=qNe;zI.default=jNe;var VI={};Object.defineProperty(VI,"__esModule",{value:!0});VI.default=void 0;var QNe={relatedConcepts:[{module:"ARIA",concept:{name:"columnheader"}},{module:"HTML",concept:{name:"th"}}],type:"widget"},ZNe=QNe;VI.default=ZNe;var GI={};Object.defineProperty(GI,"__esModule",{value:!0});GI.default=void 0;var XNe={relatedConcepts:[],type:"structure"},KNe=XNe;GI.default=KNe;var UI={};Object.defineProperty(UI,"__esModule",{value:!0});UI.default=void 0;var YNe={relatedConcepts:[{module:"ARIA",concept:{name:"combobox"}},{module:"HTML",concept:{name:"select"}}],type:"widget"},JNe=YNe;UI.default=JNe;var HI={};Object.defineProperty(HI,"__esModule",{value:!0});HI.default=void 0;var eBe={relatedConcepts:[{module:"ARIA",concept:{name:"complementary"}}],type:"structure"},tBe=eBe;HI.default=tBe;var $I={};Object.defineProperty($I,"__esModule",{value:!0});$I.default=void 0;var iBe={relatedConcepts:[{module:"ARIA",concept:{name:"structureinfo"}}],type:"structure"},nBe=iBe;$I.default=nBe;var WI={};Object.defineProperty(WI,"__esModule",{value:!0});WI.default=void 0;var rBe={relatedConcepts:[{module:"HTML",concept:{name:"input",attributes:[{name:"type",value:"date"}]}}],type:"widget"},sBe=rBe;WI.default=sBe;var qI={};Object.defineProperty(qI,"__esModule",{value:!0});qI.default=void 0;var oBe={relatedConcepts:[{module:"HTML",concept:{name:"input",attributes:[{name:"type",value:"datetime"}]}}],type:"widget"},aBe=oBe;qI.default=aBe;var jI={};Object.defineProperty(jI,"__esModule",{value:!0});jI.default=void 0;var lBe={relatedConcepts:[{module:"HTML",concept:{name:"dfn"}}],type:"structure"},cBe=lBe;jI.default=cBe;var QI={};Object.defineProperty(QI,"__esModule",{value:!0});QI.default=void 0;var uBe={relatedConcepts:[{module:"HTML",concept:{name:"dd"}}],type:"structure"},hBe=uBe;QI.default=hBe;var ZI={};Object.defineProperty(ZI,"__esModule",{value:!0});ZI.default=void 0;var dBe={relatedConcepts:[{module:"HTML",concept:{name:"dl"}}],type:"structure"},fBe=dBe;ZI.default=fBe;var XI={};Object.defineProperty(XI,"__esModule",{value:!0});XI.default=void 0;var pBe={relatedConcepts:[{module:"HTML",concept:{name:"dt"}}],type:"structure"},mBe=pBe;XI.default=mBe;var KI={};Object.defineProperty(KI,"__esModule",{value:!0});KI.default=void 0;var gBe={relatedConcepts:[{module:"HTML",concept:{name:"details"}}],type:"structure"},vBe=gBe;KI.default=vBe;var YI={};Object.defineProperty(YI,"__esModule",{value:!0});YI.default=void 0;var yBe={relatedConcepts:[{module:"ARIA",concept:{name:"dialog"}},{module:"HTML",concept:{name:"dialog"}}],type:"window"},xBe=yBe;YI.default=xBe;var JI={};Object.defineProperty(JI,"__esModule",{value:!0});JI.default=void 0;var bBe={relatedConcepts:[{module:"ARIA",concept:{name:"directory"}},{module:"HTML",concept:{name:"dir"}}],type:"structure"},wBe=bBe;JI.default=wBe;var ek={};Object.defineProperty(ek,"__esModule",{value:!0});ek.default=void 0;var _Be={relatedConcepts:[{module:"HTML",concept:{constraints:["scoped to a details element"],name:"summary"}}],type:"widget"},CBe=_Be;ek.default=CBe;var tk={};Object.defineProperty(tk,"__esModule",{value:!0});tk.default=void 0;var SBe={relatedConcepts:[{module:"HTML",concept:{name:"div"}}],type:"generic"},OBe=SBe;tk.default=OBe;var ik={};Object.defineProperty(ik,"__esModule",{value:!0});ik.default=void 0;var MBe={relatedConcepts:[{module:"ARIA",concept:{name:"document"}}],type:"structure"},TBe=MBe;ik.default=TBe;var nk={};Object.defineProperty(nk,"__esModule",{value:!0});nk.default=void 0;var RBe={relatedConcepts:[{module:"HTML",concept:{name:"embed"}}],type:"widget"},PBe=RBe;nk.default=PBe;var rk={};Object.defineProperty(rk,"__esModule",{value:!0});rk.default=void 0;var EBe={relatedConcepts:[{module:"ARIA",concept:{name:"feed"}}],type:"structure"},ABe=EBe;rk.default=ABe;var sk={};Object.defineProperty(sk,"__esModule",{value:!0});sk.default=void 0;var IBe={relatedConcepts:[{module:"HTML",concept:{name:"figcaption"}}],type:"structure"},kBe=IBe;sk.default=kBe;var ok={};Object.defineProperty(ok,"__esModule",{value:!0});ok.default=void 0;var DBe={relatedConcepts:[{module:"ARIA",concept:{name:"figure"}},{module:"HTML",concept:{name:"figure"}}],type:"structure"},LBe=DBe;ok.default=LBe;var ak={};Object.defineProperty(ak,"__esModule",{value:!0});ak.default=void 0;var FBe={relatedConcepts:[{module:"HTML",concept:{name:"footer"}}],type:"structure"},NBe=FBe;ak.default=NBe;var lk={};Object.defineProperty(lk,"__esModule",{value:!0});lk.default=void 0;var BBe={relatedConcepts:[{module:"ARIA",concept:{name:"form"}},{module:"HTML",concept:{name:"form"}}],type:"structure"},zBe=BBe;lk.default=zBe;var ck={};Object.defineProperty(ck,"__esModule",{value:!0});ck.default=void 0;var VBe={relatedConcepts:[{module:"ARIA",concept:{name:"grid"}}],type:"widget"},GBe=VBe;ck.default=GBe;var uk={};Object.defineProperty(uk,"__esModule",{value:!0});uk.default=void 0;var UBe={relatedConcepts:[{module:"ARIA",concept:{name:"group"}}],type:"structure"},HBe=UBe;uk.default=HBe;var hk={};Object.defineProperty(hk,"__esModule",{value:!0});hk.default=void 0;var $Be={relatedConcepts:[{module:"ARIA",concept:{name:"heading"}},{module:"HTML",concept:{name:"h1"}},{module:"HTML",concept:{name:"h2"}},{module:"HTML",concept:{name:"h3"}},{module:"HTML",concept:{name:"h4"}},{module:"HTML",concept:{name:"h5"}},{module:"HTML",concept:{name:"h6"}}],type:"structure"},WBe=$Be;hk.default=WBe;var dk={};Object.defineProperty(dk,"__esModule",{value:!0});dk.default=void 0;var qBe={relatedConcepts:[],type:"window"},jBe=qBe;dk.default=jBe;var fk={};Object.defineProperty(fk,"__esModule",{value:!0});fk.default=void 0;var QBe={relatedConcepts:[{module:"HTML",concept:{name:"iframe"}}],type:"window"},ZBe=QBe;fk.default=ZBe;var pk={};Object.defineProperty(pk,"__esModule",{value:!0});pk.default=void 0;var XBe={relatedConcepts:[],type:"structure"},KBe=XBe;pk.default=KBe;var mk={};Object.defineProperty(mk,"__esModule",{value:!0});mk.default=void 0;var YBe={relatedConcepts:[],type:"widget"},JBe=YBe;mk.default=JBe;var gk={};Object.defineProperty(gk,"__esModule",{value:!0});gk.default=void 0;var e3e={relatedConcepts:[{module:"HTML",concept:{name:"img",attributes:[{name:"usemap"}]}}],type:"structure"},t3e=e3e;gk.default=t3e;var vk={};Object.defineProperty(vk,"__esModule",{value:!0});vk.default=void 0;var i3e={relatedConcepts:[{module:"ARIA",concept:{name:"img"}},{module:"HTML",concept:{name:"img"}}],type:"structure"},n3e=i3e;vk.default=n3e;var yk={};Object.defineProperty(yk,"__esModule",{value:!0});yk.default=void 0;var r3e={relatedConcepts:[{module:"HTML",concept:{name:"input"}}],type:"widget"},s3e=r3e;yk.default=s3e;var xk={};Object.defineProperty(xk,"__esModule",{value:!0});xk.default=void 0;var o3e={relatedConcepts:[{module:"HTML",concept:{name:"input",attributes:[{name:"type",value:"time"}]}}],type:"widget"},a3e=o3e;xk.default=a3e;var bk={};Object.defineProperty(bk,"__esModule",{value:!0});bk.default=void 0;var l3e={relatedConcepts:[{module:"HTML",concept:{name:"label"}}],type:"structure"},c3e=l3e;bk.default=c3e;var wk={};Object.defineProperty(wk,"__esModule",{value:!0});wk.default=void 0;var u3e={relatedConcepts:[{module:"HTML",concept:{name:"legend"}}],type:"structure"},h3e=u3e;wk.default=h3e;var _k={};Object.defineProperty(_k,"__esModule",{value:!0});_k.default=void 0;var d3e={relatedConcepts:[{module:"HTML",concept:{name:"br"}}],type:"structure"},f3e=d3e;_k.default=f3e;var Ck={};Object.defineProperty(Ck,"__esModule",{value:!0});Ck.default=void 0;var p3e={relatedConcepts:[{module:"ARIA",concept:{name:"link"}},{module:"HTML",concept:{name:"a",attributes:[{name:"href"}]}}],type:"widget"},m3e=p3e;Ck.default=m3e;var Sk={};Object.defineProperty(Sk,"__esModule",{value:!0});Sk.default=void 0;var g3e={relatedConcepts:[{module:"ARIA",concept:{name:"option"}},{module:"HTML",concept:{name:"option"}}],type:"widget"},v3e=g3e;Sk.default=v3e;var Ok={};Object.defineProperty(Ok,"__esModule",{value:!0});Ok.default=void 0;var y3e={relatedConcepts:[{module:"ARIA",concept:{name:"listbox"}},{module:"HTML",concept:{name:"datalist"}},{module:"HTML",concept:{name:"select"}}],type:"widget"},x3e=y3e;Ok.default=x3e;var Mk={};Object.defineProperty(Mk,"__esModule",{value:!0});Mk.default=void 0;var b3e={relatedConcepts:[{module:"ARIA",concept:{name:"listitem"}},{module:"HTML",concept:{name:"li"}}],type:"structure"},w3e=b3e;Mk.default=w3e;var Tk={};Object.defineProperty(Tk,"__esModule",{value:!0});Tk.default=void 0;var _3e={relatedConcepts:[],type:"structure"},C3e=_3e;Tk.default=C3e;var Rk={};Object.defineProperty(Rk,"__esModule",{value:!0});Rk.default=void 0;var S3e={relatedConcepts:[{module:"ARIA",concept:{name:"list"}},{module:"HTML",concept:{name:"ul"}},{module:"HTML",concept:{name:"ol"}}],type:"structure"},O3e=S3e;Rk.default=O3e;var Pk={};Object.defineProperty(Pk,"__esModule",{value:!0});Pk.default=void 0;var M3e={relatedConcepts:[{module:"ARIA",concept:{name:"log"}}],type:"structure"},T3e=M3e;Pk.default=T3e;var Ek={};Object.defineProperty(Ek,"__esModule",{value:!0});Ek.default=void 0;var R3e={relatedConcepts:[{module:"ARIA",concept:{name:"main"}},{module:"HTML",concept:{name:"main"}}],type:"structure"},P3e=R3e;Ek.default=P3e;var Ak={};Object.defineProperty(Ak,"__esModule",{value:!0});Ak.default=void 0;var E3e={relatedConcepts:[{module:"HTML",concept:{name:"mark"}}],type:"structure"},A3e=E3e;Ak.default=A3e;var Ik={};Object.defineProperty(Ik,"__esModule",{value:!0});Ik.default=void 0;var I3e={relatedConcepts:[{module:"ARIA",concept:{name:"marquee"}},{module:"HTML",concept:{name:"marquee"}}],type:"structure"},k3e=I3e;Ik.default=k3e;var kk={};Object.defineProperty(kk,"__esModule",{value:!0});kk.default=void 0;var D3e={relatedConcepts:[{module:"ARIA",concept:{name:"math"}}],type:"structure"},L3e=D3e;kk.default=L3e;var Dk={};Object.defineProperty(Dk,"__esModule",{value:!0});Dk.default=void 0;var F3e={relatedConcepts:[{module:"ARIA",concept:{name:"menubar"}}],type:"structure"},N3e=F3e;Dk.default=N3e;var Lk={};Object.defineProperty(Lk,"__esModule",{value:!0});Lk.default=void 0;var B3e={relatedConcepts:[],type:"widget"},z3e=B3e;Lk.default=z3e;var Fk={};Object.defineProperty(Fk,"__esModule",{value:!0});Fk.default=void 0;var V3e={relatedConcepts:[{module:"ARIA",concept:{name:"menuitem"}},{module:"HTML",concept:{name:"menuitem"}}],type:"widget"},G3e=V3e;Fk.default=G3e;var Nk={};Object.defineProperty(Nk,"__esModule",{value:!0});Nk.default=void 0;var U3e={relatedConcepts:[{module:"ARIA",concept:{name:"menuitemcheckbox"}}],type:"widget"},H3e=U3e;Nk.default=H3e;var Bk={};Object.defineProperty(Bk,"__esModule",{value:!0});Bk.default=void 0;var $3e={relatedConcepts:[{module:"ARIA",concept:{name:"menuitemradio"}}],type:"widget"},W3e=$3e;Bk.default=W3e;var zk={};Object.defineProperty(zk,"__esModule",{value:!0});zk.default=void 0;var q3e={relatedConcepts:[],type:"widget"},j3e=q3e;zk.default=j3e;var Vk={};Object.defineProperty(Vk,"__esModule",{value:!0});Vk.default=void 0;var Q3e={relatedConcepts:[],type:"widget"},Z3e=Q3e;Vk.default=Z3e;var Gk={};Object.defineProperty(Gk,"__esModule",{value:!0});Gk.default=void 0;var X3e={relatedConcepts:[{module:"ARIA",concept:{name:"menu"}},{module:"HTML",concept:{name:"menu"}}],type:"structure"},K3e=X3e;Gk.default=K3e;var Uk={};Object.defineProperty(Uk,"__esModule",{value:!0});Uk.default=void 0;var Y3e={relatedConcepts:[{module:"HTML",concept:{name:"meter"}}],type:"structure"},J3e=Y3e;Uk.default=J3e;var Hk={};Object.defineProperty(Hk,"__esModule",{value:!0});Hk.default=void 0;var eze={relatedConcepts:[{module:"ARIA",concept:{name:"navigation"}},{module:"HTML",concept:{name:"nav"}}],type:"structure"},tze=eze;Hk.default=tze;var $k={};Object.defineProperty($k,"__esModule",{value:!0});$k.default=void 0;var ize={relatedConcepts:[{module:"ARIA",concept:{name:"none"}}],type:"structure"},nze=ize;$k.default=nze;var Wk={};Object.defineProperty(Wk,"__esModule",{value:!0});Wk.default=void 0;var rze={relatedConcepts:[{module:"ARIA",concept:{name:"note"}}],type:"structure"},sze=rze;Wk.default=sze;var qk={};Object.defineProperty(qk,"__esModule",{value:!0});qk.default=void 0;var oze={relatedConcepts:[],type:"structure"},aze=oze;qk.default=aze;var jk={};Object.defineProperty(jk,"__esModule",{value:!0});jk.default=void 0;var lze={relatedConcepts:[{module:"HTML",concept:{name:"p"}}],type:"structure"},cze=lze;jk.default=cze;var Qk={};Object.defineProperty(Qk,"__esModule",{value:!0});Qk.default=void 0;var uze={relatedConcepts:[],type:"widget"},hze=uze;Qk.default=hze;var Zk={};Object.defineProperty(Zk,"__esModule",{value:!0});Zk.default=void 0;var dze={relatedConcepts:[{module:"HTML",concept:{name:"pre"}}],type:"structure"},fze=dze;Zk.default=fze;var Xk={};Object.defineProperty(Xk,"__esModule",{value:!0});Xk.default=void 0;var pze={relatedConcepts:[{module:"ARIA",concept:{name:"presentation"}}],type:"structure"},mze=pze;Xk.default=mze;var Kk={};Object.defineProperty(Kk,"__esModule",{value:!0});Kk.default=void 0;var gze={relatedConcepts:[{module:"ARIA",concept:{name:"progressbar"}},{module:"HTML",concept:{name:"progress"}}],type:"structure"},vze=gze;Kk.default=vze;var Yk={};Object.defineProperty(Yk,"__esModule",{value:!0});Yk.default=void 0;var yze={relatedConcepts:[{module:"ARIA",concept:{name:"radio"}},{module:"HTML",concept:{name:"input",attributes:[{name:"type",value:"radio"}]}}],type:"widget"},xze=yze;Yk.default=xze;var Jk={};Object.defineProperty(Jk,"__esModule",{value:!0});Jk.default=void 0;var bze={relatedConcepts:[{module:"ARIA",concept:{name:"radiogroup"}}],type:"structure"},wze=bze;Jk.default=wze;var eD={};Object.defineProperty(eD,"__esModule",{value:!0});eD.default=void 0;var _ze={relatedConcepts:[{module:"ARIA",concept:{name:"region"}}],type:"structure"},Cze=_ze;eD.default=Cze;var tD={};Object.defineProperty(tD,"__esModule",{value:!0});tD.default=void 0;var Sze={relatedConcepts:[],type:"structure"},Oze=Sze;tD.default=Oze;var iD={};Object.defineProperty(iD,"__esModule",{value:!0});iD.default=void 0;var Mze={relatedConcepts:[{module:"ARIA",concept:{name:"rowheader"}},{module:"HTML",concept:{name:"th",attributes:[{name:"scope",value:"row"}]}}],type:"widget"},Tze=Mze;iD.default=Tze;var nD={};Object.defineProperty(nD,"__esModule",{value:!0});nD.default=void 0;var Rze={relatedConcepts:[{module:"ARIA",concept:{name:"row"}},{module:"HTML",concept:{name:"tr"}}],type:"structure"},Pze=Rze;nD.default=Pze;var rD={};Object.defineProperty(rD,"__esModule",{value:!0});rD.default=void 0;var Eze={relatedConcepts:[{module:"HTML",concept:{name:"ruby"}}],type:"structure"},Aze=Eze;rD.default=Aze;var sD={};Object.defineProperty(sD,"__esModule",{value:!0});sD.default=void 0;var Ize={relatedConcepts:[],type:"structure"},kze=Ize;sD.default=kze;var oD={};Object.defineProperty(oD,"__esModule",{value:!0});oD.default=void 0;var Dze={relatedConcepts:[],type:"structure"},Lze=Dze;oD.default=Lze;var aD={};Object.defineProperty(aD,"__esModule",{value:!0});aD.default=void 0;var Fze={relatedConcepts:[{module:"ARIA",concept:{name:"scrollbar"}}],type:"widget"},Nze=Fze;aD.default=Nze;var lD={};Object.defineProperty(lD,"__esModule",{value:!0});lD.default=void 0;var Bze={relatedConcepts:[],type:"structure"},zze=Bze;lD.default=zze;var cD={};Object.defineProperty(cD,"__esModule",{value:!0});cD.default=void 0;var Vze={relatedConcepts:[{module:"ARIA",concept:{name:"search"}}],type:"structure"},Gze=Vze;cD.default=Gze;var uD={};Object.defineProperty(uD,"__esModule",{value:!0});uD.default=void 0;var Uze={relatedConcepts:[{module:"ARIA",concept:{name:"searchbox"}},{module:"HTML",concept:{name:"input",attributes:[{name:"type",value:"search"}]}}],type:"widget"},Hze=Uze;uD.default=Hze;var hD={};Object.defineProperty(hD,"__esModule",{value:!0});hD.default=void 0;var $ze={relatedConcepts:[{module:"ARIA",concept:{name:"slider"}},{module:"HTML",concept:{name:"input",attributes:[{name:"type",value:"range"}]}}],type:"widget"},Wze=$ze;hD.default=Wze;var dD={};Object.defineProperty(dD,"__esModule",{value:!0});dD.default=void 0;var qze={relatedConcepts:[],type:"structure"},jze=qze;dD.default=jze;var fD={};Object.defineProperty(fD,"__esModule",{value:!0});fD.default=void 0;var Qze={relatedConcepts:[{module:"ARIA",concept:{name:"spinbutton"}},{module:"HTML",concept:{name:"input",attributes:[{name:"type",value:"number"}]}}],type:"widget"},Zze=Qze;fD.default=Zze;var pD={};Object.defineProperty(pD,"__esModule",{value:!0});pD.default=void 0;var Xze={relatedConcepts:[],type:"structure"},Kze=Xze;pD.default=Kze;var mD={};Object.defineProperty(mD,"__esModule",{value:!0});mD.default=void 0;var Yze={relatedConcepts:[{module:"ARIA",concept:{name:"separator"}}],type:"widget"},Jze=Yze;mD.default=Jze;var gD={};Object.defineProperty(gD,"__esModule",{value:!0});gD.default=void 0;var eVe={relatedConcepts:[],type:"structure"},tVe=eVe;gD.default=tVe;var vD={};Object.defineProperty(vD,"__esModule",{value:!0});vD.default=void 0;var iVe={relatedConcepts:[{module:"ARIA",concept:{name:"status"}}],type:"structure"},nVe=iVe;vD.default=nVe;var yD={};Object.defineProperty(yD,"__esModule",{value:!0});yD.default=void 0;var rVe={relatedConcepts:[],type:"structure"},sVe=rVe;yD.default=sVe;var xD={};Object.defineProperty(xD,"__esModule",{value:!0});xD.default=void 0;var oVe={relatedConcepts:[{module:"ARIA",concept:{name:"switch"}},{module:"HTML",concept:{name:"input",attributes:[{name:"type",value:"checkbox"}]}}],type:"widget"},aVe=oVe;xD.default=aVe;var bD={};Object.defineProperty(bD,"__esModule",{value:!0});bD.default=void 0;var lVe={relatedConcepts:[{module:"ARIA",concept:{name:"tablist"}}],type:"structure"},cVe=lVe;bD.default=cVe;var wD={};Object.defineProperty(wD,"__esModule",{value:!0});wD.default=void 0;var uVe={relatedConcepts:[{module:"ARIA",concept:{name:"tab"}}],type:"widget"},hVe=uVe;wD.default=hVe;var _D={};Object.defineProperty(_D,"__esModule",{value:!0});_D.default=void 0;var dVe={relatedConcepts:[],type:"structure"},fVe=dVe;_D.default=fVe;var CD={};Object.defineProperty(CD,"__esModule",{value:!0});CD.default=void 0;var pVe={relatedConcepts:[{module:"ARIA",concept:{name:"table"}},{module:"HTML",concept:{name:"table"}}],type:"structure"},mVe=pVe;CD.default=mVe;var SD={};Object.defineProperty(SD,"__esModule",{value:!0});SD.default=void 0;var gVe={relatedConcepts:[{module:"ARIA",concept:{name:"tablist"}}],type:"structure"},vVe=gVe;SD.default=vVe;var OD={};Object.defineProperty(OD,"__esModule",{value:!0});OD.default=void 0;var yVe={relatedConcepts:[{module:"ARIA",concept:{name:"tabpanel"}}],type:"structure"},xVe=yVe;OD.default=xVe;var MD={};Object.defineProperty(MD,"__esModule",{value:!0});MD.default=void 0;var bVe={relatedConcepts:[{module:"ARIA",concept:{name:"term"}}],type:"structure"},wVe=bVe;MD.default=wVe;var TD={};Object.defineProperty(TD,"__esModule",{value:!0});TD.default=void 0;var _Ve={relatedConcepts:[{module:"ARIA",concept:{attributes:[{name:"aria-multiline",value:"true"}],name:"textbox"}},{module:"HTML",concept:{name:"textarea"}}],type:"widget"},CVe=_Ve;TD.default=CVe;var RD={};Object.defineProperty(RD,"__esModule",{value:!0});RD.default=void 0;var SVe={relatedConcepts:[{module:"ARIA",concept:{name:"textbox"}},{module:"HTML",concept:{name:"input"}},{module:"HTML",concept:{name:"input",attributes:[{name:"type",value:"text"}]}}],type:"widget"},OVe=SVe;RD.default=OVe;var PD={};Object.defineProperty(PD,"__esModule",{value:!0});PD.default=void 0;var MVe={relatedConcepts:[{module:"HTML",concept:{name:"time"}}],type:"structure"},TVe=MVe;PD.default=TVe;var ED={};Object.defineProperty(ED,"__esModule",{value:!0});ED.default=void 0;var RVe={relatedConcepts:[{module:"ARIA",concept:{name:"timer"}}],type:"structure"},PVe=RVe;ED.default=PVe;var AD={};Object.defineProperty(AD,"__esModule",{value:!0});AD.default=void 0;var EVe={relatedConcepts:[{module:"ARIA",concept:{attributes:[{name:"aria-pressed"}]}}],type:"widget"},AVe=EVe;AD.default=AVe;var ID={};Object.defineProperty(ID,"__esModule",{value:!0});ID.default=void 0;var IVe={relatedConcepts:[{module:"ARIA",concept:{name:"toolbar"}}],type:"structure"},kVe=IVe;ID.default=kVe;var kD={};Object.defineProperty(kD,"__esModule",{value:!0});kD.default=void 0;var DVe={relatedConcepts:[{module:"ARIA",concept:{name:"tree"}}],type:"widget"},LVe=DVe;kD.default=LVe;var DD={};Object.defineProperty(DD,"__esModule",{value:!0});DD.default=void 0;var FVe={relatedConcepts:[{module:"ARIA",concept:{name:"treegrid"}}],type:"widget"},NVe=FVe;DD.default=NVe;var LD={};Object.defineProperty(LD,"__esModule",{value:!0});LD.default=void 0;var BVe={relatedConcepts:[{module:"ARIA",concept:{name:"treeitem"}}],type:"widget"},zVe=BVe;LD.default=zVe;var FD={};Object.defineProperty(FD,"__esModule",{value:!0});FD.default=void 0;var VVe={relatedConcepts:[{module:"ARIA",concept:{name:"tooltip"}}],type:"structure"},GVe=VVe;FD.default=GVe;var ND={};Object.defineProperty(ND,"__esModule",{value:!0});ND.default=void 0;var UVe={relatedConcepts:[{module:"HTML",concept:{name:"video"}}],type:"widget"},HVe=UVe;ND.default=HVe;var BD={};Object.defineProperty(BD,"__esModule",{value:!0});BD.default=void 0;var $Ve={relatedConcepts:[],type:"structure"},WVe=$Ve;BD.default=WVe;var zD={};Object.defineProperty(zD,"__esModule",{value:!0});zD.default=void 0;var qVe={relatedConcepts:[],type:"window"},jVe=qVe;zD.default=jVe;Object.defineProperty(nv,"__esModule",{value:!0});nv.default=void 0;var QVe=$t(dx),ZVe=$t(SI),XVe=$t(OI),KVe=$t(MI),YVe=$t(TI),JVe=$t(RI),eGe=$t(PI),tGe=$t(EI),iGe=$t(AI),nGe=$t(II),rGe=$t(kI),sGe=$t(DI),oGe=$t(LI),aGe=$t(FI),lGe=$t(NI),cGe=$t(BI),uGe=$t(zI),hGe=$t(VI),dGe=$t(GI),fGe=$t(UI),pGe=$t(HI),mGe=$t($I),gGe=$t(WI),vGe=$t(qI),yGe=$t(jI),xGe=$t(QI),bGe=$t(ZI),wGe=$t(XI),_Ge=$t(KI),CGe=$t(YI),SGe=$t(JI),OGe=$t(ek),MGe=$t(tk),TGe=$t(ik),RGe=$t(nk),PGe=$t(rk),EGe=$t(sk),AGe=$t(ok),IGe=$t(ak),kGe=$t(lk),DGe=$t(ck),LGe=$t(uk),FGe=$t(hk),NGe=$t(dk),BGe=$t(fk),zGe=$t(pk),VGe=$t(mk),GGe=$t(gk),UGe=$t(vk),HGe=$t(yk),$Ge=$t(xk),WGe=$t(bk),qGe=$t(wk),jGe=$t(_k),QGe=$t(Ck),ZGe=$t(Sk),XGe=$t(Ok),KGe=$t(Mk),YGe=$t(Tk),JGe=$t(Rk),eUe=$t(Pk),tUe=$t(Ek),iUe=$t(Ak),nUe=$t(Ik),rUe=$t(kk),sUe=$t(Dk),oUe=$t(Lk),aUe=$t(Fk),lUe=$t(Nk),cUe=$t(Bk),uUe=$t(zk),hUe=$t(Vk),dUe=$t(Gk),fUe=$t(Uk),pUe=$t(Hk),mUe=$t($k),gUe=$t(Wk),vUe=$t(qk),yUe=$t(jk),xUe=$t(Qk),bUe=$t(Zk),wUe=$t(Xk),_Ue=$t(Kk),CUe=$t(Yk),SUe=$t(Jk),OUe=$t(eD),MUe=$t(tD),TUe=$t(iD),RUe=$t(nD),PUe=$t(rD),EUe=$t(sD),AUe=$t(oD),IUe=$t(aD),kUe=$t(lD),DUe=$t(cD),LUe=$t(uD),FUe=$t(hD),NUe=$t(dD),BUe=$t(fD),zUe=$t(pD),VUe=$t(mD),GUe=$t(gD),UUe=$t(vD),HUe=$t(yD),$Ue=$t(xD),WUe=$t(bD),qUe=$t(wD),jUe=$t(_D),QUe=$t(CD),ZUe=$t(SD),XUe=$t(OD),KUe=$t(MD),YUe=$t(TD),JUe=$t(RD),eHe=$t(PD),tHe=$t(ED),iHe=$t(AD),nHe=$t(ID),rHe=$t(kD),sHe=$t(DD),oHe=$t(LD),aHe=$t(FD),lHe=$t(ND),cHe=$t(BD),uHe=$t(zD);function $t(t){return t&&t.__esModule?t:{default:t}}function EN(t,e){return pHe(t)||fHe(t,e)||dHe(t,e)||hHe()}function hHe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dHe(t,e){if(t){if(typeof t=="string")return oq(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return oq(t,e)}}function oq(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function fHe(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var n=[],r=!0,s=!1,o,a;try{for(i=i.call(t);!(r=(o=i.next()).done)&&(n.push(o.value),!(e&&n.length===e));r=!0);}catch(l){s=!0,a=l}finally{try{!r&&i.return!=null&&i.return()}finally{if(s)throw a}}return n}}function pHe(t){if(Array.isArray(t))return t}var oy=[["AbbrRole",ZVe.default],["AlertDialogRole",XVe.default],["AlertRole",KVe.default],["AnnotationRole",YVe.default],["ApplicationRole",JVe.default],["ArticleRole",eGe.default],["AudioRole",tGe.default],["BannerRole",iGe.default],["BlockquoteRole",nGe.default],["BusyIndicatorRole",rGe.default],["ButtonRole",sGe.default],["CanvasRole",oGe.default],["CaptionRole",aGe.default],["CellRole",lGe.default],["CheckBoxRole",cGe.default],["ColorWellRole",uGe.default],["ColumnHeaderRole",hGe.default],["ColumnRole",dGe.default],["ComboBoxRole",fGe.default],["ComplementaryRole",pGe.default],["ContentInfoRole",mGe.default],["DateRole",gGe.default],["DateTimeRole",vGe.default],["DefinitionRole",yGe.default],["DescriptionListDetailRole",xGe.default],["DescriptionListRole",bGe.default],["DescriptionListTermRole",wGe.default],["DetailsRole",_Ge.default],["DialogRole",CGe.default],["DirectoryRole",SGe.default],["DisclosureTriangleRole",OGe.default],["DivRole",MGe.default],["DocumentRole",TGe.default],["EmbeddedObjectRole",RGe.default],["FeedRole",PGe.default],["FigcaptionRole",EGe.default],["FigureRole",AGe.default],["FooterRole",IGe.default],["FormRole",kGe.default],["GridRole",DGe.default],["GroupRole",LGe.default],["HeadingRole",FGe.default],["IframePresentationalRole",NGe.default],["IframeRole",BGe.default],["IgnoredRole",zGe.default],["ImageMapLinkRole",VGe.default],["ImageMapRole",GGe.default],["ImageRole",UGe.default],["InlineTextBoxRole",HGe.default],["InputTimeRole",$Ge.default],["LabelRole",WGe.default],["LegendRole",qGe.default],["LineBreakRole",jGe.default],["LinkRole",QGe.default],["ListBoxOptionRole",ZGe.default],["ListBoxRole",XGe.default],["ListItemRole",KGe.default],["ListMarkerRole",YGe.default],["ListRole",JGe.default],["LogRole",eUe.default],["MainRole",tUe.default],["MarkRole",iUe.default],["MarqueeRole",nUe.default],["MathRole",rUe.default],["MenuBarRole",sUe.default],["MenuButtonRole",oUe.default],["MenuItemRole",aUe.default],["MenuItemCheckBoxRole",lUe.default],["MenuItemRadioRole",cUe.default],["MenuListOptionRole",uUe.default],["MenuListPopupRole",hUe.default],["MenuRole",dUe.default],["MeterRole",fUe.default],["NavigationRole",pUe.default],["NoneRole",mUe.default],["NoteRole",gUe.default],["OutlineRole",vUe.default],["ParagraphRole",yUe.default],["PopUpButtonRole",xUe.default],["PreRole",bUe.default],["PresentationalRole",wUe.default],["ProgressIndicatorRole",_Ue.default],["RadioButtonRole",CUe.default],["RadioGroupRole",SUe.default],["RegionRole",OUe.default],["RootWebAreaRole",MUe.default],["RowHeaderRole",TUe.default],["RowRole",RUe.default],["RubyRole",PUe.default],["RulerRole",EUe.default],["ScrollAreaRole",AUe.default],["ScrollBarRole",IUe.default],["SeamlessWebAreaRole",kUe.default],["SearchRole",DUe.default],["SearchBoxRole",LUe.default],["SliderRole",FUe.default],["SliderThumbRole",NUe.default],["SpinButtonRole",BUe.default],["SpinButtonPartRole",zUe.default],["SplitterRole",VUe.default],["StaticTextRole",GUe.default],["StatusRole",UUe.default],["SVGRootRole",HUe.default],["SwitchRole",$Ue.default],["TabGroupRole",WUe.default],["TabRole",qUe.default],["TableHeaderContainerRole",jUe.default],["TableRole",QUe.default],["TabListRole",ZUe.default],["TabPanelRole",XUe.default],["TermRole",KUe.default],["TextAreaRole",YUe.default],["TextFieldRole",JUe.default],["TimeRole",eHe.default],["TimerRole",tHe.default],["ToggleButtonRole",iHe.default],["ToolbarRole",nHe.default],["TreeRole",rHe.default],["TreeGridRole",sHe.default],["TreeItemRole",oHe.default],["UserInterfaceTooltipRole",aHe.default],["VideoRole",lHe.default],["WebAreaRole",cHe.default],["WindowRole",uHe.default]],Qz={entries:function(){return oy},forEach:function(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=0,r=oy;n<r.length;n++){var s=EN(r[n],2),o=s[0],a=s[1];e.call(i,a,o,oy)}},get:function(e){var i=oy.find(function(n){return n[0]===e});return i&&i[1]},has:function(e){return!!Qz.get(e)},keys:function(){return oy.map(function(e){var i=EN(e,1),n=i[0];return n})},values:function(){return oy.map(function(e){var i=EN(e,2),n=i[1];return n})}},mHe=(0,QVe.default)(Qz,Qz.entries());nv.default=mHe;Object.defineProperty(_I,"__esModule",{value:!0});_I.default=void 0;var gHe=rte(dx),vHe=rte(nv);function rte(t){return t&&t.__esModule?t:{default:t}}function e_(t,e){return bHe(t)||xHe(t,e)||ste(t,e)||yHe()}function yHe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xHe(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var n=[],r=!0,s=!1,o,a;try{for(i=i.call(t);!(r=(o=i.next()).done)&&(n.push(o.value),!(e&&n.length===e));r=!0);}catch(l){s=!0,a=l}finally{try{!r&&i.return!=null&&i.return()}finally{if(s)throw a}}return n}}function bHe(t){if(Array.isArray(t))return t}function wHe(t,e){var i=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=ste(t))||e){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(u){throw u},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){i=i.call(t)},n:function(){var u=i.next();return s=u.done,u},e:function(u){o=!0,a=u},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw a}}}}function ste(t,e){if(t){if(typeof t=="string")return aq(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return aq(t,e)}}function aq(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var nh=[],eO=wHe(vHe.default.entries()),lq;try{var _He=function(){var e=e_(lq.value,2),i=e[0],n=e[1],r=n.relatedConcepts;Array.isArray(r)&&r.forEach(function(s){if(s.module==="HTML"){var o=s.concept;if(o){var a=nh.findIndex(function(l){var u=e_(l,1),d=u[0];return d===i});a===-1&&(nh.push([i,[]]),a=nh.length-1),nh[a][1].push(o)}}})};for(eO.s();!(lq=eO.n()).done;)_He()}catch(t){eO.e(t)}finally{eO.f()}var Zz={entries:function(){return nh},forEach:function(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=0,r=nh;n<r.length;n++){var s=e_(r[n],2),o=s[0],a=s[1];e.call(i,a,o,nh)}},get:function(e){var i=nh.find(function(n){return n[0]===e});return i&&i[1]},has:function(e){return!!Zz.get(e)},keys:function(){return nh.map(function(e){var i=e_(e,1),n=i[0];return n})},values:function(){return nh.map(function(e){var i=e_(e,2),n=i[1];return n})}},CHe=(0,gHe.default)(Zz,Zz.entries());_I.default=CHe;var VD={};Object.defineProperty(VD,"__esModule",{value:!0});VD.default=void 0;var SHe=ote(dx),OHe=ote(nv);function ote(t){return t&&t.__esModule?t:{default:t}}function t_(t,e){return RHe(t)||THe(t,e)||ate(t,e)||MHe()}function MHe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function THe(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var n=[],r=!0,s=!1,o,a;try{for(i=i.call(t);!(r=(o=i.next()).done)&&(n.push(o.value),!(e&&n.length===e));r=!0);}catch(l){s=!0,a=l}finally{try{!r&&i.return!=null&&i.return()}finally{if(s)throw a}}return n}}function RHe(t){if(Array.isArray(t))return t}function PHe(t,e){var i=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=ate(t))||e){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(u){throw u},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){i=i.call(t)},n:function(){var u=i.next();return s=u.done,u},e:function(u){o=!0,a=u},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw a}}}}function ate(t,e){if(t){if(typeof t=="string")return cq(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return cq(t,e)}}function cq(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var rh=[],tO=PHe(OHe.default.entries()),uq;try{var EHe=function(){var e=t_(uq.value,2),i=e[0],n=e[1],r=n.relatedConcepts;Array.isArray(r)&&r.forEach(function(s){if(s.module==="ARIA"){var o=s.concept;if(o){var a=rh.findIndex(function(l){var u=t_(l,1),d=u[0];return d===i});a===-1&&(rh.push([i,[]]),a=rh.length-1),rh[a][1].push(o)}}})};for(tO.s();!(uq=tO.n()).done;)EHe()}catch(t){tO.e(t)}finally{tO.f()}var Xz={entries:function(){return rh},forEach:function(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=0,r=rh;n<r.length;n++){var s=t_(r[n],2),o=s[0],a=s[1];e.call(i,a,o,rh)}},get:function(e){var i=rh.find(function(n){return n[0]===e});return i&&i[1]},has:function(e){return!!Xz.get(e)},keys:function(){return rh.map(function(e){var i=t_(e,1),n=i[0];return n})},values:function(){return rh.map(function(e){var i=t_(e,2),n=i[1];return n})}},AHe=(0,SHe.default)(Xz,Xz.entries());VD.default=AHe;var GD={};Object.defineProperty(GD,"__esModule",{value:!0});GD.default=void 0;var IHe=lte(nv),kHe=lte(dx);function lte(t){return t&&t.__esModule?t:{default:t}}function AM(t,e){return FHe(t)||LHe(t,e)||cte(t,e)||DHe()}function DHe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LHe(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var n=[],r=!0,s=!1,o,a;try{for(i=i.call(t);!(r=(o=i.next()).done)&&(n.push(o.value),!(e&&n.length===e));r=!0);}catch(l){s=!0,a=l}finally{try{!r&&i.return!=null&&i.return()}finally{if(s)throw a}}return n}}function FHe(t){if(Array.isArray(t))return t}function NHe(t,e){var i=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=cte(t))||e){i&&(t=i);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(u){throw u},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){i=i.call(t)},n:function(){var u=i.next();return s=u.done,u},e:function(u){o=!0,a=u},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw a}}}}function cte(t,e){if(t){if(typeof t=="string")return hq(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return hq(t,e)}}function hq(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Oc=[],iO=NHe(IHe.default.entries()),dq;try{var BHe=function(){var e=AM(dq.value,2),i=e[0],n=e[1],r=n.relatedConcepts;Array.isArray(r)&&r.forEach(function(s){if(s.module==="HTML"){var o=s.concept;if(o!=null){for(var a=JSON.stringify(o),l,u=0;u<Oc.length;u++){var d=Oc[u][0];if(JSON.stringify(d)===a){l=Oc[u][1];break}}Array.isArray(l)||(l=[]);var p=l.findIndex(function(v){return v===i});p===-1&&l.push(i),u<Oc.length?Oc.splice(u,1,[o,l]):Oc.push([o,l])}}})};for(iO.s();!(dq=iO.n()).done;)BHe()}catch(t){iO.e(t)}finally{iO.f()}function zHe(t,e){if(t===void 0&&e!==void 0||t!==void 0&&e===void 0)return!1;if(t!==void 0&&e!==void 0){if(t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(e[i].name!==t[i].name||e[i].value!==t[i].value)return!1}return!0}var Kz={entries:function(){return Oc},forEach:function(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=0,r=Oc;n<r.length;n++){var s=AM(r[n],2),o=s[0],a=s[1];e.call(i,a,o,Oc)}},get:function(e){var i=Oc.find(function(n){return e.name===n[0].name&&zHe(e.attributes,n[0].attributes)});return i&&i[1]},has:function(e){return!!Kz.get(e)},keys:function(){return Oc.map(function(e){var i=AM(e,1),n=i[0];return n})},values:function(){return Oc.map(function(e){var i=AM(e,2),n=i[1];return n})}},VHe=(0,kHe.default)(Kz,Kz.entries());GD.default=VHe;Object.defineProperty(Sd,"__esModule",{value:!0});var XU=Sd.elementAXObjects=X_=Sd.AXObjects=Sd.AXObjectRoles=Sd.AXObjectElements=void 0,GHe=UD(_I),UHe=UD(VD),HHe=UD(nv),$He=UD(GD);function UD(t){return t&&t.__esModule?t:{default:t}}var WHe=GHe.default;Sd.AXObjectElements=WHe;var qHe=UHe.default;Sd.AXObjectRoles=qHe;var jHe=HHe.default,X_=Sd.AXObjects=jHe,QHe=$He.default;XU=Sd.elementAXObjects=QHe;const ute=wI.keys(),ZHe=ute.filter(t=>wI.get(t)?.abstract),hte=ute.filter(t=>!ZHe.includes(t)),dte=hte.filter(t=>{const e=wI.get(t);return!["toolbar","tabpanel","generic","cell"].includes(t)&&!e?.superClass.some(i=>i.includes("widget")||i.includes("window"))}).concat("progressbar"),XHe=hte.filter(t=>!dte.includes(t)&&t!=="generic");bI.entries().forEach(([t,e])=>{[...e].every(i=>i!=="generic"&&dte.includes(i))});bI.entries().forEach(([t,e])=>{[...e].every(i=>XHe.includes(i))});const KHe=[...X_.keys()].filter(t=>X_.get(t).type==="widget"),YHe=[...X_.keys()].filter(t=>["windows","structure"].includes(X_.get(t).type));XU.entries().forEach(([t,e])=>{[...e].every(i=>KHe.includes(i))});XU.entries().forEach(([t,e])=>{[...e].every(i=>YHe.includes(i))});var HT={exports:{}},JHe=HT.exports;(function(t,e){(function(i,n){n(e)})(JHe,function(i){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=new Uint8Array(64),a=new Uint8Array(128);for(let G=0;G<s.length;G++){const j=s.charCodeAt(G);o[G]=j,a[j]=G}function l(G,j){let Z=0,ie=0,le=0;do{const be=G.next();le=a[be],Z|=(le&31)<<ie,ie+=5}while(le&32);const me=Z&1;return Z>>>=1,me&&(Z=-2147483648|-Z),j+Z}function u(G,j,Z){let ie=j-Z;ie=ie<0?-ie<<1|1:ie<<1;do{let le=ie&31;ie>>>=5,ie>0&&(le|=32),G.write(o[le])}while(ie>0);return j}function d(G,j){return G.pos>=j?!1:G.peek()!==44}const p=1024*16,v=typeof TextDecoder<"u"?new TextDecoder:typeof Buffer<"u"?{decode(G){return Buffer.from(G.buffer,G.byteOffset,G.byteLength).toString()}}:{decode(G){let j="";for(let Z=0;Z<G.length;Z++)j+=String.fromCharCode(G[Z]);return j}};class y{constructor(){this.pos=0,this.out="",this.buffer=new Uint8Array(p)}write(j){const{buffer:Z}=this;Z[this.pos++]=j,this.pos===p&&(this.out+=v.decode(Z),this.pos=0)}flush(){const{buffer:j,out:Z,pos:ie}=this;return ie>0?Z+v.decode(j.subarray(0,ie)):Z}}class w{constructor(j){this.pos=0,this.buffer=j}next(){return this.buffer.charCodeAt(this.pos++)}peek(){return this.buffer.charCodeAt(this.pos)}indexOf(j){const{buffer:Z,pos:ie}=this,le=Z.indexOf(j,ie);return le===-1?Z.length:le}}const R=[];function O(G){const{length:j}=G,Z=new w(G),ie=[],le=[];let me=0;for(;Z.pos<j;Z.pos++){me=l(Z,me);const be=l(Z,0);if(!d(Z,j)){const ct=le.pop();ct[2]=me,ct[3]=be;continue}const fe=l(Z,0),je=l(Z,0)&1?[me,be,0,0,fe,l(Z,0)]:[me,be,0,0,fe];let qe=R;if(d(Z,j)){qe=[];do{const ct=l(Z,0);qe.push(ct)}while(d(Z,j))}je.vars=qe,ie.push(je),le.push(je)}return ie}function P(G){const j=new y;for(let Z=0;Z<G.length;)Z=N(G,Z,j,[0]);return j.flush()}function N(G,j,Z,ie){const le=G[j],{0:me,1:be,2:fe,3:Fe,4:He,vars:je}=le;j>0&&Z.write(44),ie[0]=u(Z,me,ie[0]),u(Z,be,0),u(Z,He,0);const qe=le.length===6?1:0;u(Z,qe,0),le.length===6&&u(Z,le[5],0);for(const ct of je)u(Z,ct,0);for(j++;j<G.length;){const ct=G[j],{0:Ge,1:Je}=ct;if(Ge>fe||Ge===fe&&Je>=Fe)break;j=N(G,j,Z,ie)}return Z.write(44),ie[0]=u(Z,fe,ie[0]),u(Z,Fe,0),j}function F(G){const{length:j}=G,Z=new w(G),ie=[],le=[];let me=0,be=0,fe=0,Fe=0,He=0,je=0,qe=0,ct=0;do{const Ge=Z.indexOf(";");let Je=0;for(;Z.pos<Ge;Z.pos++){if(Je=l(Z,Je),!d(Z,Ge)){const Ut=le.pop();Ut[2]=me,Ut[3]=Je;continue}const mt=l(Z,0),wt=mt&1,Ot=mt&2,Qt=mt&4;let ei=null,Jt=R,Yt;if(wt){const Ut=l(Z,be);fe=l(Z,be===Ut?fe:0),be=Ut,Yt=[me,Je,0,0,Ut,fe]}else Yt=[me,Je,0,0];if(Yt.isScope=!!Qt,Ot){const Ut=Fe,Re=He;Fe=l(Z,Fe);const gi=Ut===Fe;He=l(Z,gi?He:0),je=l(Z,gi&&Re===He?je:0),ei=[Fe,He,je]}if(Yt.callsite=ei,d(Z,Ge)){Jt=[];do{qe=me,ct=Je;const Ut=l(Z,0);let Re;if(Ut<-1){Re=[[l(Z,0)]];for(let gi=-1;gi>Ut;gi--){const it=qe;qe=l(Z,qe),ct=l(Z,qe===it?ct:0);const Pe=l(Z,0);Re.push([Pe,qe,ct])}}else Re=[[Ut]];Jt.push(Re)}while(d(Z,Ge))}Yt.bindings=Jt,ie.push(Yt),le.push(Yt)}me++,Z.pos=Ge+1}while(Z.pos<j);return ie}function k(G){if(G.length===0)return"";const j=new y;for(let Z=0;Z<G.length;)Z=$(G,Z,j,[0,0,0,0,0,0,0]);return j.flush()}function $(G,j,Z,ie){const le=G[j],{0:me,1:be,2:fe,3:Fe,isScope:He,callsite:je,bindings:qe}=le;ie[0]<me?(W(Z,ie[0],me),ie[0]=me,ie[1]=0):j>0&&Z.write(44),ie[1]=u(Z,le[1],ie[1]);const ct=(le.length===6?1:0)|(je?2:0)|(He?4:0);if(u(Z,ct,0),le.length===6){const{4:Ge,5:Je}=le;Ge!==ie[2]&&(ie[3]=0),ie[2]=u(Z,Ge,ie[2]),ie[3]=u(Z,Je,ie[3])}if(je){const{0:Ge,1:Je,2:mt}=le.callsite;Ge!==ie[4]?(ie[5]=0,ie[6]=0):Je!==ie[5]&&(ie[6]=0),ie[4]=u(Z,Ge,ie[4]),ie[5]=u(Z,Je,ie[5]),ie[6]=u(Z,mt,ie[6])}if(qe)for(const Ge of qe){Ge.length>1&&u(Z,-Ge.length,0);const Je=Ge[0][0];u(Z,Je,0);let mt=me,wt=be;for(let Ot=1;Ot<Ge.length;Ot++){const Qt=Ge[Ot];mt=u(Z,Qt[1],mt),wt=u(Z,Qt[2],wt),u(Z,Qt[0],0)}}for(j++;j<G.length;){const Ge=G[j],{0:Je,1:mt}=Ge;if(Je>fe||Je===fe&&mt>=Fe)break;j=$(G,j,Z,ie)}return ie[0]<fe?(W(Z,ie[0],fe),ie[0]=fe,ie[1]=0):Z.write(44),ie[1]=u(Z,Fe,ie[1]),j}function W(G,j,Z){do G.write(59);while(++j<Z)}function Q(G){const{length:j}=G,Z=new w(G),ie=[];let le=0,me=0,be=0,fe=0,Fe=0;do{const He=Z.indexOf(";"),je=[];let qe=!0,ct=0;for(le=0;Z.pos<He;){let Ge;le=l(Z,le),le<ct&&(qe=!1),ct=le,d(Z,He)?(me=l(Z,me),be=l(Z,be),fe=l(Z,fe),d(Z,He)?(Fe=l(Z,Fe),Ge=[le,me,be,fe,Fe]):Ge=[le,me,be,fe]):Ge=[le],je.push(Ge),Z.pos++}qe||Y(je),ie.push(je),Z.pos=He+1}while(Z.pos<=j);return ie}function Y(G){G.sort(M)}function M(G,j){return G[0]-j[0]}function D(G){const j=new y;let Z=0,ie=0,le=0,me=0;for(let be=0;be<G.length;be++){const fe=G[be];if(be>0&&j.write(59),fe.length===0)continue;let Fe=0;for(let He=0;He<fe.length;He++){const je=fe[He];He>0&&j.write(44),Fe=u(j,je[0],Fe),je.length!==1&&(Z=u(j,je[1],Z),ie=u(j,je[2],ie),le=u(j,je[3],le),je.length!==4&&(me=u(j,je[4],me)))}}return j.flush()}i.decode=Q,i.decodeGeneratedRanges=F,i.decodeOriginalScopes=O,i.encode=D,i.encodeGeneratedRanges=k,i.encodeOriginalScopes=P,Object.defineProperty(i,"__esModule",{value:!0})})})(HT,HT.exports);var fte=HT.exports,pte={exports:{}},Sw={exports:{}},IM={exports:{}},e5e=IM.exports,fq;function t5e(){return fq||(fq=1,function(t,e){(function(i,n){t.exports=n()})(e5e,function(){const i=/^[\w+.-]+:\/\//,n=/^([\w+.-]+:)\/\/([^@/#?]*@)?([^:/#?]*)(:\d+)?(\/[^#?]*)?(\?[^#]*)?(#.*)?/,r=/^file:(?:\/\/((?![a-z]:)[^/#?]*)?)?(\/?[^#?]*)(\?[^#]*)?(#.*)?/i;function s(N){return i.test(N)}function o(N){return N.startsWith("//")}function a(N){return N.startsWith("/")}function l(N){return N.startsWith("file:")}function u(N){return/^[.?#]/.test(N)}function d(N){const F=n.exec(N);return v(F[1],F[2]||"",F[3],F[4]||"",F[5]||"/",F[6]||"",F[7]||"")}function p(N){const F=r.exec(N),k=F[2];return v("file:","",F[1]||"","",a(k)?k:"/"+k,F[3]||"",F[4]||"")}function v(N,F,k,$,W,Q,Y){return{scheme:N,user:F,host:k,port:$,path:W,query:Q,hash:Y,type:7}}function y(N){if(o(N)){const k=d("http:"+N);return k.scheme="",k.type=6,k}if(a(N)){const k=d("http://foo.com"+N);return k.scheme="",k.host="",k.type=5,k}if(l(N))return p(N);if(s(N))return d(N);const F=d("http://foo.com/"+N);return F.scheme="",F.host="",F.type=N?N.startsWith("?")?3:N.startsWith("#")?2:4:1,F}function w(N){if(N.endsWith("/.."))return N;const F=N.lastIndexOf("/");return N.slice(0,F+1)}function R(N,F){O(F,F.type),N.path==="/"?N.path=F.path:N.path=w(F.path)+N.path}function O(N,F){const k=F<=4,$=N.path.split("/");let W=1,Q=0,Y=!1;for(let D=1;D<$.length;D++){const G=$[D];if(!G){Y=!0;continue}if(Y=!1,G!=="."){if(G===".."){Q?(Y=!0,Q--,W--):k&&($[W++]=G);continue}$[W++]=G,Q++}}let M="";for(let D=1;D<W;D++)M+="/"+$[D];(!M||Y&&!M.endsWith("/.."))&&(M+="/"),N.path=M}function P(N,F){if(!N&&!F)return"";const k=y(N);let $=k.type;if(F&&$!==7){const Q=y(F),Y=Q.type;switch($){case 1:k.hash=Q.hash;case 2:k.query=Q.query;case 3:case 4:R(k,Q);case 5:k.user=Q.user,k.host=Q.host,k.port=Q.port;case 6:k.scheme=Q.scheme}Y>$&&($=Y)}O(k,$);const W=k.query+k.hash;switch($){case 2:case 3:return W;case 4:{const Q=k.path.slice(1);return Q?u(F||N)&&!u(Q)?"./"+Q+W:Q+W:W||"."}case 5:return k.path+W;default:return k.scheme+"//"+k.user+k.host+k.port+k.path+W}}return P})}(IM)),IM.exports}var i5e=Sw.exports,pq;function mte(){return pq||(pq=1,function(t,e){(function(i,n){n(e,fte,t5e())})(i5e,function(i,n,r){function s(xe,Be){return Be&&!Be.endsWith("/")&&(Be+="/"),r(xe,Be)}function o(xe){if(!xe)return"";const Be=xe.lastIndexOf("/");return xe.slice(0,Be+1)}const a=0,l=1,u=2,d=3,p=4,v=1,y=2;function w(xe,Be){const $e=R(xe,0);if($e===xe.length)return xe;Be||(xe=xe.slice());for(let Ze=$e;Ze<xe.length;Ze=R(xe,Ze+1))xe[Ze]=P(xe[Ze],Be);return xe}function R(xe,Be){for(let $e=Be;$e<xe.length;$e++)if(!O(xe[$e]))return $e;return xe.length}function O(xe){for(let Be=1;Be<xe.length;Be++)if(xe[Be][a]<xe[Be-1][a])return!1;return!0}function P(xe,Be){return Be||(xe=xe.slice()),xe.sort(N)}function N(xe,Be){return xe[a]-Be[a]}let F=!1;function k(xe,Be,$e,Ze){for(;$e<=Ze;){const Lt=$e+(Ze-$e>>1),ot=xe[Lt][a]-Be;if(ot===0)return F=!0,Lt;ot<0?$e=Lt+1:Ze=Lt-1}return F=!1,$e-1}function $(xe,Be,$e){for(let Ze=$e+1;Ze<xe.length&&xe[Ze][a]===Be;$e=Ze++);return $e}function W(xe,Be,$e){for(let Ze=$e-1;Ze>=0&&xe[Ze][a]===Be;$e=Ze--);return $e}function Q(){return{lastKey:-1,lastNeedle:-1,lastIndex:-1}}function Y(xe,Be,$e,Ze){const{lastKey:Lt,lastNeedle:ot,lastIndex:Nt}=$e;let fi=0,Pt=xe.length-1;if(Ze===Lt){if(Be===ot)return F=Nt!==-1&&xe[Nt][a]===Be,Nt;Be>=ot?fi=Nt===-1?0:Nt:Pt=Nt}return $e.lastKey=Ze,$e.lastNeedle=Be,$e.lastIndex=k(xe,Be,fi,Pt)}function M(xe,Be){const $e=Be.map(G);for(let Ze=0;Ze<xe.length;Ze++){const Lt=xe[Ze];for(let ot=0;ot<Lt.length;ot++){const Nt=Lt[ot];if(Nt.length===1)continue;const fi=Nt[l],Pt=Nt[u],ni=Nt[d],ti=$e[fi],nt=ti[Pt]||(ti[Pt]=[]),Ce=Be[fi];let oe=$(nt,ni,Y(nt,ni,Ce,Pt));Ce.lastIndex=++oe,D(nt,oe,[ni,Ze,Nt[a]])}}return $e}function D(xe,Be,$e){for(let Ze=xe.length;Ze>Be;Ze--)xe[Ze]=xe[Ze-1];xe[Be]=$e}function G(){return{__proto__:null}}const j=function(xe,Be){const $e=Z(xe);if(!("sections"in $e))return new qe($e,Be);const Ze=[],Lt=[],ot=[],Nt=[],fi=[];ie($e,Be,Ze,Lt,ot,Nt,fi,0,0,1/0,1/0);const Pt={version:3,file:$e.file,names:Nt,sources:Lt,sourcesContent:ot,mappings:Ze,ignoreList:fi};return Re(Pt)};function Z(xe){return typeof xe=="string"?JSON.parse(xe):xe}function ie(xe,Be,$e,Ze,Lt,ot,Nt,fi,Pt,ni,ti){const{sections:nt}=xe;for(let Ce=0;Ce<nt.length;Ce++){const{map:oe,offset:re}=nt[Ce];let ee=ni,te=ti;if(Ce+1<nt.length){const Se=nt[Ce+1].offset;ee=Math.min(ni,fi+Se.line),ee===ni?te=Math.min(ti,Pt+Se.column):ee<ni&&(te=Pt+Se.column)}le(oe,Be,$e,Ze,Lt,ot,Nt,fi+re.line,Pt+re.column,ee,te)}}function le(xe,Be,$e,Ze,Lt,ot,Nt,fi,Pt,ni,ti){const nt=Z(xe);if("sections"in nt)return ie(...arguments);const Ce=new qe(nt,Be),oe=Ze.length,re=ot.length,ee=Je(Ce),{resolvedSources:te,sourcesContent:Se,ignoreList:ve}=Ce;if(me(Ze,te),me(ot,Ce.names),Se)me(Lt,Se);else for(let Ae=0;Ae<te.length;Ae++)Lt.push(null);if(ve)for(let Ae=0;Ae<ve.length;Ae++)Nt.push(ve[Ae]+oe);for(let Ae=0;Ae<ee.length;Ae++){const ke=fi+Ae;if(ke>ni)return;const Xe=be($e,ke),ut=Ae===0?Pt:0,lt=ee[Ae];for(let Tt=0;Tt<lt.length;Tt++){const zt=lt[Tt],ii=ut+zt[a];if(ke===ni&&ii>=ti)return;if(zt.length===1){Xe.push([ii]);continue}const xt=oe+zt[l],tn=zt[u],Ni=zt[d];Xe.push(zt.length===4?[ii,xt,tn,Ni]:[ii,xt,tn,Ni,re+zt[p]])}}}function me(xe,Be){for(let $e=0;$e<Be.length;$e++)xe.push(Be[$e])}function be(xe,Be){for(let $e=xe.length;$e<=Be;$e++)xe[$e]=[];return xe[Be]}const fe="`line` must be greater than 0 (lines start at line 1)",Fe="`column` must be greater than or equal to 0 (columns start at column 0)",He=-1,je=1;class qe{constructor(Be,$e){const Ze=typeof Be=="string";if(!Ze&&Be._decodedMemo)return Be;const Lt=Ze?JSON.parse(Be):Be,{version:ot,file:Nt,names:fi,sourceRoot:Pt,sources:ni,sourcesContent:ti}=Lt;this.version=ot,this.file=Nt,this.names=fi||[],this.sourceRoot=Pt,this.sources=ni,this.sourcesContent=ti,this.ignoreList=Lt.ignoreList||Lt.x_google_ignoreList||void 0;const nt=s(Pt||"",o($e));this.resolvedSources=ni.map(oe=>s(oe||"",nt));const{mappings:Ce}=Lt;typeof Ce=="string"?(this._encoded=Ce,this._decoded=void 0):(this._encoded=void 0,this._decoded=w(Ce,Ze)),this._decodedMemo=Q(),this._bySources=void 0,this._bySourceMemos=void 0}}function ct(xe){return xe}function Ge(xe){var Be,$e;return(Be=($e=xe)._encoded)!==null&&Be!==void 0?Be:$e._encoded=n.encode(xe._decoded)}function Je(xe){var Be;return(Be=xe)._decoded||(Be._decoded=n.decode(xe._encoded))}function mt(xe,Be,$e){const Ze=Je(xe);if(Be>=Ze.length)return null;const Lt=Ze[Be],ot=st(Lt,xe._decodedMemo,Be,$e,je);return ot===-1?null:Lt[ot]}function wt(xe,Be){let{line:$e,column:Ze,bias:Lt}=Be;if($e--,$e<0)throw new Error(fe);if(Ze<0)throw new Error(Fe);const ot=Je(xe);if($e>=ot.length)return Ye(null,null,null,null);const Nt=ot[$e],fi=st(Nt,xe._decodedMemo,$e,Ze,Lt||je);if(fi===-1)return Ye(null,null,null,null);const Pt=Nt[fi];if(Pt.length===1)return Ye(null,null,null,null);const{names:ni,resolvedSources:ti}=xe;return Ye(ti[Pt[l]],Pt[u]+1,Pt[d],Pt.length===5?ni[Pt[p]]:null)}function Ot(xe,Be){const{source:$e,line:Ze,column:Lt,bias:ot}=Be;return he(xe,$e,Ze,Lt,ot||je,!1)}function Qt(xe,Be){const{source:$e,line:Ze,column:Lt,bias:ot}=Be;return he(xe,$e,Ze,Lt,ot||He,!0)}function ei(xe,Be){const $e=Je(xe),{names:Ze,resolvedSources:Lt}=xe;for(let ot=0;ot<$e.length;ot++){const Nt=$e[ot];for(let fi=0;fi<Nt.length;fi++){const Pt=Nt[fi],ni=ot+1,ti=Pt[0];let nt=null,Ce=null,oe=null,re=null;Pt.length!==1&&(nt=Lt[Pt[1]],Ce=Pt[2]+1,oe=Pt[3]),Pt.length===5&&(re=Ze[Pt[4]]),Be({generatedLine:ni,generatedColumn:ti,source:nt,originalLine:Ce,originalColumn:oe,name:re})}}}function Jt(xe,Be){const{sources:$e,resolvedSources:Ze}=xe;let Lt=$e.indexOf(Be);return Lt===-1&&(Lt=Ze.indexOf(Be)),Lt}function Yt(xe,Be){const{sourcesContent:$e}=xe;if($e==null)return null;const Ze=Jt(xe,Be);return Ze===-1?null:$e[Ze]}function Ut(xe,Be){const{ignoreList:$e}=xe;if($e==null)return!1;const Ze=Jt(xe,Be);return Ze===-1?!1:$e.includes(Ze)}function Re(xe,Be){const $e=new qe(Pe(xe,[]),Be);return $e._decoded=xe.mappings,$e}function gi(xe){return Pe(xe,Je(xe))}function it(xe){return Pe(xe,Ge(xe))}function Pe(xe,Be){return{version:xe.version,file:xe.file,names:xe.names,sourceRoot:xe.sourceRoot,sources:xe.sources,sourcesContent:xe.sourcesContent,mappings:Be,ignoreList:xe.ignoreList||xe.x_google_ignoreList}}function Ye(xe,Be,$e,Ze){return{source:xe,line:Be,column:$e,name:Ze}}function Ct(xe,Be){return{line:xe,column:Be}}function st(xe,Be,$e,Ze,Lt){let ot=Y(xe,Ze,Be,$e);return F?ot=(Lt===He?$:W)(xe,Ze,ot):Lt===He&&ot++,ot===-1||ot===xe.length?-1:ot}function we(xe,Be,$e,Ze,Lt){let ot=st(xe,Be,$e,Ze,je);if(!F&&Lt===He&&ot++,ot===-1||ot===xe.length)return[];const Nt=F?Ze:xe[ot][a];F||(ot=W(xe,Nt,ot));const fi=$(xe,Nt,ot),Pt=[];for(;ot<=fi;ot++){const ni=xe[ot];Pt.push(Ct(ni[v]+1,ni[y]))}return Pt}function he(xe,Be,$e,Ze,Lt,ot){var Nt;if($e--,$e<0)throw new Error(fe);if(Ze<0)throw new Error(Fe);const{sources:fi,resolvedSources:Pt}=xe;let ni=fi.indexOf(Be);if(ni===-1&&(ni=Pt.indexOf(Be)),ni===-1)return ot?[]:Ct(null,null);const nt=((Nt=xe)._bySources||(Nt._bySources=M(Je(xe),xe._bySourceMemos=fi.map(Q))))[ni][$e];if(nt==null)return ot?[]:Ct(null,null);const Ce=xe._bySourceMemos[ni];if(ot)return we(nt,Ce,$e,Ze,Lt);const oe=st(nt,Ce,$e,Ze,Lt);if(oe===-1)return Ct(null,null);const re=nt[oe];return Ct(re[v]+1,re[y])}i.AnyMap=j,i.GREATEST_LOWER_BOUND=je,i.LEAST_UPPER_BOUND=He,i.TraceMap=qe,i.allGeneratedPositionsFor=Qt,i.decodedMap=gi,i.decodedMappings=Je,i.eachMapping=ei,i.encodedMap=it,i.encodedMappings=Ge,i.generatedPositionFor=Ot,i.isIgnored=Ut,i.originalPositionFor=wt,i.presortedDecodedMap=Re,i.sourceContentFor=Yt,i.traceSegment=mt})}(Sw,Sw.exports)),Sw.exports}var Ow={exports:{}},Mw={exports:{}},n5e=Mw.exports,mq;function r5e(){return mq||(mq=1,function(t,e){(function(i,n){n(e)})(n5e,function(i){class n{constructor(){this._indexes={__proto__:null},this.array=[]}}function r(u){return u}function s(u,d){return u._indexes[d]}function o(u,d){const p=s(u,d);if(p!==void 0)return p;const{array:v,_indexes:y}=u,w=v.push(d);return y[d]=w-1}function a(u){const{array:d,_indexes:p}=u;if(d.length===0)return;const v=d.pop();p[v]=void 0}function l(u,d){const p=s(u,d);if(p===void 0)return;const{array:v,_indexes:y}=u;for(let w=p+1;w<v.length;w++){const R=v[w];v[w-1]=R,y[R]--}y[d]=void 0,v.pop()}i.SetArray=n,i.get=s,i.pop=a,i.put=o,i.remove=l,Object.defineProperty(i,"__esModule",{value:!0})})}(Mw,Mw.exports)),Mw.exports}var s5e=Ow.exports,gq;function o5e(){return gq||(gq=1,function(t,e){(function(i,n){n(e,r5e(),fte,mte())})(s5e,function(i,n,r,s){class v{constructor({file:fe,sourceRoot:Fe}={}){this._names=new n.SetArray,this._sources=new n.SetArray,this._sourcesContent=[],this._mappings=[],this.file=fe,this.sourceRoot=Fe,this._ignoreList=new n.SetArray}}function y(be){return be}function w(be,fe,Fe,He,je,qe,ct,Ge){return Y(!1,be,fe,Fe,He,je,qe,ct,Ge)}function R(be,fe){return me(!1,be,fe)}const O=(be,fe,Fe,He,je,qe,ct,Ge)=>Y(!0,be,fe,Fe,He,je,qe,ct,Ge),P=(be,fe)=>me(!0,be,fe);function N(be,fe,Fe){const{_sources:He,_sourcesContent:je}=be,qe=n.put(He,fe);je[qe]=Fe}function F(be,fe,Fe=!0){const{_sources:He,_sourcesContent:je,_ignoreList:qe}=be,ct=n.put(He,fe);ct===je.length&&(je[ct]=null),Fe?n.put(qe,ct):n.remove(qe,ct)}function k(be){const{_mappings:fe,_sources:Fe,_sourcesContent:He,_names:je,_ignoreList:qe}=be;return j(fe),{version:3,file:be.file||void 0,names:je.array,sourceRoot:be.sourceRoot||void 0,sources:Fe.array,sourcesContent:He,mappings:fe,ignoreList:qe.array}}function $(be){const fe=k(be);return Object.assign(Object.assign({},fe),{mappings:r.encode(fe.mappings)})}function W(be){const fe=new s.TraceMap(be),Fe=new v({file:fe.file,sourceRoot:fe.sourceRoot});return Z(Fe._names,fe.names),Z(Fe._sources,fe.sources),Fe._sourcesContent=fe.sourcesContent||fe.sources.map(()=>null),Fe._mappings=s.decodedMappings(fe),fe.ignoreList&&Z(Fe._ignoreList,fe.ignoreList),Fe}function Q(be){const fe=[],{_mappings:Fe,_sources:He,_names:je}=be;for(let qe=0;qe<Fe.length;qe++){const ct=Fe[qe];for(let Ge=0;Ge<ct.length;Ge++){const Je=ct[Ge],mt={line:qe+1,column:Je[0]};let wt,Ot,Qt;Je.length!==1&&(wt=He.array[Je[1]],Ot={line:Je[2]+1,column:Je[3]},Je.length===5&&(Qt=je.array[Je[4]])),fe.push({generated:mt,source:wt,original:Ot,name:Qt})}}return fe}function Y(be,fe,Fe,He,je,qe,ct,Ge,Je){const{_mappings:mt,_sources:wt,_sourcesContent:Ot,_names:Qt}=fe,ei=M(mt,Fe),Jt=D(ei,He);if(!je)return be&&ie(ei,Jt)?void 0:G(ei,Jt,[He]);const Yt=n.put(wt,je),Ut=Ge?n.put(Qt,Ge):-1;if(Yt===Ot.length&&(Ot[Yt]=Je??null),!(be&&le(ei,Jt,Yt,qe,ct,Ut)))return G(ei,Jt,Ge?[He,Yt,qe,ct,Ut]:[He,Yt,qe,ct])}function M(be,fe){for(let Fe=be.length;Fe<=fe;Fe++)be[Fe]=[];return be[fe]}function D(be,fe){let Fe=be.length;for(let He=Fe-1;He>=0;Fe=He--){const je=be[He];if(fe>=je[0])break}return Fe}function G(be,fe,Fe){for(let He=be.length;He>fe;He--)be[He]=be[He-1];be[fe]=Fe}function j(be){const{length:fe}=be;let Fe=fe;for(let He=Fe-1;He>=0&&!(be[He].length>0);Fe=He,He--);Fe<fe&&(be.length=Fe)}function Z(be,fe){for(let Fe=0;Fe<fe.length;Fe++)n.put(be,fe[Fe])}function ie(be,fe){return fe===0?!0:be[fe-1].length===1}function le(be,fe,Fe,He,je,qe){if(fe===0)return!1;const ct=be[fe-1];return ct.length===1?!1:Fe===ct[1]&&He===ct[2]&&je===ct[3]&&qe===(ct.length===5?ct[4]:-1)}function me(be,fe,Fe){const{generated:He,source:je,original:qe,name:ct,content:Ge}=Fe;return je?Y(be,fe,He.line-1,He.column,je,qe.line-1,qe.column,ct,Ge):Y(be,fe,He.line-1,He.column,null,null,null,null,null)}i.GenMapping=v,i.addMapping=R,i.addSegment=w,i.allMappings=Q,i.fromMap=W,i.maybeAddMapping=P,i.maybeAddSegment=O,i.setIgnore=F,i.setSourceContent=N,i.toDecodedMap=k,i.toEncodedMap=$,Object.defineProperty(i,"__esModule",{value:!0})})}(Ow,Ow.exports)),Ow.exports}var a5e=pte.exports;(function(t,e){(function(i,n){t.exports=n(mte(),o5e())})(a5e,function(i,n){const r=o("",-1,-1,"",null,!1),s=[];function o(P,N,F,k,$,W){return{source:P,line:N,column:F,name:k,content:$,ignore:W}}function a(P,N,F,k,$){return{map:P,sources:N,source:F,content:k,ignore:$}}function l(P,N){return a(P,N,"",null,!1)}function u(P,N,F){return a(null,s,P,N,F)}function d(P){const N=new n.GenMapping({file:P.map.file}),{sources:F,map:k}=P,$=k.names,W=i.decodedMappings(k);for(let Q=0;Q<W.length;Q++){const Y=W[Q];for(let M=0;M<Y.length;M++){const D=Y[M],G=D[0];let j=r;if(D.length!==1){const Fe=F[D[1]];if(j=p(Fe,D[2],D[3],D.length===5?$[D[4]]:""),j==null)continue}const{column:Z,line:ie,name:le,content:me,source:be,ignore:fe}=j;n.maybeAddSegment(N,Q,G,be,ie,Z,le),be&&me!=null&&n.setSourceContent(N,be,me),fe&&n.setIgnore(N,be,!0)}}return N}function p(P,N,F,k){if(!P.map)return o(P.source,N,F,k,P.content,P.ignore);const $=i.traceSegment(P.map,N,F);return $==null?null:$.length===1?r:p(P.sources[$[1]],$[2],$[3],$.length===5?P.map.names[$[4]]:k)}function v(P){return Array.isArray(P)?P:[P]}function y(P,N){const F=v(P).map(W=>new i.TraceMap(W,"")),k=F.pop();for(let W=0;W<F.length;W++)if(F[W].sources.length>1)throw new Error(`Transformation map ${W} must have exactly one source file.
Did you specify these with the most recent transformation maps first?`);let $=w(k,N,"",0);for(let W=F.length-1;W>=0;W--)$=l(F[W],[$]);return $}function w(P,N,F,k){const{resolvedSources:$,sourcesContent:W,ignoreList:Q}=P,Y=k+1,M=$.map((D,G)=>{const j={importer:F,depth:Y,source:D||"",content:void 0,ignore:void 0},Z=N(j.source,j),{source:ie,content:le,ignore:me}=j;if(Z)return w(new i.TraceMap(Z,ie),N,ie,Y);const be=le!==void 0?le:W?W[G]:null,fe=me!==void 0?me:Q?Q.includes(G):!1;return u(ie,be,fe)});return l(P,M)}class R{constructor(N,F){const k=F.decodedMappings?n.toDecodedMap(N):n.toEncodedMap(N);this.version=k.version,this.file=k.file,this.mappings=k.mappings,this.names=k.names,this.ignoreList=k.ignoreList,this.sourceRoot=k.sourceRoot,this.sources=k.sources,F.excludeContent||(this.sourcesContent=k.sourcesContent)}toString(){return JSON.stringify(this)}}function O(P,N,F){const k=typeof F=="object"?F:{excludeContent:!!F,decodedMappings:!1},$=y(P,N);return new R(d($),k)}return O})})(pte);const l5e={filename:i_("(unknown)"),rootDir:i_(typeof process<"u"?process.cwd?.():typeof Deno<"u"?Deno.cwd():void 0),dev:Yu(!1),generate:Bg("client",(t,e)=>t==="dom"||t==="ssr"?(KU(YEe),t==="dom"?"client":"server"):(t!=="client"&&t!=="server"&&t!==!1&&xh(`${e} must be "client", "server" or false`),t)),warningFilter:gte(()=>!0)};xq({...l5e,accessors:yq(jEe,Yu(!1)),css:Bg("external",t=>((t===!0||t===!1)&&xh('The boolean options have been removed from the css option. Use "external" instead of false and "injected" instead of true'),t==="none"&&xh('css: "none" is no longer a valid option. If this was crucial for you, please open an issue on GitHub with your use case.'),t!=="external"&&t!=="injected"&&xh('css should be either "external" (default, recommended) or "injected"'),t)),cssHash:gte(({css:t,hash:e})=>`svelte-${e(t)}`),cssOutputFilename:i_(void 0),customElement:Yu(!1),discloseVersion:Yu(!0),immutable:yq(QEe,Yu(!1)),legacy:ay("The legacy option has been removed. If you are using this because of legacy.componentApi, use compatibility.componentApi instead"),compatibility:xq({componentApi:bq([4,5],5)}),loopGuardTimeout:AN(KEe),name:i_(void 0),namespace:bq(["html","mathml","svg"]),modernAst:Yu(!1),outputFilename:i_(void 0),preserveComments:Yu(!1),preserveWhitespace:Yu(!1),runes:Yu(void 0),hmr:Yu(!1),sourcemap:Bg(void 0,t=>t),enableSourcemap:AN(ZEe),hydratable:AN(XEe),format:ay('The format option has been removed in Svelte 4, the compiler only outputs ESM now. Remove "format" from your compiler options. If you did not set this yourself, bump the version of your bundler plugin (vite-plugin-svelte/rollup-plugin-svelte/svelte-loader)'),tag:ay('The tag option has been removed in Svelte 5. Use `<svelte:options customElement="tag-name" />` inside the component instead. If that does not solve your use case, please open an issue on GitHub with details.'),sveltePath:ay("The sveltePath option has been removed in Svelte 5. If this option was crucial for you, please open an issue on GitHub with your use case."),errorMode:ay("The errorMode option has been removed. If you are using this through svelte-preprocess with TypeScript, use the https://www.typescriptlang.org/tsconfig#verbatimModuleSyntax setting instead"),varsReport:ay("The vars option has been removed. If you are using this through svelte-preprocess with TypeScript, use the https://www.typescriptlang.org/tsconfig#verbatimModuleSyntax setting instead")});function ay(t){return e=>{e!==void 0&&oIe(null,t)}}const vq=new Set;function KU(t){vq.has(t)||(vq.add(t),t(null))}function AN(t){return e=>{e!==void 0&&KU(t)}}function yq(t,e){return(i,n)=>(i!==void 0&&KU(t),e(i,n))}function xq(t,e=!1){return(i,n)=>{const r={};(i&&typeof i!="object"||Array.isArray(i))&&xh(`${n} should be an object`);for(const s in i)s in t||(e?r[s]=i[s]:aIe(null,`${n?`${n}.${s}`:s}`));for(const s in t){const o=t[s];r[s]=o(i&&i[s],n?`${n}.${s}`:s)}return r}}function Bg(t,e){return(i,n)=>i===void 0?t:e(i,n)}function i_(t,e=!0){return Bg(t,(i,n)=>(typeof i!="string"&&xh(`${n} should be a string, if specified`),!e&&i===""&&xh(`${n} cannot be empty`),i))}function Yu(t){return Bg(t,(e,i)=>(typeof e!="boolean"&&xh(`${i} should be true or false, if specified`),e))}function bq(t,e=t[0]){return Bg(e,(i,n)=>{if(!t.includes(i)){const r=t.length>2?`${n} should be one of ${t.slice(0,-1).map(s=>`"${s}"`).join(", ")} or "${t[t.length-1]}"`:`${n} should be either "${t[0]}" or "${t[1]}"`;xh(r)}return i})}function gte(t){return Bg(t,(e,i)=>(typeof e!="function"&&xh(`${i} should be a function, if specified`),e))}function xh(t){sIe(null,t)}function Ju(t){if(typeof t!="object")return t;var e,i,n=Object.prototype.toString.call(t);if(n==="[object Object]"){if(t.constructor!==Object&&typeof t.constructor=="function"){i=new t.constructor;for(e in t)t.hasOwnProperty(e)&&i[e]!==t[e]&&(i[e]=Ju(t[e]))}else{i={};for(e in t)e==="__proto__"?Object.defineProperty(i,e,{value:Ju(t[e]),configurable:!0,enumerable:!0,writable:!0}):i[e]=Ju(t[e])}return i}if(n==="[object Array]"){for(e=t.length,i=Array(e);e--;)i[e]=Ju(t[e]);return i}return n==="[object Set]"?(i=new Set,t.forEach(function(r){i.add(Ju(r))}),i):n==="[object Map]"?(i=new Map,t.forEach(function(r,s){i.set(Ju(s),Ju(r))}),i):n==="[object Date]"?new Date(+t):n==="[object RegExp]"?(i=new RegExp(t.source,t.flags),i.lastIndex=t.lastIndex,i):n==="[object DataView]"?new t.constructor(Ju(t.buffer)):n==="[object ArrayBuffer]"?t.slice(0):n.slice(-6)==="Array]"?new t.constructor(t):t}function IN(t){if(t===null||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.iterator in t?!1:Symbol.toStringTag in t?Object.prototype.toString.call(t)==="[object Module]":!0}function Yz(t,e,i=".",n){if(!IN(e))return Yz(t,{},i,n);const r=Object.assign({},e);for(const s in t){if(s==="__proto__"||s==="constructor")continue;const o=t[s];o!=null&&(n&&n(r,s,o,i)||(Array.isArray(o)&&Array.isArray(r[s])?r[s]=[...o,...r[s]]:IN(o)&&IN(r[s])?r[s]=Yz(o,r[s],(i?`${i}.`:"")+s.toString(),n):r[s]=o))}return r}function c5e(t){return(...e)=>e.reduce((i,n)=>Yz(i,n,"",t),{})}const kN=c5e(),Qb={},u5e="svelte-cloudinary-v2-config";function wq(t){return t.includes("-")?t.split("-")[0]:t}const h5e=Object.freeze({techVersion:wq(Dae),sdkSemver:wq(BEe),sdkCode:"E",product:"B",feature:""});function d5e(){return{cloud:{cloudName:"dzoumeu1e",apiKey:Qb?.VITE_CLOUDINARY_API_KEY||Qb?.VITE_PUBLIC_CLOUDINARY_API_KEY},url:{privateCdn:!!Qb?.VITE_CLOUDINARY_PRIVATE_CDN,secureDistribution:Qb?.VITE_CLOUDINARY_SECURE_DISTRIBUTION},extra:{uploadPreset:Qb?.VITE_CLOUDINARY_UPLOAD_PRESET}}}function f5e(t,e){const i=p5e(),n=d5e(),r=kN(Ju(t),{cloud:{cloudName:i?.cloudName,apiKey:i?.apiKey}},{cloud:i?.cloud,url:i?.url},{cloud:n.cloud,url:n.url}),s=kN(Ju(e),i?.analytics,h5e),o=kN({uploadPreset:i?.uploadPreset},n.extra);return{config:r,analytics:s,extra:o}}function p5e(){try{return Xi(u5e)??null}catch{return null}}function m5e({uploadSignature:t,...e},i){const n=typeof t=="function",{cloudName:r,apiKey:s}=i?.cloud||{};if(!r)throw new Error("A Cloudinary Cloud name is required, please make sure your environment variable is set and configured in your environment.");if(n&&!s)throw new Error("A Cloudinary API Key is required for signed requests, please make sure your environment variable is set and configured in your environment.");if(!n&&!e.uploadPreset)throw new Error("A Cloudinary Upload Preset is required for unsigned uploads. Please specify an uploadPreset or configure signed uploads.");const o={cloudName:r,apiKey:s,...e};return n&&(o.uploadSignature=t),o}var vte={abort:"onAbort","batch-cancelled":"onBatchCancelled",close:"onClose","display-changed":"onDisplayChanged",publicid:"onPublicId","queues-end":"onQueuesEnd","queues-start":"onQueuesStart",retry:"onRetry","show-completed":"onShowCompleted","source-changed":"onSourceChanged",success:"onSuccess",tags:"onTags","upload-added":"onUploadAdded"};function g5e(t){return function(i,n){i&&typeof t.onError=="function"&&t.onError(i,n),typeof t.onResult=="function"&&t.onResult(n);const r=typeof n?.event=="string"&&vte[n.event];if(typeof r=="string"&&typeof t[r]=="function"){const s=t[r];s(n)}}}function v5e({signatureEndpoint:t,fetch:e}){return function(n,r){if(typeof t>"u")throw Error("Failed to generate signature: signatureEndpoint property undefined.");if(typeof e>"u")throw Error("Failed to generate signature: fetch property undefined.");e(t,{method:"POST",body:JSON.stringify({paramsToSign:r}),headers:{"Content-Type":"application/json"}}).then(s=>s.json()).then(s=>{n(s.signature)}).catch(s=>{n(null,s)})}}function y5e(t){const e=document.createElement("script");e.src=t.src,e.addEventListener("load",t.onLoad,{once:!0}),e.addEventListener("error",t.onError,{once:!0}),document.head.appendChild(e)}function x5e(t,e){const i=XV(e,["children","$$slots","$$events","$$legacy"]);Pi(e,!1);const n=Gt(),r=Gt(),s=Gt(),o=Gt(),a=Gt();let l=Gt(typeof window<"u"&&!!window.cloudinary?.videoPlayer),u=Gt();const d={close:(...O)=>B(u)?.close(...O),destroy:async(...O)=>await B(u)?.destroy(...O),hide:()=>B(u)?.hide(),isDestroyed:()=>B(u)?.isDestroyed()??!0,isMinimized:()=>B(u)?.isMinimized()??!1,isShowing:()=>B(u)?.isShowing()??!1,minimize:()=>B(u)?.minimize(),show:()=>B(u)?.show(),update:(...O)=>B(u)?.update(...O),open:(...O)=>{B(u)||v(B(s)),B(u)?.open(...O),B(a).onOpen?.(B(u))}},p=vte;function v(O){if(B(u))return;const P=f5e(O),N=m5e({...B(o),uploadPreset:B(n)||P.extra.uploadPreset,uploadSignature:B(r)&&v5e({signatureEndpoint:B(r),fetch})},P.config),F=g5e({onError:k=>{const $=k?typeof k=="string"?k:k?.statusText:"Unknown Error";B(a).onError?.($,{...d,widget:B(u)})},onResult:k=>{if(typeof k?.event!="string")return;const $={...d,widget:B(u)},W=p[`${k.event}`];switch(W){case"onDisplayChanged":B(a).onDisplayChanged?.(k,$),k.info==="hidden"&&B(a).onClose?.(k,$);break;case"onSuccess":B(a).onSuccess?.(k,$),B(a).onUpload?.(k,$);break;default:{const Q=B(a)[W];Q?.(k,$);break}}}});rt(u,window.cloudinary?.createUploadWidget?.(N,F))}Xo(()=>{y5e({src:"https://upload-widget.cloudinary.com/global/all.js",onLoad(){rt(l,!0)},onError(){B(a).onError?.("Unable to load script",{...d,widget:B(u)})}})}),As(()=>{d.destroy()});let y=Gt(null);Ui(()=>(B(n),B(r),B(s),B(o),B(a),en(i)),()=>{rt(n,i.uploadPreset),rt(r,i.signatureEndpoint),rt(s,i.config),rt(o,sle(i.options,()=>({}),!0)),rt(a,tZ(i,["uploadPreset","signatureEndpoint","config","options"]))}),Ui(()=>(B(l),B(s)),()=>{B(l)&&(d.destroy(),v(B(s)))}),Ui(()=>B(l),()=>{rt(y,B(l)&&window.cloudinary||null)}),Is(),ts();var w=nn(),R=pi(w);c0(R,e,"default",iZ({get widget(){return B(u)},get cloudinary(){return B(y)},get isLoading(){return!B(l)}},()=>d),null),bt(t,w),Ei()}var b5e=hi("<button><!></button>");function w5e(t,e){const i=XV(e,["children","$$slots","$$events","$$legacy"]);Pi(e,!1);const n=Gt(),r=Gt(),s=Gt(),o=Gt(),a=Gt(),l=Gt(),u=Gt(),d=Gt(),p=Gt(),v=Gt(),y=Gt(),w=Gt(),R=Gt(),O=Gt(),P=Gt(),N=Gt(),F=Gt(),k=Gt(),$=Gt(),W=Gt(),Q=Gt();Ui(()=>(B(n),B(r),B(s),B(o),B(a),B(l),B(u),B(d),B(p),B(v),B(y),B(w),B(R),B(O),B(P),B(N),B(F),B(k),B($),B(W),B(Q),en(i)),()=>{rt(n,i.config),rt(r,i.uploadPreset),rt(s,i.signatureEndpoint),rt(o,i.options),rt(a,i.onError),rt(l,i.onOpen),rt(u,i.onAbort),rt(d,i.onBatchCancelled),rt(p,i.onClose),rt(v,i.onDisplayChanged),rt(y,i.onPublicId),rt(w,i.onQueuesEnd),rt(R,i.onQueuesStart),rt(O,i.onRetry),rt(P,i.onShowCompleted),rt(N,i.onSourceChanged),rt(F,i.onSuccess),rt(k,i.onTags),rt($,i.onUploadAdded),rt(W,i.onUpload),rt(Q,tZ(i,["config","uploadPreset","signatureEndpoint","options","onError","onOpen","onAbort","onBatchCancelled","onClose","onDisplayChanged","onPublicId","onQueuesEnd","onQueuesStart","onRetry","onShowCompleted","onSourceChanged","onSuccess","onTags","onUploadAdded","onUpload"]))}),Is(),x5e(t,{get config(){return B(n)},get uploadPreset(){return B(r)},get signatureEndpoint(){return B(s)},get options(){return B(o)},get onError(){return B(a)},get onOpen(){return B(l)},get onAbort(){return B(u)},get onBatchCancelled(){return B(d)},get onClose(){return B(p)},get onDisplayChanged(){return B(v)},get onPublicId(){return B(y)},get onQueuesEnd(){return B(w)},get onQueuesStart(){return B(R)},get onRetry(){return B(O)},get onShowCompleted(){return B(P)},get onSourceChanged(){return B(N)},get onSuccess(){return B(F)},get onTags(){return B(k)},get onUploadAdded(){return B($)},get onUpload(){return B(W)},children:ole,$$slots:{default:(Y,M)=>{const D=_h(()=>M.open),G=_h(()=>M.isLoading);var j=b5e();let Z;var ie=Di(j);c0(ie,e,"default",{},le=>{var me=WQ("Upload");bt(le,me)}),_i(j),Gi(()=>Z=Ch(j,Z,{...B(Q),disabled:B(G)})),Tn("click",j,()=>B(D)()),bt(Y,j)}}}),Ei()}function Qrt(t,e){Pi(e,!0);const i=Xi("pageContext");function n(){return e.layoutStructure}function r(){return["onupload"]}function s(){return[{name:"label",type:"string"},{name:"cloudinaryPreset",type:"string"},{name:"cloudinaryFolder",type:"string"}]}const o=Vt(()=>$n(e.layoutStructure.props?.class,i,e.dataValues,!1)+(e.layoutStructure.props?.background?` bg-[url(${e.layoutStructure.props?.background})] bg-no-repeat bg-cover bg-center`:"")),a=Vt(()=>$n(e.layoutStructure.props?.label,i,e.dataValues,!1)),l=Vt(()=>e.layoutStructure.props?.draggable),u=Vt(()=>$n(e.layoutStructure.props?.cloudinaryPreset,i,e.dataValues,!1)),d=Vt(()=>({folder:$n(e.layoutStructure.props?.cloudinaryFolder,i,e.dataValues,!1),sources:["local"],multiple:!0}));return w5e(t,{get class(){return B(o)},get draggable(){return B(l)},get uploadPreset(){return B(u)},get options(){return B(d)},onSuccess:p=>XG(e.layoutStructure.actions.onupload,i,e.dataValues),children:(p,v)=>{QV();var y=WQ();Gi(()=>zd(y,B(a))),bt(p,y)},$$slots:{default:!0}}),Ei({getLayout:n,getEvents:r,getProps:s})}function YU(t){return Object.fromEntries(Object.entries(t).filter(([e,i])=>i!=null))}var _5e=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],C5e=["difference","intersection","symmetricDifference","union"],_q=!1;class $T extends Set{#e=new Map;#t=$l(0);#n=$l(0);constructor(e){if(super(),e){for(var i of e)super.add(i);this.#n.v=super.size}_q||this.#i()}#i(){_q=!0;var e=$T.prototype,i=Set.prototype;for(const n of _5e)e[n]=function(...r){return B(this.#t),i[n].apply(this,r)};for(const n of C5e)e[n]=function(...r){B(this.#t);var s=i[n].apply(this,r);return new $T(s)}}has(e){var i=super.has(e),n=this.#e,r=n.get(e);if(r===void 0){if(!i)return B(this.#t),!1;r=$l(!0),n.set(e,r)}return B(r),i}add(e){return super.has(e)||(super.add(e),rt(this.#n,super.size),cM(this.#t)),this}delete(e){var i=super.delete(e),n=this.#e,r=n.get(e);return r!==void 0&&(n.delete(e),rt(r,!1)),i&&(rt(this.#n,super.size),cM(this.#t)),i}clear(){if(super.size!==0){super.clear();var e=this.#e;for(var i of e.values())rt(i,!1);e.clear(),rt(this.#n,0),cM(this.#t)}}keys(){return this.values()}values(){return B(this.#t),super.values()}entries(){return B(this.#t),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return B(this.#n)}}let S5e=Date.now();function JU(t){return`${t}-${S5e++}`}class Rp{#e=Fn();get value(){return B(this.#e)}set value(e){rt(this.#e,kn(e))}constructor(e){this.value=e}}class O5e{#e=Fn();get map(){return B(this.#e)}set map(e){rt(this.#e,kn(e))}#t=Fn(!1);get loaded(){return B(this.#t)}set loaded(e){rt(this.#t,kn(e))}loadedImages=new $T;#n=Fn(0);get minzoom(){return B(this.#n)}set minzoom(e){rt(this.#n,kn(e))}#i=Fn(24);get maxzoom(){return B(this.#i)}set maxzoom(e){rt(this.#i,kn(e))}layerInfo=new Map;eventTracker=new WeakMap;_eventTopMost(e){let i=this.eventTracker.get(e.originalEvent);if(i!==void 0)return i;let r=e.target.queryRenderedFeatures(e.point).find(s=>this.layerInfo.get(s.layer.id)?.interactive)?.layer.id;return this.eventTracker.set(e.originalEvent,r),r}eventTopMost;markerClickManager=new G5e;constructor(){this.eventTopMost=this._eventTopMost.bind(this)}}function M5e(t){ks(wte,t)}function T5e(){return Xi(wte)}function R5e(t){ks(_te,t)}function P5e(){return Xi(_te)}function yte(t){ks(bte,t)}function E5e(){return Xi(bte)}function A5e(t){ks(L5e,t)}function I5e(){return Xi(Cte)}function eH(t){ks(Cte,t)}function k5e(t){ks(Ste,t)}function D5e(){return Xi(Ste)}const xte=Symbol.for("svelte-maplibre"),bte=Symbol.for("svelte-maplibre.popup-target"),wte=Symbol.for("svelte-maplibre.layer"),_te=Symbol.for("svelte-maplibre.source"),L5e=Symbol.for("svelte-maplibre.cluster"),Cte=Symbol.for("svelte-maplibre.layer-event"),Ste=Symbol.for("svelte-maplibre.lng-lat");function Zd(){return Xi(xte)}function F5e(){return ks(xte,new O5e)}function N5e(){const t=new Rp(void 0),e=new Rp(void 0);return R5e(t),A5e(e),{source:t,cluster:e}}function B5e(t=!0){const e=new Rp(void 0),i=new Rp(void 0);return M5e(e),t&&(yte(e),eH(i)),{layer:e,layerEvent:i}}function z5e(){const t=new Rp(void 0),e=new Rp(void 0);return yte(t),eH(e),{marker:t,layerEvent:e}}function V5e(t){return"layerType"in t&&t.layerType==="deckgl"}class G5e{_handlers=new Set;add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const i of this._handlers)i(e)}}function U5e(t){let e=t.getCenter(),i=Math.round(t.getZoom()*100)/100,n=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,n),s=Math.round(e.lat*r)/r,o=Math.round(e.lng*r)/r,a=`${i}/${s}/${o}`,l=t.getBearing(),u=t.getPitch();return(l||u)&&(a+=`/${Math.round(l*10)/10}`),u&&(a+=`/${Math.round(u)}`),`#${a}`}function H5e(t){return t.replace("#","").split("/").map(parseFloat)}var tH={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.3.0/LICENSE.txt
 */var $5e=tH.exports;(function(t,e){(function(i,n){t.exports=n()})($5e,function(){var i={},n={};function r(o,a,l){if(n[o]=l,o==="index"){var u="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",d={};return n.shared(d),n.index(i,d),typeof window<"u"&&i.setWorkerUrl(window.URL.createObjectURL(new Blob([u],{type:"text/javascript"}))),i}}r("shared",["exports"],function(o){function a(m,h,g,x){return new(g||(g=Promise))(function(C,E){function A(H){try{V(x.next(H))}catch(X){E(X)}}function L(H){try{V(x.throw(H))}catch(X){E(X)}}function V(H){var X;H.done?C(H.value):(X=H.value,X instanceof g?X:new g(function(K){K(X)})).then(A,L)}V((x=x.apply(m,h||[])).next())})}function l(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var u,d;function p(){if(d)return u;function m(h,g){this.x=h,this.y=g}return d=1,u=m,m.prototype={clone:function(){return new m(this.x,this.y)},add:function(h){return this.clone()._add(h)},sub:function(h){return this.clone()._sub(h)},multByPoint:function(h){return this.clone()._multByPoint(h)},divByPoint:function(h){return this.clone()._divByPoint(h)},mult:function(h){return this.clone()._mult(h)},div:function(h){return this.clone()._div(h)},rotate:function(h){return this.clone()._rotate(h)},rotateAround:function(h,g){return this.clone()._rotateAround(h,g)},matMult:function(h){return this.clone()._matMult(h)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(h){return this.x===h.x&&this.y===h.y},dist:function(h){return Math.sqrt(this.distSqr(h))},distSqr:function(h){var g=h.x-this.x,x=h.y-this.y;return g*g+x*x},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith:function(h){return this.angleWithSep(h.x,h.y)},angleWithSep:function(h,g){return Math.atan2(this.x*g-this.y*h,this.x*h+this.y*g)},_matMult:function(h){var g=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=g,this},_add:function(h){return this.x+=h.x,this.y+=h.y,this},_sub:function(h){return this.x-=h.x,this.y-=h.y,this},_mult:function(h){return this.x*=h,this.y*=h,this},_div:function(h){return this.x/=h,this.y/=h,this},_multByPoint:function(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint:function(h){return this.x/=h.x,this.y/=h.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var h=this.y;return this.y=this.x,this.x=-h,this},_rotate:function(h){var g=Math.cos(h),x=Math.sin(h),C=x*this.x+g*this.y;return this.x=g*this.x-x*this.y,this.y=C,this},_rotateAround:function(h,g){var x=Math.cos(h),C=Math.sin(h),E=g.y+C*(this.x-g.x)+x*(this.y-g.y);return this.x=g.x+x*(this.x-g.x)-C*(this.y-g.y),this.y=E,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},m.convert=function(h){return h instanceof m?h:Array.isArray(h)?new m(h[0],h[1]):h},u}typeof SuppressedError=="function"&&SuppressedError;var v,y,w=l(p()),R=function(){if(y)return v;function m(h,g,x,C){this.cx=3*h,this.bx=3*(x-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*g,this.by=3*(C-g)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=g,this.p2x=x,this.p2y=C}return y=1,v=m,m.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,g){if(g===void 0&&(g=1e-6),h<0)return 0;if(h>1)return 1;for(var x=h,C=0;C<8;C++){var E=this.sampleCurveX(x)-h;if(Math.abs(E)<g)return x;var A=this.sampleCurveDerivativeX(x);if(Math.abs(A)<1e-6)break;x-=E/A}var L=0,V=1;for(x=h,C=0;C<20&&(E=this.sampleCurveX(x),!(Math.abs(E-h)<g));C++)h>E?L=x:V=x,x=.5*(V-L)+L;return x},solve:function(h,g){return this.sampleCurveY(this.solveCurveX(h,g))}},v}(),O=l(R);let P,N;function F(){return P==null&&(P=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),P}function k(){if(N==null&&(N=!1,F())){const h=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(h){for(let x=0;x<5*5;x++){const C=4*x;h.fillStyle=`rgb(${C},${C+1},${C+2})`,h.fillRect(x%5,Math.floor(x/5),1,1)}const g=h.getImageData(0,0,5,5).data;for(let x=0;x<5*5*4;x++)if(x%4!=3&&g[x]!==x){N=!0;break}}}return N||!1}var $,W=1e-6,Q=typeof Float32Array<"u"?Float32Array:Array;function Y(){var m=new Q(9);return Q!=Float32Array&&(m[1]=0,m[2]=0,m[3]=0,m[5]=0,m[6]=0,m[7]=0),m[0]=1,m[4]=1,m[8]=1,m}function M(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}function D(){var m=new Q(3);return Q!=Float32Array&&(m[0]=0,m[1]=0,m[2]=0),m}function G(m,h,g){var x=new Q(3);return x[0]=m,x[1]=h,x[2]=g,x}function j(m,h,g){var x=h[0],C=h[1],E=h[2],A=h[3];return m[0]=g[0]*x+g[4]*C+g[8]*E+g[12]*A,m[1]=g[1]*x+g[5]*C+g[9]*E+g[13]*A,m[2]=g[2]*x+g[6]*C+g[10]*E+g[14]*A,m[3]=g[3]*x+g[7]*C+g[11]*E+g[15]*A,m}function Z(){var m=new Q(4);return Q!=Float32Array&&(m[0]=0,m[1]=0,m[2]=0),m[3]=1,m}function ie(){var m=new Q(2);return Q!=Float32Array&&(m[0]=0,m[1]=0),m}function le(m,h){var g=new Q(2);return g[0]=m,g[1]=h,g}Math.hypot||(Math.hypot=function(){for(var m=0,h=arguments.length;h--;)m+=arguments[h]*arguments[h];return Math.sqrt(m)}),D(),$=new Q(4),Q!=Float32Array&&($[0]=0,$[1]=0,$[2]=0,$[3]=0),D(),G(1,0,0),G(0,1,0),Z(),Z(),Y(),ie();const me=8192;function be(m,h,g){return h*(me/(m.tileSize*Math.pow(2,g-m.tileID.overscaledZ)))}function fe(m,h){return(m%h+h)%h}function Fe(m,h,g){return m*(1-g)+h*g}function He(m){if(m<=0)return 0;if(m>=1)return 1;const h=m*m,g=h*m;return 4*(m<.5?g:3*(m-h)+g-.75)}function je(m,h,g,x){const C=new O(m,h,g,x);return E=>C.solve(E)}const qe=je(.25,.1,.25,1);function ct(m,h,g){return Math.min(g,Math.max(h,m))}function Ge(m,h,g){const x=g-h,C=((m-h)%x+x)%x+h;return C===h?g:C}function Je(m,...h){for(const g of h)for(const x in g)m[x]=g[x];return m}let mt=1;function wt(m,h,g){const x={};for(const C in m)x[C]=h.call(this,m[C],C,m);return x}function Ot(m,h,g){const x={};for(const C in m)h.call(this,m[C],C,m)&&(x[C]=m[C]);return x}function Qt(m){return Array.isArray(m)?m.map(Qt):typeof m=="object"&&m?wt(m,Qt):m}const ei={};function Jt(m){ei[m]||(typeof console<"u"&&console.warn(m),ei[m]=!0)}function Yt(m,h,g){return(g.y-m.y)*(h.x-m.x)>(h.y-m.y)*(g.x-m.x)}function Ut(m){return typeof WorkerGlobalScope<"u"&&m!==void 0&&m instanceof WorkerGlobalScope}let Re=null;function gi(m){return typeof ImageBitmap<"u"&&m instanceof ImageBitmap}const it="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Pe(m,h,g,x,C){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const E=new VideoFrame(m,{timestamp:0});try{const A=E?.format;if(!A||!A.startsWith("BGR")&&!A.startsWith("RGB"))throw new Error(`Unrecognized format ${A}`);const L=A.startsWith("BGR"),V=new Uint8ClampedArray(x*C*4);if(yield E.copyTo(V,function(H,X,K,ae,ue){const de=4*Math.max(1,0),ge=(Math.max(0,K)-K)*ae*4+de,Te=4*ae,Ne=Math.max(0,X),tt=Math.max(0,K);return{rect:{x:Ne,y:tt,width:Math.min(H.width,X+ae)-Ne,height:Math.min(H.height,K+ue)-tt},layout:[{offset:ge,stride:Te}]}}(m,h,g,x,C)),L)for(let H=0;H<V.length;H+=4){const X=V[H];V[H]=V[H+2],V[H+2]=X}return V}finally{E.close()}})}let Ye,Ct;function st(m,h,g,x){return m.addEventListener(h,g,x),{unsubscribe:()=>{m.removeEventListener(h,g,x)}}}function we(m){return m/Math.PI*180}const he={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},xe={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Be="AbortError";function $e(){return new Error(Be)}const Ze={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Lt(m){return Ze.REGISTERED_PROTOCOLS[m.substring(0,m.indexOf("://"))]}const ot="global-dispatcher";class Nt extends Error{constructor(h,g,x,C){super(`AJAXError: ${g} (${h}): ${x}`),this.status=h,this.statusText=g,this.url=x,this.body=C}}const fi=()=>Ut(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Pt=function(m,h){if(/:\/\//.test(m.url)&&!/^https?:|^file:/.test(m.url)){const x=Lt(m.url);if(x)return x(m,h);if(Ut(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:m,targetMapId:ot},h)}if(!(/^file:/.test(g=m.url)||/^file:/.test(fi())&&!/^\w+:/.test(g))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(x,C){return a(this,void 0,void 0,function*(){const E=new Request(x.url,{method:x.method||"GET",body:x.body,credentials:x.credentials,headers:x.headers,cache:x.cache,referrer:fi(),signal:C.signal});let A,L;x.type!=="json"||E.headers.has("Accept")||E.headers.set("Accept","application/json");try{A=yield fetch(E)}catch(H){throw new Nt(0,H.message,x.url,new Blob)}if(!A.ok){const H=yield A.blob();throw new Nt(A.status,A.statusText,x.url,H)}L=x.type==="arrayBuffer"||x.type==="image"?A.arrayBuffer():x.type==="json"?A.json():A.text();const V=yield L;if(C.signal.aborted)throw $e();return{data:V,cacheControl:A.headers.get("Cache-Control"),expires:A.headers.get("Expires")}})}(m,h);if(Ut(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:m,mustQueue:!0,targetMapId:ot},h)}var g;return function(x,C){return new Promise((E,A)=>{var L;const V=new XMLHttpRequest;V.open(x.method||"GET",x.url,!0),x.type!=="arrayBuffer"&&x.type!=="image"||(V.responseType="arraybuffer");for(const H in x.headers)V.setRequestHeader(H,x.headers[H]);x.type==="json"&&(V.responseType="text",!((L=x.headers)===null||L===void 0)&&L.Accept||V.setRequestHeader("Accept","application/json")),V.withCredentials=x.credentials==="include",V.onerror=()=>{A(new Error(V.statusText))},V.onload=()=>{if(!C.signal.aborted)if((V.status>=200&&V.status<300||V.status===0)&&V.response!==null){let H=V.response;if(x.type==="json")try{H=JSON.parse(V.response)}catch(X){return void A(X)}E({data:H,cacheControl:V.getResponseHeader("Cache-Control"),expires:V.getResponseHeader("Expires")})}else{const H=new Blob([V.response],{type:V.getResponseHeader("Content-Type")});A(new Nt(V.status,V.statusText,x.url,H))}},C.signal.addEventListener("abort",()=>{V.abort(),A($e())}),V.send(x.body)})}(m,h)};function ni(m){if(!m||m.indexOf("://")<=0||m.indexOf("data:image/")===0||m.indexOf("blob:")===0)return!0;const h=new URL(m),g=window.location;return h.protocol===g.protocol&&h.host===g.host}function ti(m,h,g){g[m]&&g[m].indexOf(h)!==-1||(g[m]=g[m]||[],g[m].push(h))}function nt(m,h,g){if(g&&g[m]){const x=g[m].indexOf(h);x!==-1&&g[m].splice(x,1)}}class Ce{constructor(h,g={}){Je(this,g),this.type=h}}class oe extends Ce{constructor(h,g={}){super("error",Je({error:h},g))}}class re{on(h,g){return this._listeners=this._listeners||{},ti(h,g,this._listeners),{unsubscribe:()=>{this.off(h,g)}}}off(h,g){return nt(h,g,this._listeners),nt(h,g,this._oneTimeListeners),this}once(h,g){return g?(this._oneTimeListeners=this._oneTimeListeners||{},ti(h,g,this._oneTimeListeners),this):new Promise(x=>this.once(h,x))}fire(h,g){typeof h=="string"&&(h=new Ce(h,g||{}));const x=h.type;if(this.listens(x)){h.target=this;const C=this._listeners&&this._listeners[x]?this._listeners[x].slice():[];for(const L of C)L.call(this,h);const E=this._oneTimeListeners&&this._oneTimeListeners[x]?this._oneTimeListeners[x].slice():[];for(const L of E)nt(x,L,this._oneTimeListeners),L.call(this,h);const A=this._eventedParent;A&&(Je(h,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),A.fire(h))}else h instanceof oe&&console.error(h.error);return this}listens(h){return this._listeners&&this._listeners[h]&&this._listeners[h].length>0||this._oneTimeListeners&&this._oneTimeListeners[h]&&this._oneTimeListeners[h].length>0||this._eventedParent&&this._eventedParent.listens(h)}setEventedParent(h,g){return this._eventedParent=h,this._eventedParentData=g,this}}var ee={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const te=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Se(m,h){const g={};for(const x in m)x!=="ref"&&(g[x]=m[x]);return te.forEach(x=>{x in h&&(g[x]=h[x])}),g}function ve(m,h){if(Array.isArray(m)){if(!Array.isArray(h)||m.length!==h.length)return!1;for(let g=0;g<m.length;g++)if(!ve(m[g],h[g]))return!1;return!0}if(typeof m=="object"&&m!==null&&h!==null){if(typeof h!="object"||Object.keys(m).length!==Object.keys(h).length)return!1;for(const g in m)if(!ve(m[g],h[g]))return!1;return!0}return m===h}function Ae(m,h){m.push(h)}function ke(m,h,g){Ae(g,{command:"addSource",args:[m,h[m]]})}function Xe(m,h,g){Ae(h,{command:"removeSource",args:[m]}),g[m]=!0}function ut(m,h,g,x){Xe(m,g,x),ke(m,h,g)}function lt(m,h,g){let x;for(x in m[g])if(Object.prototype.hasOwnProperty.call(m[g],x)&&x!=="data"&&!ve(m[g][x],h[g][x]))return!1;for(x in h[g])if(Object.prototype.hasOwnProperty.call(h[g],x)&&x!=="data"&&!ve(m[g][x],h[g][x]))return!1;return!0}function Tt(m,h,g,x,C,E){m=m||{},h=h||{};for(const A in m)Object.prototype.hasOwnProperty.call(m,A)&&(ve(m[A],h[A])||g.push({command:E,args:[x,A,h[A],C]}));for(const A in h)Object.prototype.hasOwnProperty.call(h,A)&&!Object.prototype.hasOwnProperty.call(m,A)&&(ve(m[A],h[A])||g.push({command:E,args:[x,A,h[A],C]}))}function zt(m){return m.id}function ii(m,h){return m[h.id]=h,m}class xt{constructor(h,g,x,C){this.message=(h?`${h}: `:"")+x,C&&(this.identifier=C),g!=null&&g.__line__&&(this.line=g.__line__)}}function tn(m,...h){for(const g of h)for(const x in g)m[x]=g[x];return m}class Ni extends Error{constructor(h,g){super(g),this.message=g,this.key=h}}class ji{constructor(h,g=[]){this.parent=h,this.bindings={};for(const[x,C]of g)this.bindings[x]=C}concat(h){return new ji(this,h)}get(h){if(this.bindings[h])return this.bindings[h];if(this.parent)return this.parent.get(h);throw new Error(`${h} not found in scope.`)}has(h){return!!this.bindings[h]||!!this.parent&&this.parent.has(h)}}const Pn={kind:"null"},qt={kind:"number"},Oi={kind:"string"},li={kind:"boolean"},dn={kind:"color"},br={kind:"projectionDefinition"},Ka={kind:"object"},Qi={kind:"value"},fs={kind:"collator"},wr={kind:"formatted"},sf={kind:"padding"},ku={kind:"resolvedImage"},ac={kind:"variableAnchorOffsetCollection"};function xo(m,h){return{kind:"array",itemType:m,N:h}}function Oe(m){if(m.kind==="array"){const h=Oe(m.itemType);return typeof m.N=="number"?`array<${h}, ${m.N}>`:m.itemType.kind==="value"?"array":`array<${h}>`}return m.kind}const pt=[Pn,qt,Oi,li,dn,br,wr,Ka,xo(Qi),sf,ku,ac];function Mt(m,h){if(h.kind==="error")return null;if(m.kind==="array"){if(h.kind==="array"&&(h.N===0&&h.itemType.kind==="value"||!Mt(m.itemType,h.itemType))&&(typeof m.N!="number"||m.N===h.N))return null}else{if(m.kind===h.kind)return null;if(m.kind==="value"){for(const g of pt)if(!Mt(g,h))return null}}return`Expected ${Oe(m)} but found ${Oe(h)} instead.`}function Rt(m,h){return h.some(g=>g.kind===m.kind)}function ft(m,h){return h.some(g=>g==="null"?m===null:g==="array"?Array.isArray(m):g==="object"?m&&!Array.isArray(m)&&typeof m=="object":g===typeof m)}function ci(m,h){return m.kind==="array"&&h.kind==="array"?m.itemType.kind===h.itemType.kind&&typeof m.N=="number":m.kind===h.kind}const Mi=.96422,ki=.82521,Bi=4/29,un=6/29,pn=3*un*un,ln=un*un*un,Un=Math.PI/180,Hn=180/Math.PI;function $r(m){return(m%=360)<0&&(m+=360),m}function Er([m,h,g,x]){let C,E;const A=on((.2225045*(m=En(m))+.7168786*(h=En(h))+.0606169*(g=En(g)))/1);m===h&&h===g?C=E=A:(C=on((.4360747*m+.3850649*h+.1430804*g)/Mi),E=on((.0139322*m+.0971045*h+.7141733*g)/ki));const L=116*A-16;return[L<0?0:L,500*(C-A),200*(A-E),x]}function En(m){return m<=.04045?m/12.92:Math.pow((m+.055)/1.055,2.4)}function on(m){return m>ln?Math.pow(m,1/3):m/pn+Bi}function ws([m,h,g,x]){let C=(m+16)/116,E=isNaN(h)?C:C+h/500,A=isNaN(g)?C:C-g/200;return C=1*bo(C),E=Mi*bo(E),A=ki*bo(A),[Jn(3.1338561*E-1.6168667*C-.4906146*A),Jn(-.9787684*E+1.9161415*C+.033454*A),Jn(.0719453*E-.2289914*C+1.4052427*A),x]}function Jn(m){return(m=m<=.00304?12.92*m:1.055*Math.pow(m,1/2.4)-.055)<0?0:m>1?1:m}function bo(m){return m>un?m*m*m:pn*(m-Bi)}function Ya(m){return parseInt(m.padEnd(2,m),16)/255}function Ar(m,h){return gn(h?m/100:m,0,1)}function gn(m,h,g){return Math.min(Math.max(h,m),g)}function lr(m){return!m.some(Number.isNaN)}const ps={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function is(m,h,g){return m+g*(h-m)}function ns(m,h,g){return m.map((x,C)=>is(x,h[C],g))}class hn{constructor(h,g,x,C=1,E=!0){this.r=h,this.g=g,this.b=x,this.a=C,E||(this.r*=C,this.g*=C,this.b*=C,C||this.overwriteGetter("rgb",[h,g,x,C]))}static parse(h){if(h instanceof hn)return h;if(typeof h!="string")return;const g=function(x){if((x=x.toLowerCase().trim())==="transparent")return[0,0,0,0];const C=ps[x];if(C){const[A,L,V]=C;return[A/255,L/255,V/255,1]}if(x.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(x)){const A=x.length<6?1:2;let L=1;return[Ya(x.slice(L,L+=A)),Ya(x.slice(L,L+=A)),Ya(x.slice(L,L+=A)),Ya(x.slice(L,L+A)||"ff")]}if(x.startsWith("rgb")){const A=x.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(A){const[L,V,H,X,K,ae,ue,de,ge,Te,Ne,tt]=A,Ve=[X||" ",ue||" ",Te].join("");if(Ve==="  "||Ve==="  /"||Ve===",,"||Ve===",,,"){const ce=[H,ae,ge].join(""),Me=ce==="%%%"?100:ce===""?255:0;if(Me){const Ue=[gn(+V/Me,0,1),gn(+K/Me,0,1),gn(+de/Me,0,1),Ne?Ar(+Ne,tt):1];if(lr(Ue))return Ue}}return}}const E=x.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[A,L,V,H,X,K,ae,ue,de]=E,ge=[V||" ",X||" ",ae].join("");if(ge==="  "||ge==="  /"||ge===",,"||ge===",,,"){const Te=[+L,gn(+H,0,100),gn(+K,0,100),ue?Ar(+ue,de):1];if(lr(Te))return function([Ne,tt,Ve,ce]){function Me(Ue){const yt=(Ue+Ne/30)%12,jt=tt*Math.min(Ve,1-Ve);return Ve-jt*Math.max(-1,Math.min(yt-3,9-yt,1))}return Ne=$r(Ne),tt/=100,Ve/=100,[Me(0),Me(8),Me(4),ce]}(Te)}}}(h);return g?new hn(...g,!1):void 0}get rgb(){const{r:h,g,b:x,a:C}=this,E=C||1/0;return this.overwriteGetter("rgb",[h/E,g/E,x/E,C])}get hcl(){return this.overwriteGetter("hcl",function(h){const[g,x,C,E]=Er(h),A=Math.sqrt(x*x+C*C);return[Math.round(1e4*A)?$r(Math.atan2(C,x)*Hn):NaN,A,g,E]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Er(this.rgb))}overwriteGetter(h,g){return Object.defineProperty(this,h,{value:g}),g}toString(){const[h,g,x,C]=this.rgb;return`rgba(${[h,g,x].map(E=>Math.round(255*E)).join(",")},${C})`}static interpolate(h,g,x,C="rgb"){switch(C){case"rgb":{const[E,A,L,V]=ns(h.rgb,g.rgb,x);return new hn(E,A,L,V,!1)}case"hcl":{const[E,A,L,V]=h.hcl,[H,X,K,ae]=g.hcl;let ue,de;if(isNaN(E)||isNaN(H))isNaN(E)?isNaN(H)?ue=NaN:(ue=H,L!==1&&L!==0||(de=X)):(ue=E,K!==1&&K!==0||(de=A));else{let Ve=H-E;H>E&&Ve>180?Ve-=360:H<E&&E-H>180&&(Ve+=360),ue=E+x*Ve}const[ge,Te,Ne,tt]=function([Ve,ce,Me,Ue]){return Ve=isNaN(Ve)?0:Ve*Un,ws([Me,Math.cos(Ve)*ce,Math.sin(Ve)*ce,Ue])}([ue,de??is(A,X,x),is(L,K,x),is(V,ae,x)]);return new hn(ge,Te,Ne,tt,!1)}case"lab":{const[E,A,L,V]=ws(ns(h.lab,g.lab,x));return new hn(E,A,L,V,!1)}}}}hn.black=new hn(0,0,0,1),hn.white=new hn(1,1,1,1),hn.transparent=new hn(0,0,0,0),hn.red=new hn(1,0,0,1);class wo{constructor(h,g,x){this.sensitivity=h?g?"variant":"case":g?"accent":"base",this.locale=x,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(h,g){return this.collator.compare(h,g)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const ba=["bottom","center","top"];class of{constructor(h,g,x,C,E,A){this.text=h,this.image=g,this.scale=x,this.fontStack=C,this.textColor=E,this.verticalAlign=A}}class Lo{constructor(h){this.sections=h}static fromString(h){return new Lo([new of(h,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(h=>h.text.length!==0||h.image&&h.image.name.length!==0)}static factory(h){return h instanceof Lo?h:Lo.fromString(h)}toString(){return this.sections.length===0?"":this.sections.map(h=>h.text).join("")}}class io{constructor(h){this.values=h.slice()}static parse(h){if(h instanceof io)return h;if(typeof h=="number")return new io([h,h,h,h]);if(Array.isArray(h)&&!(h.length<1||h.length>4)){for(const g of h)if(typeof g!="number")return;switch(h.length){case 1:h=[h[0],h[0],h[0],h[0]];break;case 2:h=[h[0],h[1],h[0],h[1]];break;case 3:h=[h[0],h[1],h[2],h[1]]}return new io(h)}}toString(){return JSON.stringify(this.values)}static interpolate(h,g,x){return new io(ns(h.values,g.values,x))}}class Ir{constructor(h){this.name="ExpressionEvaluationError",this.message=h}toJSON(){return this.message}}const uv=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Fo{constructor(h){this.values=h.slice()}static parse(h){if(h instanceof Fo)return h;if(Array.isArray(h)&&!(h.length<1)&&h.length%2==0){for(let g=0;g<h.length;g+=2){const x=h[g],C=h[g+1];if(typeof x!="string"||!uv.has(x)||!Array.isArray(C)||C.length!==2||typeof C[0]!="number"||typeof C[1]!="number")return}return new Fo(h)}}toString(){return JSON.stringify(this.values)}static interpolate(h,g,x){const C=h.values,E=g.values;if(C.length!==E.length)throw new Ir(`Cannot interpolate values of different length. from: ${h.toString()}, to: ${g.toString()}`);const A=[];for(let L=0;L<C.length;L+=2){if(C[L]!==E[L])throw new Ir(`Cannot interpolate values containing mismatched anchors. from[${L}]: ${C[L]}, to[${L}]: ${E[L]}`);A.push(C[L]);const[V,H]=C[L+1],[X,K]=E[L+1];A.push([is(V,X,x),is(H,K,x)])}return new Fo(A)}}class Ko{constructor(h){this.name=h.name,this.available=h.available}toString(){return this.name}static fromString(h){return h?new Ko({name:h,available:!1}):null}}class Ds{constructor(h,g,x){this.from=h,this.to=g,this.transition=x}static interpolate(h,g,x){return new Ds(h,g,x)}static parse(h){return h instanceof Ds?h:Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"?new Ds(h[0],h[1],h[2]):typeof h=="object"&&typeof h.from=="string"&&typeof h.to=="string"&&typeof h.transition=="number"?new Ds(h.from,h.to,h.transition):typeof h=="string"?new Ds(h,h,1):void 0}}function lS(m,h,g,x){return typeof m=="number"&&m>=0&&m<=255&&typeof h=="number"&&h>=0&&h<=255&&typeof g=="number"&&g>=0&&g<=255?x===void 0||typeof x=="number"&&x>=0&&x<=1?null:`Invalid rgba value [${[m,h,g,x].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof x=="number"?[m,h,g,x]:[m,h,g]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Du(m){if(m===null||typeof m=="string"||typeof m=="boolean"||typeof m=="number"||m instanceof Ds||m instanceof hn||m instanceof wo||m instanceof Lo||m instanceof io||m instanceof Fo||m instanceof Ko)return!0;if(Array.isArray(m)){for(const h of m)if(!Du(h))return!1;return!0}if(typeof m=="object"){for(const h in m)if(!Du(m[h]))return!1;return!0}return!1}function kr(m){if(m===null)return Pn;if(typeof m=="string")return Oi;if(typeof m=="boolean")return li;if(typeof m=="number")return qt;if(m instanceof hn)return dn;if(m instanceof Ds)return br;if(m instanceof wo)return fs;if(m instanceof Lo)return wr;if(m instanceof io)return sf;if(m instanceof Fo)return ac;if(m instanceof Ko)return ku;if(Array.isArray(m)){const h=m.length;let g;for(const x of m){const C=kr(x);if(g){if(g===C)continue;g=Qi;break}g=C}return xo(g||Qi,h)}return Ka}function af(m){const h=typeof m;return m===null?"":h==="string"||h==="number"||h==="boolean"?String(m):m instanceof hn||m instanceof Ds||m instanceof Lo||m instanceof io||m instanceof Fo||m instanceof Ko?m.toString():JSON.stringify(m)}class Lu{constructor(h,g){this.type=h,this.value=g}static parse(h,g){if(h.length!==2)return g.error(`'literal' expression requires exactly one argument, but found ${h.length-1} instead.`);if(!Du(h[1]))return g.error("invalid value");const x=h[1];let C=kr(x);const E=g.expectedType;return C.kind!=="array"||C.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(C=E),new Lu(C,x)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const qp={string:Oi,number:qt,boolean:li,object:Ka};class Yo{constructor(h,g){this.type=h,this.args=g}static parse(h,g){if(h.length<2)return g.error("Expected at least one argument.");let x,C=1;const E=h[0];if(E==="array"){let L,V;if(h.length>2){const H=h[1];if(typeof H!="string"||!(H in qp)||H==="object")return g.error('The item type argument of "array" must be one of string, number, boolean',1);L=qp[H],C++}else L=Qi;if(h.length>3){if(h[2]!==null&&(typeof h[2]!="number"||h[2]<0||h[2]!==Math.floor(h[2])))return g.error('The length argument to "array" must be a positive integer literal',2);V=h[2],C++}x=xo(L,V)}else{if(!qp[E])throw new Error(`Types doesn't contain name = ${E}`);x=qp[E]}const A=[];for(;C<h.length;C++){const L=g.parse(h[C],C,Qi);if(!L)return null;A.push(L)}return new Yo(x,A)}evaluate(h){for(let g=0;g<this.args.length;g++){const x=this.args[g].evaluate(h);if(!Mt(this.type,kr(x)))return x;if(g===this.args.length-1)throw new Ir(`Expected value to be of type ${Oe(this.type)}, but found ${Oe(kr(x))} instead.`)}throw new Error}eachChild(h){this.args.forEach(h)}outputDefined(){return this.args.every(h=>h.outputDefined())}}const Mr={"to-boolean":li,"to-color":dn,"to-number":qt,"to-string":Oi};class lc{constructor(h,g){this.type=h,this.args=g}static parse(h,g){if(h.length<2)return g.error("Expected at least one argument.");const x=h[0];if(!Mr[x])throw new Error(`Can't parse ${x} as it is not part of the known types`);if((x==="to-boolean"||x==="to-string")&&h.length!==2)return g.error("Expected one argument.");const C=Mr[x],E=[];for(let A=1;A<h.length;A++){const L=g.parse(h[A],A,Qi);if(!L)return null;E.push(L)}return new lc(C,E)}evaluate(h){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(h);case"color":{let g,x;for(const C of this.args){if(g=C.evaluate(h),x=null,g instanceof hn)return g;if(typeof g=="string"){const E=h.parseColor(g);if(E)return E}else if(Array.isArray(g)&&(x=g.length<3||g.length>4?`Invalid rgba value ${JSON.stringify(g)}: expected an array containing either three or four numeric values.`:lS(g[0],g[1],g[2],g[3]),!x))return new hn(g[0]/255,g[1]/255,g[2]/255,g[3])}throw new Ir(x||`Could not parse color from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"padding":{let g;for(const x of this.args){g=x.evaluate(h);const C=io.parse(g);if(C)return C}throw new Ir(`Could not parse padding from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"variableAnchorOffsetCollection":{let g;for(const x of this.args){g=x.evaluate(h);const C=Fo.parse(g);if(C)return C}throw new Ir(`Could not parse variableAnchorOffsetCollection from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"number":{let g=null;for(const x of this.args){if(g=x.evaluate(h),g===null)return 0;const C=Number(g);if(!isNaN(C))return C}throw new Ir(`Could not convert ${JSON.stringify(g)} to number.`)}case"formatted":return Lo.fromString(af(this.args[0].evaluate(h)));case"resolvedImage":return Ko.fromString(af(this.args[0].evaluate(h)));case"projectionDefinition":return this.args[0].evaluate(h);default:return af(this.args[0].evaluate(h))}}eachChild(h){this.args.forEach(h)}outputDefined(){return this.args.every(h=>h.outputDefined())}}const er=["Unknown","Point","LineString","Polygon"];class xn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?er[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(h){let g=this._parseColorCache[h];return g||(g=this._parseColorCache[h]=hn.parse(h)),g}}class lf{constructor(h,g,x=[],C,E=new ji,A=[]){this.registry=h,this.path=x,this.key=x.map(L=>`[${L}]`).join(""),this.scope=E,this.errors=A,this.expectedType=C,this._isConstant=g}parse(h,g,x,C,E={}){return g?this.concat(g,x,C)._parse(h,E):this._parse(h,E)}_parse(h,g){function x(C,E,A){return A==="assert"?new Yo(E,[C]):A==="coerce"?new lc(E,[C]):C}if(h!==null&&typeof h!="string"&&typeof h!="boolean"&&typeof h!="number"||(h=["literal",h]),Array.isArray(h)){if(h.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const C=h[0];if(typeof C!="string")return this.error(`Expression name must be a string, but found ${typeof C} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[C];if(E){let A=E.parse(h,this);if(!A)return null;if(this.expectedType){const L=this.expectedType,V=A.type;if(L.kind!=="string"&&L.kind!=="number"&&L.kind!=="boolean"&&L.kind!=="object"&&L.kind!=="array"||V.kind!=="value")if(L.kind!=="projectionDefinition"||V.kind!=="string"&&V.kind!=="array")if(L.kind!=="color"&&L.kind!=="formatted"&&L.kind!=="resolvedImage"||V.kind!=="value"&&V.kind!=="string")if(L.kind!=="padding"||V.kind!=="value"&&V.kind!=="number"&&V.kind!=="array")if(L.kind!=="variableAnchorOffsetCollection"||V.kind!=="value"&&V.kind!=="array"){if(this.checkSubtype(L,V))return null}else A=x(A,L,g.typeAnnotation||"coerce");else A=x(A,L,g.typeAnnotation||"coerce");else A=x(A,L,g.typeAnnotation||"coerce");else A=x(A,L,g.typeAnnotation||"coerce");else A=x(A,L,g.typeAnnotation||"assert")}if(!(A instanceof Lu)&&A.type.kind!=="resolvedImage"&&this._isConstant(A)){const L=new xn;try{A=new Lu(A.type,A.evaluate(L))}catch(V){return this.error(V.message),null}}return A}return this.error(`Unknown expression "${C}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(h===void 0?"'undefined' value invalid. Use null instead.":typeof h=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof h} instead.`)}concat(h,g,x){const C=typeof h=="number"?this.path.concat(h):this.path,E=x?this.scope.concat(x):this.scope;return new lf(this.registry,this._isConstant,C,g||null,E,this.errors)}error(h,...g){const x=`${this.key}${g.map(C=>`[${C}]`).join("")}`;this.errors.push(new Ni(x,h))}checkSubtype(h,g){const x=Mt(h,g);return x&&this.error(x),x}}class Vn{constructor(h,g){this.type=g.type,this.bindings=[].concat(h),this.result=g}evaluate(h){return this.result.evaluate(h)}eachChild(h){for(const g of this.bindings)h(g[1]);h(this.result)}static parse(h,g){if(h.length<4)return g.error(`Expected at least 3 arguments, but found ${h.length-1} instead.`);const x=[];for(let E=1;E<h.length-1;E+=2){const A=h[E];if(typeof A!="string")return g.error(`Expected string, but found ${typeof A} instead.`,E);if(/[^a-zA-Z0-9_]/.test(A))return g.error("Variable names must contain only alphanumeric characters or '_'.",E);const L=g.parse(h[E+1],E+1);if(!L)return null;x.push([A,L])}const C=g.parse(h[h.length-1],h.length-1,g.expectedType,x);return C?new Vn(x,C):null}outputDefined(){return this.result.outputDefined()}}class cf{constructor(h,g){this.type=g.type,this.name=h,this.boundExpression=g}static parse(h,g){if(h.length!==2||typeof h[1]!="string")return g.error("'var' expression requires exactly one string literal argument.");const x=h[1];return g.scope.has(x)?new cf(x,g.scope.get(x)):g.error(`Unknown variable "${x}". Make sure "${x}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(h){return this.boundExpression.evaluate(h)}eachChild(){}outputDefined(){return!1}}class Tl{constructor(h,g,x){this.type=h,this.index=g,this.input=x}static parse(h,g){if(h.length!==3)return g.error(`Expected 2 arguments, but found ${h.length-1} instead.`);const x=g.parse(h[1],1,qt),C=g.parse(h[2],2,xo(g.expectedType||Qi));return x&&C?new Tl(C.type.itemType,x,C):null}evaluate(h){const g=this.index.evaluate(h),x=this.input.evaluate(h);if(g<0)throw new Ir(`Array index out of bounds: ${g} < 0.`);if(g>=x.length)throw new Ir(`Array index out of bounds: ${g} > ${x.length-1}.`);if(g!==Math.floor(g))throw new Ir(`Array index must be an integer, but found ${g} instead.`);return x[g]}eachChild(h){h(this.index),h(this.input)}outputDefined(){return!1}}class jp{constructor(h,g){this.type=li,this.needle=h,this.haystack=g}static parse(h,g){if(h.length!==3)return g.error(`Expected 2 arguments, but found ${h.length-1} instead.`);const x=g.parse(h[1],1,Qi),C=g.parse(h[2],2,Qi);return x&&C?Rt(x.type,[li,Oi,qt,Pn,Qi])?new jp(x,C):g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Oe(x.type)} instead`):null}evaluate(h){const g=this.needle.evaluate(h),x=this.haystack.evaluate(h);if(!x)return!1;if(!ft(g,["boolean","string","number","null"]))throw new Ir(`Expected first argument to be of type boolean, string, number or null, but found ${Oe(kr(g))} instead.`);if(!ft(x,["string","array"]))throw new Ir(`Expected second argument to be of type array or string, but found ${Oe(kr(x))} instead.`);return x.indexOf(g)>=0}eachChild(h){h(this.needle),h(this.haystack)}outputDefined(){return!0}}class Qp{constructor(h,g,x){this.type=qt,this.needle=h,this.haystack=g,this.fromIndex=x}static parse(h,g){if(h.length<=2||h.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${h.length-1} instead.`);const x=g.parse(h[1],1,Qi),C=g.parse(h[2],2,Qi);if(!x||!C)return null;if(!Rt(x.type,[li,Oi,qt,Pn,Qi]))return g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Oe(x.type)} instead`);if(h.length===4){const E=g.parse(h[3],3,qt);return E?new Qp(x,C,E):null}return new Qp(x,C)}evaluate(h){const g=this.needle.evaluate(h),x=this.haystack.evaluate(h);if(!ft(g,["boolean","string","number","null"]))throw new Ir(`Expected first argument to be of type boolean, string, number or null, but found ${Oe(kr(g))} instead.`);let C;if(this.fromIndex&&(C=this.fromIndex.evaluate(h)),ft(x,["string"])){const E=x.indexOf(g,C);return E===-1?-1:[...x.slice(0,E)].length}if(ft(x,["array"]))return x.indexOf(g,C);throw new Ir(`Expected second argument to be of type array or string, but found ${Oe(kr(x))} instead.`)}eachChild(h){h(this.needle),h(this.haystack),this.fromIndex&&h(this.fromIndex)}outputDefined(){return!1}}class hv{constructor(h,g,x,C,E,A){this.inputType=h,this.type=g,this.input=x,this.cases=C,this.outputs=E,this.otherwise=A}static parse(h,g){if(h.length<5)return g.error(`Expected at least 4 arguments, but found only ${h.length-1}.`);if(h.length%2!=1)return g.error("Expected an even number of arguments.");let x,C;g.expectedType&&g.expectedType.kind!=="value"&&(C=g.expectedType);const E={},A=[];for(let H=2;H<h.length-1;H+=2){let X=h[H];const K=h[H+1];Array.isArray(X)||(X=[X]);const ae=g.concat(H);if(X.length===0)return ae.error("Expected at least one branch label.");for(const de of X){if(typeof de!="number"&&typeof de!="string")return ae.error("Branch labels must be numbers or strings.");if(typeof de=="number"&&Math.abs(de)>Number.MAX_SAFE_INTEGER)return ae.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof de=="number"&&Math.floor(de)!==de)return ae.error("Numeric branch labels must be integer values.");if(x){if(ae.checkSubtype(x,kr(de)))return null}else x=kr(de);if(E[String(de)]!==void 0)return ae.error("Branch labels must be unique.");E[String(de)]=A.length}const ue=g.parse(K,H,C);if(!ue)return null;C=C||ue.type,A.push(ue)}const L=g.parse(h[1],1,Qi);if(!L)return null;const V=g.parse(h[h.length-1],h.length-1,C);return V?L.type.kind!=="value"&&g.concat(1).checkSubtype(x,L.type)?null:new hv(x,C,L,E,A,V):null}evaluate(h){const g=this.input.evaluate(h);return(kr(g)===this.inputType&&this.outputs[this.cases[g]]||this.otherwise).evaluate(h)}eachChild(h){h(this.input),this.outputs.forEach(h),h(this.otherwise)}outputDefined(){return this.outputs.every(h=>h.outputDefined())&&this.otherwise.outputDefined()}}class Zp{constructor(h,g,x){this.type=h,this.branches=g,this.otherwise=x}static parse(h,g){if(h.length<4)return g.error(`Expected at least 3 arguments, but found only ${h.length-1}.`);if(h.length%2!=0)return g.error("Expected an odd number of arguments.");let x;g.expectedType&&g.expectedType.kind!=="value"&&(x=g.expectedType);const C=[];for(let A=1;A<h.length-1;A+=2){const L=g.parse(h[A],A,li);if(!L)return null;const V=g.parse(h[A+1],A+1,x);if(!V)return null;C.push([L,V]),x=x||V.type}const E=g.parse(h[h.length-1],h.length-1,x);if(!E)return null;if(!x)throw new Error("Can't infer output type");return new Zp(x,C,E)}evaluate(h){for(const[g,x]of this.branches)if(g.evaluate(h))return x.evaluate(h);return this.otherwise.evaluate(h)}eachChild(h){for(const[g,x]of this.branches)h(g),h(x);h(this.otherwise)}outputDefined(){return this.branches.every(([h,g])=>g.outputDefined())&&this.otherwise.outputDefined()}}class Xp{constructor(h,g,x,C){this.type=h,this.input=g,this.beginIndex=x,this.endIndex=C}static parse(h,g){if(h.length<=2||h.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${h.length-1} instead.`);const x=g.parse(h[1],1,Qi),C=g.parse(h[2],2,qt);if(!x||!C)return null;if(!Rt(x.type,[xo(Qi),Oi,Qi]))return g.error(`Expected first argument to be of type array or string, but found ${Oe(x.type)} instead`);if(h.length===4){const E=g.parse(h[3],3,qt);return E?new Xp(x.type,x,C,E):null}return new Xp(x.type,x,C)}evaluate(h){const g=this.input.evaluate(h),x=this.beginIndex.evaluate(h);let C;if(this.endIndex&&(C=this.endIndex.evaluate(h)),ft(g,["string"]))return[...g].slice(x,C).join("");if(ft(g,["array"]))return g.slice(x,C);throw new Ir(`Expected first argument to be of type array or string, but found ${Oe(kr(g))} instead.`)}eachChild(h){h(this.input),h(this.beginIndex),this.endIndex&&h(this.endIndex)}outputDefined(){return!1}}function dv(m,h){const g=m.length-1;let x,C,E=0,A=g,L=0;for(;E<=A;)if(L=Math.floor((E+A)/2),x=m[L],C=m[L+1],x<=h){if(L===g||h<C)return L;E=L+1}else{if(!(x>h))throw new Ir("Input is not a number.");A=L-1}return 0}class uf{constructor(h,g,x){this.type=h,this.input=g,this.labels=[],this.outputs=[];for(const[C,E]of x)this.labels.push(C),this.outputs.push(E)}static parse(h,g){if(h.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${h.length-1}.`);if((h.length-1)%2!=0)return g.error("Expected an even number of arguments.");const x=g.parse(h[1],1,qt);if(!x)return null;const C=[];let E=null;g.expectedType&&g.expectedType.kind!=="value"&&(E=g.expectedType);for(let A=1;A<h.length;A+=2){const L=A===1?-1/0:h[A],V=h[A+1],H=A,X=A+1;if(typeof L!="number")return g.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(C.length&&C[C.length-1][0]>=L)return g.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',H);const K=g.parse(V,X,E);if(!K)return null;E=E||K.type,C.push([L,K])}return new uf(E,x,C)}evaluate(h){const g=this.labels,x=this.outputs;if(g.length===1)return x[0].evaluate(h);const C=this.input.evaluate(h);if(C<=g[0])return x[0].evaluate(h);const E=g.length;return C>=g[E-1]?x[E-1].evaluate(h):x[dv(g,C)].evaluate(h)}eachChild(h){h(this.input);for(const g of this.outputs)h(g)}outputDefined(){return this.outputs.every(h=>h.outputDefined())}}function cS(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var Hh,no,fv=function(){if(no)return Hh;function m(h,g,x,C){this.cx=3*h,this.bx=3*(x-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*g,this.by=3*(C-g)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=g,this.p2x=x,this.p2y=C}return no=1,Hh=m,m.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,g){if(g===void 0&&(g=1e-6),h<0)return 0;if(h>1)return 1;for(var x=h,C=0;C<8;C++){var E=this.sampleCurveX(x)-h;if(Math.abs(E)<g)return x;var A=this.sampleCurveDerivativeX(x);if(Math.abs(A)<1e-6)break;x-=E/A}var L=0,V=1;for(x=h,C=0;C<20&&(E=this.sampleCurveX(x),!(Math.abs(E-h)<g));C++)h>E?L=x:V=x,x=.5*(V-L)+L;return x},solve:function(h,g){return this.sampleCurveY(this.solveCurveX(h,g))}},Hh}(),uS=cS(fv);class _o{constructor(h,g,x,C,E){this.type=h,this.operator=g,this.interpolation=x,this.input=C,this.labels=[],this.outputs=[];for(const[A,L]of E)this.labels.push(A),this.outputs.push(L)}static interpolationFactor(h,g,x,C){let E=0;if(h.name==="exponential")E=_s(g,h.base,x,C);else if(h.name==="linear")E=_s(g,1,x,C);else if(h.name==="cubic-bezier"){const A=h.controlPoints;E=new uS(A[0],A[1],A[2],A[3]).solve(_s(g,1,x,C))}return E}static parse(h,g){let[x,C,E,...A]=h;if(!Array.isArray(C)||C.length===0)return g.error("Expected an interpolation type expression.",1);if(C[0]==="linear")C={name:"linear"};else if(C[0]==="exponential"){const H=C[1];if(typeof H!="number")return g.error("Exponential interpolation requires a numeric base.",1,1);C={name:"exponential",base:H}}else{if(C[0]!=="cubic-bezier")return g.error(`Unknown interpolation type ${String(C[0])}`,1,0);{const H=C.slice(1);if(H.length!==4||H.some(X=>typeof X!="number"||X<0||X>1))return g.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);C={name:"cubic-bezier",controlPoints:H}}}if(h.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${h.length-1}.`);if((h.length-1)%2!=0)return g.error("Expected an even number of arguments.");if(E=g.parse(E,2,qt),!E)return null;const L=[];let V=null;x==="interpolate-hcl"||x==="interpolate-lab"?V=dn:g.expectedType&&g.expectedType.kind!=="value"&&(V=g.expectedType);for(let H=0;H<A.length;H+=2){const X=A[H],K=A[H+1],ae=H+3,ue=H+4;if(typeof X!="number")return g.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ae);if(L.length&&L[L.length-1][0]>=X)return g.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ae);const de=g.parse(K,ue,V);if(!de)return null;V=V||de.type,L.push([X,de])}return ci(V,qt)||ci(V,br)||ci(V,dn)||ci(V,sf)||ci(V,ac)||ci(V,xo(qt))?new _o(V,x,C,E,L):g.error(`Type ${Oe(V)} is not interpolatable.`)}evaluate(h){const g=this.labels,x=this.outputs;if(g.length===1)return x[0].evaluate(h);const C=this.input.evaluate(h);if(C<=g[0])return x[0].evaluate(h);const E=g.length;if(C>=g[E-1])return x[E-1].evaluate(h);const A=dv(g,C),L=_o.interpolationFactor(this.interpolation,C,g[A],g[A+1]),V=x[A].evaluate(h),H=x[A+1].evaluate(h);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return is(V,H,L);case"color":return hn.interpolate(V,H,L);case"padding":return io.interpolate(V,H,L);case"variableAnchorOffsetCollection":return Fo.interpolate(V,H,L);case"array":return ns(V,H,L);case"projectionDefinition":return Ds.interpolate(V,H,L)}case"interpolate-hcl":return hn.interpolate(V,H,L,"hcl");case"interpolate-lab":return hn.interpolate(V,H,L,"lab")}}eachChild(h){h(this.input);for(const g of this.outputs)h(g)}outputDefined(){return this.outputs.every(h=>h.outputDefined())}}function _s(m,h,g,x){const C=x-g,E=m-g;return C===0?0:h===1?E/C:(Math.pow(h,E)-1)/(Math.pow(h,C)-1)}const Rl={color:hn.interpolate,number:is,padding:io.interpolate,variableAnchorOffsetCollection:Fo.interpolate,array:ns};class hf{constructor(h,g){this.type=h,this.args=g}static parse(h,g){if(h.length<2)return g.error("Expected at least one argument.");let x=null;const C=g.expectedType;C&&C.kind!=="value"&&(x=C);const E=[];for(const L of h.slice(1)){const V=g.parse(L,1+E.length,x,void 0,{typeAnnotation:"omit"});if(!V)return null;x=x||V.type,E.push(V)}if(!x)throw new Error("No output type");const A=C&&E.some(L=>Mt(C,L.type));return new hf(A?Qi:x,E)}evaluate(h){let g,x=null,C=0;for(const E of this.args)if(C++,x=E.evaluate(h),x&&x instanceof Ko&&!x.available&&(g||(g=x.name),x=null,C===this.args.length&&(x=g)),x!==null)break;return x}eachChild(h){this.args.forEach(h)}outputDefined(){return this.args.every(h=>h.outputDefined())}}function _x(m,h){return m==="=="||m==="!="?h.kind==="boolean"||h.kind==="string"||h.kind==="number"||h.kind==="null"||h.kind==="value":h.kind==="string"||h.kind==="number"||h.kind==="value"}function hS(m,h,g,x){return x.compare(h,g)===0}function eu(m,h,g){const x=m!=="=="&&m!=="!=";return class Ote{constructor(E,A,L){this.type=li,this.lhs=E,this.rhs=A,this.collator=L,this.hasUntypedArgument=E.type.kind==="value"||A.type.kind==="value"}static parse(E,A){if(E.length!==3&&E.length!==4)return A.error("Expected two or three arguments.");const L=E[0];let V=A.parse(E[1],1,Qi);if(!V)return null;if(!_x(L,V.type))return A.concat(1).error(`"${L}" comparisons are not supported for type '${Oe(V.type)}'.`);let H=A.parse(E[2],2,Qi);if(!H)return null;if(!_x(L,H.type))return A.concat(2).error(`"${L}" comparisons are not supported for type '${Oe(H.type)}'.`);if(V.type.kind!==H.type.kind&&V.type.kind!=="value"&&H.type.kind!=="value")return A.error(`Cannot compare types '${Oe(V.type)}' and '${Oe(H.type)}'.`);x&&(V.type.kind==="value"&&H.type.kind!=="value"?V=new Yo(H.type,[V]):V.type.kind!=="value"&&H.type.kind==="value"&&(H=new Yo(V.type,[H])));let X=null;if(E.length===4){if(V.type.kind!=="string"&&H.type.kind!=="string"&&V.type.kind!=="value"&&H.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(X=A.parse(E[3],3,fs),!X)return null}return new Ote(V,H,X)}evaluate(E){const A=this.lhs.evaluate(E),L=this.rhs.evaluate(E);if(x&&this.hasUntypedArgument){const V=kr(A),H=kr(L);if(V.kind!==H.kind||V.kind!=="string"&&V.kind!=="number")throw new Ir(`Expected arguments for "${m}" to be (string, string) or (number, number), but found (${V.kind}, ${H.kind}) instead.`)}if(this.collator&&!x&&this.hasUntypedArgument){const V=kr(A),H=kr(L);if(V.kind!=="string"||H.kind!=="string")return h(E,A,L)}return this.collator?g(E,A,L,this.collator.evaluate(E)):h(E,A,L)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const Cx=eu("==",function(m,h,g){return h===g},hS),WL=eu("!=",function(m,h,g){return h!==g},function(m,h,g,x){return!hS(0,h,g,x)}),pv=eu("<",function(m,h,g){return h<g},function(m,h,g,x){return x.compare(h,g)<0}),mv=eu(">",function(m,h,g){return h>g},function(m,h,g,x){return x.compare(h,g)>0}),Pl=eu("<=",function(m,h,g){return h<=g},function(m,h,g,x){return x.compare(h,g)<=0}),dS=eu(">=",function(m,h,g){return h>=g},function(m,h,g,x){return x.compare(h,g)>=0});class $h{constructor(h,g,x){this.type=fs,this.locale=x,this.caseSensitive=h,this.diacriticSensitive=g}static parse(h,g){if(h.length!==2)return g.error("Expected one argument.");const x=h[1];if(typeof x!="object"||Array.isArray(x))return g.error("Collator options argument must be an object.");const C=g.parse(x["case-sensitive"]!==void 0&&x["case-sensitive"],1,li);if(!C)return null;const E=g.parse(x["diacritic-sensitive"]!==void 0&&x["diacritic-sensitive"],1,li);if(!E)return null;let A=null;return x.locale&&(A=g.parse(x.locale,1,Oi),!A)?null:new $h(C,E,A)}evaluate(h){return new wo(this.caseSensitive.evaluate(h),this.diacriticSensitive.evaluate(h),this.locale?this.locale.evaluate(h):null)}eachChild(h){h(this.caseSensitive),h(this.diacriticSensitive),this.locale&&h(this.locale)}outputDefined(){return!1}}class Sx{constructor(h,g,x,C,E){this.type=Oi,this.number=h,this.locale=g,this.currency=x,this.minFractionDigits=C,this.maxFractionDigits=E}static parse(h,g){if(h.length!==3)return g.error("Expected two arguments.");const x=g.parse(h[1],1,qt);if(!x)return null;const C=h[2];if(typeof C!="object"||Array.isArray(C))return g.error("NumberFormat options argument must be an object.");let E=null;if(C.locale&&(E=g.parse(C.locale,1,Oi),!E))return null;let A=null;if(C.currency&&(A=g.parse(C.currency,1,Oi),!A))return null;let L=null;if(C["min-fraction-digits"]&&(L=g.parse(C["min-fraction-digits"],1,qt),!L))return null;let V=null;return C["max-fraction-digits"]&&(V=g.parse(C["max-fraction-digits"],1,qt),!V)?null:new Sx(x,E,A,L,V)}evaluate(h){return new Intl.NumberFormat(this.locale?this.locale.evaluate(h):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(h):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(h):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(h):void 0}).format(this.number.evaluate(h))}eachChild(h){h(this.number),this.locale&&h(this.locale),this.currency&&h(this.currency),this.minFractionDigits&&h(this.minFractionDigits),this.maxFractionDigits&&h(this.maxFractionDigits)}outputDefined(){return!1}}class df{constructor(h){this.type=wr,this.sections=h}static parse(h,g){if(h.length<2)return g.error("Expected at least one argument.");const x=h[1];if(!Array.isArray(x)&&typeof x=="object")return g.error("First argument must be an image or text section.");const C=[];let E=!1;for(let A=1;A<=h.length-1;++A){const L=h[A];if(E&&typeof L=="object"&&!Array.isArray(L)){E=!1;let V=null;if(L["font-scale"]&&(V=g.parse(L["font-scale"],1,qt),!V))return null;let H=null;if(L["text-font"]&&(H=g.parse(L["text-font"],1,xo(Oi)),!H))return null;let X=null;if(L["text-color"]&&(X=g.parse(L["text-color"],1,dn),!X))return null;let K=null;if(L["vertical-align"]){if(typeof L["vertical-align"]=="string"&&!ba.includes(L["vertical-align"]))return g.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${L["vertical-align"]}' instead.`);if(K=g.parse(L["vertical-align"],1,Oi),!K)return null}const ae=C[C.length-1];ae.scale=V,ae.font=H,ae.textColor=X,ae.verticalAlign=K}else{const V=g.parse(h[A],1,Qi);if(!V)return null;const H=V.type.kind;if(H!=="string"&&H!=="value"&&H!=="null"&&H!=="resolvedImage")return g.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,C.push({content:V,scale:null,font:null,textColor:null,verticalAlign:null})}}return new df(C)}evaluate(h){return new Lo(this.sections.map(g=>{const x=g.content.evaluate(h);return kr(x)===ku?new of("",x,null,null,null,g.verticalAlign?g.verticalAlign.evaluate(h):null):new of(af(x),null,g.scale?g.scale.evaluate(h):null,g.font?g.font.evaluate(h).join(","):null,g.textColor?g.textColor.evaluate(h):null,g.verticalAlign?g.verticalAlign.evaluate(h):null)}))}eachChild(h){for(const g of this.sections)h(g.content),g.scale&&h(g.scale),g.font&&h(g.font),g.textColor&&h(g.textColor),g.verticalAlign&&h(g.verticalAlign)}outputDefined(){return!1}}class Ox{constructor(h){this.type=ku,this.input=h}static parse(h,g){if(h.length!==2)return g.error("Expected two arguments.");const x=g.parse(h[1],1,Oi);return x?new Ox(x):g.error("No image name provided.")}evaluate(h){const g=this.input.evaluate(h),x=Ko.fromString(g);return x&&h.availableImages&&(x.available=h.availableImages.indexOf(g)>-1),x}eachChild(h){h(this.input)}outputDefined(){return!1}}class Mx{constructor(h){this.type=qt,this.input=h}static parse(h,g){if(h.length!==2)return g.error(`Expected 1 argument, but found ${h.length-1} instead.`);const x=g.parse(h[1],1);return x?x.type.kind!=="array"&&x.type.kind!=="string"&&x.type.kind!=="value"?g.error(`Expected argument of type string or array, but found ${Oe(x.type)} instead.`):new Mx(x):null}evaluate(h){const g=this.input.evaluate(h);if(typeof g=="string")return[...g].length;if(Array.isArray(g))return g.length;throw new Ir(`Expected value to be of type string or array, but found ${Oe(kr(g))} instead.`)}eachChild(h){h(this.input)}outputDefined(){return!1}}const cc=8192;function qL(m,h){const g=(180+m[0])/360,x=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+m[1]*Math.PI/360)))/360,C=Math.pow(2,h.z);return[Math.round(g*C*cc),Math.round(x*C*cc)]}function ff(m,h){const g=Math.pow(2,h.z);return[(C=(m[0]/cc+h.x)/g,360*C-180),(x=(m[1]/cc+h.y)/g,360/Math.PI*Math.atan(Math.exp((180-360*x)*Math.PI/180))-90)];var x,C}function Kp(m,h){m[0]=Math.min(m[0],h[0]),m[1]=Math.min(m[1],h[1]),m[2]=Math.max(m[2],h[0]),m[3]=Math.max(m[3],h[1])}function pf(m,h){return!(m[0]<=h[0]||m[2]>=h[2]||m[1]<=h[1]||m[3]>=h[3])}function fS(m,h,g){const x=m[0]-h[0],C=m[1]-h[1],E=m[0]-g[0],A=m[1]-g[1];return x*A-E*C==0&&x*E<=0&&C*A<=0}function gv(m,h,g,x){return(C=[x[0]-g[0],x[1]-g[1]])[0]*(E=[h[0]-m[0],h[1]-m[1]])[1]-C[1]*E[0]!=0&&!(!gS(m,h,g,x)||!gS(g,x,m,h));var C,E}function pS(m,h,g){for(const x of g)for(let C=0;C<x.length-1;++C)if(gv(m,h,x[C],x[C+1]))return!0;return!1}function mf(m,h,g=!1){let x=!1;for(const L of h)for(let V=0;V<L.length-1;V++){if(fS(m,L[V],L[V+1]))return g;(E=L[V])[1]>(C=m)[1]!=(A=L[V+1])[1]>C[1]&&C[0]<(A[0]-E[0])*(C[1]-E[1])/(A[1]-E[1])+E[0]&&(x=!x)}var C,E,A;return x}function jL(m,h){for(const g of h)if(mf(m,g))return!0;return!1}function mS(m,h){for(const g of m)if(!mf(g,h))return!1;for(let g=0;g<m.length-1;++g)if(pS(m[g],m[g+1],h))return!1;return!0}function QL(m,h){for(const g of h)if(mS(m,g))return!0;return!1}function gS(m,h,g,x){const C=x[0]-g[0],E=x[1]-g[1],A=(m[0]-g[0])*E-C*(m[1]-g[1]),L=(h[0]-g[0])*E-C*(h[1]-g[1]);return A>0&&L<0||A<0&&L>0}function vv(m,h,g){const x=[];for(let C=0;C<m.length;C++){const E=[];for(let A=0;A<m[C].length;A++){const L=qL(m[C][A],g);Kp(h,L),E.push(L)}x.push(E)}return x}function Tx(m,h,g){const x=[];for(let C=0;C<m.length;C++){const E=vv(m[C],h,g);x.push(E)}return x}function Rx(m,h,g,x){if(m[0]<g[0]||m[0]>g[2]){const C=.5*x;let E=m[0]-g[0]>C?-x:g[0]-m[0]>C?x:0;E===0&&(E=m[0]-g[2]>C?-x:g[2]-m[0]>C?x:0),m[0]+=E}Kp(h,m)}function vS(m,h,g,x){const C=Math.pow(2,x.z)*cc,E=[x.x*cc,x.y*cc],A=[];for(const L of m)for(const V of L){const H=[V.x+E[0],V.y+E[1]];Rx(H,h,g,C),A.push(H)}return A}function yS(m,h,g,x){const C=Math.pow(2,x.z)*cc,E=[x.x*cc,x.y*cc],A=[];for(const V of m){const H=[];for(const X of V){const K=[X.x+E[0],X.y+E[1]];Kp(h,K),H.push(K)}A.push(H)}if(h[2]-h[0]<=C/2){(L=h)[0]=L[1]=1/0,L[2]=L[3]=-1/0;for(const V of A)for(const H of V)Rx(H,h,g,C)}var L;return A}class Wh{constructor(h,g){this.type=li,this.geojson=h,this.geometries=g}static parse(h,g){if(h.length!==2)return g.error(`'within' expression requires exactly one argument, but found ${h.length-1} instead.`);if(Du(h[1])){const x=h[1];if(x.type==="FeatureCollection"){const C=[];for(const E of x.features){const{type:A,coordinates:L}=E.geometry;A==="Polygon"&&C.push(L),A==="MultiPolygon"&&C.push(...L)}if(C.length)return new Wh(x,{type:"MultiPolygon",coordinates:C})}else if(x.type==="Feature"){const C=x.geometry.type;if(C==="Polygon"||C==="MultiPolygon")return new Wh(x,x.geometry)}else if(x.type==="Polygon"||x.type==="MultiPolygon")return new Wh(x,x)}return g.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(h){if(h.geometry()!=null&&h.canonicalID()!=null){if(h.geometryType()==="Point")return function(g,x){const C=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=g.canonicalID();if(x.type==="Polygon"){const L=vv(x.coordinates,E,A),V=vS(g.geometry(),C,E,A);if(!pf(C,E))return!1;for(const H of V)if(!mf(H,L))return!1}if(x.type==="MultiPolygon"){const L=Tx(x.coordinates,E,A),V=vS(g.geometry(),C,E,A);if(!pf(C,E))return!1;for(const H of V)if(!jL(H,L))return!1}return!0}(h,this.geometries);if(h.geometryType()==="LineString")return function(g,x){const C=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=g.canonicalID();if(x.type==="Polygon"){const L=vv(x.coordinates,E,A),V=yS(g.geometry(),C,E,A);if(!pf(C,E))return!1;for(const H of V)if(!mS(H,L))return!1}if(x.type==="MultiPolygon"){const L=Tx(x.coordinates,E,A),V=yS(g.geometry(),C,E,A);if(!pf(C,E))return!1;for(const H of V)if(!QL(H,L))return!1}return!0}(h,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let yv=class{constructor(m=[],h=(g,x)=>g<x?-1:g>x?1:0){if(this.data=m,this.length=this.data.length,this.compare=h,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(m){this.data.push(m),this._up(this.length++)}pop(){if(this.length===0)return;const m=this.data[0],h=this.data.pop();return--this.length>0&&(this.data[0]=h,this._down(0)),m}peek(){return this.data[0]}_up(m){const{data:h,compare:g}=this,x=h[m];for(;m>0;){const C=m-1>>1,E=h[C];if(g(x,E)>=0)break;h[m]=E,m=C}h[m]=x}_down(m){const{data:h,compare:g}=this,x=this.length>>1,C=h[m];for(;m<x;){let E=1+(m<<1);const A=E+1;if(A<this.length&&g(h[A],h[E])<0&&(E=A),g(h[E],C)>=0)break;h[m]=h[E],m=E}h[m]=C}};function xS(m,h,g=0,x=m.length-1,C=ZL){for(;x>g;){if(x-g>600){const V=x-g+1,H=h-g+1,X=Math.log(V),K=.5*Math.exp(2*X/3),ae=.5*Math.sqrt(X*K*(V-K)/V)*(H-V/2<0?-1:1);xS(m,h,Math.max(g,Math.floor(h-H*K/V+ae)),Math.min(x,Math.floor(h+(V-H)*K/V+ae)),C)}const E=m[h];let A=g,L=x;for(Yp(m,g,h),C(m[x],E)>0&&Yp(m,g,x);A<L;){for(Yp(m,A,L),A++,L--;C(m[A],E)<0;)A++;for(;C(m[L],E)>0;)L--}C(m[g],E)===0?Yp(m,g,L):(L++,Yp(m,L,x)),L<=h&&(g=L+1),h<=L&&(x=L-1)}}function Yp(m,h,g){const x=m[h];m[h]=m[g],m[g]=x}function ZL(m,h){return m<h?-1:m>h?1:0}function Jp(m,h){if(m.length<=1)return[m];const g=[];let x,C;for(const E of m){const A=XL(E);A!==0&&(E.area=Math.abs(A),C===void 0&&(C=A<0),C===A<0?(x&&g.push(x),x=[E]):x.push(E))}if(x&&g.push(x),h>1)for(let E=0;E<g.length;E++)g[E].length<=h||(xS(g[E],h,1,g[E].length-1,bS),g[E]=g[E].slice(0,h));return g}function bS(m,h){return h.area-m.area}function XL(m){let h=0;for(let g,x,C=0,E=m.length,A=E-1;C<E;A=C++)g=m[C],x=m[A],h+=(x.x-g.x)*(g.y+x.y);return h}const wS=1/298.257223563,Px=wS*(2-wS),Ex=Math.PI/180;class Ax{constructor(h){const g=6378.137*Ex*1e3,x=Math.cos(h*Ex),C=1/(1-Px*(1-x*x)),E=Math.sqrt(C);this.kx=g*E*x,this.ky=g*E*C*(1-Px)}distance(h,g){const x=this.wrap(h[0]-g[0])*this.kx,C=(h[1]-g[1])*this.ky;return Math.sqrt(x*x+C*C)}pointOnLine(h,g){let x,C,E,A,L=1/0;for(let V=0;V<h.length-1;V++){let H=h[V][0],X=h[V][1],K=this.wrap(h[V+1][0]-H)*this.kx,ae=(h[V+1][1]-X)*this.ky,ue=0;K===0&&ae===0||(ue=(this.wrap(g[0]-H)*this.kx*K+(g[1]-X)*this.ky*ae)/(K*K+ae*ae),ue>1?(H=h[V+1][0],X=h[V+1][1]):ue>0&&(H+=K/this.kx*ue,X+=ae/this.ky*ue)),K=this.wrap(g[0]-H)*this.kx,ae=(g[1]-X)*this.ky;const de=K*K+ae*ae;de<L&&(L=de,x=H,C=X,E=V,A=ue)}return{point:[x,C],index:E,t:Math.max(0,Math.min(1,A))}}wrap(h){for(;h<-180;)h+=360;for(;h>180;)h-=360;return h}}function _S(m,h){return h[0]-m[0]}function xv(m){return m[1]-m[0]+1}function uc(m,h){return m[1]>=m[0]&&m[1]<h}function Ix(m,h){if(m[0]>m[1])return[null,null];const g=xv(m);if(h){if(g===2)return[m,null];const C=Math.floor(g/2);return[[m[0],m[0]+C],[m[0]+C,m[1]]]}if(g===1)return[m,null];const x=Math.floor(g/2)-1;return[[m[0],m[0]+x],[m[0]+x+1,m[1]]]}function kx(m,h){if(!uc(h,m.length))return[1/0,1/0,-1/0,-1/0];const g=[1/0,1/0,-1/0,-1/0];for(let x=h[0];x<=h[1];++x)Kp(g,m[x]);return g}function Dx(m){const h=[1/0,1/0,-1/0,-1/0];for(const g of m)for(const x of g)Kp(h,x);return h}function CS(m){return m[0]!==-1/0&&m[1]!==-1/0&&m[2]!==1/0&&m[3]!==1/0}function tr(m,h,g){if(!CS(m)||!CS(h))return NaN;let x=0,C=0;return m[2]<h[0]&&(x=h[0]-m[2]),m[0]>h[2]&&(x=m[0]-h[2]),m[1]>h[3]&&(C=m[1]-h[3]),m[3]<h[1]&&(C=h[1]-m[3]),g.distance([0,0],[x,C])}function qh(m,h,g){const x=g.pointOnLine(h,m);return g.distance(m,x.point)}function Lx(m,h,g,x,C){const E=Math.min(qh(m,[g,x],C),qh(h,[g,x],C)),A=Math.min(qh(g,[m,h],C),qh(x,[m,h],C));return Math.min(E,A)}function KL(m,h,g,x,C){if(!uc(h,m.length)||!uc(x,g.length))return 1/0;let E=1/0;for(let A=h[0];A<h[1];++A){const L=m[A],V=m[A+1];for(let H=x[0];H<x[1];++H){const X=g[H],K=g[H+1];if(gv(L,V,X,K))return 0;E=Math.min(E,Lx(L,V,X,K,C))}}return E}function YL(m,h,g,x,C){if(!uc(h,m.length)||!uc(x,g.length))return NaN;let E=1/0;for(let A=h[0];A<=h[1];++A)for(let L=x[0];L<=x[1];++L)if(E=Math.min(E,C.distance(m[A],g[L])),E===0)return E;return E}function JL(m,h,g){if(mf(m,h,!0))return 0;let x=1/0;for(const C of h){const E=C[0],A=C[C.length-1];if(E!==A&&(x=Math.min(x,qh(m,[A,E],g)),x===0))return x;const L=g.pointOnLine(C,m);if(x=Math.min(x,g.distance(m,L.point)),x===0)return x}return x}function e2(m,h,g,x){if(!uc(h,m.length))return NaN;for(let E=h[0];E<=h[1];++E)if(mf(m[E],g,!0))return 0;let C=1/0;for(let E=h[0];E<h[1];++E){const A=m[E],L=m[E+1];for(const V of g)for(let H=0,X=V.length,K=X-1;H<X;K=H++){const ae=V[K],ue=V[H];if(gv(A,L,ae,ue))return 0;C=Math.min(C,Lx(A,L,ae,ue,x))}}return C}function SS(m,h){for(const g of m)for(const x of g)if(mf(x,h,!0))return!0;return!1}function t2(m,h,g,x=1/0){const C=Dx(m),E=Dx(h);if(x!==1/0&&tr(C,E,g)>=x)return x;if(pf(C,E)){if(SS(m,h))return 0}else if(SS(h,m))return 0;let A=1/0;for(const L of m)for(let V=0,H=L.length,X=H-1;V<H;X=V++){const K=L[X],ae=L[V];for(const ue of h)for(let de=0,ge=ue.length,Te=ge-1;de<ge;Te=de++){const Ne=ue[Te],tt=ue[de];if(gv(K,ae,Ne,tt))return 0;A=Math.min(A,Lx(K,ae,Ne,tt,g))}}return A}function OS(m,h,g,x,C,E){if(!E)return;const A=tr(kx(x,E),C,g);A<h&&m.push([A,E,[0,0]])}function bv(m,h,g,x,C,E,A){if(!E||!A)return;const L=tr(kx(x,E),kx(C,A),g);L<h&&m.push([L,E,A])}function wv(m,h,g,x,C=1/0){let E=Math.min(x.distance(m[0],g[0][0]),C);if(E===0)return E;const A=new yv([[0,[0,m.length-1],[0,0]]],_S),L=Dx(g);for(;A.length>0;){const V=A.pop();if(V[0]>=E)continue;const H=V[1],X=h?50:100;if(xv(H)<=X){if(!uc(H,m.length))return NaN;if(h){const K=e2(m,H,g,x);if(isNaN(K)||K===0)return K;E=Math.min(E,K)}else for(let K=H[0];K<=H[1];++K){const ae=JL(m[K],g,x);if(E=Math.min(E,ae),E===0)return 0}}else{const K=Ix(H,h);OS(A,E,x,m,L,K[0]),OS(A,E,x,m,L,K[1])}}return E}function _v(m,h,g,x,C,E=1/0){let A=Math.min(E,C.distance(m[0],g[0]));if(A===0)return A;const L=new yv([[0,[0,m.length-1],[0,g.length-1]]],_S);for(;L.length>0;){const V=L.pop();if(V[0]>=A)continue;const H=V[1],X=V[2],K=h?50:100,ae=x?50:100;if(xv(H)<=K&&xv(X)<=ae){if(!uc(H,m.length)&&uc(X,g.length))return NaN;let ue;if(h&&x)ue=KL(m,H,g,X,C),A=Math.min(A,ue);else if(h&&!x){const de=m.slice(H[0],H[1]+1);for(let ge=X[0];ge<=X[1];++ge)if(ue=qh(g[ge],de,C),A=Math.min(A,ue),A===0)return A}else if(!h&&x){const de=g.slice(X[0],X[1]+1);for(let ge=H[0];ge<=H[1];++ge)if(ue=qh(m[ge],de,C),A=Math.min(A,ue),A===0)return A}else ue=YL(m,H,g,X,C),A=Math.min(A,ue)}else{const ue=Ix(H,h),de=Ix(X,x);bv(L,A,C,m,g,ue[0],de[0]),bv(L,A,C,m,g,ue[0],de[1]),bv(L,A,C,m,g,ue[1],de[0]),bv(L,A,C,m,g,ue[1],de[1])}}return A}function Fx(m){return m.type==="MultiPolygon"?m.coordinates.map(h=>({type:"Polygon",coordinates:h})):m.type==="MultiLineString"?m.coordinates.map(h=>({type:"LineString",coordinates:h})):m.type==="MultiPoint"?m.coordinates.map(h=>({type:"Point",coordinates:h})):[m]}class jh{constructor(h,g){this.type=qt,this.geojson=h,this.geometries=g}static parse(h,g){if(h.length!==2)return g.error(`'distance' expression requires exactly one argument, but found ${h.length-1} instead.`);if(Du(h[1])){const x=h[1];if(x.type==="FeatureCollection")return new jh(x,x.features.map(C=>Fx(C.geometry)).flat());if(x.type==="Feature")return new jh(x,Fx(x.geometry));if("type"in x&&"coordinates"in x)return new jh(x,Fx(x))}return g.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(h){if(h.geometry()!=null&&h.canonicalID()!=null){if(h.geometryType()==="Point")return function(g,x){const C=g.geometry(),E=C.flat().map(V=>ff([V.x,V.y],g.canonical));if(C.length===0)return NaN;const A=new Ax(E[0][1]);let L=1/0;for(const V of x){switch(V.type){case"Point":L=Math.min(L,_v(E,!1,[V.coordinates],!1,A,L));break;case"LineString":L=Math.min(L,_v(E,!1,V.coordinates,!0,A,L));break;case"Polygon":L=Math.min(L,wv(E,!1,V.coordinates,A,L))}if(L===0)return L}return L}(h,this.geometries);if(h.geometryType()==="LineString")return function(g,x){const C=g.geometry(),E=C.flat().map(V=>ff([V.x,V.y],g.canonical));if(C.length===0)return NaN;const A=new Ax(E[0][1]);let L=1/0;for(const V of x){switch(V.type){case"Point":L=Math.min(L,_v(E,!0,[V.coordinates],!1,A,L));break;case"LineString":L=Math.min(L,_v(E,!0,V.coordinates,!0,A,L));break;case"Polygon":L=Math.min(L,wv(E,!0,V.coordinates,A,L))}if(L===0)return L}return L}(h,this.geometries);if(h.geometryType()==="Polygon")return function(g,x){const C=g.geometry();if(C.length===0||C[0].length===0)return NaN;const E=Jp(C,0).map(V=>V.map(H=>H.map(X=>ff([X.x,X.y],g.canonical)))),A=new Ax(E[0][0][0][1]);let L=1/0;for(const V of x)for(const H of E){switch(V.type){case"Point":L=Math.min(L,wv([V.coordinates],!1,H,A,L));break;case"LineString":L=Math.min(L,wv(V.coordinates,!0,H,A,L));break;case"Polygon":L=Math.min(L,t2(H,V.coordinates,A,L))}if(L===0)return L}return L}(h,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const gf={"==":Cx,"!=":WL,">":mv,"<":pv,">=":dS,"<=":Pl,array:Yo,at:Tl,boolean:Yo,case:Zp,coalesce:hf,collator:$h,format:df,image:Ox,in:jp,"index-of":Qp,interpolate:_o,"interpolate-hcl":_o,"interpolate-lab":_o,length:Mx,let:Vn,literal:Lu,match:hv,number:Yo,"number-format":Sx,object:Yo,slice:Xp,step:uf,string:Yo,"to-boolean":lc,"to-color":lc,"to-number":lc,"to-string":lc,var:cf,within:Wh,distance:jh};class Ja{constructor(h,g,x,C){this.name=h,this.type=g,this._evaluate=x,this.args=C}evaluate(h){return this._evaluate(h,this.args)}eachChild(h){this.args.forEach(h)}outputDefined(){return!1}static parse(h,g){const x=h[0],C=Ja.definitions[x];if(!C)return g.error(`Unknown expression "${x}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(C)?C[0]:C.type,A=Array.isArray(C)?[[C[1],C[2]]]:C.overloads,L=A.filter(([H])=>!Array.isArray(H)||H.length===h.length-1);let V=null;for(const[H,X]of L){V=new lf(g.registry,Cv,g.path,null,g.scope);const K=[];let ae=!1;for(let ue=1;ue<h.length;ue++){const de=h[ue],ge=Array.isArray(H)?H[ue-1]:H.type,Te=V.parse(de,1+K.length,ge);if(!Te){ae=!0;break}K.push(Te)}if(!ae)if(Array.isArray(H)&&H.length!==K.length)V.error(`Expected ${H.length} arguments, but found ${K.length} instead.`);else{for(let ue=0;ue<K.length;ue++){const de=Array.isArray(H)?H[ue]:H.type,ge=K[ue];V.concat(ue+1).checkSubtype(de,ge.type)}if(V.errors.length===0)return new Ja(x,E,X,K)}}if(L.length===1)g.errors.push(...V.errors);else{const H=(L.length?L:A).map(([K])=>{return ae=K,Array.isArray(ae)?`(${ae.map(Oe).join(", ")})`:`(${Oe(ae.type)}...)`;var ae}).join(" | "),X=[];for(let K=1;K<h.length;K++){const ae=g.parse(h[K],1+X.length);if(!ae)return null;X.push(Oe(ae.type))}g.error(`Expected arguments of type ${H}, but found (${X.join(", ")}) instead.`)}return null}static register(h,g){Ja.definitions=g;for(const x in g)h[x]=Ja}}function MS(m,[h,g,x,C]){h=h.evaluate(m),g=g.evaluate(m),x=x.evaluate(m);const E=C?C.evaluate(m):1,A=lS(h,g,x,E);if(A)throw new Ir(A);return new hn(h/255,g/255,x/255,E,!1)}function TS(m,h){return m in h}function Nx(m,h){const g=h[m];return g===void 0?null:g}function Qh(m){return{type:m}}function Cv(m){if(m instanceof cf)return Cv(m.boundExpression);if(m instanceof Ja&&m.name==="error"||m instanceof $h||m instanceof Wh||m instanceof jh)return!1;const h=m instanceof lc||m instanceof Yo;let g=!0;return m.eachChild(x=>{g=h?g&&Cv(x):g&&x instanceof Lu}),!!g&&Sv(m)&&Ov(m,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Sv(m){if(m instanceof Ja&&(m.name==="get"&&m.args.length===1||m.name==="feature-state"||m.name==="has"&&m.args.length===1||m.name==="properties"||m.name==="geometry-type"||m.name==="id"||/^filter-/.test(m.name))||m instanceof Wh||m instanceof jh)return!1;let h=!0;return m.eachChild(g=>{h&&!Sv(g)&&(h=!1)}),h}function em(m){if(m instanceof Ja&&m.name==="feature-state")return!1;let h=!0;return m.eachChild(g=>{h&&!em(g)&&(h=!1)}),h}function Ov(m,h){if(m instanceof Ja&&h.indexOf(m.name)>=0)return!1;let g=!0;return m.eachChild(x=>{g&&!Ov(x,h)&&(g=!1)}),g}function RS(m){return{result:"success",value:m}}function vf(m){return{result:"error",value:m}}function yf(m){return m["property-type"]==="data-driven"||m["property-type"]==="cross-faded-data-driven"}function PS(m){return!!m.expression&&m.expression.parameters.indexOf("zoom")>-1}function Bx(m){return!!m.expression&&m.expression.interpolated}function Zn(m){return m instanceof Number?"number":m instanceof String?"string":m instanceof Boolean?"boolean":Array.isArray(m)?"array":m===null?"null":typeof m}function Mv(m){return typeof m=="object"&&m!==null&&!Array.isArray(m)}function zx(m){return m}function ES(m,h){const g=h.type==="color",x=m.stops&&typeof m.stops[0][0]=="object",C=x||!(x||m.property!==void 0),E=m.type||(Bx(h)?"exponential":"interval");if(g||h.type==="padding"){const X=g?hn.parse:io.parse;(m=tn({},m)).stops&&(m.stops=m.stops.map(K=>[K[0],X(K[1])])),m.default=X(m.default?m.default:h.default)}if(m.colorSpace&&(A=m.colorSpace)!=="rgb"&&A!=="hcl"&&A!=="lab")throw new Error(`Unknown color space: "${m.colorSpace}"`);var A;let L,V,H;if(E==="exponential")L=IS;else if(E==="interval")L=AS;else if(E==="categorical"){L=i2,V=Object.create(null);for(const X of m.stops)V[X[0]]=X[1];H=typeof m.stops[0][0]}else{if(E!=="identity")throw new Error(`Unknown function type "${E}"`);L=n2}if(x){const X={},K=[];for(let de=0;de<m.stops.length;de++){const ge=m.stops[de],Te=ge[0].zoom;X[Te]===void 0&&(X[Te]={zoom:Te,type:m.type,property:m.property,default:m.default,stops:[]},K.push(Te)),X[Te].stops.push([ge[0].value,ge[1]])}const ae=[];for(const de of K)ae.push([X[de].zoom,ES(X[de],h)]);const ue={name:"linear"};return{kind:"composite",interpolationType:ue,interpolationFactor:_o.interpolationFactor.bind(void 0,ue),zoomStops:ae.map(de=>de[0]),evaluate:({zoom:de},ge)=>IS({stops:ae,base:m.base},h,de).evaluate(de,ge)}}if(C){const X=E==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:X,interpolationFactor:_o.interpolationFactor.bind(void 0,X),zoomStops:m.stops.map(K=>K[0]),evaluate:({zoom:K})=>L(m,h,K,V,H)}}return{kind:"source",evaluate(X,K){const ae=K&&K.properties?K.properties[m.property]:void 0;return ae===void 0?tm(m.default,h.default):L(m,h,ae,V,H)}}}function tm(m,h,g){return m!==void 0?m:h!==void 0?h:g!==void 0?g:void 0}function i2(m,h,g,x,C){return tm(typeof g===C?x[g]:void 0,m.default,h.default)}function AS(m,h,g){if(Zn(g)!=="number")return tm(m.default,h.default);const x=m.stops.length;if(x===1||g<=m.stops[0][0])return m.stops[0][1];if(g>=m.stops[x-1][0])return m.stops[x-1][1];const C=dv(m.stops.map(E=>E[0]),g);return m.stops[C][1]}function IS(m,h,g){const x=m.base!==void 0?m.base:1;if(Zn(g)!=="number")return tm(m.default,h.default);const C=m.stops.length;if(C===1||g<=m.stops[0][0])return m.stops[0][1];if(g>=m.stops[C-1][0])return m.stops[C-1][1];const E=dv(m.stops.map(X=>X[0]),g),A=function(X,K,ae,ue){const de=ue-ae,ge=X-ae;return de===0?0:K===1?ge/de:(Math.pow(K,ge)-1)/(Math.pow(K,de)-1)}(g,x,m.stops[E][0],m.stops[E+1][0]),L=m.stops[E][1],V=m.stops[E+1][1],H=Rl[h.type]||zx;return typeof L.evaluate=="function"?{evaluate(...X){const K=L.evaluate.apply(void 0,X),ae=V.evaluate.apply(void 0,X);if(K!==void 0&&ae!==void 0)return H(K,ae,A,m.colorSpace)}}:H(L,V,A,m.colorSpace)}function n2(m,h,g){switch(h.type){case"color":g=hn.parse(g);break;case"formatted":g=Lo.fromString(g.toString());break;case"resolvedImage":g=Ko.fromString(g.toString());break;case"padding":g=io.parse(g);break;default:Zn(g)===h.type||h.type==="enum"&&h.values[g]||(g=void 0)}return tm(g,m.default,h.default)}Ja.register(gf,{error:[{kind:"error"},[Oi],(m,[h])=>{throw new Ir(h.evaluate(m))}],typeof:[Oi,[Qi],(m,[h])=>Oe(kr(h.evaluate(m)))],"to-rgba":[xo(qt,4),[dn],(m,[h])=>{const[g,x,C,E]=h.evaluate(m).rgb;return[255*g,255*x,255*C,E]}],rgb:[dn,[qt,qt,qt],MS],rgba:[dn,[qt,qt,qt,qt],MS],has:{type:li,overloads:[[[Oi],(m,[h])=>TS(h.evaluate(m),m.properties())],[[Oi,Ka],(m,[h,g])=>TS(h.evaluate(m),g.evaluate(m))]]},get:{type:Qi,overloads:[[[Oi],(m,[h])=>Nx(h.evaluate(m),m.properties())],[[Oi,Ka],(m,[h,g])=>Nx(h.evaluate(m),g.evaluate(m))]]},"feature-state":[Qi,[Oi],(m,[h])=>Nx(h.evaluate(m),m.featureState||{})],properties:[Ka,[],m=>m.properties()],"geometry-type":[Oi,[],m=>m.geometryType()],id:[Qi,[],m=>m.id()],zoom:[qt,[],m=>m.globals.zoom],"heatmap-density":[qt,[],m=>m.globals.heatmapDensity||0],"line-progress":[qt,[],m=>m.globals.lineProgress||0],accumulated:[Qi,[],m=>m.globals.accumulated===void 0?null:m.globals.accumulated],"+":[qt,Qh(qt),(m,h)=>{let g=0;for(const x of h)g+=x.evaluate(m);return g}],"*":[qt,Qh(qt),(m,h)=>{let g=1;for(const x of h)g*=x.evaluate(m);return g}],"-":{type:qt,overloads:[[[qt,qt],(m,[h,g])=>h.evaluate(m)-g.evaluate(m)],[[qt],(m,[h])=>-h.evaluate(m)]]},"/":[qt,[qt,qt],(m,[h,g])=>h.evaluate(m)/g.evaluate(m)],"%":[qt,[qt,qt],(m,[h,g])=>h.evaluate(m)%g.evaluate(m)],ln2:[qt,[],()=>Math.LN2],pi:[qt,[],()=>Math.PI],e:[qt,[],()=>Math.E],"^":[qt,[qt,qt],(m,[h,g])=>Math.pow(h.evaluate(m),g.evaluate(m))],sqrt:[qt,[qt],(m,[h])=>Math.sqrt(h.evaluate(m))],log10:[qt,[qt],(m,[h])=>Math.log(h.evaluate(m))/Math.LN10],ln:[qt,[qt],(m,[h])=>Math.log(h.evaluate(m))],log2:[qt,[qt],(m,[h])=>Math.log(h.evaluate(m))/Math.LN2],sin:[qt,[qt],(m,[h])=>Math.sin(h.evaluate(m))],cos:[qt,[qt],(m,[h])=>Math.cos(h.evaluate(m))],tan:[qt,[qt],(m,[h])=>Math.tan(h.evaluate(m))],asin:[qt,[qt],(m,[h])=>Math.asin(h.evaluate(m))],acos:[qt,[qt],(m,[h])=>Math.acos(h.evaluate(m))],atan:[qt,[qt],(m,[h])=>Math.atan(h.evaluate(m))],min:[qt,Qh(qt),(m,h)=>Math.min(...h.map(g=>g.evaluate(m)))],max:[qt,Qh(qt),(m,h)=>Math.max(...h.map(g=>g.evaluate(m)))],abs:[qt,[qt],(m,[h])=>Math.abs(h.evaluate(m))],round:[qt,[qt],(m,[h])=>{const g=h.evaluate(m);return g<0?-Math.round(-g):Math.round(g)}],floor:[qt,[qt],(m,[h])=>Math.floor(h.evaluate(m))],ceil:[qt,[qt],(m,[h])=>Math.ceil(h.evaluate(m))],"filter-==":[li,[Oi,Qi],(m,[h,g])=>m.properties()[h.value]===g.value],"filter-id-==":[li,[Qi],(m,[h])=>m.id()===h.value],"filter-type-==":[li,[Oi],(m,[h])=>m.geometryType()===h.value],"filter-<":[li,[Oi,Qi],(m,[h,g])=>{const x=m.properties()[h.value],C=g.value;return typeof x==typeof C&&x<C}],"filter-id-<":[li,[Qi],(m,[h])=>{const g=m.id(),x=h.value;return typeof g==typeof x&&g<x}],"filter->":[li,[Oi,Qi],(m,[h,g])=>{const x=m.properties()[h.value],C=g.value;return typeof x==typeof C&&x>C}],"filter-id->":[li,[Qi],(m,[h])=>{const g=m.id(),x=h.value;return typeof g==typeof x&&g>x}],"filter-<=":[li,[Oi,Qi],(m,[h,g])=>{const x=m.properties()[h.value],C=g.value;return typeof x==typeof C&&x<=C}],"filter-id-<=":[li,[Qi],(m,[h])=>{const g=m.id(),x=h.value;return typeof g==typeof x&&g<=x}],"filter->=":[li,[Oi,Qi],(m,[h,g])=>{const x=m.properties()[h.value],C=g.value;return typeof x==typeof C&&x>=C}],"filter-id->=":[li,[Qi],(m,[h])=>{const g=m.id(),x=h.value;return typeof g==typeof x&&g>=x}],"filter-has":[li,[Qi],(m,[h])=>h.value in m.properties()],"filter-has-id":[li,[],m=>m.id()!==null&&m.id()!==void 0],"filter-type-in":[li,[xo(Oi)],(m,[h])=>h.value.indexOf(m.geometryType())>=0],"filter-id-in":[li,[xo(Qi)],(m,[h])=>h.value.indexOf(m.id())>=0],"filter-in-small":[li,[Oi,xo(Qi)],(m,[h,g])=>g.value.indexOf(m.properties()[h.value])>=0],"filter-in-large":[li,[Oi,xo(Qi)],(m,[h,g])=>function(x,C,E,A){for(;E<=A;){const L=E+A>>1;if(C[L]===x)return!0;C[L]>x?A=L-1:E=L+1}return!1}(m.properties()[h.value],g.value,0,g.value.length-1)],all:{type:li,overloads:[[[li,li],(m,[h,g])=>h.evaluate(m)&&g.evaluate(m)],[Qh(li),(m,h)=>{for(const g of h)if(!g.evaluate(m))return!1;return!0}]]},any:{type:li,overloads:[[[li,li],(m,[h,g])=>h.evaluate(m)||g.evaluate(m)],[Qh(li),(m,h)=>{for(const g of h)if(g.evaluate(m))return!0;return!1}]]},"!":[li,[li],(m,[h])=>!h.evaluate(m)],"is-supported-script":[li,[Oi],(m,[h])=>{const g=m.globals&&m.globals.isSupportedScript;return!g||g(h.evaluate(m))}],upcase:[Oi,[Oi],(m,[h])=>h.evaluate(m).toUpperCase()],downcase:[Oi,[Oi],(m,[h])=>h.evaluate(m).toLowerCase()],concat:[Oi,Qh(Qi),(m,h)=>h.map(g=>af(g.evaluate(m))).join("")],"resolved-locale":[Oi,[fs],(m,[h])=>h.evaluate(m).resolvedLocale()]});class xf{constructor(h,g){var x;this.expression=h,this._warningHistory={},this._evaluator=new xn,this._defaultValue=g?(x=g).type==="color"&&Mv(x.default)?new hn(0,0,0,0):x.type==="color"?hn.parse(x.default)||null:x.type==="padding"?io.parse(x.default)||null:x.type==="variableAnchorOffsetCollection"?Fo.parse(x.default)||null:x.type==="projectionDefinition"?Ds.parse(x.default)||null:x.default===void 0?null:x.default:null,this._enumValues=g&&g.type==="enum"?g.values:null}evaluateWithoutErrorHandling(h,g,x,C,E,A){return this._evaluator.globals=h,this._evaluator.feature=g,this._evaluator.featureState=x,this._evaluator.canonical=C,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A,this.expression.evaluate(this._evaluator)}evaluate(h,g,x,C,E,A){this._evaluator.globals=h,this._evaluator.feature=g||null,this._evaluator.featureState=x||null,this._evaluator.canonical=C,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new Ir(`Expected value to be one of ${Object.keys(this._enumValues).map(V=>JSON.stringify(V)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function im(m){return Array.isArray(m)&&m.length>0&&typeof m[0]=="string"&&m[0]in gf}function Tv(m,h){const g=new lf(gf,Cv,[],h?function(C){const E={color:dn,string:Oi,number:qt,enum:Oi,boolean:li,formatted:wr,padding:sf,projectionDefinition:br,resolvedImage:ku,variableAnchorOffsetCollection:ac};return C.type==="array"?xo(E[C.value]||Qi,C.length):E[C.type]}(h):void 0),x=g.parse(m,void 0,void 0,void 0,h&&h.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?RS(new xf(x,h)):vf(g.errors)}class Vx{constructor(h,g){this.kind=h,this._styleExpression=g,this.isStateDependent=h!=="constant"&&!em(g.expression)}evaluateWithoutErrorHandling(h,g,x,C,E,A){return this._styleExpression.evaluateWithoutErrorHandling(h,g,x,C,E,A)}evaluate(h,g,x,C,E,A){return this._styleExpression.evaluate(h,g,x,C,E,A)}}class Gx{constructor(h,g,x,C){this.kind=h,this.zoomStops=x,this._styleExpression=g,this.isStateDependent=h!=="camera"&&!em(g.expression),this.interpolationType=C}evaluateWithoutErrorHandling(h,g,x,C,E,A){return this._styleExpression.evaluateWithoutErrorHandling(h,g,x,C,E,A)}evaluate(h,g,x,C,E,A){return this._styleExpression.evaluate(h,g,x,C,E,A)}interpolationFactor(h,g,x){return this.interpolationType?_o.interpolationFactor(this.interpolationType,h,g,x):0}}function kS(m,h){const g=Tv(m,h);if(g.result==="error")return g;const x=g.value.expression,C=Sv(x);if(!C&&!yf(h))return vf([new Ni("","data expressions not supported")]);const E=Ov(x,["zoom"]);if(!E&&!PS(h))return vf([new Ni("","zoom expressions not supported")]);const A=nm(x);return A||E?A instanceof Ni?vf([A]):A instanceof _o&&!Bx(h)?vf([new Ni("",'"interpolate" expressions cannot be used with this property')]):RS(A?new Gx(C?"camera":"composite",g.value,A.labels,A instanceof _o?A.interpolation:void 0):new Vx(C?"constant":"source",g.value)):vf([new Ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Rv{constructor(h,g){this._parameters=h,this._specification=g,tn(this,ES(this._parameters,this._specification))}static deserialize(h){return new Rv(h._parameters,h._specification)}static serialize(h){return{_parameters:h._parameters,_specification:h._specification}}}function nm(m){let h=null;if(m instanceof Vn)h=nm(m.result);else if(m instanceof hf){for(const g of m.args)if(h=nm(g),h)break}else(m instanceof uf||m instanceof _o)&&m.input instanceof Ja&&m.input.name==="zoom"&&(h=m);return h instanceof Ni||m.eachChild(g=>{const x=nm(g);x instanceof Ni?h=x:!h&&x?h=new Ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):h&&x&&h!==x&&(h=new Ni("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),h}function Pv(m){if(m===!0||m===!1)return!0;if(!Array.isArray(m)||m.length===0)return!1;switch(m[0]){case"has":return m.length>=2&&m[1]!=="$id"&&m[1]!=="$type";case"in":return m.length>=3&&(typeof m[1]!="string"||Array.isArray(m[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return m.length!==3||Array.isArray(m[1])||Array.isArray(m[2]);case"any":case"all":for(const h of m.slice(1))if(!Pv(h)&&typeof h!="boolean")return!1;return!0;default:return!0}}const r2={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ux(m){if(m==null)return{filter:()=>!0,needGeometry:!1};Pv(m)||(m=rm(m));const h=Tv(m,r2);if(h.result==="error")throw new Error(h.value.map(g=>`${g.key}: ${g.message}`).join(", "));return{filter:(g,x,C)=>h.value.evaluate(g,x,{},C),needGeometry:Hx(m)}}function DS(m,h){return m<h?-1:m>h?1:0}function Hx(m){if(!Array.isArray(m))return!1;if(m[0]==="within"||m[0]==="distance")return!0;for(let h=1;h<m.length;h++)if(Hx(m[h]))return!0;return!1}function rm(m){if(!m)return!0;const h=m[0];return m.length<=1?h!=="any":h==="=="?Ev(m[1],m[2],"=="):h==="!="?bf(Ev(m[1],m[2],"==")):h==="<"||h===">"||h==="<="||h===">="?Ev(m[1],m[2],h):h==="any"?(g=m.slice(1),["any"].concat(g.map(rm))):h==="all"?["all"].concat(m.slice(1).map(rm)):h==="none"?["all"].concat(m.slice(1).map(rm).map(bf)):h==="in"?Av(m[1],m.slice(2)):h==="!in"?bf(Av(m[1],m.slice(2))):h==="has"?Iv(m[1]):h!=="!has"||bf(Iv(m[1]));var g}function Ev(m,h,g){switch(m){case"$type":return[`filter-type-${g}`,h];case"$id":return[`filter-id-${g}`,h];default:return[`filter-${g}`,m,h]}}function Av(m,h){if(h.length===0)return!1;switch(m){case"$type":return["filter-type-in",["literal",h]];case"$id":return["filter-id-in",["literal",h]];default:return h.length>200&&!h.some(g=>typeof g!=typeof h[0])?["filter-in-large",m,["literal",h.sort(DS)]]:["filter-in-small",m,["literal",h]]}}function Iv(m){switch(m){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",m]}}function bf(m){return["!",m]}function wf(m){const h=typeof m;if(h==="number"||h==="boolean"||h==="string"||m==null)return JSON.stringify(m);if(Array.isArray(m)){let C="[";for(const E of m)C+=`${wf(E)},`;return`${C}]`}const g=Object.keys(m).sort();let x="{";for(let C=0;C<g.length;C++)x+=`${JSON.stringify(g[C])}:${wf(m[g[C]])},`;return`${x}}`}function s2(m){let h="";for(const g of te)h+=`/${wf(m[g])}`;return h}function LS(m){const h=m.value;return h?[new xt(m.key,h,"constants have been deprecated as of v8")]:[]}function rs(m){return m instanceof Number||m instanceof String||m instanceof Boolean?m.valueOf():m}function Zh(m){if(Array.isArray(m))return m.map(Zh);if(m instanceof Object&&!(m instanceof Number||m instanceof String||m instanceof Boolean)){const h={};for(const g in m)h[g]=Zh(m[g]);return h}return rs(m)}function el(m){const h=m.key,g=m.value,x=m.valueSpec||{},C=m.objectElementValidators||{},E=m.style,A=m.styleSpec,L=m.validateSpec;let V=[];const H=Zn(g);if(H!=="object")return[new xt(h,g,`object expected, ${H} found`)];for(const X in g){const K=X.split(".")[0],ae=x[K]||x["*"];let ue;if(C[K])ue=C[K];else if(x[K])ue=L;else if(C["*"])ue=C["*"];else{if(!x["*"]){V.push(new xt(h,g[X],`unknown property "${X}"`));continue}ue=L}V=V.concat(ue({key:(h&&`${h}.`)+X,value:g[X],valueSpec:ae,style:E,styleSpec:A,object:g,objectKey:X,validateSpec:L},g))}for(const X in x)C[X]||x[X].required&&x[X].default===void 0&&g[X]===void 0&&V.push(new xt(h,g,`missing required property "${X}"`));return V}function $x(m){const h=m.value,g=m.valueSpec,x=m.style,C=m.styleSpec,E=m.key,A=m.arrayElementValidator||m.validateSpec;if(Zn(h)!=="array")return[new xt(E,h,`array expected, ${Zn(h)} found`)];if(g.length&&h.length!==g.length)return[new xt(E,h,`array length ${g.length} expected, length ${h.length} found`)];if(g["min-length"]&&h.length<g["min-length"])return[new xt(E,h,`array length at least ${g["min-length"]} expected, length ${h.length} found`)];let L={type:g.value,values:g.values};C.$version<7&&(L.function=g.function),Zn(g.value)==="object"&&(L=g.value);let V=[];for(let H=0;H<h.length;H++)V=V.concat(A({array:h,arrayIndex:H,value:h[H],valueSpec:L,validateSpec:m.validateSpec,style:x,styleSpec:C,key:`${E}[${H}]`}));return V}function kv(m){const h=m.key,g=m.value,x=m.valueSpec;let C=Zn(g);return C==="number"&&g!=g&&(C="NaN"),C!=="number"?[new xt(h,g,`number expected, ${C} found`)]:"minimum"in x&&g<x.minimum?[new xt(h,g,`${g} is less than the minimum value ${x.minimum}`)]:"maximum"in x&&g>x.maximum?[new xt(h,g,`${g} is greater than the maximum value ${x.maximum}`)]:[]}function Wx(m){const h=m.valueSpec,g=rs(m.value.type);let x,C,E,A={};const L=g!=="categorical"&&m.value.property===void 0,V=!L,H=Zn(m.value.stops)==="array"&&Zn(m.value.stops[0])==="array"&&Zn(m.value.stops[0][0])==="object",X=el({key:m.key,value:m.value,valueSpec:m.styleSpec.function,validateSpec:m.validateSpec,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(ue){if(g==="identity")return[new xt(ue.key,ue.value,'identity function may not have a "stops" property')];let de=[];const ge=ue.value;return de=de.concat($x({key:ue.key,value:ge,valueSpec:ue.valueSpec,validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec,arrayElementValidator:K})),Zn(ge)==="array"&&ge.length===0&&de.push(new xt(ue.key,ge,"array must have at least one stop")),de},default:function(ue){return ue.validateSpec({key:ue.key,value:ue.value,valueSpec:h,validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec})}}});return g==="identity"&&L&&X.push(new xt(m.key,m.value,'missing required property "property"')),g==="identity"||m.value.stops||X.push(new xt(m.key,m.value,'missing required property "stops"')),g==="exponential"&&m.valueSpec.expression&&!Bx(m.valueSpec)&&X.push(new xt(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(V&&!yf(m.valueSpec)?X.push(new xt(m.key,m.value,"property functions not supported")):L&&!PS(m.valueSpec)&&X.push(new xt(m.key,m.value,"zoom functions not supported"))),g!=="categorical"&&!H||m.value.property!==void 0||X.push(new xt(m.key,m.value,'"property" property is required')),X;function K(ue){let de=[];const ge=ue.value,Te=ue.key;if(Zn(ge)!=="array")return[new xt(Te,ge,`array expected, ${Zn(ge)} found`)];if(ge.length!==2)return[new xt(Te,ge,`array length 2 expected, length ${ge.length} found`)];if(H){if(Zn(ge[0])!=="object")return[new xt(Te,ge,`object expected, ${Zn(ge[0])} found`)];if(ge[0].zoom===void 0)return[new xt(Te,ge,"object stop key must have zoom")];if(ge[0].value===void 0)return[new xt(Te,ge,"object stop key must have value")];if(E&&E>rs(ge[0].zoom))return[new xt(Te,ge[0].zoom,"stop zoom values must appear in ascending order")];rs(ge[0].zoom)!==E&&(E=rs(ge[0].zoom),C=void 0,A={}),de=de.concat(el({key:`${Te}[0]`,value:ge[0],valueSpec:{zoom:{}},validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec,objectElementValidators:{zoom:kv,value:ae}}))}else de=de.concat(ae({key:`${Te}[0]`,value:ge[0],validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec},ge));return im(Zh(ge[1]))?de.concat([new xt(`${Te}[1]`,ge[1],"expressions are not allowed in function stops.")]):de.concat(ue.validateSpec({key:`${Te}[1]`,value:ge[1],valueSpec:h,validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec}))}function ae(ue,de){const ge=Zn(ue.value),Te=rs(ue.value),Ne=ue.value!==null?ue.value:de;if(x){if(ge!==x)return[new xt(ue.key,Ne,`${ge} stop domain type must match previous stop domain type ${x}`)]}else x=ge;if(ge!=="number"&&ge!=="string"&&ge!=="boolean")return[new xt(ue.key,Ne,"stop domain value must be a number, string, or boolean")];if(ge!=="number"&&g!=="categorical"){let tt=`number expected, ${ge} found`;return yf(h)&&g===void 0&&(tt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xt(ue.key,Ne,tt)]}return g!=="categorical"||ge!=="number"||isFinite(Te)&&Math.floor(Te)===Te?g!=="categorical"&&ge==="number"&&C!==void 0&&Te<C?[new xt(ue.key,Ne,"stop domain values must appear in ascending order")]:(C=Te,g==="categorical"&&Te in A?[new xt(ue.key,Ne,"stop domain values must be unique")]:(A[Te]=!0,[])):[new xt(ue.key,Ne,`integer expected, found ${Te}`)]}}function tu(m){const h=(m.expressionContext==="property"?kS:Tv)(Zh(m.value),m.valueSpec);if(h.result==="error")return h.value.map(x=>new xt(`${m.key}${x.key}`,m.value,x.message));const g=h.value.expression||h.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!g.outputDefined())return[new xt(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!em(g))return[new xt(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter"&&!em(g))return[new xt(m.key,m.value,'"feature-state" data expressions are not supported with filters.')];if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!Ov(g,["zoom","feature-state"]))return[new xt(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!Sv(g))return[new xt(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function sm(m){const h=m.key,g=m.value,x=m.valueSpec,C=[];return Array.isArray(x.values)?x.values.indexOf(rs(g))===-1&&C.push(new xt(h,g,`expected one of [${x.values.join(", ")}], ${JSON.stringify(g)} found`)):Object.keys(x.values).indexOf(rs(g))===-1&&C.push(new xt(h,g,`expected one of [${Object.keys(x.values).join(", ")}], ${JSON.stringify(g)} found`)),C}function Dv(m){return Pv(Zh(m.value))?tu(tn({},m,{expressionContext:"filter",valueSpec:{value:"boolean"}})):qx(m)}function qx(m){const h=m.value,g=m.key;if(Zn(h)!=="array")return[new xt(g,h,`array expected, ${Zn(h)} found`)];const x=m.styleSpec;let C,E=[];if(h.length<1)return[new xt(g,h,"filter array must have at least 1 element")];switch(E=E.concat(sm({key:`${g}[0]`,value:h[0],valueSpec:x.filter_operator,style:m.style,styleSpec:m.styleSpec})),rs(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&rs(h[1])==="$type"&&E.push(new xt(g,h,`"$type" cannot be use with operator "${h[0]}"`));case"==":case"!=":h.length!==3&&E.push(new xt(g,h,`filter array for operator "${h[0]}" must have 3 elements`));case"in":case"!in":h.length>=2&&(C=Zn(h[1]),C!=="string"&&E.push(new xt(`${g}[1]`,h[1],`string expected, ${C} found`)));for(let A=2;A<h.length;A++)C=Zn(h[A]),rs(h[1])==="$type"?E=E.concat(sm({key:`${g}[${A}]`,value:h[A],valueSpec:x.geometry_type,style:m.style,styleSpec:m.styleSpec})):C!=="string"&&C!=="number"&&C!=="boolean"&&E.push(new xt(`${g}[${A}]`,h[A],`string, number, or boolean expected, ${C} found`));break;case"any":case"all":case"none":for(let A=1;A<h.length;A++)E=E.concat(qx({key:`${g}[${A}]`,value:h[A],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":C=Zn(h[1]),h.length!==2?E.push(new xt(g,h,`filter array for "${h[0]}" operator must have 2 elements`)):C!=="string"&&E.push(new xt(`${g}[1]`,h[1],`string expected, ${C} found`))}return E}function FS(m,h){const g=m.key,x=m.validateSpec,C=m.style,E=m.styleSpec,A=m.value,L=m.objectKey,V=E[`${h}_${m.layerType}`];if(!V)return[];const H=L.match(/^(.*)-transition$/);if(h==="paint"&&H&&V[H[1]]&&V[H[1]].transition)return x({key:g,value:A,valueSpec:E.transition,style:C,styleSpec:E});const X=m.valueSpec||V[L];if(!X)return[new xt(g,A,`unknown property "${L}"`)];let K;if(Zn(A)==="string"&&yf(X)&&!X.tokens&&(K=/^{([^}]+)}$/.exec(A)))return[new xt(g,A,`"${L}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(K[1])} }\`.`)];const ae=[];return m.layerType==="symbol"&&(L==="text-field"&&C&&!C.glyphs&&ae.push(new xt(g,A,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&Mv(Zh(A))&&rs(A.type)==="identity"&&ae.push(new xt(g,A,'"text-font" does not support identity functions'))),ae.concat(x({key:m.key,value:A,valueSpec:X,style:C,styleSpec:E,expressionContext:"property",propertyType:h,propertyKey:L}))}function jx(m){return FS(m,"paint")}function Qx(m){return FS(m,"layout")}function _f(m){let h=[];const g=m.value,x=m.key,C=m.style,E=m.styleSpec;g.type||g.ref||h.push(new xt(x,g,'either "type" or "ref" is required'));let A=rs(g.type);const L=rs(g.ref);if(g.id){const V=rs(g.id);for(let H=0;H<m.arrayIndex;H++){const X=C.layers[H];rs(X.id)===V&&h.push(new xt(x,g.id,`duplicate layer id "${g.id}", previously used at line ${X.id.__line__}`))}}if("ref"in g){let V;["type","source","source-layer","filter","layout"].forEach(H=>{H in g&&h.push(new xt(x,g[H],`"${H}" is prohibited for ref layers`))}),C.layers.forEach(H=>{rs(H.id)===L&&(V=H)}),V?V.ref?h.push(new xt(x,g.ref,"ref cannot reference another ref layer")):A=rs(V.type):h.push(new xt(x,g.ref,`ref layer "${L}" not found`))}else if(A!=="background")if(g.source){const V=C.sources&&C.sources[g.source],H=V&&rs(V.type);V?H==="vector"&&A==="raster"?h.push(new xt(x,g.source,`layer "${g.id}" requires a raster source`)):H!=="raster-dem"&&A==="hillshade"?h.push(new xt(x,g.source,`layer "${g.id}" requires a raster-dem source`)):H==="raster"&&A!=="raster"?h.push(new xt(x,g.source,`layer "${g.id}" requires a vector source`)):H!=="vector"||g["source-layer"]?H==="raster-dem"&&A!=="hillshade"?h.push(new xt(x,g.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="line"||!g.paint||!g.paint["line-gradient"]||H==="geojson"&&V.lineMetrics||h.push(new xt(x,g,`layer "${g.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):h.push(new xt(x,g,`layer "${g.id}" must specify a "source-layer"`)):h.push(new xt(x,g.source,`source "${g.source}" not found`))}else h.push(new xt(x,g,'missing required property "source"'));return h=h.concat(el({key:x,value:g,valueSpec:E.layer,style:m.style,styleSpec:m.styleSpec,validateSpec:m.validateSpec,objectElementValidators:{"*":()=>[],type:()=>m.validateSpec({key:`${x}.type`,value:g.type,valueSpec:E.layer.type,style:m.style,styleSpec:m.styleSpec,validateSpec:m.validateSpec,object:g,objectKey:"type"}),filter:Dv,layout:V=>el({layer:g,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,validateSpec:V.validateSpec,objectElementValidators:{"*":H=>Qx(tn({layerType:A},H))}}),paint:V=>el({layer:g,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,validateSpec:V.validateSpec,objectElementValidators:{"*":H=>jx(tn({layerType:A},H))}})}})),h}function Xh(m){const h=m.value,g=m.key,x=Zn(h);return x!=="string"?[new xt(g,h,`string expected, ${x} found`)]:[]}const NS={promoteId:function({key:m,value:h}){if(Zn(h)==="string")return Xh({key:m,value:h});{const g=[];for(const x in h)g.push(...Xh({key:`${m}.${x}`,value:h[x]}));return g}}};function BS(m){const h=m.value,g=m.key,x=m.styleSpec,C=m.style,E=m.validateSpec;if(!h.type)return[new xt(g,h,'"type" is required')];const A=rs(h.type);let L;switch(A){case"vector":case"raster":return L=el({key:g,value:h,valueSpec:x[`source_${A.replace("-","_")}`],style:m.style,styleSpec:x,objectElementValidators:NS,validateSpec:E}),L;case"raster-dem":return L=function(V){var H;const X=(H=V.sourceName)!==null&&H!==void 0?H:"",K=V.value,ae=V.styleSpec,ue=ae.source_raster_dem,de=V.style;let ge=[];const Te=Zn(K);if(K===void 0)return ge;if(Te!=="object")return ge.push(new xt("source_raster_dem",K,`object expected, ${Te} found`)),ge;const Ne=rs(K.encoding)==="custom",tt=["redFactor","greenFactor","blueFactor","baseShift"],Ve=V.value.encoding?`"${V.value.encoding}"`:"Default";for(const ce in K)!Ne&&tt.includes(ce)?ge.push(new xt(ce,K[ce],`In "${X}": "${ce}" is only valid when "encoding" is set to "custom". ${Ve} encoding found`)):ue[ce]?ge=ge.concat(V.validateSpec({key:ce,value:K[ce],valueSpec:ue[ce],validateSpec:V.validateSpec,style:de,styleSpec:ae})):ge.push(new xt(ce,K[ce],`unknown property "${ce}"`));return ge}({sourceName:g,value:h,style:m.style,styleSpec:x,validateSpec:E}),L;case"geojson":if(L=el({key:g,value:h,valueSpec:x.source_geojson,style:C,styleSpec:x,validateSpec:E,objectElementValidators:NS}),h.cluster)for(const V in h.clusterProperties){const[H,X]=h.clusterProperties[V],K=typeof H=="string"?[H,["accumulated"],["get",V]]:H;L.push(...tu({key:`${g}.${V}.map`,value:X,expressionContext:"cluster-map"})),L.push(...tu({key:`${g}.${V}.reduce`,value:K,expressionContext:"cluster-reduce"}))}return L;case"video":return el({key:g,value:h,valueSpec:x.source_video,style:C,validateSpec:E,styleSpec:x});case"image":return el({key:g,value:h,valueSpec:x.source_image,style:C,validateSpec:E,styleSpec:x});case"canvas":return[new xt(g,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return sm({key:`${g}.type`,value:h.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function zS(m){const h=m.value,g=m.styleSpec,x=g.light,C=m.style;let E=[];const A=Zn(h);if(h===void 0)return E;if(A!=="object")return E=E.concat([new xt("light",h,`object expected, ${A} found`)]),E;for(const L in h){const V=L.match(/^(.*)-transition$/);E=E.concat(V&&x[V[1]]&&x[V[1]].transition?m.validateSpec({key:L,value:h[L],valueSpec:g.transition,validateSpec:m.validateSpec,style:C,styleSpec:g}):x[L]?m.validateSpec({key:L,value:h[L],valueSpec:x[L],validateSpec:m.validateSpec,style:C,styleSpec:g}):[new xt(L,h[L],`unknown property "${L}"`)])}return E}function VS(m){const h=m.value,g=m.styleSpec,x=g.sky,C=m.style,E=Zn(h);if(h===void 0)return[];if(E!=="object")return[new xt("sky",h,`object expected, ${E} found`)];let A=[];for(const L in h)A=A.concat(x[L]?m.validateSpec({key:L,value:h[L],valueSpec:x[L],style:C,styleSpec:g}):[new xt(L,h[L],`unknown property "${L}"`)]);return A}function GS(m){const h=m.value,g=m.styleSpec,x=g.terrain,C=m.style;let E=[];const A=Zn(h);if(h===void 0)return E;if(A!=="object")return E=E.concat([new xt("terrain",h,`object expected, ${A} found`)]),E;for(const L in h)E=E.concat(x[L]?m.validateSpec({key:L,value:h[L],valueSpec:x[L],validateSpec:m.validateSpec,style:C,styleSpec:g}):[new xt(L,h[L],`unknown property "${L}"`)]);return E}function Cf(m){let h=[];const g=m.value,x=m.key;if(Array.isArray(g)){const C=[],E=[];for(const A in g)g[A].id&&C.includes(g[A].id)&&h.push(new xt(x,g,`all the sprites' ids must be unique, but ${g[A].id} is duplicated`)),C.push(g[A].id),g[A].url&&E.includes(g[A].url)&&h.push(new xt(x,g,`all the sprites' URLs must be unique, but ${g[A].url} is duplicated`)),E.push(g[A].url),h=h.concat(el({key:`${x}[${A}]`,value:g[A],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:m.validateSpec}));return h}return Xh({key:x,value:g})}const Sf={"*":()=>[],array:$x,boolean:function(m){const h=m.value,g=m.key,x=Zn(h);return x!=="boolean"?[new xt(g,h,`boolean expected, ${x} found`)]:[]},number:kv,color:function(m){const h=m.key,g=m.value,x=Zn(g);return x!=="string"?[new xt(h,g,`color expected, ${x} found`)]:hn.parse(String(g))?[]:[new xt(h,g,`color expected, "${g}" found`)]},constants:LS,enum:sm,filter:Dv,function:Wx,layer:_f,object:el,source:BS,light:zS,sky:VS,terrain:GS,projection:function(m){const h=m.value,g=m.styleSpec,x=g.projection,C=m.style,E=Zn(h);if(h===void 0)return[];if(E!=="object")return[new xt("projection",h,`object expected, ${E} found`)];let A=[];for(const L in h)A=A.concat(x[L]?m.validateSpec({key:L,value:h[L],valueSpec:x[L],style:C,styleSpec:g}):[new xt(L,h[L],`unknown property "${L}"`)]);return A},projectionDefinition:function(m){const h=m.key;let g=m.value;g=g instanceof String?g.valueOf():g;const x=Zn(g);return x!=="array"||function(C){return Array.isArray(C)&&C.length===3&&typeof C[0]=="string"&&typeof C[1]=="string"&&typeof C[2]=="number"}(g)||function(C){return!!["interpolate","step","literal"].includes(C[0])}(g)?["array","string"].includes(x)?[]:[new xt(h,g,`projection expected, invalid type "${x}" found`)]:[new xt(h,g,`projection expected, invalid array ${JSON.stringify(g)} found`)]},string:Xh,formatted:function(m){return Xh(m).length===0?[]:tu(m)},resolvedImage:function(m){return Xh(m).length===0?[]:tu(m)},padding:function(m){const h=m.key,g=m.value;if(Zn(g)==="array"){if(g.length<1||g.length>4)return[new xt(h,g,`padding requires 1 to 4 values; ${g.length} values found`)];const x={type:"number"};let C=[];for(let E=0;E<g.length;E++)C=C.concat(m.validateSpec({key:`${h}[${E}]`,value:g[E],validateSpec:m.validateSpec,valueSpec:x}));return C}return kv({key:h,value:g,valueSpec:{}})},variableAnchorOffsetCollection:function(m){const h=m.key,g=m.value,x=Zn(g),C=m.styleSpec;if(x!=="array"||g.length<1||g.length%2!=0)return[new xt(h,g,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let A=0;A<g.length;A+=2)E=E.concat(sm({key:`${h}[${A}]`,value:g[A],valueSpec:C.layout_symbol["text-anchor"]})),E=E.concat($x({key:`${h}[${A+1}]`,value:g[A+1],valueSpec:{length:2,value:"number"},validateSpec:m.validateSpec,style:m.style,styleSpec:C}));return E},sprite:Cf};function Co(m){const h=m.value,g=m.valueSpec,x=m.styleSpec;return m.validateSpec=Co,g.expression&&Mv(rs(h))?Wx(m):g.expression&&im(Zh(h))?tu(m):g.type&&Sf[g.type]?Sf[g.type](m):el(tn({},m,{valueSpec:g.type?x[g.type]:g}))}function Of(m){const h=m.value,g=m.key,x=Xh(m);return x.length||(h.indexOf("{fontstack}")===-1&&x.push(new xt(g,h,'"glyphs" url must include a "{fontstack}" token')),h.indexOf("{range}")===-1&&x.push(new xt(g,h,'"glyphs" url must include a "{range}" token'))),x}function tl(m,h=ee){let g=[];return g=g.concat(Co({key:"",value:m,valueSpec:h.$root,styleSpec:h,style:m,validateSpec:Co,objectElementValidators:{glyphs:Of,"*":()=>[]}})),m.constants&&(g=g.concat(LS({key:"constants",value:m.constants}))),US(g)}function hc(m){return function(h){return m({...h,validateSpec:Co})}}function US(m){return[].concat(m).sort((h,g)=>h.line-g.line)}function Jo(m){return function(...h){return US(m.apply(this,h))}}tl.source=Jo(hc(BS)),tl.sprite=Jo(hc(Cf)),tl.glyphs=Jo(hc(Of)),tl.light=Jo(hc(zS)),tl.sky=Jo(hc(VS)),tl.terrain=Jo(hc(GS)),tl.layer=Jo(hc(_f)),tl.filter=Jo(hc(Dv)),tl.paintProperty=Jo(hc(jx)),tl.layoutProperty=Jo(hc(Qx));const Kh=tl,Zx=Kh.light,o2=Kh.sky,Xx=Kh.paintProperty,a2=Kh.layoutProperty;function Mf(m,h){let g=!1;if(h&&h.length)for(const x of h)m.fire(new oe(new Error(x.message))),g=!0;return g}class om{constructor(h,g,x){const C=this.cells=[];if(h instanceof ArrayBuffer){this.arrayBuffer=h;const A=new Int32Array(this.arrayBuffer);h=A[0],this.d=(g=A[1])+2*(x=A[2]);for(let V=0;V<this.d*this.d;V++){const H=A[3+V],X=A[3+V+1];C.push(H===X?null:A.subarray(H,X))}const L=A[3+C.length+1];this.keys=A.subarray(A[3+C.length],L),this.bboxes=A.subarray(L),this.insert=this._insertReadonly}else{this.d=g+2*x;for(let A=0;A<this.d*this.d;A++)C.push([]);this.keys=[],this.bboxes=[]}this.n=g,this.extent=h,this.padding=x,this.scale=g/h,this.uid=0;const E=x/g*h;this.min=-E,this.max=h+E}insert(h,g,x,C,E){this._forEachCell(g,x,C,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(h),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(C),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(h,g,x,C,E,A){this.cells[E].push(A)}query(h,g,x,C,E){const A=this.min,L=this.max;if(h<=A&&g<=A&&L<=x&&L<=C&&!E)return Array.prototype.slice.call(this.keys);{const V=[];return this._forEachCell(h,g,x,C,this._queryCell,V,{},E),V}}_queryCell(h,g,x,C,E,A,L,V){const H=this.cells[E];if(H!==null){const X=this.keys,K=this.bboxes;for(let ae=0;ae<H.length;ae++){const ue=H[ae];if(L[ue]===void 0){const de=4*ue;(V?V(K[de+0],K[de+1],K[de+2],K[de+3]):h<=K[de+2]&&g<=K[de+3]&&x>=K[de+0]&&C>=K[de+1])?(L[ue]=!0,A.push(X[ue])):L[ue]=!1}}}}_forEachCell(h,g,x,C,E,A,L,V){const H=this._convertToCellCoord(h),X=this._convertToCellCoord(g),K=this._convertToCellCoord(x),ae=this._convertToCellCoord(C);for(let ue=H;ue<=K;ue++)for(let de=X;de<=ae;de++){const ge=this.d*de+ue;if((!V||V(this._convertFromCellCoord(ue),this._convertFromCellCoord(de),this._convertFromCellCoord(ue+1),this._convertFromCellCoord(de+1)))&&E.call(this,h,g,x,C,ge,A,L,V))return}}_convertFromCellCoord(h){return(h-this.padding)/this.scale}_convertToCellCoord(h){return Math.max(0,Math.min(this.d-1,Math.floor(h*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const h=this.cells,g=3+this.cells.length+1+1;let x=0;for(let A=0;A<this.cells.length;A++)x+=this.cells[A].length;const C=new Int32Array(g+x+this.keys.length+this.bboxes.length);C[0]=this.extent,C[1]=this.n,C[2]=this.padding;let E=g;for(let A=0;A<h.length;A++){const L=h[A];C[3+A]=E,C.set(L,E),E+=L.length}return C[3+h.length]=E,C.set(this.keys,E),E+=this.keys.length,C[3+h.length+1]=E,C.set(this.bboxes,E),E+=this.bboxes.length,C.buffer}static serialize(h,g){const x=h.toArrayBuffer();return g&&g.push(x),{buffer:x}}static deserialize(h){return new om(h.buffer)}}const wa={};function wi(m,h,g={}){if(wa[m])throw new Error(`${m} is already registered.`);Object.defineProperty(h,"_classRegistryKey",{value:m,writeable:!1}),wa[m]={klass:h,omit:g.omit||[],shallow:g.shallow||[]}}wi("Object",Object),wi("TransferableGridIndex",om),wi("Color",hn),wi("Error",Error),wi("AJAXError",Nt),wi("ResolvedImage",Ko),wi("StylePropertyFunction",Rv),wi("StyleExpression",xf,{omit:["_evaluator"]}),wi("ZoomDependentExpression",Gx),wi("ZoomConstantExpression",Vx),wi("CompoundExpression",Ja,{omit:["_evaluate"]});for(const m in gf)gf[m]._classRegistryKey||wi(`Expression_${m}`,gf[m]);function HS(m){return m&&typeof ArrayBuffer<"u"&&(m instanceof ArrayBuffer||m.constructor&&m.constructor.name==="ArrayBuffer")}function Tf(m){return m.$name||m.constructor._classRegistryKey}function $S(m){return!function(h){if(h===null||typeof h!="object")return!1;const g=Tf(h);return!(!g||g==="Object")}(m)&&(m==null||typeof m=="boolean"||typeof m=="number"||typeof m=="string"||m instanceof Boolean||m instanceof Number||m instanceof String||m instanceof Date||m instanceof RegExp||m instanceof Blob||m instanceof Error||HS(m)||gi(m)||ArrayBuffer.isView(m)||m instanceof ImageData)}function Yh(m,h){if($S(m))return(HS(m)||gi(m))&&h&&h.push(m),ArrayBuffer.isView(m)&&h&&h.push(m.buffer),m instanceof ImageData&&h&&h.push(m.data.buffer),m;if(Array.isArray(m)){const E=[];for(const A of m)E.push(Yh(A,h));return E}if(typeof m!="object")throw new Error("can't serialize object of type "+typeof m);const g=Tf(m);if(!g)throw new Error(`can't serialize object of unregistered class ${m.constructor.name}`);if(!wa[g])throw new Error(`${g} is not registered.`);const{klass:x}=wa[g],C=x.serialize?x.serialize(m,h):{};if(x.serialize){if(h&&C===h[h.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in m){if(!m.hasOwnProperty(E)||wa[g].omit.indexOf(E)>=0)continue;const A=m[E];C[E]=wa[g].shallow.indexOf(E)>=0?A:Yh(A,h)}m instanceof Error&&(C.message=m.message)}if(C.$name)throw new Error("$name property is reserved for worker serialization logic.");return g!=="Object"&&(C.$name=g),C}function Fu(m){if($S(m))return m;if(Array.isArray(m))return m.map(Fu);if(typeof m!="object")throw new Error("can't deserialize object of type "+typeof m);const h=Tf(m)||"Object";if(!wa[h])throw new Error(`can't deserialize unregistered class ${h}`);const{klass:g}=wa[h];if(!g)throw new Error(`can't deserialize unregistered class ${h}`);if(g.deserialize)return g.deserialize(m);const x=Object.create(g.prototype);for(const C of Object.keys(m)){if(C==="$name")continue;const E=m[C];x[C]=wa[h].shallow.indexOf(C)>=0?E:Fu(E)}return x}class Kx{constructor(){this.first=!0}update(h,g){const x=Math.floor(h);return this.first?(this.first=!1,this.lastIntegerZoom=x,this.lastIntegerZoomTime=0,this.lastZoom=h,this.lastFloorZoom=x,!0):(this.lastFloorZoom>x?(this.lastIntegerZoom=x+1,this.lastIntegerZoomTime=g):this.lastFloorZoom<x&&(this.lastIntegerZoom=x,this.lastIntegerZoomTime=g),h!==this.lastZoom&&(this.lastZoom=h,this.lastFloorZoom=x,!0))}}const An={"Latin-1 Supplement":m=>m>=128&&m<=255,"Hangul Jamo":m=>m>=4352&&m<=4607,Khmer:m=>m>=6016&&m<=6143,"General Punctuation":m=>m>=8192&&m<=8303,"Letterlike Symbols":m=>m>=8448&&m<=8527,"Number Forms":m=>m>=8528&&m<=8591,"Miscellaneous Technical":m=>m>=8960&&m<=9215,"Control Pictures":m=>m>=9216&&m<=9279,"Optical Character Recognition":m=>m>=9280&&m<=9311,"Enclosed Alphanumerics":m=>m>=9312&&m<=9471,"Geometric Shapes":m=>m>=9632&&m<=9727,"Miscellaneous Symbols":m=>m>=9728&&m<=9983,"Miscellaneous Symbols and Arrows":m=>m>=11008&&m<=11263,"Ideographic Description Characters":m=>m>=12272&&m<=12287,"CJK Symbols and Punctuation":m=>m>=12288&&m<=12351,Hiragana:m=>m>=12352&&m<=12447,Katakana:m=>m>=12448&&m<=12543,Kanbun:m=>m>=12688&&m<=12703,"CJK Strokes":m=>m>=12736&&m<=12783,"Enclosed CJK Letters and Months":m=>m>=12800&&m<=13055,"CJK Compatibility":m=>m>=13056&&m<=13311,"Yijing Hexagram Symbols":m=>m>=19904&&m<=19967,"CJK Unified Ideographs":m=>m>=19968&&m<=40959,"Hangul Syllables":m=>m>=44032&&m<=55215,"Private Use Area":m=>m>=57344&&m<=63743,"Vertical Forms":m=>m>=65040&&m<=65055,"CJK Compatibility Forms":m=>m>=65072&&m<=65103,"Small Form Variants":m=>m>=65104&&m<=65135,"Halfwidth and Fullwidth Forms":m=>m>=65280&&m<=65519};function Lv(m){for(const h of m)if(Jx(h.charCodeAt(0)))return!0;return!1}function WS(m){for(const h of m)if(!l2(h.charCodeAt(0)))return!1;return!0}function am(m){const h=m.map(g=>{try{return new RegExp(`\\p{sc=${g}}`,"u").source}catch{return null}}).filter(g=>g);return new RegExp(h.join("|"),"u")}const qS=am(["Arab","Dupl","Mong","Ougr","Syrc"]);function l2(m){return!qS.test(String.fromCodePoint(m))}const Yx=am(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Jx(m){return!(m!==746&&m!==747&&(m<4352||!(An["CJK Compatibility Forms"](m)&&!(m>=65097&&m<=65103)||An["CJK Compatibility"](m)||An["CJK Strokes"](m)||!(!An["CJK Symbols and Punctuation"](m)||m>=12296&&m<=12305||m>=12308&&m<=12319||m===12336)||An["Enclosed CJK Letters and Months"](m)||An["Ideographic Description Characters"](m)||An.Kanbun(m)||An.Katakana(m)&&m!==12540||!(!An["Halfwidth and Fullwidth Forms"](m)||m===65288||m===65289||m===65293||m>=65306&&m<=65310||m===65339||m===65341||m===65343||m>=65371&&m<=65503||m===65507||m>=65512&&m<=65519)||!(!An["Small Form Variants"](m)||m>=65112&&m<=65118||m>=65123&&m<=65126)||An["Vertical Forms"](m)||An["Yijing Hexagram Symbols"](m)||/\p{sc=Cans}/u.test(String.fromCodePoint(m))||/\p{sc=Hang}/u.test(String.fromCodePoint(m))||Yx.test(String.fromCodePoint(m)))))}function eb(m){return!(Jx(m)||function(h){return!!(An["Latin-1 Supplement"](h)&&(h===167||h===169||h===174||h===177||h===188||h===189||h===190||h===215||h===247)||An["General Punctuation"](h)&&(h===8214||h===8224||h===8225||h===8240||h===8241||h===8251||h===8252||h===8258||h===8263||h===8264||h===8265||h===8273)||An["Letterlike Symbols"](h)||An["Number Forms"](h)||An["Miscellaneous Technical"](h)&&(h>=8960&&h<=8967||h>=8972&&h<=8991||h>=8996&&h<=9e3||h===9003||h>=9085&&h<=9114||h>=9150&&h<=9165||h===9167||h>=9169&&h<=9179||h>=9186&&h<=9215)||An["Control Pictures"](h)&&h!==9251||An["Optical Character Recognition"](h)||An["Enclosed Alphanumerics"](h)||An["Geometric Shapes"](h)||An["Miscellaneous Symbols"](h)&&!(h>=9754&&h<=9759)||An["Miscellaneous Symbols and Arrows"](h)&&(h>=11026&&h<=11055||h>=11088&&h<=11097||h>=11192&&h<=11243)||An["CJK Symbols and Punctuation"](h)||An.Katakana(h)||An["Private Use Area"](h)||An["CJK Compatibility Forms"](h)||An["Small Form Variants"](h)||An["Halfwidth and Fullwidth Forms"](h)||h===8734||h===8756||h===8757||h>=9984&&h<=10087||h>=10102&&h<=10131||h===65532||h===65533)}(m))}const jS=am(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function tb(m){return jS.test(String.fromCodePoint(m))}function c2(m,h){return!(!h&&tb(m)||m>=2304&&m<=3583||m>=3840&&m<=4255||An.Khmer(m))}function u2(m){for(const h of m)if(tb(h.charCodeAt(0)))return!0;return!1}const iu=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(m){this.pluginStatus=m.pluginStatus,this.pluginURL=m.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(m){if(iu.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=m.applyArabicShaping,this.processBidirectionalText=m.processBidirectionalText,this.processStyledBidirectionalText=m.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(m,h){return a(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(m.pluginStatus!=="loading")return this.setState(m),m;const g=m.pluginURL,x=new Promise(E=>{this.loadScriptResolve=E});h(g);const C=new Promise(E=>setTimeout(()=>E(),this.TIMEOUT));if(yield Promise.race([x,C]),this.isParsed()){const E={pluginStatus:"loaded",pluginURL:g};return this.setState(E),E}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${g}`)})}};class Tr{constructor(h,g){this.zoom=h,g?(this.now=g.now,this.fadeDuration=g.fadeDuration,this.zoomHistory=g.zoomHistory,this.transition=g.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Kx,this.transition={})}isSupportedScript(h){return function(g,x){for(const C of g)if(!c2(C.charCodeAt(0),x))return!1;return!0}(h,iu.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const h=this.zoom,g=h-Math.floor(h),x=this.crossFadingFactor();return h>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:g+(1-g)*x}:{fromScale:.5,toScale:1,t:1-(1-x)*g}}}class lm{constructor(h,g){this.property=h,this.value=g,this.expression=function(x,C){if(Mv(x))return new Rv(x,C);if(im(x)){const E=kS(x,C);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));return E.value}{let E=x;return C.type==="color"&&typeof x=="string"?E=hn.parse(x):C.type!=="padding"||typeof x!="number"&&!Array.isArray(x)?C.type==="variableAnchorOffsetCollection"&&Array.isArray(x)?E=Fo.parse(x):C.type==="projectionDefinition"&&typeof x=="string"&&(E=Ds.parse(x)):E=io.parse(x),{kind:"constant",evaluate:()=>E}}}(g===void 0?h.specification.default:g,h.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(h,g,x){return this.property.possiblyEvaluate(this,h,g,x)}}class Fv{constructor(h){this.property=h,this.value=new lm(h,void 0)}transitioned(h,g){return new QS(this.property,this.value,g,Je({},h.transition,this.transition),h.now)}untransitioned(){return new QS(this.property,this.value,null,{},0)}}class cm{constructor(h){this._properties=h,this._values=Object.create(h.defaultTransitionablePropertyValues)}getValue(h){return Qt(this._values[h].value.value)}setValue(h,g){Object.prototype.hasOwnProperty.call(this._values,h)||(this._values[h]=new Fv(this._values[h].property)),this._values[h].value=new lm(this._values[h].property,g===null?void 0:Qt(g))}getTransition(h){return Qt(this._values[h].transition)}setTransition(h,g){Object.prototype.hasOwnProperty.call(this._values,h)||(this._values[h]=new Fv(this._values[h].property)),this._values[h].transition=Qt(g)||void 0}serialize(){const h={};for(const g of Object.keys(this._values)){const x=this.getValue(g);x!==void 0&&(h[g]=x);const C=this.getTransition(g);C!==void 0&&(h[`${g}-transition`]=C)}return h}transitioned(h,g){const x=new Nv(this._properties);for(const C of Object.keys(this._values))x._values[C]=this._values[C].transitioned(h,g._values[C]);return x}untransitioned(){const h=new Nv(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].untransitioned();return h}}class QS{constructor(h,g,x,C,E){this.property=h,this.value=g,this.begin=E+C.delay||0,this.end=this.begin+C.duration||0,h.specification.transition&&(C.delay||C.duration)&&(this.prior=x)}possiblyEvaluate(h,g,x){const C=h.now||0,E=this.value.possiblyEvaluate(h,g,x),A=this.prior;if(A){if(C>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(C<this.begin)return A.possiblyEvaluate(h,g,x);{const L=(C-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(h,g,x),E,He(L))}}return E}}class Nv{constructor(h){this._properties=h,this._values=Object.create(h.defaultTransitioningPropertyValues)}possiblyEvaluate(h,g,x){const C=new um(this._properties);for(const E of Object.keys(this._values))C._values[E]=this._values[E].possiblyEvaluate(h,g,x);return C}hasTransition(){for(const h of Object.keys(this._values))if(this._values[h].prior)return!0;return!1}}class h2{constructor(h){this._properties=h,this._values=Object.create(h.defaultPropertyValues)}hasValue(h){return this._values[h].value!==void 0}getValue(h){return Qt(this._values[h].value)}setValue(h,g){this._values[h]=new lm(this._values[h].property,g===null?void 0:Qt(g))}serialize(){const h={};for(const g of Object.keys(this._values)){const x=this.getValue(g);x!==void 0&&(h[g]=x)}return h}possiblyEvaluate(h,g,x){const C=new um(this._properties);for(const E of Object.keys(this._values))C._values[E]=this._values[E].possiblyEvaluate(h,g,x);return C}}class dc{constructor(h,g,x){this.property=h,this.value=g,this.parameters=x}isConstant(){return this.value.kind==="constant"}constantOr(h){return this.value.kind==="constant"?this.value.value:h}evaluate(h,g,x,C){return this.property.evaluate(this.value,this.parameters,h,g,x,C)}}class um{constructor(h){this._properties=h,this._values=Object.create(h.defaultPossiblyEvaluatedValues)}get(h){return this._values[h]}}class zi{constructor(h){this.specification=h}possiblyEvaluate(h,g){if(h.isDataDriven())throw new Error("Value should not be data driven");return h.expression.evaluate(g)}interpolate(h,g,x){const C=Rl[this.specification.type];return C?C(h,g,x):h}}class Ji{constructor(h,g){this.specification=h,this.overrides=g}possiblyEvaluate(h,g,x,C){return new dc(this,h.expression.kind==="constant"||h.expression.kind==="camera"?{kind:"constant",value:h.expression.evaluate(g,null,{},x,C)}:h.expression,g)}interpolate(h,g,x){if(h.value.kind!=="constant"||g.value.kind!=="constant")return h;if(h.value.value===void 0||g.value.value===void 0)return new dc(this,{kind:"constant",value:void 0},h.parameters);const C=Rl[this.specification.type];if(C){const E=C(h.value.value,g.value.value,x);return new dc(this,{kind:"constant",value:E},h.parameters)}return h}evaluate(h,g,x,C,E,A){return h.kind==="constant"?h.value:h.evaluate(g,x,C,E,A)}}class Bv extends Ji{possiblyEvaluate(h,g,x,C){if(h.value===void 0)return new dc(this,{kind:"constant",value:void 0},g);if(h.expression.kind==="constant"){const E=h.expression.evaluate(g,null,{},x,C),A=h.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,L=this._calculate(A,A,A,g);return new dc(this,{kind:"constant",value:L},g)}if(h.expression.kind==="camera"){const E=this._calculate(h.expression.evaluate({zoom:g.zoom-1}),h.expression.evaluate({zoom:g.zoom}),h.expression.evaluate({zoom:g.zoom+1}),g);return new dc(this,{kind:"constant",value:E},g)}return new dc(this,h.expression,g)}evaluate(h,g,x,C,E,A){if(h.kind==="source"){const L=h.evaluate(g,x,C,E,A);return this._calculate(L,L,L,g)}return h.kind==="composite"?this._calculate(h.evaluate({zoom:Math.floor(g.zoom)-1},x,C),h.evaluate({zoom:Math.floor(g.zoom)},x,C),h.evaluate({zoom:Math.floor(g.zoom)+1},x,C),g):h.value}_calculate(h,g,x,C){return C.zoom>C.zoomHistory.lastIntegerZoom?{from:h,to:g}:{from:x,to:g}}interpolate(h){return h}}class ib{constructor(h){this.specification=h}possiblyEvaluate(h,g,x,C){if(h.value!==void 0){if(h.expression.kind==="constant"){const E=h.expression.evaluate(g,null,{},x,C);return this._calculate(E,E,E,g)}return this._calculate(h.expression.evaluate(new Tr(Math.floor(g.zoom-1),g)),h.expression.evaluate(new Tr(Math.floor(g.zoom),g)),h.expression.evaluate(new Tr(Math.floor(g.zoom+1),g)),g)}}_calculate(h,g,x,C){return C.zoom>C.zoomHistory.lastIntegerZoom?{from:h,to:g}:{from:x,to:g}}interpolate(h){return h}}class nb{constructor(h){this.specification=h}possiblyEvaluate(h,g,x,C){return!!h.expression.evaluate(g,null,{},x,C)}interpolate(){return!1}}class ea{constructor(h){this.properties=h,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const g in h){const x=h[g];x.specification.overridable&&this.overridableProperties.push(g);const C=this.defaultPropertyValues[g]=new lm(x,void 0),E=this.defaultTransitionablePropertyValues[g]=new Fv(x);this.defaultTransitioningPropertyValues[g]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[g]=C.possiblyEvaluate({})}}}wi("DataDrivenProperty",Ji),wi("DataConstantProperty",zi),wi("CrossFadedDataDrivenProperty",Bv),wi("CrossFadedProperty",ib),wi("ColorRampProperty",nb);const ZS="-transition";class No extends re{constructor(h,g){if(super(),this.id=h.id,this.type=h.type,this._featureFilter={filter:()=>!0,needGeometry:!1},h.type!=="custom"&&(this.metadata=h.metadata,this.minzoom=h.minzoom,this.maxzoom=h.maxzoom,h.type!=="background"&&(this.source=h.source,this.sourceLayer=h["source-layer"],this.filter=h.filter),g.layout&&(this._unevaluatedLayout=new h2(g.layout)),g.paint)){this._transitionablePaint=new cm(g.paint);for(const x in h.paint)this.setPaintProperty(x,h.paint[x],{validate:!1});for(const x in h.layout)this.setLayoutProperty(x,h.layout[x],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new um(g.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(h){return h==="visibility"?this.visibility:this._unevaluatedLayout.getValue(h)}setLayoutProperty(h,g,x={}){g!=null&&this._validate(a2,`layers.${this.id}.layout.${h}`,h,g,x)||(h!=="visibility"?this._unevaluatedLayout.setValue(h,g):this.visibility=g)}getPaintProperty(h){return h.endsWith(ZS)?this._transitionablePaint.getTransition(h.slice(0,-11)):this._transitionablePaint.getValue(h)}setPaintProperty(h,g,x={}){if(g!=null&&this._validate(Xx,`layers.${this.id}.paint.${h}`,h,g,x))return!1;if(h.endsWith(ZS))return this._transitionablePaint.setTransition(h.slice(0,-11),g||void 0),!1;{const C=this._transitionablePaint._values[h],E=C.property.specification["property-type"]==="cross-faded-data-driven",A=C.value.isDataDriven(),L=C.value;this._transitionablePaint.setValue(h,g),this._handleSpecialPaintPropertyUpdate(h);const V=this._transitionablePaint._values[h].value;return V.isDataDriven()||A||E||this._handleOverridablePaintPropertyUpdate(h,L,V)}}_handleSpecialPaintPropertyUpdate(h){}_handleOverridablePaintPropertyUpdate(h,g,x){return!1}isHidden(h){return!!(this.minzoom&&h<this.minzoom)||!!(this.maxzoom&&h>=this.maxzoom)||this.visibility==="none"}updateTransitions(h){this._transitioningPaint=this._transitionablePaint.transitioned(h,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(h,g){h.getCrossfadeParameters&&(this._crossfadeParameters=h.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(h,void 0,g)),this.paint=this._transitioningPaint.possiblyEvaluate(h,void 0,g)}serialize(){const h={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(h.layout=h.layout||{},h.layout.visibility=this.visibility),Ot(h,(g,x)=>!(g===void 0||x==="layout"&&!Object.keys(g).length||x==="paint"&&!Object.keys(g).length))}_validate(h,g,x,C,E={}){return(!E||E.validate!==!1)&&Mf(this,h.call(Kh,{key:g,layerType:this.type,objectKey:x,value:C,styleSpec:ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const h in this.paint._values){const g=this.paint.get(h);if(g instanceof dc&&yf(g.property.specification)&&(g.value.kind==="source"||g.value.kind==="composite")&&g.value.isStateDependent)return!0}return!1}}const d2={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class hm{constructor(h,g){this._structArray=h,this._pos1=g*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Wr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(h,g){return h._trim(),g&&(h.isTransferred=!0,g.push(h.arrayBuffer)),{length:h.length,arrayBuffer:h.arrayBuffer}}static deserialize(h){const g=Object.create(this.prototype);return g.arrayBuffer=h.arrayBuffer,g.length=h.length,g.capacity=h.arrayBuffer.byteLength/g.bytesPerElement,g._refreshViews(),g}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(h){this.reserve(h),this.length=h}reserve(h){if(h>this.capacity){this.capacity=Math.max(h,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const g=this.uint8;this._refreshViews(),g&&this.uint8.set(g)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ss(m,h=1){let g=0,x=0;return{members:m.map(C=>{const E=d2[C.type].BYTES_PER_ELEMENT,A=g=XS(g,Math.max(h,E)),L=C.components||1;return x=Math.max(x,E),g+=E*L,{name:C.name,type:C.type,components:L,offset:A}}),size:XS(g,Math.max(x,h)),alignment:h}}function XS(m,h){return Math.ceil(m/h)*h}class dm extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g){const x=this.length;return this.resize(x+1),this.emplace(x,h,g)}emplace(h,g,x){const C=2*h;return this.int16[C+0]=g,this.int16[C+1]=x,h}}dm.prototype.bytesPerElement=4,wi("StructArrayLayout2i4",dm);class fc extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x){const C=this.length;return this.resize(C+1),this.emplace(C,h,g,x)}emplace(h,g,x,C){const E=3*h;return this.int16[E+0]=g,this.int16[E+1]=x,this.int16[E+2]=C,h}}fc.prototype.bytesPerElement=6,wi("StructArrayLayout3i6",fc);class zv extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x,C){const E=this.length;return this.resize(E+1),this.emplace(E,h,g,x,C)}emplace(h,g,x,C,E){const A=4*h;return this.int16[A+0]=g,this.int16[A+1]=x,this.int16[A+2]=C,this.int16[A+3]=E,h}}zv.prototype.bytesPerElement=8,wi("StructArrayLayout4i8",zv);class fm extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x,C,E,A){const L=this.length;return this.resize(L+1),this.emplace(L,h,g,x,C,E,A)}emplace(h,g,x,C,E,A,L){const V=6*h;return this.int16[V+0]=g,this.int16[V+1]=x,this.int16[V+2]=C,this.int16[V+3]=E,this.int16[V+4]=A,this.int16[V+5]=L,h}}fm.prototype.bytesPerElement=12,wi("StructArrayLayout2i4i12",fm);class Vv extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x,C,E,A){const L=this.length;return this.resize(L+1),this.emplace(L,h,g,x,C,E,A)}emplace(h,g,x,C,E,A,L){const V=4*h,H=8*h;return this.int16[V+0]=g,this.int16[V+1]=x,this.uint8[H+4]=C,this.uint8[H+5]=E,this.uint8[H+6]=A,this.uint8[H+7]=L,h}}Vv.prototype.bytesPerElement=8,wi("StructArrayLayout2i4ub8",Vv);class Jh extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h,g){const x=this.length;return this.resize(x+1),this.emplace(x,h,g)}emplace(h,g,x){const C=2*h;return this.float32[C+0]=g,this.float32[C+1]=x,h}}Jh.prototype.bytesPerElement=8,wi("StructArrayLayout2f8",Jh);class rb extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h,g,x,C,E,A,L,V,H,X){const K=this.length;return this.resize(K+1),this.emplace(K,h,g,x,C,E,A,L,V,H,X)}emplace(h,g,x,C,E,A,L,V,H,X,K){const ae=10*h;return this.uint16[ae+0]=g,this.uint16[ae+1]=x,this.uint16[ae+2]=C,this.uint16[ae+3]=E,this.uint16[ae+4]=A,this.uint16[ae+5]=L,this.uint16[ae+6]=V,this.uint16[ae+7]=H,this.uint16[ae+8]=X,this.uint16[ae+9]=K,h}}rb.prototype.bytesPerElement=20,wi("StructArrayLayout10ui20",rb);class Rf extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h,g,x,C,E,A,L,V,H,X,K,ae){const ue=this.length;return this.resize(ue+1),this.emplace(ue,h,g,x,C,E,A,L,V,H,X,K,ae)}emplace(h,g,x,C,E,A,L,V,H,X,K,ae,ue){const de=12*h;return this.int16[de+0]=g,this.int16[de+1]=x,this.int16[de+2]=C,this.int16[de+3]=E,this.uint16[de+4]=A,this.uint16[de+5]=L,this.uint16[de+6]=V,this.uint16[de+7]=H,this.int16[de+8]=X,this.int16[de+9]=K,this.int16[de+10]=ae,this.int16[de+11]=ue,h}}Rf.prototype.bytesPerElement=24,wi("StructArrayLayout4i4ui4i24",Rf);class ed extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h,g,x){const C=this.length;return this.resize(C+1),this.emplace(C,h,g,x)}emplace(h,g,x,C){const E=3*h;return this.float32[E+0]=g,this.float32[E+1]=x,this.float32[E+2]=C,h}}ed.prototype.bytesPerElement=12,wi("StructArrayLayout3f12",ed);class sb extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(h){const g=this.length;return this.resize(g+1),this.emplace(g,h)}emplace(h,g){return this.uint32[1*h+0]=g,h}}sb.prototype.bytesPerElement=4,wi("StructArrayLayout1ul4",sb);class Gv extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h,g,x,C,E,A,L,V,H){const X=this.length;return this.resize(X+1),this.emplace(X,h,g,x,C,E,A,L,V,H)}emplace(h,g,x,C,E,A,L,V,H,X){const K=10*h,ae=5*h;return this.int16[K+0]=g,this.int16[K+1]=x,this.int16[K+2]=C,this.int16[K+3]=E,this.int16[K+4]=A,this.int16[K+5]=L,this.uint32[ae+3]=V,this.uint16[K+8]=H,this.uint16[K+9]=X,h}}Gv.prototype.bytesPerElement=20,wi("StructArrayLayout6i1ul2ui20",Gv);class td extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x,C,E,A){const L=this.length;return this.resize(L+1),this.emplace(L,h,g,x,C,E,A)}emplace(h,g,x,C,E,A,L){const V=6*h;return this.int16[V+0]=g,this.int16[V+1]=x,this.int16[V+2]=C,this.int16[V+3]=E,this.int16[V+4]=A,this.int16[V+5]=L,h}}td.prototype.bytesPerElement=12,wi("StructArrayLayout2i2i2i12",td);class ob extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x,C,E){const A=this.length;return this.resize(A+1),this.emplace(A,h,g,x,C,E)}emplace(h,g,x,C,E,A){const L=4*h,V=8*h;return this.float32[L+0]=g,this.float32[L+1]=x,this.float32[L+2]=C,this.int16[V+6]=E,this.int16[V+7]=A,h}}ob.prototype.bytesPerElement=16,wi("StructArrayLayout2f1f2i16",ob);class ab extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x,C,E,A){const L=this.length;return this.resize(L+1),this.emplace(L,h,g,x,C,E,A)}emplace(h,g,x,C,E,A,L){const V=16*h,H=4*h,X=8*h;return this.uint8[V+0]=g,this.uint8[V+1]=x,this.float32[H+1]=C,this.float32[H+2]=E,this.int16[X+6]=A,this.int16[X+7]=L,h}}ab.prototype.bytesPerElement=16,wi("StructArrayLayout2ub2f2i16",ab);class pm extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h,g,x){const C=this.length;return this.resize(C+1),this.emplace(C,h,g,x)}emplace(h,g,x,C){const E=3*h;return this.uint16[E+0]=g,this.uint16[E+1]=x,this.uint16[E+2]=C,h}}pm.prototype.bytesPerElement=6,wi("StructArrayLayout3ui6",pm);class lb extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h,g,x,C,E,A,L,V,H,X,K,ae,ue,de,ge,Te,Ne){const tt=this.length;return this.resize(tt+1),this.emplace(tt,h,g,x,C,E,A,L,V,H,X,K,ae,ue,de,ge,Te,Ne)}emplace(h,g,x,C,E,A,L,V,H,X,K,ae,ue,de,ge,Te,Ne,tt){const Ve=24*h,ce=12*h,Me=48*h;return this.int16[Ve+0]=g,this.int16[Ve+1]=x,this.uint16[Ve+2]=C,this.uint16[Ve+3]=E,this.uint32[ce+2]=A,this.uint32[ce+3]=L,this.uint32[ce+4]=V,this.uint16[Ve+10]=H,this.uint16[Ve+11]=X,this.uint16[Ve+12]=K,this.float32[ce+7]=ae,this.float32[ce+8]=ue,this.uint8[Me+36]=de,this.uint8[Me+37]=ge,this.uint8[Me+38]=Te,this.uint32[ce+10]=Ne,this.int16[Ve+22]=tt,h}}lb.prototype.bytesPerElement=48,wi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",lb);class S extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h,g,x,C,E,A,L,V,H,X,K,ae,ue,de,ge,Te,Ne,tt,Ve,ce,Me,Ue,yt,jt,_t,Et,ri,Zt){const si=this.length;return this.resize(si+1),this.emplace(si,h,g,x,C,E,A,L,V,H,X,K,ae,ue,de,ge,Te,Ne,tt,Ve,ce,Me,Ue,yt,jt,_t,Et,ri,Zt)}emplace(h,g,x,C,E,A,L,V,H,X,K,ae,ue,de,ge,Te,Ne,tt,Ve,ce,Me,Ue,yt,jt,_t,Et,ri,Zt,si){const Ft=32*h,Ti=16*h;return this.int16[Ft+0]=g,this.int16[Ft+1]=x,this.int16[Ft+2]=C,this.int16[Ft+3]=E,this.int16[Ft+4]=A,this.int16[Ft+5]=L,this.int16[Ft+6]=V,this.int16[Ft+7]=H,this.uint16[Ft+8]=X,this.uint16[Ft+9]=K,this.uint16[Ft+10]=ae,this.uint16[Ft+11]=ue,this.uint16[Ft+12]=de,this.uint16[Ft+13]=ge,this.uint16[Ft+14]=Te,this.uint16[Ft+15]=Ne,this.uint16[Ft+16]=tt,this.uint16[Ft+17]=Ve,this.uint16[Ft+18]=ce,this.uint16[Ft+19]=Me,this.uint16[Ft+20]=Ue,this.uint16[Ft+21]=yt,this.uint16[Ft+22]=jt,this.uint32[Ti+12]=_t,this.float32[Ti+13]=Et,this.float32[Ti+14]=ri,this.uint16[Ft+30]=Zt,this.uint16[Ft+31]=si,h}}S.prototype.bytesPerElement=64,wi("StructArrayLayout8i15ui1ul2f2ui64",S);class c extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h){const g=this.length;return this.resize(g+1),this.emplace(g,h)}emplace(h,g){return this.float32[1*h+0]=g,h}}c.prototype.bytesPerElement=4,wi("StructArrayLayout1f4",c);class f extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h,g,x){const C=this.length;return this.resize(C+1),this.emplace(C,h,g,x)}emplace(h,g,x,C){const E=3*h;return this.uint16[6*h+0]=g,this.float32[E+1]=x,this.float32[E+2]=C,h}}f.prototype.bytesPerElement=12,wi("StructArrayLayout1ui2f12",f);class b extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h,g,x){const C=this.length;return this.resize(C+1),this.emplace(C,h,g,x)}emplace(h,g,x,C){const E=4*h;return this.uint32[2*h+0]=g,this.uint16[E+2]=x,this.uint16[E+3]=C,h}}b.prototype.bytesPerElement=8,wi("StructArrayLayout1ul2ui8",b);class _ extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h,g){const x=this.length;return this.resize(x+1),this.emplace(x,h,g)}emplace(h,g,x){const C=2*h;return this.uint16[C+0]=g,this.uint16[C+1]=x,h}}_.prototype.bytesPerElement=4,wi("StructArrayLayout2ui4",_);class T extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h){const g=this.length;return this.resize(g+1),this.emplace(g,h)}emplace(h,g){return this.uint16[1*h+0]=g,h}}T.prototype.bytesPerElement=2,wi("StructArrayLayout1ui2",T);class I extends Wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h,g,x,C){const E=this.length;return this.resize(E+1),this.emplace(E,h,g,x,C)}emplace(h,g,x,C,E){const A=4*h;return this.float32[A+0]=g,this.float32[A+1]=x,this.float32[A+2]=C,this.float32[A+3]=E,h}}I.prototype.bytesPerElement=16,wi("StructArrayLayout4f16",I);class z extends hm{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new w(this.anchorPointX,this.anchorPointY)}}z.prototype.size=20;class U extends Gv{get(h){return new z(this,h)}}wi("CollisionBoxArray",U);class q extends hm{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(h){this._structArray.uint8[this._pos1+37]=h}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(h){this._structArray.uint8[this._pos1+38]=h}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(h){this._structArray.uint32[this._pos4+10]=h}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}q.prototype.size=48;class J extends lb{get(h){return new q(this,h)}}wi("PlacedSymbolArray",J);class se extends hm{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(h){this._structArray.uint32[this._pos4+12]=h}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}se.prototype.size=64;class ne extends S{get(h){return new se(this,h)}}wi("SymbolInstanceArray",ne);class pe extends c{getoffsetX(h){return this.float32[1*h+0]}}wi("GlyphOffsetArray",pe);class ye extends fc{getx(h){return this.int16[3*h+0]}gety(h){return this.int16[3*h+1]}gettileUnitDistanceFromAnchor(h){return this.int16[3*h+2]}}wi("SymbolLineVertexArray",ye);class De extends hm{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}De.prototype.size=12;class Ee extends f{get(h){return new De(this,h)}}wi("TextAnchorOffsetArray",Ee);class Le extends hm{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Le.prototype.size=8;class ze extends b{get(h){return new Le(this,h)}}wi("FeatureIndexArray",ze);class We extends dm{}class Qe extends dm{}class Ke extends dm{}class at extends fm{}class et extends Vv{}class vt extends Jh{}class gt extends rb{}class Dt extends Rf{}class Bt extends ed{}class It extends sb{}class di extends td{}class ui extends ab{}class Ht extends pm{}class Ri extends _{}const vn=ss([{name:"a_pos",components:2,type:"Int16"}],4),{members:rr}=vn;class bn{constructor(h=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=h}prepareSegment(h,g,x,C){const E=this.segments[this.segments.length-1];return h>bn.MAX_VERTEX_ARRAY_LENGTH&&Jt(`Max vertices per segment is ${bn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${h}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${bn.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!E||E.vertexLength+h>bn.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==C?this.createNewSegment(g,x,C):E}createNewSegment(h,g,x){const C={vertexOffset:h.length,primitiveOffset:g.length,vertexLength:0,primitiveLength:0,vaos:{}};return x!==void 0&&(C.sortKey=x),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(C),C}getOrCreateLatestSegment(h,g,x){return this.prepareSegment(0,h,g,x)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const h of this.segments)for(const g in h.vaos)h.vaos[g].destroy()}static simpleSegment(h,g,x,C){return new bn([{vertexOffset:h,primitiveOffset:g,vertexLength:x,primitiveLength:C,vaos:{},sortKey:0}])}}function pr(m,h){return 256*(m=ct(Math.floor(m),0,255))+ct(Math.floor(h),0,255)}bn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wi("SegmentVector",bn);const Cr=ss([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Rr,hr,mr,ms={exports:{}},Ls={exports:{}},Ws={exports:{}},ta=function(){if(mr)return ms.exports;mr=1;var m=(Rr||(Rr=1,Ls.exports=function(g,x){var C,E,A,L,V,H,X,K;for(E=g.length-(C=3&g.length),A=x,V=3432918353,H=461845907,K=0;K<E;)X=255&g.charCodeAt(K)|(255&g.charCodeAt(++K))<<8|(255&g.charCodeAt(++K))<<16|(255&g.charCodeAt(++K))<<24,++K,A=27492+(65535&(L=5*(65535&(A=(A^=X=(65535&(X=(X=(65535&X)*V+(((X>>>16)*V&65535)<<16)&4294967295)<<15|X>>>17))*H+(((X>>>16)*H&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(L>>>16)&65535)<<16);switch(X=0,C){case 3:X^=(255&g.charCodeAt(K+2))<<16;case 2:X^=(255&g.charCodeAt(K+1))<<8;case 1:A^=X=(65535&(X=(X=(65535&(X^=255&g.charCodeAt(K)))*V+(((X>>>16)*V&65535)<<16)&4294967295)<<15|X>>>17))*H+(((X>>>16)*H&65535)<<16)&4294967295}return A^=g.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0}),Ls.exports),h=(hr||(hr=1,Ws.exports=function(g,x){for(var C,E=g.length,A=x^E,L=0;E>=4;)C=1540483477*(65535&(C=255&g.charCodeAt(L)|(255&g.charCodeAt(++L))<<8|(255&g.charCodeAt(++L))<<16|(255&g.charCodeAt(++L))<<24))+((1540483477*(C>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(C=1540483477*(65535&(C^=C>>>24))+((1540483477*(C>>>16)&65535)<<16)),E-=4,++L;switch(E){case 3:A^=(255&g.charCodeAt(L+2))<<16;case 2:A^=(255&g.charCodeAt(L+1))<<8;case 1:A=1540483477*(65535&(A^=255&g.charCodeAt(L)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0}),Ws.exports);return ms.exports=m,ms.exports.murmur3=m,ms.exports.murmur2=h,ms.exports}(),nu=l(ta);class pc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(h,g,x,C){this.ids.push(Nu(h)),this.positions.push(g,x,C)}getPositions(h){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const g=Nu(h);let x=0,C=this.ids.length-1;for(;x<C;){const A=x+C>>1;this.ids[A]>=g?C=A:x=A+1}const E=[];for(;this.ids[x]===g;)E.push({index:this.positions[3*x],start:this.positions[3*x+1],end:this.positions[3*x+2]}),x++;return E}static serialize(h,g){const x=new Float64Array(h.ids),C=new Uint32Array(h.positions);return Bu(x,C,0,x.length-1),g&&g.push(x.buffer,C.buffer),{ids:x,positions:C}}static deserialize(h){const g=new pc;return g.ids=h.ids,g.positions=h.positions,g.indexed=!0,g}}function Nu(m){const h=+m;return!isNaN(h)&&h<=Number.MAX_SAFE_INTEGER?h:nu(String(m))}function Bu(m,h,g,x){for(;g<x;){const C=m[g+x>>1];let E=g-1,A=x+1;for(;;){do E++;while(m[E]<C);do A--;while(m[A]>C);if(E>=A)break;id(m,E,A),id(h,3*E,3*A),id(h,3*E+1,3*A+1),id(h,3*E+2,3*A+2)}A-g<x-A?(Bu(m,h,g,A),g=A+1):(Bu(m,h,A+1,x),x=A)}}function id(m,h,g){const x=m[h];m[h]=m[g],m[g]=x}wi("FeaturePositionMap",pc);class mc{constructor(h,g){this.gl=h.gl,this.location=g}}class ru extends mc{constructor(h,g){super(h,g),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class _a extends mc{constructor(h,g){super(h,g),this.current=[0,0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3]))}}class su extends mc{constructor(h,g){super(h,g),this.current=hn.transparent}set(h){h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a))}}const nd=new Float32Array(16);function rd(m){return[pr(255*m.r,255*m.g),pr(255*m.b,255*m.a)]}class qr{constructor(h,g,x){this.value=h,this.uniformNames=g.map(C=>`u_${C}`),this.type=x}setUniform(h,g,x){h.set(x.constantOr(this.value))}getBinding(h,g,x){return this.type==="color"?new su(h,g):new ru(h,g)}}class jr{constructor(h,g){this.uniformNames=g.map(x=>`u_${x}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(h,g){this.pixelRatioFrom=g.pixelRatio,this.pixelRatioTo=h.pixelRatio,this.patternFrom=g.tlbr,this.patternTo=h.tlbr}setUniform(h,g,x,C){const E=C==="u_pattern_to"?this.patternTo:C==="u_pattern_from"?this.patternFrom:C==="u_pixel_ratio_to"?this.pixelRatioTo:C==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&h.set(E)}getBinding(h,g,x){return x.substr(0,9)==="u_pattern"?new _a(h,g):new ru(h,g)}}class Cs{constructor(h,g,x,C){this.expression=h,this.type=x,this.maxValue=0,this.paintVertexAttributes=g.map(E=>({name:`a_${E}`,type:"Float32",components:x==="color"?2:1,offset:0})),this.paintVertexArray=new C}populatePaintArray(h,g,x,C,E){const A=this.paintVertexArray.length,L=this.expression.evaluate(new Tr(0),g,{},C,[],E);this.paintVertexArray.resize(h),this._setPaintValue(A,h,L)}updatePaintArray(h,g,x,C){const E=this.expression.evaluate({zoom:0},x,C);this._setPaintValue(h,g,E)}_setPaintValue(h,g,x){if(this.type==="color"){const C=rd(x);for(let E=h;E<g;E++)this.paintVertexArray.emplace(E,C[0],C[1])}else{for(let C=h;C<g;C++)this.paintVertexArray.emplace(C,x);this.maxValue=Math.max(this.maxValue,Math.abs(x))}}upload(h){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=h.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _r{constructor(h,g,x,C,E,A){this.expression=h,this.uniformNames=g.map(L=>`u_${L}_t`),this.type=x,this.useIntegerZoom=C,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=g.map(L=>({name:`a_${L}`,type:"Float32",components:x==="color"?4:2,offset:0})),this.paintVertexArray=new A}populatePaintArray(h,g,x,C,E){const A=this.expression.evaluate(new Tr(this.zoom),g,{},C,[],E),L=this.expression.evaluate(new Tr(this.zoom+1),g,{},C,[],E),V=this.paintVertexArray.length;this.paintVertexArray.resize(h),this._setPaintValue(V,h,A,L)}updatePaintArray(h,g,x,C){const E=this.expression.evaluate({zoom:this.zoom},x,C),A=this.expression.evaluate({zoom:this.zoom+1},x,C);this._setPaintValue(h,g,E,A)}_setPaintValue(h,g,x,C){if(this.type==="color"){const E=rd(x),A=rd(C);for(let L=h;L<g;L++)this.paintVertexArray.emplace(L,E[0],E[1],A[0],A[1])}else{for(let E=h;E<g;E++)this.paintVertexArray.emplace(E,x,C);this.maxValue=Math.max(this.maxValue,Math.abs(x),Math.abs(C))}}upload(h){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=h.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(h,g){const x=this.useIntegerZoom?Math.floor(g.zoom):g.zoom,C=ct(this.expression.interpolationFactor(x,this.zoom,this.zoom+1),0,1);h.set(C)}getBinding(h,g,x){return new ru(h,g)}}class zu{constructor(h,g,x,C,E,A){this.expression=h,this.type=g,this.useIntegerZoom=x,this.zoom=C,this.layerId=A,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(h,g,x){const C=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(h),this.zoomOutPaintVertexArray.resize(h),this._setPaintValues(C,h,g.patterns&&g.patterns[this.layerId],x)}updatePaintArray(h,g,x,C,E){this._setPaintValues(h,g,x.patterns&&x.patterns[this.layerId],E)}_setPaintValues(h,g,x,C){if(!C||!x)return;const{min:E,mid:A,max:L}=x,V=C[E],H=C[A],X=C[L];if(V&&H&&X)for(let K=h;K<g;K++)this.zoomInPaintVertexArray.emplace(K,H.tl[0],H.tl[1],H.br[0],H.br[1],V.tl[0],V.tl[1],V.br[0],V.br[1],H.pixelRatio,V.pixelRatio),this.zoomOutPaintVertexArray.emplace(K,H.tl[0],H.tl[1],H.br[0],H.br[1],X.tl[0],X.tl[1],X.br[0],X.br[1],H.pixelRatio,X.pixelRatio)}upload(h){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=h.createVertexBuffer(this.zoomInPaintVertexArray,Cr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=h.createVertexBuffer(this.zoomOutPaintVertexArray,Cr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class KS{constructor(h,g,x){this.binders={},this._buffers=[];const C=[];for(const E in h.paint._values){if(!x(E))continue;const A=h.paint.get(E);if(!(A instanceof dc&&yf(A.property.specification)))continue;const L=f2(E,h.type),V=A.value,H=A.property.specification.type,X=A.property.useIntegerZoom,K=A.property.specification["property-type"],ae=K==="cross-faded"||K==="cross-faded-data-driven";if(V.kind==="constant")this.binders[E]=ae?new jr(V.value,L):new qr(V.value,L,H),C.push(`/u_${E}`);else if(V.kind==="source"||ae){const ue=YS(E,H,"source");this.binders[E]=ae?new zu(V,H,X,g,ue,h.id):new Cs(V,L,H,ue),C.push(`/a_${E}`)}else{const ue=YS(E,H,"composite");this.binders[E]=new _r(V,L,H,X,g,ue),C.push(`/z_${E}`)}}this.cacheKey=C.sort().join("")}getMaxValue(h){const g=this.binders[h];return g instanceof Cs||g instanceof _r?g.maxValue:0}populatePaintArrays(h,g,x,C,E){for(const A in this.binders){const L=this.binders[A];(L instanceof Cs||L instanceof _r||L instanceof zu)&&L.populatePaintArray(h,g,x,C,E)}}setConstantPatternPositions(h,g){for(const x in this.binders){const C=this.binders[x];C instanceof jr&&C.setConstantPatternPositions(h,g)}}updatePaintArrays(h,g,x,C,E){let A=!1;for(const L in h){const V=g.getPositions(L);for(const H of V){const X=x.feature(H.index);for(const K in this.binders){const ae=this.binders[K];if((ae instanceof Cs||ae instanceof _r||ae instanceof zu)&&ae.expression.isStateDependent===!0){const ue=C.paint.get(K);ae.expression=ue.value,ae.updatePaintArray(H.start,H.end,X,h[L],E),A=!0}}}}return A}defines(){const h=[];for(const g in this.binders){const x=this.binders[g];(x instanceof qr||x instanceof jr)&&h.push(...x.uniformNames.map(C=>`#define HAS_UNIFORM_${C}`))}return h}getBinderAttributes(){const h=[];for(const g in this.binders){const x=this.binders[g];if(x instanceof Cs||x instanceof _r)for(let C=0;C<x.paintVertexAttributes.length;C++)h.push(x.paintVertexAttributes[C].name);else if(x instanceof zu)for(let C=0;C<Cr.members.length;C++)h.push(Cr.members[C].name)}return h}getBinderUniforms(){const h=[];for(const g in this.binders){const x=this.binders[g];if(x instanceof qr||x instanceof jr||x instanceof _r)for(const C of x.uniformNames)h.push(C)}return h}getPaintVertexBuffers(){return this._buffers}getUniforms(h,g){const x=[];for(const C in this.binders){const E=this.binders[C];if(E instanceof qr||E instanceof jr||E instanceof _r){for(const A of E.uniformNames)if(g[A]){const L=E.getBinding(h,g[A],A);x.push({name:A,property:C,binding:L})}}}return x}setUniforms(h,g,x,C){for(const{name:E,property:A,binding:L}of g)this.binders[A].setUniform(L,C,x.get(A),E)}updatePaintBuffers(h){this._buffers=[];for(const g in this.binders){const x=this.binders[g];if(h&&x instanceof zu){const C=h.fromScale===2?x.zoomInPaintVertexBuffer:x.zoomOutPaintVertexBuffer;C&&this._buffers.push(C)}else(x instanceof Cs||x instanceof _r)&&x.paintVertexBuffer&&this._buffers.push(x.paintVertexBuffer)}}upload(h){for(const g in this.binders){const x=this.binders[g];(x instanceof Cs||x instanceof _r||x instanceof zu)&&x.upload(h)}this.updatePaintBuffers()}destroy(){for(const h in this.binders){const g=this.binders[h];(g instanceof Cs||g instanceof _r||g instanceof zu)&&g.destroy()}}}class sd{constructor(h,g,x=()=>!0){this.programConfigurations={};for(const C of h)this.programConfigurations[C.id]=new KS(C,g,x);this.needsUpload=!1,this._featureMap=new pc,this._bufferOffset=0}populatePaintArrays(h,g,x,C,E,A){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(h,g,C,E,A);g.id!==void 0&&this._featureMap.add(g.id,x,this._bufferOffset,h),this._bufferOffset=h,this.needsUpload=!0}updatePaintArrays(h,g,x,C){for(const E of x)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(h,this._featureMap,g,E,C)||this.needsUpload}get(h){return this.programConfigurations[h]}upload(h){if(this.needsUpload){for(const g in this.programConfigurations)this.programConfigurations[g].upload(h);this.needsUpload=!1}}destroy(){for(const h in this.programConfigurations)this.programConfigurations[h].destroy()}}function f2(m,h){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[m]||[m.replace(`${h}-`,"").replace(/-/g,"_")]}function YS(m,h,g){const x={color:{source:Jh,composite:I},number:{source:c,composite:Jh}},C=function(E){return{"line-pattern":{source:gt,composite:gt},"fill-pattern":{source:gt,composite:gt},"fill-extrusion-pattern":{source:gt,composite:gt}}[E]}(m);return C&&C[g]||x[h][g]}wi("ConstantBinder",qr),wi("CrossFadedConstantBinder",jr),wi("SourceExpressionBinder",Cs),wi("CrossFadedCompositeBinder",zu),wi("CompositeExpressionBinder",_r),wi("ProgramConfiguration",KS,{omit:["_buffers"]}),wi("ProgramConfigurationSet",sd);const cb=Math.pow(2,14)-1,Vu=-cb-1;function Gu(m){const h=me/m.extent,g=m.loadGeometry();for(let x=0;x<g.length;x++){const C=g[x];for(let E=0;E<C.length;E++){const A=C[E],L=Math.round(A.x*h),V=Math.round(A.y*h);A.x=ct(L,Vu,cb),A.y=ct(V,Vu,cb),(L<A.x||L>A.x+1||V<A.y||V>A.y+1)&&Jt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return g}function Uu(m,h){return{type:m.type,id:m.id,properties:m.properties,geometry:h?Gu(m):[]}}const ub=-32768;function hb(m,h,g,x,C){m.emplaceBack(ub+8*h+x,ub+8*g+C)}class Uv{constructor(h){this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map(g=>g.id),this.index=h.index,this.hasPattern=!1,this.layoutVertexArray=new Qe,this.indexArray=new Ht,this.segments=new bn,this.programConfigurations=new sd(h.layers,h.zoom),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id)}populate(h,g,x){const C=this.layers[0],E=[];let A=null,L=!1,V=C.type==="heatmap";if(C.type==="circle"){const X=C;A=X.layout.get("circle-sort-key"),L=!A.isConstant(),V=V||X.paint.get("circle-pitch-alignment")==="map"}const H=V?g.subdivisionGranularity.circle:1;for(const{feature:X,id:K,index:ae,sourceLayerIndex:ue}of h){const de=this.layers[0]._featureFilter.needGeometry,ge=Uu(X,de);if(!this.layers[0]._featureFilter.filter(new Tr(this.zoom),ge,x))continue;const Te=L?A.evaluate(ge,{},x):void 0,Ne={id:K,properties:X.properties,type:X.type,sourceLayerIndex:ue,index:ae,geometry:de?ge.geometry:Gu(X),patterns:{},sortKey:Te};E.push(Ne)}L&&E.sort((X,K)=>X.sortKey-K.sortKey);for(const X of E){const{geometry:K,index:ae,sourceLayerIndex:ue}=X,de=h[ae].feature;this.addFeature(X,K,ae,x,H),g.featureIndex.insert(de,K,ae,ue,this.index)}}update(h,g,x){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(h,g,this.stateDependentLayers,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(h){this.uploaded||(this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,rr),this.indexBuffer=h.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(h),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(h,g,x,C,E=1){let A;switch(E){case 1:A=[0,7];break;case 3:A=[0,2,5,7];break;case 5:A=[0,1,3,4,6,7];break;case 7:A=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${E}; valid values are 1, 3, 5, 7.`)}const L=A.length;for(const V of g)for(const H of V){const X=H.x,K=H.y;if(X<0||X>=me||K<0||K>=me)continue;const ae=this.segments.prepareSegment(L*L,this.layoutVertexArray,this.indexArray,h.sortKey),ue=ae.vertexLength;for(let de=0;de<L;de++)for(let ge=0;ge<L;ge++)hb(this.layoutVertexArray,X,K,A[ge],A[de]);for(let de=0;de<L-1;de++)for(let ge=0;ge<L-1;ge++){const Te=ue+de*L+ge,Ne=ue+(de+1)*L+ge;this.indexArray.emplaceBack(Te,Ne+1,Te+1),this.indexArray.emplaceBack(Te,Ne,Ne+1)}ae.vertexLength+=L*L,ae.primitiveLength+=(L-1)*(L-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,x,{},C)}}function Hv(m,h){for(let g=0;g<m.length;g++)if(mm(h,m[g]))return!0;for(let g=0;g<h.length;g++)if(mm(m,h[g]))return!0;return!!p2(m,h)}function Zse(m,h,g){return!!mm(m,h)||!!m2(h,m,g)}function F5(m,h){if(m.length===1)return B5(h,m[0]);for(let g=0;g<h.length;g++){const x=h[g];for(let C=0;C<x.length;C++)if(mm(m,x[C]))return!0}for(let g=0;g<m.length;g++)if(B5(h,m[g]))return!0;for(let g=0;g<h.length;g++)if(p2(m,h[g]))return!0;return!1}function Xse(m,h,g){if(m.length>1){if(p2(m,h))return!0;for(let x=0;x<h.length;x++)if(m2(h[x],m,g))return!0}for(let x=0;x<m.length;x++)if(m2(m[x],h,g))return!0;return!1}function p2(m,h){if(m.length===0||h.length===0)return!1;for(let g=0;g<m.length-1;g++){const x=m[g],C=m[g+1];for(let E=0;E<h.length-1;E++)if(Kse(x,C,h[E],h[E+1]))return!0}return!1}function Kse(m,h,g,x){return Yt(m,g,x)!==Yt(h,g,x)&&Yt(m,h,g)!==Yt(m,h,x)}function m2(m,h,g){const x=g*g;if(h.length===1)return m.distSqr(h[0])<x;for(let C=1;C<h.length;C++)if(N5(m,h[C-1],h[C])<x)return!0;return!1}function N5(m,h,g){const x=h.distSqr(g);if(x===0)return m.distSqr(h);const C=((m.x-h.x)*(g.x-h.x)+(m.y-h.y)*(g.y-h.y))/x;return m.distSqr(C<0?h:C>1?g:g.sub(h)._mult(C)._add(h))}function B5(m,h){for(let g=0;g<m.length;g++)if(mm(m[g],h))return!0;return!1}function mm(m,h){let g=!1;for(let x=0,C=m.length-1;x<m.length;C=x++){const E=m[x],A=m[C];E.y>h.y!=A.y>h.y&&h.x<(A.x-E.x)*(h.y-E.y)/(A.y-E.y)+E.x&&(g=!g)}return g}function Yse(m,h,g){const x=g[0],C=g[2];if(m.x<x.x&&h.x<x.x||m.x>C.x&&h.x>C.x||m.y<x.y&&h.y<x.y||m.y>C.y&&h.y>C.y)return!1;const E=Yt(m,h,g[0]);return E!==Yt(m,h,g[1])||E!==Yt(m,h,g[2])||E!==Yt(m,h,g[3])}function db(m,h,g){const x=h.paint.get(m).value;return x.kind==="constant"?x.value:g.programConfigurations.get(h.id).getMaxValue(m)}function JS(m){return Math.sqrt(m[0]*m[0]+m[1]*m[1])}function e1(m,h,g,x,C){if(!h[0]&&!h[1])return m;const E=w.convert(h)._mult(C);g==="viewport"&&E._rotate(-x);const A=[];for(let L=0;L<m.length;L++)A.push(m[L].sub(E));return A}let z5,V5;wi("CircleBucket",Uv,{omit:["layers"]});var Jse={get paint(){return V5=V5||new ea({"circle-radius":new Ji(ee.paint_circle["circle-radius"]),"circle-color":new Ji(ee.paint_circle["circle-color"]),"circle-blur":new Ji(ee.paint_circle["circle-blur"]),"circle-opacity":new Ji(ee.paint_circle["circle-opacity"]),"circle-translate":new zi(ee.paint_circle["circle-translate"]),"circle-translate-anchor":new zi(ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zi(ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zi(ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ji(ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ji(ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ji(ee.paint_circle["circle-stroke-opacity"])})},get layout(){return z5=z5||new ea({"circle-sort-key":new Ji(ee.layout_circle["circle-sort-key"])})}};class eoe extends No{constructor(h){super(h,Jse)}createBucket(h){return new Uv(h)}queryRadius(h){const g=h;return db("circle-radius",this,g)+db("circle-stroke-width",this,g)+JS(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:h,feature:g,featureState:x,geometry:C,transform:E,pixelsToTileUnits:A,unwrappedTileID:L,getElevation:V}){const H=e1(h,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-E.bearingInRadians,A),X=this.paint.get("circle-radius").evaluate(g,x)+this.paint.get("circle-stroke-width").evaluate(g,x),K=this.paint.get("circle-pitch-alignment")==="map",ae=K?H:function(de,ge,Te,Ne){return de.map(tt=>G5(tt,ge,Te,Ne))}(H,E,L,V),ue=K?X*A:X;for(const de of C)for(const ge of de){const Te=K?ge:G5(ge,E,L,V);let Ne=ue;const tt=E.projectTileCoordinates(ge.x,ge.y,L,V).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ne*=tt/E.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ne*=E.cameraToCenterDistance/tt),Zse(ae,Te,Ne))return!0}return!1}}function G5(m,h,g,x){const C=h.projectTileCoordinates(m.x,m.y,g,x).point;return new w((.5*C.x+.5)*h.width,(.5*-C.y+.5)*h.height)}class U5 extends Uv{}let H5;wi("HeatmapBucket",U5,{omit:["layers"]});var toe={get paint(){return H5=H5||new ea({"heatmap-radius":new Ji(ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ji(ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zi(ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nb(ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zi(ee.paint_heatmap["heatmap-opacity"])})}};function g2(m,{width:h,height:g},x,C){if(C){if(C instanceof Uint8ClampedArray)C=new Uint8Array(C.buffer);else if(C.length!==h*g*x)throw new RangeError(`mismatched image size. expected: ${C.length} but got: ${h*g*x}`)}else C=new Uint8Array(h*g*x);return m.width=h,m.height=g,m.data=C,m}function $5(m,{width:h,height:g},x){if(h===m.width&&g===m.height)return;const C=g2({},{width:h,height:g},x);v2(m,C,{x:0,y:0},{x:0,y:0},{width:Math.min(m.width,h),height:Math.min(m.height,g)},x),m.width=h,m.height=g,m.data=C.data}function v2(m,h,g,x,C,E){if(C.width===0||C.height===0)return h;if(C.width>m.width||C.height>m.height||g.x>m.width-C.width||g.y>m.height-C.height)throw new RangeError("out of range source coordinates for image copy");if(C.width>h.width||C.height>h.height||x.x>h.width-C.width||x.y>h.height-C.height)throw new RangeError("out of range destination coordinates for image copy");const A=m.data,L=h.data;if(A===L)throw new Error("srcData equals dstData, so image is already copied");for(let V=0;V<C.height;V++){const H=((g.y+V)*m.width+g.x)*E,X=((x.y+V)*h.width+x.x)*E;for(let K=0;K<C.width*E;K++)L[X+K]=A[H+K]}return h}class fb{constructor(h,g){g2(this,h,1,g)}resize(h){$5(this,h,1)}clone(){return new fb({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(h,g,x,C,E){v2(h,g,x,C,E,1)}}class El{constructor(h,g){g2(this,h,4,g)}resize(h){$5(this,h,4)}replace(h,g){g?this.data.set(h):this.data=h instanceof Uint8ClampedArray?new Uint8Array(h.buffer):h}clone(){return new El({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(h,g,x,C,E){v2(h,g,x,C,E,4)}}function W5(m){const h={},g=m.resolution||256,x=m.clips?m.clips.length:1,C=m.image||new El({width:g,height:x});if(Math.log(g)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${g}`);const E=(A,L,V)=>{h[m.evaluationKey]=V;const H=m.expression.evaluate(h);C.data[A+L+0]=Math.floor(255*H.r/H.a),C.data[A+L+1]=Math.floor(255*H.g/H.a),C.data[A+L+2]=Math.floor(255*H.b/H.a),C.data[A+L+3]=Math.floor(255*H.a)};if(m.clips)for(let A=0,L=0;A<x;++A,L+=4*g)for(let V=0,H=0;V<g;V++,H+=4){const X=V/(g-1),{start:K,end:ae}=m.clips[A];E(L,H,K*(1-X)+ae*X)}else for(let A=0,L=0;A<g;A++,L+=4)E(0,L,A/(g-1));return C}wi("AlphaImage",fb),wi("RGBAImage",El);const y2="big-fb";class ioe extends No{createBucket(h){return new U5(h)}constructor(h){super(h,toe),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(h){h==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=W5({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(y2)&&this.heatmapFbos.delete(y2)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let q5;var noe={get paint(){return q5=q5||new ea({"hillshade-illumination-direction":new zi(ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new zi(ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zi(ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zi(ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zi(ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zi(ee.paint_hillshade["hillshade-accent-color"])})}};class roe extends No{constructor(h){super(h,noe)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const soe=ss([{name:"a_pos",components:2,type:"Int16"}],4),{members:ooe}=soe;function x2(m,h,g){const x=g.patternDependencies;let C=!1;for(const E of h){const A=E.paint.get(`${m}-pattern`);A.isConstant()||(C=!0);const L=A.constantOr(null);L&&(C=!0,x[L.to]=!0,x[L.from]=!0)}return C}function b2(m,h,g,x,C){const E=C.patternDependencies;for(const A of h){const L=A.paint.get(`${m}-pattern`).value;if(L.kind!=="constant"){let V=L.evaluate({zoom:x-1},g,{},C.availableImages),H=L.evaluate({zoom:x},g,{},C.availableImages),X=L.evaluate({zoom:x+1},g,{},C.availableImages);V=V&&V.name?V.name:V,H=H&&H.name?H.name:H,X=X&&X.name?X.name:X,E[V]=!0,E[H]=!0,E[X]=!0,g.patterns[A.id]={min:V,mid:H,max:X}}}return g}function j5(m,h,g,x,C){let E;if(C===function(A,L,V,H){let X=0;for(let K=L,ae=V-H;K<V;K+=H)X+=(A[ae]-A[K])*(A[K+1]+A[ae+1]),ae=K;return X}(m,h,g,x)>0)for(let A=h;A<g;A+=x)E=K5(A/x|0,m[A],m[A+1],E);else for(let A=g-x;A>=h;A-=x)E=K5(A/x|0,m[A],m[A+1],E);return E&&$v(E,E.next)&&(vb(E),E=E.next),E}function gm(m,h){if(!m)return m;h||(h=m);let g,x=m;do if(g=!1,x.steiner||!$v(x,x.next)&&gs(x.prev,x,x.next)!==0)x=x.next;else{if(vb(x),x=h=x.prev,x===x.next)break;g=!0}while(g||x!==h);return h}function pb(m,h,g,x,C,E,A){if(!m)return;!A&&E&&function(V,H,X,K){let ae=V;do ae.z===0&&(ae.z=w2(ae.x,ae.y,H,X,K)),ae.prevZ=ae.prev,ae.nextZ=ae.next,ae=ae.next;while(ae!==V);ae.prevZ.nextZ=null,ae.prevZ=null,function(ue){let de,ge=1;do{let Te,Ne=ue;ue=null;let tt=null;for(de=0;Ne;){de++;let Ve=Ne,ce=0;for(let Ue=0;Ue<ge&&(ce++,Ve=Ve.nextZ,Ve);Ue++);let Me=ge;for(;ce>0||Me>0&&Ve;)ce!==0&&(Me===0||!Ve||Ne.z<=Ve.z)?(Te=Ne,Ne=Ne.nextZ,ce--):(Te=Ve,Ve=Ve.nextZ,Me--),tt?tt.nextZ=Te:ue=Te,Te.prevZ=tt,tt=Te;Ne=Ve}tt.nextZ=null,ge*=2}while(de>1)}(ae)}(m,x,C,E);let L=m;for(;m.prev!==m.next;){const V=m.prev,H=m.next;if(E?loe(m,x,C,E):aoe(m))h.push(V.i,m.i,H.i),vb(m),m=H.next,L=H.next;else if((m=H)===L){A?A===1?pb(m=coe(gm(m),h),h,g,x,C,E,2):A===2&&uoe(m,h,g,x,C,E):pb(gm(m),h,g,x,C,E,1);break}}}function aoe(m){const h=m.prev,g=m,x=m.next;if(gs(h,g,x)>=0)return!1;const C=h.x,E=g.x,A=x.x,L=h.y,V=g.y,H=x.y,X=Math.min(C,E,A),K=Math.min(L,V,H),ae=Math.max(C,E,A),ue=Math.max(L,V,H);let de=x.next;for(;de!==h;){if(de.x>=X&&de.x<=ae&&de.y>=K&&de.y<=ue&&mb(C,L,E,V,A,H,de.x,de.y)&&gs(de.prev,de,de.next)>=0)return!1;de=de.next}return!0}function loe(m,h,g,x){const C=m.prev,E=m,A=m.next;if(gs(C,E,A)>=0)return!1;const L=C.x,V=E.x,H=A.x,X=C.y,K=E.y,ae=A.y,ue=Math.min(L,V,H),de=Math.min(X,K,ae),ge=Math.max(L,V,H),Te=Math.max(X,K,ae),Ne=w2(ue,de,h,g,x),tt=w2(ge,Te,h,g,x);let Ve=m.prevZ,ce=m.nextZ;for(;Ve&&Ve.z>=Ne&&ce&&ce.z<=tt;){if(Ve.x>=ue&&Ve.x<=ge&&Ve.y>=de&&Ve.y<=Te&&Ve!==C&&Ve!==A&&mb(L,X,V,K,H,ae,Ve.x,Ve.y)&&gs(Ve.prev,Ve,Ve.next)>=0||(Ve=Ve.prevZ,ce.x>=ue&&ce.x<=ge&&ce.y>=de&&ce.y<=Te&&ce!==C&&ce!==A&&mb(L,X,V,K,H,ae,ce.x,ce.y)&&gs(ce.prev,ce,ce.next)>=0))return!1;ce=ce.nextZ}for(;Ve&&Ve.z>=Ne;){if(Ve.x>=ue&&Ve.x<=ge&&Ve.y>=de&&Ve.y<=Te&&Ve!==C&&Ve!==A&&mb(L,X,V,K,H,ae,Ve.x,Ve.y)&&gs(Ve.prev,Ve,Ve.next)>=0)return!1;Ve=Ve.prevZ}for(;ce&&ce.z<=tt;){if(ce.x>=ue&&ce.x<=ge&&ce.y>=de&&ce.y<=Te&&ce!==C&&ce!==A&&mb(L,X,V,K,H,ae,ce.x,ce.y)&&gs(ce.prev,ce,ce.next)>=0)return!1;ce=ce.nextZ}return!0}function coe(m,h){let g=m;do{const x=g.prev,C=g.next.next;!$v(x,C)&&Z5(x,g,g.next,C)&&gb(x,C)&&gb(C,x)&&(h.push(x.i,g.i,C.i),vb(g),vb(g.next),g=m=C),g=g.next}while(g!==m);return gm(g)}function uoe(m,h,g,x,C,E){let A=m;do{let L=A.next.next;for(;L!==A.prev;){if(A.i!==L.i&&moe(A,L)){let V=X5(A,L);return A=gm(A,A.next),V=gm(V,V.next),pb(A,h,g,x,C,E,0),void pb(V,h,g,x,C,E,0)}L=L.next}A=A.next}while(A!==m)}function hoe(m,h){let g=m.x-h.x;return g===0&&(g=m.y-h.y,g===0)&&(g=(m.next.y-m.y)/(m.next.x-m.x)-(h.next.y-h.y)/(h.next.x-h.x)),g}function doe(m,h){const g=function(C,E){let A=E;const L=C.x,V=C.y;let H,X=-1/0;if($v(C,A))return A;do{if($v(C,A.next))return A.next;if(V<=A.y&&V>=A.next.y&&A.next.y!==A.y){const ge=A.x+(V-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(ge<=L&&ge>X&&(X=ge,H=A.x<A.next.x?A:A.next,ge===L))return H}A=A.next}while(A!==E);if(!H)return null;const K=H,ae=H.x,ue=H.y;let de=1/0;A=H;do{if(L>=A.x&&A.x>=ae&&L!==A.x&&Q5(V<ue?L:X,V,ae,ue,V<ue?X:L,V,A.x,A.y)){const ge=Math.abs(V-A.y)/(L-A.x);gb(A,C)&&(ge<de||ge===de&&(A.x>H.x||A.x===H.x&&foe(H,A)))&&(H=A,de=ge)}A=A.next}while(A!==K);return H}(m,h);if(!g)return h;const x=X5(g,m);return gm(x,x.next),gm(g,g.next)}function foe(m,h){return gs(m.prev,m,h.prev)<0&&gs(h.next,m,m.next)<0}function w2(m,h,g,x,C){return(m=1431655765&((m=858993459&((m=252645135&((m=16711935&((m=(m-g)*C|0)|m<<8))|m<<4))|m<<2))|m<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-x)*C|0)|h<<8))|h<<4))|h<<2))|h<<1))<<1}function poe(m){let h=m,g=m;do(h.x<g.x||h.x===g.x&&h.y<g.y)&&(g=h),h=h.next;while(h!==m);return g}function Q5(m,h,g,x,C,E,A,L){return(C-A)*(h-L)>=(m-A)*(E-L)&&(m-A)*(x-L)>=(g-A)*(h-L)&&(g-A)*(E-L)>=(C-A)*(x-L)}function mb(m,h,g,x,C,E,A,L){return!(m===A&&h===L)&&Q5(m,h,g,x,C,E,A,L)}function moe(m,h){return m.next.i!==h.i&&m.prev.i!==h.i&&!function(g,x){let C=g;do{if(C.i!==g.i&&C.next.i!==g.i&&C.i!==x.i&&C.next.i!==x.i&&Z5(C,C.next,g,x))return!0;C=C.next}while(C!==g);return!1}(m,h)&&(gb(m,h)&&gb(h,m)&&function(g,x){let C=g,E=!1;const A=(g.x+x.x)/2,L=(g.y+x.y)/2;do C.y>L!=C.next.y>L&&C.next.y!==C.y&&A<(C.next.x-C.x)*(L-C.y)/(C.next.y-C.y)+C.x&&(E=!E),C=C.next;while(C!==g);return E}(m,h)&&(gs(m.prev,m,h.prev)||gs(m,h.prev,h))||$v(m,h)&&gs(m.prev,m,m.next)>0&&gs(h.prev,h,h.next)>0)}function gs(m,h,g){return(h.y-m.y)*(g.x-h.x)-(h.x-m.x)*(g.y-h.y)}function $v(m,h){return m.x===h.x&&m.y===h.y}function Z5(m,h,g,x){const C=i1(gs(m,h,g)),E=i1(gs(m,h,x)),A=i1(gs(g,x,m)),L=i1(gs(g,x,h));return C!==E&&A!==L||!(C!==0||!t1(m,g,h))||!(E!==0||!t1(m,x,h))||!(A!==0||!t1(g,m,x))||!(L!==0||!t1(g,h,x))}function t1(m,h,g){return h.x<=Math.max(m.x,g.x)&&h.x>=Math.min(m.x,g.x)&&h.y<=Math.max(m.y,g.y)&&h.y>=Math.min(m.y,g.y)}function i1(m){return m>0?1:m<0?-1:0}function gb(m,h){return gs(m.prev,m,m.next)<0?gs(m,h,m.next)>=0&&gs(m,m.prev,h)>=0:gs(m,h,m.prev)<0||gs(m,m.next,h)<0}function X5(m,h){const g=_2(m.i,m.x,m.y),x=_2(h.i,h.x,h.y),C=m.next,E=h.prev;return m.next=h,h.prev=m,g.next=C,C.prev=g,x.next=g,g.prev=x,E.next=x,x.prev=E,x}function K5(m,h,g,x){const C=_2(m,h,g);return x?(C.next=x.next,C.prev=x,x.next.prev=C,x.next=C):(C.prev=C,C.next=C),C}function vb(m){m.next.prev=m.prev,m.prev.next=m.next,m.prevZ&&(m.prevZ.nextZ=m.nextZ),m.nextZ&&(m.nextZ.prevZ=m.prevZ)}function _2(m,h,g){return{i:m,x:h,y:g,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Wv{constructor(h,g){if(g>h)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=h,this._minGranularity=g}getGranularityForZoomLevel(h){return Math.max(Math.floor(this._baseZoomGranularity/(1<<h)),this._minGranularity,1)}}class n1{constructor(h){this.fill=h.fill,this.line=h.line,this.tile=h.tile,this.stencil=h.stencil,this.circle=h.circle}}n1.noSubdivision=new n1({fill:new Wv(0,0),line:new Wv(0,0),tile:new Wv(0,0),stencil:new Wv(0,0),circle:1}),wi("SubdivisionGranularityExpression",Wv),wi("SubdivisionGranularitySetting",n1);const qv=-32768,yb=32767;class goe{constructor(h,g){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=h,this._granularityCellSize=me/h,this._canonical=g}_getKey(h,g){return(h+=32768)<<16|(g+=32768)<<0}_vertexToIndex(h,g){if(h<-32768||g<-32768||h>32767||g>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const x=0|Math.round(h),C=0|Math.round(g),E=this._getKey(x,C);if(this._vertexDictionary.has(E))return this._vertexDictionary.get(E);const A=this._vertexBuffer.length/2;return this._vertexDictionary.set(E,A),this._vertexBuffer.push(x,C),A}_subdivideTrianglesScanline(h){if(this._granularity<2)return function(C,E){const A=[];for(let L=0;L<E.length;L+=3){const V=E[L],H=E[L+1],X=E[L+2],K=C[2*V],ae=C[2*V+1];(C[2*H]-K)*(C[2*X+1]-ae)-(C[2*H+1]-ae)*(C[2*X]-K)>0?(A.push(V),A.push(X),A.push(H)):(A.push(V),A.push(H),A.push(X))}return A}(this._vertexBuffer,h);const g=[],x=h.length;for(let C=0;C<x;C+=3){const E=[h[C+0],h[C+1],h[C+2]],A=[this._vertexBuffer[2*h[C+0]+0],this._vertexBuffer[2*h[C+0]+1],this._vertexBuffer[2*h[C+1]+0],this._vertexBuffer[2*h[C+1]+1],this._vertexBuffer[2*h[C+2]+0],this._vertexBuffer[2*h[C+2]+1]];let L=1/0,V=1/0,H=-1/0,X=-1/0;for(let ge=0;ge<3;ge++){const Te=A[2*ge],Ne=A[2*ge+1];L=Math.min(L,Te),H=Math.max(H,Te),V=Math.min(V,Ne),X=Math.max(X,Ne)}if(L===H||V===X)continue;const K=Math.floor(L/this._granularityCellSize),ae=Math.ceil(H/this._granularityCellSize),ue=Math.floor(V/this._granularityCellSize),de=Math.ceil(X/this._granularityCellSize);if(K!==ae||ue!==de)for(let ge=ue;ge<de;ge++){const Te=this._scanlineGenerateVertexRingForCellRow(ge,A,E);voe(this._vertexBuffer,Te,g)}else g.push(...E)}return g}_scanlineGenerateVertexRingForCellRow(h,g,x){const C=h*this._granularityCellSize,E=C+this._granularityCellSize,A=[];for(let L=0;L<3;L++){const V=g[2*L],H=g[2*L+1],X=g[2*(L+1)%6],K=g[(2*(L+1)+1)%6],ae=g[2*(L+2)%6],ue=g[(2*(L+2)+1)%6],de=X-V,ge=K-H,Te=de===0,Ne=ge===0,tt=(C-H)/ge,Ve=(E-H)/ge,ce=Math.min(tt,Ve),Me=Math.max(tt,Ve);if(!Ne&&(ce>=1||Me<=0)||Ne&&(H<C||H>E)){K>=C&&K<=E&&A.push(x[(L+1)%3]);continue}!Ne&&ce>0&&A.push(this._vertexToIndex(V+de*ce,H+ge*ce));const Ue=V+de*Math.max(ce,0),yt=V+de*Math.min(Me,1);Te||this._generateIntraEdgeVertices(A,V,H,X,K,Ue,yt),!Ne&&Me<1&&A.push(this._vertexToIndex(V+de*Me,H+ge*Me)),(Ne||K>=C&&K<=E)&&A.push(x[(L+1)%3]),!Ne&&(K<=C||K>=E)&&this._generateInterEdgeVertices(A,V,H,X,K,ae,ue,yt,C,E)}return A}_generateIntraEdgeVertices(h,g,x,C,E,A,L){const V=C-g,H=E-x,X=H===0,K=X?Math.min(g,C):Math.min(A,L),ae=X?Math.max(g,C):Math.max(A,L),ue=Math.floor(K/this._granularityCellSize)+1,de=Math.ceil(ae/this._granularityCellSize)-1;if(X?g<C:A<L)for(let ge=ue;ge<=de;ge++){const Te=ge*this._granularityCellSize;h.push(this._vertexToIndex(Te,x+H*(Te-g)/V))}else for(let ge=de;ge>=ue;ge--){const Te=ge*this._granularityCellSize;h.push(this._vertexToIndex(Te,x+H*(Te-g)/V))}}_generateInterEdgeVertices(h,g,x,C,E,A,L,V,H,X){const K=E-x,ae=A-C,ue=L-E,de=(H-E)/ue,ge=(X-E)/ue,Te=Math.min(de,ge),Ne=Math.max(de,ge),tt=C+ae*Te;let Ve=Math.floor(Math.min(tt,V)/this._granularityCellSize)+1,ce=Math.ceil(Math.max(tt,V)/this._granularityCellSize)-1,Me=V<tt;const Ue=ue===0;if(Ue&&(L===H||L===X))return;if(Ue||Te>=1||Ne<=0){const jt=x-L,_t=A+(g-A)*Math.min((H-L)/jt,(X-L)/jt);Ve=Math.floor(Math.min(_t,V)/this._granularityCellSize)+1,ce=Math.ceil(Math.max(_t,V)/this._granularityCellSize)-1,Me=V<_t}const yt=K>0?X:H;if(Me)for(let jt=Ve;jt<=ce;jt++)h.push(this._vertexToIndex(jt*this._granularityCellSize,yt));else for(let jt=ce;jt>=Ve;jt--)h.push(this._vertexToIndex(jt*this._granularityCellSize,yt))}_generateOutline(h){const g=[];for(const x of h){const C=vm(x,this._granularity,!0),E=this._pointArrayToIndices(C),A=[];for(let L=1;L<E.length;L++)A.push(E[L-1]),A.push(E[L]);g.push(A)}return g}_handlePoles(h){let g=!1,x=!1;this._canonical&&(this._canonical.y===0&&(g=!0),this._canonical.y===(1<<this._canonical.z)-1&&(x=!0)),(g||x)&&this._fillPoles(h,g,x)}_ensureNoPoleVertices(){const h=this._vertexBuffer;for(let g=0;g<h.length;g+=2){const x=h[g+1];x===qv&&(h[g+1]=-32767),x===yb&&(h[g+1]=32766)}}_generatePoleQuad(h,g,x,C,E,A){C>E!=(A===qv)?(h.push(g),h.push(x),h.push(this._vertexToIndex(C,A)),h.push(x),h.push(this._vertexToIndex(E,A)),h.push(this._vertexToIndex(C,A))):(h.push(x),h.push(g),h.push(this._vertexToIndex(C,A)),h.push(this._vertexToIndex(E,A)),h.push(x),h.push(this._vertexToIndex(C,A)))}_fillPoles(h,g,x){const C=this._vertexBuffer,E=me,A=h.length;for(let L=2;L<A;L+=3){const V=h[L-2],H=h[L-1],X=h[L],K=C[2*V],ae=C[2*V+1],ue=C[2*H],de=C[2*H+1],ge=C[2*X],Te=C[2*X+1];g&&(ae===0&&de===0&&this._generatePoleQuad(h,V,H,K,ue,qv),de===0&&Te===0&&this._generatePoleQuad(h,H,X,ue,ge,qv),Te===0&&ae===0&&this._generatePoleQuad(h,X,V,ge,K,qv)),x&&(ae===E&&de===E&&this._generatePoleQuad(h,V,H,K,ue,yb),de===E&&Te===E&&this._generatePoleQuad(h,H,X,ue,ge,yb),Te===E&&ae===E&&this._generatePoleQuad(h,X,V,ge,K,yb))}}_initializeVertices(h){for(let g=0;g<h.length;g+=2)this._vertexToIndex(h[g],h[g+1])}subdividePolygonInternal(h,g){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:x,holeIndices:C}=function(L){const V=[],H=[];for(const X of L)if(X.length!==0){X!==L[0]&&V.push(H.length/2);for(let K=0;K<X.length;K++)H.push(X[K].x),H.push(X[K].y)}return{flattened:H,holeIndices:V}}(h);let E;this._initializeVertices(x);try{const L=function(H,X,K=2){const ae=X&&X.length,ue=ae?X[0]*K:H.length;let de=j5(H,0,ue,K,!0);const ge=[];if(!de||de.next===de.prev)return ge;let Te,Ne,tt;if(ae&&(de=function(Ve,ce,Me,Ue){const yt=[];for(let jt=0,_t=ce.length;jt<_t;jt++){const Et=j5(Ve,ce[jt]*Ue,jt<_t-1?ce[jt+1]*Ue:Ve.length,Ue,!1);Et===Et.next&&(Et.steiner=!0),yt.push(poe(Et))}yt.sort(hoe);for(let jt=0;jt<yt.length;jt++)Me=doe(yt[jt],Me);return Me}(H,X,de,K)),H.length>80*K){Te=1/0,Ne=1/0;let Ve=-1/0,ce=-1/0;for(let Me=K;Me<ue;Me+=K){const Ue=H[Me],yt=H[Me+1];Ue<Te&&(Te=Ue),yt<Ne&&(Ne=yt),Ue>Ve&&(Ve=Ue),yt>ce&&(ce=yt)}tt=Math.max(Ve-Te,ce-Ne),tt=tt!==0?32767/tt:0}return pb(de,ge,K,Te,Ne,tt,0),ge}(x,C),V=this._convertIndices(x,L);E=this._subdivideTrianglesScanline(V)}catch(L){console.error(L)}let A=[];return g&&(A=this._generateOutline(h)),this._ensureNoPoleVertices(),this._handlePoles(E),{verticesFlattened:this._vertexBuffer,indicesTriangles:E,indicesLineList:A}}_convertIndices(h,g){const x=[];for(let C=0;C<g.length;C++)x.push(this._vertexToIndex(h[2*g[C]],h[2*g[C]+1]));return x}_pointArrayToIndices(h){const g=[];for(let x=0;x<h.length;x++){const C=h[x];g.push(this._vertexToIndex(C.x,C.y))}return g}}function Y5(m,h,g,x=!0){return new goe(g,h).subdividePolygonInternal(m,x)}function vm(m,h,g=!1){if(!m||m.length<1)return[];if(m.length<2)return[];const x=m[0],C=m[m.length-1],E=g&&(x.x!==C.x||x.y!==C.y);if(h<2)return E?[...m,m[0]]:[...m];const A=Math.floor(me/h),L=[];L.push(new w(m[0].x,m[0].y));const V=m.length,H=E?V:V-1;for(let X=0;X<H;X++){const K=m[X],ae=X<V-1?m[X+1]:m[0],ue=K.x,de=K.y,ge=ae.x,Te=ae.y,Ne=ue!==ge,tt=de!==Te;if(!Ne&&!tt)continue;const Ve=ge-ue,ce=Te-de,Me=Math.abs(Ve),Ue=Math.abs(ce);let yt=ue,jt=de;for(;;){const Et=Ve>0?(Math.floor(yt/A)+1)*A:(Math.ceil(yt/A)-1)*A,ri=ce>0?(Math.floor(jt/A)+1)*A:(Math.ceil(jt/A)-1)*A,Zt=Math.abs(yt-Et),si=Math.abs(jt-ri),Ft=Math.abs(yt-ge),Ti=Math.abs(jt-Te),Ki=Ne?Zt/Me:Number.POSITIVE_INFINITY,Wi=tt?si/Ue:Number.POSITIVE_INFINITY;if((Ft<=Zt||!Ne)&&(Ti<=si||!tt))break;if(Ki<Wi&&Ne||!tt){yt=Et,jt+=ce*Ki;const Ai=new w(yt,Math.round(jt));L[L.length-1].x===Ai.x&&L[L.length-1].y===Ai.y||L.push(Ai)}else{yt+=Ve*Wi,jt=ri;const Ai=new w(Math.round(yt),jt);L[L.length-1].x===Ai.x&&L[L.length-1].y===Ai.y||L.push(Ai)}}const _t=new w(ge,Te);L[L.length-1].x===_t.x&&L[L.length-1].y===_t.y||L.push(_t)}return L}function voe(m,h,g){if(h.length===0)throw new Error("Subdivision vertex ring is empty.");let x=0,C=m[2*h[0]];for(let V=1;V<h.length;V++){const H=m[2*h[V]];H<C&&(C=H,x=V)}const E=h.length;let A=x,L=(A+1)%E;for(;;){const V=A-1>=0?A-1:E-1,H=(L+1)%E,X=m[2*h[V]],K=m[2*h[H]],ae=m[2*h[A]],ue=m[2*h[A]+1],de=m[2*h[L]+1];let ge=!1;if(X<K)ge=!0;else if(X>K)ge=!1;else{const Te=de-ue,Ne=-(m[2*h[L]]-ae),tt=ue<de?1:-1;((X-ae)*Te+(m[2*h[V]+1]-ue)*Ne)*tt>((K-ae)*Te+(m[2*h[H]+1]-ue)*Ne)*tt&&(ge=!0)}if(ge){const Te=h[V],Ne=h[A],tt=h[L];Te!==Ne&&Te!==tt&&Ne!==tt&&g.push(tt,Ne,Te),A--,A<0&&(A=E-1)}else{const Te=h[H],Ne=h[A],tt=h[L];Te!==Ne&&Te!==tt&&Ne!==tt&&g.push(tt,Ne,Te),L++,L>=E&&(L=0)}if(V===H)break}}function J5(m,h,g,x,C,E,A,L,V){const H=C.length/2,X=A&&L&&V;if(H<bn.MAX_VERTEX_ARRAY_LENGTH){const K=h.prepareSegment(H,g,x),ae=K.vertexLength;for(let ge=0;ge<E.length;ge+=3)x.emplaceBack(ae+E[ge],ae+E[ge+1],ae+E[ge+2]);let ue,de;K.vertexLength+=H,K.primitiveLength+=E.length/3,X&&(de=A.prepareSegment(H,g,L),ue=de.vertexLength,de.vertexLength+=H);for(let ge=0;ge<C.length;ge+=2)m(C[ge],C[ge+1]);if(X)for(let ge=0;ge<V.length;ge++){const Te=V[ge];for(let Ne=1;Ne<Te.length;Ne+=2)L.emplaceBack(ue+Te[Ne-1],ue+Te[Ne]);de.primitiveLength+=Te.length/2}}else(function(K,ae,ue,de,ge,Te){const Ne=[];for(let Ue=0;Ue<de.length/2;Ue++)Ne.push(-1);const tt={count:0};let Ve=0,ce=K.getOrCreateLatestSegment(ae,ue),Me=ce.vertexLength;for(let Ue=2;Ue<ge.length;Ue+=3){const yt=ge[Ue-2],jt=ge[Ue-1],_t=ge[Ue];let Et=Ne[yt]<Ve,ri=Ne[jt]<Ve,Zt=Ne[_t]<Ve;ce.vertexLength+((Et?1:0)+(ri?1:0)+(Zt?1:0))>bn.MAX_VERTEX_ARRAY_LENGTH&&(ce=K.createNewSegment(ae,ue),Ve=tt.count,Et=!0,ri=!0,Zt=!0,Me=0);const si=xb(Ne,de,Te,tt,yt,Et,ce),Ft=xb(Ne,de,Te,tt,jt,ri,ce),Ti=xb(Ne,de,Te,tt,_t,Zt,ce);ue.emplaceBack(Me+si-Ve,Me+Ft-Ve,Me+Ti-Ve),ce.primitiveLength++}})(h,g,x,C,E,m),X&&function(K,ae,ue,de,ge,Te){const Ne=[];for(let Ue=0;Ue<de.length/2;Ue++)Ne.push(-1);const tt={count:0};let Ve=0,ce=K.getOrCreateLatestSegment(ae,ue),Me=ce.vertexLength;for(let Ue=0;Ue<ge.length;Ue++){const yt=ge[Ue];for(let jt=1;jt<ge[Ue].length;jt+=2){const _t=yt[jt-1],Et=yt[jt];let ri=Ne[_t]<Ve,Zt=Ne[Et]<Ve;ce.vertexLength+((ri?1:0)+(Zt?1:0))>bn.MAX_VERTEX_ARRAY_LENGTH&&(ce=K.createNewSegment(ae,ue),Ve=tt.count,ri=!0,Zt=!0,Me=0);const si=xb(Ne,de,Te,tt,_t,ri,ce),Ft=xb(Ne,de,Te,tt,Et,Zt,ce);ue.emplaceBack(Me+si-Ve,Me+Ft-Ve),ce.primitiveLength++}}}(A,g,L,C,V,m),h.forceNewSegmentOnNextPrepare(),A?.forceNewSegmentOnNextPrepare()}function xb(m,h,g,x,C,E,A){if(E){const L=x.count;return g(h[2*C],h[2*C+1]),m[C]=x.count,x.count++,A.vertexLength++,L}return m[C]}class C2{constructor(h){this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map(g=>g.id),this.index=h.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ke,this.indexArray=new Ht,this.indexArray2=new Ri,this.programConfigurations=new sd(h.layers,h.zoom),this.segments=new bn,this.segments2=new bn,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id)}populate(h,g,x){this.hasPattern=x2("fill",this.layers,g);const C=this.layers[0].layout.get("fill-sort-key"),E=!C.isConstant(),A=[];for(const{feature:L,id:V,index:H,sourceLayerIndex:X}of h){const K=this.layers[0]._featureFilter.needGeometry,ae=Uu(L,K);if(!this.layers[0]._featureFilter.filter(new Tr(this.zoom),ae,x))continue;const ue=E?C.evaluate(ae,{},x,g.availableImages):void 0,de={id:V,properties:L.properties,type:L.type,sourceLayerIndex:X,index:H,geometry:K?ae.geometry:Gu(L),patterns:{},sortKey:ue};A.push(de)}E&&A.sort((L,V)=>L.sortKey-V.sortKey);for(const L of A){const{geometry:V,index:H,sourceLayerIndex:X}=L;if(this.hasPattern){const K=b2("fill",this.layers,L,this.zoom,g);this.patternFeatures.push(K)}else this.addFeature(L,V,H,x,{},g.subdivisionGranularity);g.featureIndex.insert(h[H].feature,V,H,X,this.index)}}update(h,g,x){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(h,g,this.stateDependentLayers,x)}addFeatures(h,g,x){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,g,x,h.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(h){this.uploaded||(this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,ooe),this.indexBuffer=h.createIndexBuffer(this.indexArray),this.indexBuffer2=h.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(h),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(h,g,x,C,E,A){for(const L of Jp(g,500)){const V=Y5(L,C,A.fill.getGranularityForZoomLevel(C.z)),H=this.layoutVertexArray;J5((X,K)=>{H.emplaceBack(X,K)},this.segments,this.layoutVertexArray,this.indexArray,V.verticesFlattened,V.indicesTriangles,this.segments2,this.indexArray2,V.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,x,E,C)}}let e8,t8;wi("FillBucket",C2,{omit:["layers","patternFeatures"]});var yoe={get paint(){return t8=t8||new ea({"fill-antialias":new zi(ee.paint_fill["fill-antialias"]),"fill-opacity":new Ji(ee.paint_fill["fill-opacity"]),"fill-color":new Ji(ee.paint_fill["fill-color"]),"fill-outline-color":new Ji(ee.paint_fill["fill-outline-color"]),"fill-translate":new zi(ee.paint_fill["fill-translate"]),"fill-translate-anchor":new zi(ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bv(ee.paint_fill["fill-pattern"])})},get layout(){return e8=e8||new ea({"fill-sort-key":new Ji(ee.layout_fill["fill-sort-key"])})}};class xoe extends No{constructor(h){super(h,yoe)}recalculate(h,g){super.recalculate(h,g);const x=this.paint._values["fill-outline-color"];x.value.kind==="constant"&&x.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(h){return new C2(h)}queryRadius(){return JS(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:h,geometry:g,transform:x,pixelsToTileUnits:C}){return F5(e1(h,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-x.bearingInRadians,C),g)}isTileClipped(){return!0}}const boe=ss([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),woe=ss([{name:"a_centroid",components:2,type:"Int16"}],4),{members:_oe}=boe;var S2,i8,O2,n8,M2,r8,s8,r1={};function o8(){if(i8)return S2;i8=1;var m=p();function h(C,E,A,L,V){this.properties={},this.extent=A,this.type=0,this._pbf=C,this._geometry=-1,this._keys=L,this._values=V,C.readFields(g,this,E)}function g(C,E,A){C==1?E.id=A.readVarint():C==2?function(L,V){for(var H=L.readVarint()+L.pos;L.pos<H;){var X=V._keys[L.readVarint()],K=V._values[L.readVarint()];V.properties[X]=K}}(A,E):C==3?E.type=A.readVarint():C==4&&(E._geometry=A.pos)}function x(C){for(var E,A,L=0,V=0,H=C.length,X=H-1;V<H;X=V++)L+=((A=C[X]).x-(E=C[V]).x)*(E.y+A.y);return L}return S2=h,h.types=["Unknown","Point","LineString","Polygon"],h.prototype.loadGeometry=function(){var C=this._pbf;C.pos=this._geometry;for(var E,A=C.readVarint()+C.pos,L=1,V=0,H=0,X=0,K=[];C.pos<A;){if(V<=0){var ae=C.readVarint();L=7&ae,V=ae>>3}if(V--,L===1||L===2)H+=C.readSVarint(),X+=C.readSVarint(),L===1&&(E&&K.push(E),E=[]),E.push(new m(H,X));else{if(L!==7)throw new Error("unknown command "+L);E&&E.push(E[0].clone())}}return E&&K.push(E),K},h.prototype.bbox=function(){var C=this._pbf;C.pos=this._geometry;for(var E=C.readVarint()+C.pos,A=1,L=0,V=0,H=0,X=1/0,K=-1/0,ae=1/0,ue=-1/0;C.pos<E;){if(L<=0){var de=C.readVarint();A=7&de,L=de>>3}if(L--,A===1||A===2)(V+=C.readSVarint())<X&&(X=V),V>K&&(K=V),(H+=C.readSVarint())<ae&&(ae=H),H>ue&&(ue=H);else if(A!==7)throw new Error("unknown command "+A)}return[X,ae,K,ue]},h.prototype.toGeoJSON=function(C,E,A){var L,V,H=this.extent*Math.pow(2,A),X=this.extent*C,K=this.extent*E,ae=this.loadGeometry(),ue=h.types[this.type];function de(Ne){for(var tt=0;tt<Ne.length;tt++){var Ve=Ne[tt];Ne[tt]=[360*(Ve.x+X)/H-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ve.y+K)/H)*Math.PI/180))-90]}}switch(this.type){case 1:var ge=[];for(L=0;L<ae.length;L++)ge[L]=ae[L][0];de(ae=ge);break;case 2:for(L=0;L<ae.length;L++)de(ae[L]);break;case 3:for(ae=function(Ne){var tt=Ne.length;if(tt<=1)return[Ne];for(var Ve,ce,Me=[],Ue=0;Ue<tt;Ue++){var yt=x(Ne[Ue]);yt!==0&&(ce===void 0&&(ce=yt<0),ce===yt<0?(Ve&&Me.push(Ve),Ve=[Ne[Ue]]):Ve.push(Ne[Ue]))}return Ve&&Me.push(Ve),Me}(ae),L=0;L<ae.length;L++)for(V=0;V<ae[L].length;V++)de(ae[L][V])}ae.length===1?ae=ae[0]:ue="Multi"+ue;var Te={type:"Feature",geometry:{type:ue,coordinates:ae},properties:this.properties};return"id"in this&&(Te.id=this.id),Te},S2}function a8(){if(n8)return O2;n8=1;var m=o8();function h(x,C){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=x,this._keys=[],this._values=[],this._features=[],x.readFields(g,this,C),this.length=this._features.length}function g(x,C,E){x===15?C.version=E.readVarint():x===1?C.name=E.readString():x===5?C.extent=E.readVarint():x===2?C._features.push(E.pos):x===3?C._keys.push(E.readString()):x===4&&C._values.push(function(A){for(var L=null,V=A.readVarint()+A.pos;A.pos<V;){var H=A.readVarint()>>3;L=H===1?A.readString():H===2?A.readFloat():H===3?A.readDouble():H===4?A.readVarint64():H===5?A.readVarint():H===6?A.readSVarint():H===7?A.readBoolean():null}return L}(E))}return O2=h,h.prototype.feature=function(x){if(x<0||x>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[x];var C=this._pbf.readVarint()+this._pbf.pos;return new m(this._pbf,C,this.extent,this._keys,this._values)},O2}function l8(){return s8||(s8=1,r1.VectorTile=function(){if(r8)return M2;r8=1;var m=a8();function h(g,x,C){if(g===3){var E=new m(C,C.readVarint()+C.pos);E.length&&(x[E.name]=E)}}return M2=function(g,x){this.layers=g.readFields(h,{},x)},M2}(),r1.VectorTileFeature=o8(),r1.VectorTileLayer=a8()),r1}var bb=l(l8());const Coe=bb.VectorTileFeature.types,T2=Math.pow(2,13);function wb(m,h,g,x,C,E,A,L){m.emplaceBack(h,g,2*Math.floor(x*T2)+A,C*T2*2,E*T2*2,Math.round(L))}class R2{constructor(h){this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map(g=>g.id),this.index=h.index,this.hasPattern=!1,this.layoutVertexArray=new at,this.centroidVertexArray=new We,this.indexArray=new Ht,this.programConfigurations=new sd(h.layers,h.zoom),this.segments=new bn,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id)}populate(h,g,x){this.features=[],this.hasPattern=x2("fill-extrusion",this.layers,g);for(const{feature:C,id:E,index:A,sourceLayerIndex:L}of h){const V=this.layers[0]._featureFilter.needGeometry,H=Uu(C,V);if(!this.layers[0]._featureFilter.filter(new Tr(this.zoom),H,x))continue;const X={id:E,sourceLayerIndex:L,index:A,geometry:V?H.geometry:Gu(C),properties:C.properties,type:C.type,patterns:{}};this.hasPattern?this.features.push(b2("fill-extrusion",this.layers,X,this.zoom,g)):this.addFeature(X,X.geometry,A,x,{},g.subdivisionGranularity),g.featureIndex.insert(C,X.geometry,A,L,this.index,!0)}}addFeatures(h,g,x){for(const C of this.features){const{geometry:E}=C;this.addFeature(C,E,C.index,g,x,h.subdivisionGranularity)}}update(h,g,x){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(h,g,this.stateDependentLayers,x)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(h){this.uploaded||(this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,_oe),this.centroidVertexBuffer=h.createVertexBuffer(this.centroidVertexArray,woe.members,!0),this.indexBuffer=h.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(h),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(h,g,x,C,E,A){for(const L of Jp(g,500)){const V={x:0,y:0,sampleCount:0},H=this.layoutVertexArray.length;this.processPolygon(V,C,h,L,A);const X=this.layoutVertexArray.length-H,K=Math.floor(V.x/V.sampleCount),ae=Math.floor(V.y/V.sampleCount);for(let ue=0;ue<X;ue++)this.centroidVertexArray.emplaceBack(K,ae)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,x,E,C)}processPolygon(h,g,x,C,E){if(C.length<1||c8(C[0]))return;for(const K of C)K.length!==0&&Soe(h,K);const A={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},L=E.fill.getGranularityForZoomLevel(g.z),V=Coe[x.type]==="Polygon";for(const K of C){if(K.length===0||c8(K))continue;const ae=vm(K,L,V);this._generateSideFaces(ae,A)}if(!V)return;const H=Y5(C,g,L,!1),X=this.layoutVertexArray;J5((K,ae)=>{wb(X,K,ae,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,H.verticesFlattened,H.indicesTriangles)}_generateSideFaces(h,g){let x=0;for(let C=1;C<h.length;C++){const E=h[C],A=h[C-1];if(Ooe(E,A))continue;g.segment.vertexLength+4>bn.MAX_VERTEX_ARRAY_LENGTH&&(g.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const L=E.sub(A)._perp()._unit(),V=A.dist(E);x+V>32768&&(x=0),wb(this.layoutVertexArray,E.x,E.y,L.x,L.y,0,0,x),wb(this.layoutVertexArray,E.x,E.y,L.x,L.y,0,1,x),x+=V,wb(this.layoutVertexArray,A.x,A.y,L.x,L.y,0,0,x),wb(this.layoutVertexArray,A.x,A.y,L.x,L.y,0,1,x);const H=g.segment.vertexLength;this.indexArray.emplaceBack(H,H+2,H+1),this.indexArray.emplaceBack(H+1,H+2,H+3),g.segment.vertexLength+=4,g.segment.primitiveLength+=2}}}function Soe(m,h){for(let g=0;g<h.length;g++){const x=h[g];g===h.length-1&&h[0].x===x.x&&h[0].y===x.y||(m.x+=x.x,m.y+=x.y,m.sampleCount++)}}function Ooe(m,h){return m.x===h.x&&(m.x<0||m.x>me)||m.y===h.y&&(m.y<0||m.y>me)}function c8(m){return m.every(h=>h.x<0)||m.every(h=>h.x>me)||m.every(h=>h.y<0)||m.every(h=>h.y>me)}let u8;wi("FillExtrusionBucket",R2,{omit:["layers","features"]});var Moe={get paint(){return u8=u8||new ea({"fill-extrusion-opacity":new zi(ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ji(ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zi(ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zi(ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bv(ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ji(ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ji(ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zi(ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Toe extends No{constructor(h){super(h,Moe)}createBucket(h){return new R2(h)}queryRadius(){return JS(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:h,feature:g,featureState:x,geometry:C,transform:E,pixelsToTileUnits:A,pixelPosMatrix:L}){const V=e1(h,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-E.bearingInRadians,A),H=this.paint.get("fill-extrusion-height").evaluate(g,x),X=this.paint.get("fill-extrusion-base").evaluate(g,x),K=function(ue,de,ge){const Te=[];for(const Ne of ue){const tt=[Ne.x,Ne.y,0,1];j(tt,tt,de),Te.push(new w(tt[0]/tt[3],tt[1]/tt[3]))}return Te}(V,L),ae=function(ue,de,ge,Te){const Ne=[],tt=[],Ve=Te[8]*de,ce=Te[9]*de,Me=Te[10]*de,Ue=Te[11]*de,yt=Te[8]*ge,jt=Te[9]*ge,_t=Te[10]*ge,Et=Te[11]*ge;for(const ri of ue){const Zt=[],si=[];for(const Ft of ri){const Ti=Ft.x,Ki=Ft.y,Wi=Te[0]*Ti+Te[4]*Ki+Te[12],Ai=Te[1]*Ti+Te[5]*Ki+Te[13],Ln=Te[2]*Ti+Te[6]*Ki+Te[14],Qr=Te[3]*Ti+Te[7]*Ki+Te[15],Ns=Ln+Me,Oo=Qr+Ue,Il=Wi+yt,Sa=Ai+jt,ro=Ln+_t,Vr=Qr+Et,qs=new w((Wi+Ve)/Oo,(Ai+ce)/Oo);qs.z=Ns/Oo,Zt.push(qs);const so=new w(Il/Vr,Sa/Vr);so.z=ro/Vr,si.push(so)}Ne.push(Zt),tt.push(si)}return[Ne,tt]}(C,X,H,L);return function(ue,de,ge){let Te=1/0;F5(ge,de)&&(Te=h8(ge,de[0]));for(let Ne=0;Ne<de.length;Ne++){const tt=de[Ne],Ve=ue[Ne];for(let ce=0;ce<tt.length-1;ce++){const Me=tt[ce],Ue=[Me,tt[ce+1],Ve[ce+1],Ve[ce],Me];Hv(ge,Ue)&&(Te=Math.min(Te,h8(ge,Ue)))}}return Te!==1/0&&Te}(ae[0],ae[1],K)}}function _b(m,h){return m.x*h.x+m.y*h.y}function h8(m,h){if(m.length===1){let g=0;const x=h[g++];let C;for(;!C||x.equals(C);)if(C=h[g++],!C)return 1/0;for(;g<h.length;g++){const E=h[g],A=m[0],L=C.sub(x),V=E.sub(x),H=A.sub(x),X=_b(L,L),K=_b(L,V),ae=_b(V,V),ue=_b(H,L),de=_b(H,V),ge=X*ae-K*K,Te=(ae*ue-K*de)/ge,Ne=(X*de-K*ue)/ge,tt=x.z*(1-Te-Ne)+C.z*Te+E.z*Ne;if(isFinite(tt))return tt}return 1/0}{let g=1/0;for(const x of h)g=Math.min(g,x.z);return g}}const Roe=ss([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Poe}=Roe,Eoe=ss([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Aoe}=Eoe,Ioe=bb.VectorTileFeature.types,koe=Math.cos(Math.PI/180*37.5),d8=Math.pow(2,14)/.5;class P2{constructor(h){this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map(g=>g.id),this.index=h.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(g=>{this.gradients[g.id]={}}),this.layoutVertexArray=new et,this.layoutVertexArray2=new vt,this.indexArray=new Ht,this.programConfigurations=new sd(h.layers,h.zoom),this.segments=new bn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id)}populate(h,g,x){this.hasPattern=x2("line",this.layers,g);const C=this.layers[0].layout.get("line-sort-key"),E=!C.isConstant(),A=[];for(const{feature:L,id:V,index:H,sourceLayerIndex:X}of h){const K=this.layers[0]._featureFilter.needGeometry,ae=Uu(L,K);if(!this.layers[0]._featureFilter.filter(new Tr(this.zoom),ae,x))continue;const ue=E?C.evaluate(ae,{},x):void 0,de={id:V,properties:L.properties,type:L.type,sourceLayerIndex:X,index:H,geometry:K?ae.geometry:Gu(L),patterns:{},sortKey:ue};A.push(de)}E&&A.sort((L,V)=>L.sortKey-V.sortKey);for(const L of A){const{geometry:V,index:H,sourceLayerIndex:X}=L;if(this.hasPattern){const K=b2("line",this.layers,L,this.zoom,g);this.patternFeatures.push(K)}else this.addFeature(L,V,H,x,{},g.subdivisionGranularity);g.featureIndex.insert(h[H].feature,V,H,X,this.index)}}update(h,g,x){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(h,g,this.stateDependentLayers,x)}addFeatures(h,g,x){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,g,x,h.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(h){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=h.createVertexBuffer(this.layoutVertexArray2,Aoe)),this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,Poe),this.indexBuffer=h.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(h),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(h){if(h.properties&&Object.prototype.hasOwnProperty.call(h.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(h.properties,"mapbox_clip_end"))return{start:+h.properties.mapbox_clip_start,end:+h.properties.mapbox_clip_end}}addFeature(h,g,x,C,E,A){const L=this.layers[0].layout,V=L.get("line-join").evaluate(h,{}),H=L.get("line-cap"),X=L.get("line-miter-limit"),K=L.get("line-round-limit");this.lineClips=this.lineFeatureClips(h);for(const ae of g)this.addLine(ae,h,V,H,X,K,C,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,x,E,C)}addLine(h,g,x,C,E,A,L,V){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,h=vm(h,L?V.line.getGranularityForZoomLevel(L.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ve=0;Ve<h.length-1;Ve++)this.totalDistance+=h[Ve].dist(h[Ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const H=Ioe[g.type]==="Polygon";let X=h.length;for(;X>=2&&h[X-1].equals(h[X-2]);)X--;let K=0;for(;K<X-1&&h[K].equals(h[K+1]);)K++;if(X<(H?3:2))return;x==="bevel"&&(E=1.05);const ae=this.overscaling<=16?15*me/(512*this.overscaling):0,ue=this.segments.prepareSegment(10*X,this.layoutVertexArray,this.indexArray);let de,ge,Te,Ne,tt;this.e1=this.e2=-1,H&&(de=h[X-2],tt=h[K].sub(de)._unit()._perp());for(let Ve=K;Ve<X;Ve++){if(Te=Ve===X-1?H?h[K+1]:void 0:h[Ve+1],Te&&h[Ve].equals(Te))continue;tt&&(Ne=tt),de&&(ge=de),de=h[Ve],tt=Te?Te.sub(de)._unit()._perp():Ne,Ne=Ne||tt;let ce=Ne.add(tt);ce.x===0&&ce.y===0||ce._unit();const Me=Ne.x*tt.x+Ne.y*tt.y,Ue=ce.x*tt.x+ce.y*tt.y,yt=Ue!==0?1/Ue:1/0,jt=2*Math.sqrt(2-2*Ue),_t=Ue<koe&&ge&&Te,Et=Ne.x*tt.y-Ne.y*tt.x>0;if(_t&&Ve>K){const si=de.dist(ge);if(si>2*ae){const Ft=de.sub(de.sub(ge)._mult(ae/si)._round());this.updateDistance(ge,Ft),this.addCurrentVertex(Ft,Ne,0,0,ue),ge=Ft}}const ri=ge&&Te;let Zt=ri?x:H?"butt":C;if(ri&&Zt==="round"&&(yt<A?Zt="miter":yt<=2&&(Zt="fakeround")),Zt==="miter"&&yt>E&&(Zt="bevel"),Zt==="bevel"&&(yt>2&&(Zt="flipbevel"),yt<E&&(Zt="miter")),ge&&this.updateDistance(ge,de),Zt==="miter")ce._mult(yt),this.addCurrentVertex(de,ce,0,0,ue);else if(Zt==="flipbevel"){if(yt>100)ce=tt.mult(-1);else{const si=yt*Ne.add(tt).mag()/Ne.sub(tt).mag();ce._perp()._mult(si*(Et?-1:1))}this.addCurrentVertex(de,ce,0,0,ue),this.addCurrentVertex(de,ce.mult(-1),0,0,ue)}else if(Zt==="bevel"||Zt==="fakeround"){const si=-Math.sqrt(yt*yt-1),Ft=Et?si:0,Ti=Et?0:si;if(ge&&this.addCurrentVertex(de,Ne,Ft,Ti,ue),Zt==="fakeround"){const Ki=Math.round(180*jt/Math.PI/20);for(let Wi=1;Wi<Ki;Wi++){let Ai=Wi/Ki;if(Ai!==.5){const Qr=Ai-.5;Ai+=Ai*Qr*(Ai-1)*((1.0904+Me*(Me*(3.55645-1.43519*Me)-3.2452))*Qr*Qr+(.848013+Me*(.215638*Me-1.06021)))}const Ln=tt.sub(Ne)._mult(Ai)._add(Ne)._unit()._mult(Et?-1:1);this.addHalfVertex(de,Ln.x,Ln.y,!1,Et,0,ue)}}Te&&this.addCurrentVertex(de,tt,-Ft,-Ti,ue)}else if(Zt==="butt")this.addCurrentVertex(de,ce,0,0,ue);else if(Zt==="square"){const si=ge?1:-1;this.addCurrentVertex(de,ce,si,si,ue)}else Zt==="round"&&(ge&&(this.addCurrentVertex(de,Ne,0,0,ue),this.addCurrentVertex(de,Ne,1,1,ue,!0)),Te&&(this.addCurrentVertex(de,tt,-1,-1,ue,!0),this.addCurrentVertex(de,tt,0,0,ue)));if(_t&&Ve<X-1){const si=de.dist(Te);if(si>2*ae){const Ft=de.add(Te.sub(de)._mult(ae/si)._round());this.updateDistance(de,Ft),this.addCurrentVertex(Ft,tt,0,0,ue),de=Ft}}}}addCurrentVertex(h,g,x,C,E,A=!1){const L=g.y*C-g.x,V=-g.y-g.x*C;this.addHalfVertex(h,g.x+g.y*x,g.y-g.x*x,A,!1,x,E),this.addHalfVertex(h,L,V,A,!0,-C,E),this.distance>d8/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(h,g,x,C,E,A))}addHalfVertex({x:h,y:g},x,C,E,A,L,V){const H=.5*(this.lineClips?this.scaledDistance*(d8-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((h<<1)+(E?1:0),(g<<1)+(A?1:0),Math.round(63*x)+128,Math.round(63*C)+128,1+(L===0?0:L<0?-1:1)|(63&H)<<2,H>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const X=V.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,X,this.e2),V.primitiveLength++),A?this.e2=X:this.e1=X}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(h,g){this.distance+=h.dist(g),this.updateScaledDistance()}}let f8,p8;wi("LineBucket",P2,{omit:["layers","patternFeatures"]});var m8={get paint(){return p8=p8||new ea({"line-opacity":new Ji(ee.paint_line["line-opacity"]),"line-color":new Ji(ee.paint_line["line-color"]),"line-translate":new zi(ee.paint_line["line-translate"]),"line-translate-anchor":new zi(ee.paint_line["line-translate-anchor"]),"line-width":new Ji(ee.paint_line["line-width"]),"line-gap-width":new Ji(ee.paint_line["line-gap-width"]),"line-offset":new Ji(ee.paint_line["line-offset"]),"line-blur":new Ji(ee.paint_line["line-blur"]),"line-dasharray":new ib(ee.paint_line["line-dasharray"]),"line-pattern":new Bv(ee.paint_line["line-pattern"]),"line-gradient":new nb(ee.paint_line["line-gradient"])})},get layout(){return f8=f8||new ea({"line-cap":new zi(ee.layout_line["line-cap"]),"line-join":new Ji(ee.layout_line["line-join"]),"line-miter-limit":new zi(ee.layout_line["line-miter-limit"]),"line-round-limit":new zi(ee.layout_line["line-round-limit"]),"line-sort-key":new Ji(ee.layout_line["line-sort-key"])})}};class Doe extends Ji{possiblyEvaluate(h,g){return g=new Tr(Math.floor(g.zoom),{now:g.now,fadeDuration:g.fadeDuration,zoomHistory:g.zoomHistory,transition:g.transition}),super.possiblyEvaluate(h,g)}evaluate(h,g,x,C){return g=Je({},g,{zoom:Math.floor(g.zoom)}),super.evaluate(h,g,x,C)}}let s1;class Loe extends No{constructor(h){super(h,m8),this.gradientVersion=0,s1||(s1=new Doe(m8.paint.properties["line-width"].specification),s1.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(h){if(h==="line-gradient"){const g=this.gradientExpression();this.stepInterpolant=!!function(x){return x._styleExpression!==void 0}(g)&&g._styleExpression.expression instanceof uf,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(h,g){super.recalculate(h,g),this.paint._values["line-floorwidth"]=s1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,h)}createBucket(h){return new P2(h)}queryRadius(h){const g=h,x=g8(db("line-width",this,g),db("line-gap-width",this,g)),C=db("line-offset",this,g);return x/2+Math.abs(C)+JS(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:h,feature:g,featureState:x,geometry:C,transform:E,pixelsToTileUnits:A}){const L=e1(h,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-E.bearingInRadians,A),V=A/2*g8(this.paint.get("line-width").evaluate(g,x),this.paint.get("line-gap-width").evaluate(g,x)),H=this.paint.get("line-offset").evaluate(g,x);return H&&(C=function(X,K){const ae=[];for(let ue=0;ue<X.length;ue++){const de=X[ue],ge=[];for(let Te=0;Te<de.length;Te++){const Ne=de[Te-1],tt=de[Te],Ve=de[Te+1],ce=Te===0?new w(0,0):tt.sub(Ne)._unit()._perp(),Me=Te===de.length-1?new w(0,0):Ve.sub(tt)._unit()._perp(),Ue=ce._add(Me)._unit(),yt=Ue.x*Me.x+Ue.y*Me.y;yt!==0&&Ue._mult(1/yt),ge.push(Ue._mult(K)._add(tt))}ae.push(ge)}return ae}(C,H*A)),function(X,K,ae){for(let ue=0;ue<K.length;ue++){const de=K[ue];if(X.length>=3){for(let ge=0;ge<de.length;ge++)if(mm(X,de[ge]))return!0}if(Xse(X,de,ae))return!0}return!1}(L,C,V)}isTileClipped(){return!0}}function g8(m,h){return h>0?h+2*m:m}const Foe=ss([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Noe=ss([{name:"a_projected_pos",components:3,type:"Float32"}],4);ss([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Boe=ss([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);ss([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const v8=ss([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),zoe=ss([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Voe(m,h,g){return m.sections.forEach(x=>{x.text=function(C,E,A){const L=E.layout.get("text-transform").evaluate(A,{});return L==="uppercase"?C=C.toLocaleUpperCase():L==="lowercase"&&(C=C.toLocaleLowerCase()),iu.applyArabicShaping&&(C=iu.applyArabicShaping(C)),C}(x.text,h,g)}),m}ss([{name:"triangle",components:3,type:"Uint16"}]),ss([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ss([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ss([{type:"Float32",name:"offsetX"}]),ss([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ss([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Cb={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹"};var y8,E2,x8,Fs=24,A2={};function Goe(){return y8||(y8=1,A2.read=function(m,h,g,x,C){var E,A,L=8*C-x-1,V=(1<<L)-1,H=V>>1,X=-7,K=g?C-1:0,ae=g?-1:1,ue=m[h+K];for(K+=ae,E=ue&(1<<-X)-1,ue>>=-X,X+=L;X>0;E=256*E+m[h+K],K+=ae,X-=8);for(A=E&(1<<-X)-1,E>>=-X,X+=x;X>0;A=256*A+m[h+K],K+=ae,X-=8);if(E===0)E=1-H;else{if(E===V)return A?NaN:1/0*(ue?-1:1);A+=Math.pow(2,x),E-=H}return(ue?-1:1)*A*Math.pow(2,E-x)},A2.write=function(m,h,g,x,C,E){var A,L,V,H=8*E-C-1,X=(1<<H)-1,K=X>>1,ae=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,ue=x?0:E-1,de=x?1:-1,ge=h<0||h===0&&1/h<0?1:0;for(h=Math.abs(h),isNaN(h)||h===1/0?(L=isNaN(h)?1:0,A=X):(A=Math.floor(Math.log(h)/Math.LN2),h*(V=Math.pow(2,-A))<1&&(A--,V*=2),(h+=A+K>=1?ae/V:ae*Math.pow(2,1-K))*V>=2&&(A++,V/=2),A+K>=X?(L=0,A=X):A+K>=1?(L=(h*V-1)*Math.pow(2,C),A+=K):(L=h*Math.pow(2,K-1)*Math.pow(2,C),A=0));C>=8;m[g+ue]=255&L,ue+=de,L/=256,C-=8);for(A=A<<C|L,H+=C;H>0;m[g+ue]=255&A,ue+=de,A/=256,H-=8);m[g+ue-de]|=128*ge}),A2}function b8(){if(x8)return E2;x8=1,E2=h;var m=Goe();function h(ce){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ce)?ce:new Uint8Array(ce||0),this.pos=0,this.type=0,this.length=this.buf.length}h.Varint=0,h.Fixed64=1,h.Bytes=2,h.Fixed32=5;var g=4294967296,x=1/g,C=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function E(ce){return ce.type===h.Bytes?ce.readVarint()+ce.pos:ce.pos+1}function A(ce,Me,Ue){return Ue?4294967296*Me+(ce>>>0):4294967296*(Me>>>0)+(ce>>>0)}function L(ce,Me,Ue){var yt=Me<=16383?1:Me<=2097151?2:Me<=268435455?3:Math.floor(Math.log(Me)/(7*Math.LN2));Ue.realloc(yt);for(var jt=Ue.pos-1;jt>=ce;jt--)Ue.buf[jt+yt]=Ue.buf[jt]}function V(ce,Me){for(var Ue=0;Ue<ce.length;Ue++)Me.writeVarint(ce[Ue])}function H(ce,Me){for(var Ue=0;Ue<ce.length;Ue++)Me.writeSVarint(ce[Ue])}function X(ce,Me){for(var Ue=0;Ue<ce.length;Ue++)Me.writeFloat(ce[Ue])}function K(ce,Me){for(var Ue=0;Ue<ce.length;Ue++)Me.writeDouble(ce[Ue])}function ae(ce,Me){for(var Ue=0;Ue<ce.length;Ue++)Me.writeBoolean(ce[Ue])}function ue(ce,Me){for(var Ue=0;Ue<ce.length;Ue++)Me.writeFixed32(ce[Ue])}function de(ce,Me){for(var Ue=0;Ue<ce.length;Ue++)Me.writeSFixed32(ce[Ue])}function ge(ce,Me){for(var Ue=0;Ue<ce.length;Ue++)Me.writeFixed64(ce[Ue])}function Te(ce,Me){for(var Ue=0;Ue<ce.length;Ue++)Me.writeSFixed64(ce[Ue])}function Ne(ce,Me){return(ce[Me]|ce[Me+1]<<8|ce[Me+2]<<16)+16777216*ce[Me+3]}function tt(ce,Me,Ue){ce[Ue]=Me,ce[Ue+1]=Me>>>8,ce[Ue+2]=Me>>>16,ce[Ue+3]=Me>>>24}function Ve(ce,Me){return(ce[Me]|ce[Me+1]<<8|ce[Me+2]<<16)+(ce[Me+3]<<24)}return h.prototype={destroy:function(){this.buf=null},readFields:function(ce,Me,Ue){for(Ue=Ue||this.length;this.pos<Ue;){var yt=this.readVarint(),jt=yt>>3,_t=this.pos;this.type=7&yt,ce(jt,Me,this),this.pos===_t&&this.skip(yt)}return Me},readMessage:function(ce,Me){return this.readFields(ce,Me,this.readVarint()+this.pos)},readFixed32:function(){var ce=Ne(this.buf,this.pos);return this.pos+=4,ce},readSFixed32:function(){var ce=Ve(this.buf,this.pos);return this.pos+=4,ce},readFixed64:function(){var ce=Ne(this.buf,this.pos)+Ne(this.buf,this.pos+4)*g;return this.pos+=8,ce},readSFixed64:function(){var ce=Ne(this.buf,this.pos)+Ve(this.buf,this.pos+4)*g;return this.pos+=8,ce},readFloat:function(){var ce=m.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ce},readDouble:function(){var ce=m.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ce},readVarint:function(ce){var Me,Ue,yt=this.buf;return Me=127&(Ue=yt[this.pos++]),Ue<128?Me:(Me|=(127&(Ue=yt[this.pos++]))<<7,Ue<128?Me:(Me|=(127&(Ue=yt[this.pos++]))<<14,Ue<128?Me:(Me|=(127&(Ue=yt[this.pos++]))<<21,Ue<128?Me:function(jt,_t,Et){var ri,Zt,si=Et.buf;if(ri=(112&(Zt=si[Et.pos++]))>>4,Zt<128||(ri|=(127&(Zt=si[Et.pos++]))<<3,Zt<128)||(ri|=(127&(Zt=si[Et.pos++]))<<10,Zt<128)||(ri|=(127&(Zt=si[Et.pos++]))<<17,Zt<128)||(ri|=(127&(Zt=si[Et.pos++]))<<24,Zt<128)||(ri|=(1&(Zt=si[Et.pos++]))<<31,Zt<128))return A(jt,ri,_t);throw new Error("Expected varint not more than 10 bytes")}(Me|=(15&(Ue=yt[this.pos]))<<28,ce,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ce=this.readVarint();return ce%2==1?(ce+1)/-2:ce/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ce=this.readVarint()+this.pos,Me=this.pos;return this.pos=ce,ce-Me>=12&&C?function(Ue,yt,jt){return C.decode(Ue.subarray(yt,jt))}(this.buf,Me,ce):function(Ue,yt,jt){for(var _t="",Et=yt;Et<jt;){var ri,Zt,si,Ft=Ue[Et],Ti=null,Ki=Ft>239?4:Ft>223?3:Ft>191?2:1;if(Et+Ki>jt)break;Ki===1?Ft<128&&(Ti=Ft):Ki===2?(192&(ri=Ue[Et+1]))==128&&(Ti=(31&Ft)<<6|63&ri)<=127&&(Ti=null):Ki===3?(Zt=Ue[Et+2],(192&(ri=Ue[Et+1]))==128&&(192&Zt)==128&&((Ti=(15&Ft)<<12|(63&ri)<<6|63&Zt)<=2047||Ti>=55296&&Ti<=57343)&&(Ti=null)):Ki===4&&(Zt=Ue[Et+2],si=Ue[Et+3],(192&(ri=Ue[Et+1]))==128&&(192&Zt)==128&&(192&si)==128&&((Ti=(15&Ft)<<18|(63&ri)<<12|(63&Zt)<<6|63&si)<=65535||Ti>=1114112)&&(Ti=null)),Ti===null?(Ti=65533,Ki=1):Ti>65535&&(Ti-=65536,_t+=String.fromCharCode(Ti>>>10&1023|55296),Ti=56320|1023&Ti),_t+=String.fromCharCode(Ti),Et+=Ki}return _t}(this.buf,Me,ce)},readBytes:function(){var ce=this.readVarint()+this.pos,Me=this.buf.subarray(this.pos,ce);return this.pos=ce,Me},readPackedVarint:function(ce,Me){if(this.type!==h.Bytes)return ce.push(this.readVarint(Me));var Ue=E(this);for(ce=ce||[];this.pos<Ue;)ce.push(this.readVarint(Me));return ce},readPackedSVarint:function(ce){if(this.type!==h.Bytes)return ce.push(this.readSVarint());var Me=E(this);for(ce=ce||[];this.pos<Me;)ce.push(this.readSVarint());return ce},readPackedBoolean:function(ce){if(this.type!==h.Bytes)return ce.push(this.readBoolean());var Me=E(this);for(ce=ce||[];this.pos<Me;)ce.push(this.readBoolean());return ce},readPackedFloat:function(ce){if(this.type!==h.Bytes)return ce.push(this.readFloat());var Me=E(this);for(ce=ce||[];this.pos<Me;)ce.push(this.readFloat());return ce},readPackedDouble:function(ce){if(this.type!==h.Bytes)return ce.push(this.readDouble());var Me=E(this);for(ce=ce||[];this.pos<Me;)ce.push(this.readDouble());return ce},readPackedFixed32:function(ce){if(this.type!==h.Bytes)return ce.push(this.readFixed32());var Me=E(this);for(ce=ce||[];this.pos<Me;)ce.push(this.readFixed32());return ce},readPackedSFixed32:function(ce){if(this.type!==h.Bytes)return ce.push(this.readSFixed32());var Me=E(this);for(ce=ce||[];this.pos<Me;)ce.push(this.readSFixed32());return ce},readPackedFixed64:function(ce){if(this.type!==h.Bytes)return ce.push(this.readFixed64());var Me=E(this);for(ce=ce||[];this.pos<Me;)ce.push(this.readFixed64());return ce},readPackedSFixed64:function(ce){if(this.type!==h.Bytes)return ce.push(this.readSFixed64());var Me=E(this);for(ce=ce||[];this.pos<Me;)ce.push(this.readSFixed64());return ce},skip:function(ce){var Me=7&ce;if(Me===h.Varint)for(;this.buf[this.pos++]>127;);else if(Me===h.Bytes)this.pos=this.readVarint()+this.pos;else if(Me===h.Fixed32)this.pos+=4;else{if(Me!==h.Fixed64)throw new Error("Unimplemented type: "+Me);this.pos+=8}},writeTag:function(ce,Me){this.writeVarint(ce<<3|Me)},realloc:function(ce){for(var Me=this.length||16;Me<this.pos+ce;)Me*=2;if(Me!==this.length){var Ue=new Uint8Array(Me);Ue.set(this.buf),this.buf=Ue,this.length=Me}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ce){this.realloc(4),tt(this.buf,ce,this.pos),this.pos+=4},writeSFixed32:function(ce){this.realloc(4),tt(this.buf,ce,this.pos),this.pos+=4},writeFixed64:function(ce){this.realloc(8),tt(this.buf,-1&ce,this.pos),tt(this.buf,Math.floor(ce*x),this.pos+4),this.pos+=8},writeSFixed64:function(ce){this.realloc(8),tt(this.buf,-1&ce,this.pos),tt(this.buf,Math.floor(ce*x),this.pos+4),this.pos+=8},writeVarint:function(ce){(ce=+ce||0)>268435455||ce<0?function(Me,Ue){var yt,jt;if(Me>=0?(yt=Me%4294967296|0,jt=Me/4294967296|0):(jt=~(-Me/4294967296),4294967295^(yt=~(-Me%4294967296))?yt=yt+1|0:(yt=0,jt=jt+1|0)),Me>=18446744073709552e3||Me<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Ue.realloc(10),function(_t,Et,ri){ri.buf[ri.pos++]=127&_t|128,_t>>>=7,ri.buf[ri.pos++]=127&_t|128,_t>>>=7,ri.buf[ri.pos++]=127&_t|128,_t>>>=7,ri.buf[ri.pos++]=127&_t|128,ri.buf[ri.pos]=127&(_t>>>=7)}(yt,0,Ue),function(_t,Et){var ri=(7&_t)<<4;Et.buf[Et.pos++]|=ri|((_t>>>=3)?128:0),_t&&(Et.buf[Et.pos++]=127&_t|((_t>>>=7)?128:0),_t&&(Et.buf[Et.pos++]=127&_t|((_t>>>=7)?128:0),_t&&(Et.buf[Et.pos++]=127&_t|((_t>>>=7)?128:0),_t&&(Et.buf[Et.pos++]=127&_t|((_t>>>=7)?128:0),_t&&(Et.buf[Et.pos++]=127&_t)))))}(jt,Ue)}(ce,this):(this.realloc(4),this.buf[this.pos++]=127&ce|(ce>127?128:0),ce<=127||(this.buf[this.pos++]=127&(ce>>>=7)|(ce>127?128:0),ce<=127||(this.buf[this.pos++]=127&(ce>>>=7)|(ce>127?128:0),ce<=127||(this.buf[this.pos++]=ce>>>7&127))))},writeSVarint:function(ce){this.writeVarint(ce<0?2*-ce-1:2*ce)},writeBoolean:function(ce){this.writeVarint(!!ce)},writeString:function(ce){ce=String(ce),this.realloc(4*ce.length),this.pos++;var Me=this.pos;this.pos=function(yt,jt,_t){for(var Et,ri,Zt=0;Zt<jt.length;Zt++){if((Et=jt.charCodeAt(Zt))>55295&&Et<57344){if(!ri){Et>56319||Zt+1===jt.length?(yt[_t++]=239,yt[_t++]=191,yt[_t++]=189):ri=Et;continue}if(Et<56320){yt[_t++]=239,yt[_t++]=191,yt[_t++]=189,ri=Et;continue}Et=ri-55296<<10|Et-56320|65536,ri=null}else ri&&(yt[_t++]=239,yt[_t++]=191,yt[_t++]=189,ri=null);Et<128?yt[_t++]=Et:(Et<2048?yt[_t++]=Et>>6|192:(Et<65536?yt[_t++]=Et>>12|224:(yt[_t++]=Et>>18|240,yt[_t++]=Et>>12&63|128),yt[_t++]=Et>>6&63|128),yt[_t++]=63&Et|128)}return _t}(this.buf,ce,this.pos);var Ue=this.pos-Me;Ue>=128&&L(Me,Ue,this),this.pos=Me-1,this.writeVarint(Ue),this.pos+=Ue},writeFloat:function(ce){this.realloc(4),m.write(this.buf,ce,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ce){this.realloc(8),m.write(this.buf,ce,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ce){var Me=ce.length;this.writeVarint(Me),this.realloc(Me);for(var Ue=0;Ue<Me;Ue++)this.buf[this.pos++]=ce[Ue]},writeRawMessage:function(ce,Me){this.pos++;var Ue=this.pos;ce(Me,this);var yt=this.pos-Ue;yt>=128&&L(Ue,yt,this),this.pos=Ue-1,this.writeVarint(yt),this.pos+=yt},writeMessage:function(ce,Me,Ue){this.writeTag(ce,h.Bytes),this.writeRawMessage(Me,Ue)},writePackedVarint:function(ce,Me){Me.length&&this.writeMessage(ce,V,Me)},writePackedSVarint:function(ce,Me){Me.length&&this.writeMessage(ce,H,Me)},writePackedBoolean:function(ce,Me){Me.length&&this.writeMessage(ce,ae,Me)},writePackedFloat:function(ce,Me){Me.length&&this.writeMessage(ce,X,Me)},writePackedDouble:function(ce,Me){Me.length&&this.writeMessage(ce,K,Me)},writePackedFixed32:function(ce,Me){Me.length&&this.writeMessage(ce,ue,Me)},writePackedSFixed32:function(ce,Me){Me.length&&this.writeMessage(ce,de,Me)},writePackedFixed64:function(ce,Me){Me.length&&this.writeMessage(ce,ge,Me)},writePackedSFixed64:function(ce,Me){Me.length&&this.writeMessage(ce,Te,Me)},writeBytesField:function(ce,Me){this.writeTag(ce,h.Bytes),this.writeBytes(Me)},writeFixed32Field:function(ce,Me){this.writeTag(ce,h.Fixed32),this.writeFixed32(Me)},writeSFixed32Field:function(ce,Me){this.writeTag(ce,h.Fixed32),this.writeSFixed32(Me)},writeFixed64Field:function(ce,Me){this.writeTag(ce,h.Fixed64),this.writeFixed64(Me)},writeSFixed64Field:function(ce,Me){this.writeTag(ce,h.Fixed64),this.writeSFixed64(Me)},writeVarintField:function(ce,Me){this.writeTag(ce,h.Varint),this.writeVarint(Me)},writeSVarintField:function(ce,Me){this.writeTag(ce,h.Varint),this.writeSVarint(Me)},writeStringField:function(ce,Me){this.writeTag(ce,h.Bytes),this.writeString(Me)},writeFloatField:function(ce,Me){this.writeTag(ce,h.Fixed32),this.writeFloat(Me)},writeDoubleField:function(ce,Me){this.writeTag(ce,h.Fixed64),this.writeDouble(Me)},writeBooleanField:function(ce,Me){this.writeVarintField(ce,!!Me)}},E2}var I2=l(b8());const k2=3;function Uoe(m,h,g){m===1&&g.readMessage(Hoe,h)}function Hoe(m,h,g){if(m===3){const{id:x,bitmap:C,width:E,height:A,left:L,top:V,advance:H}=g.readMessage($oe,{});h.push({id:x,bitmap:new fb({width:E+2*k2,height:A+2*k2},C),metrics:{width:E,height:A,left:L,top:V,advance:H}})}}function $oe(m,h,g){m===1?h.id=g.readVarint():m===2?h.bitmap=g.readBytes():m===3?h.width=g.readVarint():m===4?h.height=g.readVarint():m===5?h.left=g.readSVarint():m===6?h.top=g.readSVarint():m===7&&(h.advance=g.readVarint())}const Woe=k2;function w8(m){let h=0,g=0;for(const A of m)h+=A.w*A.h,g=Math.max(g,A.w);m.sort((A,L)=>L.h-A.h);const x=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(h/.95)),g),h:1/0}];let C=0,E=0;for(const A of m)for(let L=x.length-1;L>=0;L--){const V=x[L];if(!(A.w>V.w||A.h>V.h)){if(A.x=V.x,A.y=V.y,E=Math.max(E,A.y+A.h),C=Math.max(C,A.x+A.w),A.w===V.w&&A.h===V.h){const H=x.pop();L<x.length&&(x[L]=H)}else A.h===V.h?(V.x+=A.w,V.w-=A.w):A.w===V.w?(V.y+=A.h,V.h-=A.h):(x.push({x:V.x+A.w,y:V.y,w:V.w-A.w,h:A.h}),V.y+=A.h,V.h-=A.h);break}}return{w:C,h:E,fill:h/(C*E)||0}}const Ca=1;class D2{constructor(h,{pixelRatio:g,version:x,stretchX:C,stretchY:E,content:A,textFitWidth:L,textFitHeight:V}){this.paddedRect=h,this.pixelRatio=g,this.stretchX=C,this.stretchY=E,this.content=A,this.version=x,this.textFitWidth=L,this.textFitHeight=V}get tl(){return[this.paddedRect.x+Ca,this.paddedRect.y+Ca]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ca,this.paddedRect.y+this.paddedRect.h-Ca]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ca)/this.pixelRatio,(this.paddedRect.h-2*Ca)/this.pixelRatio]}}class _8{constructor(h,g){const x={},C={};this.haveRenderCallbacks=[];const E=[];this.addImages(h,x,E),this.addImages(g,C,E);const{w:A,h:L}=w8(E),V=new El({width:A||1,height:L||1});for(const H in h){const X=h[H],K=x[H].paddedRect;El.copy(X.data,V,{x:0,y:0},{x:K.x+Ca,y:K.y+Ca},X.data)}for(const H in g){const X=g[H],K=C[H].paddedRect,ae=K.x+Ca,ue=K.y+Ca,de=X.data.width,ge=X.data.height;El.copy(X.data,V,{x:0,y:0},{x:ae,y:ue},X.data),El.copy(X.data,V,{x:0,y:ge-1},{x:ae,y:ue-1},{width:de,height:1}),El.copy(X.data,V,{x:0,y:0},{x:ae,y:ue+ge},{width:de,height:1}),El.copy(X.data,V,{x:de-1,y:0},{x:ae-1,y:ue},{width:1,height:ge}),El.copy(X.data,V,{x:0,y:0},{x:ae+de,y:ue},{width:1,height:ge})}this.image=V,this.iconPositions=x,this.patternPositions=C}addImages(h,g,x){for(const C in h){const E=h[C],A={x:0,y:0,w:E.data.width+2*Ca,h:E.data.height+2*Ca};x.push(A),g[C]=new D2(A,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(C)}}patchUpdatedImages(h,g){h.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const x in h.updatedImages)this.patchUpdatedImage(this.iconPositions[x],h.getImage(x),g),this.patchUpdatedImage(this.patternPositions[x],h.getImage(x),g)}patchUpdatedImage(h,g,x){if(!h||!g||h.version===g.version)return;h.version=g.version;const[C,E]=h.tl;x.update(g.data,void 0,{x:C,y:E})}}var Pf;wi("ImagePosition",D2),wi("ImageAtlas",_8),o.ah=void 0,(Pf=o.ah||(o.ah={}))[Pf.none=0]="none",Pf[Pf.horizontal=1]="horizontal",Pf[Pf.vertical=2]="vertical",Pf[Pf.horizontalOnly=3]="horizontalOnly";const o1=-17;class Sb{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(h,g,x){const C=new Sb;return C.scale=h||1,C.fontStack=g,C.verticalAlign=x||"bottom",C}static forImage(h,g){const x=new Sb;return x.imageName=h,x.verticalAlign=g||"bottom",x}}class jv{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(h,g){const x=new jv;for(let C=0;C<h.sections.length;C++){const E=h.sections[C];E.image?x.addImageSection(E):x.addTextSection(E,g)}return x}length(){return this.text.length}getSection(h){return this.sections[this.sectionIndex[h]]}getSectionIndex(h){return this.sectionIndex[h]}getCharCode(h){return this.text.charCodeAt(h)}verticalizePunctuation(){this.text=function(h){let g="";for(let x=0;x<h.length;x++){const C=h.charCodeAt(x+1)||null,E=h.charCodeAt(x-1)||null;g+=C&&eb(C)&&!Cb[h[x+1]]||E&&eb(E)&&!Cb[h[x-1]]||!Cb[h[x]]?h[x]:Cb[h[x]]}return g}(this.text)}trim(){let h=0;for(let x=0;x<this.text.length&&l1[this.text.charCodeAt(x)];x++)h++;let g=this.text.length;for(let x=this.text.length-1;x>=0&&x>=h&&l1[this.text.charCodeAt(x)];x--)g--;this.text=this.text.substring(h,g),this.sectionIndex=this.sectionIndex.slice(h,g)}substring(h,g){const x=new jv;return x.text=this.text.substring(h,g),x.sectionIndex=this.sectionIndex.slice(h,g),x.sections=this.sections,x}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((h,g)=>Math.max(h,this.sections[g].scale),0)}getMaxImageSize(h){let g=0,x=0;for(let C=0;C<this.length();C++){const E=this.getSection(C);if(E.imageName){const A=h[E.imageName];if(!A)continue;const L=A.displaySize;g=Math.max(g,L[0]),x=Math.max(x,L[1])}}return{maxImageWidth:g,maxImageHeight:x}}addTextSection(h,g){this.text+=h.text,this.sections.push(Sb.forText(h.scale,h.fontStack||g,h.verticalAlign));const x=this.sections.length-1;for(let C=0;C<h.text.length;++C)this.sectionIndex.push(x)}addImageSection(h){const g=h.image?h.image.name:"";if(g.length===0)return void Jt("Can't add FormattedSection with an empty image.");const x=this.getNextImageSectionCharCode();x?(this.text+=String.fromCharCode(x),this.sections.push(Sb.forImage(g,h.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Jt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function a1(m,h,g,x,C,E,A,L,V,H,X,K,ae,ue,de){const ge=jv.fromFeature(m,C);let Te;K===o.ah.vertical&&ge.verticalizePunctuation();const{processBidirectionalText:Ne,processStyledBidirectionalText:tt}=iu;if(Ne&&ge.sections.length===1){Te=[];const Me=Ne(ge.toString(),L2(ge,H,E,h,x,ue));for(const Ue of Me){const yt=new jv;yt.text=Ue,yt.sections=ge.sections;for(let jt=0;jt<Ue.length;jt++)yt.sectionIndex.push(0);Te.push(yt)}}else if(tt){Te=[];const Me=tt(ge.text,ge.sectionIndex,L2(ge,H,E,h,x,ue));for(const Ue of Me){const yt=new jv;yt.text=Ue[0],yt.sectionIndex=Ue[1],yt.sections=ge.sections,Te.push(yt)}}else Te=function(Me,Ue){const yt=[],jt=Me.text;let _t=0;for(const Et of Ue)yt.push(Me.substring(_t,Et)),_t=Et;return _t<jt.length&&yt.push(Me.substring(_t,jt.length)),yt}(ge,L2(ge,H,E,h,x,ue));const Ve=[],ce={positionedLines:Ve,text:ge.toString(),top:X[1],bottom:X[1],left:X[0],right:X[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(Me,Ue,yt,jt,_t,Et,ri,Zt,si,Ft,Ti,Ki){let Wi=0,Ai=0,Ln=0,Qr=0;const Ns=Zt==="right"?1:Zt==="left"?0:.5,Oo=Fs/Ki;let Il=0;for(const Vr of _t){Vr.trim();const qs=Vr.getMaxScale(),so={positionedGlyphs:[],lineOffset:0};Me.positionedLines[Il]=so;const oo=so.positionedGlyphs;let ia=0;if(!Vr.length()){Ai+=Et,++Il;continue}const kl=Zoe(jt,Vr,Oo);for(let Oa=0;Oa<Vr.length();Oa++){const Bs=Vr.getSection(Oa),Qs=Vr.getSectionIndex(Oa),Zs=Vr.getCharCode(Oa),Ss=Xoe(si,Ti,Zs);let Pr;if(Bs.imageName){if(Me.iconsInText=!0,Bs.scale=Bs.scale*Oo,Pr=Yoe(Bs,Ss,qs,kl,jt),!Pr)continue;ia=Math.max(ia,Pr.imageOffset)}else if(Pr=Koe(Bs,Zs,Ss,kl,Ue,yt),!Pr)continue;const{rect:ou,metrics:Kv,baselineOffset:au}=Pr;oo.push({glyph:Zs,imageName:Bs.imageName,x:Wi,y:Ai+au+o1,vertical:Ss,scale:Bs.scale,fontStack:Bs.fontStack,sectionIndex:Qs,metrics:Kv,rect:ou}),Ss?(Me.verticalizable=!0,Wi+=(Bs.imageName?Kv.advance:Fs)*Bs.scale+Ft):Wi+=Kv.advance*Bs.scale+Ft}oo.length!==0&&(Ln=Math.max(Wi-Ft,Ln),Joe(oo,0,oo.length-1,Ns)),Wi=0,so.lineOffset=Math.max(ia,(qs-1)*Fs);const js=Et*qs+ia;Ai+=js,Qr=Math.max(js,Qr),++Il}const{horizontalAlign:Sa,verticalAlign:ro}=F2(ri);(function(Vr,qs,so,oo,ia,kl,js,Oa,Bs){const Qs=(qs-so)*ia;let Zs=0;Zs=kl!==js?-Oa*oo-o1:-oo*Bs*js+.5*js;for(const Ss of Vr)for(const Pr of Ss.positionedGlyphs)Pr.x+=Qs,Pr.y+=Zs})(Me.positionedLines,Ns,Sa,ro,Ln,Qr,Et,Ai,_t.length),Me.top+=-ro*Ai,Me.bottom=Me.top+Ai,Me.left+=-Sa*Ln,Me.right=Me.left+Ln}(ce,h,g,x,Te,A,L,V,K,H,ae,de),!function(Me){for(const Ue of Me)if(Ue.positionedGlyphs.length!==0)return!1;return!0}(Ve)&&ce}const l1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qoe={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},joe={40:!0};function C8(m,h,g,x,C,E){if(h.imageName){const A=x[h.imageName];return A?A.displaySize[0]*h.scale*Fs/E+C:0}{const A=g[h.fontStack],L=A&&A[m];return L?L.metrics.advance*h.scale+C:0}}function S8(m,h,g,x){const C=Math.pow(m-h,2);return x?m<h?C/2:2*C:C+Math.abs(g)*g}function Qoe(m,h,g){let x=0;return m===10&&(x-=1e4),g&&(x+=150),m!==40&&m!==65288||(x+=50),h!==41&&h!==65289||(x+=50),x}function O8(m,h,g,x,C,E){let A=null,L=S8(h,g,C,E);for(const V of x){const H=S8(h-V.x,g,C,E)+V.badness;H<=L&&(A=V,L=H)}return{index:m,x:h,priorBreak:A,badness:L}}function M8(m){return m?M8(m.priorBreak).concat(m.index):[]}function L2(m,h,g,x,C,E){if(!m)return[];const A=[],L=function(K,ae,ue,de,ge,Te){let Ne=0;for(let tt=0;tt<K.length();tt++){const Ve=K.getSection(tt);Ne+=C8(K.getCharCode(tt),Ve,de,ge,ae,Te)}return Ne/Math.max(1,Math.ceil(Ne/ue))}(m,h,g,x,C,E),V=m.text.indexOf("â")>=0;let H=0;for(let K=0;K<m.length();K++){const ae=m.getSection(K),ue=m.getCharCode(K);if(l1[ue]||(H+=C8(ue,ae,x,C,h,E)),K<m.length()-1){const de=!((X=ue)<11904)&&(!!An["CJK Compatibility Forms"](X)||!!An["CJK Compatibility"](X)||!!An["CJK Strokes"](X)||!!An["CJK Symbols and Punctuation"](X)||!!An["Enclosed CJK Letters and Months"](X)||!!An["Halfwidth and Fullwidth Forms"](X)||!!An["Ideographic Description Characters"](X)||!!An["Vertical Forms"](X)||Yx.test(String.fromCodePoint(X)));(qoe[ue]||de||ae.imageName||K!==m.length()-2&&joe[m.getCharCode(K+1)])&&A.push(O8(K+1,H,L,A,Qoe(ue,m.getCharCode(K+1),de&&V),!1))}}var X;return M8(O8(m.length(),H,L,A,0,!0))}function F2(m){let h=.5,g=.5;switch(m){case"right":case"top-right":case"bottom-right":h=1;break;case"left":case"top-left":case"bottom-left":h=0}switch(m){case"bottom":case"bottom-right":case"bottom-left":g=1;break;case"top":case"top-right":case"top-left":g=0}return{horizontalAlign:h,verticalAlign:g}}function Zoe(m,h,g){const x=h.getMaxScale()*Fs,{maxImageWidth:C,maxImageHeight:E}=h.getMaxImageSize(m),A=Math.max(x,E*g);return{verticalLineContentWidth:Math.max(x,C*g),horizontalLineContentHeight:A}}function T8(m){switch(m){case"top":return 0;case"center":return .5;default:return 1}}function Xoe(m,h,g){return!(m===o.ah.horizontal||!h&&!Jx(g)||h&&(l1[g]||(x=g,/\p{sc=Arab}/u.test(String.fromCodePoint(x)))));var x}function Koe(m,h,g,x,C,E){const A=E[m.fontStack],L=function(H,X,K,ae){if(H&&H.rect)return H;const ue=X[K.fontStack],de=ue&&ue[ae];return de?{rect:null,metrics:de.metrics}:null}(A&&A[h],C,m,h);if(L===null)return null;let V;if(g)V=x.verticalLineContentWidth-m.scale*Fs;else{const H=T8(m.verticalAlign);V=(x.horizontalLineContentHeight-m.scale*Fs)*H}return{rect:L.rect,metrics:L.metrics,baselineOffset:V}}function Yoe(m,h,g,x,C){const E=C[m.imageName];if(!E)return null;const A=E.paddedRect,L=E.displaySize,V={width:L[0],height:L[1],left:Ca,top:-3,advance:h?L[1]:L[0]};let H;if(h)H=x.verticalLineContentWidth-L[1]*m.scale;else{const X=T8(m.verticalAlign);H=(x.horizontalLineContentHeight-L[1]*m.scale)*X}return{rect:A,metrics:V,baselineOffset:H,imageOffset:(h?L[0]:L[1])*m.scale-Fs*g}}function Joe(m,h,g,x){if(x===0)return;const C=m[g],E=(m[g].x+C.metrics.advance*C.scale)*x;for(let A=h;A<=g;A++)m[A].x-=E}function eae(m,h,g){const{horizontalAlign:x,verticalAlign:C}=F2(g),E=h[0]-m.displaySize[0]*x,A=h[1]-m.displaySize[1]*C;return{image:m,top:A,bottom:A+m.displaySize[1],left:E,right:E+m.displaySize[0]}}function R8(m){var h,g;let x=m.left,C=m.top,E=m.right-x,A=m.bottom-C;const L=(h=m.image.textFitWidth)!==null&&h!==void 0?h:"stretchOrShrink",V=(g=m.image.textFitHeight)!==null&&g!==void 0?g:"stretchOrShrink",H=(m.image.content[2]-m.image.content[0])/(m.image.content[3]-m.image.content[1]);if(V==="proportional"){if(L==="stretchOnly"&&E/A<H||L==="proportional"){const X=Math.ceil(A*H);x*=X/E,E=X}}else if(L==="proportional"&&V==="stretchOnly"&&H!==0&&E/A>H){const X=Math.ceil(E/H);C*=X/A,A=X}return{x1:x,y1:C,x2:x+E,y2:C+A}}function P8(m,h,g,x,C,E){const A=m.image;let L;if(A.content){const Te=A.content,Ne=A.pixelRatio||1;L=[Te[0]/Ne,Te[1]/Ne,A.displaySize[0]-Te[2]/Ne,A.displaySize[1]-Te[3]/Ne]}const V=h.left*E,H=h.right*E;let X,K,ae,ue;g==="width"||g==="both"?(ue=C[0]+V-x[3],K=C[0]+H+x[1]):(ue=C[0]+(V+H-A.displaySize[0])/2,K=ue+A.displaySize[0]);const de=h.top*E,ge=h.bottom*E;return g==="height"||g==="both"?(X=C[1]+de-x[0],ae=C[1]+ge+x[2]):(X=C[1]+(de+ge-A.displaySize[1])/2,ae=X+A.displaySize[1]),{image:A,top:X,right:K,bottom:ae,left:ue,collisionPadding:L}}const Ob=255,Hu=128,Ef=Ob*Hu;function E8(m,h){const{expression:g}=h;if(g.kind==="constant")return{kind:"constant",layoutSize:g.evaluate(new Tr(m+1))};if(g.kind==="source")return{kind:"source"};{const{zoomStops:x,interpolationType:C}=g;let E=0;for(;E<x.length&&x[E]<=m;)E++;E=Math.max(0,E-1);let A=E;for(;A<x.length&&x[A]<m+1;)A++;A=Math.min(x.length-1,A);const L=x[E],V=x[A];return g.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:V,interpolationType:C}:{kind:"camera",minZoom:L,maxZoom:V,minSize:g.evaluate(new Tr(L)),maxSize:g.evaluate(new Tr(V)),interpolationType:C}}}function N2(m,h,g){let x="never";const C=m.get(h);return C?x=C:m.get(g)&&(x="always"),x}const tae=bb.VectorTileFeature.types,iae=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function c1(m,h,g,x,C,E,A,L,V,H,X,K,ae){const ue=L?Math.min(Ef,Math.round(L[0])):0,de=L?Math.min(Ef,Math.round(L[1])):0;m.emplaceBack(h,g,Math.round(32*x),Math.round(32*C),E,A,(ue<<1)+(V?1:0),de,16*H,16*X,256*K,256*ae)}function B2(m,h,g){m.emplaceBack(h.x,h.y,g),m.emplaceBack(h.x,h.y,g),m.emplaceBack(h.x,h.y,g),m.emplaceBack(h.x,h.y,g)}function nae(m){for(const h of m.sections)if(u2(h.text))return!0;return!1}class z2{constructor(h){this.layoutVertexArray=new Dt,this.indexArray=new Ht,this.programConfigurations=h,this.segments=new bn,this.dynamicLayoutVertexArray=new Bt,this.opacityVertexArray=new It,this.hasVisibleVertices=!1,this.placedSymbolArray=new J}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(h,g,x,C){this.isEmpty()||(x&&(this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,Foe.members),this.indexBuffer=h.createIndexBuffer(this.indexArray,g),this.dynamicLayoutVertexBuffer=h.createVertexBuffer(this.dynamicLayoutVertexArray,Noe.members,!0),this.opacityVertexBuffer=h.createVertexBuffer(this.opacityVertexArray,iae,!0),this.opacityVertexBuffer.itemSize=1),(x||C)&&this.programConfigurations.upload(h))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}wi("SymbolBuffers",z2);class V2{constructor(h,g,x){this.layoutVertexArray=new h,this.layoutAttributes=g,this.indexArray=new x,this.segments=new bn,this.collisionVertexArray=new ui}upload(h){this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=h.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=h.createVertexBuffer(this.collisionVertexArray,Boe.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}wi("CollisionBuffers",V2);class Qv{constructor(h){this.collisionBoxArray=h.collisionBoxArray,this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map(A=>A.id),this.index=h.index,this.pixelRatio=h.pixelRatio,this.sourceLayerIndex=h.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const g=this.layers[0]._unevaluatedLayout._values;this.textSizeData=E8(this.zoom,g["text-size"]),this.iconSizeData=E8(this.zoom,g["icon-size"]);const x=this.layers[0].layout,C=x.get("symbol-sort-key"),E=x.get("symbol-z-order");this.canOverlap=N2(x,"text-overlap","text-allow-overlap")!=="never"||N2(x,"icon-overlap","icon-allow-overlap")!=="never"||x.get("text-ignore-placement")||x.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!C.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,x.get("symbol-placement")==="point"&&(this.writingModes=x.get("text-writing-mode").map(A=>o.ah[A])),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.sourceID=h.sourceID}createArrays(){this.text=new z2(new sd(this.layers,this.zoom,h=>/^text/.test(h))),this.icon=new z2(new sd(this.layers,this.zoom,h=>/^icon/.test(h))),this.glyphOffsetArray=new pe,this.lineVertexArray=new ye,this.symbolInstances=new ne,this.textAnchorOffsets=new Ee}calculateGlyphDependencies(h,g,x,C,E){for(let A=0;A<h.length;A++)if(g[h.charCodeAt(A)]=!0,(x||C)&&E){const L=Cb[h.charAt(A)];L&&(g[L.charCodeAt(0)]=!0)}}populate(h,g,x){const C=this.layers[0],E=C.layout,A=E.get("text-font"),L=E.get("text-field"),V=E.get("icon-image"),H=(L.value.kind!=="constant"||L.value.value instanceof Lo&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),X=V.value.kind!=="constant"||!!V.value.value||Object.keys(V.parameters).length>0,K=E.get("symbol-sort-key");if(this.features=[],!H&&!X)return;const ae=g.iconDependencies,ue=g.glyphDependencies,de=g.availableImages,ge=new Tr(this.zoom);for(const{feature:Te,id:Ne,index:tt,sourceLayerIndex:Ve}of h){const ce=C._featureFilter.needGeometry,Me=Uu(Te,ce);if(!C._featureFilter.filter(ge,Me,x))continue;let Ue,yt;if(ce||(Me.geometry=Gu(Te)),H){const _t=C.getValueAndResolveTokens("text-field",Me,x,de),Et=Lo.factory(_t),ri=this.hasRTLText=this.hasRTLText||nae(Et);(!ri||iu.getRTLTextPluginStatus()==="unavailable"||ri&&iu.isParsed())&&(Ue=Voe(Et,C,Me))}if(X){const _t=C.getValueAndResolveTokens("icon-image",Me,x,de);yt=_t instanceof Ko?_t:Ko.fromString(_t)}if(!Ue&&!yt)continue;const jt=this.sortFeaturesByKey?K.evaluate(Me,{},x):void 0;if(this.features.push({id:Ne,text:Ue,icon:yt,index:tt,sourceLayerIndex:Ve,geometry:Me.geometry,properties:Te.properties,type:tae[Te.type],sortKey:jt}),yt&&(ae[yt.name]=!0),Ue){const _t=A.evaluate(Me,{},x).join(","),Et=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.ah.vertical)>=0;for(const ri of Ue.sections)if(ri.image)ae[ri.image.name]=!0;else{const Zt=Lv(Ue.toString()),si=ri.fontStack||_t,Ft=ue[si]=ue[si]||{};this.calculateGlyphDependencies(ri.text,Ft,Et,this.allowVerticalPlacement,Zt)}}}E.get("symbol-placement")==="line"&&(this.features=function(Te){const Ne={},tt={},Ve=[];let ce=0;function Me(_t){Ve.push(Te[_t]),ce++}function Ue(_t,Et,ri){const Zt=tt[_t];return delete tt[_t],tt[Et]=Zt,Ve[Zt].geometry[0].pop(),Ve[Zt].geometry[0]=Ve[Zt].geometry[0].concat(ri[0]),Zt}function yt(_t,Et,ri){const Zt=Ne[Et];return delete Ne[Et],Ne[_t]=Zt,Ve[Zt].geometry[0].shift(),Ve[Zt].geometry[0]=ri[0].concat(Ve[Zt].geometry[0]),Zt}function jt(_t,Et,ri){const Zt=ri?Et[0][Et[0].length-1]:Et[0][0];return`${_t}:${Zt.x}:${Zt.y}`}for(let _t=0;_t<Te.length;_t++){const Et=Te[_t],ri=Et.geometry,Zt=Et.text?Et.text.toString():null;if(!Zt){Me(_t);continue}const si=jt(Zt,ri),Ft=jt(Zt,ri,!0);if(si in tt&&Ft in Ne&&tt[si]!==Ne[Ft]){const Ti=yt(si,Ft,ri),Ki=Ue(si,Ft,Ve[Ti].geometry);delete Ne[si],delete tt[Ft],tt[jt(Zt,Ve[Ki].geometry,!0)]=Ki,Ve[Ti].geometry=null}else si in tt?Ue(si,Ft,ri):Ft in Ne?yt(si,Ft,ri):(Me(_t),Ne[si]=ce-1,tt[Ft]=ce-1)}return Ve.filter(_t=>_t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Te,Ne)=>Te.sortKey-Ne.sortKey)}update(h,g,x){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(h,g,this.layers,x),this.icon.programConfigurations.updatePaintArrays(h,g,this.layers,x))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(h){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(h),this.iconCollisionBox.upload(h)),this.text.upload(h,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(h,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(h,g){const x=this.lineVertexArray.length;if(h.segment!==void 0){let C=h.dist(g[h.segment+1]),E=h.dist(g[h.segment]);const A={};for(let L=h.segment+1;L<g.length;L++)A[L]={x:g[L].x,y:g[L].y,tileUnitDistanceFromAnchor:C},L<g.length-1&&(C+=g[L+1].dist(g[L]));for(let L=h.segment||0;L>=0;L--)A[L]={x:g[L].x,y:g[L].y,tileUnitDistanceFromAnchor:E},L>0&&(E+=g[L-1].dist(g[L]));for(let L=0;L<g.length;L++){const V=A[L];this.lineVertexArray.emplaceBack(V.x,V.y,V.tileUnitDistanceFromAnchor)}}return{lineStartIndex:x,lineLength:this.lineVertexArray.length-x}}addSymbols(h,g,x,C,E,A,L,V,H,X,K,ae){const ue=h.indexArray,de=h.layoutVertexArray,ge=h.segments.prepareSegment(4*g.length,de,ue,this.canOverlap?A.sortKey:void 0),Te=this.glyphOffsetArray.length,Ne=ge.vertexLength,tt=this.allowVerticalPlacement&&L===o.ah.vertical?Math.PI/2:0,Ve=A.text&&A.text.sections;for(let ce=0;ce<g.length;ce++){const{tl:Me,tr:Ue,bl:yt,br:jt,tex:_t,pixelOffsetTL:Et,pixelOffsetBR:ri,minFontScaleX:Zt,minFontScaleY:si,glyphOffset:Ft,isSDF:Ti,sectionIndex:Ki}=g[ce],Wi=ge.vertexLength,Ai=Ft[1];c1(de,V.x,V.y,Me.x,Ai+Me.y,_t.x,_t.y,x,Ti,Et.x,Et.y,Zt,si),c1(de,V.x,V.y,Ue.x,Ai+Ue.y,_t.x+_t.w,_t.y,x,Ti,ri.x,Et.y,Zt,si),c1(de,V.x,V.y,yt.x,Ai+yt.y,_t.x,_t.y+_t.h,x,Ti,Et.x,ri.y,Zt,si),c1(de,V.x,V.y,jt.x,Ai+jt.y,_t.x+_t.w,_t.y+_t.h,x,Ti,ri.x,ri.y,Zt,si),B2(h.dynamicLayoutVertexArray,V,tt),ue.emplaceBack(Wi,Wi+2,Wi+1),ue.emplaceBack(Wi+1,Wi+2,Wi+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ft[0]),ce!==g.length-1&&Ki===g[ce+1].sectionIndex||h.programConfigurations.populatePaintArrays(de.length,A,A.index,{},ae,Ve&&Ve[Ki])}h.placedSymbolArray.emplaceBack(V.x,V.y,Te,this.glyphOffsetArray.length-Te,Ne,H,X,V.segment,x?x[0]:0,x?x[1]:0,C[0],C[1],L,0,!1,0,K)}_addCollisionDebugVertex(h,g,x,C,E,A){return g.emplaceBack(0,0),h.emplaceBack(x.x,x.y,C,E,Math.round(A.x),Math.round(A.y))}addCollisionDebugVertices(h,g,x,C,E,A,L){const V=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),H=V.vertexLength,X=E.layoutVertexArray,K=E.collisionVertexArray,ae=L.anchorX,ue=L.anchorY;this._addCollisionDebugVertex(X,K,A,ae,ue,new w(h,g)),this._addCollisionDebugVertex(X,K,A,ae,ue,new w(x,g)),this._addCollisionDebugVertex(X,K,A,ae,ue,new w(x,C)),this._addCollisionDebugVertex(X,K,A,ae,ue,new w(h,C)),V.vertexLength+=4;const de=E.indexArray;de.emplaceBack(H,H+1),de.emplaceBack(H+1,H+2),de.emplaceBack(H+2,H+3),de.emplaceBack(H+3,H),V.primitiveLength+=4}addDebugCollisionBoxes(h,g,x,C){for(let E=h;E<g;E++){const A=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,C?this.textCollisionBox:this.iconCollisionBox,A.anchorPoint,x)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new V2(di,v8.members,Ri),this.iconCollisionBox=new V2(di,v8.members,Ri);for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h);this.addDebugCollisionBoxes(g.textBoxStartIndex,g.textBoxEndIndex,g,!0),this.addDebugCollisionBoxes(g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g,!0),this.addDebugCollisionBoxes(g.iconBoxStartIndex,g.iconBoxEndIndex,g,!1),this.addDebugCollisionBoxes(g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g,!1)}}_deserializeCollisionBoxesForSymbol(h,g,x,C,E,A,L,V,H){const X={};for(let K=g;K<x;K++){const ae=h.get(K);X.textBox={x1:ae.x1,y1:ae.y1,x2:ae.x2,y2:ae.y2,anchorPointX:ae.anchorPointX,anchorPointY:ae.anchorPointY},X.textFeatureIndex=ae.featureIndex;break}for(let K=C;K<E;K++){const ae=h.get(K);X.verticalTextBox={x1:ae.x1,y1:ae.y1,x2:ae.x2,y2:ae.y2,anchorPointX:ae.anchorPointX,anchorPointY:ae.anchorPointY},X.verticalTextFeatureIndex=ae.featureIndex;break}for(let K=A;K<L;K++){const ae=h.get(K);X.iconBox={x1:ae.x1,y1:ae.y1,x2:ae.x2,y2:ae.y2,anchorPointX:ae.anchorPointX,anchorPointY:ae.anchorPointY},X.iconFeatureIndex=ae.featureIndex;break}for(let K=V;K<H;K++){const ae=h.get(K);X.verticalIconBox={x1:ae.x1,y1:ae.y1,x2:ae.x2,y2:ae.y2,anchorPointX:ae.anchorPointX,anchorPointY:ae.anchorPointY},X.verticalIconFeatureIndex=ae.featureIndex;break}return X}deserializeCollisionBoxes(h){this.collisionArrays=[];for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(h,x.textBoxStartIndex,x.textBoxEndIndex,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x.iconBoxStartIndex,x.iconBoxEndIndex,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(h,g){const x=h.placedSymbolArray.get(g),C=x.vertexStartIndex+4*x.numGlyphs;for(let E=x.vertexStartIndex;E<C;E+=4)h.indexArray.emplaceBack(E,E+2,E+1),h.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(h){if(this.sortedAngle===h&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const g=Math.sin(h),x=Math.cos(h),C=[],E=[],A=[];for(let L=0;L<this.symbolInstances.length;++L){A.push(L);const V=this.symbolInstances.get(L);C.push(0|Math.round(g*V.anchorX+x*V.anchorY)),E.push(V.featureIndex)}return A.sort((L,V)=>C[L]-C[V]||E[V]-E[L]),A}addToSortKeyRanges(h,g){const x=this.sortKeyRanges[this.sortKeyRanges.length-1];x&&x.sortKey===g?x.symbolInstanceEnd=h+1:this.sortKeyRanges.push({sortKey:g,symbolInstanceStart:h,symbolInstanceEnd:h+1})}sortFeatures(h){if(this.sortFeaturesByY&&this.sortedAngle!==h&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(h),this.sortedAngle=h,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const g of this.symbolInstanceIndexes){const x=this.symbolInstances.get(g);this.featureSortOrder.push(x.featureIndex),[x.rightJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.leftJustifiedTextSymbolIndex].forEach((C,E,A)=>{C>=0&&A.indexOf(C)===E&&this.addIndicesForPlacedSymbol(this.text,C)}),x.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,x.verticalPlacedTextSymbolIndex),x.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.placedIconSymbolIndex),x.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let A8,I8;wi("SymbolBucket",Qv,{omit:["layers","collisionBoxArray","features","compareText"]}),Qv.MAX_GLYPHS=65535,Qv.addDynamicAttributes=B2;var G2={get paint(){return I8=I8||new ea({"icon-opacity":new Ji(ee.paint_symbol["icon-opacity"]),"icon-color":new Ji(ee.paint_symbol["icon-color"]),"icon-halo-color":new Ji(ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ji(ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ji(ee.paint_symbol["icon-halo-blur"]),"icon-translate":new zi(ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new zi(ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ji(ee.paint_symbol["text-opacity"]),"text-color":new Ji(ee.paint_symbol["text-color"],{runtimeType:dn,getOverride:m=>m.textColor,hasOverride:m=>!!m.textColor}),"text-halo-color":new Ji(ee.paint_symbol["text-halo-color"]),"text-halo-width":new Ji(ee.paint_symbol["text-halo-width"]),"text-halo-blur":new Ji(ee.paint_symbol["text-halo-blur"]),"text-translate":new zi(ee.paint_symbol["text-translate"]),"text-translate-anchor":new zi(ee.paint_symbol["text-translate-anchor"])})},get layout(){return A8=A8||new ea({"symbol-placement":new zi(ee.layout_symbol["symbol-placement"]),"symbol-spacing":new zi(ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zi(ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ji(ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zi(ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new zi(ee.layout_symbol["icon-allow-overlap"]),"icon-overlap":new zi(ee.layout_symbol["icon-overlap"]),"icon-ignore-placement":new zi(ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new zi(ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zi(ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ji(ee.layout_symbol["icon-size"]),"icon-text-fit":new zi(ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zi(ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ji(ee.layout_symbol["icon-image"]),"icon-rotate":new Ji(ee.layout_symbol["icon-rotate"]),"icon-padding":new Ji(ee.layout_symbol["icon-padding"]),"icon-keep-upright":new zi(ee.layout_symbol["icon-keep-upright"]),"icon-offset":new Ji(ee.layout_symbol["icon-offset"]),"icon-anchor":new Ji(ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zi(ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zi(ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zi(ee.layout_symbol["text-rotation-alignment"]),"text-field":new Ji(ee.layout_symbol["text-field"]),"text-font":new Ji(ee.layout_symbol["text-font"]),"text-size":new Ji(ee.layout_symbol["text-size"]),"text-max-width":new Ji(ee.layout_symbol["text-max-width"]),"text-line-height":new zi(ee.layout_symbol["text-line-height"]),"text-letter-spacing":new Ji(ee.layout_symbol["text-letter-spacing"]),"text-justify":new Ji(ee.layout_symbol["text-justify"]),"text-radial-offset":new Ji(ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zi(ee.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ji(ee.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ji(ee.layout_symbol["text-anchor"]),"text-max-angle":new zi(ee.layout_symbol["text-max-angle"]),"text-writing-mode":new zi(ee.layout_symbol["text-writing-mode"]),"text-rotate":new Ji(ee.layout_symbol["text-rotate"]),"text-padding":new zi(ee.layout_symbol["text-padding"]),"text-keep-upright":new zi(ee.layout_symbol["text-keep-upright"]),"text-transform":new Ji(ee.layout_symbol["text-transform"]),"text-offset":new Ji(ee.layout_symbol["text-offset"]),"text-allow-overlap":new zi(ee.layout_symbol["text-allow-overlap"]),"text-overlap":new zi(ee.layout_symbol["text-overlap"]),"text-ignore-placement":new zi(ee.layout_symbol["text-ignore-placement"]),"text-optional":new zi(ee.layout_symbol["text-optional"])})}};class k8{constructor(h){if(h.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=h.property.overrides?h.property.overrides.runtimeType:Pn,this.defaultValue=h}evaluate(h){if(h.formattedSection){const g=this.defaultValue.property.overrides;if(g&&g.hasOverride(h.formattedSection))return g.getOverride(h.formattedSection)}return h.feature&&h.featureState?this.defaultValue.evaluate(h.feature,h.featureState):this.defaultValue.property.specification.default}eachChild(h){this.defaultValue.isConstant()||h(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}wi("FormatSectionOverride",k8,{omit:["defaultValue"]});class u1 extends No{constructor(h){super(h,G2)}recalculate(h,g){if(super.recalculate(h,g),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const x=this.layout.get("text-writing-mode");if(x){const C=[];for(const E of x)C.indexOf(E)<0&&C.push(E);this.layout._values["text-writing-mode"]=C}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(h,g,x,C){const E=this.layout.get(h).evaluate(g,{},x,C),A=this._unevaluatedLayout._values[h];return A.isDataDriven()||im(A.value)||!E?E:function(L,V){return V.replace(/{([^{}]+)}/g,(H,X)=>L&&X in L?String(L[X]):"")}(g.properties,E)}createBucket(h){return new Qv(h)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const h of G2.paint.overridableProperties){if(!u1.hasPaintOverride(this.layout,h))continue;const g=this.paint.get(h),x=new k8(g),C=new xf(x,g.property.specification);let E=null;E=g.value.kind==="constant"||g.value.kind==="source"?new Vx("source",C):new Gx("composite",C,g.value.zoomStops),this.paint._values[h]=new dc(g.property,E,g.parameters)}}_handleOverridablePaintPropertyUpdate(h,g,x){return!(!this.layout||g.isDataDriven()||x.isDataDriven())&&u1.hasPaintOverride(this.layout,h)}static hasPaintOverride(h,g){const x=h.get("text-field"),C=G2.paint.properties[g];let E=!1;const A=L=>{for(const V of L)if(C.overrides&&C.overrides.hasOverride(V))return void(E=!0)};if(x.value.kind==="constant"&&x.value.value instanceof Lo)A(x.value.value.sections);else if(x.value.kind==="source"){const L=H=>{E||(H instanceof Lu&&kr(H.value)===wr?A(H.value.sections):H instanceof df?A(H.sections):H.eachChild(L))},V=x.value;V._styleExpression&&L(V._styleExpression.expression)}return E}}let D8;var rae={get paint(){return D8=D8||new ea({"background-color":new zi(ee.paint_background["background-color"]),"background-pattern":new ib(ee.paint_background["background-pattern"]),"background-opacity":new zi(ee.paint_background["background-opacity"])})}};class sae extends No{constructor(h){super(h,rae)}}let L8;var oae={get paint(){return L8=L8||new ea({"raster-opacity":new zi(ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new zi(ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zi(ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zi(ee.paint_raster["raster-brightness-max"]),"raster-saturation":new zi(ee.paint_raster["raster-saturation"]),"raster-contrast":new zi(ee.paint_raster["raster-contrast"]),"raster-resampling":new zi(ee.paint_raster["raster-resampling"]),"raster-fade-duration":new zi(ee.paint_raster["raster-fade-duration"])})}};class aae extends No{constructor(h){super(h,oae)}}class lae extends No{constructor(h){super(h,{}),this.onAdd=g=>{this.implementation.onAdd&&this.implementation.onAdd(g,g.painter.context.gl)},this.onRemove=g=>{this.implementation.onRemove&&this.implementation.onRemove(g,g.painter.context.gl)},this.implementation=h}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class cae{constructor(h){this._methodToThrottle=h,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const uae={once:!0},U2=63710088e-1;class Af{constructor(h,g){if(isNaN(h)||isNaN(g))throw new Error(`Invalid LngLat object: (${h}, ${g})`);if(this.lng=+h,this.lat=+g,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Af(Ge(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(h){const g=Math.PI/180,x=this.lat*g,C=h.lat*g,E=Math.sin(x)*Math.sin(C)+Math.cos(x)*Math.cos(C)*Math.cos((h.lng-this.lng)*g);return U2*Math.acos(Math.min(E,1))}static convert(h){if(h instanceof Af)return h;if(Array.isArray(h)&&(h.length===2||h.length===3))return new Af(Number(h[0]),Number(h[1]));if(!Array.isArray(h)&&typeof h=="object"&&h!==null)return new Af(Number("lng"in h?h.lng:h.lon),Number(h.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const F8=2*Math.PI*U2;function N8(m){return F8*Math.cos(m*Math.PI/180)}function B8(m){return(180+m)/360}function z8(m){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+m*Math.PI/360)))/360}function V8(m,h){return m/N8(h)}function H2(m){return 360/Math.PI*Math.atan(Math.exp((180-360*m)*Math.PI/180))-90}function G8(m,h){return m*N8(H2(h))}class Mb{constructor(h,g,x=0){this.x=+h,this.y=+g,this.z=+x}static fromLngLat(h,g=0){const x=Af.convert(h);return new Mb(B8(x.lng),z8(x.lat),V8(g,x.lat))}toLngLat(){return new Af(360*this.x-180,H2(this.y))}toAltitude(){return G8(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/F8*(h=H2(this.y),1/Math.cos(h*Math.PI/180));var h}}function U8(m,h,g){var x=2*Math.PI*6378137/256/Math.pow(2,g);return[m*x-2*Math.PI*6378137/2,h*x-2*Math.PI*6378137/2]}class $2{constructor(h,g,x){if(!function(C,E,A){return!(C<0||C>25||A<0||A>=Math.pow(2,C)||E<0||E>=Math.pow(2,C))}(h,g,x))throw new Error(`x=${g}, y=${x}, z=${h} outside of bounds. 0<=x<${Math.pow(2,h)}, 0<=y<${Math.pow(2,h)} 0<=z<=25 `);this.z=h,this.x=g,this.y=x,this.key=Zv(0,h,h,g,x)}equals(h){return this.z===h.z&&this.x===h.x&&this.y===h.y}url(h,g,x){const C=(A=this.y,L=this.z,V=U8(256*(E=this.x),256*(A=Math.pow(2,L)-A-1),L),H=U8(256*(E+1),256*(A+1),L),V[0]+","+V[1]+","+H[0]+","+H[1]);var E,A,L,V,H;const X=function(K,ae,ue){let de,ge="";for(let Te=K;Te>0;Te--)de=1<<Te-1,ge+=(ae&de?1:0)+(ue&de?2:0);return ge}(this.z,this.x,this.y);return h[(this.x+this.y)%h.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(x==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,g>1?"@2x":"").replace(/{quadkey}/g,X).replace(/{bbox-epsg-3857}/g,C)}isChildOf(h){const g=this.z-h.z;return g>0&&h.x===this.x>>g&&h.y===this.y>>g}getTilePoint(h){const g=Math.pow(2,this.z);return new w((h.x*g-this.x)*me,(h.y*g-this.y)*me)}toString(){return`${this.z}/${this.x}/${this.y}`}}class H8{constructor(h,g){this.wrap=h,this.canonical=g,this.key=Zv(h,g.z,g.z,g.x,g.y)}}class Al{constructor(h,g,x,C,E){if(this.terrainRttPosMatrix32f=null,h<x)throw new Error(`overscaledZ should be >= z; overscaledZ = ${h}; z = ${x}`);this.overscaledZ=h,this.wrap=g,this.canonical=new $2(x,+C,+E),this.key=Zv(g,h,x,C,E)}clone(){return new Al(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(h){return this.overscaledZ===h.overscaledZ&&this.wrap===h.wrap&&this.canonical.equals(h.canonical)}scaledTo(h){if(h>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${h}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-h;return h>this.canonical.z?new Al(h,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Al(h,this.wrap,h,this.canonical.x>>g,this.canonical.y>>g)}calculateScaledKey(h,g){if(h>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${h}; overscaledZ = ${this.overscaledZ}`);const x=this.canonical.z-h;return h>this.canonical.z?Zv(this.wrap*+g,h,this.canonical.z,this.canonical.x,this.canonical.y):Zv(this.wrap*+g,h,h,this.canonical.x>>x,this.canonical.y>>x)}isChildOf(h){if(h.wrap!==this.wrap)return!1;const g=this.canonical.z-h.canonical.z;return h.overscaledZ===0||h.overscaledZ<this.overscaledZ&&h.canonical.x===this.canonical.x>>g&&h.canonical.y===this.canonical.y>>g}children(h){if(this.overscaledZ>=h)return[new Al(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const g=this.canonical.z+1,x=2*this.canonical.x,C=2*this.canonical.y;return[new Al(g,this.wrap,g,x,C),new Al(g,this.wrap,g,x+1,C),new Al(g,this.wrap,g,x,C+1),new Al(g,this.wrap,g,x+1,C+1)]}isLessThan(h){return this.wrap<h.wrap||!(this.wrap>h.wrap)&&(this.overscaledZ<h.overscaledZ||!(this.overscaledZ>h.overscaledZ)&&(this.canonical.x<h.canonical.x||!(this.canonical.x>h.canonical.x)&&this.canonical.y<h.canonical.y))}wrapped(){return new Al(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(h){return new Al(this.overscaledZ,h,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new H8(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(h){return this.canonical.getTilePoint(new Mb(h.x-this.wrap,h.y))}}function Zv(m,h,g,x,C){(m*=2)<0&&(m=-1*m-1);const E=1<<g;return(E*E*m+E*C+x).toString(36)+g.toString(36)+h.toString(36)}wi("CanonicalTileID",$2),wi("OverscaledTileID",Al,{omit:["terrainRttPosMatrix32f"]});class $8{constructor(h,g,x,C=1,E=1,A=1,L=0){if(this.uid=h,g.height!==g.width)throw new RangeError("DEM tiles must be square");if(x&&!["mapbox","terrarium","custom"].includes(x))return void Jt(`"${x}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=g.height;const V=this.dim=g.height-2;switch(this.data=new Uint32Array(g.data.buffer),x){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=C,this.greenFactor=E,this.blueFactor=A,this.baseShift=L;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let H=0;H<V;H++)this.data[this._idx(-1,H)]=this.data[this._idx(0,H)],this.data[this._idx(V,H)]=this.data[this._idx(V-1,H)],this.data[this._idx(H,-1)]=this.data[this._idx(H,0)],this.data[this._idx(H,V)]=this.data[this._idx(H,V-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(V,-1)]=this.data[this._idx(V-1,0)],this.data[this._idx(-1,V)]=this.data[this._idx(0,V-1)],this.data[this._idx(V,V)]=this.data[this._idx(V-1,V-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let H=0;H<V;H++)for(let X=0;X<V;X++){const K=this.get(H,X);K>this.max&&(this.max=K),K<this.min&&(this.min=K)}}get(h,g){const x=new Uint8Array(this.data.buffer),C=4*this._idx(h,g);return this.unpack(x[C],x[C+1],x[C+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(h,g){if(h<-1||h>=this.dim+1||g<-1||g>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(g+1)*this.stride+(h+1)}unpack(h,g,x){return h*this.redFactor+g*this.greenFactor+x*this.blueFactor-this.baseShift}getPixels(){return new El({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(h,g,x){if(this.dim!==h.dim)throw new Error("dem dimension mismatch");let C=g*this.dim,E=g*this.dim+this.dim,A=x*this.dim,L=x*this.dim+this.dim;switch(g){case-1:C=E-1;break;case 1:E=C+1}switch(x){case-1:A=L-1;break;case 1:L=A+1}const V=-g*this.dim,H=-x*this.dim;for(let X=A;X<L;X++)for(let K=C;K<E;K++)this.data[this._idx(K,X)]=h.data[this._idx(K+V,X+H)]}}wi("DEMData",$8);class W8{constructor(h){this._stringToNumber={},this._numberToString=[];for(let g=0;g<h.length;g++){const x=h[g];this._stringToNumber[x]=g,this._numberToString[g]=x}}encode(h){return this._stringToNumber[h]}decode(h){if(h>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${h} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[h]}}class q8{constructor(h,g,x,C,E){this.type="Feature",this._vectorTileFeature=h,h._z=g,h._x=x,h._y=C,this.properties=h.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(h){this._geometry=h}toJSON(){const h={geometry:this.geometry};for(const g in this)g!=="_geometry"&&g!=="_vectorTileFeature"&&(h[g]=this[g]);return h}}class j8{constructor(h,g){this.tileID=h,this.x=h.canonical.x,this.y=h.canonical.y,this.z=h.canonical.z,this.grid=new om(me,16,0),this.grid3D=new om(me,16,0),this.featureIndexArray=new ze,this.promoteId=g}insert(h,g,x,C,E,A){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(x,C,E);const V=A?this.grid3D:this.grid;for(let H=0;H<g.length;H++){const X=g[H],K=[1/0,1/0,-1/0,-1/0];for(let ae=0;ae<X.length;ae++){const ue=X[ae];K[0]=Math.min(K[0],ue.x),K[1]=Math.min(K[1],ue.y),K[2]=Math.max(K[2],ue.x),K[3]=Math.max(K[3],ue.y)}K[0]<me&&K[1]<me&&K[2]>=0&&K[3]>=0&&V.insert(L,K[0],K[1],K[2],K[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new bb.VectorTile(new I2(this.rawTileData)).layers,this.sourceLayerCoder=new W8(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(h,g,x,C){this.loadVTLayers();const E=h.params,A=me/h.tileSize/h.scale,L=Ux(E.filter),V=h.queryGeometry,H=h.queryPadding*A,X=Z8(V),K=this.grid.query(X.minX-H,X.minY-H,X.maxX+H,X.maxY+H),ae=Z8(h.cameraQueryGeometry),ue=this.grid3D.query(ae.minX-H,ae.minY-H,ae.maxX+H,ae.maxY+H,(Te,Ne,tt,Ve)=>function(ce,Me,Ue,yt,jt){for(const Et of ce)if(Me<=Et.x&&Ue<=Et.y&&yt>=Et.x&&jt>=Et.y)return!0;const _t=[new w(Me,Ue),new w(Me,jt),new w(yt,jt),new w(yt,Ue)];if(ce.length>2){for(const Et of _t)if(mm(ce,Et))return!0}for(let Et=0;Et<ce.length-1;Et++)if(Yse(ce[Et],ce[Et+1],_t))return!0;return!1}(h.cameraQueryGeometry,Te-H,Ne-H,tt+H,Ve+H));for(const Te of ue)K.push(Te);K.sort(hae);const de={};let ge;for(let Te=0;Te<K.length;Te++){const Ne=K[Te];if(Ne===ge)continue;ge=Ne;const tt=this.featureIndexArray.get(Ne);let Ve=null;this.loadMatchingFeature(de,tt.bucketIndex,tt.sourceLayerIndex,tt.featureIndex,L,E.layers,E.availableImages,g,x,C,(ce,Me,Ue)=>(Ve||(Ve=Gu(ce)),Me.queryIntersectsFeature({queryGeometry:V,feature:ce,featureState:Ue,geometry:Ve,zoom:this.z,transform:h.transform,pixelsToTileUnits:A,pixelPosMatrix:h.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:h.getElevation})))}return de}loadMatchingFeature(h,g,x,C,E,A,L,V,H,X,K){const ae=this.bucketLayerIDs[g];if(A&&!ae.some(Te=>A.has(Te)))return;const ue=this.sourceLayerCoder.decode(x),de=this.vtLayers[ue].feature(C);if(E.needGeometry){const Te=Uu(de,!0);if(!E.filter(new Tr(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!E.filter(new Tr(this.tileID.overscaledZ),de))return;const ge=this.getId(de,ue);for(let Te=0;Te<ae.length;Te++){const Ne=ae[Te];if(A&&!A.has(Ne))continue;const tt=V[Ne];if(!tt)continue;let Ve={};ge&&X&&(Ve=X.getState(tt.sourceLayer||"_geojsonTileLayer",ge));const ce=Je({},H[Ne]);ce.paint=Q8(ce.paint,tt.paint,de,Ve,L),ce.layout=Q8(ce.layout,tt.layout,de,Ve,L);const Me=!K||K(de,tt,Ve);if(!Me)continue;const Ue=new q8(de,this.z,this.x,this.y,ge);Ue.layer=ce;let yt=h[Ne];yt===void 0&&(yt=h[Ne]=[]),yt.push({featureIndex:C,feature:Ue,intersectionZ:Me})}}lookupSymbolFeatures(h,g,x,C,E,A,L,V){const H={};this.loadVTLayers();const X=Ux(E);for(const K of h)this.loadMatchingFeature(H,x,C,K,X,A,L,V,g);return H}hasLayer(h){for(const g of this.bucketLayerIDs)for(const x of g)if(h===x)return!0;return!1}getId(h,g){var x;let C=h.id;return this.promoteId&&(C=h.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[g]],typeof C=="boolean"&&(C=Number(C)),C===void 0&&(!((x=h.properties)===null||x===void 0)&&x.cluster)&&this.promoteId&&(C=Number(h.properties.cluster_id))),C}}function Q8(m,h,g,x,C){return wt(m,(E,A)=>{const L=h instanceof um?h.get(A):null;return L&&L.evaluate?L.evaluate(g,x,C):L})}function Z8(m){let h=1/0,g=1/0,x=-1/0,C=-1/0;for(const E of m)h=Math.min(h,E.x),g=Math.min(g,E.y),x=Math.max(x,E.x),C=Math.max(C,E.y);return{minX:h,minY:g,maxX:x,maxY:C}}function hae(m,h){return h-m}function X8(m,h,g,x,C){const E=[];for(let A=0;A<m.length;A++){const L=m[A];let V;for(let H=0;H<L.length-1;H++){let X=L[H],K=L[H+1];X.x<h&&K.x<h||(X.x<h?X=new w(h,X.y+(h-X.x)/(K.x-X.x)*(K.y-X.y))._round():K.x<h&&(K=new w(h,X.y+(h-X.x)/(K.x-X.x)*(K.y-X.y))._round()),X.y<g&&K.y<g||(X.y<g?X=new w(X.x+(g-X.y)/(K.y-X.y)*(K.x-X.x),g)._round():K.y<g&&(K=new w(X.x+(g-X.y)/(K.y-X.y)*(K.x-X.x),g)._round()),X.x>=x&&K.x>=x||(X.x>=x?X=new w(x,X.y+(x-X.x)/(K.x-X.x)*(K.y-X.y))._round():K.x>=x&&(K=new w(x,X.y+(x-X.x)/(K.x-X.x)*(K.y-X.y))._round()),X.y>=C&&K.y>=C||(X.y>=C?X=new w(X.x+(C-X.y)/(K.y-X.y)*(K.x-X.x),C)._round():K.y>=C&&(K=new w(X.x+(C-X.y)/(K.y-X.y)*(K.x-X.x),C)._round()),V&&X.equals(V[V.length-1])||(V=[X],E.push(V)),V.push(K)))))}}return E}wi("FeatureIndex",j8,{omit:["rawTileData","sourceLayerCoder"]});class If extends w{constructor(h,g,x,C){super(h,g),this.angle=x,C!==void 0&&(this.segment=C)}clone(){return new If(this.x,this.y,this.angle,this.segment)}}function K8(m,h,g,x,C){if(h.segment===void 0||g===0)return!0;let E=h,A=h.segment+1,L=0;for(;L>-g/2;){if(A--,A<0)return!1;L-=m[A].dist(E),E=m[A]}L+=m[A].dist(m[A+1]),A++;const V=[];let H=0;for(;L<g/2;){const X=m[A],K=m[A+1];if(!K)return!1;let ae=m[A-1].angleTo(X)-X.angleTo(K);for(ae=Math.abs((ae+3*Math.PI)%(2*Math.PI)-Math.PI),V.push({distance:L,angleDelta:ae}),H+=ae;L-V[0].distance>x;)H-=V.shift().angleDelta;if(H>C)return!1;A++,L+=X.dist(K)}return!0}function Y8(m){let h=0;for(let g=0;g<m.length-1;g++)h+=m[g].dist(m[g+1]);return h}function J8(m,h,g){return m?.6*h*g:0}function e4(m,h){return Math.max(m?m.right-m.left:0,h?h.right-h.left:0)}function dae(m,h,g,x,C,E){const A=J8(g,C,E),L=e4(g,x)*E;let V=0;const H=Y8(m)/2;for(let X=0;X<m.length-1;X++){const K=m[X],ae=m[X+1],ue=K.dist(ae);if(V+ue>H){const de=(H-V)/ue,ge=Rl.number(K.x,ae.x,de),Te=Rl.number(K.y,ae.y,de),Ne=new If(ge,Te,ae.angleTo(K),X);return Ne._round(),!A||K8(m,Ne,L,A,h)?Ne:void 0}V+=ue}}function fae(m,h,g,x,C,E,A,L,V){const H=J8(x,E,A),X=e4(x,C),K=X*A,ae=m[0].x===0||m[0].x===V||m[0].y===0||m[0].y===V;return h-K<h/4&&(h=K+h/4),t4(m,ae?h/2*L%h:(X/2+2*E)*A*L%h,h,H,g,K,ae,!1,V)}function t4(m,h,g,x,C,E,A,L,V){const H=E/2,X=Y8(m);let K=0,ae=h-g,ue=[];for(let de=0;de<m.length-1;de++){const ge=m[de],Te=m[de+1],Ne=ge.dist(Te),tt=Te.angleTo(ge);for(;ae+g<K+Ne;){ae+=g;const Ve=(ae-K)/Ne,ce=Rl.number(ge.x,Te.x,Ve),Me=Rl.number(ge.y,Te.y,Ve);if(ce>=0&&ce<V&&Me>=0&&Me<V&&ae-H>=0&&ae+H<=X){const Ue=new If(ce,Me,tt,de);Ue._round(),x&&!K8(m,Ue,E,x,C)||ue.push(Ue)}}K+=Ne}return L||ue.length||A||(ue=t4(m,K/2,g,x,C,E,A,!0,V)),ue}wi("Anchor",If);const Tb=Ca;function i4(m,h,g,x){const C=[],E=m.image,A=E.pixelRatio,L=E.paddedRect.w-2*Tb,V=E.paddedRect.h-2*Tb;let H={x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};const X=E.stretchX||[[0,L]],K=E.stretchY||[[0,V]],ae=(Ft,Ti)=>Ft+Ti[1]-Ti[0],ue=X.reduce(ae,0),de=K.reduce(ae,0),ge=L-ue,Te=V-de;let Ne=0,tt=ue,Ve=0,ce=de,Me=0,Ue=ge,yt=0,jt=Te;if(E.content&&x){const Ft=E.content,Ti=Ft[2]-Ft[0],Ki=Ft[3]-Ft[1];(E.textFitWidth||E.textFitHeight)&&(H=R8(m)),Ne=h1(X,0,Ft[0]),Ve=h1(K,0,Ft[1]),tt=h1(X,Ft[0],Ft[2]),ce=h1(K,Ft[1],Ft[3]),Me=Ft[0]-Ne,yt=Ft[1]-Ve,Ue=Ti-tt,jt=Ki-ce}const _t=H.x1,Et=H.y1,ri=H.x2-_t,Zt=H.y2-Et,si=(Ft,Ti,Ki,Wi)=>{const Ai=d1(Ft.stretch-Ne,tt,ri,_t),Ln=f1(Ft.fixed-Me,Ue,Ft.stretch,ue),Qr=d1(Ti.stretch-Ve,ce,Zt,Et),Ns=f1(Ti.fixed-yt,jt,Ti.stretch,de),Oo=d1(Ki.stretch-Ne,tt,ri,_t),Il=f1(Ki.fixed-Me,Ue,Ki.stretch,ue),Sa=d1(Wi.stretch-Ve,ce,Zt,Et),ro=f1(Wi.fixed-yt,jt,Wi.stretch,de),Vr=new w(Ai,Qr),qs=new w(Oo,Qr),so=new w(Oo,Sa),oo=new w(Ai,Sa),ia=new w(Ln/A,Ns/A),kl=new w(Il/A,ro/A),js=h*Math.PI/180;if(js){const Qs=Math.sin(js),Zs=Math.cos(js),Ss=[Zs,-Qs,Qs,Zs];Vr._matMult(Ss),qs._matMult(Ss),oo._matMult(Ss),so._matMult(Ss)}const Oa=Ft.stretch+Ft.fixed,Bs=Ti.stretch+Ti.fixed;return{tl:Vr,tr:qs,bl:oo,br:so,tex:{x:E.paddedRect.x+Tb+Oa,y:E.paddedRect.y+Tb+Bs,w:Ki.stretch+Ki.fixed-Oa,h:Wi.stretch+Wi.fixed-Bs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ia,pixelOffsetBR:kl,minFontScaleX:Ue/A/ri,minFontScaleY:jt/A/Zt,isSDF:g}};if(x&&(E.stretchX||E.stretchY)){const Ft=n4(X,ge,ue),Ti=n4(K,Te,de);for(let Ki=0;Ki<Ft.length-1;Ki++){const Wi=Ft[Ki],Ai=Ft[Ki+1];for(let Ln=0;Ln<Ti.length-1;Ln++)C.push(si(Wi,Ti[Ln],Ai,Ti[Ln+1]))}}else C.push(si({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:V+1}));return C}function h1(m,h,g){let x=0;for(const C of m)x+=Math.max(h,Math.min(g,C[1]))-Math.max(h,Math.min(g,C[0]));return x}function n4(m,h,g){const x=[{fixed:-1,stretch:0}];for(const[C,E]of m){const A=x[x.length-1];x.push({fixed:C-A.stretch,stretch:A.stretch}),x.push({fixed:C-A.stretch,stretch:A.stretch+(E-C)})}return x.push({fixed:h+Tb,stretch:g}),x}function d1(m,h,g,x){return m/h*g+x}function f1(m,h,g,x){return m-h*g/x}class p1{constructor(h,g,x,C,E,A,L,V,H,X){var K;if(this.boxStartIndex=h.length,H){let ae=A.top,ue=A.bottom;const de=A.collisionPadding;de&&(ae-=de[1],ue+=de[3]);let ge=ue-ae;ge>0&&(ge=Math.max(10,ge),this.circleDiameter=ge)}else{const ae=!((K=A.image)===null||K===void 0)&&K.content&&(A.image.textFitWidth||A.image.textFitHeight)?R8(A):{x1:A.left,y1:A.top,x2:A.right,y2:A.bottom};ae.y1=ae.y1*L-V[0],ae.y2=ae.y2*L+V[2],ae.x1=ae.x1*L-V[3],ae.x2=ae.x2*L+V[1];const ue=A.collisionPadding;if(ue&&(ae.x1-=ue[0]*L,ae.y1-=ue[1]*L,ae.x2+=ue[2]*L,ae.y2+=ue[3]*L),X){const de=new w(ae.x1,ae.y1),ge=new w(ae.x2,ae.y1),Te=new w(ae.x1,ae.y2),Ne=new w(ae.x2,ae.y2),tt=X*Math.PI/180;de._rotate(tt),ge._rotate(tt),Te._rotate(tt),Ne._rotate(tt),ae.x1=Math.min(de.x,ge.x,Te.x,Ne.x),ae.x2=Math.max(de.x,ge.x,Te.x,Ne.x),ae.y1=Math.min(de.y,ge.y,Te.y,Ne.y),ae.y2=Math.max(de.y,ge.y,Te.y,Ne.y)}h.emplaceBack(g.x,g.y,ae.x1,ae.y1,ae.x2,ae.y2,x,C,E)}this.boxEndIndex=h.length}}class pae{constructor(h=[],g=(x,C)=>x<C?-1:x>C?1:0){if(this.data=h,this.length=this.data.length,this.compare=g,this.length>0)for(let x=(this.length>>1)-1;x>=0;x--)this._down(x)}push(h){this.data.push(h),this._up(this.length++)}pop(){if(this.length===0)return;const h=this.data[0],g=this.data.pop();return--this.length>0&&(this.data[0]=g,this._down(0)),h}peek(){return this.data[0]}_up(h){const{data:g,compare:x}=this,C=g[h];for(;h>0;){const E=h-1>>1,A=g[E];if(x(C,A)>=0)break;g[h]=A,h=E}g[h]=C}_down(h){const{data:g,compare:x}=this,C=this.length>>1,E=g[h];for(;h<C;){let A=1+(h<<1);const L=A+1;if(L<this.length&&x(g[L],g[A])<0&&(A=L),x(g[A],E)>=0)break;g[h]=g[A],h=A}g[h]=E}}function mae(m,h=1,g=!1){let x=1/0,C=1/0,E=-1/0,A=-1/0;const L=m[0];for(let ue=0;ue<L.length;ue++){const de=L[ue];(!ue||de.x<x)&&(x=de.x),(!ue||de.y<C)&&(C=de.y),(!ue||de.x>E)&&(E=de.x),(!ue||de.y>A)&&(A=de.y)}const V=Math.min(E-x,A-C);let H=V/2;const X=new pae([],gae);if(V===0)return new w(x,C);for(let ue=x;ue<E;ue+=V)for(let de=C;de<A;de+=V)X.push(new Xv(ue+H,de+H,H,m));let K=function(ue){let de=0,ge=0,Te=0;const Ne=ue[0];for(let tt=0,Ve=Ne.length,ce=Ve-1;tt<Ve;ce=tt++){const Me=Ne[tt],Ue=Ne[ce],yt=Me.x*Ue.y-Ue.x*Me.y;ge+=(Me.x+Ue.x)*yt,Te+=(Me.y+Ue.y)*yt,de+=3*yt}return new Xv(ge/de,Te/de,0,ue)}(m),ae=X.length;for(;X.length;){const ue=X.pop();(ue.d>K.d||!K.d)&&(K=ue,g&&console.log("found best %d after %d probes",Math.round(1e4*ue.d)/1e4,ae)),ue.max-K.d<=h||(H=ue.h/2,X.push(new Xv(ue.p.x-H,ue.p.y-H,H,m)),X.push(new Xv(ue.p.x+H,ue.p.y-H,H,m)),X.push(new Xv(ue.p.x-H,ue.p.y+H,H,m)),X.push(new Xv(ue.p.x+H,ue.p.y+H,H,m)),ae+=4)}return g&&(console.log(`num probes: ${ae}`),console.log(`best distance: ${K.d}`)),K.p}function gae(m,h){return h.max-m.max}function Xv(m,h,g,x){this.p=new w(m,h),this.h=g,this.d=function(C,E){let A=!1,L=1/0;for(let V=0;V<E.length;V++){const H=E[V];for(let X=0,K=H.length,ae=K-1;X<K;ae=X++){const ue=H[X],de=H[ae];ue.y>C.y!=de.y>C.y&&C.x<(de.x-ue.x)*(C.y-ue.y)/(de.y-ue.y)+ue.x&&(A=!A),L=Math.min(L,N5(C,ue,de))}}return(A?1:-1)*Math.sqrt(L)}(this.p,x),this.max=this.d+this.h*Math.SQRT2}var So;o.ay=void 0,(So=o.ay||(o.ay={}))[So.center=1]="center",So[So.left=2]="left",So[So.right=3]="right",So[So.top=4]="top",So[So.bottom=5]="bottom",So[So["top-left"]=6]="top-left",So[So["top-right"]=7]="top-right",So[So["bottom-left"]=8]="bottom-left",So[So["bottom-right"]=9]="bottom-right";const kf=7,W2=Number.POSITIVE_INFINITY;function r4(m,h){return h[1]!==W2?function(g,x,C){let E=0,A=0;switch(x=Math.abs(x),C=Math.abs(C),g){case"top-right":case"top-left":case"top":A=C-kf;break;case"bottom-right":case"bottom-left":case"bottom":A=-C+kf}switch(g){case"top-right":case"bottom-right":case"right":E=-x;break;case"top-left":case"bottom-left":case"left":E=x}return[E,A]}(m,h[0],h[1]):function(g,x){let C=0,E=0;x<0&&(x=0);const A=x/Math.SQRT2;switch(g){case"top-right":case"top-left":E=A-kf;break;case"bottom-right":case"bottom-left":E=-A+kf;break;case"bottom":E=-x+kf;break;case"top":E=x-kf}switch(g){case"top-right":case"bottom-right":C=-A;break;case"top-left":case"bottom-left":C=A;break;case"left":C=x;break;case"right":C=-x}return[C,E]}(m,h[0])}function s4(m,h,g){var x;const C=m.layout,E=(x=C.get("text-variable-anchor-offset"))===null||x===void 0?void 0:x.evaluate(h,{},g);if(E){const L=E.values,V=[];for(let H=0;H<L.length;H+=2){const X=V[H]=L[H],K=L[H+1].map(ae=>ae*Fs);X.startsWith("top")?K[1]-=kf:X.startsWith("bottom")&&(K[1]+=kf),V[H+1]=K}return new Fo(V)}const A=C.get("text-variable-anchor");if(A){let L;L=m._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[C.get("text-radial-offset").evaluate(h,{},g)*Fs,W2]:C.get("text-offset").evaluate(h,{},g).map(H=>H*Fs);const V=[];for(const H of A)V.push(H,r4(H,L));return new Fo(V)}return null}function q2(m){switch(m){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function vae(m,h,g,x,C,E,A,L,V,H,X,K){let ae=E.textMaxSize.evaluate(h,{});ae===void 0&&(ae=A);const ue=m.layers[0].layout,de=ue.get("icon-offset").evaluate(h,{},X),ge=a4(g.horizontal),Te=A/24,Ne=m.tilePixelRatio*Te,tt=m.tilePixelRatio*ae/24,Ve=m.tilePixelRatio*L,ce=m.tilePixelRatio*ue.get("symbol-spacing"),Me=ue.get("text-padding")*m.tilePixelRatio,Ue=function(Ki,Wi,Ai,Ln=1){const Qr=Ki.get("icon-padding").evaluate(Wi,{},Ai),Ns=Qr&&Qr.values;return[Ns[0]*Ln,Ns[1]*Ln,Ns[2]*Ln,Ns[3]*Ln]}(ue,h,X,m.tilePixelRatio),yt=ue.get("text-max-angle")/180*Math.PI,jt=ue.get("text-rotation-alignment")!=="viewport"&&ue.get("symbol-placement")!=="point",_t=ue.get("icon-rotation-alignment")==="map"&&ue.get("symbol-placement")!=="point",Et=ue.get("symbol-placement"),ri=ce/2,Zt=ue.get("icon-text-fit");let si;x&&Zt!=="none"&&(m.allowVerticalPlacement&&g.vertical&&(si=P8(x,g.vertical,Zt,ue.get("icon-text-fit-padding"),de,Te)),ge&&(x=P8(x,ge,Zt,ue.get("icon-text-fit-padding"),de,Te)));const Ft=X?K.line.getGranularityForZoomLevel(X.z):1,Ti=(Ki,Wi)=>{Wi.x<0||Wi.x>=me||Wi.y<0||Wi.y>=me||function(Ai,Ln,Qr,Ns,Oo,Il,Sa,ro,Vr,qs,so,oo,ia,kl,js,Oa,Bs,Qs,Zs,Ss,Pr,ou,Kv,au,bae){const Yv=Ai.addToLineVertexArray(Ln,Qr);let ym,Jv,ey,ty,h4=0,d4=0,f4=0,p4=0,eF=-1,tF=-1;const od={};let m4=nu("");if(Ai.allowVerticalPlacement&&Ns.vertical){const Bo=ro.layout.get("text-rotate").evaluate(Pr,{},au)+90;ey=new p1(Vr,Ln,qs,so,oo,Ns.vertical,ia,kl,js,Bo),Sa&&(ty=new p1(Vr,Ln,qs,so,oo,Sa,Bs,Qs,js,Bo))}if(Oo){const Bo=ro.layout.get("icon-rotate").evaluate(Pr,{}),Dl=ro.layout.get("icon-text-fit")!=="none",xm=i4(Oo,Bo,Kv,Dl),cu=Sa?i4(Sa,Bo,Kv,Dl):void 0;Jv=new p1(Vr,Ln,qs,so,oo,Oo,Bs,Qs,!1,Bo),h4=4*xm.length;const bm=Ai.iconSizeData;let $u=null;bm.kind==="source"?($u=[Hu*ro.layout.get("icon-size").evaluate(Pr,{})],$u[0]>Ef&&Jt(`${Ai.layerIds[0]}: Value for "icon-size" is >= ${Ob}. Reduce your "icon-size".`)):bm.kind==="composite"&&($u=[Hu*ou.compositeIconSizes[0].evaluate(Pr,{},au),Hu*ou.compositeIconSizes[1].evaluate(Pr,{},au)],($u[0]>Ef||$u[1]>Ef)&&Jt(`${Ai.layerIds[0]}: Value for "icon-size" is >= ${Ob}. Reduce your "icon-size".`)),Ai.addSymbols(Ai.icon,xm,$u,Ss,Zs,Pr,o.ah.none,Ln,Yv.lineStartIndex,Yv.lineLength,-1,au),eF=Ai.icon.placedSymbolArray.length-1,cu&&(d4=4*cu.length,Ai.addSymbols(Ai.icon,cu,$u,Ss,Zs,Pr,o.ah.vertical,Ln,Yv.lineStartIndex,Yv.lineLength,-1,au),tF=Ai.icon.placedSymbolArray.length-1)}const g4=Object.keys(Ns.horizontal);for(const Bo of g4){const Dl=Ns.horizontal[Bo];if(!ym){m4=nu(Dl.text);const cu=ro.layout.get("text-rotate").evaluate(Pr,{},au);ym=new p1(Vr,Ln,qs,so,oo,Dl,ia,kl,js,cu)}const xm=Dl.positionedLines.length===1;if(f4+=o4(Ai,Ln,Dl,Il,ro,js,Pr,Oa,Yv,Ns.vertical?o.ah.horizontal:o.ah.horizontalOnly,xm?g4:[Bo],od,eF,ou,au),xm)break}Ns.vertical&&(p4+=o4(Ai,Ln,Ns.vertical,Il,ro,js,Pr,Oa,Yv,o.ah.vertical,["vertical"],od,tF,ou,au));const wae=ym?ym.boxStartIndex:Ai.collisionBoxArray.length,_ae=ym?ym.boxEndIndex:Ai.collisionBoxArray.length,Cae=ey?ey.boxStartIndex:Ai.collisionBoxArray.length,Sae=ey?ey.boxEndIndex:Ai.collisionBoxArray.length,Oae=Jv?Jv.boxStartIndex:Ai.collisionBoxArray.length,Mae=Jv?Jv.boxEndIndex:Ai.collisionBoxArray.length,Tae=ty?ty.boxStartIndex:Ai.collisionBoxArray.length,Rae=ty?ty.boxEndIndex:Ai.collisionBoxArray.length;let lu=-1;const g1=(Bo,Dl)=>Bo&&Bo.circleDiameter?Math.max(Bo.circleDiameter,Dl):Dl;lu=g1(ym,lu),lu=g1(ey,lu),lu=g1(Jv,lu),lu=g1(ty,lu);const v4=lu>-1?1:0;v4&&(lu*=bae/Fs),Ai.glyphOffsetArray.length>=Qv.MAX_GLYPHS&&Jt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Pr.sortKey!==void 0&&Ai.addToSortKeyRanges(Ai.symbolInstances.length,Pr.sortKey);const Pae=s4(ro,Pr,au),[Eae,Aae]=function(Bo,Dl){const xm=Bo.length,cu=Dl?.values;if(cu?.length>0)for(let bm=0;bm<cu.length;bm+=2){const $u=cu[bm+1];Bo.emplaceBack(o.ay[cu[bm]],$u[0],$u[1])}return[xm,Bo.length]}(Ai.textAnchorOffsets,Pae);Ai.symbolInstances.emplaceBack(Ln.x,Ln.y,od.right>=0?od.right:-1,od.center>=0?od.center:-1,od.left>=0?od.left:-1,od.vertical||-1,eF,tF,m4,wae,_ae,Cae,Sae,Oae,Mae,Tae,Rae,qs,f4,p4,h4,d4,v4,0,ia,lu,Eae,Aae)}(m,Wi,Ki,g,x,C,si,m.layers[0],m.collisionBoxArray,h.index,h.sourceLayerIndex,m.index,Ne,[Me,Me,Me,Me],jt,V,Ve,Ue,_t,de,h,E,H,X,A)};if(Et==="line")for(const Ki of X8(h.geometry,0,0,me,me)){const Wi=vm(Ki,Ft),Ai=fae(Wi,ce,yt,g.vertical||ge,x,24,tt,m.overscaling,me);for(const Ln of Ai)ge&&yae(m,ge.text,ri,Ln)||Ti(Wi,Ln)}else if(Et==="line-center"){for(const Ki of h.geometry)if(Ki.length>1){const Wi=vm(Ki,Ft),Ai=dae(Wi,yt,g.vertical||ge,x,24,tt);Ai&&Ti(Wi,Ai)}}else if(h.type==="Polygon")for(const Ki of Jp(h.geometry,0)){const Wi=mae(Ki,16);Ti(vm(Ki[0],Ft,!0),new If(Wi.x,Wi.y,0))}else if(h.type==="LineString")for(const Ki of h.geometry){const Wi=vm(Ki,Ft);Ti(Wi,new If(Wi[0].x,Wi[0].y,0))}else if(h.type==="Point")for(const Ki of h.geometry)for(const Wi of Ki)Ti([Wi],new If(Wi.x,Wi.y,0))}function o4(m,h,g,x,C,E,A,L,V,H,X,K,ae,ue,de){const ge=function(tt,Ve,ce,Me,Ue,yt,jt,_t){const Et=Me.layout.get("text-rotate").evaluate(yt,{})*Math.PI/180,ri=[];for(const Zt of Ve.positionedLines)for(const si of Zt.positionedGlyphs){if(!si.rect)continue;const Ft=si.rect||{};let Ti=Woe+1,Ki=!0,Wi=1,Ai=0;const Ln=(Ue||_t)&&si.vertical,Qr=si.metrics.advance*si.scale/2;if(_t&&Ve.verticalizable&&(Ai=Zt.lineOffset/2-(si.imageName?-(Fs-si.metrics.width*si.scale)/2:(si.scale-1)*Fs)),si.imageName){const Qs=jt[si.imageName];Ki=Qs.sdf,Wi=Qs.pixelRatio,Ti=Ca/Wi}const Ns=Ue?[si.x+Qr,si.y]:[0,0];let Oo=Ue?[0,0]:[si.x+Qr+ce[0],si.y+ce[1]-Ai],Il=[0,0];Ln&&(Il=Oo,Oo=[0,0]);const Sa=si.metrics.isDoubleResolution?2:1,ro=(si.metrics.left-Ti)*si.scale-Qr+Oo[0],Vr=(-si.metrics.top-Ti)*si.scale+Oo[1],qs=ro+Ft.w/Sa*si.scale/Wi,so=Vr+Ft.h/Sa*si.scale/Wi,oo=new w(ro,Vr),ia=new w(qs,Vr),kl=new w(ro,so),js=new w(qs,so);if(Ln){const Qs=new w(-Qr,Qr-o1),Zs=-Math.PI/2,Ss=Fs/2-Qr,Pr=new w(5-o1-Ss,-(si.imageName?Ss:0)),ou=new w(...Il);oo._rotateAround(Zs,Qs)._add(Pr)._add(ou),ia._rotateAround(Zs,Qs)._add(Pr)._add(ou),kl._rotateAround(Zs,Qs)._add(Pr)._add(ou),js._rotateAround(Zs,Qs)._add(Pr)._add(ou)}if(Et){const Qs=Math.sin(Et),Zs=Math.cos(Et),Ss=[Zs,-Qs,Qs,Zs];oo._matMult(Ss),ia._matMult(Ss),kl._matMult(Ss),js._matMult(Ss)}const Oa=new w(0,0),Bs=new w(0,0);ri.push({tl:oo,tr:ia,bl:kl,br:js,tex:Ft,writingMode:Ve.writingMode,glyphOffset:Ns,sectionIndex:si.sectionIndex,isSDF:Ki,pixelOffsetTL:Oa,pixelOffsetBR:Bs,minFontScaleX:0,minFontScaleY:0})}return ri}(0,g,L,C,E,A,x,m.allowVerticalPlacement),Te=m.textSizeData;let Ne=null;Te.kind==="source"?(Ne=[Hu*C.layout.get("text-size").evaluate(A,{})],Ne[0]>Ef&&Jt(`${m.layerIds[0]}: Value for "text-size" is >= ${Ob}. Reduce your "text-size".`)):Te.kind==="composite"&&(Ne=[Hu*ue.compositeTextSizes[0].evaluate(A,{},de),Hu*ue.compositeTextSizes[1].evaluate(A,{},de)],(Ne[0]>Ef||Ne[1]>Ef)&&Jt(`${m.layerIds[0]}: Value for "text-size" is >= ${Ob}. Reduce your "text-size".`)),m.addSymbols(m.text,ge,Ne,L,E,A,H,h,V.lineStartIndex,V.lineLength,ae,de);for(const tt of X)K[tt]=m.text.placedSymbolArray.length-1;return 4*ge.length}function a4(m){for(const h in m)return m[h];return null}function yae(m,h,g,x){const C=m.compareText;if(h in C){const E=C[h];for(let A=E.length-1;A>=0;A--)if(x.dist(E[A])<g)return!0}else C[h]=[];return C[h].push(x),!1}const l4=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class j2{static from(h){if(!(h instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[g,x]=new Uint8Array(h,0,2);if(g!==219)throw new Error("Data does not appear to be in a KDBush format.");const C=x>>4;if(C!==1)throw new Error(`Got v${C} data when expected v1.`);const E=l4[15&x];if(!E)throw new Error("Unrecognized array type.");const[A]=new Uint16Array(h,2,1),[L]=new Uint32Array(h,4,1);return new j2(L,A,E,h)}constructor(h,g=64,x=Float64Array,C){if(isNaN(h)||h<0)throw new Error(`Unpexpected numItems value: ${h}.`);this.numItems=+h,this.nodeSize=Math.min(Math.max(+g,2),65535),this.ArrayType=x,this.IndexArrayType=h<65536?Uint16Array:Uint32Array;const E=l4.indexOf(this.ArrayType),A=2*h*this.ArrayType.BYTES_PER_ELEMENT,L=h*this.IndexArrayType.BYTES_PER_ELEMENT,V=(8-L%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${x}.`);C&&C instanceof ArrayBuffer?(this.data=C,this.ids=new this.IndexArrayType(this.data,8,h),this.coords=new this.ArrayType(this.data,8+L+V,2*h),this._pos=2*h,this._finished=!0):(this.data=new ArrayBuffer(8+A+L+V),this.ids=new this.IndexArrayType(this.data,8,h),this.coords=new this.ArrayType(this.data,8+L+V,2*h),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=g,new Uint32Array(this.data,4,1)[0]=h)}add(h,g){const x=this._pos>>1;return this.ids[x]=x,this.coords[this._pos++]=h,this.coords[this._pos++]=g,x}finish(){const h=this._pos>>1;if(h!==this.numItems)throw new Error(`Added ${h} items when expected ${this.numItems}.`);return Q2(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(h,g,x,C){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:A,nodeSize:L}=this,V=[0,E.length-1,0],H=[];for(;V.length;){const X=V.pop()||0,K=V.pop()||0,ae=V.pop()||0;if(K-ae<=L){for(let Te=ae;Te<=K;Te++){const Ne=A[2*Te],tt=A[2*Te+1];Ne>=h&&Ne<=x&&tt>=g&&tt<=C&&H.push(E[Te])}continue}const ue=ae+K>>1,de=A[2*ue],ge=A[2*ue+1];de>=h&&de<=x&&ge>=g&&ge<=C&&H.push(E[ue]),(X===0?h<=de:g<=ge)&&(V.push(ae),V.push(ue-1),V.push(1-X)),(X===0?x>=de:C>=ge)&&(V.push(ue+1),V.push(K),V.push(1-X))}return H}within(h,g,x){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:C,coords:E,nodeSize:A}=this,L=[0,C.length-1,0],V=[],H=x*x;for(;L.length;){const X=L.pop()||0,K=L.pop()||0,ae=L.pop()||0;if(K-ae<=A){for(let Te=ae;Te<=K;Te++)u4(E[2*Te],E[2*Te+1],h,g)<=H&&V.push(C[Te]);continue}const ue=ae+K>>1,de=E[2*ue],ge=E[2*ue+1];u4(de,ge,h,g)<=H&&V.push(C[ue]),(X===0?h-x<=de:g-x<=ge)&&(L.push(ae),L.push(ue-1),L.push(1-X)),(X===0?h+x>=de:g+x>=ge)&&(L.push(ue+1),L.push(K),L.push(1-X))}return V}}function Q2(m,h,g,x,C,E){if(C-x<=g)return;const A=x+C>>1;c4(m,h,A,x,C,E),Q2(m,h,g,x,A-1,1-E),Q2(m,h,g,A+1,C,1-E)}function c4(m,h,g,x,C,E){for(;C>x;){if(C-x>600){const H=C-x+1,X=g-x+1,K=Math.log(H),ae=.5*Math.exp(2*K/3),ue=.5*Math.sqrt(K*ae*(H-ae)/H)*(X-H/2<0?-1:1);c4(m,h,g,Math.max(x,Math.floor(g-X*ae/H+ue)),Math.min(C,Math.floor(g+(H-X)*ae/H+ue)),E)}const A=h[2*g+E];let L=x,V=C;for(Rb(m,h,x,g),h[2*C+E]>A&&Rb(m,h,x,C);L<V;){for(Rb(m,h,L,V),L++,V--;h[2*L+E]<A;)L++;for(;h[2*V+E]>A;)V--}h[2*x+E]===A?Rb(m,h,x,V):(V++,Rb(m,h,V,C)),V<=g&&(x=V+1),g<=V&&(C=V-1)}}function Rb(m,h,g,x){Z2(m,g,x),Z2(h,2*g,2*x),Z2(h,2*g+1,2*x+1)}function Z2(m,h,g){const x=m[h];m[h]=m[g],m[g]=x}function u4(m,h,g,x){const C=m-g,E=h-x;return C*C+E*E}var X2;o.ck=void 0,(X2=o.ck||(o.ck={})).create="create",X2.load="load",X2.fullLoad="fullLoad";let m1=null,Pb=[];const K2=1e3/60,Y2="loadTime",J2="fullLoadTime",xae={mark(m){performance.mark(m)},frame(m){const h=m;m1!=null&&Pb.push(h-m1),m1=h},clearMetrics(){m1=null,Pb=[],performance.clearMeasures(Y2),performance.clearMeasures(J2);for(const m in o.ck)performance.clearMarks(o.ck[m])},getPerformanceMetrics(){performance.measure(Y2,o.ck.create,o.ck.load),performance.measure(J2,o.ck.create,o.ck.fullLoad);const m=performance.getEntriesByName(Y2)[0].duration,h=performance.getEntriesByName(J2)[0].duration,g=Pb.length,x=1/(Pb.reduce((E,A)=>E+A,0)/g/1e3),C=Pb.filter(E=>E>K2).reduce((E,A)=>E+(A-K2)/K2,0);return{loadTime:m,fullLoadTime:h,fps:x,percentDroppedFrames:C/(g+C)*100,totalFrames:g}}};o.$=Mb,o.A=Q,o.B=Rl,o.C=Tr,o.D=zi,o.E=re,o.F=o2,o.G=function(m){if(Re==null){const h=m.navigator?m.navigator.userAgent:null;Re=!!m.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return Re},o.H=class{constructor(m,h){this.target=m,this.mapId=h,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new cae(()=>this.process()),this.subscription=st(this.target,"message",g=>this.receive(g),!1),this.globalScope=Ut(self)?m:window}registerMessageHandler(m,h){this.messageHandlers[m]=h}sendAsync(m,h){return new Promise((g,x)=>{const C=Math.round(1e18*Math.random()).toString(36).substring(0,10),E=h?st(h.signal,"abort",()=>{E?.unsubscribe(),delete this.resolveRejects[C];const V={id:C,type:"<cancel>",origin:location.origin,targetMapId:m.targetMapId,sourceMapId:this.mapId};this.target.postMessage(V)},uae):null;this.resolveRejects[C]={resolve:V=>{E?.unsubscribe(),g(V)},reject:V=>{E?.unsubscribe(),x(V)}};const A=[],L=Object.assign(Object.assign({},m),{id:C,sourceMapId:this.mapId,origin:location.origin,data:Yh(m.data,A)});this.target.postMessage(L,{transfer:A})})}receive(m){const h=m.data,g=h.id;if(!(h.origin!=="file://"&&location.origin!=="file://"&&h.origin!=="resource://android"&&location.origin!=="resource://android"&&h.origin!==location.origin||h.targetMapId&&this.mapId!==h.targetMapId)){if(h.type==="<cancel>"){delete this.tasks[g];const x=this.abortControllers[g];return delete this.abortControllers[g],void(x&&x.abort())}if(Ut(self)||h.mustQueue)return this.tasks[g]=h,this.taskQueue.push(g),void this.invoker.trigger();this.processTask(g,h)}}process(){if(this.taskQueue.length===0)return;const m=this.taskQueue.shift(),h=this.tasks[m];delete this.tasks[m],this.taskQueue.length>0&&this.invoker.trigger(),h&&this.processTask(m,h)}processTask(m,h){return a(this,void 0,void 0,function*(){if(h.type==="<response>"){const C=this.resolveRejects[m];return delete this.resolveRejects[m],C?void(h.error?C.reject(Fu(h.error)):C.resolve(Fu(h.data))):void 0}if(!this.messageHandlers[h.type])return void this.completeTask(m,new Error(`Could not find a registered handler for ${h.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const g=Fu(h.data),x=new AbortController;this.abortControllers[m]=x;try{const C=yield this.messageHandlers[h.type](h.sourceMapId,g,x);this.completeTask(m,null,C)}catch(C){this.completeTask(m,C)}})}completeTask(m,h,g){const x=[];delete this.abortControllers[m];const C={id:m,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:h?Yh(h):null,data:Yh(g,x)};this.target.postMessage(C,{transfer:x})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},o.I=D2,o.J=ot,o.K=function(){var m=new Q(16);return Q!=Float32Array&&(m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=0,m[12]=0,m[13]=0,m[14]=0),m[0]=1,m[5]=1,m[10]=1,m[15]=1,m},o.L=function(m,h,g){var x,C,E,A,L,V,H,X,K,ae,ue,de,ge=g[0],Te=g[1],Ne=g[2];return h===m?(m[12]=h[0]*ge+h[4]*Te+h[8]*Ne+h[12],m[13]=h[1]*ge+h[5]*Te+h[9]*Ne+h[13],m[14]=h[2]*ge+h[6]*Te+h[10]*Ne+h[14],m[15]=h[3]*ge+h[7]*Te+h[11]*Ne+h[15]):(C=h[1],E=h[2],A=h[3],L=h[4],V=h[5],H=h[6],X=h[7],K=h[8],ae=h[9],ue=h[10],de=h[11],m[0]=x=h[0],m[1]=C,m[2]=E,m[3]=A,m[4]=L,m[5]=V,m[6]=H,m[7]=X,m[8]=K,m[9]=ae,m[10]=ue,m[11]=de,m[12]=x*ge+L*Te+K*Ne+h[12],m[13]=C*ge+V*Te+ae*Ne+h[13],m[14]=E*ge+H*Te+ue*Ne+h[14],m[15]=A*ge+X*Te+de*Ne+h[15]),m},o.M=function(m,h,g){var x=g[0],C=g[1],E=g[2];return m[0]=h[0]*x,m[1]=h[1]*x,m[2]=h[2]*x,m[3]=h[3]*x,m[4]=h[4]*C,m[5]=h[5]*C,m[6]=h[6]*C,m[7]=h[7]*C,m[8]=h[8]*E,m[9]=h[9]*E,m[10]=h[10]*E,m[11]=h[11]*E,m[12]=h[12],m[13]=h[13],m[14]=h[14],m[15]=h[15],m},o.N=function(m,h,g){var x=h[0],C=h[1],E=h[2],A=h[3],L=h[4],V=h[5],H=h[6],X=h[7],K=h[8],ae=h[9],ue=h[10],de=h[11],ge=h[12],Te=h[13],Ne=h[14],tt=h[15],Ve=g[0],ce=g[1],Me=g[2],Ue=g[3];return m[0]=Ve*x+ce*L+Me*K+Ue*ge,m[1]=Ve*C+ce*V+Me*ae+Ue*Te,m[2]=Ve*E+ce*H+Me*ue+Ue*Ne,m[3]=Ve*A+ce*X+Me*de+Ue*tt,m[4]=(Ve=g[4])*x+(ce=g[5])*L+(Me=g[6])*K+(Ue=g[7])*ge,m[5]=Ve*C+ce*V+Me*ae+Ue*Te,m[6]=Ve*E+ce*H+Me*ue+Ue*Ne,m[7]=Ve*A+ce*X+Me*de+Ue*tt,m[8]=(Ve=g[8])*x+(ce=g[9])*L+(Me=g[10])*K+(Ue=g[11])*ge,m[9]=Ve*C+ce*V+Me*ae+Ue*Te,m[10]=Ve*E+ce*H+Me*ue+Ue*Ne,m[11]=Ve*A+ce*X+Me*de+Ue*tt,m[12]=(Ve=g[12])*x+(ce=g[13])*L+(Me=g[14])*K+(Ue=g[15])*ge,m[13]=Ve*C+ce*V+Me*ae+Ue*Te,m[14]=Ve*E+ce*H+Me*ue+Ue*Ne,m[15]=Ve*A+ce*X+Me*de+Ue*tt,m},o.O=function(m,h){const g={};for(let x=0;x<h.length;x++){const C=h[x];C in m&&(g[C]=m[C])}return g},o.P=w,o.Q=Af,o.R=El,o.S=z8,o.T=cm,o.U=B8,o.V=F,o.W=k,o.X=Pe,o.Y=Al,o.Z=me,o._=a,o.a=Ze,o.a$=function(m,h,g){var x=Math.sin(g),C=Math.cos(g),E=h[4],A=h[5],L=h[6],V=h[7],H=h[8],X=h[9],K=h[10],ae=h[11];return h!==m&&(m[0]=h[0],m[1]=h[1],m[2]=h[2],m[3]=h[3],m[12]=h[12],m[13]=h[13],m[14]=h[14],m[15]=h[15]),m[4]=E*C+H*x,m[5]=A*C+X*x,m[6]=L*C+K*x,m[7]=V*C+ae*x,m[8]=H*C-E*x,m[9]=X*C-A*x,m[10]=K*C-L*x,m[11]=ae*C-V*x,m},o.a0=25,o.a1=$2,o.a2=m=>{const h=window.document.createElement("video");return h.muted=!0,new Promise(g=>{h.onloadstart=()=>{g(h)};for(const x of m){const C=window.document.createElement("source");ni(x)||(h.crossOrigin="Anonymous"),C.src=x,h.appendChild(C)}})},o.a3=xt,o.a4=function(){return mt++},o.a5=U,o.a6=Qv,o.a7=Ux,o.a8=Uu,o.a9=q8,o.aA=q2,o.aB=F2,o.aC=j2,o.aD=ss,o.aE=n1,o.aF=We,o.aG=bn,o.aH=Ht,o.aI=function(m){return Math.pow(2,m)},o.aJ=85.051129,o.aK=V8,o.aL=Ge,o.aM=we,o.aN=G8,o.aO=function(m,h,g){return m[0]=h[0]*g,m[1]=h[1]*g,m[2]=h[2]*g,m},o.aP=function(m,h,g){return m[0]=h[0]+g[0],m[1]=h[1]+g[1],m[2]=h[2]+g[2],m},o.aQ=function(m){var h=new Q(3);return h[0]=m[0],h[1]=m[1],h[2]=m[2],h},o.aR=function(m,h,g){return m[0]=h[0]*g[0],m[1]=h[1]*g[1],m[2]=h[2]*g[2],m[3]=h[3]*g[3],m},o.aS=function(m,h,g){return m[0]=h[0]-g[0],m[1]=h[1]-g[1],m[2]=h[2]-g[2],m},o.aT=function(m,h){var g=h[0],x=h[1],C=h[2],E=g*g+x*x+C*C;return E>0&&(E=1/Math.sqrt(E)),m[0]=h[0]*E,m[1]=h[1]*E,m[2]=h[2]*E,m},o.aU=function(m,h,g){var x=h[0],C=h[1],E=h[2],A=g[0],L=g[1],V=g[2];return m[0]=C*V-E*L,m[1]=E*A-x*V,m[2]=x*L-C*A,m},o.aV=function(m,h){return m[0]*h[0]+m[1]*h[1]+m[2]*h[2]},o.aW=H8,o.aX=Zv,o.aY=function(m,h,g,x,C){var E,A=1/Math.tan(h/2);return m[0]=A/g,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=A,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[11]=-1,m[12]=0,m[13]=0,m[15]=0,C!=null&&C!==1/0?(m[10]=(C+x)*(E=1/(x-C)),m[14]=2*C*x*E):(m[10]=-1,m[14]=-2*x),m},o.aZ=function(m){var h=new Q(16);return h[0]=m[0],h[1]=m[1],h[2]=m[2],h[3]=m[3],h[4]=m[4],h[5]=m[5],h[6]=m[6],h[7]=m[7],h[8]=m[8],h[9]=m[9],h[10]=m[10],h[11]=m[11],h[12]=m[12],h[13]=m[13],h[14]=m[14],h[15]=m[15],h},o.a_=function(m,h,g){var x=Math.sin(g),C=Math.cos(g),E=h[0],A=h[1],L=h[2],V=h[3],H=h[4],X=h[5],K=h[6],ae=h[7];return h!==m&&(m[8]=h[8],m[9]=h[9],m[10]=h[10],m[11]=h[11],m[12]=h[12],m[13]=h[13],m[14]=h[14],m[15]=h[15]),m[0]=E*C+H*x,m[1]=A*C+X*x,m[2]=L*C+K*x,m[3]=V*C+ae*x,m[4]=H*C-E*x,m[5]=X*C-A*x,m[6]=K*C-L*x,m[7]=ae*C-V*x,m},o.aa=function(m){const h={};if(m.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(g,x,C,E)=>{const A=C||E;return h[x]=!A||A.toLowerCase(),""}),h["max-age"]){const g=parseInt(h["max-age"],10);isNaN(g)?delete h["max-age"]:h["max-age"]=g}return h},o.ab=function(m){return Math.log(m)/Math.LN2},o.ac=function(m){var h=m[0],g=m[1];return h*h+g*g},o.ad=function(m){return m*Math.PI/180},o.ae=ct,o.af=function(m,h){const g=[];for(const x in m)x in h||g.push(x);return g},o.ag=function(m,h){let g=0,x=0;if(m.kind==="constant")x=m.layoutSize;else if(m.kind!=="source"){const{interpolationType:C,minZoom:E,maxZoom:A}=m,L=C?ct(_o.interpolationFactor(C,h,E,A),0,1):0;m.kind==="camera"?x=Rl.number(m.minSize,m.maxSize,L):g=L}return{uSizeT:g,uSize:x}},o.ai=function(m,{uSize:h,uSizeT:g},{lowerSize:x,upperSize:C}){return m.kind==="source"?x/Hu:m.kind==="composite"?Rl.number(x/Hu,C/Hu,g):h},o.aj=function(m,h){var g=h[0],x=h[1],C=h[2],E=h[3],A=h[4],L=h[5],V=h[6],H=h[7],X=h[8],K=h[9],ae=h[10],ue=h[11],de=h[12],ge=h[13],Te=h[14],Ne=h[15],tt=g*L-x*A,Ve=g*V-C*A,ce=g*H-E*A,Me=x*V-C*L,Ue=x*H-E*L,yt=C*H-E*V,jt=X*ge-K*de,_t=X*Te-ae*de,Et=X*Ne-ue*de,ri=K*Te-ae*ge,Zt=K*Ne-ue*ge,si=ae*Ne-ue*Te,Ft=tt*si-Ve*Zt+ce*ri+Me*Et-Ue*_t+yt*jt;return Ft?(m[0]=(L*si-V*Zt+H*ri)*(Ft=1/Ft),m[1]=(C*Zt-x*si-E*ri)*Ft,m[2]=(ge*yt-Te*Ue+Ne*Me)*Ft,m[3]=(ae*Ue-K*yt-ue*Me)*Ft,m[4]=(V*Et-A*si-H*_t)*Ft,m[5]=(g*si-C*Et+E*_t)*Ft,m[6]=(Te*ce-de*yt-Ne*Ve)*Ft,m[7]=(X*yt-ae*ce+ue*Ve)*Ft,m[8]=(A*Zt-L*Et+H*jt)*Ft,m[9]=(x*Et-g*Zt-E*jt)*Ft,m[10]=(de*Ue-ge*ce+Ne*tt)*Ft,m[11]=(K*ce-X*Ue-ue*tt)*Ft,m[12]=(L*_t-A*ri-V*jt)*Ft,m[13]=(g*ri-x*_t+C*jt)*Ft,m[14]=(ge*Ve-de*Me-Te*tt)*Ft,m[15]=(X*Me-K*Ve+ae*tt)*Ft,m):null},o.ak=ie,o.al=function(m){return Math.hypot(m[0],m[1])},o.am=function(m){return m[0]=0,m[1]=0,m},o.an=function(m,h,g){return m[0]=h[0]*g,m[1]=h[1]*g,m},o.ao=B2,o.ap=j,o.aq=function(m,h,g,x){const C=h.y-m.y,E=h.x-m.x,A=x.y-g.y,L=x.x-g.x,V=A*E-L*C;if(V===0)return null;const H=(L*(m.y-g.y)-A*(m.x-g.x))/V;return new w(m.x+H*E,m.y+H*C)},o.ar=X8,o.as=Hv,o.at=M,o.au=function(m){let h=1/0,g=1/0,x=-1/0,C=-1/0;for(const E of m)h=Math.min(h,E.x),g=Math.min(g,E.y),x=Math.max(x,E.x),C=Math.max(C,E.y);return[h,g,x,C]},o.av=Fs,o.aw=be,o.ax=function(m,h,g,x,C=!1){if(!g[0]&&!g[1])return[0,0];const E=C?x==="map"?-m.bearingInRadians:0:x==="viewport"?m.bearingInRadians:0;if(E){const A=Math.sin(E),L=Math.cos(E);g=[g[0]*L-g[1]*A,g[0]*A+g[1]*L]}return[C?g[0]:be(h,g[0],m.zoom),C?g[1]:be(h,g[1],m.zoom)]},o.az=N2,o.b=gi,o.b$=m=>m.type==="symbol",o.b0=function(){const m=new Float32Array(16);return M(m),m},o.b1=function(){const m=new Float64Array(16);return M(m),m},o.b2=function(){return new Float64Array(16)},o.b3=function(m,h,g){const x=new Float64Array(4);return function(C,E,A,L){var V=.5*Math.PI/180;E*=V,A*=V,L*=V;var H=Math.sin(E),X=Math.cos(E),K=Math.sin(A),ae=Math.cos(A),ue=Math.sin(L),de=Math.cos(L);C[0]=H*ae*de-X*K*ue,C[1]=X*K*de+H*ae*ue,C[2]=X*ae*ue-H*K*de,C[3]=X*ae*de+H*K*ue}(x,m,h-90,g),x},o.b4=function(m,h,g,x){var C,E,A,L,V,H=h[0],X=h[1],K=h[2],ae=h[3],ue=g[0],de=g[1],ge=g[2],Te=g[3];return(E=H*ue+X*de+K*ge+ae*Te)<0&&(E=-E,ue=-ue,de=-de,ge=-ge,Te=-Te),1-E>W?(C=Math.acos(E),A=Math.sin(C),L=Math.sin((1-x)*C)/A,V=Math.sin(x*C)/A):(L=1-x,V=x),m[0]=L*H+V*ue,m[1]=L*X+V*de,m[2]=L*K+V*ge,m[3]=L*ae+V*Te,m},o.b5=function(m){const h=new Float64Array(9);var g,x,C,E,A,L,V,H,X,K,ae,ue,de,ge,Te,Ne,tt,Ve;K=(C=(x=m)[0])*(V=C+C),ae=(E=x[1])*V,de=(A=x[2])*V,ge=A*(H=E+E),Ne=(L=x[3])*V,tt=L*H,Ve=L*(X=A+A),(g=h)[0]=1-(ue=E*H)-(Te=A*X),g[3]=ae-Ve,g[6]=de+tt,g[1]=ae+Ve,g[4]=1-K-Te,g[7]=ge-Ne,g[2]=de-tt,g[5]=ge+Ne,g[8]=1-K-ue;const ce=we(-Math.asin(ct(h[2],-1,1)));let Me,Ue;return Math.hypot(h[5],h[8])<.001?(Me=0,Ue=-we(Math.atan2(h[3],h[4]))):(Me=we(h[5]===0&&h[8]===0?0:Math.atan2(h[5],h[8])),Ue=we(h[1]===0&&h[0]===0?0:Math.atan2(h[1],h[0]))),{roll:Me,pitch:ce+90,bearing:Ue}},o.b6=function(m,h){return m.roll==h.roll&&m.pitch==h.pitch&&m.bearing==h.bearing},o.b7=hn,o.b8=ru,o.b9=qv,o.bA=function(m,h){if(!m)return[{command:"setStyle",args:[h]}];let g=[];try{if(!ve(m.version,h.version))return[{command:"setStyle",args:[h]}];ve(m.center,h.center)||g.push({command:"setCenter",args:[h.center]}),ve(m.centerAltitude,h.centerAltitude)||g.push({command:"setCenterAltitude",args:[h.centerAltitude]}),ve(m.zoom,h.zoom)||g.push({command:"setZoom",args:[h.zoom]}),ve(m.bearing,h.bearing)||g.push({command:"setBearing",args:[h.bearing]}),ve(m.pitch,h.pitch)||g.push({command:"setPitch",args:[h.pitch]}),ve(m.roll,h.roll)||g.push({command:"setRoll",args:[h.roll]}),ve(m.sprite,h.sprite)||g.push({command:"setSprite",args:[h.sprite]}),ve(m.glyphs,h.glyphs)||g.push({command:"setGlyphs",args:[h.glyphs]}),ve(m.transition,h.transition)||g.push({command:"setTransition",args:[h.transition]}),ve(m.light,h.light)||g.push({command:"setLight",args:[h.light]}),ve(m.terrain,h.terrain)||g.push({command:"setTerrain",args:[h.terrain]}),ve(m.sky,h.sky)||g.push({command:"setSky",args:[h.sky]}),ve(m.projection,h.projection)||g.push({command:"setProjection",args:[h.projection]});const x={},C=[];(function(A,L,V,H){let X;for(X in L=L||{},A=A||{})Object.prototype.hasOwnProperty.call(A,X)&&(Object.prototype.hasOwnProperty.call(L,X)||Xe(X,V,H));for(X in L)Object.prototype.hasOwnProperty.call(L,X)&&(Object.prototype.hasOwnProperty.call(A,X)?ve(A[X],L[X])||(A[X].type==="geojson"&&L[X].type==="geojson"&&lt(A,L,X)?Ae(V,{command:"setGeoJSONSourceData",args:[X,L[X].data]}):ut(X,L,V,H)):ke(X,L,V))})(m.sources,h.sources,C,x);const E=[];m.layers&&m.layers.forEach(A=>{"source"in A&&x[A.source]?g.push({command:"removeLayer",args:[A.id]}):E.push(A)}),g=g.concat(C),function(A,L,V){L=L||[];const H=(A=A||[]).map(zt),X=L.map(zt),K=A.reduce(ii,{}),ae=L.reduce(ii,{}),ue=H.slice(),de=Object.create(null);let ge,Te,Ne,tt,Ve;for(let ce=0,Me=0;ce<H.length;ce++)ge=H[ce],Object.prototype.hasOwnProperty.call(ae,ge)?Me++:(Ae(V,{command:"removeLayer",args:[ge]}),ue.splice(ue.indexOf(ge,Me),1));for(let ce=0,Me=0;ce<X.length;ce++)ge=X[X.length-1-ce],ue[ue.length-1-ce]!==ge&&(Object.prototype.hasOwnProperty.call(K,ge)?(Ae(V,{command:"removeLayer",args:[ge]}),ue.splice(ue.lastIndexOf(ge,ue.length-Me),1)):Me++,tt=ue[ue.length-ce],Ae(V,{command:"addLayer",args:[ae[ge],tt]}),ue.splice(ue.length-ce,0,ge),de[ge]=!0);for(let ce=0;ce<X.length;ce++)if(ge=X[ce],Te=K[ge],Ne=ae[ge],!de[ge]&&!ve(Te,Ne))if(ve(Te.source,Ne.source)&&ve(Te["source-layer"],Ne["source-layer"])&&ve(Te.type,Ne.type)){for(Ve in Tt(Te.layout,Ne.layout,V,ge,null,"setLayoutProperty"),Tt(Te.paint,Ne.paint,V,ge,null,"setPaintProperty"),ve(Te.filter,Ne.filter)||Ae(V,{command:"setFilter",args:[ge,Ne.filter]}),ve(Te.minzoom,Ne.minzoom)&&ve(Te.maxzoom,Ne.maxzoom)||Ae(V,{command:"setLayerZoomRange",args:[ge,Ne.minzoom,Ne.maxzoom]}),Te)Object.prototype.hasOwnProperty.call(Te,Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?Tt(Te[Ve],Ne[Ve],V,ge,Ve.slice(6),"setPaintProperty"):ve(Te[Ve],Ne[Ve])||Ae(V,{command:"setLayerProperty",args:[ge,Ve,Ne[Ve]]}));for(Ve in Ne)Object.prototype.hasOwnProperty.call(Ne,Ve)&&!Object.prototype.hasOwnProperty.call(Te,Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?Tt(Te[Ve],Ne[Ve],V,ge,Ve.slice(6),"setPaintProperty"):ve(Te[Ve],Ne[Ve])||Ae(V,{command:"setLayerProperty",args:[ge,Ve,Ne[Ve]]}))}else Ae(V,{command:"removeLayer",args:[ge]}),tt=ue[ue.lastIndexOf(ge)+1],Ae(V,{command:"addLayer",args:[Ne,tt]})}(E,h.layers,g)}catch(x){console.warn("Unable to compute style diff:",x),g=[{command:"setStyle",args:[h]}]}return g},o.bB=function(m){const h=[],g=m.id;return g===void 0&&h.push({message:`layers.${g}: missing required property "id"`}),m.render===void 0&&h.push({message:`layers.${g}: missing required method "render"`}),m.renderingMode&&m.renderingMode!=="2d"&&m.renderingMode!=="3d"&&h.push({message:`layers.${g}: property "renderingMode" must be either "2d" or "3d"`}),h},o.bC=function m(h,g){if(Array.isArray(h)){if(!Array.isArray(g)||h.length!==g.length)return!1;for(let x=0;x<h.length;x++)if(!m(h[x],g[x]))return!1;return!0}if(typeof h=="object"&&h!==null&&g!==null){if(typeof g!="object"||Object.keys(h).length!==Object.keys(g).length)return!1;for(const x in h)if(!m(h[x],g[x]))return!1;return!0}return h===g},o.bD=wt,o.bE=Ot,o.bF=class extends mc{constructor(m,h){super(m,h),this.current=0}set(m){this.current!==m&&(this.current=m,this.gl.uniform1i(this.location,m))}},o.bG=su,o.bH=class extends mc{constructor(m,h){super(m,h),this.current=nd}set(m){if(m[12]!==this.current[12]||m[0]!==this.current[0])return this.current=m,void this.gl.uniformMatrix4fv(this.location,!1,m);for(let h=1;h<16;h++)if(m[h]!==this.current[h]){this.current=m,this.gl.uniformMatrix4fv(this.location,!1,m);break}}},o.bI=_a,o.bJ=class extends mc{constructor(m,h){super(m,h),this.current=[0,0,0]}set(m){m[0]===this.current[0]&&m[1]===this.current[1]&&m[2]===this.current[2]||(this.current=m,this.gl.uniform3f(this.location,m[0],m[1],m[2]))}},o.bK=class extends mc{constructor(m,h){super(m,h),this.current=[0,0]}set(m){m[0]===this.current[0]&&m[1]===this.current[1]||(this.current=m,this.gl.uniform2f(this.location,m[0],m[1]))}},o.bL=Y,o.bM=function(m,h){var g=Math.sin(h),x=Math.cos(h);return m[0]=x,m[1]=g,m[2]=0,m[3]=-g,m[4]=x,m[5]=0,m[6]=0,m[7]=0,m[8]=1,m},o.bN=function(m,h,g){var x=h[0],C=h[1],E=h[2];return m[0]=x*g[0]+C*g[3]+E*g[6],m[1]=x*g[1]+C*g[4]+E*g[7],m[2]=x*g[2]+C*g[5]+E*g[8],m},o.bO=function(m,h,g,x,C,E,A){var L=1/(h-g),V=1/(x-C),H=1/(E-A);return m[0]=-2*L,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=-2*V,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=2*H,m[11]=0,m[12]=(h+g)*L,m[13]=(C+x)*V,m[14]=(A+E)*H,m[15]=1,m},o.bP=class extends ob{},o.bQ=zoe,o.bR=class extends pm{},o.bS=y2,o.bT=function(m){return m<=1?1:Math.pow(2,Math.ceil(Math.log(m)/Math.LN2))},o.bU=W5,o.bV=function(m,h,g){var x=h[0],C=h[1],E=h[2],A=g[3]*x+g[7]*C+g[11]*E+g[15];return m[0]=(g[0]*x+g[4]*C+g[8]*E+g[12])/(A=A||1),m[1]=(g[1]*x+g[5]*C+g[9]*E+g[13])/A,m[2]=(g[2]*x+g[6]*C+g[10]*E+g[14])/A,m},o.bW=class extends zv{},o.bX=class extends T{},o.bY=function(m,h){return m[0]===h[0]&&m[1]===h[1]&&m[2]===h[2]&&m[3]===h[3]&&m[4]===h[4]&&m[5]===h[5]&&m[6]===h[6]&&m[7]===h[7]&&m[8]===h[8]&&m[9]===h[9]&&m[10]===h[10]&&m[11]===h[11]&&m[12]===h[12]&&m[13]===h[13]&&m[14]===h[14]&&m[15]===h[15]},o.bZ=function(m,h){var g=m[0],x=m[1],C=m[2],E=m[3],A=m[4],L=m[5],V=m[6],H=m[7],X=m[8],K=m[9],ae=m[10],ue=m[11],de=m[12],ge=m[13],Te=m[14],Ne=m[15],tt=h[0],Ve=h[1],ce=h[2],Me=h[3],Ue=h[4],yt=h[5],jt=h[6],_t=h[7],Et=h[8],ri=h[9],Zt=h[10],si=h[11],Ft=h[12],Ti=h[13],Ki=h[14],Wi=h[15];return Math.abs(g-tt)<=W*Math.max(1,Math.abs(g),Math.abs(tt))&&Math.abs(x-Ve)<=W*Math.max(1,Math.abs(x),Math.abs(Ve))&&Math.abs(C-ce)<=W*Math.max(1,Math.abs(C),Math.abs(ce))&&Math.abs(E-Me)<=W*Math.max(1,Math.abs(E),Math.abs(Me))&&Math.abs(A-Ue)<=W*Math.max(1,Math.abs(A),Math.abs(Ue))&&Math.abs(L-yt)<=W*Math.max(1,Math.abs(L),Math.abs(yt))&&Math.abs(V-jt)<=W*Math.max(1,Math.abs(V),Math.abs(jt))&&Math.abs(H-_t)<=W*Math.max(1,Math.abs(H),Math.abs(_t))&&Math.abs(X-Et)<=W*Math.max(1,Math.abs(X),Math.abs(Et))&&Math.abs(K-ri)<=W*Math.max(1,Math.abs(K),Math.abs(ri))&&Math.abs(ae-Zt)<=W*Math.max(1,Math.abs(ae),Math.abs(Zt))&&Math.abs(ue-si)<=W*Math.max(1,Math.abs(ue),Math.abs(si))&&Math.abs(de-Ft)<=W*Math.max(1,Math.abs(de),Math.abs(Ft))&&Math.abs(ge-Ti)<=W*Math.max(1,Math.abs(ge),Math.abs(Ti))&&Math.abs(Te-Ki)<=W*Math.max(1,Math.abs(Te),Math.abs(Ki))&&Math.abs(Ne-Wi)<=W*Math.max(1,Math.abs(Ne),Math.abs(Wi))},o.b_=function(m,h){return m[0]=h[0],m[1]=h[1],m[2]=h[2],m[3]=h[3],m[4]=h[4],m[5]=h[5],m[6]=h[6],m[7]=h[7],m[8]=h[8],m[9]=h[9],m[10]=h[10],m[11]=h[11],m[12]=h[12],m[13]=h[13],m[14]=h[14],m[15]=h[15],m},o.ba=yb,o.bb=Wv,o.bc=Fe,o.bd=He,o.be=Ds,o.bf=function(m,h,g,x,C){return Fe(x,C,ct((m-h)/(g-h),0,1))},o.bg=fe,o.bh=function(){return new Float64Array(4)},o.bi=function(){return new Float64Array(3)},o.bj=function(m,h,g,x){var C=[],E=[];return C[0]=h[0]-g[0],C[1]=h[1]-g[1],C[2]=h[2]-g[2],E[0]=C[0]*Math.cos(x)-C[1]*Math.sin(x),E[1]=C[0]*Math.sin(x)+C[1]*Math.cos(x),E[2]=C[2],m[0]=E[0]+g[0],m[1]=E[1]+g[1],m[2]=E[2]+g[2],m},o.bk=function(m,h,g,x){var C=[],E=[];return C[0]=h[0]-g[0],C[1]=h[1]-g[1],C[2]=h[2]-g[2],E[0]=C[0],E[1]=C[1]*Math.cos(x)-C[2]*Math.sin(x),E[2]=C[1]*Math.sin(x)+C[2]*Math.cos(x),m[0]=E[0]+g[0],m[1]=E[1]+g[1],m[2]=E[2]+g[2],m},o.bl=function(m,h,g,x){var C=[],E=[];return C[0]=h[0]-g[0],C[1]=h[1]-g[1],C[2]=h[2]-g[2],E[0]=C[2]*Math.sin(x)+C[0]*Math.cos(x),E[1]=C[1],E[2]=C[2]*Math.cos(x)-C[0]*Math.sin(x),m[0]=E[0]+g[0],m[1]=E[1]+g[1],m[2]=E[2]+g[2],m},o.bm=function(m,h,g){var x=Math.sin(g),C=Math.cos(g),E=h[0],A=h[1],L=h[2],V=h[3],H=h[8],X=h[9],K=h[10],ae=h[11];return h!==m&&(m[4]=h[4],m[5]=h[5],m[6]=h[6],m[7]=h[7],m[12]=h[12],m[13]=h[13],m[14]=h[14],m[15]=h[15]),m[0]=E*C-H*x,m[1]=A*C-X*x,m[2]=L*C-K*x,m[3]=V*C-ae*x,m[8]=E*x+H*C,m[9]=A*x+X*C,m[10]=L*x+K*C,m[11]=V*x+ae*C,m},o.bn=function(m,h){const g=fe(m,360),x=fe(h,360),C=x-g,E=x>g?C-360:C+360;return Math.abs(C)<Math.abs(E)?C:E},o.bo=function(m){return m[0]=0,m[1]=0,m[2]=0,m},o.bp=function(m,h,g,x){const C=Math.sqrt(m*m+h*h),E=Math.sqrt(g*g+x*x);m/=C,h/=C,g/=E,x/=E;const A=Math.acos(m*g+h*x);return-h*g+m*x>0?A:-A},o.bq=function(m,h){return m[0]*h[0]+m[1]*h[1]+m[2]*h[2]+m[3]},o.br=U2,o.bs=function(m,h){const g=fe(m,2*Math.PI),x=fe(h,2*Math.PI);return Math.min(Math.abs(g-x),Math.abs(g-x+2*Math.PI),Math.abs(g-x-2*Math.PI))},o.bt=function(m){return Math.hypot(m[0],m[1],m[2])},o.bu=function(){const m={},h=ee.$version;for(const g in ee.$root){const x=ee.$root[g];if(x.required){let C=null;C=g==="version"?h:x.type==="array"?[]:{},C!=null&&(m[g]=C)}}return m},o.bv=Kx,o.bw=fi,o.bx=function(m){m=m.slice();const h=Object.create(null);for(let g=0;g<m.length;g++)h[m[g].id]=m[g];for(let g=0;g<m.length;g++)"ref"in m[g]&&(m[g]=Se(m[g],h[m[g].ref]));return m},o.by=function(m){if(m.type==="custom")return new lae(m);switch(m.type){case"background":return new sae(m);case"circle":return new eoe(m);case"fill":return new xoe(m);case"fill-extrusion":return new Toe(m);case"heatmap":return new ioe(m);case"hillshade":return new roe(m);case"line":return new Loe(m);case"raster":return new aae(m);case"symbol":return new u1(m)}},o.bz=Qt,o.c=$e,o.c0=m=>m.type==="circle",o.c1=m=>m.type==="heatmap",o.c2=m=>m.type==="line",o.c3=m=>m.type==="fill",o.c4=m=>m.type==="fill-extrusion",o.c5=m=>m.type==="hillshade",o.c6=m=>m.type==="raster",o.c7=m=>m.type==="background",o.c8=m=>m.type==="custom",o.c9=je,o.cA=class{constructor(m){this._marks={start:[m.url,"start"].join("#"),end:[m.url,"end"].join("#"),measure:m.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let m=performance.getEntriesByName(this._marks.measure);return m.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),m=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),m}},o.cB=function(m,h,g,x,C){return a(this,void 0,void 0,function*(){if(k())try{return yield Pe(m,h,g,x,C)}catch{}return function(E,A,L,V,H){const X=E.width,K=E.height;Ye&&Ct||(Ye=new OffscreenCanvas(X,K),Ct=Ye.getContext("2d",{willReadFrequently:!0})),Ye.width=X,Ye.height=K,Ct.drawImage(E,0,0,X,K);const ae=Ct.getImageData(A,L,V,H);return Ct.clearRect(0,0,X,K),ae.data}(m,h,g,x,C)})},o.cC=$8,o.cD=l,o.cE=p,o.cF=l8,o.cG=b8,o.cH=Tv,o.cI=iu,o.ca=function(m,h,g){const x=le(h.x-g.x,h.y-g.y),C=le(m.x-g.x,m.y-g.y);var E,A;return we(Math.atan2(x[0]*C[1]-x[1]*C[0],(E=x)[0]*(A=C)[0]+E[1]*A[1]))},o.cb=qe,o.cc=function(m,h){return xe[h]&&(m instanceof MouseEvent||m instanceof WheelEvent)},o.cd=function(m,h){return he[h]&&"touches"in m},o.ce=function(m){return he[m]||xe[m]},o.cf=function(m,h,g){var x=h[0],C=h[1];return m[0]=g[0]*x+g[4]*C+g[12],m[1]=g[1]*x+g[5]*C+g[13],m},o.cg=function(m,h){const{x:g,y:x}=Mb.fromLngLat(h);return!(m<0||m>25||x<0||x>=1||g<0||g>=1)},o.ch=function(m,h){return m[0]=h[0],m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=h[1],m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=h[2],m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},o.ci=class extends fc{},o.cj=xae,o.cl=function(m){return m.message===Be},o.cm=Nt,o.cn=function(m,h){Ze.REGISTERED_PROTOCOLS[m]=h},o.co=function(m){delete Ze.REGISTERED_PROTOCOLS[m]},o.cp=function(m,h){const g={};for(let C=0;C<m.length;C++){const E=h&&h[m[C].id]||s2(m[C]);h&&(h[m[C].id]=E);let A=g[E];A||(A=g[E]=[]),A.push(m[C])}const x=[];for(const C in g)x.push(g[C]);return x},o.cq=wi,o.cr=W8,o.cs=j8,o.ct=_8,o.cu=function(m){m.bucket.createArrays(),m.bucket.tilePixelRatio=me/(512*m.bucket.overscaling),m.bucket.compareText={},m.bucket.iconsNeedLinear=!1;const h=m.bucket.layers[0],g=h.layout,x=h._unevaluatedLayout._values,C={layoutIconSize:x["icon-size"].possiblyEvaluate(new Tr(m.bucket.zoom+1),m.canonical),layoutTextSize:x["text-size"].possiblyEvaluate(new Tr(m.bucket.zoom+1),m.canonical),textMaxSize:x["text-size"].possiblyEvaluate(new Tr(18))};if(m.bucket.textSizeData.kind==="composite"){const{minZoom:H,maxZoom:X}=m.bucket.textSizeData;C.compositeTextSizes=[x["text-size"].possiblyEvaluate(new Tr(H),m.canonical),x["text-size"].possiblyEvaluate(new Tr(X),m.canonical)]}if(m.bucket.iconSizeData.kind==="composite"){const{minZoom:H,maxZoom:X}=m.bucket.iconSizeData;C.compositeIconSizes=[x["icon-size"].possiblyEvaluate(new Tr(H),m.canonical),x["icon-size"].possiblyEvaluate(new Tr(X),m.canonical)]}const E=g.get("text-line-height")*Fs,A=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point",L=g.get("text-keep-upright"),V=g.get("text-size");for(const H of m.bucket.features){const X=g.get("text-font").evaluate(H,{},m.canonical).join(","),K=V.evaluate(H,{},m.canonical),ae=C.layoutTextSize.evaluate(H,{},m.canonical),ue=C.layoutIconSize.evaluate(H,{},m.canonical),de={horizontal:{},vertical:void 0},ge=H.text;let Te,Ne=[0,0];if(ge){const ce=ge.toString(),Me=g.get("text-letter-spacing").evaluate(H,{},m.canonical)*Fs,Ue=WS(ce)?Me:0,yt=g.get("text-anchor").evaluate(H,{},m.canonical),jt=s4(h,H,m.canonical);if(!jt){const Zt=g.get("text-radial-offset").evaluate(H,{},m.canonical);Ne=Zt?r4(yt,[Zt*Fs,W2]):g.get("text-offset").evaluate(H,{},m.canonical).map(si=>si*Fs)}let _t=A?"center":g.get("text-justify").evaluate(H,{},m.canonical);const Et=g.get("symbol-placement")==="point"?g.get("text-max-width").evaluate(H,{},m.canonical)*Fs:1/0,ri=()=>{m.bucket.allowVerticalPlacement&&Lv(ce)&&(de.vertical=a1(ge,m.glyphMap,m.glyphPositions,m.imagePositions,X,Et,E,yt,"left",Ue,Ne,o.ah.vertical,!0,ae,K))};if(!A&&jt){const Zt=new Set;if(_t==="auto")for(let Ft=0;Ft<jt.values.length;Ft+=2)Zt.add(q2(jt.values[Ft]));else Zt.add(_t);let si=!1;for(const Ft of Zt)if(!de.horizontal[Ft])if(si)de.horizontal[Ft]=de.horizontal[0];else{const Ti=a1(ge,m.glyphMap,m.glyphPositions,m.imagePositions,X,Et,E,"center",Ft,Ue,Ne,o.ah.horizontal,!1,ae,K);Ti&&(de.horizontal[Ft]=Ti,si=Ti.positionedLines.length===1)}ri()}else{_t==="auto"&&(_t=q2(yt));const Zt=a1(ge,m.glyphMap,m.glyphPositions,m.imagePositions,X,Et,E,yt,_t,Ue,Ne,o.ah.horizontal,!1,ae,K);Zt&&(de.horizontal[_t]=Zt),ri(),Lv(ce)&&A&&L&&(de.vertical=a1(ge,m.glyphMap,m.glyphPositions,m.imagePositions,X,Et,E,yt,_t,Ue,Ne,o.ah.vertical,!1,ae,K))}}let tt=!1;if(H.icon&&H.icon.name){const ce=m.imageMap[H.icon.name];ce&&(Te=eae(m.imagePositions[H.icon.name],g.get("icon-offset").evaluate(H,{},m.canonical),g.get("icon-anchor").evaluate(H,{},m.canonical)),tt=!!ce.sdf,m.bucket.sdfIcons===void 0?m.bucket.sdfIcons=tt:m.bucket.sdfIcons!==tt&&Jt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ce.pixelRatio!==m.bucket.pixelRatio||g.get("icon-rotate").constantOr(1)!==0)&&(m.bucket.iconsNeedLinear=!0))}const Ve=a4(de.horizontal)||de.vertical;m.bucket.iconsInText=!!Ve&&Ve.iconsInText,(Ve||Te)&&vae(m.bucket,H,de,Te,m.imageMap,C,ae,ue,Ne,tt,m.canonical,m.subdivisionGranularity)}m.showCollisionBoxes&&m.bucket.generateCollisionDebugBuffers()},o.cv=P2,o.cw=C2,o.cx=R2,o.cy=bb,o.cz=I2,o.d=ni,o.e=Je,o.f=m=>a(void 0,void 0,void 0,function*(){if(m.byteLength===0)return createImageBitmap(new ImageData(1,1));const h=new Blob([new Uint8Array(m)],{type:"image/png"});try{return createImageBitmap(h)}catch(g){throw new Error(`Could not load image because of ${g.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),o.g=Lt,o.h=m=>new Promise((h,g)=>{const x=new Image;x.onload=()=>{h(x),URL.revokeObjectURL(x.src),x.onload=null,window.requestAnimationFrame(()=>{x.src=it})},x.onerror=()=>g(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new Blob([new Uint8Array(m)],{type:"image/png"});x.src=m.byteLength?URL.createObjectURL(C):it}),o.i=Ut,o.j=(m,h)=>Pt(Je(m,{type:"json"}),h),o.k=oe,o.l=Ce,o.m=Pt,o.n=(m,h)=>Pt(Je(m,{type:"arrayBuffer"}),h),o.o=function(m){return new I2(m).readFields(Uoe,[])},o.p=w8,o.q=fb,o.r=ea,o.s=st,o.t=Zx,o.u=An,o.v=ee,o.w=Jt,o.x=Mf,o.y=Kh,o.z=function([m,h,g]){return h+=90,h*=Math.PI/180,g*=Math.PI/180,{x:m*Math.cos(h)*Math.sin(g),y:m*Math.sin(h)*Math.sin(g),z:m*Math.cos(g)}}}),r("worker",["./shared"],function(o){class a{constructor(oe){this.keyCache={},oe&&this.replace(oe)}replace(oe){this._layerConfigs={},this._layers={},this.update(oe,[])}update(oe,re){for(const te of oe){this._layerConfigs[te.id]=te;const Se=this._layers[te.id]=o.by(te);Se._featureFilter=o.a7(Se.filter),this.keyCache[te.id]&&delete this.keyCache[te.id]}for(const te of re)delete this.keyCache[te],delete this._layerConfigs[te],delete this._layers[te];this.familiesBySource={};const ee=o.cp(Object.values(this._layerConfigs),this.keyCache);for(const te of ee){const Se=te.map(lt=>this._layers[lt.id]),ve=Se[0];if(ve.visibility==="none")continue;const Ae=ve.source||"";let ke=this.familiesBySource[Ae];ke||(ke=this.familiesBySource[Ae]={});const Xe=ve.sourceLayer||"_geojsonTileLayer";let ut=ke[Xe];ut||(ut=ke[Xe]=[]),ut.push(Se)}}}class l{constructor(oe){const re={},ee=[];for(const Ae in oe){const ke=oe[Ae],Xe=re[Ae]={};for(const ut in ke){const lt=ke[+ut];if(!lt||lt.bitmap.width===0||lt.bitmap.height===0)continue;const Tt={x:0,y:0,w:lt.bitmap.width+2,h:lt.bitmap.height+2};ee.push(Tt),Xe[ut]={rect:Tt,metrics:lt.metrics}}}const{w:te,h:Se}=o.p(ee),ve=new o.q({width:te||1,height:Se||1});for(const Ae in oe){const ke=oe[Ae];for(const Xe in ke){const ut=ke[+Xe];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const lt=re[Ae][Xe].rect;o.q.copy(ut.bitmap,ve,{x:0,y:0},{x:lt.x+1,y:lt.y+1},ut.bitmap)}}this.image=ve,this.positions=re}}o.cq("GlyphAtlas",l);class u{constructor(oe){this.tileID=new o.Y(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.uid=oe.uid,this.zoom=oe.zoom,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.collectResourceTiming,this.returnDependencies=!!oe.returnDependencies,this.promoteId=oe.promoteId,this.inFlightDependencies=[]}parse(oe,re,ee,te,Se){return o._(this,void 0,void 0,function*(){this.status="parsing",this.data=oe,this.collisionBoxArray=new o.a5;const ve=new o.cr(Object.keys(oe.layers).sort()),Ae=new o.cs(this.tileID,this.promoteId);Ae.bucketLayerIDs=[];const ke={},Xe={featureIndex:Ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee,subdivisionGranularity:Se},ut=re.familiesBySource[this.source];for(const li in ut){const dn=oe.layers[li];if(!dn)continue;dn.version===1&&o.w(`Vector tile source "${this.source}" layer "${li}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const br=ve.encode(li),Ka=[];for(let Qi=0;Qi<dn.length;Qi++){const fs=dn.feature(Qi),wr=Ae.getId(fs,li);Ka.push({feature:fs,id:wr,index:Qi,sourceLayerIndex:br})}for(const Qi of ut[li]){const fs=Qi[0];fs.source!==this.source&&o.w(`layer.source = ${fs.source} does not equal this.source = ${this.source}`),fs.minzoom&&this.zoom<Math.floor(fs.minzoom)||fs.maxzoom&&this.zoom>=fs.maxzoom||fs.visibility!=="none"&&(d(Qi,this.zoom,ee),(ke[fs.id]=fs.createBucket({index:Ae.bucketLayerIDs.length,layers:Qi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:br,sourceID:this.source})).populate(Ka,Xe,this.tileID.canonical),Ae.bucketLayerIDs.push(Qi.map(wr=>wr.id)))}}const lt=o.bD(Xe.glyphDependencies,li=>Object.keys(li).map(Number));this.inFlightDependencies.forEach(li=>li?.abort()),this.inFlightDependencies=[];let Tt=Promise.resolve({});if(Object.keys(lt).length){const li=new AbortController;this.inFlightDependencies.push(li),Tt=te.sendAsync({type:"GG",data:{stacks:lt,source:this.source,tileID:this.tileID,type:"glyphs"}},li)}const zt=Object.keys(Xe.iconDependencies);let ii=Promise.resolve({});if(zt.length){const li=new AbortController;this.inFlightDependencies.push(li),ii=te.sendAsync({type:"GI",data:{icons:zt,source:this.source,tileID:this.tileID,type:"icons"}},li)}const xt=Object.keys(Xe.patternDependencies);let tn=Promise.resolve({});if(xt.length){const li=new AbortController;this.inFlightDependencies.push(li),tn=te.sendAsync({type:"GI",data:{icons:xt,source:this.source,tileID:this.tileID,type:"patterns"}},li)}const[Ni,ji,Pn]=yield Promise.all([Tt,ii,tn]),qt=new l(Ni),Oi=new o.ct(ji,Pn);for(const li in ke){const dn=ke[li];dn instanceof o.a6?(d(dn.layers,this.zoom,ee),o.cu({bucket:dn,glyphMap:Ni,glyphPositions:qt.positions,imageMap:ji,imagePositions:Oi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Xe.subdivisionGranularity})):dn.hasPattern&&(dn instanceof o.cv||dn instanceof o.cw||dn instanceof o.cx)&&(d(dn.layers,this.zoom,ee),dn.addFeatures(Xe,this.tileID.canonical,Oi.patternPositions))}return this.status="done",{buckets:Object.values(ke).filter(li=>!li.isEmpty()),featureIndex:Ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qt.image,imageAtlas:Oi,glyphMap:this.returnDependencies?Ni:null,iconMap:this.returnDependencies?ji:null,glyphPositions:this.returnDependencies?qt.positions:null}})}}function d(Ce,oe,re){const ee=new o.C(oe);for(const te of Ce)te.recalculate(ee,re)}class p{constructor(oe,re,ee){this.actor=oe,this.layerIndex=re,this.availableImages=ee,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(oe,re){return o._(this,void 0,void 0,function*(){const ee=yield o.n(oe.request,re);try{return{vectorTile:new o.cy.VectorTile(new o.cz(ee.data)),rawData:ee.data,cacheControl:ee.cacheControl,expires:ee.expires}}catch(te){const Se=new Uint8Array(ee.data);let ve=`Unable to parse the tile at ${oe.request.url}, `;throw ve+=Se[0]===31&&Se[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${te.message}`,new Error(ve)}})}loadTile(oe){return o._(this,void 0,void 0,function*(){const re=oe.uid,ee=!!(oe&&oe.request&&oe.request.collectResourceTiming)&&new o.cA(oe.request),te=new u(oe);this.loading[re]=te;const Se=new AbortController;te.abort=Se;try{const ve=yield this.loadVectorTile(oe,Se);if(delete this.loading[re],!ve)return null;const Ae=ve.rawData,ke={};ve.expires&&(ke.expires=ve.expires),ve.cacheControl&&(ke.cacheControl=ve.cacheControl);const Xe={};if(ee){const lt=ee.finish();lt&&(Xe.resourceTiming=JSON.parse(JSON.stringify(lt)))}te.vectorTile=ve.vectorTile;const ut=te.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor,oe.subdivisionGranularity);this.loaded[re]=te,this.fetching[re]={rawTileData:Ae,cacheControl:ke,resourceTiming:Xe};try{const lt=yield ut;return o.e({rawTileData:Ae.slice(0)},lt,ke,Xe)}finally{delete this.fetching[re]}}catch(ve){throw delete this.loading[re],te.status="done",this.loaded[re]=te,ve}})}reloadTile(oe){return o._(this,void 0,void 0,function*(){const re=oe.uid;if(!this.loaded||!this.loaded[re])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ee=this.loaded[re];if(ee.showCollisionBoxes=oe.showCollisionBoxes,ee.status==="parsing"){const te=yield ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor,oe.subdivisionGranularity);let Se;if(this.fetching[re]){const{rawTileData:ve,cacheControl:Ae,resourceTiming:ke}=this.fetching[re];delete this.fetching[re],Se=o.e({rawTileData:ve.slice(0)},te,Ae,ke)}else Se=te;return Se}if(ee.status==="done"&&ee.vectorTile)return ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor,oe.subdivisionGranularity)})}abortTile(oe){return o._(this,void 0,void 0,function*(){const re=this.loading,ee=oe.uid;re&&re[ee]&&re[ee].abort&&(re[ee].abort.abort(),delete re[ee])})}removeTile(oe){return o._(this,void 0,void 0,function*(){this.loaded&&this.loaded[oe.uid]&&delete this.loaded[oe.uid]})}}class v{constructor(){this.loaded={}}loadTile(oe){return o._(this,void 0,void 0,function*(){const{uid:re,encoding:ee,rawImageData:te,redFactor:Se,greenFactor:ve,blueFactor:Ae,baseShift:ke}=oe,Xe=te.width+2,ut=te.height+2,lt=o.b(te)?new o.R({width:Xe,height:ut},yield o.cB(te,-1,-1,Xe,ut)):te,Tt=new o.cC(re,lt,ee,Se,ve,Ae,ke);return this.loaded=this.loaded||{},this.loaded[re]=Tt,Tt})}removeTile(oe){const re=this.loaded,ee=oe.uid;re&&re[ee]&&delete re[ee]}}var y,w,R=function(){if(w)return y;function Ce(re,ee){if(re.length!==0){oe(re[0],ee);for(var te=1;te<re.length;te++)oe(re[te],!ee)}}function oe(re,ee){for(var te=0,Se=0,ve=0,Ae=re.length,ke=Ae-1;ve<Ae;ke=ve++){var Xe=(re[ve][0]-re[ke][0])*(re[ke][1]+re[ve][1]),ut=te+Xe;Se+=Math.abs(te)>=Math.abs(Xe)?te-ut+Xe:Xe-ut+te,te=ut}te+Se>=0!=!!ee&&re.reverse()}return w=1,y=function re(ee,te){var Se,ve=ee&&ee.type;if(ve==="FeatureCollection")for(Se=0;Se<ee.features.length;Se++)re(ee.features[Se],te);else if(ve==="GeometryCollection")for(Se=0;Se<ee.geometries.length;Se++)re(ee.geometries[Se],te);else if(ve==="Feature")re(ee.geometry,te);else if(ve==="Polygon")Ce(ee.coordinates,te);else if(ve==="MultiPolygon")for(Se=0;Se<ee.coordinates.length;Se++)Ce(ee.coordinates[Se],te);return ee}}(),O=o.cD(R);const P=o.cy.VectorTileFeature.prototype.toGeoJSON;class N{constructor(oe){this._feature=oe,this.extent=o.Z,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){const oe=[];for(const re of this._feature.geometry)oe.push([new o.P(re[0],re[1])]);return oe}{const oe=[];for(const re of this._feature.geometry){const ee=[];for(const te of re)ee.push(new o.P(te[0],te[1]));oe.push(ee)}return oe}}toGeoJSON(oe,re,ee){return P.call(this,oe,re,ee)}}class F{constructor(oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.Z,this.length=oe.length,this._features=oe}feature(oe){return new N(this._features[oe])}}var k,$,W,Q={exports:{}},Y=function(){if(W)return Q.exports;W=1;var Ce=o.cG(),oe=function(){if($)return k;$=1;var ut=o.cE(),lt=o.cF().VectorTileFeature;function Tt(ii,xt){this.options=xt||{},this.features=ii,this.length=ii.length}function zt(ii,xt){this.id=typeof ii.id=="number"?ii.id:void 0,this.type=ii.type,this.rawGeometry=ii.type===1?[ii.geometry]:ii.geometry,this.properties=ii.tags,this.extent=xt||4096}return k=Tt,Tt.prototype.feature=function(ii){return new zt(this.features[ii],this.options.extent)},zt.prototype.loadGeometry=function(){var ii=this.rawGeometry;this.geometry=[];for(var xt=0;xt<ii.length;xt++){for(var tn=ii[xt],Ni=[],ji=0;ji<tn.length;ji++)Ni.push(new ut(tn[ji][0],tn[ji][1]));this.geometry.push(Ni)}return this.geometry},zt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ii=this.geometry,xt=1/0,tn=-1/0,Ni=1/0,ji=-1/0,Pn=0;Pn<ii.length;Pn++)for(var qt=ii[Pn],Oi=0;Oi<qt.length;Oi++){var li=qt[Oi];xt=Math.min(xt,li.x),tn=Math.max(tn,li.x),Ni=Math.min(Ni,li.y),ji=Math.max(ji,li.y)}return[xt,Ni,tn,ji]},zt.prototype.toGeoJSON=lt.prototype.toGeoJSON,k}();function re(ut){var lt=new Ce;return function(Tt,zt){for(var ii in Tt.layers)zt.writeMessage(3,ee,Tt.layers[ii])}(ut,lt),lt.finish()}function ee(ut,lt){var Tt;lt.writeVarintField(15,ut.version||1),lt.writeStringField(1,ut.name||""),lt.writeVarintField(5,ut.extent||4096);var zt={keys:[],values:[],keycache:{},valuecache:{}};for(Tt=0;Tt<ut.length;Tt++)zt.feature=ut.feature(Tt),lt.writeMessage(2,te,zt);var ii=zt.keys;for(Tt=0;Tt<ii.length;Tt++)lt.writeStringField(3,ii[Tt]);var xt=zt.values;for(Tt=0;Tt<xt.length;Tt++)lt.writeMessage(4,Xe,xt[Tt])}function te(ut,lt){var Tt=ut.feature;Tt.id!==void 0&&lt.writeVarintField(1,Tt.id),lt.writeMessage(2,Se,ut),lt.writeVarintField(3,Tt.type),lt.writeMessage(4,ke,Tt)}function Se(ut,lt){var Tt=ut.feature,zt=ut.keys,ii=ut.values,xt=ut.keycache,tn=ut.valuecache;for(var Ni in Tt.properties){var ji=Tt.properties[Ni],Pn=xt[Ni];if(ji!==null){Pn===void 0&&(zt.push(Ni),xt[Ni]=Pn=zt.length-1),lt.writeVarint(Pn);var qt=typeof ji;qt!=="string"&&qt!=="boolean"&&qt!=="number"&&(ji=JSON.stringify(ji));var Oi=qt+":"+ji,li=tn[Oi];li===void 0&&(ii.push(ji),tn[Oi]=li=ii.length-1),lt.writeVarint(li)}}}function ve(ut,lt){return(lt<<3)+(7&ut)}function Ae(ut){return ut<<1^ut>>31}function ke(ut,lt){for(var Tt=ut.loadGeometry(),zt=ut.type,ii=0,xt=0,tn=Tt.length,Ni=0;Ni<tn;Ni++){var ji=Tt[Ni],Pn=1;zt===1&&(Pn=ji.length),lt.writeVarint(ve(1,Pn));for(var qt=zt===3?ji.length-1:ji.length,Oi=0;Oi<qt;Oi++){Oi===1&&zt!==1&&lt.writeVarint(ve(2,qt-1));var li=ji[Oi].x-ii,dn=ji[Oi].y-xt;lt.writeVarint(Ae(li)),lt.writeVarint(Ae(dn)),ii+=li,xt+=dn}zt===3&&lt.writeVarint(ve(7,1))}}function Xe(ut,lt){var Tt=typeof ut;Tt==="string"?lt.writeStringField(1,ut):Tt==="boolean"?lt.writeBooleanField(7,ut):Tt==="number"&&(ut%1!=0?lt.writeDoubleField(3,ut):ut<0?lt.writeSVarintField(6,ut):lt.writeVarintField(5,ut))}return Q.exports=re,Q.exports.fromVectorTileJs=re,Q.exports.fromGeojsonVt=function(ut,lt){lt=lt||{};var Tt={};for(var zt in ut)Tt[zt]=new oe(ut[zt].features,lt),Tt[zt].name=zt,Tt[zt].version=lt.version,Tt[zt].extent=lt.extent;return re({layers:Tt})},Q.exports.GeoJSONWrapper=oe,Q.exports}(),M=o.cD(Y);const D={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ce=>Ce},G=Math.fround||(j=new Float32Array(1),Ce=>(j[0]=+Ce,j[0]));var j;const Z=3,ie=5,le=6;class me{constructor(oe){this.options=Object.assign(Object.create(D),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:re,minZoom:ee,maxZoom:te}=this.options;re&&console.time("total time");const Se=`prepare ${oe.length} points`;re&&console.time(Se),this.points=oe;const ve=[];for(let ke=0;ke<oe.length;ke++){const Xe=oe[ke];if(!Xe.geometry)continue;const[ut,lt]=Xe.geometry.coordinates,Tt=G(Fe(ut)),zt=G(He(lt));ve.push(Tt,zt,1/0,ke,-1,1),this.options.reduce&&ve.push(0)}let Ae=this.trees[te+1]=this._createTree(ve);re&&console.timeEnd(Se);for(let ke=te;ke>=ee;ke--){const Xe=+Date.now();Ae=this.trees[ke]=this._createTree(this._cluster(Ae,ke)),re&&console.log("z%d: %d clusters in %dms",ke,Ae.numItems,+Date.now()-Xe)}return re&&console.timeEnd("total time"),this}getClusters(oe,re){let ee=((oe[0]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,oe[1]));let Se=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)ee=-180,Se=180;else if(ee>Se){const lt=this.getClusters([ee,te,180,ve],re),Tt=this.getClusters([-180,te,Se,ve],re);return lt.concat(Tt)}const Ae=this.trees[this._limitZoom(re)],ke=Ae.range(Fe(ee),He(ve),Fe(Se),He(te)),Xe=Ae.data,ut=[];for(const lt of ke){const Tt=this.stride*lt;ut.push(Xe[Tt+ie]>1?be(Xe,Tt,this.clusterProps):this.points[Xe[Tt+Z]])}return ut}getChildren(oe){const re=this._getOriginId(oe),ee=this._getOriginZoom(oe),te="No cluster with the specified id.",Se=this.trees[ee];if(!Se)throw new Error(te);const ve=Se.data;if(re*this.stride>=ve.length)throw new Error(te);const Ae=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),ke=Se.within(ve[re*this.stride],ve[re*this.stride+1],Ae),Xe=[];for(const ut of ke){const lt=ut*this.stride;ve[lt+4]===oe&&Xe.push(ve[lt+ie]>1?be(ve,lt,this.clusterProps):this.points[ve[lt+Z]])}if(Xe.length===0)throw new Error(te);return Xe}getLeaves(oe,re,ee){const te=[];return this._appendLeaves(te,oe,re=re||10,ee=ee||0,0),te}getTile(oe,re,ee){const te=this.trees[this._limitZoom(oe)],Se=Math.pow(2,oe),{extent:ve,radius:Ae}=this.options,ke=Ae/ve,Xe=(ee-ke)/Se,ut=(ee+1+ke)/Se,lt={features:[]};return this._addTileFeatures(te.range((re-ke)/Se,Xe,(re+1+ke)/Se,ut),te.data,re,ee,Se,lt),re===0&&this._addTileFeatures(te.range(1-ke/Se,Xe,1,ut),te.data,Se,ee,Se,lt),re===Se-1&&this._addTileFeatures(te.range(0,Xe,ke/Se,ut),te.data,-1,ee,Se,lt),lt.features.length?lt:null}getClusterExpansionZoom(oe){let re=this._getOriginZoom(oe)-1;for(;re<=this.options.maxZoom;){const ee=this.getChildren(oe);if(re++,ee.length!==1)break;oe=ee[0].properties.cluster_id}return re}_appendLeaves(oe,re,ee,te,Se){const ve=this.getChildren(re);for(const Ae of ve){const ke=Ae.properties;if(ke&&ke.cluster?Se+ke.point_count<=te?Se+=ke.point_count:Se=this._appendLeaves(oe,ke.cluster_id,ee,te,Se):Se<te?Se++:oe.push(Ae),oe.length===ee)break}return Se}_createTree(oe){const re=new o.aC(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<oe.length;ee+=this.stride)re.add(oe[ee],oe[ee+1]);return re.finish(),re.data=oe,re}_addTileFeatures(oe,re,ee,te,Se,ve){for(const Ae of oe){const ke=Ae*this.stride,Xe=re[ke+ie]>1;let ut,lt,Tt;if(Xe)ut=fe(re,ke,this.clusterProps),lt=re[ke],Tt=re[ke+1];else{const xt=this.points[re[ke+Z]];ut=xt.properties;const[tn,Ni]=xt.geometry.coordinates;lt=Fe(tn),Tt=He(Ni)}const zt={type:1,geometry:[[Math.round(this.options.extent*(lt*Se-ee)),Math.round(this.options.extent*(Tt*Se-te))]],tags:ut};let ii;ii=Xe||this.options.generateId?re[ke+Z]:this.points[re[ke+Z]].id,ii!==void 0&&(zt.id=ii),ve.features.push(zt)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,re){const{radius:ee,extent:te,reduce:Se,minPoints:ve}=this.options,Ae=ee/(te*Math.pow(2,re)),ke=oe.data,Xe=[],ut=this.stride;for(let lt=0;lt<ke.length;lt+=ut){if(ke[lt+2]<=re)continue;ke[lt+2]=re;const Tt=ke[lt],zt=ke[lt+1],ii=oe.within(ke[lt],ke[lt+1],Ae),xt=ke[lt+ie];let tn=xt;for(const Ni of ii){const ji=Ni*ut;ke[ji+2]>re&&(tn+=ke[ji+ie])}if(tn>xt&&tn>=ve){let Ni,ji=Tt*xt,Pn=zt*xt,qt=-1;const Oi=((lt/ut|0)<<5)+(re+1)+this.points.length;for(const li of ii){const dn=li*ut;if(ke[dn+2]<=re)continue;ke[dn+2]=re;const br=ke[dn+ie];ji+=ke[dn]*br,Pn+=ke[dn+1]*br,ke[dn+4]=Oi,Se&&(Ni||(Ni=this._map(ke,lt,!0),qt=this.clusterProps.length,this.clusterProps.push(Ni)),Se(Ni,this._map(ke,dn)))}ke[lt+4]=Oi,Xe.push(ji/tn,Pn/tn,1/0,Oi,-1,tn),Se&&Xe.push(qt)}else{for(let Ni=0;Ni<ut;Ni++)Xe.push(ke[lt+Ni]);if(tn>1)for(const Ni of ii){const ji=Ni*ut;if(!(ke[ji+2]<=re)){ke[ji+2]=re;for(let Pn=0;Pn<ut;Pn++)Xe.push(ke[ji+Pn])}}}}return Xe}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,re,ee){if(oe[re+ie]>1){const ve=this.clusterProps[oe[re+le]];return ee?Object.assign({},ve):ve}const te=this.points[oe[re+Z]].properties,Se=this.options.map(te);return ee&&Se===te?Object.assign({},Se):Se}}function be(Ce,oe,re){return{type:"Feature",id:Ce[oe+Z],properties:fe(Ce,oe,re),geometry:{type:"Point",coordinates:[(ee=Ce[oe],360*(ee-.5)),je(Ce[oe+1])]}};var ee}function fe(Ce,oe,re){const ee=Ce[oe+ie],te=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,Se=Ce[oe+le],ve=Se===-1?{}:Object.assign({},re[Se]);return Object.assign(ve,{cluster:!0,cluster_id:Ce[oe+Z],point_count:ee,point_count_abbreviated:te})}function Fe(Ce){return Ce/360+.5}function He(Ce){const oe=Math.sin(Ce*Math.PI/180),re=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return re<0?0:re>1?1:re}function je(Ce){const oe=(180-360*Ce)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function qe(Ce,oe,re,ee){let te=ee;const Se=oe+(re-oe>>1);let ve,Ae=re-oe;const ke=Ce[oe],Xe=Ce[oe+1],ut=Ce[re],lt=Ce[re+1];for(let Tt=oe+3;Tt<re;Tt+=3){const zt=ct(Ce[Tt],Ce[Tt+1],ke,Xe,ut,lt);if(zt>te)ve=Tt,te=zt;else if(zt===te){const ii=Math.abs(Tt-Se);ii<Ae&&(ve=Tt,Ae=ii)}}te>ee&&(ve-oe>3&&qe(Ce,oe,ve,ee),Ce[ve+2]=te,re-ve>3&&qe(Ce,ve,re,ee))}function ct(Ce,oe,re,ee,te,Se){let ve=te-re,Ae=Se-ee;if(ve!==0||Ae!==0){const ke=((Ce-re)*ve+(oe-ee)*Ae)/(ve*ve+Ae*Ae);ke>1?(re=te,ee=Se):ke>0&&(re+=ve*ke,ee+=Ae*ke)}return ve=Ce-re,Ae=oe-ee,ve*ve+Ae*Ae}function Ge(Ce,oe,re,ee){const te={id:Ce??null,type:oe,geometry:re,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")Je(te,re);else if(oe==="Polygon")Je(te,re[0]);else if(oe==="MultiLineString")for(const Se of re)Je(te,Se);else if(oe==="MultiPolygon")for(const Se of re)Je(te,Se[0]);return te}function Je(Ce,oe){for(let re=0;re<oe.length;re+=3)Ce.minX=Math.min(Ce.minX,oe[re]),Ce.minY=Math.min(Ce.minY,oe[re+1]),Ce.maxX=Math.max(Ce.maxX,oe[re]),Ce.maxY=Math.max(Ce.maxY,oe[re+1])}function mt(Ce,oe,re,ee){if(!oe.geometry)return;const te=oe.geometry.coordinates;if(te&&te.length===0)return;const Se=oe.geometry.type,ve=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2);let Ae=[],ke=oe.id;if(re.promoteId?ke=oe.properties[re.promoteId]:re.generateId&&(ke=ee||0),Se==="Point")wt(te,Ae);else if(Se==="MultiPoint")for(const Xe of te)wt(Xe,Ae);else if(Se==="LineString")Ot(te,Ae,ve,!1);else if(Se==="MultiLineString"){if(re.lineMetrics){for(const Xe of te)Ae=[],Ot(Xe,Ae,ve,!1),Ce.push(Ge(ke,"LineString",Ae,oe.properties));return}Qt(te,Ae,ve,!1)}else if(Se==="Polygon")Qt(te,Ae,ve,!0);else{if(Se!=="MultiPolygon"){if(Se==="GeometryCollection"){for(const Xe of oe.geometry.geometries)mt(Ce,{id:ke,geometry:Xe,properties:oe.properties},re,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Xe of te){const ut=[];Qt(Xe,ut,ve,!0),Ae.push(ut)}}Ce.push(Ge(ke,Se,Ae,oe.properties))}function wt(Ce,oe){oe.push(ei(Ce[0]),Jt(Ce[1]),0)}function Ot(Ce,oe,re,ee){let te,Se,ve=0;for(let ke=0;ke<Ce.length;ke++){const Xe=ei(Ce[ke][0]),ut=Jt(Ce[ke][1]);oe.push(Xe,ut,0),ke>0&&(ve+=ee?(te*ut-Xe*Se)/2:Math.sqrt(Math.pow(Xe-te,2)+Math.pow(ut-Se,2))),te=Xe,Se=ut}const Ae=oe.length-3;oe[2]=1,qe(oe,0,Ae,re),oe[Ae+2]=1,oe.size=Math.abs(ve),oe.start=0,oe.end=oe.size}function Qt(Ce,oe,re,ee){for(let te=0;te<Ce.length;te++){const Se=[];Ot(Ce[te],Se,re,ee),oe.push(Se)}}function ei(Ce){return Ce/360+.5}function Jt(Ce){const oe=Math.sin(Ce*Math.PI/180),re=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return re<0?0:re>1?1:re}function Yt(Ce,oe,re,ee,te,Se,ve,Ae){if(ee/=oe,Se>=(re/=oe)&&ve<ee)return Ce;if(ve<re||Se>=ee)return null;const ke=[];for(const Xe of Ce){const ut=Xe.geometry;let lt=Xe.type;const Tt=te===0?Xe.minX:Xe.minY,zt=te===0?Xe.maxX:Xe.maxY;if(Tt>=re&&zt<ee){ke.push(Xe);continue}if(zt<re||Tt>=ee)continue;let ii=[];if(lt==="Point"||lt==="MultiPoint")Ut(ut,ii,re,ee,te);else if(lt==="LineString")Re(ut,ii,re,ee,te,!1,Ae.lineMetrics);else if(lt==="MultiLineString")it(ut,ii,re,ee,te,!1);else if(lt==="Polygon")it(ut,ii,re,ee,te,!0);else if(lt==="MultiPolygon")for(const xt of ut){const tn=[];it(xt,tn,re,ee,te,!0),tn.length&&ii.push(tn)}if(ii.length){if(Ae.lineMetrics&&lt==="LineString"){for(const xt of ii)ke.push(Ge(Xe.id,lt,xt,Xe.tags));continue}lt!=="LineString"&&lt!=="MultiLineString"||(ii.length===1?(lt="LineString",ii=ii[0]):lt="MultiLineString"),lt!=="Point"&&lt!=="MultiPoint"||(lt=ii.length===3?"Point":"MultiPoint"),ke.push(Ge(Xe.id,lt,ii,Xe.tags))}}return ke.length?ke:null}function Ut(Ce,oe,re,ee,te){for(let Se=0;Se<Ce.length;Se+=3){const ve=Ce[Se+te];ve>=re&&ve<=ee&&Pe(oe,Ce[Se],Ce[Se+1],Ce[Se+2])}}function Re(Ce,oe,re,ee,te,Se,ve){let Ae=gi(Ce);const ke=te===0?Ye:Ct;let Xe,ut,lt=Ce.start;for(let tn=0;tn<Ce.length-3;tn+=3){const Ni=Ce[tn],ji=Ce[tn+1],Pn=Ce[tn+2],qt=Ce[tn+3],Oi=Ce[tn+4],li=te===0?Ni:ji,dn=te===0?qt:Oi;let br=!1;ve&&(Xe=Math.sqrt(Math.pow(Ni-qt,2)+Math.pow(ji-Oi,2))),li<re?dn>re&&(ut=ke(Ae,Ni,ji,qt,Oi,re),ve&&(Ae.start=lt+Xe*ut)):li>ee?dn<ee&&(ut=ke(Ae,Ni,ji,qt,Oi,ee),ve&&(Ae.start=lt+Xe*ut)):Pe(Ae,Ni,ji,Pn),dn<re&&li>=re&&(ut=ke(Ae,Ni,ji,qt,Oi,re),br=!0),dn>ee&&li<=ee&&(ut=ke(Ae,Ni,ji,qt,Oi,ee),br=!0),!Se&&br&&(ve&&(Ae.end=lt+Xe*ut),oe.push(Ae),Ae=gi(Ce)),ve&&(lt+=Xe)}let Tt=Ce.length-3;const zt=Ce[Tt],ii=Ce[Tt+1],xt=te===0?zt:ii;xt>=re&&xt<=ee&&Pe(Ae,zt,ii,Ce[Tt+2]),Tt=Ae.length-3,Se&&Tt>=3&&(Ae[Tt]!==Ae[0]||Ae[Tt+1]!==Ae[1])&&Pe(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&oe.push(Ae)}function gi(Ce){const oe=[];return oe.size=Ce.size,oe.start=Ce.start,oe.end=Ce.end,oe}function it(Ce,oe,re,ee,te,Se){for(const ve of Ce)Re(ve,oe,re,ee,te,Se,!1)}function Pe(Ce,oe,re,ee){Ce.push(oe,re,ee)}function Ye(Ce,oe,re,ee,te,Se){const ve=(Se-oe)/(ee-oe);return Pe(Ce,Se,re+(te-re)*ve,1),ve}function Ct(Ce,oe,re,ee,te,Se){const ve=(Se-re)/(te-re);return Pe(Ce,oe+(ee-oe)*ve,Se,1),ve}function st(Ce,oe){const re=[];for(let ee=0;ee<Ce.length;ee++){const te=Ce[ee],Se=te.type;let ve;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")ve=we(te.geometry,oe);else if(Se==="MultiLineString"||Se==="Polygon"){ve=[];for(const Ae of te.geometry)ve.push(we(Ae,oe))}else if(Se==="MultiPolygon"){ve=[];for(const Ae of te.geometry){const ke=[];for(const Xe of Ae)ke.push(we(Xe,oe));ve.push(ke)}}re.push(Ge(te.id,Se,ve,te.tags))}return re}function we(Ce,oe){const re=[];re.size=Ce.size,Ce.start!==void 0&&(re.start=Ce.start,re.end=Ce.end);for(let ee=0;ee<Ce.length;ee+=3)re.push(Ce[ee]+oe,Ce[ee+1],Ce[ee+2]);return re}function he(Ce,oe){if(Ce.transformed)return Ce;const re=1<<Ce.z,ee=Ce.x,te=Ce.y;for(const Se of Ce.features){const ve=Se.geometry,Ae=Se.type;if(Se.geometry=[],Ae===1)for(let ke=0;ke<ve.length;ke+=2)Se.geometry.push(xe(ve[ke],ve[ke+1],oe,re,ee,te));else for(let ke=0;ke<ve.length;ke++){const Xe=[];for(let ut=0;ut<ve[ke].length;ut+=2)Xe.push(xe(ve[ke][ut],ve[ke][ut+1],oe,re,ee,te));Se.geometry.push(Xe)}}return Ce.transformed=!0,Ce}function xe(Ce,oe,re,ee,te,Se){return[Math.round(re*(Ce*ee-te)),Math.round(re*(oe*ee-Se))]}function Be(Ce,oe,re,ee,te){const Se=oe===te.maxZoom?0:te.tolerance/((1<<oe)*te.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:Ce.length,source:null,x:re,y:ee,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ae of Ce)$e(ve,Ae,Se,te);return ve}function $e(Ce,oe,re,ee){const te=oe.geometry,Se=oe.type,ve=[];if(Ce.minX=Math.min(Ce.minX,oe.minX),Ce.minY=Math.min(Ce.minY,oe.minY),Ce.maxX=Math.max(Ce.maxX,oe.maxX),Ce.maxY=Math.max(Ce.maxY,oe.maxY),Se==="Point"||Se==="MultiPoint")for(let Ae=0;Ae<te.length;Ae+=3)ve.push(te[Ae],te[Ae+1]),Ce.numPoints++,Ce.numSimplified++;else if(Se==="LineString")Ze(ve,te,Ce,re,!1,!1);else if(Se==="MultiLineString"||Se==="Polygon")for(let Ae=0;Ae<te.length;Ae++)Ze(ve,te[Ae],Ce,re,Se==="Polygon",Ae===0);else if(Se==="MultiPolygon")for(let Ae=0;Ae<te.length;Ae++){const ke=te[Ae];for(let Xe=0;Xe<ke.length;Xe++)Ze(ve,ke[Xe],Ce,re,!0,Xe===0)}if(ve.length){let Ae=oe.tags||null;if(Se==="LineString"&&ee.lineMetrics){Ae={};for(const Xe in oe.tags)Ae[Xe]=oe.tags[Xe];Ae.mapbox_clip_start=te.start/te.size,Ae.mapbox_clip_end=te.end/te.size}const ke={geometry:ve,type:Se==="Polygon"||Se==="MultiPolygon"?3:Se==="LineString"||Se==="MultiLineString"?2:1,tags:Ae};oe.id!==null&&(ke.id=oe.id),Ce.features.push(ke)}}function Ze(Ce,oe,re,ee,te,Se){const ve=ee*ee;if(ee>0&&oe.size<(te?ve:ee))return void(re.numPoints+=oe.length/3);const Ae=[];for(let ke=0;ke<oe.length;ke+=3)(ee===0||oe[ke+2]>ve)&&(re.numSimplified++,Ae.push(oe[ke],oe[ke+1])),re.numPoints++;te&&function(ke,Xe){let ut=0;for(let lt=0,Tt=ke.length,zt=Tt-2;lt<Tt;zt=lt,lt+=2)ut+=(ke[lt]-ke[zt])*(ke[lt+1]+ke[zt+1]);if(ut>0===Xe)for(let lt=0,Tt=ke.length;lt<Tt/2;lt+=2){const zt=ke[lt],ii=ke[lt+1];ke[lt]=ke[Tt-2-lt],ke[lt+1]=ke[Tt-1-lt],ke[Tt-2-lt]=zt,ke[Tt-1-lt]=ii}}(Ae,Se),Ce.push(Ae)}const Lt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ot{constructor(oe,re){const ee=(re=this.options=function(Se,ve){for(const Ae in ve)Se[Ae]=ve[Ae];return Se}(Object.create(Lt),re)).debug;if(ee&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");let te=function(Se,ve){const Ae=[];if(Se.type==="FeatureCollection")for(let ke=0;ke<Se.features.length;ke++)mt(Ae,Se.features[ke],ve,ke);else mt(Ae,Se.type==="Feature"?Se:{geometry:Se},ve);return Ae}(oe,re);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=function(Se,ve){const Ae=ve.buffer/ve.extent;let ke=Se;const Xe=Yt(Se,1,-1-Ae,Ae,0,-1,2,ve),ut=Yt(Se,1,1-Ae,2+Ae,0,-1,2,ve);return(Xe||ut)&&(ke=Yt(Se,1,-Ae,1+Ae,0,-1,2,ve)||[],Xe&&(ke=st(Xe,1).concat(ke)),ut&&(ke=ke.concat(st(ut,-1)))),ke}(te,re),te.length&&this.splitTile(te,0,0,0),ee&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,re,ee,te,Se,ve,Ae){const ke=[oe,re,ee,te],Xe=this.options,ut=Xe.debug;for(;ke.length;){te=ke.pop(),ee=ke.pop(),re=ke.pop(),oe=ke.pop();const lt=1<<re,Tt=Nt(re,ee,te);let zt=this.tiles[Tt];if(!zt&&(ut>1&&console.time("creation"),zt=this.tiles[Tt]=Be(oe,re,ee,te,Xe),this.tileCoords.push({z:re,x:ee,y:te}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,ee,te,zt.numFeatures,zt.numPoints,zt.numSimplified),console.timeEnd("creation"));const br=`z${re}`;this.stats[br]=(this.stats[br]||0)+1,this.total++}if(zt.source=oe,Se==null){if(re===Xe.indexMaxZoom||zt.numPoints<=Xe.indexMaxPoints)continue}else{if(re===Xe.maxZoom||re===Se)continue;if(Se!=null){const br=Se-re;if(ee!==ve>>br||te!==Ae>>br)continue}}if(zt.source=null,oe.length===0)continue;ut>1&&console.time("clipping");const ii=.5*Xe.buffer/Xe.extent,xt=.5-ii,tn=.5+ii,Ni=1+ii;let ji=null,Pn=null,qt=null,Oi=null,li=Yt(oe,lt,ee-ii,ee+tn,0,zt.minX,zt.maxX,Xe),dn=Yt(oe,lt,ee+xt,ee+Ni,0,zt.minX,zt.maxX,Xe);oe=null,li&&(ji=Yt(li,lt,te-ii,te+tn,1,zt.minY,zt.maxY,Xe),Pn=Yt(li,lt,te+xt,te+Ni,1,zt.minY,zt.maxY,Xe),li=null),dn&&(qt=Yt(dn,lt,te-ii,te+tn,1,zt.minY,zt.maxY,Xe),Oi=Yt(dn,lt,te+xt,te+Ni,1,zt.minY,zt.maxY,Xe),dn=null),ut>1&&console.timeEnd("clipping"),ke.push(ji||[],re+1,2*ee,2*te),ke.push(Pn||[],re+1,2*ee,2*te+1),ke.push(qt||[],re+1,2*ee+1,2*te),ke.push(Oi||[],re+1,2*ee+1,2*te+1)}}getTile(oe,re,ee){oe=+oe,re=+re,ee=+ee;const te=this.options,{extent:Se,debug:ve}=te;if(oe<0||oe>24)return null;const Ae=1<<oe,ke=Nt(oe,re=re+Ae&Ae-1,ee);if(this.tiles[ke])return he(this.tiles[ke],Se);ve>1&&console.log("drilling down to z%d-%d-%d",oe,re,ee);let Xe,ut=oe,lt=re,Tt=ee;for(;!Xe&&ut>0;)ut--,lt>>=1,Tt>>=1,Xe=this.tiles[Nt(ut,lt,Tt)];return Xe&&Xe.source?(ve>1&&(console.log("found parent tile z%d-%d-%d",ut,lt,Tt),console.time("drilling down")),this.splitTile(Xe.source,ut,lt,Tt,oe,re,ee),ve>1&&console.timeEnd("drilling down"),this.tiles[ke]?he(this.tiles[ke],Se):null):null}}function Nt(Ce,oe,re){return 32*((1<<Ce)*re+oe)+Ce}function fi(Ce,oe){return oe?Ce.properties[oe]:Ce.id}function Pt(Ce,oe){if(Ce==null)return!0;if(Ce.type==="Feature")return fi(Ce,oe)!=null;if(Ce.type==="FeatureCollection"){const re=new Set;for(const ee of Ce.features){const te=fi(ee,oe);if(te==null||re.has(te))return!1;re.add(te)}return!0}return!1}function ni(Ce,oe){const re=new Map;if(Ce!=null)if(Ce.type==="Feature")re.set(fi(Ce,oe),Ce);else for(const ee of Ce.features)re.set(fi(ee,oe),ee);return re}class ti extends p{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(oe,re){return o._(this,void 0,void 0,function*(){const ee=oe.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const te=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!te)return null;const Se=new F(te.features);let ve=M(Se);return ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),{vectorTile:Se,rawData:ve.buffer}})}loadData(oe){return o._(this,void 0,void 0,function*(){var re;(re=this._pendingRequest)===null||re===void 0||re.abort();const ee=!!(oe&&oe.request&&oe.request.collectResourceTiming)&&new o.cA(oe.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(oe,this._pendingRequest),this._geoJSONIndex=oe.cluster?new me(function({superclusterOptions:ve,clusterProperties:Ae}){if(!Ae||!ve)return ve;const ke={},Xe={},ut={accumulated:null,zoom:0},lt={properties:null},Tt=Object.keys(Ae);for(const zt of Tt){const[ii,xt]=Ae[zt],tn=o.cH(xt),Ni=o.cH(typeof ii=="string"?[ii,["accumulated"],["get",zt]]:ii);ke[zt]=tn.value,Xe[zt]=Ni.value}return ve.map=zt=>{lt.properties=zt;const ii={};for(const xt of Tt)ii[xt]=ke[xt].evaluate(ut,lt);return ii},ve.reduce=(zt,ii)=>{lt.properties=ii;for(const xt of Tt)ut.accumulated=zt[xt],zt[xt]=Xe[xt].evaluate(ut,lt)},ve}(oe)).load((yield this._pendingData).features):(te=yield this._pendingData,new ot(te,oe.geojsonVtOptions)),this.loaded={};const Se={};if(ee){const ve=ee.finish();ve&&(Se.resourceTiming={},Se.resourceTiming[oe.source]=JSON.parse(JSON.stringify(ve)))}return Se}catch(Se){if(delete this._pendingRequest,o.cl(Se))return{abandoned:!0};throw Se}var te})}getData(){return o._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(oe){const re=this.loaded;return re&&re[oe.uid]?super.reloadTile(oe):this.loadTile(oe)}loadAndProcessGeoJSON(oe,re){return o._(this,void 0,void 0,function*(){let ee=yield this.loadGeoJSON(oe,re);if(delete this._pendingRequest,typeof ee!="object")throw new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`);if(O(ee,!0),oe.filter){const te=o.cH(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map(ve=>`${ve.key}: ${ve.message}`).join(", "));ee={type:"FeatureCollection",features:ee.features.filter(ve=>te.value.evaluate({zoom:0},ve))}}return ee})}loadGeoJSON(oe,re){return o._(this,void 0,void 0,function*(){const{promoteId:ee}=oe;if(oe.request){const te=yield o.j(oe.request,re);return this._dataUpdateable=Pt(te.data,ee)?ni(te.data,ee):void 0,te.data}if(typeof oe.data=="string")try{const te=JSON.parse(oe.data);return this._dataUpdateable=Pt(te,ee)?ni(te,ee):void 0,te}catch{throw new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`)}if(!oe.dataDiff)throw new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${oe.source}`);return function(te,Se,ve){var Ae,ke,Xe,ut;if(Se.removeAll&&te.clear(),Se.remove)for(const lt of Se.remove)te.delete(lt);if(Se.add)for(const lt of Se.add){const Tt=fi(lt,ve);Tt!=null&&te.set(Tt,lt)}if(Se.update)for(const lt of Se.update){let Tt=te.get(lt.id);if(Tt==null)continue;const zt=!lt.removeAllProperties&&(((Ae=lt.removeProperties)===null||Ae===void 0?void 0:Ae.length)>0||((ke=lt.addOrUpdateProperties)===null||ke===void 0?void 0:ke.length)>0);if((lt.newGeometry||lt.removeAllProperties||zt)&&(Tt=Object.assign({},Tt),te.set(lt.id,Tt),zt&&(Tt.properties=Object.assign({},Tt.properties))),lt.newGeometry&&(Tt.geometry=lt.newGeometry),lt.removeAllProperties)Tt.properties={};else if(((Xe=lt.removeProperties)===null||Xe===void 0?void 0:Xe.length)>0)for(const ii of lt.removeProperties)Object.prototype.hasOwnProperty.call(Tt.properties,ii)&&delete Tt.properties[ii];if(((ut=lt.addOrUpdateProperties)===null||ut===void 0?void 0:ut.length)>0)for(const{key:ii,value:xt}of lt.addOrUpdateProperties)Tt.properties[ii]=xt}}(this._dataUpdateable,oe.dataDiff,ee),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(oe){return o._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(oe){return this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId)}getClusterChildren(oe){return this._geoJSONIndex.getChildren(oe.clusterId)}getClusterLeaves(oe){return this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset)}}class nt{constructor(oe){this.self=oe,this.actor=new o.H(oe),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(re,ee)=>{if(this.externalWorkerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.externalWorkerSourceTypes[re]=ee},this.self.addProtocol=o.cn,this.self.removeProtocol=o.co,this.self.registerRTLTextPlugin=re=>{o.cI.setMethods(re)},this.actor.registerMessageHandler("LDT",(re,ee)=>this._getDEMWorkerSource(re,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RDT",(re,ee)=>o._(this,void 0,void 0,function*(){this._getDEMWorkerSource(re,ee.source).removeTile(ee)})),this.actor.registerMessageHandler("GCEZ",(re,ee)=>o._(this,void 0,void 0,function*(){return this._getWorkerSource(re,ee.type,ee.source).getClusterExpansionZoom(ee)})),this.actor.registerMessageHandler("GCC",(re,ee)=>o._(this,void 0,void 0,function*(){return this._getWorkerSource(re,ee.type,ee.source).getClusterChildren(ee)})),this.actor.registerMessageHandler("GCL",(re,ee)=>o._(this,void 0,void 0,function*(){return this._getWorkerSource(re,ee.type,ee.source).getClusterLeaves(ee)})),this.actor.registerMessageHandler("LD",(re,ee)=>this._getWorkerSource(re,ee.type,ee.source).loadData(ee)),this.actor.registerMessageHandler("GD",(re,ee)=>this._getWorkerSource(re,ee.type,ee.source).getData()),this.actor.registerMessageHandler("LT",(re,ee)=>this._getWorkerSource(re,ee.type,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RT",(re,ee)=>this._getWorkerSource(re,ee.type,ee.source).reloadTile(ee)),this.actor.registerMessageHandler("AT",(re,ee)=>this._getWorkerSource(re,ee.type,ee.source).abortTile(ee)),this.actor.registerMessageHandler("RMT",(re,ee)=>this._getWorkerSource(re,ee.type,ee.source).removeTile(ee)),this.actor.registerMessageHandler("RS",(re,ee)=>o._(this,void 0,void 0,function*(){if(!this.workerSources[re]||!this.workerSources[re][ee.type]||!this.workerSources[re][ee.type][ee.source])return;const te=this.workerSources[re][ee.type][ee.source];delete this.workerSources[re][ee.type][ee.source],te.removeSource!==void 0&&te.removeSource(ee)})),this.actor.registerMessageHandler("RM",re=>o._(this,void 0,void 0,function*(){delete this.layerIndexes[re],delete this.availableImages[re],delete this.workerSources[re],delete this.demWorkerSources[re]})),this.actor.registerMessageHandler("SR",(re,ee)=>o._(this,void 0,void 0,function*(){this.referrer=ee})),this.actor.registerMessageHandler("SRPS",(re,ee)=>this._syncRTLPluginState(re,ee)),this.actor.registerMessageHandler("IS",(re,ee)=>o._(this,void 0,void 0,function*(){this.self.importScripts(ee)})),this.actor.registerMessageHandler("SI",(re,ee)=>this._setImages(re,ee)),this.actor.registerMessageHandler("UL",(re,ee)=>o._(this,void 0,void 0,function*(){this._getLayerIndex(re).update(ee.layers,ee.removedIds)})),this.actor.registerMessageHandler("SL",(re,ee)=>o._(this,void 0,void 0,function*(){this._getLayerIndex(re).replace(ee)}))}_setImages(oe,re){return o._(this,void 0,void 0,function*(){this.availableImages[oe]=re;for(const ee in this.workerSources[oe]){const te=this.workerSources[oe][ee];for(const Se in te)te[Se].availableImages=re}})}_syncRTLPluginState(oe,re){return o._(this,void 0,void 0,function*(){return yield o.cI.syncState(re,this.self.importScripts)})}_getAvailableImages(oe){let re=this.availableImages[oe];return re||(re=[]),re}_getLayerIndex(oe){let re=this.layerIndexes[oe];return re||(re=this.layerIndexes[oe]=new a),re}_getWorkerSource(oe,re,ee){if(this.workerSources[oe]||(this.workerSources[oe]={}),this.workerSources[oe][re]||(this.workerSources[oe][re]={}),!this.workerSources[oe][re][ee]){const te={sendAsync:(Se,ve)=>(Se.targetMapId=oe,this.actor.sendAsync(Se,ve))};switch(re){case"vector":this.workerSources[oe][re][ee]=new p(te,this._getLayerIndex(oe),this._getAvailableImages(oe));break;case"geojson":this.workerSources[oe][re][ee]=new ti(te,this._getLayerIndex(oe),this._getAvailableImages(oe));break;default:this.workerSources[oe][re][ee]=new this.externalWorkerSourceTypes[re](te,this._getLayerIndex(oe),this._getAvailableImages(oe))}}return this.workerSources[oe][re][ee]}_getDEMWorkerSource(oe,re){return this.demWorkerSources[oe]||(this.demWorkerSources[oe]={}),this.demWorkerSources[oe][re]||(this.demWorkerSources[oe][re]=new v),this.demWorkerSources[oe][re]}}return o.i(self)&&(self.worker=new nt(self)),nt}),r("index",["exports","./shared"],function(o,a){var l="5.3.0";function u(){var S=new a.A(4);return a.A!=Float32Array&&(S[1]=0,S[2]=0),S[0]=1,S[3]=1,S}let d,p;const v={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(S,c,f){const b=requestAnimationFrame(T=>{_(),c(T)}),{unsubscribe:_}=a.s(S.signal,"abort",()=>{_(),cancelAnimationFrame(b),f(a.c())},!1)},frameAsync(S){return new Promise((c,f)=>{this.frame(S,c,f)})},getImageData(S,c=0){return this.getImageCanvasContext(S).getImageData(-c,-c,S.width+2*c,S.height+2*c)},getImageCanvasContext(S){const c=window.document.createElement("canvas"),f=c.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return c.width=S.width,c.height=S.height,f.drawImage(S,0,0,S.width,S.height),f},resolveURL:S=>(d||(d=document.createElement("a")),d.href=S,d.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(p==null&&(p=matchMedia("(prefers-reduced-motion: reduce)")),p.matches)}};class y{static testProp(c){if(!y.docStyle)return c[0];for(let f=0;f<c.length;f++)if(c[f]in y.docStyle)return c[f];return c[0]}static create(c,f,b){const _=window.document.createElement(c);return f!==void 0&&(_.className=f),b&&b.appendChild(_),_}static createNS(c,f){return window.document.createElementNS(c,f)}static disableDrag(){y.docStyle&&y.selectProp&&(y.userSelect=y.docStyle[y.selectProp],y.docStyle[y.selectProp]="none")}static enableDrag(){y.docStyle&&y.selectProp&&(y.docStyle[y.selectProp]=y.userSelect)}static setTransform(c,f){c.style[y.transformProp]=f}static addEventListener(c,f,b,_={}){c.addEventListener(f,b,"passive"in _?_:_.capture)}static removeEventListener(c,f,b,_={}){c.removeEventListener(f,b,"passive"in _?_:_.capture)}static suppressClickInternal(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",y.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",y.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",y.suppressClickInternal,!0)},0)}static getScale(c){const f=c.getBoundingClientRect();return{x:f.width/c.offsetWidth||1,y:f.height/c.offsetHeight||1,boundingClientRect:f}}static getPoint(c,f,b){const _=f.boundingClientRect;return new a.P((b.clientX-_.left)/f.x-c.clientLeft,(b.clientY-_.top)/f.y-c.clientTop)}static mousePos(c,f){const b=y.getScale(c);return y.getPoint(c,b,f)}static touchPos(c,f){const b=[],_=y.getScale(c);for(let T=0;T<f.length;T++)b.push(y.getPoint(c,_,f[T]));return b}static mouseButton(c){return c.button}static remove(c){c.parentNode&&c.parentNode.removeChild(c)}static sanitize(c){const f=new DOMParser().parseFromString(c,"text/html").body||document.createElement("body"),b=f.querySelectorAll("script");for(const _ of b)_.remove();return y.clean(f),f.innerHTML}static isPossiblyDangerous(c,f){const b=f.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(c)||!b.includes("javascript:")&&!b.includes("data:"))||!!c.startsWith("on")||void 0}static clean(c){const f=c.children;for(const b of f)y.removeAttributes(b),y.clean(b)}static removeAttributes(c){for(const{name:f,value:b}of c.attributes)y.isPossiblyDangerous(f,b)&&c.removeAttribute(f)}}y.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,y.selectProp=y.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),y.transformProp=y.testProp(["transform","WebkitTransform"]);const w={supported:!1,testSupport:function(S){!P&&O&&(N?F(S):R=S)}};let R,O,P=!1,N=!1;function F(S){const c=S.createTexture();S.bindTexture(S.TEXTURE_2D,c);try{if(S.texImage2D(S.TEXTURE_2D,0,S.RGBA,S.RGBA,S.UNSIGNED_BYTE,O),S.isContextLost())return;w.supported=!0}catch{}S.deleteTexture(c),P=!0}var k;typeof document<"u"&&(O=document.createElement("img"),O.onload=()=>{R&&F(R),R=null,N=!0},O.onerror=()=>{P=!0,R=null},O.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(S){let c,f,b,_;S.resetRequestQueue=()=>{c=[],f=0,b=0,_={}},S.addThrottleControl=U=>{const q=b++;return _[q]=U,q},S.removeThrottleControl=U=>{delete _[U],I()},S.getImage=(U,q,J=!0)=>new Promise((se,ne)=>{w.supported&&(U.headers||(U.headers={}),U.headers.accept="image/webp,*/*"),a.e(U,{type:"image"}),c.push({abortController:q,requestParameters:U,supportImageRefresh:J,state:"queued",onError:pe=>{ne(pe)},onSuccess:pe=>{se(pe)}}),I()});const T=U=>a._(this,void 0,void 0,function*(){U.state="running";const{requestParameters:q,supportImageRefresh:J,onError:se,onSuccess:ne,abortController:pe}=U,ye=J===!1&&!a.i(self)&&!a.g(q.url)&&(!q.headers||Object.keys(q.headers).reduce((Le,ze)=>Le&&ze==="accept",!0));f++;const De=ye?z(q,pe):a.m(q,pe);try{const Le=yield De;delete U.abortController,U.state="completed",Le.data instanceof HTMLImageElement||a.b(Le.data)?ne(Le):Le.data&&ne({data:yield(Ee=Le.data,typeof createImageBitmap=="function"?a.f(Ee):a.h(Ee)),cacheControl:Le.cacheControl,expires:Le.expires})}catch(Le){delete U.abortController,se(Le)}finally{f--,I()}var Ee}),I=()=>{const U=(()=>{for(const q of Object.keys(_))if(_[q]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let q=f;q<U&&c.length>0;q++){const J=c.shift();J.abortController.signal.aborted?q--:T(J)}},z=(U,q)=>new Promise((J,se)=>{const ne=new Image,pe=U.url,ye=U.credentials;ye&&ye==="include"?ne.crossOrigin="use-credentials":(ye&&ye==="same-origin"||!a.d(pe))&&(ne.crossOrigin="anonymous"),q.signal.addEventListener("abort",()=>{ne.src="",se(a.c())}),ne.fetchPriority="high",ne.onload=()=>{ne.onerror=ne.onload=null,J({data:ne})},ne.onerror=()=>{ne.onerror=ne.onload=null,q.signal.aborted||se(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ne.src=pe})}(k||(k={})),k.resetRequestQueue();class ${constructor(c){this._transformRequestFn=c}transformRequest(c,f){return this._transformRequestFn&&this._transformRequestFn(c,f)||{url:c}}setTransformRequest(c){this._transformRequestFn=c}}function W(S){const c=[];if(typeof S=="string")c.push({id:"default",url:S});else if(S&&S.length>0){const f=[];for(const{id:b,url:_}of S){const T=`${b}${_}`;f.indexOf(T)===-1&&(f.push(T),c.push({id:b,url:_}))}}return c}function Q(S,c,f){try{const b=new URL(S);return b.pathname+=`${c}${f}`,b.toString()}catch{throw new Error(`Invalid sprite URL "${S}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class Y{constructor(c,f,b,_){this.context=c,this.format=b,this.texture=c.gl.createTexture(),this.update(f,_)}update(c,f,b){const{width:_,height:T}=c,I=!(this.size&&this.size[0]===_&&this.size[1]===T||b),{context:z}=this,{gl:U}=z;if(this.useMipmap=!!(f&&f.useMipmap),U.bindTexture(U.TEXTURE_2D,this.texture),z.pixelStoreUnpackFlipY.set(!1),z.pixelStoreUnpack.set(1),z.pixelStoreUnpackPremultiplyAlpha.set(this.format===U.RGBA&&(!f||f.premultiply!==!1)),I)this.size=[_,T],c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||a.b(c)?U.texImage2D(U.TEXTURE_2D,0,this.format,this.format,U.UNSIGNED_BYTE,c):U.texImage2D(U.TEXTURE_2D,0,this.format,_,T,0,this.format,U.UNSIGNED_BYTE,c.data);else{const{x:q,y:J}=b||{x:0,y:0};c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||a.b(c)?U.texSubImage2D(U.TEXTURE_2D,0,q,J,U.RGBA,U.UNSIGNED_BYTE,c):U.texSubImage2D(U.TEXTURE_2D,0,q,J,_,T,U.RGBA,U.UNSIGNED_BYTE,c.data)}this.useMipmap&&this.isSizePowerOfTwo()&&U.generateMipmap(U.TEXTURE_2D)}bind(c,f,b){const{context:_}=this,{gl:T}=_;T.bindTexture(T.TEXTURE_2D,this.texture),b!==T.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(b=T.LINEAR),c!==this.filter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,c),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,b||c),this.filter=c),f!==this.wrap&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,f),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}}function M(S){const{userImage:c}=S;return!!(c&&c.render&&c.render())&&(S.data.replace(new Uint8Array(c.data.buffer)),!0)}class D extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:f,promiseResolve:b}of this.requestors)b(this._getImagesForIds(f));this.requestors=[]}}getImage(c){const f=this.images[c];if(f&&!f.data&&f.spriteData){const b=f.spriteData;f.data=new a.R({width:b.width,height:b.height},b.context.getImageData(b.x,b.y,b.width,b.height).data),f.spriteData=null}return f}addImage(c,f){if(this.images[c])throw new Error(`Image id ${c} already exist, use updateImage instead`);this._validate(c,f)&&(this.images[c]=f)}_validate(c,f){let b=!0;const _=f.data||f.spriteData;return this._validateStretch(f.stretchX,_&&_.width)||(this.fire(new a.k(new Error(`Image "${c}" has invalid "stretchX" value`))),b=!1),this._validateStretch(f.stretchY,_&&_.height)||(this.fire(new a.k(new Error(`Image "${c}" has invalid "stretchY" value`))),b=!1),this._validateContent(f.content,f)||(this.fire(new a.k(new Error(`Image "${c}" has invalid "content" value`))),b=!1),b}_validateStretch(c,f){if(!c)return!0;let b=0;for(const _ of c){if(_[0]<b||_[1]<_[0]||f<_[1])return!1;b=_[1]}return!0}_validateContent(c,f){if(!c)return!0;if(c.length!==4)return!1;const b=f.spriteData,_=b&&b.width||f.data.width,T=b&&b.height||f.data.height;return!(c[0]<0||_<c[0]||c[1]<0||T<c[1]||c[2]<0||_<c[2]||c[3]<0||T<c[3]||c[2]<c[0]||c[3]<c[1])}updateImage(c,f,b=!0){const _=this.getImage(c);if(b&&(_.data.width!==f.data.width||_.data.height!==f.data.height))throw new Error(`size mismatch between old image (${_.data.width}x${_.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=_.version+1,this.images[c]=f,this.updatedImages[c]=!0}removeImage(c){const f=this.images[c];delete this.images[c],delete this.patterns[c],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c){return new Promise((f,b)=>{let _=!0;if(!this.isLoaded())for(const T of c)this.images[T]||(_=!1);this.isLoaded()||_?f(this._getImagesForIds(c)):this.requestors.push({ids:c,promiseResolve:f})})}_getImagesForIds(c){const f={};for(const b of c){let _=this.getImage(b);_||(this.fire(new a.l("styleimagemissing",{id:b})),_=this.getImage(b)),_?f[b]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,textFitWidth:_.textFitWidth,textFitHeight:_.textFitHeight,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:a.w(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:c,height:f}=this.atlasImage;return{width:c,height:f}}getPattern(c){const f=this.patterns[c],b=this.getImage(c);if(!b)return null;if(f&&f.position.version===b.version)return f.position;if(f)f.position.version=b.version;else{const _={w:b.data.width+2,h:b.data.height+2,x:0,y:0},T=new a.I(_,b);this.patterns[c]={bin:_,position:T}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const f=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Y(c,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const T in this.patterns)c.push(this.patterns[T].bin);const{w:f,h:b}=a.p(c),_=this.atlasImage;_.resize({width:f||1,height:b||1});for(const T in this.patterns){const{bin:I}=this.patterns[T],z=I.x+1,U=I.y+1,q=this.getImage(T).data,J=q.width,se=q.height;a.R.copy(q,_,{x:0,y:0},{x:z,y:U},{width:J,height:se}),a.R.copy(q,_,{x:0,y:se-1},{x:z,y:U-1},{width:J,height:1}),a.R.copy(q,_,{x:0,y:0},{x:z,y:U+se},{width:J,height:1}),a.R.copy(q,_,{x:J-1,y:0},{x:z-1,y:U},{width:1,height:se}),a.R.copy(q,_,{x:0,y:0},{x:z+J,y:U},{width:1,height:se})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const f of c){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const b=this.getImage(f);b||a.w(`Image with ID: "${f}" was not found`),M(b)&&this.updateImage(f,b)}}}const G=1e20;function j(S,c,f,b,_,T,I,z,U){for(let q=c;q<c+b;q++)Z(S,f*T+q,T,_,I,z,U);for(let q=f;q<f+_;q++)Z(S,q*T+c,1,b,I,z,U)}function Z(S,c,f,b,_,T,I){T[0]=0,I[0]=-1e20,I[1]=G,_[0]=S[c];for(let z=1,U=0,q=0;z<b;z++){_[z]=S[c+z*f];const J=z*z;do{const se=T[U];q=(_[z]-_[se]+J-se*se)/(z-se)/2}while(q<=I[U]&&--U>-1);U++,T[U]=z,I[U]=q,I[U+1]=G}for(let z=0,U=0;z<b;z++){for(;I[U+1]<z;)U++;const q=T[U],J=z-q;S[c+z*f]=_[q]+J*J}}class ie{constructor(c,f){this.requestManager=c,this.localIdeographFontFamily=f,this.entries={}}setURL(c){this.url=c}getGlyphs(c){return a._(this,void 0,void 0,function*(){const f=[];for(const T in c)for(const I of c[T])f.push(this._getAndCacheGlyphsPromise(T,I));const b=yield Promise.all(f),_={};for(const{stack:T,id:I,glyph:z}of b)_[T]||(_[T]={}),_[T][I]=z&&{id:z.id,bitmap:z.bitmap.clone(),metrics:z.metrics};return _})}_getAndCacheGlyphsPromise(c,f){return a._(this,void 0,void 0,function*(){let b=this.entries[c];b||(b=this.entries[c]={glyphs:{},requests:{},ranges:{}});let _=b.glyphs[f];if(_!==void 0)return{stack:c,id:f,glyph:_};if(_=this._tinySDF(b,c,f),_)return b.glyphs[f]=_,{stack:c,id:f,glyph:_};const T=Math.floor(f/256);if(256*T>65535)throw new Error("glyphs > 65535 not supported");if(b.ranges[T])return{stack:c,id:f,glyph:_};if(!this.url)throw new Error("glyphsUrl is not set");if(!b.requests[T]){const z=ie.loadGlyphRange(c,T,this.url,this.requestManager);b.requests[T]=z}const I=yield b.requests[T];for(const z in I)this._doesCharSupportLocalGlyph(+z)||(b.glyphs[+z]=I[+z]);return b.ranges[T]=!0,{stack:c,id:f,glyph:I[f]||null}})}_doesCharSupportLocalGlyph(c){return!!this.localIdeographFontFamily&&(/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(c))||a.u["CJK Unified Ideographs"](c)||a.u["Hangul Syllables"](c)||a.u.Hiragana(c)||a.u.Katakana(c)||a.u["CJK Symbols and Punctuation"](c)||a.u["Halfwidth and Fullwidth Forms"](c))}_tinySDF(c,f,b){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(b))return;let T=c.tinySDF;if(!T){let z="400";/bold/i.test(f)?z="900":/medium/i.test(f)?z="500":/light/i.test(f)&&(z="200"),T=c.tinySDF=new ie.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:_,fontWeight:z})}const I=T.draw(String.fromCharCode(b));return{id:b,bitmap:new a.q({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}ie.loadGlyphRange=function(S,c,f,b){return a._(this,void 0,void 0,function*(){const _=256*c,T=_+255,I=b.transformRequest(f.replace("{fontstack}",S).replace("{range}",`${_}-${T}`),"Glyphs"),z=yield a.n(I,new AbortController);if(!z||!z.data)throw new Error(`Could not load glyph range. range: ${c}, ${_}-${T}`);const U={};for(const q of a.o(z.data))U[q.id]=q;return U})},ie.TinySDF=class{constructor({fontSize:S=24,buffer:c=3,radius:f=8,cutoff:b=.25,fontFamily:_="sans-serif",fontWeight:T="normal",fontStyle:I="normal"}={}){this.buffer=c,this.cutoff=b,this.radius=f;const z=this.size=S+4*c,U=this._createCanvas(z),q=this.ctx=U.getContext("2d",{willReadFrequently:!0});q.font=`${I} ${T} ${S}px ${_}`,q.textBaseline="alphabetic",q.textAlign="left",q.fillStyle="black",this.gridOuter=new Float64Array(z*z),this.gridInner=new Float64Array(z*z),this.f=new Float64Array(z),this.z=new Float64Array(z+1),this.v=new Uint16Array(z)}_createCanvas(S){const c=document.createElement("canvas");return c.width=c.height=S,c}draw(S){const{width:c,actualBoundingBoxAscent:f,actualBoundingBoxDescent:b,actualBoundingBoxLeft:_,actualBoundingBoxRight:T}=this.ctx.measureText(S),I=Math.ceil(f),z=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(T-_))),U=Math.min(this.size-this.buffer,I+Math.ceil(b)),q=z+2*this.buffer,J=U+2*this.buffer,se=Math.max(q*J,0),ne=new Uint8ClampedArray(se),pe={data:ne,width:q,height:J,glyphWidth:z,glyphHeight:U,glyphTop:I,glyphLeft:0,glyphAdvance:c};if(z===0||U===0)return pe;const{ctx:ye,buffer:De,gridInner:Ee,gridOuter:Le}=this;ye.clearRect(De,De,z,U),ye.fillText(S,De,De+I);const ze=ye.getImageData(De,De,z,U);Le.fill(G,0,se),Ee.fill(0,0,se);for(let We=0;We<U;We++)for(let Qe=0;Qe<z;Qe++){const Ke=ze.data[4*(We*z+Qe)+3]/255;if(Ke===0)continue;const at=(We+De)*q+Qe+De;if(Ke===1)Le[at]=0,Ee[at]=G;else{const et=.5-Ke;Le[at]=et>0?et*et:0,Ee[at]=et<0?et*et:0}}j(Le,0,0,q,J,q,this.f,this.v,this.z),j(Ee,De,De,z,U,q,this.f,this.v,this.z);for(let We=0;We<se;We++){const Qe=Math.sqrt(Le[We])-Math.sqrt(Ee[We]);ne[We]=Math.round(255-255*(Qe/this.radius+this.cutoff))}return pe}};class le{constructor(){this.specification=a.v.light.position}possiblyEvaluate(c,f){return a.z(c.expression.evaluate(f))}interpolate(c,f,b){return{x:a.B.number(c.x,f.x,b),y:a.B.number(c.y,f.y,b),z:a.B.number(c.z,f.z,b)}}}let me;class be extends a.E{constructor(c){super(),me=me||new a.r({anchor:new a.D(a.v.light.anchor),position:new le,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(me),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,f={}){if(!this._validate(a.t,c,f))for(const b in c){const _=c[b];b.endsWith("-transition")?this._transitionable.setTransition(b.slice(0,-11),_):this._transitionable.setValue(b,_)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,f,b){return(!b||b.validate!==!1)&&a.x(this,c.call(a.y,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const fe=new a.r({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class Fe extends a.E{constructor(c){super(),this._transitionable=new a.T(fe),this.setSky(c),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.C(0))}setSky(c,f={}){if(!this._validate(a.F,c,f)){c||(c={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const b in c){const _=c[b];b.endsWith("-transition")?this._transitionable.setTransition(b.slice(0,-11),_):this._transitionable.setValue(b,_)}}}getSky(){return this._transitionable.serialize()}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,f,b={}){return b?.validate!==!1&&a.x(this,c.call(a.y,a.e({value:f,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(c){return c<60?0:c<70?(c-60)/10:1}}class He{constructor(c,f){this.width=c,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(c,f){const b=c.join(",")+String(f);return this.dashEntry[b]||(this.dashEntry[b]=this.addDash(c,f)),this.dashEntry[b]}getDashRanges(c,f,b){const _=[];let T=c.length%2==1?-c[c.length-1]*b:0,I=c[0]*b,z=!0;_.push({left:T,right:I,isDash:z,zeroLength:c[0]===0});let U=c[0];for(let q=1;q<c.length;q++){z=!z;const J=c[q];T=U*b,U+=J,I=U*b,_.push({left:T,right:I,isDash:z,zeroLength:J===0})}return _}addRoundDash(c,f,b){const _=f/2;for(let T=-b;T<=b;T++){const I=this.width*(this.nextRow+b+T);let z=0,U=c[z];for(let q=0;q<this.width;q++){q/U.right>1&&(U=c[++z]);const J=Math.abs(q-U.left),se=Math.abs(q-U.right),ne=Math.min(J,se);let pe;const ye=T/b*(_+1);if(U.isDash){const De=_-Math.abs(ye);pe=Math.sqrt(ne*ne+De*De)}else pe=_-Math.sqrt(ne*ne+ye*ye);this.data[I+q]=Math.max(0,Math.min(255,pe+128))}}}addRegularDash(c){for(let z=c.length-1;z>=0;--z){const U=c[z],q=c[z+1];U.zeroLength?c.splice(z,1):q&&q.isDash===U.isDash&&(q.left=U.left,c.splice(z,1))}const f=c[0],b=c[c.length-1];f.isDash===b.isDash&&(f.left=b.left-this.width,b.right=f.right+this.width);const _=this.width*this.nextRow;let T=0,I=c[T];for(let z=0;z<this.width;z++){z/I.right>1&&(I=c[++T]);const U=Math.abs(z-I.left),q=Math.abs(z-I.right),J=Math.min(U,q);this.data[_+z]=Math.max(0,Math.min(255,(I.isDash?J:-J)+128))}}addDash(c,f){const b=f?7:0,_=2*b+1;if(this.nextRow+_>this.height)return a.w("LineAtlas out of space"),null;let T=0;for(let z=0;z<c.length;z++)T+=c[z];if(T!==0){const z=this.width/T,U=this.getDashRanges(c,this.width,z);f?this.addRoundDash(U,z,b):this.addRegularDash(U)}const I={y:(this.nextRow+b+.5)/this.height,height:2*b/this.height,width:T};return this.nextRow+=_,this.dirty=!0,I}bind(c){const f=c.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const je="maplibre_preloaded_worker_pool";class qe{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<qe.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[je]}numActive(){return Object.keys(this.active).length}}const ct=Math.floor(v.hardwareConcurrency/2);let Ge,Je;function mt(){return Ge||(Ge=new qe),Ge}qe.workerCount=a.G(globalThis)?Math.max(Math.min(ct,3),1):1;class wt{constructor(c,f){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=f;const b=this.workerPool.acquire(f);for(let _=0;_<b.length;_++){const T=new a.H(b[_],f);T.name=`Worker ${_}`,this.actors.push(T)}if(!this.actors.length)throw new Error("No actors found")}broadcast(c,f){const b=[];for(const _ of this.actors)b.push(_.sendAsync({type:c,data:f}));return Promise.all(b)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(c=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],c&&this.workerPool.release(this.id)}registerMessageHandler(c,f){for(const b of this.actors)b.registerMessageHandler(c,f)}}function Ot(){return Je||(Je=new wt(mt(),a.J),Je.registerMessageHandler("GR",(S,c,f)=>a.m(c,f))),Je}function Qt(S,c){const f=a.K();return a.L(f,f,[1,1,0]),a.M(f,f,[.5*S.width,.5*S.height,1]),S.calculatePosMatrix?a.N(f,f,S.calculatePosMatrix(c.toUnwrapped())):f}function ei(S,c,f,b,_,T,I){var z;const U=function(ne,pe,ye){if(ne)for(const De of ne){const Ee=pe[De];if(Ee&&Ee.source===ye&&Ee.type==="fill-extrusion")return!0}else for(const De in pe){const Ee=pe[De];if(Ee.source===ye&&Ee.type==="fill-extrusion")return!0}return!1}((z=_?.layers)!==null&&z!==void 0?z:null,c,S.id),q=T.maxPitchScaleFactor(),J=S.tilesIn(b,q,U);J.sort(Jt);const se=[];for(const ne of J)se.push({wrappedTileID:ne.tileID.wrapped().key,queryResults:ne.tile.queryRenderedFeatures(c,f,S._state,ne.queryGeometry,ne.cameraQueryGeometry,ne.scale,_,T,q,Qt(S.transform,ne.tileID),I?(pe,ye)=>I(ne.tileID,pe,ye):void 0)});return function(ne,pe){for(const ye in ne)for(const De of ne[ye])Yt(De,pe);return ne}(function(ne){const pe={},ye={};for(const De of ne){const Ee=De.queryResults,Le=De.wrappedTileID,ze=ye[Le]=ye[Le]||{};for(const We in Ee){const Qe=Ee[We],Ke=ze[We]=ze[We]||{},at=pe[We]=pe[We]||[];for(const et of Qe)Ke[et.featureIndex]||(Ke[et.featureIndex]=!0,at.push(et))}}return pe}(se),S)}function Jt(S,c){const f=S.tileID,b=c.tileID;return f.overscaledZ-b.overscaledZ||f.canonical.y-b.canonical.y||f.wrap-b.wrap||f.canonical.x-b.canonical.x}function Yt(S,c){const f=S.feature,b=c.getFeatureState(f.layer["source-layer"],f.id);f.source=f.layer.source,f.layer["source-layer"]&&(f.sourceLayer=f.layer["source-layer"]),f.state=b}function Ut(S,c,f){return a._(this,void 0,void 0,function*(){let b=S;if(S.url?b=(yield a.j(c.transformRequest(S.url,"Source"),f)).data:yield v.frameAsync(f),!b)return null;const _=a.O(a.e(b,S),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in b&&b.vector_layers&&(_.vectorLayerIds=b.vector_layers.map(T=>T.id)),_})}class Re{constructor(c,f){c&&(f?this.setSouthWest(c).setNorthEast(f):Array.isArray(c)&&(c.length===4?this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]]):this.setSouthWest(c[0]).setNorthEast(c[1])))}setNorthEast(c){return this._ne=c instanceof a.Q?new a.Q(c.lng,c.lat):a.Q.convert(c),this}setSouthWest(c){return this._sw=c instanceof a.Q?new a.Q(c.lng,c.lat):a.Q.convert(c),this}extend(c){const f=this._sw,b=this._ne;let _,T;if(c instanceof a.Q)_=c,T=c;else{if(!(c instanceof Re))return Array.isArray(c)?c.length===4||c.every(Array.isArray)?this.extend(Re.convert(c)):this.extend(a.Q.convert(c)):c&&("lng"in c||"lon"in c)&&"lat"in c?this.extend(a.Q.convert(c)):this;if(_=c._sw,T=c._ne,!_||!T)return this}return f||b?(f.lng=Math.min(_.lng,f.lng),f.lat=Math.min(_.lat,f.lat),b.lng=Math.max(T.lng,b.lng),b.lat=Math.max(T.lat,b.lat)):(this._sw=new a.Q(_.lng,_.lat),this._ne=new a.Q(T.lng,T.lat)),this}getCenter(){return new a.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.Q(this.getWest(),this.getNorth())}getSouthEast(){return new a.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(c){const{lng:f,lat:b}=a.Q.convert(c);let _=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=b&&b<=this._ne.lat&&_}static convert(c){return c instanceof Re?c:c&&new Re(c)}static fromLngLat(c,f=0){const b=360*f/40075017,_=b/Math.cos(Math.PI/180*c.lat);return new Re(new a.Q(c.lng-_,c.lat-b),new a.Q(c.lng+_,c.lat+b))}adjustAntiMeridian(){const c=new a.Q(this._sw.lng,this._sw.lat),f=new a.Q(this._ne.lng,this._ne.lat);return new Re(c,c.lng>f.lng?new a.Q(f.lng+360,f.lat):f)}}class gi{constructor(c,f,b){this.bounds=Re.convert(this.validateBounds(c)),this.minzoom=f||0,this.maxzoom=b||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const f=Math.pow(2,c.z),b=Math.floor(a.U(this.bounds.getWest())*f),_=Math.floor(a.S(this.bounds.getNorth())*f),T=Math.ceil(a.U(this.bounds.getEast())*f),I=Math.ceil(a.S(this.bounds.getSouth())*f);return c.x>=b&&c.x<T&&c.y>=_&&c.y<I}}class it extends a.E{constructor(c,f,b,_){if(super(),this.id=c,this.dispatcher=b,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.O(f,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const c=yield Ut(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),c&&(a.e(this,c),c.bounds&&(this.tileBounds=new gi(c.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})))}catch(c){this._tileJSONRequest=null,this.fire(new a.k(c))}})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.abort(),c(),this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(c){return a._(this,void 0,void 0,function*(){const f=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),b={request:this.map._requestManager.transformRequest(f,"Tile"),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};b.request.collectResourceTiming=this._collectResourceTiming;let _="RT";if(c.actor&&c.state!=="expired"){if(c.state==="loading")return new Promise((T,I)=>{c.reloadPromise={resolve:T,reject:I}})}else c.actor=this.dispatcher.getActor(),_="LT";c.abortController=new AbortController;try{const T=yield c.actor.sendAsync({type:_,data:b},c.abortController);if(delete c.abortController,c.aborted)return;this._afterTileLoadWorkerResponse(c,T)}catch(T){if(delete c.abortController,c.aborted)return;if(T&&T.status!==404)throw T;this._afterTileLoadWorkerResponse(c,null)}})}_afterTileLoadWorkerResponse(c,f){if(f&&f.resourceTiming&&(c.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&c.setExpiryData(f),c.loadVectorData(f,this.map.painter),c.reloadPromise){const b=c.reloadPromise;c.reloadPromise=null,this.loadTile(c).then(b.resolve).catch(b.reject)}}abortTile(c){return a._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController),c.actor&&(yield c.actor.sendAsync({type:"AT",data:{uid:c.uid,type:this.type,source:this.id}}))})}unloadTile(c){return a._(this,void 0,void 0,function*(){c.unloadVectorData(),c.actor&&(yield c.actor.sendAsync({type:"RMT",data:{uid:c.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Pe extends a.E{constructor(c,f,b,_){super(),this.id=c,this.dispatcher=b,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},f),a.e(this,a.O(f,["url","scheme","tileSize"]))}load(){return a._(this,arguments,void 0,function*(c=!1){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const f=yield Ut(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,f&&(a.e(this,f),f.bounds&&(this.tileBounds=new gi(f.bounds,this.minzoom,this.maxzoom)),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:c})))}catch(f){this._tileJSONRequest=null,this.fire(new a.k(f))}})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(c){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),c(),this.load(!0)}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}serialize(){return a.e({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c){return a._(this,void 0,void 0,function*(){const f=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);c.abortController=new AbortController;try{const b=yield k.getImage(this.map._requestManager.transformRequest(f,"Tile"),c.abortController,this.map._refreshExpiredTiles);if(delete c.abortController,c.aborted)return void(c.state="unloaded");if(b&&b.data){this.map._refreshExpiredTiles&&b.cacheControl&&b.expires&&c.setExpiryData({cacheControl:b.cacheControl,expires:b.expires});const _=this.map.painter.context,T=_.gl,I=b.data;c.texture=this.map.painter.getTileTexture(I.width),c.texture?c.texture.update(I,{useMipmap:!0}):(c.texture=new Y(_,I,T.RGBA,{useMipmap:!0}),c.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST)),c.state="loaded"}}catch(b){if(delete c.abortController,c.aborted)c.state="unloaded";else if(b)throw c.state="errored",b}})}abortTile(c){return a._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController)})}unloadTile(c){return a._(this,void 0,void 0,function*(){c.texture&&this.map.painter.saveTileTexture(c.texture)})}hasTransition(){return!1}}class Ye extends Pe{constructor(c,f,b,_){super(c,f,b,_),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(c){return a._(this,void 0,void 0,function*(){const f=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),b=this.map._requestManager.transformRequest(f,"Tile");c.neighboringTiles=this._getNeighboringTiles(c.tileID),c.abortController=new AbortController;try{const _=yield k.getImage(b,c.abortController,this.map._refreshExpiredTiles);if(delete c.abortController,c.aborted)return void(c.state="unloaded");if(_&&_.data){const T=_.data;this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&c.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const I=a.b(T)&&a.V()?T:yield this.readImageNow(T),z={type:this.type,uid:c.uid,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!c.actor||c.state==="expired"){c.actor=this.dispatcher.getActor();const U=yield c.actor.sendAsync({type:"LDT",data:z});c.dem=U,c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0,c.state="loaded"}}}catch(_){if(delete c.abortController,c.aborted)c.state="unloaded";else if(_)throw c.state="errored",_}})}readImageNow(c){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.W()){const f=c.width+2,b=c.height+2;try{return new a.R({width:f,height:b},yield a.X(c,-1,-1,f,b))}catch{}}return v.getImageData(c,1)})}_getNeighboringTiles(c){const f=c.canonical,b=Math.pow(2,f.z),_=(f.x-1+b)%b,T=f.x===0?c.wrap-1:c.wrap,I=(f.x+1+b)%b,z=f.x+1===b?c.wrap+1:c.wrap,U={};return U[new a.Y(c.overscaledZ,T,f.z,_,f.y).key]={backfilled:!1},U[new a.Y(c.overscaledZ,z,f.z,I,f.y).key]={backfilled:!1},f.y>0&&(U[new a.Y(c.overscaledZ,T,f.z,_,f.y-1).key]={backfilled:!1},U[new a.Y(c.overscaledZ,c.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},U[new a.Y(c.overscaledZ,z,f.z,I,f.y-1).key]={backfilled:!1}),f.y+1<b&&(U[new a.Y(c.overscaledZ,T,f.z,_,f.y+1).key]={backfilled:!1},U[new a.Y(c.overscaledZ,c.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},U[new a.Y(c.overscaledZ,z,f.z,I,f.y+1).key]={backfilled:!1}),U}unloadTile(c){return a._(this,void 0,void 0,function*(){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&(yield c.actor.sendAsync({type:"RDT",data:{type:this.type,uid:c.uid,source:this.id}}))})}}class Ct extends a.E{constructor(c,f,b,_){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=b.getActor(),this.setEventedParent(_),this._data=f.data,this._options=a.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId,f.clusterMaxZoom!==void 0&&this.maxzoom<=f.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${f.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(f.buffer!==void 0?f.buffer:128),tolerance:this._pixelsToTileUnits(f.tolerance!==void 0?f.tolerance:.375),extent:a.Z,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:a.Z,radius:this._pixelsToTileUnits(f.clusterRadius||50),log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(c){return c*(a.Z/this.tileSize)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(c){this.map=c,this.load()}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){return this._updateWorkerData(c),this}getData(){return a._(this,void 0,void 0,function*(){const c=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:c})})}getCoordinatesFromGeometry(c){return c.type==="GeometryCollection"?c.geometries.map(f=>f.coordinates).flat(1/0):c.coordinates.flat(1/0)}getBounds(){return a._(this,void 0,void 0,function*(){const c=new Re,f=yield this.getData();let b;switch(f.type){case"FeatureCollection":b=f.features.map(_=>this.getCoordinatesFromGeometry(_.geometry)).flat(1/0);break;case"Feature":b=this.getCoordinatesFromGeometry(f.geometry);break;default:b=this.getCoordinatesFromGeometry(f)}if(b.length==0)return c;for(let _=0;_<b.length-1;_+=2)c.extend([b[_],b[_+1]]);return c})}setClusterOptions(c){return this.workerOptions.cluster=c.cluster,c&&(c.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(c.clusterRadius)),c.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=c.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(c){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:c,source:this.id}})}getClusterChildren(c){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:c,source:this.id}})}getClusterLeaves(c,f,b){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:c,limit:f,offset:b}})}_updateWorkerData(c){return a._(this,void 0,void 0,function*(){const f=a.e({type:this.type},this.workerOptions);c?f.dataDiff=c:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(v.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.l("dataloading",{dataType:"source"}));try{const b=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||b.abandoned)return void this.fire(new a.l("dataabort",{dataType:"source"}));let _=null;b.resourceTiming&&b.resourceTiming[this.id]&&(_=b.resourceTiming[this.id].slice(0));const T={dataType:"source"};this._collectResourceTiming&&_&&_.length>0&&a.e(T,{resourceTiming:_}),this.fire(new a.l("data",Object.assign(Object.assign({},T),{sourceDataType:"metadata"}))),this.fire(new a.l("data",Object.assign(Object.assign({},T),{sourceDataType:"content"})))}catch(b){if(this._pendingLoads--,this._removed)return void this.fire(new a.l("dataabort",{dataType:"source"}));this.fire(new a.k(b))}})}loaded(){return this._pendingLoads===0}loadTile(c){return a._(this,void 0,void 0,function*(){const f=c.actor?"RT":"LT";c.actor=this.actor;const b={type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};c.abortController=new AbortController;const _=yield this.actor.sendAsync({type:f,data:b},c.abortController);delete c.abortController,c.unloadVectorData(),c.aborted||c.loadVectorData(_,this.map.painter,f==="RT")})}abortTile(c){return a._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController),c.aborted=!0})}unloadTile(c){return a._(this,void 0,void 0,function*(){c.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:c.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class st extends a.E{constructor(c,f,b,_){super(),this.flippedWindingOrder=!1,this.id=c,this.dispatcher=b,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=f}load(c){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield k.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,c&&(this.coordinates=c),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new a.k(f))}})}loaded(){return this._loaded}updateImage(c){return c.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=c.url,this.load(c.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(c){this.coordinates=c;const f=c.map(a.$.fromLngLat);var b;return this.tileID=function(_){let T=1/0,I=1/0,z=-1/0,U=-1/0;for(const ne of _)T=Math.min(T,ne.x),I=Math.min(I,ne.y),z=Math.max(z,ne.x),U=Math.max(U,ne.y);const q=Math.max(z-T,U-I),J=Math.max(0,Math.floor(-Math.log(q)/Math.LN2)),se=Math.pow(2,J);return new a.a1(J,Math.floor((T+z)/2*se),Math.floor((I+U)/2*se))}(f),this.terrainTileRanges=this._getOverlappingTileRanges(f),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=f.map(_=>this.tileID.getTilePoint(_)._round()),this.flippedWindingOrder=((b=this.tileCoords)[1].x-b[0].x)*(b[2].y-b[0].y)-(b[1].y-b[0].y)*(b[2].x-b[0].x)<0,this.fire(new a.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const c=this.map.painter.context,f=c.gl;this.texture||(this.texture=new Y(c,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let b=!1;for(const _ in this.tiles){const T=this.tiles[_];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,b=!0)}b&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(c){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={}):c.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(c){let f=1/0,b=1/0,_=-1/0,T=-1/0;for(const z of c)f=Math.min(f,z.x),b=Math.min(b,z.y),_=Math.max(_,z.x),T=Math.max(T,z.y);const I={};for(let z=0;z<=a.a0;z++){const U=Math.pow(2,z),q=Math.floor(f*U),J=Math.floor(b*U),se=Math.floor(_*U),ne=Math.floor(T*U);I[z]={minTileX:q,minTileY:J,maxTileX:se,maxTileY:ne}}return I}}class we extends st{constructor(c,f,b,_){super(c,f,b,_),this.roundZoom=!0,this.type="video",this.options=f}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const c=this.options;this.urls=[];for(const f of c.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield a.a2(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new a.k(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const f=this.video.seekable;c<f.start(0)||c>f.end(0)?this.fire(new a.k(new a.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,f=c.gl;this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new Y(c,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let b=!1;for(const _ in this.tiles){const T=this.tiles[_];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,b=!0)}b&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class he extends st{constructor(c,f,b,_){super(c,f,b,_),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(T=>!Array.isArray(T)||T.length!==2||T.some(I=>typeof I!="number"))||this.fire(new a.k(new a.a3(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.k(new a.a3(`sources.${c}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new a.k(new a.a3(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new a.k(new a.a3(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.k(new a.a3(`sources.${c}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,b=f.gl;this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Y(f,this.canvas,b.RGBA,{premultiply:!0});let _=!1;for(const T in this.tiles){const I=this.tiles[T];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,_=!0)}_&&this.fire(new a.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}}const xe={},Be=S=>{switch(S){case"geojson":return Ct;case"image":return st;case"raster":return Pe;case"raster-dem":return Ye;case"vector":return it;case"video":return we;case"canvas":return he}return xe[S]},$e="RTLPluginLoaded";class Ze extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ot()}_syncState(c){return this.status=c,this.dispatcher.broadcast("SRPS",{pluginStatus:c,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(c){return a._(this,arguments,void 0,function*(f,b=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=v.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!b)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.l($e))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Lt=null;function ot(){return Lt||(Lt=new Ze),Lt}class Nt{constructor(c,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=c,this.uid=a.a4(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(c){const f=c+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(c){this.demTexture&&c.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(c,f,b){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",c){c.featureIndex&&(this.latestFeatureIndex=c.featureIndex,c.rawTileData?(this.latestRawTileData=c.rawTileData,this.latestFeatureIndex.rawTileData=c.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=c.collisionBoxArray,this.buckets=function(_,T){const I={};if(!T)return I;for(const z of _){const U=z.layerIds.map(q=>T.getLayer(q)).filter(Boolean);if(U.length!==0){z.layers=U,z.stateDependentLayerIds&&(z.stateDependentLayers=z.stateDependentLayerIds.map(q=>U.filter(J=>J.id===q)[0]));for(const q of U)I[q.id]=z}}return I}(c.buckets,f?.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const T=this.buckets[_];if(T instanceof a.a6){if(this.hasSymbolBuckets=!0,!b)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const T=this.buckets[_];if(T instanceof a.a6&&T.hasRTLText){this.hasRTLText=!0,ot().lazyLoad();break}}this.queryPadding=0;for(const _ in this.buckets){const T=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(_).queryRadius(T))}c.imageAtlas&&(this.imageAtlas=c.imageAtlas),c.glyphAtlasImage&&(this.glyphAtlasImage=c.glyphAtlasImage)}else this.collisionBoxArray=new a.a5}unloadVectorData(){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(c){return this.buckets[c.id]}upload(c){for(const b in this.buckets){const _=this.buckets[b];_.uploadPending()&&_.upload(c)}const f=c.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Y(c,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Y(c,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(c){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(c,this.imageAtlasTexture)}queryRenderedFeatures(c,f,b,_,T,I,z,U,q,J,se){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:T,scale:I,tileSize:this.tileSize,pixelPosMatrix:J,transform:U,params:z,queryPadding:this.queryPadding*q,getElevation:se},c,f,b):{}}querySourceFeatures(c,f){const b=this.latestFeatureIndex;if(!b||!b.rawTileData)return;const _=b.loadVTLayers(),T=f&&f.sourceLayer?f.sourceLayer:"",I=_._geojsonTileLayer||_[T];if(!I)return;const z=a.a7(f&&f.filter),{z:U,x:q,y:J}=this.tileID.canonical,se={z:U,x:q,y:J};for(let ne=0;ne<I.length;ne++){const pe=I.feature(ne);if(z.needGeometry){const Ee=a.a8(pe,!0);if(!z.filter(new a.C(this.tileID.overscaledZ),Ee,this.tileID.canonical))continue}else if(!z.filter(new a.C(this.tileID.overscaledZ),pe))continue;const ye=b.getId(pe,T),De=new a.a9(pe,U,q,J,ye);De.tile=se,c.push(De)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(c){const f=this.expirationTime;if(c.cacheControl){const b=a.aa(c.cacheControl);b["max-age"]&&(this.expirationTime=Date.now()+1e3*b["max-age"])}else c.expires&&(this.expirationTime=new Date(c.expires).getTime());if(this.expirationTime){const b=Date.now();let _=!1;if(this.expirationTime>b)_=!1;else if(f)if(this.expirationTime<f)_=!0;else{const T=this.expirationTime-f;T?this.expirationTime=b+Math.max(T,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(c,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(c).length===0)return;const b=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!f.style.hasLayer(_))continue;const T=this.buckets[_],I=T.layers[0].sourceLayer||"_geojsonTileLayer",z=b[I],U=c[I];if(!z||!U||Object.keys(U).length===0)continue;T.update(U,z,this.imageAtlas&&this.imageAtlas.patternPositions||{});const q=f&&f.style&&f.style.getLayer(_);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<v.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(c){this.symbolFadeHoldUntil=v.now()+c}setDependencies(c,f){const b={};for(const _ of f)b[_]=!0;this.dependencies[c]=b}hasDependency(c,f){for(const b of c){const _=this.dependencies[b];if(_){for(const T of f)if(_[T])return!0}}return!1}}class fi{constructor(c,f){this.max=c,this.onRemove=f,this.reset()}reset(){for(const c in this.data)for(const f of this.data[c])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(c,f,b){const _=c.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const T={value:f,timeout:void 0};if(b!==void 0&&(T.timeout=setTimeout(()=>{this.remove(c,T)},b)),this.data[_].push(T),this.order.push(_),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(c){return c.wrapped().key in this.data}getAndRemove(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null}_getAndRemoveByKey(c){const f=this.data[c].shift();return f.timeout&&clearTimeout(f.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),f.value}getByKey(c){const f=this.data[c];return f?f[0].value:null}get(c){return this.has(c)?this.data[c.wrapped().key][0].value:null}remove(c,f){if(!this.has(c))return this;const b=c.wrapped().key,_=f===void 0?0:this.data[b].indexOf(f),T=this.data[b][_];return this.data[b].splice(_,1),T.timeout&&clearTimeout(T.timeout),this.data[b].length===0&&delete this.data[b],this.onRemove(T.value),this.order.splice(this.order.indexOf(b),1),this}setMaxSize(c){for(this.max=c;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(c){const f=[];for(const b in this.data)for(const _ of this.data[b])c(_.value)||f.push(_);for(const b of f)this.remove(b.value.tileID,b)}}class Pt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(c,f,b){const _=String(f);if(this.stateChanges[c]=this.stateChanges[c]||{},this.stateChanges[c][_]=this.stateChanges[c][_]||{},a.e(this.stateChanges[c][_],b),this.deletedStates[c]===null){this.deletedStates[c]={};for(const T in this.state[c])T!==_&&(this.deletedStates[c][T]=null)}else if(this.deletedStates[c]&&this.deletedStates[c][_]===null){this.deletedStates[c][_]={};for(const T in this.state[c][_])b[T]||(this.deletedStates[c][_][T]=null)}else for(const T in b)this.deletedStates[c]&&this.deletedStates[c][_]&&this.deletedStates[c][_][T]===null&&delete this.deletedStates[c][_][T]}removeFeatureState(c,f,b){if(this.deletedStates[c]===null)return;const _=String(f);if(this.deletedStates[c]=this.deletedStates[c]||{},b&&f!==void 0)this.deletedStates[c][_]!==null&&(this.deletedStates[c][_]=this.deletedStates[c][_]||{},this.deletedStates[c][_][b]=null);else if(f!==void 0)if(this.stateChanges[c]&&this.stateChanges[c][_])for(b in this.deletedStates[c][_]={},this.stateChanges[c][_])this.deletedStates[c][_][b]=null;else this.deletedStates[c][_]=null;else this.deletedStates[c]=null}getState(c,f){const b=String(f),_=a.e({},(this.state[c]||{})[b],(this.stateChanges[c]||{})[b]);if(this.deletedStates[c]===null)return{};if(this.deletedStates[c]){const T=this.deletedStates[c][f];if(T===null)return{};for(const I in T)delete _[I]}return _}initializeTileState(c,f){c.setFeatureState(this.state,f)}coalesceChanges(c,f){const b={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const T={};for(const I in this.stateChanges[_])this.state[_][I]||(this.state[_][I]={}),a.e(this.state[_][I],this.stateChanges[_][I]),T[I]=this.state[_][I];b[_]=T}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const T={};if(this.deletedStates[_]===null)for(const I in this.state[_])T[I]={},this.state[_][I]={};else for(const I in this.deletedStates[_]){if(this.deletedStates[_][I]===null)this.state[_][I]={};else for(const z of Object.keys(this.deletedStates[_][I]))delete this.state[_][I][z];T[I]=this.state[_][I]}b[_]=b[_]||{},a.e(b[_],T)}if(this.stateChanges={},this.deletedStates={},Object.keys(b).length!==0)for(const _ in c)c[_].setFeatureState(b,f)}}function ni(S,c,f){const b=c.intersectsFrustum(S);if(!f)return b;const _=c.intersectsPlane(f);return b===0||_===0?0:b===2&&_===2?2:1}function ti(S,c,f,b,_){let T=S;const I=Math.atan(c/f),z=Math.hypot(c,f);return T=S+a.ab(b/z/Math.max(.5,Math.cos(a.ad(_/2)))),T+=1*a.ab(Math.cos(I))/2,T+=a.ae(S-T,-0,0),T}function nt(S,c){const f=(c.roundZoom?Math.round:Math.floor)(S.zoom+a.ab(S.tileSize/c.tileSize));return Math.max(0,f)}function Ce(S,c){const f=S.getCameraFrustum(),b=S.getClippingPlane(),_=S.screenPointToMercatorCoordinate(S.getCameraPoint()),T=a.$.fromLngLat(S.center,S.elevation);_.z=T.z+Math.cos(S.pitchInRadians)*S.cameraToCenterDistance/S.worldSize;const I=S.getCoveringTilesDetailsProvider(),z=I.allowVariableZoom(S,c),U=nt(S,c),q=c.minzoom||0,J=c.maxzoom!==void 0?c.maxzoom:S.maxZoom,se=Math.min(Math.max(0,U),J),ne=Math.pow(2,se),pe=[ne*_.x,ne*_.y,0],ye=[ne*T.x,ne*T.y,0],De=Math.hypot(T.x-_.x,T.y-_.y),Ee=Math.abs(T.z-_.z),Le=Math.hypot(De,Ee),ze=Ke=>({zoom:0,x:0,y:0,wrap:Ke,fullyVisible:!1}),We=[],Qe=[];if(S.renderWorldCopies&&I.allowWorldCopies())for(let Ke=1;Ke<=3;Ke++)We.push(ze(-Ke)),We.push(ze(Ke));for(We.push(ze(0));We.length>0;){const Ke=We.pop(),at=Ke.x,et=Ke.y;let vt=Ke.fullyVisible;const gt={x:at,y:et,z:Ke.zoom},Dt=I.getTileAABB(gt,Ke.wrap,S.elevation,c);if(!vt){const ui=ni(f,Dt,b);if(ui===0)continue;vt=ui===2}const Bt=I.distanceToTile2d(_.x,_.y,gt,Dt);let It=U;z&&(It=(c.calculateTileZoom||ti)(S.zoom+a.ab(S.tileSize/c.tileSize),Bt,Ee,Le,S.fov)),It=(c.roundZoom?Math.round:Math.floor)(It),It=Math.max(0,It);const di=Math.min(It,J);if(Ke.wrap=I.getWrap(T,gt,Ke.wrap),Ke.zoom>=di){if(Ke.zoom<q)continue;const ui=se-Ke.zoom,Ht=pe[0]-.5-(at<<ui),Ri=pe[1]-.5-(et<<ui),vn=c.reparseOverscaled?Math.max(Ke.zoom,It):Ke.zoom;Qe.push({tileID:new a.Y(Ke.zoom===J?vn:Ke.zoom,Ke.wrap,Ke.zoom,at,et),distanceSq:a.ac([ye[0]-.5-at,ye[1]-.5-et]),tileDistanceToCamera:Math.sqrt(Ht*Ht+Ri*Ri)})}else for(let ui=0;ui<4;ui++)We.push({zoom:Ke.zoom+1,x:(at<<1)+ui%2,y:(et<<1)+(ui>>1),wrap:Ke.wrap,fullyVisible:vt})}return Qe.sort((Ke,at)=>Ke.distanceSq-at.distanceSq).map(Ke=>Ke.tileID)}class oe extends a.E{constructor(c,f,b){super(),this.id=c,this.dispatcher=b,this.on("data",_=>this._dataHandler(_)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((_,T,I,z)=>{const U=new(Be(T.type))(_,T,I,z);if(U.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${U.id}`);return U})(c,f,b,this),this._tiles={},this._cache=new fi(0,_=>this._unloadTile(_)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Pt,this._didEmitContent=!1,this._updated=!1}onAdd(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._maxTileCacheZoomLevels=c?c._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(c)}onRemove(c){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(c)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const c in this._tiles){const f=this._tiles[c];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(c,f,b){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(c),this._tileLoaded(c,f,b)}catch(_){c.state="errored",_.status!==404?this._source.fire(new a.k(_,{tile:c})):this.update(this.transform,this.terrain)}})}_unloadTile(c){this._source.unloadTile&&this._source.unloadTile(c)}_abortTile(c){this._source.abortTile&&this._source.abortTile(c),this._source.fire(new a.l("dataabort",{tile:c,coord:c.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(c){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const b=this._tiles[f];b.upload(c),b.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(c=>c.tileID).sort(re).map(c=>c.key)}getRenderableIds(c){const f=[];for(const b in this._tiles)this._isIdRenderable(b,c)&&f.push(this._tiles[b]);return c?f.sort((b,_)=>{const T=b.tileID,I=_.tileID,z=new a.P(T.canonical.x,T.canonical.y)._rotate(-this.transform.bearingInRadians),U=new a.P(I.canonical.x,I.canonical.y)._rotate(-this.transform.bearingInRadians);return T.overscaledZ-I.overscaledZ||U.y-z.y||U.x-z.x}).map(b=>b.tileID.key):f.map(b=>b.tileID).sort(re).map(b=>b.key)}hasRenderableParent(c){const f=this.findLoadedParent(c,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(c,f){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(f||!this._tiles[c].holdingForFade())}reload(c){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const f in this._tiles)(c||this._tiles[f].state!=="errored")&&this._reloadTile(f,"reloading")}}_reloadTile(c,f){return a._(this,void 0,void 0,function*(){const b=this._tiles[c];b&&(b.state!=="loading"&&(b.state=f),yield this._loadTile(b,c,f))})}_tileLoaded(c,f,b){c.timeAdded=v.now(),b==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(f,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),c.aborted||this._source.fire(new a.l("data",{dataType:"source",tile:c,coord:c.tileID}))}_backfillDEM(c){const f=this.getRenderableIds();for(let _=0;_<f.length;_++){const T=f[_];if(c.neighboringTiles&&c.neighboringTiles[T]){const I=this.getTileByID(T);b(c,I),b(I,c)}}function b(_,T){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let I=T.tileID.canonical.x-_.tileID.canonical.x;const z=T.tileID.canonical.y-_.tileID.canonical.y,U=Math.pow(2,_.tileID.canonical.z),q=T.tileID.key;I===0&&z===0||Math.abs(z)>1||(Math.abs(I)>1&&(Math.abs(I+U)===1?I+=U:Math.abs(I-U)===1&&(I-=U)),T.dem&&_.dem&&(_.dem.backfillBorder(T.dem,I,z),_.neighboringTiles&&_.neighboringTiles[q]&&(_.neighboringTiles[q].backfilled=!0)))}}getTile(c){return this.getTileByID(c.key)}getTileByID(c){return this._tiles[c]}_retainLoadedChildren(c,f,b,_){for(const T in this._tiles){let I=this._tiles[T];if(_[T]||!I.hasData()||I.tileID.overscaledZ<=f||I.tileID.overscaledZ>b)continue;let z=I.tileID;for(;I&&I.tileID.overscaledZ>f+1;){const q=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[q.key],I&&I.hasData()&&(z=q)}let U=z;for(;U.overscaledZ>f;)if(U=U.scaledTo(U.overscaledZ-1),c[U.key]||c[U.canonical.key]){_[z.key]=z;break}}}findLoadedParent(c,f){if(c.key in this._loadedParentTiles){const b=this._loadedParentTiles[c.key];return b&&b.tileID.overscaledZ>=f?b:null}for(let b=c.overscaledZ-1;b>=f;b--){const _=c.scaledTo(b),T=this._getLoadedTile(_);if(T)return T}}findLoadedSibling(c){return this._getLoadedTile(c)}_getLoadedTile(c){const f=this._tiles[c.key];return f&&f.hasData()?f:this._cache.getByKey(c.wrapped().key)}updateCacheSize(c){const f=Math.ceil(c.width/this._source.tileSize)+1,b=Math.ceil(c.height/this._source.tileSize)+1,_=Math.floor(f*b*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(T)}handleWrapJump(c){const f=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,f){const b={};for(const _ in this._tiles){const T=this._tiles[_];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+f),b[T.tileID.key]=T}this._tiles=b;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}_updateCoveredAndRetainedTiles(c,f,b,_,T,I){const z={},U={},q=Object.keys(c),J=v.now();for(const se of q){const ne=c[se],pe=this._tiles[se];if(!pe||pe.fadeEndTime!==0&&pe.fadeEndTime<=J)continue;const ye=this.findLoadedParent(ne,f),De=this.findLoadedSibling(ne),Ee=ye||De||null;Ee&&(this._addTile(Ee.tileID),z[Ee.tileID.key]=Ee.tileID),U[se]=ne}this._retainLoadedChildren(U,_,b,c);for(const se in z)c[se]||(this._coveredTiles[se]=!0,c[se]=z[se]);if(I){const se={},ne={};for(const pe of T)this._tiles[pe.key].hasData()?se[pe.key]=pe:ne[pe.key]=pe;for(const pe in ne){const ye=ne[pe].children(this._source.maxzoom);this._tiles[ye[0].key]&&this._tiles[ye[1].key]&&this._tiles[ye[2].key]&&this._tiles[ye[3].key]&&(se[ye[0].key]=c[ye[0].key]=ye[0],se[ye[1].key]=c[ye[1].key]=ye[1],se[ye[2].key]=c[ye[2].key]=ye[2],se[ye[3].key]=c[ye[3].key]=ye[3],delete ne[pe])}for(const pe in ne){const ye=ne[pe],De=this.findLoadedParent(ye,this._source.minzoom),Ee=this.findLoadedSibling(ye),Le=De||Ee||null;if(Le){se[Le.tileID.key]=c[Le.tileID.key]=Le.tileID;for(const ze in se)se[ze].isChildOf(Le.tileID)&&delete se[ze]}}for(const pe in this._tiles)se[pe]||(this._coveredTiles[pe]=!0)}}update(c,f){if(!this._sourceLoaded||this._paused)return;let b;this.transform=c,this.terrain=f,this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?b=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(J=>new a.Y(J.canonical.z,J.wrap,J.canonical.z,J.canonical.x,J.canonical.y)):(b=Ce(c,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(b=b.filter(J=>this._source.hasTile(J)))):b=[];const _=nt(c,this._source),T=Math.max(_-oe.maxOverzooming,this._source.minzoom),I=Math.max(_+oe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const J={};for(const se of b)if(se.canonical.z>this._source.minzoom){const ne=se.scaledTo(se.canonical.z-1);J[ne.key]=ne;const pe=se.scaledTo(Math.max(this._source.minzoom,Math.min(se.canonical.z,5)));J[pe.key]=pe}b=b.concat(Object.values(J))}const z=b.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,z&&this.fire(new a.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const U=this._updateRetainedTiles(b,_);ee(this._source.type)&&this._updateCoveredAndRetainedTiles(U,T,I,_,b,f);for(const J in U)this._tiles[J].clearFadeHold();const q=a.af(this._tiles,U);for(const J of q){const se=this._tiles[J];se.hasSymbolBuckets&&!se.holdingForFade()?se.setHoldDuration(this.map._fadeDuration):se.hasSymbolBuckets&&!se.symbolFadeFinished()||this._removeTile(J)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)}_updateRetainedTiles(c,f){var b;const _={},T={},I=Math.max(f-oe.maxOverzooming,this._source.minzoom),z=Math.max(f+oe.maxUnderzooming,this._source.minzoom),U={};for(const q of c){const J=this._addTile(q);_[q.key]=q,J.hasData()||f<this._source.maxzoom&&(U[q.key]=q)}this._retainLoadedChildren(U,f,z,_);for(const q of c){let J=this._tiles[q.key];if(J.hasData())continue;if(f+1>this._source.maxzoom){const ne=q.children(this._source.maxzoom)[0],pe=this.getTile(ne);if(pe&&pe.hasData()){_[ne.key]=ne;continue}}else{const ne=q.children(this._source.maxzoom);if(_[ne[0].key]&&_[ne[1].key]&&_[ne[2].key]&&_[ne[3].key])continue}let se=J.wasRequested();for(let ne=q.overscaledZ-1;ne>=I;--ne){const pe=q.scaledTo(ne);if(T[pe.key])break;if(T[pe.key]=!0,J=this.getTile(pe),!J&&se&&(J=this._addTile(pe)),J){const ye=J.hasData();if((ye||!(!((b=this.map)===null||b===void 0)&&b.cancelPendingTileRequestsWhileZooming)||se)&&(_[pe.key]=pe),se=J.wasRequested(),ye)break}}}return _}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const c in this._tiles){const f=[];let b,_=this._tiles[c].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){b=this._loadedParentTiles[_.key];break}f.push(_.key);const T=_.scaledTo(_.overscaledZ-1);if(b=this._getLoadedTile(T),b)break;_=T}for(const T of f)this._loadedParentTiles[T]=b}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const c in this._tiles){const f=this._tiles[c].tileID,b=this._getLoadedTile(f);this._loadedSiblingTiles[f.key]=b}}_addTile(c){let f=this._tiles[c.key];if(f)return f;f=this._cache.getAndRemove(c),f&&(this._setTileReloadTimer(c.key,f),f.tileID=c,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,f)));const b=f;return f||(f=new Nt(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(f,c.key,f.state)),f.uses++,this._tiles[c.key]=f,b||this._source.fire(new a.l("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(c,f){c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);const b=f.getExpiryTimeout();b&&(this._timers[c]=setTimeout(()=>{this._reloadTile(c,"expired"),delete this._timers[c]},b))}_removeTile(c){const f=this._tiles[c];f&&(f.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(c){const f=c.sourceDataType;c.dataType==="source"&&f==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&f==="content"&&(this.reload(c.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const c in this._tiles)this._removeTile(c);this._cache.reset()}tilesIn(c,f,b){const _=[],T=this.transform;if(!T)return _;const I=b?T.getCameraQueryGeometry(c):c,z=c.map(ye=>T.screenPointToMercatorCoordinate(ye,this.terrain)),U=I.map(ye=>T.screenPointToMercatorCoordinate(ye,this.terrain)),q=this.getIds();let J=1/0,se=1/0,ne=-1/0,pe=-1/0;for(const ye of U)J=Math.min(J,ye.x),se=Math.min(se,ye.y),ne=Math.max(ne,ye.x),pe=Math.max(pe,ye.y);for(let ye=0;ye<q.length;ye++){const De=this._tiles[q[ye]];if(De.holdingForFade())continue;const Ee=De.tileID,Le=Math.pow(2,T.zoom-De.tileID.overscaledZ),ze=f*De.queryPadding*a.Z/De.tileSize/Le,We=[Ee.getTilePoint(new a.$(J,se)),Ee.getTilePoint(new a.$(ne,pe))];if(We[0].x-ze<a.Z&&We[0].y-ze<a.Z&&We[1].x+ze>=0&&We[1].y+ze>=0){const Qe=z.map(at=>Ee.getTilePoint(at)),Ke=U.map(at=>Ee.getTilePoint(at));_.push({tile:De,tileID:Ee,queryGeometry:Qe,cameraQueryGeometry:Ke,scale:Le})}}return _}getVisibleCoordinates(c){const f=this.getRenderableIds(c).map(b=>this._tiles[b].tileID);return this.transform&&this.transform.populateCache(f),f}hasTransition(){if(this._source.hasTransition())return!0;if(ee(this._source.type)){const c=v.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=c)return!0}return!1}setFeatureState(c,f,b){this._state.updateState(c=c||"_geojsonTileLayer",f,b)}removeFeatureState(c,f,b){this._state.removeFeatureState(c=c||"_geojsonTileLayer",f,b)}getFeatureState(c,f){return this._state.getState(c=c||"_geojsonTileLayer",f)}setDependencies(c,f,b){const _=this._tiles[c];_&&_.setDependencies(f,b)}reloadTilesForDependencies(c,f){for(const b in this._tiles)this._tiles[b].hasDependency(c,f)&&this._reloadTile(b,"reloading");this._cache.filter(b=>!b.hasDependency(c,f))}}function re(S,c){const f=Math.abs(2*S.wrap)-+(S.wrap<0),b=Math.abs(2*c.wrap)-+(c.wrap<0);return S.overscaledZ-c.overscaledZ||b-f||c.canonical.y-S.canonical.y||c.canonical.x-S.canonical.x}function ee(S){return S==="raster"||S==="image"||S==="video"}oe.maxOverzooming=10,oe.maxUnderzooming=3;class te{constructor(c,f){this.reset(c,f)}reset(c,f){this.points=c||[],this._distances=[0];for(let b=1;b<this.points.length;b++)this._distances[b]=this._distances[b-1]+this.points[b].dist(this.points[b-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=a.ae(c,0,1);let f=1,b=this._distances[f];const _=c*this.paddedLength+this.padding;for(;b<_&&f<this._distances.length;)b=this._distances[++f];const T=f-1,I=this._distances[T],z=b-I,U=z>0?(_-I)/z:0;return this.points[T].mult(1-U).add(this.points[f].mult(U))}}function Se(S,c){let f=!0;return S==="always"||S!=="never"&&c!=="never"||(f=!1),f}class ve{constructor(c,f,b){const _=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(c/b),this.yCellCount=Math.ceil(f/b);for(let I=0;I<this.xCellCount*this.yCellCount;I++)_.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=f,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,f,b,_,T){this._forEachCell(f,b,_,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(f),this.bboxes.push(b),this.bboxes.push(_),this.bboxes.push(T)}insertCircle(c,f,b,_){this._forEachCell(f-_,b-_,f+_,b+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(f),this.circles.push(b),this.circles.push(_)}_insertBoxCell(c,f,b,_,T,I){this.boxCells[T].push(I)}_insertCircleCell(c,f,b,_,T,I){this.circleCells[T].push(I)}_query(c,f,b,_,T,I,z){if(b<0||c>this.width||_<0||f>this.height)return[];const U=[];if(c<=0&&f<=0&&this.width<=b&&this.height<=_){if(T)return[{key:null,x1:c,y1:f,x2:b,y2:_}];for(let q=0;q<this.boxKeys.length;q++)U.push({key:this.boxKeys[q],x1:this.bboxes[4*q],y1:this.bboxes[4*q+1],x2:this.bboxes[4*q+2],y2:this.bboxes[4*q+3]});for(let q=0;q<this.circleKeys.length;q++){const J=this.circles[3*q],se=this.circles[3*q+1],ne=this.circles[3*q+2];U.push({key:this.circleKeys[q],x1:J-ne,y1:se-ne,x2:J+ne,y2:se+ne})}}else this._forEachCell(c,f,b,_,this._queryCell,U,{hitTest:T,overlapMode:I,seenUids:{box:{},circle:{}}},z);return U}query(c,f,b,_){return this._query(c,f,b,_,!1,null)}hitTest(c,f,b,_,T,I){return this._query(c,f,b,_,!0,T,I).length>0}hitTestCircle(c,f,b,_,T){const I=c-b,z=c+b,U=f-b,q=f+b;if(z<0||I>this.width||q<0||U>this.height)return!1;const J=[];return this._forEachCell(I,U,z,q,this._queryCellCircle,J,{hitTest:!0,overlapMode:_,circle:{x:c,y:f,radius:b},seenUids:{box:{},circle:{}}},T),J.length>0}_queryCell(c,f,b,_,T,I,z,U){const{seenUids:q,hitTest:J,overlapMode:se}=z,ne=this.boxCells[T];if(ne!==null){const ye=this.bboxes;for(const De of ne)if(!q.box[De]){q.box[De]=!0;const Ee=4*De,Le=this.boxKeys[De];if(c<=ye[Ee+2]&&f<=ye[Ee+3]&&b>=ye[Ee+0]&&_>=ye[Ee+1]&&(!U||U(Le))&&(!J||!Se(se,Le.overlapMode))&&(I.push({key:Le,x1:ye[Ee],y1:ye[Ee+1],x2:ye[Ee+2],y2:ye[Ee+3]}),J))return!0}}const pe=this.circleCells[T];if(pe!==null){const ye=this.circles;for(const De of pe)if(!q.circle[De]){q.circle[De]=!0;const Ee=3*De,Le=this.circleKeys[De];if(this._circleAndRectCollide(ye[Ee],ye[Ee+1],ye[Ee+2],c,f,b,_)&&(!U||U(Le))&&(!J||!Se(se,Le.overlapMode))){const ze=ye[Ee],We=ye[Ee+1],Qe=ye[Ee+2];if(I.push({key:Le,x1:ze-Qe,y1:We-Qe,x2:ze+Qe,y2:We+Qe}),J)return!0}}}return!1}_queryCellCircle(c,f,b,_,T,I,z,U){const{circle:q,seenUids:J,overlapMode:se}=z,ne=this.boxCells[T];if(ne!==null){const ye=this.bboxes;for(const De of ne)if(!J.box[De]){J.box[De]=!0;const Ee=4*De,Le=this.boxKeys[De];if(this._circleAndRectCollide(q.x,q.y,q.radius,ye[Ee+0],ye[Ee+1],ye[Ee+2],ye[Ee+3])&&(!U||U(Le))&&!Se(se,Le.overlapMode))return I.push(!0),!0}}const pe=this.circleCells[T];if(pe!==null){const ye=this.circles;for(const De of pe)if(!J.circle[De]){J.circle[De]=!0;const Ee=3*De,Le=this.circleKeys[De];if(this._circlesCollide(ye[Ee],ye[Ee+1],ye[Ee+2],q.x,q.y,q.radius)&&(!U||U(Le))&&!Se(se,Le.overlapMode))return I.push(!0),!0}}}_forEachCell(c,f,b,_,T,I,z,U){const q=this._convertToXCellCoord(c),J=this._convertToYCellCoord(f),se=this._convertToXCellCoord(b),ne=this._convertToYCellCoord(_);for(let pe=q;pe<=se;pe++)for(let ye=J;ye<=ne;ye++)if(T.call(this,c,f,b,_,this.xCellCount*ye+pe,I,z,U))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,f,b,_,T,I){const z=_-c,U=T-f,q=b+I;return q*q>z*z+U*U}_circleAndRectCollide(c,f,b,_,T,I,z){const U=(I-_)/2,q=Math.abs(c-(_+U));if(q>U+b)return!1;const J=(z-T)/2,se=Math.abs(f-(T+J));if(se>J+b)return!1;if(q<=U||se<=J)return!0;const ne=q-U,pe=se-J;return ne*ne+pe*pe<=b*b}}function Ae(S,c,f){const b=a.K();if(!S){const{vecSouth:se,vecEast:ne}=Xe(c),pe=u();pe[0]=ne[0],pe[1]=ne[1],pe[2]=se[0],pe[3]=se[1],_=pe,(J=(I=(T=pe)[0])*(q=T[3])-(U=T[2])*(z=T[1]))&&(_[0]=q*(J=1/J),_[1]=-z*J,_[2]=-U*J,_[3]=I*J),b[0]=pe[0],b[1]=pe[1],b[4]=pe[2],b[5]=pe[3]}var _,T,I,z,U,q,J;return a.M(b,b,[1/f,1/f,1]),b}function ke(S,c,f,b){if(S){const _=a.K();if(!c){const{vecSouth:T,vecEast:I}=Xe(f);_[0]=I[0],_[1]=I[1],_[4]=T[0],_[5]=T[1]}return a.M(_,_,[b,b,1]),_}return f.pixelsToClipSpaceMatrix}function Xe(S){const c=Math.cos(S.rollInRadians),f=Math.sin(S.rollInRadians),b=Math.cos(S.pitchInRadians),_=Math.cos(S.bearingInRadians),T=Math.sin(S.bearingInRadians),I=a.ak();I[0]=-_*b*f-T*c,I[1]=-T*b*f+_*c;const z=a.al(I);z<1e-9?a.am(I):a.an(I,I,1/z);const U=a.ak();U[0]=_*b*c-T*f,U[1]=T*b*c+_*f;const q=a.al(U);return q<1e-9?a.am(U):a.an(U,U,1/q),{vecEast:U,vecSouth:I}}function ut(S,c,f,b){let _;b?(_=[S,c,b(S,c),1],a.ap(_,_,f)):(_=[S,c,0,1],fs(_,_,f));const T=_[3];return{point:new a.P(_[0]/T,_[1]/T),signedDistanceFromCamera:T,isOccluded:!1}}function lt(S,c){return .5+S/c*.5}function Tt(S,c){return S.x>=-c[0]&&S.x<=c[0]&&S.y>=-c[1]&&S.y<=c[1]}function zt(S,c,f,b,_,T,I,z,U,q,J,se,ne){const pe=f?S.textSizeData:S.iconSizeData,ye=a.ag(pe,c.transform.zoom),De=[256/c.width*2+1,256/c.height*2+1],Ee=f?S.text.dynamicLayoutVertexArray:S.icon.dynamicLayoutVertexArray;Ee.clear();const Le=S.lineVertexArray,ze=f?S.text.placedSymbolArray:S.icon.placedSymbolArray,We=c.transform.width/c.transform.height;let Qe=!1;for(let Ke=0;Ke<ze.length;Ke++){const at=ze.get(Ke);if(at.hidden||at.writingMode===a.ah.vertical&&!Qe){Qi(at.numGlyphs,Ee);continue}Qe=!1;const et=new a.P(at.anchorX,at.anchorY),vt={getElevation:ne,pitchedLabelPlaneMatrix:b,lineVertexArray:Le,pitchWithMap:T,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:c.transform,tileAnchorPoint:et,unwrappedTileID:U,width:q,height:J,translation:se},gt=Oi(at.anchorX,at.anchorY,vt);if(!Tt(gt.point,De)){Qi(at.numGlyphs,Ee);continue}const Dt=lt(c.transform.cameraToCenterDistance,gt.signedDistanceFromCamera),Bt=a.ai(pe,ye,at),It=T?Bt*c.transform.getPitchedTextCorrection(at.anchorX,at.anchorY,U)/Dt:Bt*Dt,di=tn({projectionContext:vt,pitchedLabelPlaneMatrixInverse:_,symbol:at,fontSize:It,flip:!1,keepUpright:I,glyphOffsetArray:S.glyphOffsetArray,dynamicLayoutVertexArray:Ee,aspectRatio:We,rotateToLine:z});Qe=di.useVertical,(di.notEnoughRoom||Qe||di.needsFlipping&&tn({projectionContext:vt,pitchedLabelPlaneMatrixInverse:_,symbol:at,fontSize:It,flip:!0,keepUpright:I,glyphOffsetArray:S.glyphOffsetArray,dynamicLayoutVertexArray:Ee,aspectRatio:We,rotateToLine:z}).notEnoughRoom)&&Qi(at.numGlyphs,Ee)}f?S.text.dynamicLayoutVertexBuffer.updateData(Ee):S.icon.dynamicLayoutVertexBuffer.updateData(Ee)}function ii(S,c,f,b,_,T,I,z){const U=T.glyphStartIndex+T.numGlyphs,q=T.lineStartIndex,J=T.lineStartIndex+T.lineLength,se=c.getoffsetX(T.glyphStartIndex),ne=c.getoffsetX(U-1),pe=br(S*se,f,b,_,T.segment,q,J,z,I);if(!pe)return null;const ye=br(S*ne,f,b,_,T.segment,q,J,z,I);return ye?z.projectionCache.anyProjectionOccluded?null:{first:pe,last:ye}:null}function xt(S,c,f,b){return S===a.ah.horizontal&&Math.abs(f.y-c.y)>Math.abs(f.x-c.x)*b?{useVertical:!0}:(S===a.ah.vertical?c.y<f.y:c.x>f.x)?{needsFlipping:!0}:null}function tn(S){const{projectionContext:c,pitchedLabelPlaneMatrixInverse:f,symbol:b,fontSize:_,flip:T,keepUpright:I,glyphOffsetArray:z,dynamicLayoutVertexArray:U,aspectRatio:q,rotateToLine:J}=S,se=_/24,ne=b.lineOffsetX*se,pe=b.lineOffsetY*se;let ye;if(b.numGlyphs>1){const De=b.glyphStartIndex+b.numGlyphs,Ee=b.lineStartIndex,Le=b.lineStartIndex+b.lineLength,ze=ii(se,z,ne,pe,T,b,J,c);if(!ze)return{notEnoughRoom:!0};const We=qt(ze.first.point.x,ze.first.point.y,c,f),Qe=qt(ze.last.point.x,ze.last.point.y,c,f);if(I&&!T){const Ke=xt(b.writingMode,We,Qe,q);if(Ke)return Ke}ye=[ze.first];for(let Ke=b.glyphStartIndex+1;Ke<De-1;Ke++)ye.push(br(se*z.getoffsetX(Ke),ne,pe,T,b.segment,Ee,Le,c,J));ye.push(ze.last)}else{if(I&&!T){const Ee=Pn(c.tileAnchorPoint.x,c.tileAnchorPoint.y,c).point,Le=b.lineStartIndex+b.segment+1,ze=new a.P(c.lineVertexArray.getx(Le),c.lineVertexArray.gety(Le)),We=Pn(ze.x,ze.y,c),Qe=We.signedDistanceFromCamera>0?We.point:Ni(c.tileAnchorPoint,ze,Ee,1,c),Ke=qt(Ee.x,Ee.y,c,f),at=qt(Qe.x,Qe.y,c,f),et=xt(b.writingMode,Ke,at,q);if(et)return et}const De=br(se*z.getoffsetX(b.glyphStartIndex),ne,pe,T,b.segment,b.lineStartIndex,b.lineStartIndex+b.lineLength,c,J);if(!De||c.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ye=[De]}for(const De of ye)a.ao(U,De.point,De.angle);return{}}function Ni(S,c,f,b,_){const T=S.add(S.sub(c)._unit()),I=Pn(T.x,T.y,_).point,z=f.sub(I);return f.add(z._mult(b/z.mag()))}function ji(S,c,f){const b=c.projectionCache;if(b.projections[S])return b.projections[S];const _=new a.P(c.lineVertexArray.getx(S),c.lineVertexArray.gety(S)),T=Pn(_.x,_.y,c);if(T.signedDistanceFromCamera>0)return b.projections[S]=T.point,b.anyProjectionOccluded=b.anyProjectionOccluded||T.isOccluded,T.point;const I=S-f.direction;return Ni(f.distanceFromAnchor===0?c.tileAnchorPoint:new a.P(c.lineVertexArray.getx(I),c.lineVertexArray.gety(I)),_,f.previousVertex,f.absOffsetX-f.distanceFromAnchor+1,c)}function Pn(S,c,f){const b=S+f.translation[0],_=c+f.translation[1];let T;return f.pitchWithMap?(T=ut(b,_,f.pitchedLabelPlaneMatrix,f.getElevation),T.isOccluded=!1):(T=f.transform.projectTileCoordinates(b,_,f.unwrappedTileID,f.getElevation),T.point.x=(.5*T.point.x+.5)*f.width,T.point.y=(.5*-T.point.y+.5)*f.height),T}function qt(S,c,f,b){if(f.pitchWithMap){const _=[S,c,0,1];return a.ap(_,_,b),f.transform.projectTileCoordinates(_[0]/_[3],_[1]/_[3],f.unwrappedTileID,f.getElevation).point}return{x:S/f.width*2-1,y:c/f.height*2-1}}function Oi(S,c,f){return f.transform.projectTileCoordinates(S,c,f.unwrappedTileID,f.getElevation)}function li(S,c,f){return S._unit()._perp()._mult(c*f)}function dn(S,c,f,b,_,T,I,z,U){if(z.projectionCache.offsets[S])return z.projectionCache.offsets[S];const q=f.add(c);if(S+U.direction<b||S+U.direction>=_)return z.projectionCache.offsets[S]=q,q;const J=ji(S+U.direction,z,U),se=li(J.sub(f),I,U.direction),ne=f.add(se),pe=J.add(se);return z.projectionCache.offsets[S]=a.aq(T,q,ne,pe)||q,z.projectionCache.offsets[S]}function br(S,c,f,b,_,T,I,z,U){const q=b?S-c:S+c;let J=q>0?1:-1,se=0;b&&(J*=-1,se=Math.PI),J<0&&(se+=Math.PI);let ne,pe=J>0?T+_:T+_+1;z.projectionCache.cachedAnchorPoint?ne=z.projectionCache.cachedAnchorPoint:(ne=Pn(z.tileAnchorPoint.x,z.tileAnchorPoint.y,z).point,z.projectionCache.cachedAnchorPoint=ne);let ye,De,Ee=ne,Le=ne,ze=0,We=0;const Qe=Math.abs(q),Ke=[];let at;for(;ze+We<=Qe;){if(pe+=J,pe<T||pe>=I)return null;ze+=We,Le=Ee,De=ye;const gt={absOffsetX:Qe,direction:J,distanceFromAnchor:ze,previousVertex:Le};if(Ee=ji(pe,z,gt),f===0)Ke.push(Le),at=Ee.sub(Le);else{let Dt;const Bt=Ee.sub(Le);Dt=Bt.mag()===0?li(ji(pe+J,z,gt).sub(Ee),f,J):li(Bt,f,J),De||(De=Le.add(Dt)),ye=dn(pe,Dt,Ee,T,I,De,f,z,gt),Ke.push(De),at=ye.sub(De)}We=at.mag()}const et=at._mult((Qe-ze)/We)._add(De||Le),vt=se+Math.atan2(Ee.y-Le.y,Ee.x-Le.x);return Ke.push(et),{point:et,angle:U?vt:0,path:Ke}}const Ka=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Qi(S,c){for(let f=0;f<S;f++){const b=c.length;c.resize(b+4),c.float32.set(Ka,3*b)}}function fs(S,c,f){const b=c[0],_=c[1];return S[0]=f[0]*b+f[4]*_+f[12],S[1]=f[1]*b+f[5]*_+f[13],S[3]=f[3]*b+f[7]*_+f[15],S}const wr=100;class sf{constructor(c,f=new ve(c.width+200,c.height+200,25),b=new ve(c.width+200,c.height+200,25)){this.transform=c,this.grid=f,this.ignoredGrid=b,this.pitchFactor=Math.cos(c.pitch*Math.PI/180)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+wr,this.screenBottomBoundary=c.height+wr,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(c,f,b,_,T,I,z,U,q,J,se,ne){const pe=this.projectAndGetPerspectiveRatio(c.anchorPointX+U[0],c.anchorPointY+U[1],T,J,ne),ye=b*pe.perspectiveRatio;let De;if(I||z)De=this._projectCollisionBox(c,ye,_,T,I,z,U,pe,J,se,ne);else{const at=pe.x+(se?se.x*ye:0),et=pe.y+(se?se.y*ye:0);De={allPointsOccluded:!1,box:[at+c.x1*ye,et+c.y1*ye,at+c.x2*ye,et+c.y2*ye]}}const[Ee,Le,ze,We]=De.box,Qe=I?De.allPointsOccluded:pe.isOccluded;let Ke=Qe;return Ke||(Ke=pe.perspectiveRatio<this.perspectiveRatioCutoff),Ke||(Ke=!this.isInsideGrid(Ee,Le,ze,We)),Ke||f!=="always"&&this.grid.hitTest(Ee,Le,ze,We,f,q)?{box:[Ee,Le,ze,We],placeable:!1,offscreen:!1,occluded:Qe}:{box:[Ee,Le,ze,We],placeable:!0,offscreen:this.isOffscreen(Ee,Le,ze,We),occluded:Qe}}placeCollisionCircles(c,f,b,_,T,I,z,U,q,J,se,ne,pe,ye){const De=[],Ee=new a.P(f.anchorX,f.anchorY),Le=this.getPerspectiveRatio(Ee.x,Ee.y,I,ye),ze=(q?T*this.transform.getPitchedTextCorrection(f.anchorX,f.anchorY,I)/Le:T*Le)/a.av,We={getElevation:ye,pitchedLabelPlaneMatrix:z,lineVertexArray:b,pitchWithMap:q,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Ee,unwrappedTileID:I,width:this.transform.width,height:this.transform.height,translation:pe},Qe=ii(ze,_,f.lineOffsetX*ze,f.lineOffsetY*ze,!1,f,!1,We);let Ke=!1,at=!1,et=!0;if(Qe){const vt=.5*se*Le+ne,gt=new a.P(-100,-100),Dt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Bt=new te,It=Qe.first,di=Qe.last;let ui=[];for(let vn=It.path.length-1;vn>=1;vn--)ui.push(It.path[vn]);for(let vn=1;vn<di.path.length;vn++)ui.push(di.path[vn]);const Ht=2.5*vt;if(q){const vn=this.projectPathToScreenSpace(ui,We);ui=vn.some(rr=>rr.signedDistanceFromCamera<=0)?[]:vn.map(rr=>rr.point)}let Ri=[];if(ui.length>0){const vn=ui[0].clone(),rr=ui[0].clone();for(let bn=1;bn<ui.length;bn++)vn.x=Math.min(vn.x,ui[bn].x),vn.y=Math.min(vn.y,ui[bn].y),rr.x=Math.max(rr.x,ui[bn].x),rr.y=Math.max(rr.y,ui[bn].y);Ri=vn.x>=gt.x&&rr.x<=Dt.x&&vn.y>=gt.y&&rr.y<=Dt.y?[ui]:rr.x<gt.x||vn.x>Dt.x||rr.y<gt.y||vn.y>Dt.y?[]:a.ar([ui],gt.x,gt.y,Dt.x,Dt.y)}for(const vn of Ri){Bt.reset(vn,.25*vt);let rr=0;rr=Bt.length<=.5*vt?1:Math.ceil(Bt.paddedLength/Ht)+1;for(let bn=0;bn<rr;bn++){const pr=bn/Math.max(rr-1,1),Cr=Bt.lerp(pr),Rr=Cr.x+wr,hr=Cr.y+wr;De.push(Rr,hr,vt,0);const mr=Rr-vt,ms=hr-vt,Ls=Rr+vt,Ws=hr+vt;if(et=et&&this.isOffscreen(mr,ms,Ls,Ws),at=at||this.isInsideGrid(mr,ms,Ls,Ws),c!=="always"&&this.grid.hitTestCircle(Rr,hr,vt,c,J)&&(Ke=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Ke}}}}return{circles:!U&&Ke||!at||Le<this.perspectiveRatioCutoff?[]:De,offscreen:et,collisionDetected:Ke}}projectPathToScreenSpace(c,f){const b=function(_,T){const I=a.K();return a.aj(I,T.pitchedLabelPlaneMatrix),_.map(z=>{const U=ut(z.x,z.y,I,T.getElevation),q=T.transform.projectTileCoordinates(U.point.x,U.point.y,T.unwrappedTileID,T.getElevation);return q.point.x=(.5*q.point.x+.5)*T.width,q.point.y=(.5*-q.point.y+.5)*T.height,q})}(c,f);return function(_){let T=0,I=0,z=0,U=0;for(let q=0;q<_.length;q++)_[q].isOccluded?(z=q+1,U=0):(U++,U>I&&(I=U,T=z));return _.slice(T,T+I)}(b)}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let b=1/0,_=1/0,T=-1/0,I=-1/0;for(const J of c){const se=new a.P(J.x+wr,J.y+wr);b=Math.min(b,se.x),_=Math.min(_,se.y),T=Math.max(T,se.x),I=Math.max(I,se.y),f.push(se)}const z=this.grid.query(b,_,T,I).concat(this.ignoredGrid.query(b,_,T,I)),U={},q={};for(const J of z){const se=J.key;if(U[se.bucketInstanceId]===void 0&&(U[se.bucketInstanceId]={}),U[se.bucketInstanceId][se.featureIndex])continue;const ne=[new a.P(J.x1,J.y1),new a.P(J.x2,J.y1),new a.P(J.x2,J.y2),new a.P(J.x1,J.y2)];a.as(f,ne)&&(U[se.bucketInstanceId][se.featureIndex]=!0,q[se.bucketInstanceId]===void 0&&(q[se.bucketInstanceId]=[]),q[se.bucketInstanceId].push(se.featureIndex))}return q}insertCollisionBox(c,f,b,_,T,I){(b?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:T,collisionGroupID:I,overlapMode:f},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,f,b,_,T,I){const z=b?this.ignoredGrid:this.grid,U={bucketInstanceId:_,featureIndex:T,collisionGroupID:I,overlapMode:f};for(let q=0;q<c.length;q+=4)z.insertCircle(U,c[q],c[q+1],c[q+2])}projectAndGetPerspectiveRatio(c,f,b,_,T){if(T){let I;_?(I=[c,f,_(c,f),1],a.ap(I,I,T)):(I=[c,f,0,1],fs(I,I,T));const z=I[3];return{x:(I[0]/z+1)/2*this.transform.width+wr,y:(-I[1]/z+1)/2*this.transform.height+wr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/z*.5,isOccluded:!1,signedDistanceFromCamera:z}}{const I=this.transform.projectTileCoordinates(c,f,b,_);return{x:(I.point.x+1)/2*this.transform.width+wr,y:(1-I.point.y)/2*this.transform.height+wr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5,isOccluded:I.isOccluded,signedDistanceFromCamera:I.signedDistanceFromCamera}}}getPerspectiveRatio(c,f,b,_){const T=this.transform.projectTileCoordinates(c,f,b,_);return .5+this.transform.cameraToCenterDistance/T.signedDistanceFromCamera*.5}isOffscreen(c,f,b,_){return b<wr||c>=this.screenRightBoundary||_<wr||f>this.screenBottomBoundary}isInsideGrid(c,f,b,_){return b>=0&&c<this.gridRightBoundary&&_>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const c=a.at([]);return a.L(c,c,[-100,-100,0]),c}_projectCollisionBox(c,f,b,_,T,I,z,U,q,J,se){let ne=1,pe=0,ye=0,De=1;const Ee=c.anchorPointX+z[0],Le=c.anchorPointY+z[1];if(I&&!T){const ui=this.projectAndGetPerspectiveRatio(Ee+1,Le,_,q,se),Ht=ui.x-U.x,Ri=Math.atan((ui.y-U.y)/Ht)+(Ht<0?Math.PI:0),vn=Math.sin(Ri),rr=Math.cos(Ri);ne=rr,pe=vn,ye=-vn,De=rr}else if(!I&&T){const ui=Xe(this.transform);ne=ui.vecEast[0],pe=ui.vecEast[1],ye=ui.vecSouth[0],De=ui.vecSouth[1]}let ze=U.x,We=U.y,Qe=f;T&&(ze=Ee,We=Le,Qe=Math.pow(2,-(this.transform.zoom-b.overscaledZ)),Qe*=this.transform.getPitchedTextCorrection(Ee,Le,_),J||(Qe*=a.ae(.5+U.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),J&&(ze+=ne*J.x*Qe+ye*J.y*Qe,We+=pe*J.x*Qe+De*J.y*Qe);const Ke=c.x1*Qe,at=c.x2*Qe,et=(Ke+at)/2,vt=c.y1*Qe,gt=c.y2*Qe,Dt=(vt+gt)/2,Bt=[{offsetX:Ke,offsetY:vt},{offsetX:et,offsetY:vt},{offsetX:at,offsetY:vt},{offsetX:at,offsetY:Dt},{offsetX:at,offsetY:gt},{offsetX:et,offsetY:gt},{offsetX:Ke,offsetY:gt},{offsetX:Ke,offsetY:Dt}];let It=[];for(const{offsetX:ui,offsetY:Ht}of Bt)It.push(new a.P(ze+ne*ui+ye*Ht,We+pe*ui+De*Ht));let di=!1;if(T){const ui=It.map(Ht=>this.projectAndGetPerspectiveRatio(Ht.x,Ht.y,_,q,se));di=ui.some(Ht=>!Ht.isOccluded),It=ui.map(Ht=>new a.P(Ht.x,Ht.y))}else di=!0;return{box:a.au(It),allPointsOccluded:!di}}}class ku{constructor(c,f,b,_){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?f:-f))):_&&b?1:0,this.placed=b}isHidden(){return this.opacity===0&&!this.placed}}class ac{constructor(c,f,b,_,T){this.text=new ku(c?c.text:null,f,b,T),this.icon=new ku(c?c.icon:null,f,_,T)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xo{constructor(c,f,b){this.text=c,this.icon=f,this.skipFade=b}}class Oe{constructor(c,f,b,_,T){this.bucketInstanceId=c,this.featureIndex=f,this.sourceLayerIndex=b,this.bucketIndex=_,this.tileID=T}}class pt{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const f=++this.maxGroupID;this.collisionGroups[c]={ID:f,predicate:b=>b.collisionGroupID===f}}return this.collisionGroups[c]}}function Mt(S,c,f,b,_){const{horizontalAlign:T,verticalAlign:I}=a.aB(S);return new a.P(-(T-.5)*c+b[0]*_,-(I-.5)*f+b[1]*_)}class Rt{constructor(c,f,b,_,T){this.transform=c.clone(),this.terrain=f,this.collisionIndex=new sf(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=b,this.retainedQueryData={},this.collisionGroups=new pt(_),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=T,T&&(T.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(c){const f=this.terrain;return f?(b,_)=>f.getElevation(c,b,_):null}getBucketParts(c,f,b,_){const T=b.getBucket(f),I=b.latestFeatureIndex;if(!T||!I||f.id!==T.layerIds[0])return;const z=b.collisionBoxArray,U=T.layers[0].layout,q=T.layers[0].paint,J=Math.pow(2,this.transform.zoom-b.tileID.overscaledZ),se=b.tileSize/a.Z,ne=b.tileID.toUnwrapped(),pe=U.get("text-rotation-alignment")==="map",ye=a.aw(b,1,this.transform.zoom),De=a.ax(this.collisionIndex.transform,b,q.get("text-translate"),q.get("text-translate-anchor")),Ee=a.ax(this.collisionIndex.transform,b,q.get("icon-translate"),q.get("icon-translate-anchor")),Le=Ae(pe,this.transform,ye);this.retainedQueryData[T.bucketInstanceId]=new Oe(T.bucketInstanceId,I,T.sourceLayerIndex,T.index,b.tileID);const ze={bucket:T,layout:U,translationText:De,translationIcon:Ee,unwrappedTileID:ne,pitchedLabelPlaneMatrix:Le,scale:J,textPixelRatio:se,holdingForFade:b.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:a.ag(T.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(_)for(const We of T.sortKeyRanges){const{sortKey:Qe,symbolInstanceStart:Ke,symbolInstanceEnd:at}=We;c.push({sortKey:Qe,symbolInstanceStart:Ke,symbolInstanceEnd:at,parameters:ze})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:ze})}attemptAnchorPlacement(c,f,b,_,T,I,z,U,q,J,se,ne,pe,ye,De,Ee,Le,ze,We,Qe){const Ke=a.ay[c.textAnchor],at=[c.textOffset0,c.textOffset1],et=Mt(Ke,b,_,at,T),vt=this.collisionIndex.placeCollisionBox(f,ne,U,q,J,z,I,Ee,se.predicate,We,et,Qe);if((!ze||this.collisionIndex.placeCollisionBox(ze,ne,U,q,J,z,I,Le,se.predicate,We,et,Qe).placeable)&&vt.placeable){let gt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID].text&&(gt=this.prevPlacement.variableOffsets[pe.crossTileID].anchor),pe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[pe.crossTileID]={textOffset:at,width:b,height:_,anchor:Ke,textBoxScale:T,prevAnchor:gt},this.markUsedJustification(ye,Ke,pe,De),ye.allowVerticalPlacement&&(this.markUsedOrientation(ye,De,pe),this.placedOrientations[pe.crossTileID]=De),{shift:et,placedGlyphBoxes:vt}}}placeLayerBucketPart(c,f,b){const{bucket:_,layout:T,translationText:I,translationIcon:z,unwrappedTileID:U,pitchedLabelPlaneMatrix:q,textPixelRatio:J,holdingForFade:se,collisionBoxArray:ne,partiallyEvaluatedTextSize:pe,collisionGroup:ye}=c.parameters,De=T.get("text-optional"),Ee=T.get("icon-optional"),Le=a.az(T,"text-overlap","text-allow-overlap"),ze=Le==="always",We=a.az(T,"icon-overlap","icon-allow-overlap"),Qe=We==="always",Ke=T.get("text-rotation-alignment")==="map",at=T.get("text-pitch-alignment")==="map",et=T.get("icon-text-fit")!=="none",vt=T.get("symbol-z-order")==="viewport-y",gt=ze&&(Qe||!_.hasIconData()||Ee),Dt=Qe&&(ze||!_.hasTextData()||De);!_.collisionArrays&&ne&&_.deserializeCollisionBoxes(ne);const Bt=this.retainedQueryData[_.bucketInstanceId].tileID,It=this._getTerrainElevationFunc(Bt),di=this.transform.getFastPathSimpleProjectionMatrix(Bt),ui=(Ht,Ri,vn)=>{var rr,bn;if(f[Ht.crossTileID])return;if(se)return void(this.placements[Ht.crossTileID]=new xo(!1,!1,!1));let pr=!1,Cr=!1,Rr=!0,hr=null,mr={box:null,placeable:!1,offscreen:null,occluded:!1},ms={placeable:!1},Ls=null,Ws=null,ta=null,nu=0,pc=0,Nu=0;Ri.textFeatureIndex?nu=Ri.textFeatureIndex:Ht.useRuntimeCollisionCircles&&(nu=Ht.featureIndex),Ri.verticalTextFeatureIndex&&(pc=Ri.verticalTextFeatureIndex);const Bu=Ri.textBox;if(Bu){const _a=qr=>{let jr=a.ah.horizontal;if(_.allowVerticalPlacement&&!qr&&this.prevPlacement){const Cs=this.prevPlacement.placedOrientations[Ht.crossTileID];Cs&&(this.placedOrientations[Ht.crossTileID]=Cs,jr=Cs,this.markUsedOrientation(_,jr,Ht))}return jr},su=(qr,jr)=>{if(_.allowVerticalPlacement&&Ht.numVerticalGlyphVertices>0&&Ri.verticalTextBox){for(const Cs of _.writingModes)if(Cs===a.ah.vertical?(mr=jr(),ms=mr):mr=qr(),mr&&mr.placeable)break}else mr=qr()},nd=Ht.textAnchorOffsetStartIndex,rd=Ht.textAnchorOffsetEndIndex;if(rd===nd){const qr=(jr,Cs)=>{const _r=this.collisionIndex.placeCollisionBox(jr,Le,J,Bt,U,at,Ke,I,ye.predicate,It,void 0,di);return _r&&_r.placeable&&(this.markUsedOrientation(_,Cs,Ht),this.placedOrientations[Ht.crossTileID]=Cs),_r};su(()=>qr(Bu,a.ah.horizontal),()=>{const jr=Ri.verticalTextBox;return _.allowVerticalPlacement&&Ht.numVerticalGlyphVertices>0&&jr?qr(jr,a.ah.vertical):{box:null,offscreen:null}}),_a(mr&&mr.placeable)}else{let qr=a.ay[(bn=(rr=this.prevPlacement)===null||rr===void 0?void 0:rr.variableOffsets[Ht.crossTileID])===null||bn===void 0?void 0:bn.anchor];const jr=(_r,zu,KS)=>{const sd=_r.x2-_r.x1,f2=_r.y2-_r.y1,YS=Ht.textBoxScale,cb=et&&We==="never"?zu:null;let Vu=null,Gu=Le==="never"?1:2,Uu="never";qr&&Gu++;for(let ub=0;ub<Gu;ub++){for(let hb=nd;hb<rd;hb++){const Uv=_.textAnchorOffsets.get(hb);if(qr&&Uv.textAnchor!==qr)continue;const Hv=this.attemptAnchorPlacement(Uv,_r,sd,f2,YS,Ke,at,J,Bt,U,ye,Uu,Ht,_,KS,I,z,cb,It);if(Hv&&(Vu=Hv.placedGlyphBoxes,Vu&&Vu.placeable))return pr=!0,hr=Hv.shift,Vu}qr?qr=null:Uu=Le}return b&&!Vu&&(Vu={box:this.collisionIndex.placeCollisionBox(Bu,"always",J,Bt,U,at,Ke,I,ye.predicate,It,void 0,di).box,offscreen:!1,placeable:!1,occluded:!1}),Vu};su(()=>jr(Bu,Ri.iconBox,a.ah.horizontal),()=>{const _r=Ri.verticalTextBox;return _.allowVerticalPlacement&&(!mr||!mr.placeable)&&Ht.numVerticalGlyphVertices>0&&_r?jr(_r,Ri.verticalIconBox,a.ah.vertical):{box:null,occluded:!0,offscreen:null}}),mr&&(pr=mr.placeable,Rr=mr.offscreen);const Cs=_a(mr&&mr.placeable);if(!pr&&this.prevPlacement){const _r=this.prevPlacement.variableOffsets[Ht.crossTileID];_r&&(this.variableOffsets[Ht.crossTileID]=_r,this.markUsedJustification(_,_r.anchor,Ht,Cs))}}}if(Ls=mr,pr=Ls&&Ls.placeable,Rr=Ls&&Ls.offscreen,Ht.useRuntimeCollisionCircles){const _a=_.text.placedSymbolArray.get(Ht.centerJustifiedTextSymbolIndex),su=a.ai(_.textSizeData,pe,_a),nd=T.get("text-padding");Ws=this.collisionIndex.placeCollisionCircles(Le,_a,_.lineVertexArray,_.glyphOffsetArray,su,U,q,b,at,ye.predicate,Ht.collisionCircleDiameter,nd,I,It),Ws.circles.length&&Ws.collisionDetected&&!b&&a.w("Collisions detected, but collision boxes are not shown"),pr=ze||Ws.circles.length>0&&!Ws.collisionDetected,Rr=Rr&&Ws.offscreen}if(Ri.iconFeatureIndex&&(Nu=Ri.iconFeatureIndex),Ri.iconBox){const _a=su=>this.collisionIndex.placeCollisionBox(su,We,J,Bt,U,at,Ke,z,ye.predicate,It,et&&hr?hr:void 0,di);ms&&ms.placeable&&Ri.verticalIconBox?(ta=_a(Ri.verticalIconBox),Cr=ta.placeable):(ta=_a(Ri.iconBox),Cr=ta.placeable),Rr=Rr&&ta.offscreen}const id=De||Ht.numHorizontalGlyphVertices===0&&Ht.numVerticalGlyphVertices===0,mc=Ee||Ht.numIconVertices===0;id||mc?mc?id||(Cr=Cr&&pr):pr=Cr&&pr:Cr=pr=Cr&&pr;const ru=Cr&&ta.placeable;if(pr&&Ls.placeable&&this.collisionIndex.insertCollisionBox(Ls.box,Le,T.get("text-ignore-placement"),_.bucketInstanceId,ms&&ms.placeable&&pc?pc:nu,ye.ID),ru&&this.collisionIndex.insertCollisionBox(ta.box,We,T.get("icon-ignore-placement"),_.bucketInstanceId,Nu,ye.ID),Ws&&pr&&this.collisionIndex.insertCollisionCircles(Ws.circles,Le,T.get("text-ignore-placement"),_.bucketInstanceId,nu,ye.ID),b&&this.storeCollisionData(_.bucketInstanceId,vn,Ri,Ls,ta,Ws),Ht.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ht.crossTileID]=new xo((pr||gt)&&!Ls?.occluded,(Cr||Dt)&&!ta?.occluded,Rr||_.justReloaded),f[Ht.crossTileID]=!0};if(vt){if(c.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ht=_.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Ri=Ht.length-1;Ri>=0;--Ri){const vn=Ht[Ri];ui(_.symbolInstances.get(vn),_.collisionArrays[vn],vn)}}else for(let Ht=c.symbolInstanceStart;Ht<c.symbolInstanceEnd;Ht++)ui(_.symbolInstances.get(Ht),_.collisionArrays[Ht],Ht);_.justReloaded=!1}storeCollisionData(c,f,b,_,T,I){if(b.textBox||b.iconBox){let z,U;this.collisionBoxArrays.has(c)?z=this.collisionBoxArrays.get(c):(z=new Map,this.collisionBoxArrays.set(c,z)),z.has(f)?U=z.get(f):(U={text:null,icon:null},z.set(f,U)),b.textBox&&(U.text=_.box),b.iconBox&&(U.icon=T.box)}if(I){let z=this.collisionCircleArrays[c];z===void 0&&(z=this.collisionCircleArrays[c]=[]);for(let U=0;U<I.circles.length;U+=4)z.push(I.circles[U+0]-wr),z.push(I.circles[U+1]-wr),z.push(I.circles[U+2]),z.push(I.collisionDetected?1:0)}}markUsedJustification(c,f,b,_){let T;T=_===a.ah.vertical?b.verticalPlacedTextSymbolIndex:{left:b.leftJustifiedTextSymbolIndex,center:b.centerJustifiedTextSymbolIndex,right:b.rightJustifiedTextSymbolIndex}[a.aA(f)];const I=[b.leftJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.rightJustifiedTextSymbolIndex,b.verticalPlacedTextSymbolIndex];for(const z of I)z>=0&&(c.text.placedSymbolArray.get(z).crossTileID=T>=0&&z!==T?0:b.crossTileID)}markUsedOrientation(c,f,b){const _=f===a.ah.horizontal||f===a.ah.horizontalOnly?f:0,T=f===a.ah.vertical?f:0,I=[b.leftJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.rightJustifiedTextSymbolIndex];for(const z of I)c.text.placedSymbolArray.get(z).placedOrientation=_;b.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(b.verticalPlacedTextSymbolIndex).placedOrientation=T)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let b=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const _=f?f.symbolFadeChange(c):1,T=f?f.opacities:{},I=f?f.variableOffsets:{},z=f?f.placedOrientations:{};for(const U in this.placements){const q=this.placements[U],J=T[U];J?(this.opacities[U]=new ac(J,_,q.text,q.icon),b=b||q.text!==J.text.placed||q.icon!==J.icon.placed):(this.opacities[U]=new ac(null,_,q.text,q.icon,q.skipFade),b=b||q.text||q.icon)}for(const U in T){const q=T[U];if(!this.opacities[U]){const J=new ac(q,_,!1,!1);J.isHidden()||(this.opacities[U]=J,b=b||q.text.placed||q.icon.placed)}}for(const U in I)this.variableOffsets[U]||!this.opacities[U]||this.opacities[U].isHidden()||(this.variableOffsets[U]=I[U]);for(const U in z)this.placedOrientations[U]||!this.opacities[U]||this.opacities[U].isHidden()||(this.placedOrientations[U]=z[U]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");b?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:c)}updateLayerOpacities(c,f){const b={};for(const _ of f){const T=_.getBucket(c);T&&_.latestFeatureIndex&&c.id===T.layerIds[0]&&this.updateBucketOpacities(T,_.tileID,b,_.collisionBoxArray)}}updateBucketOpacities(c,f,b,_){c.hasTextData()&&(c.text.opacityVertexArray.clear(),c.text.hasVisibleVertices=!1),c.hasIconData()&&(c.icon.opacityVertexArray.clear(),c.icon.hasVisibleVertices=!1),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const T=c.layers[0],I=T.layout,z=new ac(null,0,!1,!1,!0),U=I.get("text-allow-overlap"),q=I.get("icon-allow-overlap"),J=T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"),se=I.get("text-rotation-alignment")==="map",ne=I.get("text-pitch-alignment")==="map",pe=I.get("icon-text-fit")!=="none",ye=new ac(null,0,U&&(q||!c.hasIconData()||I.get("icon-optional")),q&&(U||!c.hasTextData()||I.get("text-optional")),!0);!c.collisionArrays&&_&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(_);const De=(Le,ze,We)=>{for(let Qe=0;Qe<ze/4;Qe++)Le.opacityVertexArray.emplaceBack(We);Le.hasVisibleVertices=Le.hasVisibleVertices||We!==Hn},Ee=this.collisionBoxArrays.get(c.bucketInstanceId);for(let Le=0;Le<c.symbolInstances.length;Le++){const ze=c.symbolInstances.get(Le),{numHorizontalGlyphVertices:We,numVerticalGlyphVertices:Qe,crossTileID:Ke}=ze;let at=this.opacities[Ke];b[Ke]?at=z:at||(at=ye,this.opacities[Ke]=at),b[Ke]=!0;const et=ze.numIconVertices>0,vt=this.placedOrientations[ze.crossTileID],gt=vt===a.ah.vertical,Dt=vt===a.ah.horizontal||vt===a.ah.horizontalOnly;if(We>0||Qe>0){const It=Un(at.text);De(c.text,We,gt?Hn:It),De(c.text,Qe,Dt?Hn:It);const di=at.text.isHidden();[ze.rightJustifiedTextSymbolIndex,ze.centerJustifiedTextSymbolIndex,ze.leftJustifiedTextSymbolIndex].forEach(Ri=>{Ri>=0&&(c.text.placedSymbolArray.get(Ri).hidden=di||gt?1:0)}),ze.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(ze.verticalPlacedTextSymbolIndex).hidden=di||Dt?1:0);const ui=this.variableOffsets[ze.crossTileID];ui&&this.markUsedJustification(c,ui.anchor,ze,vt);const Ht=this.placedOrientations[ze.crossTileID];Ht&&(this.markUsedJustification(c,"left",ze,Ht),this.markUsedOrientation(c,Ht,ze))}if(et){const It=Un(at.icon),di=!(pe&&ze.verticalPlacedIconSymbolIndex&&gt);ze.placedIconSymbolIndex>=0&&(De(c.icon,ze.numIconVertices,di?It:Hn),c.icon.placedSymbolArray.get(ze.placedIconSymbolIndex).hidden=at.icon.isHidden()),ze.verticalPlacedIconSymbolIndex>=0&&(De(c.icon,ze.numVerticalIconVertices,di?Hn:It),c.icon.placedSymbolArray.get(ze.verticalPlacedIconSymbolIndex).hidden=at.icon.isHidden())}const Bt=Ee&&Ee.has(Le)?Ee.get(Le):{text:null,icon:null};if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const It=c.collisionArrays[Le];if(It){let di=new a.P(0,0);if(It.textBox||It.verticalTextBox){let ui=!0;if(J){const Ht=this.variableOffsets[Ke];Ht?(di=Mt(Ht.anchor,Ht.width,Ht.height,Ht.textOffset,Ht.textBoxScale),se&&di._rotate(ne?-this.transform.bearingInRadians:this.transform.bearingInRadians)):ui=!1}if(It.textBox||It.verticalTextBox){let Ht;It.textBox&&(Ht=gt),It.verticalTextBox&&(Ht=Dt),ft(c.textCollisionBox.collisionVertexArray,at.text.placed,!ui||Ht,Bt.text,di.x,di.y)}}if(It.iconBox||It.verticalIconBox){const ui=!!(!Dt&&It.verticalIconBox);let Ht;It.iconBox&&(Ht=ui),It.verticalIconBox&&(Ht=!ui),ft(c.iconCollisionBox.collisionVertexArray,at.icon.placed,Ht,Bt.icon,pe?di.x:0,pe?di.y:0)}}}}if(c.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.text.opacityVertexArray.length!==c.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${c.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${c.text.layoutVertexArray.length}) / 4`);if(c.icon.opacityVertexArray.length!==c.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${c.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${c.icon.layoutVertexArray.length}) / 4`);c.bucketInstanceId in this.collisionCircleArrays&&(c.collisionCircleArray=this.collisionCircleArrays[c.bucketInstanceId],delete this.collisionCircleArrays[c.bucketInstanceId])}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,f){const b=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*b>c}setStale(){this.stale=!0}}function ft(S,c,f,b,_,T){b&&b.length!==0||(b=[0,0,0,0]);const I=b[0]-wr,z=b[1]-wr,U=b[2]-wr,q=b[3]-wr;S.emplaceBack(c?1:0,f?1:0,_||0,T||0,I,z),S.emplaceBack(c?1:0,f?1:0,_||0,T||0,U,z),S.emplaceBack(c?1:0,f?1:0,_||0,T||0,U,q),S.emplaceBack(c?1:0,f?1:0,_||0,T||0,I,q)}const ci=Math.pow(2,25),Mi=Math.pow(2,24),ki=Math.pow(2,17),Bi=Math.pow(2,16),un=Math.pow(2,9),pn=Math.pow(2,8),ln=Math.pow(2,1);function Un(S){if(S.opacity===0&&!S.placed)return 0;if(S.opacity===1&&S.placed)return 4294967295;const c=S.placed?1:0,f=Math.floor(127*S.opacity);return f*ci+c*Mi+f*ki+c*Bi+f*un+c*pn+f*ln+c}const Hn=0;class $r{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&!c.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(c,f,b,_,T){const I=this._bucketParts;for(;this._currentTileIndex<c.length;)if(f.getBucketParts(I,_,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((z,U)=>z.sortKey-U.sortKey));this._currentPartIndex<I.length;)if(f.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,b),this._currentPartIndex++,T())return!0;return!1}}class Er{constructor(c,f,b,_,T,I,z,U){this.placement=new Rt(c,f,I,z,U),this._currentPlacementIndex=b.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=T,this._done=!1}isDone(){return this._done}continuePlacement(c,f,b){const _=v.now(),T=()=>!this._forceFullPlacement&&v.now()-_>2;for(;this._currentPlacementIndex>=0;){const I=f[c[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=z)&&(!I.maxzoom||I.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new $r(I)),this._inProgressLayer.continuePlacement(b[I.source],this.placement,this._showCollisionBoxes,I,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const En=512/a.Z/2;class on{constructor(c,f,b){this.tileID=c,this.bucketInstanceId=b,this._symbolsByKey={};const _=new Map;for(let T=0;T<f.length;T++){const I=f.get(T),z=I.key,U=_.get(z);U?U.push(I):_.set(z,[I])}for(const[T,I]of _){const z={positions:I.map(U=>({x:Math.floor(U.anchorX*En),y:Math.floor(U.anchorY*En)})),crossTileIDs:I.map(U=>U.crossTileID)};if(z.positions.length>128){const U=new a.aC(z.positions.length,16,Uint16Array);for(const{x:q,y:J}of z.positions)U.add(q,J);U.finish(),delete z.positions,z.index=U}this._symbolsByKey[T]=z}}getScaledCoordinates(c,f){const{x:b,y:_,z:T}=this.tileID.canonical,{x:I,y:z,z:U}=f.canonical,q=En/Math.pow(2,U-T),J=(z*a.Z+c.anchorY)*q,se=_*a.Z*En;return{x:Math.floor((I*a.Z+c.anchorX)*q-b*a.Z*En),y:Math.floor(J-se)}}findMatches(c,f,b){const _=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let T=0;T<c.length;T++){const I=c.get(T);if(I.crossTileID)continue;const z=this._symbolsByKey[I.key];if(!z)continue;const U=this.getScaledCoordinates(I,f);if(z.index){const q=z.index.range(U.x-_,U.y-_,U.x+_,U.y+_).sort();for(const J of q){const se=z.crossTileIDs[J];if(!b[se]){b[se]=!0,I.crossTileID=se;break}}}else if(z.positions)for(let q=0;q<z.positions.length;q++){const J=z.positions[q],se=z.crossTileIDs[q];if(Math.abs(J.x-U.x)<=_&&Math.abs(J.y-U.y)<=_&&!b[se]){b[se]=!0,I.crossTileID=se;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:c})=>c)}}class ws{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const f=Math.round((c-this.lng)/360);if(f!==0)for(const b in this.indexes){const _=this.indexes[b],T={};for(const I in _){const z=_[I];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+f),T[z.tileID.key]=z}this.indexes[b]=T}this.lng=c}addBucket(c,f,b){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let T=0;T<f.symbolInstances.length;T++)f.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});const _=this.usedCrossTileIDs[c.overscaledZ];for(const T in this.indexes){const I=this.indexes[T];if(Number(T)>c.overscaledZ)for(const z in I){const U=I[z];U.tileID.isChildOf(c)&&U.findMatches(f.symbolInstances,c,_)}else{const z=I[c.scaledTo(Number(T)).key];z&&z.findMatches(f.symbolInstances,c,_)}}for(let T=0;T<f.symbolInstances.length;T++){const I=f.symbolInstances.get(T);I.crossTileID||(I.crossTileID=b.generate(),_[I.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new on(c,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(c,f){for(const b of f.getCrossTileIDsLists())for(const _ of b)delete this.usedCrossTileIDs[c][_]}removeStaleBuckets(c){let f=!1;for(const b in this.indexes){const _=this.indexes[b];for(const T in _)c[_[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(b,_[T]),delete _[T],f=!0)}return f}}class bo{constructor(){this.layerIndexes={},this.crossTileIDs=new ws,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,f,b){let _=this.layerIndexes[c.id];_===void 0&&(_=this.layerIndexes[c.id]=new Jn);let T=!1;const I={};_.handleWrapJump(b);for(const z of f){const U=z.getBucket(c);U&&c.id===U.layerIds[0]&&(U.bucketInstanceId||(U.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(z.tileID,U,this.crossTileIDs)&&(T=!0),I[U.bucketInstanceId]=!0)}return _.removeStaleBuckets(I)&&(T=!0),T}pruneUnusedLayers(c){const f={};c.forEach(b=>{f[b]=!0});for(const b in this.layerIndexes)f[b]||delete this.layerIndexes[b]}}var Ya="void main() {fragColor=vec4(1.0);}";const Ar={prelude:gn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:gn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:gn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:gn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:gn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:gn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:gn(Ya,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:gn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:gn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:gn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:gn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:gn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:gn(Ya,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:gn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:gn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:gn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:gn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:gn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:gn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:gn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:gn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:gn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:gn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:gn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:gn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:gn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:gn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:gn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:gn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:gn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:gn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:gn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:gn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:gn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function gn(S,c){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,b=c.match(/in ([\w]+) ([\w]+)/g),_=S.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=T?T.concat(_):_,z={};return{fragmentSource:S=S.replace(f,(U,q,J,se,ne)=>(z[ne]=!0,q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
in ${J} ${se} ${ne};
#else
uniform ${J} ${se} u_${ne};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ne}
    ${J} ${se} ${ne} = u_${ne};
#endif
`)),vertexSource:c=c.replace(f,(U,q,J,se,ne)=>{const pe=se==="float"?"vec2":"vec4",ye=ne.match(/color/)?"color":pe;return z[ne]?q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
in ${J} ${pe} a_${ne};
out ${J} ${se} ${ne};
#else
uniform ${J} ${se} u_${ne};
#endif
`:ye==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = a_${ne};
#else
    ${J} ${se} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = unpack_mix_${ye}(a_${ne}, u_${ne}_t);
#else
    ${J} ${se} ${ne} = u_${ne};
#endif
`:q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
in ${J} ${pe} a_${ne};
#else
uniform ${J} ${se} u_${ne};
#endif
`:ye==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${J} ${se} ${ne} = a_${ne};
#else
    ${J} ${se} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${J} ${se} ${ne} = unpack_mix_${ye}(a_${ne}, u_${ne}_t);
#else
    ${J} ${se} ${ne} = u_${ne};
#endif
`}),staticAttributes:b,staticUniforms:I}}class lr{constructor(c,f,b){this.vertexBuffer=c,this.indexBuffer=f,this.segments=b}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ps=a.aD([{name:"a_pos",type:"Int16",components:2}]);const is="#define PROJECTION_MERCATOR",ns="mercator";class hn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ns}get shaderDefine(){return is}get shaderPreludeCode(){return Ar.projectionMercator}get vertexShaderPreludeCode(){return Ar.projectionMercator.vertexSource}get subdivisionGranularity(){return a.aE.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(c){}getMeshFromTileID(c,f,b,_,T){if(this._cachedMesh)return this._cachedMesh;const I=new a.aF;I.emplaceBack(0,0),I.emplaceBack(a.Z,0),I.emplaceBack(0,a.Z),I.emplaceBack(a.Z,a.Z);const z=c.createVertexBuffer(I,ps.members),U=a.aG.simpleSegment(0,0,4,2),q=new a.aH;q.emplaceBack(1,0,2),q.emplaceBack(1,2,3);const J=c.createIndexBuffer(q);return this._cachedMesh=new lr(z,J,U),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(c){}}function wo(S,c){const f=a.ae(c.lat,-85.051129,a.aJ);return new a.P(a.U(c.lng)*S,a.S(f)*S)}function ba(S,c){return new a.$(c.x/S,c.y/S).toLngLat()}function of(S){return S.cameraToCenterDistance*Math.min(.85*Math.tan(a.ad(90-S.pitch)),Math.tan(a.ad(89.25-S.pitch)))}function Lo(S,c){const f=S.canonical,b=c/a.aI(f.z),_=f.x+Math.pow(2,f.z)*S.wrap,T=a.at(new Float64Array(16));return a.L(T,T,[_*b,f.y*b,0]),a.M(T,T,[b/a.Z,b/a.Z,1]),T}function io(S,c,f,b,_){const T=a.$.fromLngLat(S,c),I=_*a.aK(1,S.lat),z=I*Math.cos(a.ad(f)),U=Math.sqrt(I*I-z*z),q=U*Math.sin(a.ad(-b)),J=U*Math.cos(a.ad(-b));return new a.$(T.x+q,T.y+J,T.z+z)}class Ir{constructor(c=0,f=0,b=0,_=0){if(isNaN(c)||c<0||isNaN(f)||f<0||isNaN(b)||b<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=f,this.left=b,this.right=_}interpolate(c,f,b){return f.top!=null&&c.top!=null&&(this.top=a.B.number(c.top,f.top,b)),f.bottom!=null&&c.bottom!=null&&(this.bottom=a.B.number(c.bottom,f.bottom,b)),f.left!=null&&c.left!=null&&(this.left=a.B.number(c.left,f.left,b)),f.right!=null&&c.right!=null&&(this.right=a.B.number(c.right,f.right,b)),this}getCenter(c,f){const b=a.ae((this.left+c-this.right)/2,0,c),_=a.ae((this.top+f-this.bottom)/2,0,f);return new a.P(b,_)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new Ir(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function uv(S,c){if(!S.renderWorldCopies||S.lngRange)return;const f=c.lng-S.center.lng;c.lng+=f>180?-360:f<-180?360:0}function Fo(S){return Math.max(0,Math.floor(S))}class Ko{constructor(c,f,b,_,T,I){this._callbacks=c,this._tileSize=512,this._renderWorldCopies=I===void 0||!!I,this._minZoom=f||0,this._maxZoom=b||22,this._minPitch=_??0,this._maxPitch=T??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new a.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Fo(this._zoom),this._scale=a.aI(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ir,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(c,f,b){this._latRange=c.latRange,this._lngRange=c.lngRange,this._width=c.width,this._height=c.height,this._center=c.center,this._elevation=c.elevation,this._minElevationForCurrentTile=c.minElevationForCurrentTile,this._zoom=c.zoom,this._tileZoom=Fo(this._zoom),this._scale=a.aI(this._zoom),this._bearingInRadians=c.bearingInRadians,this._fovInRadians=c.fovInRadians,this._pitchInRadians=c.pitchInRadians,this._rollInRadians=c.rollInRadians,this._unmodified=c.unmodified,this._edgeInsets=new Ir(c.padding.top,c.padding.bottom,c.padding.left,c.padding.right),this._minZoom=c.minZoom,this._maxZoom=c.maxZoom,this._minPitch=c.minPitch,this._maxPitch=c.maxPitch,this._renderWorldCopies=c.renderWorldCopies,this._cameraToCenterDistance=c.cameraToCenterDistance,this._nearZ=c.nearZ,this._farZ=c.farZ,this._autoCalculateNearFarZ=!b&&c.autoCalculateNearFarZ,f&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(c){this._minElevationForCurrentTile=c}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(c){this._minZoom!==c&&(this._minZoom=c,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(c){this._minPitch!==c&&(this._minPitch=c,this.setPitch(Math.max(this.pitch,c)))}get maxPitch(){return this._maxPitch}setMaxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.setPitch(Math.min(this.pitch,c)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(c){const f=a.aL(c,-180,180)*Math.PI/180;var b,_,T,I,z,U,q,J,se;this._bearingInRadians!==f&&(this._unmodified=!1,this._bearingInRadians=f,this._calcMatrices(),this._rotationMatrix=u(),b=this._rotationMatrix,T=-this._bearingInRadians,I=(_=this._rotationMatrix)[0],z=_[1],U=_[2],q=_[3],J=Math.sin(T),se=Math.cos(T),b[0]=I*se+U*J,b[1]=z*se+q*J,b[2]=I*-J+U*se,b[3]=z*-J+q*se)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(c){const f=a.ae(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==f&&(this._unmodified=!1,this._pitchInRadians=f,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(c){const f=c/180*Math.PI;this._rollInRadians!==f&&(this._unmodified=!1,this._rollInRadians=f,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return a.aM(this._fovInRadians)}setFov(c){c=a.ae(c,.1,150),this.fov!==c&&(this._unmodified=!1,this._fovInRadians=a.ad(c),this._calcMatrices())}get zoom(){return this._zoom}setZoom(c){const f=this.getConstrained(this._center,c).zoom;this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this._tileZoom=Math.max(0,Math.floor(f)),this._scale=a.aI(f),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(c){c!==this._elevation&&(this._elevation=c,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(c,f){this._autoCalculateNearFarZ=!1,this._nearZ=c,this._farZ=f,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,f,b){this._unmodified=!1,this._edgeInsets.interpolate(c,f,b),this._constrain(),this._calcMatrices()}resize(c,f,b=!0){this._width=c,this._height=f,b&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Re([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(c){c?(this._lngRange=[c.getWest(),c.getEast()],this._latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,a.aJ])}getConstrained(c,f){return this._callbacks.getConstrained(c,f)}getCameraQueryGeometry(c,f){if(f.length===1)return[f[0],c];{let b=c.x,_=c.y,T=c.x,I=c.y;for(const z of f)b=Math.min(b,z.x),_=Math.min(_,z.y),T=Math.max(T,z.x),I=Math.max(I,z.y);return[new a.P(b,_),new a.P(T,_),new a.P(T,I),new a.P(b,I),new a.P(b,_)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const c=this._unmodified,{center:f,zoom:b}=this.getConstrained(this.center,this.zoom);this.setCenter(f),this.setZoom(b),this._unmodified=c,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let c=a.at(new Float64Array(16));a.M(c,c,[this._width/2,-this._height/2,1]),a.L(c,c,[1,-1,0]),this._clipSpaceToPixelsMatrix=c,c=a.at(new Float64Array(16)),a.M(c,c,[1,-1,1]),a.L(c,c,[-1,-1,0]),a.M(c,c,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=c,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(c,f,b,_){const T=b!==void 0?b:this.bearing,I=_=_!==void 0?_:this.pitch,z=a.$.fromLngLat(c,f),U=-Math.cos(a.ad(I)),q=Math.sin(a.ad(I)),J=q*Math.sin(a.ad(T)),se=-q*Math.cos(a.ad(T));let ne=this.elevation;const pe=f-ne;let ye;U*pe>=0||Math.abs(U)<.1?(ye=1e4,ne=f+ye*U):ye=-pe/U;let De,Ee,Le=a.aN(1,z.y),ze=0;do{if(ze+=1,ze>10)break;Ee=ye/Le,De=new a.$(z.x+J*Ee,z.y+se*Ee),Le=1/De.meterInMercatorCoordinateUnits()}while(Math.abs(ye-Ee*Le)>1e-12);return{center:De.toLngLat(),elevation:ne,zoom:a.ab(this.height/2/Math.tan(this.fovInRadians/2)/Ee/this.tileSize)}}recalculateZoomAndCenter(c){if(this.elevation-c==0)return;const f=a.aK(1,this.center.lat)*this.worldSize,b=this.cameraToCenterDistance/f,_=a.$.fromLngLat(this.center,this.elevation),T=io(this.center,this.elevation,this.pitch,this.bearing,b);this._elevation=c;const I=this.calculateCenterFromCameraLngLatAlt(T.toLngLat(),a.aN(T.z,_.y),this.bearing,this.pitch);this._elevation=I.elevation,this._center=I.center,this.setZoom(I.zoom)}getCameraPoint(){const c=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(c*Math.sin(this.rollInRadians),c*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const c=a.aK(1,this.center.lat)*this.worldSize;return io(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/c).toLngLat()}getMercatorTileCoordinates(c){if(!c)return[0,0,1,1];const f=c.canonical.z>=0?1<<c.canonical.z:Math.pow(2,c.canonical.z);return[c.canonical.x/f,c.canonical.y/f,1/f/a.Z,1/f/a.Z]}}class Ds{constructor(c,f){this.min=c,this.max=f,this.center=a.aO([],a.aP([],this.min,this.max),.5)}quadrant(c){const f=[c%2==0,c<2],b=a.aQ(this.min),_=a.aQ(this.max);for(let T=0;T<f.length;T++)b[T]=f[T]?this.min[T]:this.center[T],_[T]=f[T]?this.center[T]:this.max[T];return _[2]=this.max[2],new Ds(b,_)}distanceX(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]}distanceY(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]}intersectsFrustum(c){let f=!0;for(let b=0;b<c.planes.length;b++){const _=this.intersectsPlane(c.planes[b]);if(_===0)return 0;_===1&&(f=!1)}return f?2:c.aabb.min[0]>this.max[0]||c.aabb.min[1]>this.max[1]||c.aabb.min[2]>this.max[2]||c.aabb.max[0]<this.min[0]||c.aabb.max[1]<this.min[1]||c.aabb.max[2]<this.min[2]?0:1}intersectsPlane(c){let f=c[3],b=c[3];for(let _=0;_<3;_++)c[_]>0?(f+=c[_]*this.min[_],b+=c[_]*this.max[_]):(b+=c[_]*this.min[_],f+=c[_]*this.max[_]);return f>=0?2:b<0?0:1}}class lS{distanceToTile2d(c,f,b,_){const T=_.distanceX([c,f]),I=_.distanceY([c,f]);return Math.hypot(T,I)}getWrap(c,f,b){return b}getTileAABB(c,f,b,_){var T,I;let z=b,U=b;if(_.terrain){const J=new a.Y(c.z,f,c.z,c.x,c.y),se=_.terrain.getMinMaxElevation(J);z=(T=se.minElevation)!==null&&T!==void 0?T:b,U=(I=se.maxElevation)!==null&&I!==void 0?I:b}const q=1<<c.z;return new Ds([f+c.x/q,c.y/q,z],[f+(c.x+1)/q,(c.y+1)/q,U])}allowVariableZoom(c,f){const b=c.fov*(Math.abs(Math.cos(c.rollInRadians))*c.height+Math.abs(Math.sin(c.rollInRadians))*c.width)/c.height,_=a.ae(78.5-b/2,0,60);return!!f.terrain||c.pitch>_}allowWorldCopies(){return!0}recalculateCache(){}}class Du{constructor(c,f,b){this.points=c,this.planes=f,this.aabb=b}static fromInvProjectionMatrix(c,f=1,b=0){const _=Math.pow(2,b),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(q=>{const J=1/(q=a.ap([],q,c))[3]/f*_;return a.aR(q,q,[J,J,1/q[3],J])}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(q=>{const J=a.aS([],T[q[0]],T[q[1]]),se=a.aS([],T[q[2]],T[q[1]]),ne=a.aT([],a.aU([],J,se)),pe=-a.aV(ne,T[q[1]]);return ne.concat(pe)}),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],U=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const q of T)for(let J=0;J<3;J++)z[J]=Math.min(z[J],q[J]),U[J]=Math.max(U[J],q[J]);return new Du(T,I,new Ds(z,U))}}class kr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(c){this._helper.setMinZoom(c)}setMaxZoom(c){this._helper.setMaxZoom(c)}setMinPitch(c){this._helper.setMinPitch(c)}setMaxPitch(c){this._helper.setMaxPitch(c)}setRenderWorldCopies(c){this._helper.setRenderWorldCopies(c)}setBearing(c){this._helper.setBearing(c)}setPitch(c){this._helper.setPitch(c)}setRoll(c){this._helper.setRoll(c)}setFov(c){this._helper.setFov(c)}setZoom(c){this._helper.setZoom(c)}setCenter(c){this._helper.setCenter(c)}setElevation(c){this._helper.setElevation(c)}setMinElevationForCurrentTile(c){this._helper.setMinElevationForCurrentTile(c)}setPadding(c){this._helper.setPadding(c)}interpolatePadding(c,f,b){return this._helper.interpolatePadding(c,f,b)}isPaddingEqual(c){return this._helper.isPaddingEqual(c)}resize(c,f,b=!0){this._helper.resize(c,f,b)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(c){this._helper.setMaxBounds(c)}overrideNearFarZ(c,f){this._helper.overrideNearFarZ(c,f)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(c){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),c)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(c,f){}constructor(c,f,b,_,T){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ko({calcMatrices:()=>{this._calcMatrices()},getConstrained:(I,z)=>this.getConstrained(I,z)},c,f,b,_,T),this._coveringTilesDetailsProvider=new lS}clone(){const c=new kr;return c.apply(this),c}apply(c,f,b){this._helper.apply(c,f,b)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(c){const f=[new a.aW(0,c)];if(this._helper._renderWorldCopies){const b=this.screenPointToMercatorCoordinate(new a.P(0,0)),_=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,0)),T=this.screenPointToMercatorCoordinate(new a.P(this._helper._width,this._helper._height)),I=this.screenPointToMercatorCoordinate(new a.P(0,this._helper._height)),z=Math.floor(Math.min(b.x,_.x,T.x,I.x)),U=Math.floor(Math.max(b.x,_.x,T.x,I.x)),q=1;for(let J=z-q;J<=U+q;J++)J!==0&&f.push(new a.aW(J,c))}return f}getCameraFrustum(){return Du.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(c){const f=this.screenPointToLocation(this.centerPoint,c),b=c?c.getElevationForLngLatZoom(f,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(b)}setLocationAtPoint(c,f){const b=a.aK(this.elevation,this.center.lat),_=this.screenPointToMercatorCoordinateAtZ(f,b),T=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,b),I=a.$.fromLngLat(c),z=new a.$(I.x-(_.x-T.x),I.y-(_.y-T.y));this.setCenter(z?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(c,f){return f?this.coordinatePoint(a.$.fromLngLat(c),f.getElevationForLngLatZoom(c,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(a.$.fromLngLat(c))}screenPointToLocation(c,f){var b;return(b=this.screenPointToMercatorCoordinate(c,f))===null||b===void 0?void 0:b.toLngLat()}screenPointToMercatorCoordinate(c,f){if(f){const b=f.pointCoordinate(c);if(b!=null)return b}return this.screenPointToMercatorCoordinateAtZ(c)}screenPointToMercatorCoordinateAtZ(c,f){const b=f||0,_=[c.x,c.y,0,1],T=[c.x,c.y,1,1];a.ap(_,_,this._pixelMatrixInverse),a.ap(T,T,this._pixelMatrixInverse);const I=_[3],z=T[3],U=_[1]/I,q=T[1]/z,J=_[2]/I,se=T[2]/z,ne=J===se?0:(b-J)/(se-J);return new a.$(a.B.number(_[0]/I,T[0]/z,ne)/this.worldSize,a.B.number(U,q,ne)/this.worldSize,b)}coordinatePoint(c,f=0,b=this._pixelMatrix){const _=[c.x*this.worldSize,c.y*this.worldSize,f,1];return a.ap(_,_,b),new a.P(_[0]/_[3],_[1]/_[3])}getBounds(){const c=Math.max(0,this._helper._height/2-of(this));return new Re().extend(this.screenPointToLocation(new a.P(0,c))).extend(this.screenPointToLocation(new a.P(this._helper._width,c))).extend(this.screenPointToLocation(new a.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new a.P(0,this._helper._height)))}isPointOnMapSurface(c,f){return f?f.pointCoordinate(c)!=null:c.y>this.height/2-of(this)}calculatePosMatrix(c,f=!1,b){var _;const T=(_=c.key)!==null&&_!==void 0?_:a.aX(c.wrap,c.canonical.z,c.canonical.z,c.canonical.x,c.canonical.y),I=f?this._alignedPosMatrixCache:this._posMatrixCache;if(I.has(T)){const q=I.get(T);return b?q.f32:q.f64}const z=Lo(c,this.worldSize);a.N(z,f?this._alignedProjMatrix:this._viewProjMatrix,z);const U={f64:z,f32:new Float32Array(z)};return I.set(T,U),b?U.f32:U.f64}calculateFogMatrix(c){const f=c.key,b=this._fogMatrixCacheF32;if(b.has(f))return b.get(f);const _=Lo(c,this.worldSize);return a.N(_,this._fogMatrix,_),b.set(f,new Float32Array(_)),b.get(f)}getConstrained(c,f){f=a.ae(+f,this.minZoom,this.maxZoom);const b={center:new a.Q(c.lng,c.lat),zoom:f};let _=this._helper._lngRange;this._helper._renderWorldCopies||_!==null||(_=[-179.9999999999,180-1e-10]);const T=this.tileSize*a.aI(b.zoom);let I=0,z=T,U=0,q=T,J=0,se=0;const{x:ne,y:pe}=this.size;if(this._helper._latRange){const We=this._helper._latRange;I=a.S(We[1])*T,z=a.S(We[0])*T,z-I<pe&&(J=pe/(z-I))}_&&(U=a.aL(a.U(_[0])*T,0,T),q=a.aL(a.U(_[1])*T,0,T),q<U&&(q+=T),q-U<ne&&(se=ne/(q-U)));const{x:ye,y:De}=wo(T,c);let Ee,Le;const ze=Math.max(se||0,J||0);if(ze){const We=new a.P(se?(q+U)/2:ye,J?(z+I)/2:De);return b.center=ba(T,We).wrap(),b.zoom+=a.ab(ze),b}if(this._helper._latRange){const We=pe/2;De-We<I&&(Le=I+We),De+We>z&&(Le=z-We)}if(_){const We=(U+q)/2;let Qe=ye;this._helper._renderWorldCopies&&(Qe=a.aL(ye,We-T/2,We+T/2));const Ke=ne/2;Qe-Ke<U&&(Ee=U+Ke),Qe+Ke>q&&(Ee=q-Ke)}if(Ee!==void 0||Le!==void 0){const We=new a.P(Ee??ye,Le??De);b.center=ba(T,We).wrap()}return b}calculateCenterFromCameraLngLatAlt(c,f,b,_){return this._helper.calculateCenterFromCameraLngLatAlt(c,f,b,_)}_calculateNearFarZIfNeeded(c,f,b){if(!this._helper.autoCalculateNearFarZ)return;const _=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),T=c-_*this._helper._pixelPerMeter/Math.cos(f),I=_<0?T:c,z=Math.PI/2+this.pitchInRadians,U=a.ad(this.fov)*(Math.abs(Math.cos(a.ad(this.roll)))*this.height+Math.abs(Math.sin(a.ad(this.roll)))*this.width)/this.height*(.5+b.y/this.height),q=Math.sin(U)*I/Math.sin(a.ae(Math.PI-z-U,.01,Math.PI-.01)),J=of(this),se=Math.atan(J/this._helper.cameraToCenterDistance),ne=a.ad(.75),pe=se>ne?2*se*(.5+b.y/(2*J)):ne,ye=Math.sin(pe)*I/Math.sin(a.ae(Math.PI-z-pe,.01,Math.PI-.01)),De=Math.min(q,ye);this._helper._farZ=1.01*(Math.cos(Math.PI/2-f)*De+I),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const c=this.centerOffset,f=wo(this.worldSize,this.center),b=f.x,_=f.y;this._helper._pixelPerMeter=a.aK(1,this.center.lat)*this.worldSize;const T=a.ad(Math.min(this.pitch,89.25)),I=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(T));let z;this._calculateNearFarZIfNeeded(I,T,c),z=new Float64Array(16),a.aY(z,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),a.aj(this._invProjMatrix,z),z[8]=2*-c.x/this._helper._width,z[9]=2*c.y/this._helper._height,this._projectionMatrix=a.aZ(z),a.M(z,z,[1,-1,1]),a.L(z,z,[0,0,-this._helper.cameraToCenterDistance]),a.a_(z,z,-this.rollInRadians),a.a$(z,z,this.pitchInRadians),a.a_(z,z,-this.bearingInRadians),a.L(z,z,[-b,-_,0]),this._mercatorMatrix=a.M([],z,[this.worldSize,this.worldSize,this.worldSize]),a.M(z,z,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=a.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,z),a.L(z,z,[0,0,-this.elevation]),this._viewProjMatrix=z,this._invViewProjMatrix=a.aj([],z);const U=[0,0,-1,1];a.ap(U,U,this._invViewProjMatrix),this._cameraPosition=[U[0]/U[3],U[1]/U[3],U[2]/U[3]],this._fogMatrix=new Float64Array(16),a.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,I,this._helper._farZ),this._fogMatrix[8]=2*-c.x/this.width,this._fogMatrix[9]=2*c.y/this.height,a.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),a.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),a.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),a.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),a.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),a.L(this._fogMatrix,this._fogMatrix,[-b,-_,0]),a.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),a.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=a.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,z);const q=this._helper._width%2/2,J=this._helper._height%2/2,se=Math.cos(this.bearingInRadians),ne=Math.sin(-this.bearingInRadians),pe=b-Math.round(b)+se*q+ne*J,ye=_-Math.round(_)+se*J+ne*q,De=new Float64Array(z);if(a.L(De,De,[pe>.5?pe-1:pe,ye>.5?ye-1:ye,0]),this._alignedProjMatrix=De,z=a.aj(new Float64Array(16),this._pixelMatrix),!z)throw new Error("failed to invert matrix");this._pixelMatrixInverse=z,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const c=this.screenPointToMercatorCoordinate(new a.P(0,0)),f=[c.x*this.worldSize,c.y*this.worldSize,0,1];return a.ap(f,f,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const c=a.aK(1,this.center.lat)*this.worldSize;return io(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/c).toLngLat()}lngLatToCameraDepth(c,f){const b=a.$.fromLngLat(c),_=[b.x*this.worldSize,b.y*this.worldSize,f,1];return a.ap(_,_,this._viewProjMatrix),_[2]/_[3]}getProjectionData(c){const{overscaledTileID:f,aligned:b,applyTerrainMatrix:_}=c,T=this._helper.getMercatorTileCoordinates(f),I=f?this.calculatePosMatrix(f,b,!0):null;let z;return z=f&&f.terrainRttPosMatrix32f&&_?f.terrainRttPosMatrix32f:I||a.b0(),{mainMatrix:z,tileMercatorCoords:T,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:z}}isLocationOccluded(c){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(c,f,b){return 1}transformLightDirection(c){return a.aQ(c)}getRayDirectionFromPixel(c){throw new Error("Not implemented.")}projectTileCoordinates(c,f,b,_){const T=this.calculatePosMatrix(b);let I;_?(I=[c,f,_(c,f),1],a.ap(I,I,T)):(I=[c,f,0,1],fs(I,I,T));const z=I[3];return{point:new a.P(I[0]/z,I[1]/z),signedDistanceFromCamera:z,isOccluded:!1}}populateCache(c){for(const f of c)this.calculatePosMatrix(f)}getMatrixForModel(c,f){const b=a.$.fromLngLat(c,f),_=b.meterInMercatorCoordinateUnits(),T=a.b1();return a.L(T,T,[b.x,b.y,b.z]),a.a_(T,T,Math.PI),a.a$(T,T,Math.PI/2),a.M(T,T,[-_,_,_]),T}getProjectionDataForCustomLayer(c=!0){const f=new a.Y(0,0,0,0,0),b=this.getProjectionData({overscaledTileID:f,applyGlobeMatrix:c}),_=Lo(f,this.worldSize);a.N(_,this._viewProjMatrix,_),b.tileMercatorCoords=[0,0,1,1];const T=[a.Z,a.Z,this.worldSize/this._helper.pixelsPerMeter],I=a.b2();return a.M(I,_,T),b.fallbackMatrix=I,b.mainMatrix=I,b}getFastPathSimpleProjectionMatrix(c){return this.calculatePosMatrix(c)}}function af(){a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Lu(S){if(S.useSlerp)if(S.k<1){const c=a.b3(S.startEulerAngles.roll,S.startEulerAngles.pitch,S.startEulerAngles.bearing),f=a.b3(S.endEulerAngles.roll,S.endEulerAngles.pitch,S.endEulerAngles.bearing),b=new Float64Array(4);a.b4(b,c,f,S.k);const _=a.b5(b);S.tr.setRoll(_.roll),S.tr.setPitch(_.pitch),S.tr.setBearing(_.bearing)}else S.tr.setRoll(S.endEulerAngles.roll),S.tr.setPitch(S.endEulerAngles.pitch),S.tr.setBearing(S.endEulerAngles.bearing);else S.tr.setRoll(a.B.number(S.startEulerAngles.roll,S.endEulerAngles.roll,S.k)),S.tr.setPitch(a.B.number(S.startEulerAngles.pitch,S.endEulerAngles.pitch,S.k)),S.tr.setBearing(a.B.number(S.startEulerAngles.bearing,S.endEulerAngles.bearing,S.k))}function qp(S,c,f,b,_){const T=_.padding,I=wo(_.worldSize,f.getNorthWest()),z=wo(_.worldSize,f.getNorthEast()),U=wo(_.worldSize,f.getSouthEast()),q=wo(_.worldSize,f.getSouthWest()),J=a.ad(-b),se=I.rotate(J),ne=z.rotate(J),pe=U.rotate(J),ye=q.rotate(J),De=new a.P(Math.max(se.x,ne.x,ye.x,pe.x),Math.max(se.y,ne.y,ye.y,pe.y)),Ee=new a.P(Math.min(se.x,ne.x,ye.x,pe.x),Math.min(se.y,ne.y,ye.y,pe.y)),Le=De.sub(Ee),ze=(_.width-(T.left+T.right+c.left+c.right))/Le.x,We=(_.height-(T.top+T.bottom+c.top+c.bottom))/Le.y;if(We<0||ze<0)return void af();const Qe=Math.min(a.ab(_.scale*Math.min(ze,We)),S.maxZoom),Ke=a.P.convert(S.offset),at=new a.P((c.left-c.right)/2,(c.top-c.bottom)/2).rotate(a.ad(b)),et=Ke.add(at).mult(_.scale/a.aI(Qe));return{center:ba(_.worldSize,I.add(U).div(2).sub(et)),zoom:Qe,bearing:b}}class Yo{get useGlobeControls(){return!1}handlePanInertia(c,f){return{easingOffset:c,easingCenter:f.center}}handleMapControlsRollPitchBearingZoom(c,f){c.bearingDelta&&f.setBearing(f.bearing+c.bearingDelta),c.pitchDelta&&f.setPitch(f.pitch+c.pitchDelta),c.rollDelta&&f.setRoll(f.roll+c.rollDelta),c.zoomDelta&&f.setZoom(f.zoom+c.zoomDelta)}handleMapControlsPan(c,f,b){c.around.distSqr(f.centerPoint)<.01||f.setLocationAtPoint(b,c.around)}cameraForBoxAndBearing(c,f,b,_,T){return qp(c,f,b,_,T)}handleJumpToCenterZoom(c,f){c.zoom!==(f.zoom!==void 0?+f.zoom:c.zoom)&&c.setZoom(+f.zoom),f.center!==void 0&&c.setCenter(a.Q.convert(f.center))}handleEaseTo(c,f){const b=c.zoom,_=c.padding,T={roll:c.roll,pitch:c.pitch,bearing:c.bearing},I={roll:f.roll===void 0?c.roll:f.roll,pitch:f.pitch===void 0?c.pitch:f.pitch,bearing:f.bearing===void 0?c.bearing:f.bearing},z=f.zoom!==void 0,U=!c.isPaddingEqual(f.padding);let q=!1;const J=z?+f.zoom:c.zoom;let se=c.centerPoint.add(f.offsetAsPoint);const ne=c.screenPointToLocation(se),{center:pe,zoom:ye}=c.getConstrained(a.Q.convert(f.center||ne),J??b);uv(c,pe);const De=wo(c.worldSize,ne),Ee=wo(c.worldSize,pe).sub(De),Le=a.aI(ye-b);return q=ye!==b,{easeFunc:ze=>{if(q&&c.setZoom(a.B.number(b,ye,ze)),a.b6(T,I)||Lu({startEulerAngles:T,endEulerAngles:I,tr:c,k:ze,useSlerp:T.roll!=I.roll}),U&&(c.interpolatePadding(_,f.padding,ze),se=c.centerPoint.add(f.offsetAsPoint)),f.around)c.setLocationAtPoint(f.around,f.aroundPoint);else{const We=a.aI(c.zoom-b),Qe=ye>b?Math.min(2,Le):Math.max(.5,Le),Ke=Math.pow(Qe,1-ze),at=ba(c.worldSize,De.add(Ee.mult(ze*Ke)).mult(We));c.setLocationAtPoint(c.renderWorldCopies?at.wrap():at,se)}},isZooming:q,elevationCenter:pe}}handleFlyTo(c,f){const b=f.zoom!==void 0,_=c.zoom,T=c.getConstrained(a.Q.convert(f.center||f.locationAtOffset),b?+f.zoom:_),I=T.center,z=T.zoom;uv(c,I);const U=wo(c.worldSize,f.locationAtOffset),q=wo(c.worldSize,I).sub(U),J=q.mag(),se=a.aI(z-_);let ne;if(f.minZoom!==void 0){const pe=Math.min(+f.minZoom,_,z),ye=c.getConstrained(I,pe).zoom;ne=a.aI(ye-_)}return{easeFunc:(pe,ye,De,Ee)=>{c.setZoom(pe===1?z:_+a.ab(ye));const Le=pe===1?I:ba(c.worldSize,U.add(q.mult(De)).mult(ye));c.setLocationAtPoint(c.renderWorldCopies?Le.wrap():Le,Ee)},scaleOfZoom:se,targetCenter:I,scaleOfMinZoom:ne,pixelPathLength:J}}}class Mr{constructor(c,f,b){this.blendFunction=c,this.blendColor=f,this.mask=b}}Mr.Replace=[1,0],Mr.disabled=new Mr(Mr.Replace,a.b7.transparent,[!1,!1,!1,!1]),Mr.unblended=new Mr(Mr.Replace,a.b7.transparent,[!0,!0,!0,!0]),Mr.alphaBlended=new Mr([1,771],a.b7.transparent,[!0,!0,!0,!0]);const lc=2305;class er{constructor(c,f,b){this.enable=c,this.mode=f,this.frontFace=b}}er.disabled=new er(!1,1029,lc),er.backCCW=new er(!0,1029,lc),er.frontCCW=new er(!0,1028,lc);class xn{constructor(c,f,b){this.func=c,this.mask=f,this.range=b}}xn.ReadOnly=!1,xn.ReadWrite=!0,xn.disabled=new xn(519,xn.ReadOnly,[0,1]);const lf=7680;class Vn{constructor(c,f,b,_,T,I){this.test=c,this.ref=f,this.mask=b,this.fail=_,this.depthFail=T,this.pass=I}}Vn.disabled=new Vn({func:519,mask:0},0,0,lf,lf,lf);const cf=new WeakMap;function Tl(S){var c;if(cf.has(S))return cf.get(S);{const f=(c=S.getParameter(S.VERSION))===null||c===void 0?void 0:c.startsWith("WebGL 2.0");return cf.set(S,f),f}}class jp{get awaitingQuery(){return!!this._readbackQueue}constructor(c){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=c;const f=c.context,b=f.gl;this._texFormat=b.RGBA,this._texType=b.UNSIGNED_BYTE;const _=new a.aF;_.emplaceBack(-1,-1),_.emplaceBack(2,-1),_.emplaceBack(-1,2);const T=new a.aH;T.emplaceBack(0,1,2),this._fullscreenTriangle=new lr(f.createVertexBuffer(_,ps.members),f.createIndexBuffer(T),a.aG.simpleSegment(0,0,_.length,T.length)),this._resultBuffer=new Uint8Array(4),f.activeTexture.set(b.TEXTURE1);const I=b.createTexture();b.bindTexture(b.TEXTURE_2D,I),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texImage2D(b.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=f.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(I),Tl(b)&&(this._pbo=b.createBuffer(),b.bindBuffer(b.PIXEL_PACK_BUFFER,this._pbo),b.bufferData(b.PIXEL_PACK_BUFFER,4,b.STREAM_READ),b.bindBuffer(b.PIXEL_PACK_BUFFER,null))}destroy(){const c=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),c.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(c,f){const b=this._updateCount;return this._readbackQueue?b>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():b>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(c,f),this._updateCount++,this._measuredError}_bindFramebuffer(){const c=this._cachedRenderContext.context,f=c.gl;c.activeTexture.set(f.TEXTURE1),f.bindTexture(f.TEXTURE_2D,this._fbo.colorAttachment.get()),c.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(c,f){const b=this._cachedRenderContext.context,_=b.gl;if(this._bindFramebuffer(),b.viewport.set([0,0,this._texWidth,this._texHeight]),b.clear({color:a.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(b,_.TRIANGLES,xn.disabled,Vn.disabled,Mr.unblended,er.disabled,((T,I)=>({u_input:T,u_output_expected:I}))(c,f),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Tl(_)){_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.readBuffer(_.COLOR_ATTACHMENT0),_.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),_.bindBuffer(_.PIXEL_PACK_BUFFER,null);const T=_.fenceSync(_.SYNC_GPU_COMMANDS_COMPLETE,0);_.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:T}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const c=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Tl(c)){const f=c.clientWaitSync(this._readbackQueue.sync,0,0);if(f===c.WAIT_FAILED)return a.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(f===c.TIMEOUT_EXPIRED)return;c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),c.bindBuffer(c.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),c.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=jp._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(c){let f=0;return f+=c[0]/256,f+=c[1]/65536,f+=c[2]/16777216,c[3]<127&&(f=-f),f/128}}const Qp=a.Z/128;function hv(S,c){const f=S.granularity!==void 0?Math.max(S.granularity,1):1,b=f+(S.generateBorders?2:0),_=f+(S.extendToNorthPole||S.generateBorders?1:0)+(S.extendToSouthPole||S.generateBorders?1:0),T=b+1,I=_+1,z=S.generateBorders?-1:0,U=S.generateBorders||S.extendToNorthPole?-1:0,q=f+(S.generateBorders?1:0),J=f+(S.generateBorders||S.extendToSouthPole?1:0),se=T*I,ne=b*_*6,pe=T*I>65536;if(pe&&c==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ye=pe||c==="32bit",De=new Int16Array(2*se);let Ee=0;for(let We=U;We<=J;We++)for(let Qe=z;Qe<=q;Qe++){let Ke=Qe/f*a.Z;Qe===-1&&(Ke=-64),Qe===f+1&&(Ke=a.Z+Qp);let at=We/f*a.Z;We===-1&&(at=S.extendToNorthPole?a.b9:-64),We===f+1&&(at=S.extendToSouthPole?a.ba:a.Z+Qp),De[Ee++]=Ke,De[Ee++]=at}const Le=ye?new Uint32Array(ne):new Uint16Array(ne);let ze=0;for(let We=0;We<_;We++)for(let Qe=0;Qe<b;Qe++){const Ke=Qe+1+We*T,at=Qe+(We+1)*T,et=Qe+1+(We+1)*T;Le[ze++]=Qe+We*T,Le[ze++]=at,Le[ze++]=Ke,Le[ze++]=Ke,Le[ze++]=at,Le[ze++]=et}return{vertices:De.buffer.slice(0),indices:Le.buffer.slice(0),uses32bitIndices:ye}}const Zp=new a.aE({fill:new a.bb(128,2),line:new a.bb(512,0),tile:new a.bb(128,32),stencil:new a.bb(128,1),circle:3});class Xp{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ar.projectionGlobe}get vertexShaderPreludeCode(){return Ar.projectionMercator.vertexSource}get subdivisionGranularity(){return Zp}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(c){this._errorMeasurement||(this._errorMeasurement=new jp(c));const f=a.S(this._errorQueryLatitudeDegrees),b=2*Math.atan(Math.exp(Math.PI-f*Math.PI*2))-.5*Math.PI,_=this._errorMeasurement.updateErrorLoop(f,b),T=v.now();_!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=_,this._errorMeasurementLastChangeTime=T);const I=Math.min(Math.max((T-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=a.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,a.bd(I))}_getMeshKey(c){return`${c.granularity.toString(36)}_${c.generateBorders?"b":""}${c.extendToNorthPole?"n":""}${c.extendToSouthPole?"s":""}`}getMeshFromTileID(c,f,b,_,T){const I=(T==="stencil"?Zp.stencil:Zp.tile).getGranularityForZoomLevel(f.z);return this._getMesh(c,{granularity:I,generateBorders:b,extendToNorthPole:f.y===0&&_,extendToSouthPole:f.y===(1<<f.z)-1&&_})}_getMesh(c,f){const b=this._getMeshKey(f);if(b in this._tileMeshCache)return this._tileMeshCache[b];const _=function(T,I){const z=hv(I,"16bit"),U=a.aF.deserialize({arrayBuffer:z.vertices,length:z.vertices.byteLength/2/2}),q=a.aH.deserialize({arrayBuffer:z.indices,length:z.indices.byteLength/2/3});return new lr(T.createVertexBuffer(U,ps.members),T.createIndexBuffer(q),a.aG.simpleSegment(0,0,U.length,q.length))}(c,f);return this._tileMeshCache[b]=_,_}recalculate(c){}hasTransition(){const c=v.now();let f=!1;return f=f||(c-this._errorMeasurementLastChangeTime)/1e3<.7,f=f||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,f}setErrorQueryLatitudeDegrees(c){this._errorQueryLatitudeDegrees=c}}const dv=new a.r({type:new a.D(a.v.projection.type)});class uf extends a.E{constructor(c){super(),this._transitionable=new a.T(dv),this.setProjection(c),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.C(0)),this._mercatorProjection=new hn,this._verticalPerspectiveProjection=new Xp}get transitionState(){const c=this.properties.get("type");if(typeof c=="string"&&c==="mercator")return 0;if(typeof c=="string"&&c==="vertical-perspective")return 1;if(c instanceof a.be){if(c.from==="vertical-perspective"&&c.to==="mercator")return 1-c.transition;if(c.from==="mercator"&&c.to==="vertical-perspective")return c.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(c){this._mercatorProjection.updateGPUdependent(c),this._verticalPerspectiveProjection.updateGPUdependent(c)}getMeshFromTileID(c,f,b,_,T){return this.currentProjection.getMeshFromTileID(c,f,b,_,T)}setProjection(c){this._transitionable.setValue("type",c?.type||"mercator")}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}setErrorQueryLatitudeDegrees(c){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(c),this._mercatorProjection.setErrorQueryLatitudeDegrees(c)}}function cS(S){const c=fv(S.worldSize,S.center.lat);return 2*Math.PI*c}function Hh(S,c,f,b,_){const T=1/(1<<_),I=c/a.Z*T+b*T,z=a.bg((S/a.Z*T+f*T)*Math.PI*2+Math.PI,2*Math.PI),U=2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI,q=Math.cos(U),J=new Float64Array(3);return J[0]=Math.sin(z)*q,J[1]=Math.sin(U),J[2]=Math.cos(z)*q,J}function no(S){return function(c,f){const b=Math.cos(f),_=new Float64Array(3);return _[0]=Math.sin(c)*b,_[1]=Math.sin(f),_[2]=Math.cos(c)*b,_}(S.lng*Math.PI/180,S.lat*Math.PI/180)}function fv(S,c){return S/(2*Math.PI)/Math.cos(c*Math.PI/180)}function uS(S){const c=Math.asin(S[1])/Math.PI*180,f=Math.sqrt(S[0]*S[0]+S[2]*S[2]);if(f>1e-6){const b=S[0]/f,_=Math.acos(S[2]/f),T=(b>0?_:-_)/Math.PI*180;return new a.Q(a.aL(T,-180,180),c)}return new a.Q(0,c)}function _o(S){return Math.cos(S*Math.PI/180)}function _s(S,c){const f=_o(S),b=_o(c);return a.ab(b/f)}function Rl(S,c){const f=S.rotate(c.bearingInRadians),b=c.zoom+_s(c.center.lat,0),_=a.bc(1/_o(c.center.lat),1/_o(Math.min(Math.abs(c.center.lat),60)),a.bf(b,7,3,0,1)),T=360/cS({worldSize:c.worldSize,center:{lat:c.center.lat}});return new a.Q(c.center.lng-f.x*T*_,a.ae(c.center.lat+f.y*T,-85.051129,a.aJ))}function hf(S){const c=.5*S,f=Math.sin(c),b=Math.cos(c);return Math.log(f+b)-Math.log(b-f)}function _x(S,c,f,b){const _=S.lat+f*b;if(Math.abs(f)>1){const T=(Math.sign(S.lat+f)!==Math.sign(S.lat)?-Math.abs(S.lat):Math.abs(S.lat))*Math.PI/180,I=Math.abs(S.lat+f)*Math.PI/180,z=hf(T+b*(I-T)),U=hf(T),q=hf(I);return new a.Q(S.lng+c*((z-U)/(q-U)),_)}return new a.Q(S.lng+c*b,_)}class hS{constructor(c){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=c}recalculateCache(){if(!this._hadAnyChanges)return;const c=this._cachePrevious;this._cachePrevious=this._cache,this._cache=c,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(c,f,b,_){const T=`${c.z}_${c.x}_${c.y}`,I=this._cache.get(T);if(I)return I;const z=this._cachePrevious.get(T);if(z)return this._cache.set(T,z),z;const U=this._aabbFactory(c,f,b,_);return this._cache.set(T,U),this._hadAnyChanges=!0,U}}function eu(S,c,f){const b=S-c;return b<0?-b:Math.max(0,b-f)}function Cx(S,c,f,b,_){const T=S-f;let I;return I=T<0?Math.min(-T,1+T-_):T>1?Math.min(Math.max(T-_,0),1-T):0,Math.max(I,eu(c,b,_))}class WL{constructor(){this._aabbCache=new hS(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(c,f,b,_){const T=1<<b.z,I=1/T,z=b.x/T,U=b.y/T;let q=2;return q=Math.min(q,Cx(c,f,z,U,I)),q=Math.min(q,Cx(c,f,z+.5,-U-I,I)),q=Math.min(q,Cx(c,f,z+.5,2-U-I,I)),q}getWrap(c,f,b){const _=1<<f.z,T=1/_,I=f.x/_,z=eu(c.x,I,T),U=eu(c.x,I-1,T),q=eu(c.x,I+1,T),J=Math.min(z,U,q);return J===q?1:J===U?-1:0}allowVariableZoom(c,f){return nt(c,f)>4}allowWorldCopies(){return!1}getTileAABB(c,f,b,_){return this._aabbCache.getTileAABB(c,f,b,_)}_computeTileAABB(c,f,b,_){if(c.z<=0)return new Ds([-1,-1,-1],[1,1,1]);if(c.z===1)return new Ds([c.x===0?-1:0,c.y===0?0:-1,-1],[c.x===0?0:1,c.y===0?1:0,1]);{const T=[Hh(0,0,c.x,c.y,c.z),Hh(a.Z,0,c.x,c.y,c.z),Hh(a.Z,a.Z,c.x,c.y,c.z),Hh(0,a.Z,c.x,c.y,c.z)],I=[1,1,1],z=[-1,-1,-1];for(const U of T)for(let q=0;q<3;q++)I[q]=Math.min(I[q],U[q]),z[q]=Math.max(z[q],U[q]);if(c.y===0||c.y===(1<<c.z)-1){const U=[0,c.y===0?1:-1,0];for(let q=0;q<3;q++)I[q]=Math.min(I[q],U[q]),z[q]=Math.max(z[q],U[q])}return new Ds(I,z)}}}class pv{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(c){this._helper.setMinZoom(c)}setMaxZoom(c){this._helper.setMaxZoom(c)}setMinPitch(c){this._helper.setMinPitch(c)}setMaxPitch(c){this._helper.setMaxPitch(c)}setRenderWorldCopies(c){this._helper.setRenderWorldCopies(c)}setBearing(c){this._helper.setBearing(c)}setPitch(c){this._helper.setPitch(c)}setRoll(c){this._helper.setRoll(c)}setFov(c){this._helper.setFov(c)}setZoom(c){this._helper.setZoom(c)}setCenter(c){this._helper.setCenter(c)}setElevation(c){this._helper.setElevation(c)}setMinElevationForCurrentTile(c){this._helper.setMinElevationForCurrentTile(c)}setPadding(c){this._helper.setPadding(c)}interpolatePadding(c,f,b){return this._helper.interpolatePadding(c,f,b)}isPaddingEqual(c){return this._helper.isPaddingEqual(c)}resize(c,f){this._helper.resize(c,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(c){this._helper.setMaxBounds(c)}overrideNearFarZ(c,f){this._helper.overrideNearFarZ(c,f)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(c){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),c)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(c){}constructor(){this._cachedClippingPlane=a.bh(),this._projectionMatrix=a.b1(),this._globeViewProjMatrix32f=a.b0(),this._globeViewProjMatrixNoCorrection=a.b1(),this._globeViewProjMatrixNoCorrectionInverted=a.b1(),this._globeProjMatrixInverted=a.b1(),this._cameraPosition=a.bi(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ko({calcMatrices:()=>{this._calcMatrices()},getConstrained:(c,f)=>this.getConstrained(c,f)}),this._coveringTilesDetailsProvider=new WL}clone(){const c=new pv;return c.apply(this),c}apply(c,f){this._globeLatitudeErrorCorrectionRadians=f||0,this._helper.apply(c)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const c=a.bi();return c[0]=this._cameraPosition[0],c[1]=this._cameraPosition[1],c[2]=this._cameraPosition[2],c}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(c){const{overscaledTileID:f,applyGlobeMatrix:b}=c,_=this._helper.getMercatorTileCoordinates(f);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:_,clippingPlane:this._cachedClippingPlane,projectionTransition:b?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(c){const f=this.pitchInRadians,b=this.cameraToCenterDistance/c,_=Math.sin(f)*b,T=Math.cos(f)*b+1,I=1/Math.sqrt(_*_+T*T)*1;let z=-_,U=T;const q=Math.sqrt(z*z+U*U);z/=q,U/=q;const J=[0,z,U];return a.bj(J,J,[0,0,0],-this.bearingInRadians),a.bk(J,J,[0,0,0],-1*this.center.lat*Math.PI/180),a.bl(J,J,[0,0,0],this.center.lng*Math.PI/180),a.aO(J,J,.25),[...J,.25*-I]}isLocationOccluded(c){return!this.isSurfacePointVisible(no(c))}transformLightDirection(c){const f=this._helper._center.lng*Math.PI/180,b=this._helper._center.lat*Math.PI/180,_=Math.cos(b),T=[Math.sin(f)*_,Math.sin(b),Math.cos(f)*_],I=[T[2],0,-T[0]],z=[0,0,0];a.aU(z,I,T),a.aT(I,I),a.aT(z,z);const U=[0,0,0];return a.aT(U,[I[0]*c[0]+z[0]*c[1]+T[0]*c[2],I[1]*c[0]+z[1]*c[1]+T[1]*c[2],I[2]*c[0]+z[2]*c[1]+T[2]*c[2]]),U}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(c,f,b){const _=function(z,U,q){const J=1/(1<<q.z);return new a.$(z/a.Z*J+q.x*J,U/a.Z*J+q.y*J)}(c,f,b.canonical),T=(I=_.y,[a.bg(_.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI]);var I;return this.getCircleRadiusCorrection()/Math.cos(T[1])}projectTileCoordinates(c,f,b,_){const T=b.canonical,I=Hh(c,f,T.x,T.y,T.z),z=1+(_?_(c,f):0)/a.br,U=[I[0]*z,I[1]*z,I[2]*z,1];a.ap(U,U,this._globeViewProjMatrixNoCorrection);const q=this._cachedClippingPlane,J=q[0]*I[0]+q[1]*I[1]+q[2]*I[2]+q[3]<0;return{point:new a.P(U[0]/U[3],U[1]/U[3]),signedDistanceFromCamera:U[3],isOccluded:J}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const c=fv(this.worldSize,this.center.lat),f=a.b2(),b=a.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*c),a.aY(f,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const _=this.centerOffset;f[8]=2*-_.x/this._helper._width,f[9]=2*_.y/this._helper._height,this._projectionMatrix=a.aZ(f),this._globeProjMatrixInverted=a.b2(),a.aj(this._globeProjMatrixInverted,f),a.L(f,f,[0,0,-this.cameraToCenterDistance]),a.a_(f,f,this.rollInRadians),a.a$(f,f,-this.pitchInRadians),a.a_(f,f,this.bearingInRadians),a.L(f,f,[0,0,-c]);const T=a.bi();T[0]=c,T[1]=c,T[2]=c,a.a$(b,f,this.center.lat*Math.PI/180),a.bm(b,b,-this.center.lng*Math.PI/180),a.M(b,b,T),this._globeViewProjMatrixNoCorrection=b,a.a$(f,f,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),a.bm(f,f,-this.center.lng*Math.PI/180),a.M(f,f,T),this._globeViewProjMatrix32f=new Float32Array(f),this._globeViewProjMatrixNoCorrectionInverted=a.b2(),a.aj(this._globeViewProjMatrixNoCorrectionInverted,b);const I=a.bi();this._cameraPosition=a.bi(),this._cameraPosition[2]=this.cameraToCenterDistance/c,a.bj(this._cameraPosition,this._cameraPosition,I,-this.rollInRadians),a.bk(this._cameraPosition,this._cameraPosition,I,this.pitchInRadians),a.bj(this._cameraPosition,this._cameraPosition,I,-this.bearingInRadians),a.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),a.bk(this._cameraPosition,this._cameraPosition,I,-this.center.lat*Math.PI/180),a.bl(this._cameraPosition,this._cameraPosition,I,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(c);const z=a.aZ(this._globeViewProjMatrixNoCorrectionInverted);a.M(z,z,[1,1,-1]),this._cachedFrustum=Du.fromInvProjectionMatrix(z)}calculateFogMatrix(c){a.w("calculateFogMatrix is not supported on globe projection.");const f=a.b2();return a.at(f),f}getVisibleUnwrappedCoordinates(c){return[new a.aW(0,c)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(c){c&&a.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(c,f){if(!this._globeViewProjMatrixNoCorrection)return 1;const b=no(c);a.aO(b,b,1+f/a.br);const _=a.bh();return a.ap(_,[b[0],b[1],b[2],1],this._globeViewProjMatrixNoCorrection),_[2]/_[3]}populateCache(c){}getBounds(){const c=.5*this.width,f=.5*this.height,b=[new a.P(0,0),new a.P(c,0),new a.P(this.width,0),new a.P(this.width,f),new a.P(this.width,this.height),new a.P(c,this.height),new a.P(0,this.height),new a.P(0,f)],_=[];for(const se of b)_.push(this.unprojectScreenPoint(se));let T=0,I=0,z=0,U=0;const q=this.center;for(const se of _){const ne=a.bn(q.lng,se.lng),pe=a.bn(q.lat,se.lat);ne<I&&(I=ne),ne>T&&(T=ne),pe<U&&(U=pe),pe>z&&(z=pe)}const J=[q.lng+I,q.lat+U,q.lng+T,q.lat+z];return this.isSurfacePointOnScreen([0,1,0])&&(J[3]=90,J[0]=-180,J[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(J[1]=-90,J[0]=-180,J[2]=180),new Re(J)}getConstrained(c,f){const b=a.ae(c.lat,-85.051129,a.aJ),_=a.ae(+f,this.minZoom+_s(0,b),this.maxZoom);return{center:new a.Q(c.lng,b),zoom:_}}calculateCenterFromCameraLngLatAlt(c,f,b,_){return this._helper.calculateCenterFromCameraLngLatAlt(c,f,b,_)}setLocationAtPoint(c,f){const b=no(this.unprojectScreenPoint(f)),_=no(c),T=a.bi();a.bo(T);const I=a.bi();a.bl(I,b,T,-this.center.lng*Math.PI/180),a.bk(I,I,T,this.center.lat*Math.PI/180);const z=_[0]*_[0]+_[2]*_[2],U=I[0]*I[0];if(z<U)return;const q=Math.sqrt(z-U),J=-q,se=a.bp(_[0],_[2],I[0],q),ne=a.bp(_[0],_[2],I[0],J),pe=a.bi();a.bl(pe,_,T,-se);const ye=a.bp(pe[1],pe[2],I[1],I[2]),De=a.bi();a.bl(De,_,T,-ne);const Ee=a.bp(De[1],De[2],I[1],I[2]),Le=.5*Math.PI,ze=ye>=-Le&&ye<=Le,We=Ee>=-Le&&Ee<=Le;let Qe,Ke;if(ze&&We){const gt=this.center.lng*Math.PI/180,Dt=this.center.lat*Math.PI/180;a.bs(se,gt)+a.bs(ye,Dt)<a.bs(ne,gt)+a.bs(Ee,Dt)?(Qe=se,Ke=ye):(Qe=ne,Ke=Ee)}else if(ze)Qe=se,Ke=ye;else{if(!We)return;Qe=ne,Ke=Ee}const at=Qe/Math.PI*180,et=Ke/Math.PI*180,vt=this.center.lat;this.setCenter(new a.Q(at,a.ae(et,-90,90))),this.setZoom(this.zoom+_s(vt,this.center.lat))}locationToScreenPoint(c,f){const b=no(c);if(f){const _=f.getElevationForLngLatZoom(c,this._helper._tileZoom);a.aO(b,b,1+_/a.br)}return this._projectSurfacePointToScreen(b)}_projectSurfacePointToScreen(c){const f=a.bh();return a.ap(f,[...c,1],this._globeViewProjMatrixNoCorrection),f[0]/=f[3],f[1]/=f[3],new a.P((.5*f[0]+.5)*this.width,(.5*-f[1]+.5)*this.height)}screenPointToMercatorCoordinate(c,f){if(f){const b=f.pointCoordinate(c);if(b)return b}return a.$.fromLngLat(this.unprojectScreenPoint(c))}screenPointToLocation(c,f){var b;return(b=this.screenPointToMercatorCoordinate(c,f))===null||b===void 0?void 0:b.toLngLat()}isPointOnMapSurface(c,f){const b=this._cameraPosition,_=this.getRayDirectionFromPixel(c);return!!this.rayPlanetIntersection(b,_)}getRayDirectionFromPixel(c){const f=a.bh();f[0]=c.x/this.width*2-1,f[1]=-1*(c.y/this.height*2-1),f[2]=1,f[3]=1,a.ap(f,f,this._globeViewProjMatrixNoCorrectionInverted),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3];const b=a.bi();b[0]=f[0]-this._cameraPosition[0],b[1]=f[1]-this._cameraPosition[1],b[2]=f[2]-this._cameraPosition[2];const _=a.bi();return a.aT(_,b),_}isSurfacePointVisible(c){const f=this._cachedClippingPlane;return f[0]*c[0]+f[1]*c[1]+f[2]*c[2]+f[3]>=0}isSurfacePointOnScreen(c){if(!this.isSurfacePointVisible(c))return!1;const f=a.bh();return a.ap(f,[...c,1],this._globeViewProjMatrixNoCorrection),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[0]>-1&&f[0]<1&&f[1]>-1&&f[1]<1&&f[2]>-1&&f[2]<1}rayPlanetIntersection(c,f){const b=a.aV(c,f),_=a.bi(),T=a.bi();a.aO(T,f,b),a.aS(_,c,T);const I=1-a.aV(_,_);if(I<0)return null;const z=a.aV(c,c)-1,U=-b+(b<0?1:-1)*Math.sqrt(I),q=z/U,J=U;return{tMin:Math.min(q,J),tMax:Math.max(q,J)}}unprojectScreenPoint(c){const f=this._cameraPosition,b=this.getRayDirectionFromPixel(c),_=this.rayPlanetIntersection(f,b);if(_){const q=a.bi();a.aP(q,f,[b[0]*_.tMin,b[1]*_.tMin,b[2]*_.tMin]);const J=a.bi();return a.aT(J,q),uS(J)}const T=this._cachedClippingPlane[0]*b[0]+this._cachedClippingPlane[1]*b[1]+this._cachedClippingPlane[2]*b[2],I=-a.bq(this._cachedClippingPlane,f)/T,z=a.bi();if(I>0)a.aP(z,f,[b[0]*I,b[1]*I,b[2]*I]);else{const q=a.bi();a.aP(q,f,[2*b[0],2*b[1],2*b[2]]);const J=a.bq(this._cachedClippingPlane,q);a.aS(z,q,[this._cachedClippingPlane[0]*J,this._cachedClippingPlane[1]*J,this._cachedClippingPlane[2]*J])}const U=a.bi();return a.aT(U,z),uS(U)}getMatrixForModel(c,f){const b=a.Q.convert(c),_=1/a.br,T=a.b1();return a.bm(T,T,b.lng/180*Math.PI),a.a$(T,T,-b.lat/180*Math.PI),a.L(T,T,[0,0,1+f/a.br]),a.a$(T,T,.5*Math.PI),a.M(T,T,[_,_,_]),T}getProjectionDataForCustomLayer(c=!0){const f=this.getProjectionData({overscaledTileID:new a.Y(0,0,0,0,0),applyGlobeMatrix:c});return f.tileMercatorCoords=[0,0,1,1],f}getFastPathSimpleProjectionMatrix(c){}}class mv{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(c){this._helper.setMinZoom(c)}setMaxZoom(c){this._helper.setMaxZoom(c)}setMinPitch(c){this._helper.setMinPitch(c)}setMaxPitch(c){this._helper.setMaxPitch(c)}setRenderWorldCopies(c){this._helper.setRenderWorldCopies(c)}setBearing(c){this._helper.setBearing(c)}setPitch(c){this._helper.setPitch(c)}setRoll(c){this._helper.setRoll(c)}setFov(c){this._helper.setFov(c)}setZoom(c){this._helper.setZoom(c)}setCenter(c){this._helper.setCenter(c)}setElevation(c){this._helper.setElevation(c)}setMinElevationForCurrentTile(c){this._helper.setMinElevationForCurrentTile(c)}setPadding(c){this._helper.setPadding(c)}interpolatePadding(c,f,b){return this._helper.interpolatePadding(c,f,b)}isPaddingEqual(c){return this._helper.isPaddingEqual(c)}resize(c,f,b=!0){this._helper.resize(c,f,b)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(c){this._helper.setMaxBounds(c)}overrideNearFarZ(c,f){this._helper.overrideNearFarZ(c,f)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(c){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),c)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(c,f){this._globeness=c,this._globeLatitudeErrorCorrectionRadians=f,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ko({calcMatrices:()=>{this._calcMatrices()},getConstrained:(c,f)=>this.getConstrained(c,f)}),this._globeness=1,this._mercatorTransform=new kr,this._verticalPerspectiveTransform=new pv}clone(){const c=new mv;return c._globeness=this._globeness,c._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,c.apply(this),c}apply(c){this._helper.apply(c),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(c){const f=this._mercatorTransform.getProjectionData(c),b=this._verticalPerspectiveTransform.getProjectionData(c);return{mainMatrix:this.isGlobeRendering?b.mainMatrix:f.mainMatrix,clippingPlane:b.clippingPlane,tileMercatorCoords:b.tileMercatorCoords,projectionTransition:c.applyGlobeMatrix?this._globeness:0,fallbackMatrix:f.fallbackMatrix}}isLocationOccluded(c){return this.currentTransform.isLocationOccluded(c)}transformLightDirection(c){return this.currentTransform.transformLightDirection(c)}getPixelScale(){return a.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return a.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(c,f,b){const _=this._mercatorTransform.getPitchedTextCorrection(c,f,b),T=this._verticalPerspectiveTransform.getPitchedTextCorrection(c,f,b);return a.bc(_,T,this._globeness)}projectTileCoordinates(c,f,b,_){return this.currentTransform.projectTileCoordinates(c,f,b,_)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(c){return this.currentTransform.calculateFogMatrix(c)}getVisibleUnwrappedCoordinates(c){return this.currentTransform.getVisibleUnwrappedCoordinates(c)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(c){this._mercatorTransform.recalculateZoomAndCenter(c),this._verticalPerspectiveTransform.recalculateZoomAndCenter(c)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(c,f){return this.currentTransform.lngLatToCameraDepth(c,f)}populateCache(c){this._mercatorTransform.populateCache(c),this._verticalPerspectiveTransform.populateCache(c)}getBounds(){return this.currentTransform.getBounds()}getConstrained(c,f){return this.currentTransform.getConstrained(c,f)}calculateCenterFromCameraLngLatAlt(c,f,b,_){return this._helper.calculateCenterFromCameraLngLatAlt(c,f,b,_)}setLocationAtPoint(c,f){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(c,f),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(c,f),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(c,f){return this.currentTransform.locationToScreenPoint(c,f)}screenPointToMercatorCoordinate(c,f){return this.currentTransform.screenPointToMercatorCoordinate(c,f)}screenPointToLocation(c,f){return this.currentTransform.screenPointToLocation(c,f)}isPointOnMapSurface(c,f){return this.currentTransform.isPointOnMapSurface(c,f)}getRayDirectionFromPixel(c){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(c)}getMatrixForModel(c,f){return this.currentTransform.getMatrixForModel(c,f)}getProjectionDataForCustomLayer(c=!0){const f=this._mercatorTransform.getProjectionDataForCustomLayer(c);if(!this.isGlobeRendering)return f;const b=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(c);return b.fallbackMatrix=f.mainMatrix,b}getFastPathSimpleProjectionMatrix(c){return this.currentTransform.getFastPathSimpleProjectionMatrix(c)}}class Pl{get useGlobeControls(){return!0}handlePanInertia(c,f){const b=Rl(c,f);return Math.abs(b.lng-f.center.lng)>180&&(b.lng=f.center.lng+179.5*Math.sign(b.lng-f.center.lng)),{easingCenter:b,easingOffset:new a.P(0,0)}}handleMapControlsRollPitchBearingZoom(c,f){const b=c.around,_=f.screenPointToLocation(b);c.bearingDelta&&f.setBearing(f.bearing+c.bearingDelta),c.pitchDelta&&f.setPitch(f.pitch+c.pitchDelta),c.rollDelta&&f.setRoll(f.roll+c.rollDelta);const T=f.zoom;c.zoomDelta&&f.setZoom(f.zoom+c.zoomDelta);const I=f.zoom-T;if(I===0)return;const z=a.bn(f.center.lng,_.lng),U=z/(Math.abs(z/180)+1),q=a.bn(f.center.lat,_.lat),J=f.getRayDirectionFromPixel(b),se=f.cameraPosition,ne=-1*a.aV(se,J),pe=a.bi();a.aP(pe,se,[J[0]*ne,J[1]*ne,J[2]*ne]);const ye=a.bt(pe)-1,De=Math.exp(.5*-Math.max(ye-.3,0)),Ee=fv(f.worldSize,f.center.lat)/Math.min(f.width,f.height),Le=a.bf(Ee,.9,.5,1,.25),ze=(1-a.aI(-I))*Math.min(De,Le),We=f.center.lat,Qe=f.zoom,Ke=new a.Q(f.center.lng+U*ze,a.ae(f.center.lat+q*ze,-85.051129,a.aJ));f.setLocationAtPoint(_,b);const at=f.center,et=a.bf(Math.abs(z),45,85,0,1),vt=a.bf(Ee,.75,.35,0,1),gt=Math.pow(Math.max(et,vt),.25),Dt=a.bn(at.lng,Ke.lng),Bt=a.bn(at.lat,Ke.lat);f.setCenter(new a.Q(at.lng+Dt*gt,at.lat+Bt*gt).wrap()),f.setZoom(Qe+_s(We,f.center.lat))}handleMapControlsPan(c,f,b){if(!c.panDelta)return;const _=f.center.lat,T=f.zoom;f.setCenter(Rl(c.panDelta,f).wrap()),f.setZoom(T+_s(_,f.center.lat))}cameraForBoxAndBearing(c,f,b,_,T){const I=qp(c,f,b,_,T),z=f.left/T.width*2-1,U=(T.width-f.right)/T.width*2-1,q=f.top/T.height*-2+1,J=(T.height-f.bottom)/T.height*-2+1,se=a.bn(b.getWest(),b.getEast())<0,ne=se?b.getEast():b.getWest(),pe=se?b.getWest():b.getEast(),ye=Math.max(b.getNorth(),b.getSouth()),De=Math.min(b.getNorth(),b.getSouth()),Ee=ne+.5*a.bn(ne,pe),Le=ye+.5*a.bn(ye,De),ze=T.clone();ze.setCenter(I.center),ze.setBearing(I.bearing),ze.setPitch(0),ze.setRoll(0),ze.setZoom(I.zoom);const We=ze.modelViewProjectionMatrix,Qe=[no(b.getNorthWest()),no(b.getNorthEast()),no(b.getSouthWest()),no(b.getSouthEast()),no(new a.Q(pe,Le)),no(new a.Q(ne,Le)),no(new a.Q(Ee,ye)),no(new a.Q(Ee,De))],Ke=no(I.center);let at=Number.POSITIVE_INFINITY;for(const et of Qe)z<0&&(at=Pl.getLesserNonNegativeNonNull(at,Pl.solveVectorScale(et,Ke,We,"x",z))),U>0&&(at=Pl.getLesserNonNegativeNonNull(at,Pl.solveVectorScale(et,Ke,We,"x",U))),q>0&&(at=Pl.getLesserNonNegativeNonNull(at,Pl.solveVectorScale(et,Ke,We,"y",q))),J<0&&(at=Pl.getLesserNonNegativeNonNull(at,Pl.solveVectorScale(et,Ke,We,"y",J)));if(Number.isFinite(at)&&at!==0)return I.zoom=ze.zoom+a.ab(at),I;af()}handleJumpToCenterZoom(c,f){const b=c.center.lat,_=c.getConstrained(f.center?a.Q.convert(f.center):c.center,c.zoom).center;c.setCenter(_.wrap());const T=f.zoom!==void 0?+f.zoom:c.zoom+_s(b,_.lat);c.zoom!==T&&c.setZoom(T)}handleEaseTo(c,f){const b=c.zoom,_=c.center,T=c.padding,I={roll:c.roll,pitch:c.pitch,bearing:c.bearing},z={roll:f.roll===void 0?c.roll:f.roll,pitch:f.pitch===void 0?c.pitch:f.pitch,bearing:f.bearing===void 0?c.bearing:f.bearing},U=f.zoom!==void 0,q=!c.isPaddingEqual(f.padding);let J=!1;const se=f.center?a.Q.convert(f.center):_,ne=c.getConstrained(se,b).center;uv(c,ne);const pe=c.clone();pe.setCenter(ne),pe.setZoom(U?+f.zoom:b+_s(_.lat,se.lat)),pe.setBearing(f.bearing);const ye=new a.P(a.ae(c.centerPoint.x+f.offsetAsPoint.x,0,c.width),a.ae(c.centerPoint.y+f.offsetAsPoint.y,0,c.height));pe.setLocationAtPoint(ne,ye);const De=(f.offset&&f.offsetAsPoint.mag())>0?pe.center:ne,Ee=U?+f.zoom:b+_s(_.lat,De.lat),Le=b+_s(_.lat,0),ze=Ee+_s(De.lat,0),We=a.bn(_.lng,De.lng),Qe=a.bn(_.lat,De.lat),Ke=a.aI(ze-Le);return J=Ee!==b,{easeFunc:at=>{if(a.b6(I,z)||Lu({startEulerAngles:I,endEulerAngles:z,tr:c,k:at,useSlerp:I.roll!=z.roll}),q&&c.interpolatePadding(T,f.padding,at),f.around)a.w("Easing around a point is not supported under globe projection."),c.setLocationAtPoint(f.around,f.aroundPoint);else{const et=ze>Le?Math.min(2,Ke):Math.max(.5,Ke),vt=Math.pow(et,1-at),gt=_x(_,We,Qe,at*vt);c.setCenter(gt.wrap())}if(J){const et=a.B.number(Le,ze,at)+_s(0,c.center.lat);c.setZoom(et)}},isZooming:J,elevationCenter:De}}handleFlyTo(c,f){const b=f.zoom!==void 0,_=c.center,T=c.zoom,I=c.padding,z=!c.isPaddingEqual(f.padding),U=c.getConstrained(a.Q.convert(f.center||f.locationAtOffset),T).center,q=b?+f.zoom:c.zoom+_s(c.center.lat,U.lat),J=c.clone();J.setCenter(U),J.setZoom(q),J.setBearing(f.bearing);const se=new a.P(a.ae(c.centerPoint.x+f.offsetAsPoint.x,0,c.width),a.ae(c.centerPoint.y+f.offsetAsPoint.y,0,c.height));J.setLocationAtPoint(U,se);const ne=J.center;uv(c,ne);const pe=function(Qe,Ke,at){const et=no(Ke),vt=no(at),gt=a.aV(et,vt),Dt=Math.acos(gt),Bt=cS(Qe);return Dt/(2*Math.PI)*Bt}(c,_,ne),ye=T+_s(_.lat,0),De=q+_s(ne.lat,0),Ee=a.aI(De-ye);let Le;if(typeof f.minZoom=="number"){const Qe=+f.minZoom+_s(ne.lat,0),Ke=Math.min(Qe,ye,De)+_s(0,ne.lat),at=c.getConstrained(ne,Ke).zoom+_s(ne.lat,0);Le=a.aI(at-ye)}const ze=a.bn(_.lng,ne.lng),We=a.bn(_.lat,ne.lat);return{easeFunc:(Qe,Ke,at,et)=>{const vt=_x(_,ze,We,at);z&&c.interpolatePadding(I,f.padding,Qe);const gt=Qe===1?ne:vt;c.setCenter(gt.wrap());const Dt=ye+a.ab(Ke);c.setZoom(Qe===1?q:Dt+_s(0,gt.lat))},scaleOfZoom:Ee,targetCenter:ne,scaleOfMinZoom:Le,pixelPathLength:pe}}static solveVectorScale(c,f,b,_,T){const I=_==="x"?[b[0],b[4],b[8],b[12]]:[b[1],b[5],b[9],b[13]],z=[b[3],b[7],b[11],b[15]],U=c[0]*I[0]+c[1]*I[1]+c[2]*I[2],q=c[0]*z[0]+c[1]*z[1]+c[2]*z[2],J=f[0]*I[0]+f[1]*I[1]+f[2]*I[2],se=f[0]*z[0]+f[1]*z[1]+f[2]*z[2];return J+T*q===U+T*se||z[3]*(U-J)+I[3]*(se-q)+U*se==J*q?null:(J+I[3]-T*se-T*z[3])/(J-U-T*se+T*q)}static getLesserNonNegativeNonNull(c,f){return f!==null&&f>=0&&f<c?f:c}}class dS{constructor(c){this._globe=c,this._mercatorCameraHelper=new Yo,this._verticalPerspectiveCameraHelper=new Pl}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(c,f){return this.currentHelper.handlePanInertia(c,f)}handleMapControlsRollPitchBearingZoom(c,f){return this.currentHelper.handleMapControlsRollPitchBearingZoom(c,f)}handleMapControlsPan(c,f,b){this.currentHelper.handleMapControlsPan(c,f,b)}cameraForBoxAndBearing(c,f,b,_,T){return this.currentHelper.cameraForBoxAndBearing(c,f,b,_,T)}handleJumpToCenterZoom(c,f){this.currentHelper.handleJumpToCenterZoom(c,f)}handleEaseTo(c,f){return this.currentHelper.handleEaseTo(c,f)}handleFlyTo(c,f){return this.currentHelper.handleFlyTo(c,f)}}const $h=(S,c)=>a.x(S,c&&c.filter(f=>f.identifier!=="source.canvas")),Sx=a.bu();class df extends a.E{constructor(c,f={}){super(),this._rtlPluginLoaded=()=>{for(const b in this.sourceCaches){const _=this.sourceCaches[b].getSource().type;_!=="vector"&&_!=="geojson"||this.sourceCaches[b].reload()}},this.map=c,this.dispatcher=new wt(mt(),c._getMapId()),this.dispatcher.registerMessageHandler("GG",(b,_)=>this.getGlyphs(b,_)),this.dispatcher.registerMessageHandler("GI",(b,_)=>this.getImages(b,_)),this.imageManager=new D,this.imageManager.setEventedParent(this),this.glyphManager=new ie(c._requestManager,f.localIdeographFontFamily),this.lineAtlas=new He(256,512),this.crossTileSymbolIndex=new bo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.bv,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.bw()),ot().on($e,this._rtlPluginLoaded),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const _=this.sourceCaches[b.sourceId];if(!_)return;const T=_.getSource();if(T&&T.vectorLayerIds)for(const I in this._layers){const z=this._layers[I];z.source===T.id&&this._validateLayer(z)}})}loadURL(c,f={},b){this.fire(new a.l("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const _=this.map._requestManager.transformRequest(c,"Style");this._loadStyleRequest=new AbortController;const T=this._loadStyleRequest;a.j(_,this._loadStyleRequest).then(I=>{this._loadStyleRequest=null,this._load(I.data,f,b)}).catch(I=>{this._loadStyleRequest=null,I&&!T.signal.aborted&&this.fire(new a.k(I))})}loadJSON(c,f={},b){this.fire(new a.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,v.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(c,f,b)}).catch(()=>{})}loadEmpty(){this.fire(new a.l("dataloading",{dataType:"style"})),this._load(Sx,{validate:!1})}_load(c,f,b){var _,T;const I=f.transformStyle?f.transformStyle(b,c):c;if(!f.validate||!$h(this,a.y(I))){this._loaded=!0,this.stylesheet=I;for(const z in I.sources)this.addSource(z,I.sources[z],{validate:!1});I.sprite?this._loadSprite(I.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(I.glyphs),this._createLayers(),this.light=new be(this.stylesheet.light),this._setProjectionInternal(((_=this.stylesheet.projection)===null||_===void 0?void 0:_.type)||"mercator"),this.sky=new Fe(this.stylesheet.sky),this.map.setTerrain((T=this.stylesheet.terrain)!==null&&T!==void 0?T:null),this.fire(new a.l("data",{dataType:"style"})),this.fire(new a.l("style.load"))}}_createLayers(){const c=a.bx(this.stylesheet.layers);this.dispatcher.broadcast("SL",c),this._order=c.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of c){const b=a.by(f);b.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=b}}_loadSprite(c,f=!1,b=void 0){let _;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(T,I,z,U){return a._(this,void 0,void 0,function*(){const q=W(T),J=z>1?"@2x":"",se={},ne={};for(const{id:pe,url:ye}of q){const De=I.transformRequest(Q(ye,J,".json"),"SpriteJSON");se[pe]=a.j(De,U);const Ee=I.transformRequest(Q(ye,J,".png"),"SpriteImage");ne[pe]=k.getImage(Ee,U)}return yield Promise.all([...Object.values(se),...Object.values(ne)]),function(pe,ye){return a._(this,void 0,void 0,function*(){const De={};for(const Ee in pe){De[Ee]={};const Le=v.getImageCanvasContext((yield ye[Ee]).data),ze=(yield pe[Ee]).data;for(const We in ze){const{width:Qe,height:Ke,x:at,y:et,sdf:vt,pixelRatio:gt,stretchX:Dt,stretchY:Bt,content:It,textFitWidth:di,textFitHeight:ui}=ze[We];De[Ee][We]={data:null,pixelRatio:gt,sdf:vt,stretchX:Dt,stretchY:Bt,content:It,textFitWidth:di,textFitHeight:ui,spriteData:{width:Qe,height:Ke,x:at,y:et,context:Le}}}}return De})}(se,ne)})}(c,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(T=>{if(this._spriteRequest=null,T)for(const I in T){this._spritesImagesIds[I]=[];const z=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter(U=>!(U in T)):[];for(const U of z)this.imageManager.removeImage(U),this._changedImages[U]=!0;for(const U in T[I]){const q=I==="default"?U:`${I}:${U}`;this._spritesImagesIds[I].push(q),q in this.imageManager.images?this.imageManager.updateImage(q,T[I][U],!1):this.imageManager.addImage(q,T[I][U]),f&&(this._changedImages[q]=!0)}}}).catch(T=>{this._spriteRequest=null,_=T,this.fire(new a.k(_))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"})),b&&b(_)})}_unloadSprite(){for(const c of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(c),this._changedImages[c]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}_validateLayer(c){const f=this.sourceCaches[c.source];if(!f)return;const b=c.sourceLayer;if(!b)return;const _=f.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(b)===-1)&&this.fire(new a.k(new Error(`Source layer "${b}" does not exist on source "${_.id}" as specified by style layer "${c.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(c,f=!1){const b=this._serializedAllLayers();if(!c||c.length===0)return Object.values(f?a.bz(b):b);const _=[];for(const T of c)if(b[T]){const I=f?a.bz(b[T]):b[T];_.push(I)}return _}_serializedAllLayers(){let c=this._serializedLayers;if(c)return c;c=this._serializedLayers={};const f=Object.keys(this._layers);for(const b of f){const _=this._layers[b];_.type!=="custom"&&(c[b]=_.serialize())}return c}hasTransitions(){var c,f,b;if(!((c=this.light)===null||c===void 0)&&c.hasTransition()||!((f=this.sky)===null||f===void 0)&&f.hasTransition()||!((b=this.projection)===null||b===void 0)&&b.hasTransition())return!0;for(const _ in this.sourceCaches)if(this.sourceCaches[_].hasTransition())return!0;for(const _ in this._layers)if(this._layers[_].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(c){if(!this._loaded)return;const f=this._changed;if(f){const _=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(_.length||T.length)&&this._updateWorkerLayers(_,T);for(const I in this._updatedSources){const z=this._updatedSources[I];if(z==="reload")this._reloadSource(I);else{if(z!=="clear")throw new Error(`Invalid action ${z}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(c);this.light.updateTransitions(c),this.sky.updateTransitions(c),this._resetUpdates()}const b={};for(const _ in this.sourceCaches){const T=this.sourceCaches[_];b[_]=T.used,T.used=!1}for(const _ of this._order){const T=this._layers[_];T.recalculate(c,this._availableImages),!T.isHidden(c.zoom)&&T.source&&(this.sourceCaches[T.source].used=!0)}for(const _ in b){const T=this.sourceCaches[_];!!b[_]!=!!T.used&&T.fire(new a.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(c),this.sky.recalculate(c),this.projection.recalculate(c),this.z=c.zoom,f&&this.fire(new a.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(c,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(c,!1),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(c,f={}){var b;this._checkLoaded();const _=this.serialize();if(c=f.transformStyle?f.transformStyle(_,c):c,((b=f.validate)===null||b===void 0||b)&&$h(this,a.y(c)))return!1;(c=a.bz(c)).layers=a.bx(c.layers);const T=a.bA(_,c),I=this._getOperationsToPerform(T);if(I.unimplemented.length>0)throw new Error(`Unimplemented: ${I.unimplemented.join(", ")}.`);if(I.operations.length===0)return!1;for(const z of I.operations)z();return this.stylesheet=c,this._serializedLayers=null,!0}_getOperationsToPerform(c){const f=[],b=[];for(const _ of c)switch(_.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,_.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,_.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,_.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,_.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,_.args));break;case"addSource":f.push(()=>this.addSource.apply(this,_.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,_.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,_.args));break;case"setLight":f.push(()=>this.setLight.apply(this,_.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,_.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,_.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,_.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,_.args));break;case"setSky":f.push(()=>this.setSky.apply(this,_.args));break;case"setProjection":this.setProjection.apply(this,_.args);break;case"setTransition":f.push(()=>{});break;default:b.push(_.command)}return{operations:f,unimplemented:b}}addImage(c,f){if(this.getImage(c))return this.fire(new a.k(new Error(`An image named "${c}" already exists.`)));this.imageManager.addImage(c,f),this._afterImageUpdated(c)}updateImage(c,f){this.imageManager.updateImage(c,f)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){if(!this.getImage(c))return this.fire(new a.k(new Error(`An image named "${c}" does not exist.`)));this.imageManager.removeImage(c),this._afterImageUpdated(c)}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(c,f,b={}){if(this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error(`Source "${c}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(a.y.source,`sources.${c}`,f,null,b))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const _=this.sourceCaches[c]=new oe(c,f,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:_.loaded(),source:_.serialize(),sourceId:c})),_.onAdd(this.map),this._changed=!0}removeSource(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===c)return this.fire(new a.k(new Error(`Source "${c}" cannot be removed while layer "${b}" is using it.`)));const f=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],f.fire(new a.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(c,f){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error(`There is no source with this ID=${c}`);const b=this.sourceCaches[c].getSource();if(b.type!=="geojson")throw new Error(`geojsonSource.type is ${b.type}, which is !== 'geojson`);b.setData(f),this._changed=!0}getSource(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()}addLayer(c,f,b={}){this._checkLoaded();const _=c.id;if(this.getLayer(_))return void this.fire(new a.k(new Error(`Layer "${_}" already exists on this map.`)));let T;if(c.type==="custom"){if($h(this,a.bB(c)))return;T=a.by(c)}else{if("source"in c&&typeof c.source=="object"&&(this.addSource(_,c.source),c=a.bz(c),c=a.e(c,{source:_})),this._validate(a.y.layer,`layers.${_}`,c,{arrayIndex:-1},b))return;T=a.by(c),this._validateLayer(T),T.setEventedParent(this,{layer:{id:_}})}const I=f?this._order.indexOf(f):this._order.length;if(f&&I===-1)this.fire(new a.k(new Error(`Cannot add layer "${_}" before non-existing layer "${f}".`)));else{if(this._order.splice(I,0,_),this._layerOrderChanged=!0,this._layers[_]=T,this._removedLayers[_]&&T.source&&T.type!=="custom"){const z=this._removedLayers[_];delete this._removedLayers[_],z.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}moveLayer(c,f){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new a.k(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===f)return;const b=this._order.indexOf(c);this._order.splice(b,1);const _=f?this._order.indexOf(f):this._order.length;f&&_===-1?this.fire(new a.k(new Error(`Cannot move layer "${c}" before non-existing layer "${f}".`))):(this._order.splice(_,0,c),this._layerOrderChanged=!0)}removeLayer(c){this._checkLoaded();const f=this._layers[c];if(!f)return void this.fire(new a.k(new Error(`Cannot remove non-existing layer "${c}".`)));f.setEventedParent(null);const b=this._order.indexOf(c);this._order.splice(b,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=f,delete this._layers[c],this._serializedLayers&&delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],f.onRemove&&f.onRemove(this.map)}getLayer(c){return this._layers[c]}getLayersOrder(){return[...this._order]}hasLayer(c){return c in this._layers}setLayerZoomRange(c,f,b){this._checkLoaded();const _=this.getLayer(c);_?_.minzoom===f&&_.maxzoom===b||(f!=null&&(_.minzoom=f),b!=null&&(_.maxzoom=b),this._updateLayer(_)):this.fire(new a.k(new Error(`Cannot set the zoom range of non-existing layer "${c}".`)))}setFilter(c,f,b={}){this._checkLoaded();const _=this.getLayer(c);if(_){if(!a.bC(_.filter,f))return f==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(a.y.filter,`layers.${_.id}.filter`,f,null,b)||(_.filter=a.bz(f),this._updateLayer(_)))}else this.fire(new a.k(new Error(`Cannot filter non-existing layer "${c}".`)))}getFilter(c){return a.bz(this.getLayer(c).filter)}setLayoutProperty(c,f,b,_={}){this._checkLoaded();const T=this.getLayer(c);T?a.bC(T.getLayoutProperty(f),b)||(T.setLayoutProperty(f,b,_),this._updateLayer(T)):this.fire(new a.k(new Error(`Cannot style non-existing layer "${c}".`)))}getLayoutProperty(c,f){const b=this.getLayer(c);if(b)return b.getLayoutProperty(f);this.fire(new a.k(new Error(`Cannot get style of non-existing layer "${c}".`)))}setPaintProperty(c,f,b,_={}){this._checkLoaded();const T=this.getLayer(c);T?a.bC(T.getPaintProperty(f),b)||(T.setPaintProperty(f,b,_)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[c]=!0,this._serializedLayers=null):this.fire(new a.k(new Error(`Cannot style non-existing layer "${c}".`)))}getPaintProperty(c,f){return this.getLayer(c).getPaintProperty(f)}setFeatureState(c,f){this._checkLoaded();const b=c.source,_=c.sourceLayer,T=this.sourceCaches[b];if(T===void 0)return void this.fire(new a.k(new Error(`The source '${b}' does not exist in the map's style.`)));const I=T.getSource().type;I==="geojson"&&_?this.fire(new a.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||_?(c.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),T.setFeatureState(_,c.id,f)):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(c,f){this._checkLoaded();const b=c.source,_=this.sourceCaches[b];if(_===void 0)return void this.fire(new a.k(new Error(`The source '${b}' does not exist in the map's style.`)));const T=_.getSource().type,I=T==="vector"?c.sourceLayer:void 0;T!=="vector"||I?f&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new a.k(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(I,c.id,f):this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(c){this._checkLoaded();const f=c.source,b=c.sourceLayer,_=this.sourceCaches[f];if(_!==void 0)return _.getSource().type!=="vector"||b?(c.id===void 0&&this.fire(new a.k(new Error("The feature id parameter must be provided."))),_.getFeatureState(b,c.id)):void this.fire(new a.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.k(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const c=a.bD(this.sourceCaches,T=>T.serialize()),f=this._serializeByIds(this._order,!0),b=this.map.getTerrain()||void 0,_=this.stylesheet;return a.bE({version:_.version,name:_.name,metadata:_.metadata,light:_.light,sky:_.sky,center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,sprite:_.sprite,glyphs:_.glyphs,transition:_.transition,projection:_.projection,sources:c,layers:f,terrain:b},T=>T!==void 0)}_updateLayer(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(c){const f=I=>this._layers[I].type==="fill-extrusion",b={},_=[];for(let I=this._order.length-1;I>=0;I--){const z=this._order[I];if(f(z)){b[z]=I;for(const U of c){const q=U[z];if(q)for(const J of q)_.push(J)}}}_.sort((I,z)=>z.intersectionZ-I.intersectionZ);const T=[];for(let I=this._order.length-1;I>=0;I--){const z=this._order[I];if(f(z))for(let U=_.length-1;U>=0;U--){const q=_[U].feature;if(b[q.layer.id]<I)break;T.push(q),_.pop()}else for(const U of c){const q=U[z];if(q)for(const J of q)T.push(J.feature)}}return T}queryRenderedFeatures(c,f,b){f&&f.filter&&this._validate(a.y.filter,"queryRenderedFeatures.filter",f.filter,null,f);const _={};if(f&&f.layers){if(!(Array.isArray(f.layers)||f.layers instanceof Set))return this.fire(new a.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const q of f.layers){const J=this._layers[q];if(!J)return this.fire(new a.k(new Error(`The layer '${q}' does not exist in the map's style and cannot be queried for features.`))),[];_[J.source]=!0}}const T=[];f.availableImages=this._availableImages;const I=this._serializedAllLayers(),z=f.layers instanceof Set?f.layers:Array.isArray(f.layers)?new Set(f.layers):null,U=Object.assign(Object.assign({},f),{layers:z});for(const q in this.sourceCaches)f.layers&&!_[q]||T.push(ei(this.sourceCaches[q],this._layers,I,c,U,b,this.map.terrain?(J,se,ne)=>this.map.terrain.getElevation(J,se,ne):void 0));return this.placement&&T.push(function(q,J,se,ne,pe,ye,De){const Ee={},Le=ye.queryRenderedSymbols(ne),ze=[];for(const We of Object.keys(Le).map(Number))ze.push(De[We]);ze.sort(Jt);for(const We of ze){const Qe=We.featureIndex.lookupSymbolFeatures(Le[We.bucketInstanceId],J,We.bucketIndex,We.sourceLayerIndex,pe.filter,pe.layers,pe.availableImages,q);for(const Ke in Qe){const at=Ee[Ke]=Ee[Ke]||[],et=Qe[Ke];et.sort((vt,gt)=>{const Dt=We.featureSortOrder;if(Dt){const Bt=Dt.indexOf(vt.featureIndex);return Dt.indexOf(gt.featureIndex)-Bt}return gt.featureIndex-vt.featureIndex});for(const vt of et)at.push(vt)}}return function(We,Qe,Ke){for(const at in We)for(const et of We[at])Yt(et,Ke[Qe[at].source]);return We}(Ee,q,se)}(this._layers,I,this.sourceCaches,c,U,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(c,f){f&&f.filter&&this._validate(a.y.filter,"querySourceFeatures.filter",f.filter,null,f);const b=this.sourceCaches[c];return b?function(_,T){const I=_.getRenderableIds().map(q=>_.getTileByID(q)),z=[],U={};for(let q=0;q<I.length;q++){const J=I[q],se=J.tileID.canonical.key;U[se]||(U[se]=!0,J.querySourceFeatures(z,T))}return z}(b,f):[]}getLight(){return this.light.getLight()}setLight(c,f={}){this._checkLoaded();const b=this.light.getLight();let _=!1;for(const I in c)if(!a.bC(c[I],b[I])){_=!0;break}if(!_)return;const T={now:v.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,f),this.light.updateTransitions(T)}getProjection(){var c;return(c=this.stylesheet)===null||c===void 0?void 0:c.projection}setProjection(c){if(this._checkLoaded(),this.projection){if(this.projection.name===c.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=c,this._setProjectionInternal(c.type)}getSky(){var c;return(c=this.stylesheet)===null||c===void 0?void 0:c.sky}setSky(c,f={}){this._checkLoaded();const b=this.getSky();let _=!1;if(!c&&!b)return;if(c&&!b)_=!0;else if(!c&&b)_=!0;else for(const I in c)if(!a.bC(c[I],b[I])){_=!0;break}if(!_)return;const T={now:v.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=c,this.sky.setSky(c,f),this.sky.updateTransitions(T)}_setProjectionInternal(c){const f=function(b){if(Array.isArray(b)){const _=new uf({type:b});return{projection:_,transform:new mv,cameraHelper:new dS(_)}}switch(b){case"mercator":return{projection:new hn,transform:new kr,cameraHelper:new Yo};case"globe":{const _=new uf({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:_,transform:new mv,cameraHelper:new dS(_)}}case"vertical-perspective":return{projection:new Xp,transform:new pv,cameraHelper:new Pl};default:return a.w(`Unknown projection name: ${b}. Falling back to mercator projection.`),{projection:new hn,transform:new kr,cameraHelper:new Yo}}}(c);this.projection=f.projection,this.map.migrateProjection(f.transform,f.cameraHelper);for(const b in this.sourceCaches)this.sourceCaches[b].reload()}_validate(c,f,b,_,T={}){return(!T||T.validate!==!1)&&$h(this,c.call(a.y,a.e({key:f,style:this.serialize(),value:b,styleSpec:a.v},_)))}_remove(c=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ot().off($e,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const b=this.sourceCaches[f];b.setEventedParent(null),b.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),c&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(c)}_clearSource(c){this.sourceCaches[c].clearTiles()}_reloadSource(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()}_updateSources(c){for(const f in this.sourceCaches)this.sourceCaches[f].update(c,this.map.terrain)}_generateCollisionBoxes(){for(const c in this.sourceCaches)this._reloadSource(c)}_updatePlacement(c,f,b,_,T=!1){let I=!1,z=!1;const U={};for(const q of this._order){const J=this._layers[q];if(J.type!=="symbol")continue;if(!U[J.source]){const ne=this.sourceCaches[J.source];U[J.source]=ne.getRenderableIds(!0).map(pe=>ne.getTileByID(pe)).sort((pe,ye)=>ye.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(ye.tileID)?-1:1))}const se=this.crossTileSymbolIndex.addLayer(J,U[J.source],c.center.lng);I=I||se}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||b===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.now(),c.zoom))&&(this.pauseablePlacement=new Er(c,this.map.terrain,this._order,T,f,b,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,U),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.now()),z=!0),I&&this.pauseablePlacement.placement.setStale()),z||I)for(const q of this._order){const J=this._layers[q];J.type==="symbol"&&this.placement.updateLayerOpacities(J,U[J.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.now())}_releaseSymbolFadeTiles(){for(const c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,f){return a._(this,void 0,void 0,function*(){const b=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const _=this.sourceCaches[f.source];return _&&_.setDependencies(f.tileID.key,f.type,f.icons),b})}getGlyphs(c,f){return a._(this,void 0,void 0,function*(){const b=yield this.glyphManager.getGlyphs(f.stacks),_=this.sourceCaches[f.source];return _&&_.setDependencies(f.tileID.key,f.type,[""]),b})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(c,f={}){this._checkLoaded(),c&&this._validate(a.y.glyphs,"glyphs",c,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=c,this.glyphManager.entries={},this.glyphManager.setURL(c))}addSprite(c,f,b={},_){this._checkLoaded();const T=[{id:c,url:f}],I=[...W(this.stylesheet.sprite),...T];this._validate(a.y.sprite,"sprite",I,null,b)||(this.stylesheet.sprite=I,this._loadSprite(T,!0,_))}removeSprite(c){this._checkLoaded();const f=W(this.stylesheet.sprite);if(f.find(b=>b.id===c)){if(this._spritesImagesIds[c])for(const b of this._spritesImagesIds[c])this.imageManager.removeImage(b),this._changedImages[b]=!0;f.splice(f.findIndex(b=>b.id===c),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[c],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.l("data",{dataType:"style"}))}else this.fire(new a.k(new Error(`Sprite "${c}" doesn't exists on this map.`)))}getSprite(){return W(this.stylesheet.sprite)}setSprite(c,f={},b){this._checkLoaded(),c&&this._validate(a.y.sprite,"sprite",c,null,f)||(this.stylesheet.sprite=c,c?this._loadSprite(c,!0,b):(this._unloadSprite(),b&&b(null)))}}var Ox=a.aD([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Mx{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(c,f,b,_,T,I,z,U,q){this.context=c;let J=this.boundPaintVertexBuffers.length!==_.length;for(let se=0;!J&&se<_.length;se++)this.boundPaintVertexBuffers[se]!==_[se]&&(J=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==b||J||this.boundIndexBuffer!==T||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==z||this.boundDynamicVertexBuffer2!==U||this.boundDynamicVertexBuffer3!==q?this.freshBind(f,b,_,T,I,z,U,q):(c.bindVertexArray.set(this.vao),z&&z.bind(),T&&T.dynamicDraw&&T.bind(),U&&U.bind(),q&&q.bind())}freshBind(c,f,b,_,T,I,z,U){const q=c.numAttributes,J=this.context,se=J.gl;this.vao&&this.destroy(),this.vao=J.createVertexArray(),J.bindVertexArray.set(this.vao),this.boundProgram=c,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=b,this.boundIndexBuffer=_,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=z,this.boundDynamicVertexBuffer3=U,f.enableAttributes(se,c);for(const ne of b)ne.enableAttributes(se,c);I&&I.enableAttributes(se,c),z&&z.enableAttributes(se,c),U&&U.enableAttributes(se,c),f.bind(),f.setVertexAttribPointers(se,c,T);for(const ne of b)ne.bind(),ne.setVertexAttribPointers(se,c,T);I&&(I.bind(),I.setVertexAttribPointers(se,c,T)),_&&_.bind(),z&&(z.bind(),z.setVertexAttribPointers(se,c,T)),U&&(U.bind(),U.setVertexAttribPointers(se,c,T)),J.currentNumAttributes=q}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const cc=(S,c,f,b,_)=>({u_texture:0,u_ele_delta:S,u_fog_matrix:c,u_fog_color:f?f.properties.get("fog-color"):a.b7.white,u_fog_ground_blend:f?f.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:_?0:f?f.calculateFogBlendOpacity(b):0,u_horizon_color:f?f.properties.get("horizon-color"):a.b7.white,u_horizon_fog_blend:f?f.properties.get("horizon-fog-blend"):1,u_is_globe_mode:_?1:0}),qL={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ff(S){const c=[];for(let f=0;f<S.length;f++){if(S[f]===null)continue;const b=S[f].split(" ");c.push(b.pop())}return c}class Kp{constructor(c,f,b,_,T,I,z,U){const q=c.gl;this.program=q.createProgram();const J=ff(f.staticAttributes),se=b?b.getBinderAttributes():[],ne=J.concat(se),pe=Ar.prelude.staticUniforms?ff(Ar.prelude.staticUniforms):[],ye=z.staticUniforms?ff(z.staticUniforms):[],De=f.staticUniforms?ff(f.staticUniforms):[],Ee=b?b.getBinderUniforms():[],Le=pe.concat(ye).concat(De).concat(Ee),ze=[];for(const gt of Le)ze.indexOf(gt)<0&&ze.push(gt);const We=b?b.defines():[];Tl(q)&&We.unshift("#version 300 es"),T&&We.push("#define OVERDRAW_INSPECTOR;"),I&&We.push("#define TERRAIN3D;"),U&&We.push(U);let Qe=We.concat(Ar.prelude.fragmentSource,z.fragmentSource,f.fragmentSource).join(`
`),Ke=We.concat(Ar.prelude.vertexSource,z.vertexSource,f.vertexSource).join(`
`);Tl(q)||(Qe=function(gt){return gt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(Qe),Ke=function(gt){return gt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Ke));const at=q.createShader(q.FRAGMENT_SHADER);if(q.isContextLost())return void(this.failedToCreate=!0);if(q.shaderSource(at,Qe),q.compileShader(at),!q.getShaderParameter(at,q.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${q.getShaderInfoLog(at)}`);q.attachShader(this.program,at);const et=q.createShader(q.VERTEX_SHADER);if(q.isContextLost())return void(this.failedToCreate=!0);if(q.shaderSource(et,Ke),q.compileShader(et),!q.getShaderParameter(et,q.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${q.getShaderInfoLog(et)}`);q.attachShader(this.program,et),this.attributes={};const vt={};this.numAttributes=ne.length;for(let gt=0;gt<this.numAttributes;gt++)ne[gt]&&(q.bindAttribLocation(this.program,gt,ne[gt]),this.attributes[ne[gt]]=gt);if(q.linkProgram(this.program),!q.getProgramParameter(this.program,q.LINK_STATUS))throw new Error(`Program failed to link: ${q.getProgramInfoLog(this.program)}`);q.deleteShader(et),q.deleteShader(at);for(let gt=0;gt<ze.length;gt++){const Dt=ze[gt];if(Dt&&!vt[Dt]){const Bt=q.getUniformLocation(this.program,Dt);Bt&&(vt[Dt]=Bt)}}this.fixedUniforms=_(c,vt),this.terrainUniforms=((gt,Dt)=>({u_depth:new a.bF(gt,Dt.u_depth),u_terrain:new a.bF(gt,Dt.u_terrain),u_terrain_dim:new a.b8(gt,Dt.u_terrain_dim),u_terrain_matrix:new a.bH(gt,Dt.u_terrain_matrix),u_terrain_unpack:new a.bI(gt,Dt.u_terrain_unpack),u_terrain_exaggeration:new a.b8(gt,Dt.u_terrain_exaggeration)}))(c,vt),this.projectionUniforms=((gt,Dt)=>({u_projection_matrix:new a.bH(gt,Dt.u_projection_matrix),u_projection_tile_mercator_coords:new a.bI(gt,Dt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new a.bI(gt,Dt.u_projection_clipping_plane),u_projection_transition:new a.b8(gt,Dt.u_projection_transition),u_projection_fallback_matrix:new a.bH(gt,Dt.u_projection_fallback_matrix)}))(c,vt),this.binderUniforms=b?b.getUniforms(c,vt):[]}draw(c,f,b,_,T,I,z,U,q,J,se,ne,pe,ye,De,Ee,Le,ze,We){const Qe=c.gl;if(this.failedToCreate)return;if(c.program.set(this.program),c.setDepthMode(b),c.setStencilMode(_),c.setColorMode(T),c.setCullFace(I),U){c.activeTexture.set(Qe.TEXTURE2),Qe.bindTexture(Qe.TEXTURE_2D,U.depthTexture),c.activeTexture.set(Qe.TEXTURE3),Qe.bindTexture(Qe.TEXTURE_2D,U.texture);for(const at in this.terrainUniforms)this.terrainUniforms[at].set(U[at])}if(q)for(const at in q)this.projectionUniforms[qL[at]].set(q[at]);if(z)for(const at in this.fixedUniforms)this.fixedUniforms[at].set(z[at]);Ee&&Ee.setUniforms(c,this.binderUniforms,ye,{zoom:De});let Ke=0;switch(f){case Qe.LINES:Ke=2;break;case Qe.TRIANGLES:Ke=3;break;case Qe.LINE_STRIP:Ke=1}for(const at of pe.get()){const et=at.vaos||(at.vaos={});(et[J]||(et[J]=new Mx)).bind(c,this,se,Ee?Ee.getPaintVertexBuffers():[],ne,at.vertexOffset,Le,ze,We),Qe.drawElements(f,at.primitiveLength*Ke,Qe.UNSIGNED_SHORT,at.primitiveOffset*Ke*2)}}}function pf(S,c,f){const b=1/a.aw(f,1,c.transform.tileZoom),_=Math.pow(2,f.tileID.overscaledZ),T=f.tileSize*Math.pow(2,c.transform.tileZoom)/_,I=T*(f.tileID.canonical.x+f.tileID.wrap*_),z=T*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[b,S.fromScale,S.toScale],u_fade:S.t,u_pixel_coord_upper:[I>>16,z>>16],u_pixel_coord_lower:[65535&I,65535&z]}}const fS=(S,c,f,b)=>{const _=S.style.light,T=_.properties.get("position"),I=[T.x,T.y,T.z],z=a.bL();_.properties.get("anchor")==="viewport"&&a.bM(z,S.transform.bearingInRadians),a.bN(I,I,z);const U=S.transform.transformLightDirection(I),q=_.properties.get("color");return{u_lightpos:I,u_lightpos_globe:U,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[q.r,q.g,q.b],u_vertical_gradient:+c,u_opacity:f,u_fill_translate:b}},gv=(S,c,f,b,_,T,I)=>a.e(fS(S,c,f,b),pf(T,S,I),{u_height_factor:-Math.pow(2,_.overscaledZ)/I.tileSize/8}),pS=(S,c,f,b)=>a.e(pf(c,S,f),{u_fill_translate:b}),mf=(S,c)=>({u_world:S,u_fill_translate:c}),jL=(S,c,f,b,_)=>a.e(pS(S,c,f,_),{u_world:b}),mS=(S,c,f,b,_)=>{const T=S.transform;let I,z,U=0;if(f.paint.get("circle-pitch-alignment")==="map"){const q=a.aw(c,1,T.zoom);I=!0,z=[q,q],U=q/(a.Z*Math.pow(2,c.tileID.overscaledZ))*2*Math.PI*_}else I=!1,z=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+I,u_device_pixel_ratio:S.pixelRatio,u_extrude_scale:z,u_globe_extrude_scale:U,u_translate:b}},QL=S=>({u_pixel_extrude_scale:[1/S.width,1/S.height]}),gS=S=>({u_viewport_size:[S.width,S.height]}),vv=(S,c=1)=>({u_color:S,u_overlay:0,u_overlay_scale:c}),Tx=(S,c,f,b)=>{const _=a.aw(S,1,c)/(a.Z*Math.pow(2,S.tileID.overscaledZ))*2*Math.PI*b;return{u_extrude_scale:a.aw(S,1,c),u_intensity:f,u_globe_extrude_scale:_}},Rx=(S,c,f,b)=>{const _=a.K();a.bO(_,0,S.width,S.height,0,0,1);const T=S.context.gl;return{u_matrix:_,u_world:[T.drawingBufferWidth,T.drawingBufferHeight],u_image:f,u_color_ramp:b,u_opacity:c.paint.get("heatmap-opacity")}},vS=(S,c,f)=>{const b=f.paint.get("hillshade-shadow-color"),_=f.paint.get("hillshade-highlight-color"),T=f.paint.get("hillshade-accent-color");let I=f.paint.get("hillshade-illumination-direction")*(Math.PI/180);return f.paint.get("hillshade-illumination-anchor")==="viewport"&&(I+=S.transform.bearingInRadians),{u_image:0,u_latrange:Wh(0,c.tileID),u_light:[f.paint.get("hillshade-exaggeration"),I],u_shadow:b,u_highlight:_,u_accent:T}},yS=(S,c)=>{const f=c.stride,b=a.K();return a.bO(b,0,a.Z,-8192,0,0,1),a.L(b,b,[0,-8192,0]),{u_matrix:b,u_image:1,u_dimension:[f,f],u_zoom:S.overscaledZ,u_unpack:c.getUnpackVector()}};function Wh(S,c){const f=Math.pow(2,c.canonical.z),b=c.canonical.y;return[new a.$(0,b/f).toLngLat().lat,new a.$(0,(b+1)/f).toLngLat().lat]}const yv=(S,c,f,b)=>{const _=S.transform;return{u_translation:bS(S,c,f),u_ratio:b/a.aw(c,1,_.zoom),u_device_pixel_ratio:S.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},xS=(S,c,f,b,_)=>a.e(yv(S,c,f,b),{u_image:0,u_image_height:_}),Yp=(S,c,f,b,_)=>{const T=S.transform,I=Jp(c,T);return{u_translation:bS(S,c,f),u_texsize:c.imageAtlasTexture.size,u_ratio:b/a.aw(c,1,T.zoom),u_device_pixel_ratio:S.pixelRatio,u_image:0,u_scale:[I,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},ZL=(S,c,f,b,_,T)=>{const I=S.lineAtlas,z=Jp(c,S.transform),U=f.layout.get("line-cap")==="round",q=I.getDash(_.from,U),J=I.getDash(_.to,U),se=q.width*T.fromScale,ne=J.width*T.toScale;return a.e(yv(S,c,f,b),{u_patternscale_a:[z/se,-q.height/2],u_patternscale_b:[z/ne,-J.height/2],u_sdfgamma:I.width/(256*Math.min(se,ne)*S.pixelRatio)/2,u_image:0,u_tex_y_a:q.y,u_tex_y_b:J.y,u_mix:T.t})};function Jp(S,c){return 1/a.aw(S,1,c.tileZoom)}function bS(S,c,f){return a.ax(S.transform,c,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const XL=(S,c,f,b,_)=>{return{u_tl_parent:S,u_scale_parent:c,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(I=b.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(T=b.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:wS(b.paint.get("raster-hue-rotate")),u_coords_top:[_[0].x,_[0].y,_[1].x,_[1].y],u_coords_bottom:[_[3].x,_[3].y,_[2].x,_[2].y]};var T,I};function wS(S){S*=Math.PI/180;const c=Math.sin(S),f=Math.cos(S);return[(2*f+1)/3,(-Math.sqrt(3)*c-f+1)/3,(Math.sqrt(3)*c-f+1)/3]}const Px=(S,c,f,b,_,T,I,z,U,q,J,se,ne)=>{const pe=I.transform;return{u_is_size_zoom_constant:+(S==="constant"||S==="source"),u_is_size_feature_constant:+(S==="constant"||S==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:pe.cameraToCenterDistance,u_pitch:pe.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:pe.width/pe.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_label_plane_matrix:z,u_coord_matrix:U,u_is_text:+J,u_pitch_with_map:+b,u_is_along_line:_,u_is_variable_anchor:T,u_texsize:se,u_texture:0,u_translation:q,u_pitched_scale:ne}},Ex=(S,c,f,b,_,T,I,z,U,q,J,se,ne,pe)=>{const ye=I.transform;return a.e(Px(S,c,f,b,_,T,I,z,U,q,J,se,pe),{u_gamma_scale:b?Math.cos(ye.pitch*Math.PI/180)*ye.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:1})},Ax=(S,c,f,b,_,T,I,z,U,q,J,se,ne)=>a.e(Ex(S,c,f,b,_,T,I,z,U,q,!0,J,0,ne),{u_texsize_icon:se,u_texture_icon:1}),_S=(S,c)=>({u_opacity:S,u_color:c}),xv=(S,c,f,b,_)=>a.e(function(T,I,z,U){const q=z.imageManager.getPattern(T.from.toString()),J=z.imageManager.getPattern(T.to.toString()),{width:se,height:ne}=z.imageManager.getPixelSize(),pe=Math.pow(2,U.tileID.overscaledZ),ye=U.tileSize*Math.pow(2,z.transform.tileZoom)/pe,De=ye*(U.tileID.canonical.x+U.tileID.wrap*pe),Ee=ye*U.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:q.tl,u_pattern_br_a:q.br,u_pattern_tl_b:J.tl,u_pattern_br_b:J.br,u_texsize:[se,ne],u_mix:I.t,u_pattern_size_a:q.displaySize,u_pattern_size_b:J.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/a.aw(U,1,z.transform.tileZoom),u_pixel_coord_upper:[De>>16,Ee>>16],u_pixel_coord_lower:[65535&De,65535&Ee]}}(f,_,c,b),{u_opacity:S}),uc=(S,c)=>{},Ix={fillExtrusion:(S,c)=>({u_lightpos:new a.bJ(S,c.u_lightpos),u_lightpos_globe:new a.bJ(S,c.u_lightpos_globe),u_lightintensity:new a.b8(S,c.u_lightintensity),u_lightcolor:new a.bJ(S,c.u_lightcolor),u_vertical_gradient:new a.b8(S,c.u_vertical_gradient),u_opacity:new a.b8(S,c.u_opacity),u_fill_translate:new a.bK(S,c.u_fill_translate)}),fillExtrusionPattern:(S,c)=>({u_lightpos:new a.bJ(S,c.u_lightpos),u_lightpos_globe:new a.bJ(S,c.u_lightpos_globe),u_lightintensity:new a.b8(S,c.u_lightintensity),u_lightcolor:new a.bJ(S,c.u_lightcolor),u_vertical_gradient:new a.b8(S,c.u_vertical_gradient),u_height_factor:new a.b8(S,c.u_height_factor),u_opacity:new a.b8(S,c.u_opacity),u_fill_translate:new a.bK(S,c.u_fill_translate),u_image:new a.bF(S,c.u_image),u_texsize:new a.bK(S,c.u_texsize),u_pixel_coord_upper:new a.bK(S,c.u_pixel_coord_upper),u_pixel_coord_lower:new a.bK(S,c.u_pixel_coord_lower),u_scale:new a.bJ(S,c.u_scale),u_fade:new a.b8(S,c.u_fade)}),fill:(S,c)=>({u_fill_translate:new a.bK(S,c.u_fill_translate)}),fillPattern:(S,c)=>({u_image:new a.bF(S,c.u_image),u_texsize:new a.bK(S,c.u_texsize),u_pixel_coord_upper:new a.bK(S,c.u_pixel_coord_upper),u_pixel_coord_lower:new a.bK(S,c.u_pixel_coord_lower),u_scale:new a.bJ(S,c.u_scale),u_fade:new a.b8(S,c.u_fade),u_fill_translate:new a.bK(S,c.u_fill_translate)}),fillOutline:(S,c)=>({u_world:new a.bK(S,c.u_world),u_fill_translate:new a.bK(S,c.u_fill_translate)}),fillOutlinePattern:(S,c)=>({u_world:new a.bK(S,c.u_world),u_image:new a.bF(S,c.u_image),u_texsize:new a.bK(S,c.u_texsize),u_pixel_coord_upper:new a.bK(S,c.u_pixel_coord_upper),u_pixel_coord_lower:new a.bK(S,c.u_pixel_coord_lower),u_scale:new a.bJ(S,c.u_scale),u_fade:new a.b8(S,c.u_fade),u_fill_translate:new a.bK(S,c.u_fill_translate)}),circle:(S,c)=>({u_camera_to_center_distance:new a.b8(S,c.u_camera_to_center_distance),u_scale_with_map:new a.bF(S,c.u_scale_with_map),u_pitch_with_map:new a.bF(S,c.u_pitch_with_map),u_extrude_scale:new a.bK(S,c.u_extrude_scale),u_device_pixel_ratio:new a.b8(S,c.u_device_pixel_ratio),u_globe_extrude_scale:new a.b8(S,c.u_globe_extrude_scale),u_translate:new a.bK(S,c.u_translate)}),collisionBox:(S,c)=>({u_pixel_extrude_scale:new a.bK(S,c.u_pixel_extrude_scale)}),collisionCircle:(S,c)=>({u_viewport_size:new a.bK(S,c.u_viewport_size)}),debug:(S,c)=>({u_color:new a.bG(S,c.u_color),u_overlay:new a.bF(S,c.u_overlay),u_overlay_scale:new a.b8(S,c.u_overlay_scale)}),depth:uc,clippingMask:uc,heatmap:(S,c)=>({u_extrude_scale:new a.b8(S,c.u_extrude_scale),u_intensity:new a.b8(S,c.u_intensity),u_globe_extrude_scale:new a.b8(S,c.u_globe_extrude_scale)}),heatmapTexture:(S,c)=>({u_matrix:new a.bH(S,c.u_matrix),u_world:new a.bK(S,c.u_world),u_image:new a.bF(S,c.u_image),u_color_ramp:new a.bF(S,c.u_color_ramp),u_opacity:new a.b8(S,c.u_opacity)}),hillshade:(S,c)=>({u_image:new a.bF(S,c.u_image),u_latrange:new a.bK(S,c.u_latrange),u_light:new a.bK(S,c.u_light),u_shadow:new a.bG(S,c.u_shadow),u_highlight:new a.bG(S,c.u_highlight),u_accent:new a.bG(S,c.u_accent)}),hillshadePrepare:(S,c)=>({u_matrix:new a.bH(S,c.u_matrix),u_image:new a.bF(S,c.u_image),u_dimension:new a.bK(S,c.u_dimension),u_zoom:new a.b8(S,c.u_zoom),u_unpack:new a.bI(S,c.u_unpack)}),line:(S,c)=>({u_translation:new a.bK(S,c.u_translation),u_ratio:new a.b8(S,c.u_ratio),u_device_pixel_ratio:new a.b8(S,c.u_device_pixel_ratio),u_units_to_pixels:new a.bK(S,c.u_units_to_pixels)}),lineGradient:(S,c)=>({u_translation:new a.bK(S,c.u_translation),u_ratio:new a.b8(S,c.u_ratio),u_device_pixel_ratio:new a.b8(S,c.u_device_pixel_ratio),u_units_to_pixels:new a.bK(S,c.u_units_to_pixels),u_image:new a.bF(S,c.u_image),u_image_height:new a.b8(S,c.u_image_height)}),linePattern:(S,c)=>({u_translation:new a.bK(S,c.u_translation),u_texsize:new a.bK(S,c.u_texsize),u_ratio:new a.b8(S,c.u_ratio),u_device_pixel_ratio:new a.b8(S,c.u_device_pixel_ratio),u_image:new a.bF(S,c.u_image),u_units_to_pixels:new a.bK(S,c.u_units_to_pixels),u_scale:new a.bJ(S,c.u_scale),u_fade:new a.b8(S,c.u_fade)}),lineSDF:(S,c)=>({u_translation:new a.bK(S,c.u_translation),u_ratio:new a.b8(S,c.u_ratio),u_device_pixel_ratio:new a.b8(S,c.u_device_pixel_ratio),u_units_to_pixels:new a.bK(S,c.u_units_to_pixels),u_patternscale_a:new a.bK(S,c.u_patternscale_a),u_patternscale_b:new a.bK(S,c.u_patternscale_b),u_sdfgamma:new a.b8(S,c.u_sdfgamma),u_image:new a.bF(S,c.u_image),u_tex_y_a:new a.b8(S,c.u_tex_y_a),u_tex_y_b:new a.b8(S,c.u_tex_y_b),u_mix:new a.b8(S,c.u_mix)}),raster:(S,c)=>({u_tl_parent:new a.bK(S,c.u_tl_parent),u_scale_parent:new a.b8(S,c.u_scale_parent),u_buffer_scale:new a.b8(S,c.u_buffer_scale),u_fade_t:new a.b8(S,c.u_fade_t),u_opacity:new a.b8(S,c.u_opacity),u_image0:new a.bF(S,c.u_image0),u_image1:new a.bF(S,c.u_image1),u_brightness_low:new a.b8(S,c.u_brightness_low),u_brightness_high:new a.b8(S,c.u_brightness_high),u_saturation_factor:new a.b8(S,c.u_saturation_factor),u_contrast_factor:new a.b8(S,c.u_contrast_factor),u_spin_weights:new a.bJ(S,c.u_spin_weights),u_coords_top:new a.bI(S,c.u_coords_top),u_coords_bottom:new a.bI(S,c.u_coords_bottom)}),symbolIcon:(S,c)=>({u_is_size_zoom_constant:new a.bF(S,c.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bF(S,c.u_is_size_feature_constant),u_size_t:new a.b8(S,c.u_size_t),u_size:new a.b8(S,c.u_size),u_camera_to_center_distance:new a.b8(S,c.u_camera_to_center_distance),u_pitch:new a.b8(S,c.u_pitch),u_rotate_symbol:new a.bF(S,c.u_rotate_symbol),u_aspect_ratio:new a.b8(S,c.u_aspect_ratio),u_fade_change:new a.b8(S,c.u_fade_change),u_label_plane_matrix:new a.bH(S,c.u_label_plane_matrix),u_coord_matrix:new a.bH(S,c.u_coord_matrix),u_is_text:new a.bF(S,c.u_is_text),u_pitch_with_map:new a.bF(S,c.u_pitch_with_map),u_is_along_line:new a.bF(S,c.u_is_along_line),u_is_variable_anchor:new a.bF(S,c.u_is_variable_anchor),u_texsize:new a.bK(S,c.u_texsize),u_texture:new a.bF(S,c.u_texture),u_translation:new a.bK(S,c.u_translation),u_pitched_scale:new a.b8(S,c.u_pitched_scale)}),symbolSDF:(S,c)=>({u_is_size_zoom_constant:new a.bF(S,c.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bF(S,c.u_is_size_feature_constant),u_size_t:new a.b8(S,c.u_size_t),u_size:new a.b8(S,c.u_size),u_camera_to_center_distance:new a.b8(S,c.u_camera_to_center_distance),u_pitch:new a.b8(S,c.u_pitch),u_rotate_symbol:new a.bF(S,c.u_rotate_symbol),u_aspect_ratio:new a.b8(S,c.u_aspect_ratio),u_fade_change:new a.b8(S,c.u_fade_change),u_label_plane_matrix:new a.bH(S,c.u_label_plane_matrix),u_coord_matrix:new a.bH(S,c.u_coord_matrix),u_is_text:new a.bF(S,c.u_is_text),u_pitch_with_map:new a.bF(S,c.u_pitch_with_map),u_is_along_line:new a.bF(S,c.u_is_along_line),u_is_variable_anchor:new a.bF(S,c.u_is_variable_anchor),u_texsize:new a.bK(S,c.u_texsize),u_texture:new a.bF(S,c.u_texture),u_gamma_scale:new a.b8(S,c.u_gamma_scale),u_device_pixel_ratio:new a.b8(S,c.u_device_pixel_ratio),u_is_halo:new a.bF(S,c.u_is_halo),u_translation:new a.bK(S,c.u_translation),u_pitched_scale:new a.b8(S,c.u_pitched_scale)}),symbolTextAndIcon:(S,c)=>({u_is_size_zoom_constant:new a.bF(S,c.u_is_size_zoom_constant),u_is_size_feature_constant:new a.bF(S,c.u_is_size_feature_constant),u_size_t:new a.b8(S,c.u_size_t),u_size:new a.b8(S,c.u_size),u_camera_to_center_distance:new a.b8(S,c.u_camera_to_center_distance),u_pitch:new a.b8(S,c.u_pitch),u_rotate_symbol:new a.bF(S,c.u_rotate_symbol),u_aspect_ratio:new a.b8(S,c.u_aspect_ratio),u_fade_change:new a.b8(S,c.u_fade_change),u_label_plane_matrix:new a.bH(S,c.u_label_plane_matrix),u_coord_matrix:new a.bH(S,c.u_coord_matrix),u_is_text:new a.bF(S,c.u_is_text),u_pitch_with_map:new a.bF(S,c.u_pitch_with_map),u_is_along_line:new a.bF(S,c.u_is_along_line),u_is_variable_anchor:new a.bF(S,c.u_is_variable_anchor),u_texsize:new a.bK(S,c.u_texsize),u_texsize_icon:new a.bK(S,c.u_texsize_icon),u_texture:new a.bF(S,c.u_texture),u_texture_icon:new a.bF(S,c.u_texture_icon),u_gamma_scale:new a.b8(S,c.u_gamma_scale),u_device_pixel_ratio:new a.b8(S,c.u_device_pixel_ratio),u_is_halo:new a.bF(S,c.u_is_halo),u_translation:new a.bK(S,c.u_translation),u_pitched_scale:new a.b8(S,c.u_pitched_scale)}),background:(S,c)=>({u_opacity:new a.b8(S,c.u_opacity),u_color:new a.bG(S,c.u_color)}),backgroundPattern:(S,c)=>({u_opacity:new a.b8(S,c.u_opacity),u_image:new a.bF(S,c.u_image),u_pattern_tl_a:new a.bK(S,c.u_pattern_tl_a),u_pattern_br_a:new a.bK(S,c.u_pattern_br_a),u_pattern_tl_b:new a.bK(S,c.u_pattern_tl_b),u_pattern_br_b:new a.bK(S,c.u_pattern_br_b),u_texsize:new a.bK(S,c.u_texsize),u_mix:new a.b8(S,c.u_mix),u_pattern_size_a:new a.bK(S,c.u_pattern_size_a),u_pattern_size_b:new a.bK(S,c.u_pattern_size_b),u_scale_a:new a.b8(S,c.u_scale_a),u_scale_b:new a.b8(S,c.u_scale_b),u_pixel_coord_upper:new a.bK(S,c.u_pixel_coord_upper),u_pixel_coord_lower:new a.bK(S,c.u_pixel_coord_lower),u_tile_units_to_pixels:new a.b8(S,c.u_tile_units_to_pixels)}),terrain:(S,c)=>({u_texture:new a.bF(S,c.u_texture),u_ele_delta:new a.b8(S,c.u_ele_delta),u_fog_matrix:new a.bH(S,c.u_fog_matrix),u_fog_color:new a.bG(S,c.u_fog_color),u_fog_ground_blend:new a.b8(S,c.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.b8(S,c.u_fog_ground_blend_opacity),u_horizon_color:new a.bG(S,c.u_horizon_color),u_horizon_fog_blend:new a.b8(S,c.u_horizon_fog_blend),u_is_globe_mode:new a.b8(S,c.u_is_globe_mode)}),terrainDepth:(S,c)=>({u_ele_delta:new a.b8(S,c.u_ele_delta)}),terrainCoords:(S,c)=>({u_texture:new a.bF(S,c.u_texture),u_terrain_coords_id:new a.b8(S,c.u_terrain_coords_id),u_ele_delta:new a.b8(S,c.u_ele_delta)}),projectionErrorMeasurement:(S,c)=>({u_input:new a.b8(S,c.u_input),u_output_expected:new a.b8(S,c.u_output_expected)}),atmosphere:(S,c)=>({u_sun_pos:new a.bJ(S,c.u_sun_pos),u_atmosphere_blend:new a.b8(S,c.u_atmosphere_blend),u_globe_position:new a.bJ(S,c.u_globe_position),u_globe_radius:new a.b8(S,c.u_globe_radius),u_inv_proj_matrix:new a.bH(S,c.u_inv_proj_matrix)}),sky:(S,c)=>({u_sky_color:new a.bG(S,c.u_sky_color),u_horizon_color:new a.bG(S,c.u_horizon_color),u_horizon:new a.bK(S,c.u_horizon),u_horizon_normal:new a.bK(S,c.u_horizon_normal),u_sky_horizon_blend:new a.b8(S,c.u_sky_horizon_blend),u_sky_blend:new a.b8(S,c.u_sky_blend)})};class kx{constructor(c,f,b){this.context=c;const _=c.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!b,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Dx={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class CS{constructor(c,f,b,_){this.length=f.length,this.attributes=b,this.itemSize=f.bytesPerElement,this.dynamicDraw=_,this.context=c;const T=c.gl;this.buffer=T.createBuffer(),c.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){if(c.length!==this.length)throw new Error(`Length of new data is ${c.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,f){for(let b=0;b<this.attributes.length;b++){const _=f.attributes[this.attributes[b].name];_!==void 0&&c.enableVertexAttribArray(_)}}setVertexAttribPointers(c,f,b){for(let _=0;_<this.attributes.length;_++){const T=this.attributes[_],I=f.attributes[T.name];I!==void 0&&c.vertexAttribPointer(I,T.components,c[Dx[T.type]],!1,this.itemSize,T.offset+this.itemSize*(b||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class tr{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qh extends tr{getDefault(){return a.b7.transparent}set(c){const f=this.current;(c.r!==f.r||c.g!==f.g||c.b!==f.b||c.a!==f.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Lx extends tr{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class KL extends tr{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class YL extends tr{getDefault(){return[!0,!0,!0,!0]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||c[3]!==f[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class JL extends tr{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class e2 extends tr{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class SS extends tr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const f=this.current;(c.func!==f.func||c.ref!==f.ref||c.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class t2 extends tr{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class OS extends tr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=c,this.dirty=!1}}class bv extends tr{getDefault(){return[0,1]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class wv extends tr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=c,this.dirty=!1}}class _v extends tr{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class Fx extends tr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.BLEND):f.disable(f.BLEND),this.current=c,this.dirty=!1}}class jh extends tr{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class gf extends tr{getDefault(){return a.b7.transparent}set(c){const f=this.current;(c.r!==f.r||c.g!==f.g||c.b!==f.b||c.a!==f.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Ja extends tr{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class MS extends tr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=c,this.dirty=!1}}class TS extends tr{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class Nx extends tr{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}class Qh extends tr{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}}class Cv extends tr{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Sv extends tr{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||c[3]!==f[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class em extends tr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class Ov extends tr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class RS extends tr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class vf extends tr{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class yf extends tr{getDefault(){return null}set(c){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class PS extends tr{getDefault(){return null}set(c){var f;if(c===this.current&&!this.dirty)return;const b=this.gl;Tl(b)?b.bindVertexArray(c):(f=b.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(c),this.current=c,this.dirty=!1}}class Bx extends tr{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class Zn extends tr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class Mv extends tr{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class zx extends tr{constructor(c,f){super(c),this.context=c,this.parent=f}getDefault(){return null}}class ES extends zx{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class tm extends zx{set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class i2 extends zx{set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,c),this.current=c,this.dirty=!1}}const AS="Framebuffer is not complete";class IS{constructor(c,f,b,_,T){this.context=c,this.width=f,this.height=b;const I=c.gl,z=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new ES(c,z),_)this.depthAttachment=T?new i2(c,z):new tm(c,z);else if(T)throw new Error("Stencil cannot be set without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error(AS)}destroy(){const c=this.context.gl,f=this.colorAttachment.get();if(f&&c.deleteTexture(f),this.depthAttachment){const b=this.depthAttachment.get();b&&c.deleteRenderbuffer(b)}c.deleteFramebuffer(this.framebuffer)}}class n2{constructor(c){var f,b;if(this.gl=c,this.clearColor=new qh(this),this.clearDepth=new Lx(this),this.clearStencil=new KL(this),this.colorMask=new YL(this),this.depthMask=new JL(this),this.stencilMask=new e2(this),this.stencilFunc=new SS(this),this.stencilOp=new t2(this),this.stencilTest=new OS(this),this.depthRange=new bv(this),this.depthTest=new wv(this),this.depthFunc=new _v(this),this.blend=new Fx(this),this.blendFunc=new jh(this),this.blendColor=new gf(this),this.blendEquation=new Ja(this),this.cullFace=new MS(this),this.cullFaceSide=new TS(this),this.frontFace=new Nx(this),this.program=new Qh(this),this.activeTexture=new Cv(this),this.viewport=new Sv(this),this.bindFramebuffer=new em(this),this.bindRenderbuffer=new Ov(this),this.bindTexture=new RS(this),this.bindVertexBuffer=new vf(this),this.bindElementBuffer=new yf(this),this.bindVertexArray=new PS(this),this.pixelStoreUnpack=new Bx(this),this.pixelStoreUnpackPremultiplyAlpha=new Zn(this),this.pixelStoreUnpackFlipY=new Mv(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE),Tl(c)){this.HALF_FLOAT=c.HALF_FLOAT;const _=c.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=c.RGBA16F)!==null&&f!==void 0?f:_?.RGBA16F_EXT,this.RGB16F=(b=c.RGB16F)!==null&&b!==void 0?b:_?.RGB16F_EXT,c.getExtension("EXT_color_buffer_float")}else{c.getExtension("EXT_color_buffer_half_float"),c.getExtension("OES_texture_half_float_linear");const _=c.getExtension("OES_texture_half_float");this.HALF_FLOAT=_?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,f){return new kx(this,c,f)}createVertexBuffer(c,f,b){return new CS(this,c,f,b)}createRenderbuffer(c,f,b){const _=this.gl,T=_.createRenderbuffer();return this.bindRenderbuffer.set(T),_.renderbufferStorage(_.RENDERBUFFER,c,f,b),this.bindRenderbuffer.set(null),T}createFramebuffer(c,f,b,_){return new IS(this,c,f,b,_)}clear({color:c,depth:f,stencil:b}){const _=this.gl;let T=0;c&&(T|=_.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(T|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),b!==void 0&&(T|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(b),this.stencilMask.set(255)),_.clear(T)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){a.bC(c.blendFunction,Mr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}createVertexArray(){var c;return Tl(this.gl)?this.gl.createVertexArray():(c=this.gl.getExtension("OES_vertex_array_object"))===null||c===void 0?void 0:c.createVertexArrayOES()}deleteVertexArray(c){var f;return Tl(this.gl)?this.gl.deleteVertexArray(c):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(c)}unbindVAO(){this.bindVertexArray.set(null)}}let xf;function im(S,c,f,b,_){const T=S.context,I=S.transform,z=T.gl,U=S.useProgram("collisionBox"),q=[];let J=0,se=0;for(let Le=0;Le<b.length;Le++){const ze=b[Le],We=c.getTile(ze).getBucket(f);if(!We)continue;const Qe=_?We.textCollisionBox:We.iconCollisionBox,Ke=We.collisionCircleArray;Ke.length>0&&(q.push({circleArray:Ke,circleOffset:se,coord:ze}),J+=Ke.length/4,se=J),Qe&&U.draw(T,z.LINES,xn.disabled,Vn.disabled,S.colorModeForRenderPass(),er.disabled,QL(S.transform),S.style.map.terrain&&S.style.map.terrain.getTerrainData(ze),I.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),f.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,S.transform.zoom,null,null,Qe.collisionVertexBuffer)}if(!_||!q.length)return;const ne=S.useProgram("collisionCircle"),pe=new a.bP;pe.resize(4*J),pe._trim();let ye=0;for(const Le of q)for(let ze=0;ze<Le.circleArray.length/4;ze++){const We=4*ze,Qe=Le.circleArray[We+0],Ke=Le.circleArray[We+1],at=Le.circleArray[We+2],et=Le.circleArray[We+3];pe.emplace(ye++,Qe,Ke,at,et,0),pe.emplace(ye++,Qe,Ke,at,et,1),pe.emplace(ye++,Qe,Ke,at,et,2),pe.emplace(ye++,Qe,Ke,at,et,3)}(!xf||xf.length<2*J)&&(xf=function(Le){const ze=2*Le,We=new a.bR;We.resize(ze),We._trim();for(let Qe=0;Qe<ze;Qe++){const Ke=6*Qe;We.uint16[Ke+0]=4*Qe+0,We.uint16[Ke+1]=4*Qe+1,We.uint16[Ke+2]=4*Qe+2,We.uint16[Ke+3]=4*Qe+2,We.uint16[Ke+4]=4*Qe+3,We.uint16[Ke+5]=4*Qe+0}return We}(J));const De=T.createIndexBuffer(xf,!0),Ee=T.createVertexBuffer(pe,a.bQ.members,!0);for(const Le of q){const ze=gS(S.transform);ne.draw(T,z.TRIANGLES,xn.disabled,Vn.disabled,S.colorModeForRenderPass(),er.disabled,ze,S.style.map.terrain&&S.style.map.terrain.getTerrainData(Le.coord),null,f.id,Ee,De,a.aG.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,S.transform.zoom,null,null,null)}Ee.destroy(),De.destroy()}const Tv=a.at(new Float32Array(16));function Vx(S,c,f,b,_,T){const{horizontalAlign:I,verticalAlign:z}=a.aB(S);return new a.P((-(I-.5)*c/_+b[0])*T,(-(z-.5)*f/_+b[1])*T)}function Gx(S,c,f,b,_,T){const I=c.tileAnchorPoint.add(new a.P(c.translation[0],c.translation[1]));if(c.pitchWithMap){let z=b.mult(T);f||(z=z.rotate(-_));const U=I.add(z);return ut(U.x,U.y,c.pitchedLabelPlaneMatrix,c.getElevation).point}if(f){const z=Pn(c.tileAnchorPoint.x+1,c.tileAnchorPoint.y,c).point.sub(S),U=Math.atan(z.y/z.x)+(z.x<0?Math.PI:0);return S.add(b.rotate(U))}return S.add(b)}function kS(S,c,f,b,_,T,I,z,U,q,J,se){const ne=S.text.placedSymbolArray,pe=S.text.dynamicLayoutVertexArray,ye=S.icon.dynamicLayoutVertexArray,De={};pe.clear();for(let Ee=0;Ee<ne.length;Ee++){const Le=ne.get(Ee),ze=Le.hidden||!Le.crossTileID||S.allowVerticalPlacement&&!Le.placedOrientation?null:b[Le.crossTileID];if(ze){const We=new a.P(Le.anchorX,Le.anchorY),Qe={getElevation:se,width:_.width,height:_.height,pitchedLabelPlaneMatrix:T,pitchWithMap:f,transform:_,tileAnchorPoint:We,translation:q,unwrappedTileID:J},Ke=f?Oi(We.x,We.y,Qe):Pn(We.x,We.y,Qe),at=lt(_.cameraToCenterDistance,Ke.signedDistanceFromCamera);let et=a.ai(S.textSizeData,z,Le)*at/a.av;f&&(et*=S.tilePixelRatio/I);const{width:vt,height:gt,anchor:Dt,textOffset:Bt,textBoxScale:It}=ze,di=Vx(Dt,vt,gt,Bt,It,et),ui=_.getPitchedTextCorrection(We.x+q[0],We.y+q[1],J),Ht=Gx(Ke.point,Qe,c,di,-_.bearingInRadians,ui),Ri=S.allowVerticalPlacement&&Le.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let vn=0;vn<Le.numGlyphs;vn++)a.ao(pe,Ht,Ri);U&&Le.associatedIconIndex>=0&&(De[Le.associatedIconIndex]={shiftedAnchor:Ht,angle:Ri})}else Qi(Le.numGlyphs,pe)}if(U){ye.clear();const Ee=S.icon.placedSymbolArray;for(let Le=0;Le<Ee.length;Le++){const ze=Ee.get(Le);if(ze.hidden)Qi(ze.numGlyphs,ye);else{const We=De[Le];if(We)for(let Qe=0;Qe<ze.numGlyphs;Qe++)a.ao(ye,We.shiftedAnchor,We.angle);else Qi(ze.numGlyphs,ye)}}S.icon.dynamicLayoutVertexBuffer.updateData(ye)}S.text.dynamicLayoutVertexBuffer.updateData(pe)}function Rv(S,c,f){return f.iconsInText&&c?"symbolTextAndIcon":S?"symbolSDF":"symbolIcon"}function nm(S,c,f,b,_,T,I,z,U,q,J,se,ne){const pe=S.context,ye=pe.gl,De=S.transform,Ee=z==="map",Le=U==="map",ze=z!=="viewport"&&f.layout.get("symbol-placement")!=="point",We=Ee&&!Le&&!ze,Qe=!f.layout.get("symbol-sort-key").isConstant();let Ke=!1;const at=S.getDepthModeForSublayer(0,xn.ReadOnly),et=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),vt=[],gt=De.getCircleRadiusCorrection();for(const Dt of b){const Bt=c.getTile(Dt),It=Bt.getBucket(f);if(!It)continue;const di=_?It.text:It.icon;if(!di||!di.segments.get().length||!di.hasVisibleVertices)continue;const ui=di.programConfigurations.get(f.id),Ht=_||It.sdfIcons,Ri=_?It.textSizeData:It.iconSizeData,vn=Le||De.pitch!==0,rr=S.useProgram(Rv(Ht,_,It),ui),bn=a.ag(Ri,De.zoom),pr=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Dt);let Cr,Rr,hr,mr,ms=[0,0],Ls=null;if(_)Rr=Bt.glyphAtlasTexture,hr=ye.LINEAR,Cr=Bt.glyphAtlasTexture.size,It.iconsInText&&(ms=Bt.imageAtlasTexture.size,Ls=Bt.imageAtlasTexture,mr=vn||S.options.rotating||S.options.zooming||Ri.kind==="composite"||Ri.kind==="camera"?ye.LINEAR:ye.NEAREST);else{const qr=f.layout.get("icon-size").constantOr(0)!==1||It.iconsNeedLinear;Rr=Bt.imageAtlasTexture,hr=Ht||S.options.rotating||S.options.zooming||qr||vn?ye.LINEAR:ye.NEAREST,Cr=Bt.imageAtlasTexture.size}const Ws=a.aw(Bt,1,S.transform.zoom),ta=Ae(Ee,S.transform,Ws),nu=a.K();a.aj(nu,ta);const pc=ke(Le,Ee,S.transform,Ws),Nu=a.ax(De,Bt,T,I),Bu=De.getProjectionData({overscaledTileID:Dt,applyGlobeMatrix:!ne,applyTerrainMatrix:!0}),id=et&&It.hasTextData(),mc=f.layout.get("icon-text-fit")!=="none"&&id&&It.hasIconData();if(ze){const qr=S.style.map.terrain?(Cs,_r)=>S.style.map.terrain.getElevation(Dt,Cs,_r):null,jr=f.layout.get("text-rotation-alignment")==="map";zt(It,S,_,ta,nu,Le,q,jr,Dt.toUnwrapped(),De.width,De.height,Nu,qr)}const ru=_&&et||mc,_a=ze||ru?Tv:Le?ta:S.transform.clipSpaceToPixelsMatrix,su=Ht&&f.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let nd;nd=Ht?It.iconsInText?Ax(Ri.kind,bn,We,Le,ze,ru,S,_a,pc,Nu,Cr,ms,gt):Ex(Ri.kind,bn,We,Le,ze,ru,S,_a,pc,Nu,_,Cr,0,gt):Px(Ri.kind,bn,We,Le,ze,ru,S,_a,pc,Nu,_,Cr,gt);const rd={program:rr,buffers:di,uniformValues:nd,projectionData:Bu,atlasTexture:Rr,atlasTextureIcon:Ls,atlasInterpolation:hr,atlasInterpolationIcon:mr,isSDF:Ht,hasHalo:su};if(Qe&&It.canOverlap){Ke=!0;const qr=di.segments.get();for(const jr of qr)vt.push({segments:new a.aG([jr]),sortKey:jr.sortKey,state:rd,terrainData:pr})}else vt.push({segments:di.segments,sortKey:0,state:rd,terrainData:pr})}Ke&&vt.sort((Dt,Bt)=>Dt.sortKey-Bt.sortKey);for(const Dt of vt){const Bt=Dt.state;if(pe.activeTexture.set(ye.TEXTURE0),Bt.atlasTexture.bind(Bt.atlasInterpolation,ye.CLAMP_TO_EDGE),Bt.atlasTextureIcon&&(pe.activeTexture.set(ye.TEXTURE1),Bt.atlasTextureIcon&&Bt.atlasTextureIcon.bind(Bt.atlasInterpolationIcon,ye.CLAMP_TO_EDGE)),Bt.isSDF){const It=Bt.uniformValues;Bt.hasHalo&&(It.u_is_halo=1,Pv(Bt.buffers,Dt.segments,f,S,Bt.program,at,J,se,It,Bt.projectionData,Dt.terrainData)),It.u_is_halo=0}Pv(Bt.buffers,Dt.segments,f,S,Bt.program,at,J,se,Bt.uniformValues,Bt.projectionData,Dt.terrainData)}}function Pv(S,c,f,b,_,T,I,z,U,q,J){const se=b.context;_.draw(se,se.gl.TRIANGLES,T,I,z,er.backCCW,U,J,q,f.id,S.layoutVertexBuffer,S.indexBuffer,c,f.paint,b.transform.zoom,S.programConfigurations.get(f.id),S.dynamicLayoutVertexBuffer,S.opacityVertexBuffer)}function r2(S,c,f,b,_){const T=S.context,I=T.gl,z=Vn.disabled,U=new Mr([I.ONE,I.ONE],a.b7.transparent,[!0,!0,!0,!0]),q=c.getBucket(f);if(!q)return;const J=b.key;let se=f.heatmapFbos.get(J);se||(se=DS(T,c.tileSize,c.tileSize),f.heatmapFbos.set(J,se)),T.bindFramebuffer.set(se.framebuffer),T.viewport.set([0,0,c.tileSize,c.tileSize]),T.clear({color:a.b7.transparent});const ne=q.programConfigurations.get(f.id),pe=S.useProgram("heatmap",ne,!_),ye=S.transform.getProjectionData({overscaledTileID:c.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),De=S.style.map.terrain.getTerrainData(b);pe.draw(T,I.TRIANGLES,xn.disabled,z,U,er.disabled,Tx(c,S.transform.zoom,f.paint.get("heatmap-intensity"),1),De,ye,f.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,f.paint,S.transform.zoom,ne)}function Ux(S,c,f,b,_){const T=S.context,I=T.gl,z=S.transform;T.setColorMode(S.colorModeForRenderPass());const U=Hx(T,c),q=f.key,J=c.heatmapFbos.get(q);if(!J)return;T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,J.colorAttachment.get()),T.activeTexture.set(I.TEXTURE1),U.bind(I.LINEAR,I.CLAMP_TO_EDGE);const se=z.getProjectionData({overscaledTileID:f,applyTerrainMatrix:_,applyGlobeMatrix:!b});S.useProgram("heatmapTexture").draw(T,I.TRIANGLES,xn.disabled,Vn.disabled,S.colorModeForRenderPass(),er.disabled,Rx(S,c,0,1),null,se,c.id,S.rasterBoundsBuffer,S.quadTriangleIndexBuffer,S.rasterBoundsSegments,c.paint,z.zoom),J.destroy(),c.heatmapFbos.delete(q)}function DS(S,c,f){var b,_;const T=S.gl,I=T.createTexture();T.bindTexture(T.TEXTURE_2D,I),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.LINEAR);const z=(b=S.HALF_FLOAT)!==null&&b!==void 0?b:T.UNSIGNED_BYTE,U=(_=S.RGBA16F)!==null&&_!==void 0?_:T.RGBA;T.texImage2D(T.TEXTURE_2D,0,U,c,f,0,T.RGBA,z,null);const q=S.createFramebuffer(c,f,!1,!1);return q.colorAttachment.set(I),q}function Hx(S,c){return c.colorRampTexture||(c.colorRampTexture=new Y(S,c.colorRamp,S.gl.RGBA)),c.colorRampTexture}function rm(S,c,f,b,_){if(!f||!b||!b.imageAtlas)return;const T=b.imageAtlas.patternPositions;let I=T[f.to.toString()],z=T[f.from.toString()];if(!I&&z&&(I=z),!z&&I&&(z=I),!I||!z){const U=_.getPaintProperty(c);I=T[U],z=T[U]}I&&z&&S.setConstantPatternPositions(I,z)}function Ev(S,c,f,b,_,T,I,z){const U=S.context.gl,q="fill-pattern",J=f.paint.get(q),se=J&&J.constantOr(1),ne=f.getCrossfadeParameters();let pe,ye,De,Ee,Le;const ze=S.transform,We=f.paint.get("fill-translate"),Qe=f.paint.get("fill-translate-anchor");I?(ye=se&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",pe=U.LINES):(ye=se?"fillPattern":"fill",pe=U.TRIANGLES);const Ke=J.constantOr(null);for(const at of b){const et=c.getTile(at);if(se&&!et.patternsLoaded())continue;const vt=et.getBucket(f);if(!vt)continue;const gt=vt.programConfigurations.get(f.id),Dt=S.useProgram(ye,gt),Bt=S.style.map.terrain&&S.style.map.terrain.getTerrainData(at);se&&(S.context.activeTexture.set(U.TEXTURE0),et.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),gt.updatePaintBuffers(ne)),rm(gt,q,Ke,et,f);const It=ze.getProjectionData({overscaledTileID:at,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),di=a.ax(ze,et,We,Qe);if(I){Ee=vt.indexBuffer2,Le=vt.segments2;const Ht=[U.drawingBufferWidth,U.drawingBufferHeight];De=ye==="fillOutlinePattern"&&se?jL(S,ne,et,Ht,di):mf(Ht,di)}else Ee=vt.indexBuffer,Le=vt.segments,De=se?pS(S,ne,et,di):{u_fill_translate:di};let ui;if(S.renderPass==="translucent"&&z){const[Ht]=S.getStencilConfigForOverlapAndUpdateStencilID(b);ui=Ht[at.overscaledZ]}else ui=S.stencilModeForClipping(at);Dt.draw(S.context,pe,_,ui,T,er.backCCW,De,Bt,It,f.id,vt.layoutVertexBuffer,Ee,Le,f.paint,S.transform.zoom,gt)}}function Av(S,c,f,b,_,T,I,z){const U=S.context,q=U.gl,J="fill-extrusion-pattern",se=f.paint.get(J),ne=se.constantOr(1),pe=f.getCrossfadeParameters(),ye=f.paint.get("fill-extrusion-opacity"),De=se.constantOr(null),Ee=S.transform;for(const Le of b){const ze=c.getTile(Le),We=ze.getBucket(f);if(!We)continue;const Qe=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Le),Ke=We.programConfigurations.get(f.id),at=S.useProgram(ne?"fillExtrusionPattern":"fillExtrusion",Ke);ne&&(S.context.activeTexture.set(q.TEXTURE0),ze.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Ke.updatePaintBuffers(pe));const et=Ee.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!z,applyTerrainMatrix:!0});rm(Ke,J,De,ze,f);const vt=a.ax(Ee,ze,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),gt=f.paint.get("fill-extrusion-vertical-gradient"),Dt=ne?gv(S,gt,ye,vt,Le,pe,ze):fS(S,gt,ye,vt);at.draw(U,U.gl.TRIANGLES,_,T,I,er.backCCW,Dt,Qe,et,f.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,f.paint,S.transform.zoom,Ke,S.style.map.terrain&&We.centroidVertexBuffer)}}function Iv(S,c,f,b,_,T,I,z,U){var q;const J=S.style.projection,se=S.context,ne=S.transform,pe=se.gl,ye=S.useProgram("hillshade"),De=!S.options.moving;for(const Ee of b){const Le=c.getTile(Ee),ze=Le.fbo;if(!ze)continue;const We=J.getMeshFromTileID(se,Ee.canonical,z,!0,"raster"),Qe=(q=S.style.map.terrain)===null||q===void 0?void 0:q.getTerrainData(Ee);se.activeTexture.set(pe.TEXTURE0),pe.bindTexture(pe.TEXTURE_2D,ze.colorAttachment.get());const Ke=ne.getProjectionData({overscaledTileID:Ee,aligned:De,applyGlobeMatrix:!U,applyTerrainMatrix:!0});ye.draw(se,pe.TRIANGLES,T,_[Ee.overscaledZ],I,er.backCCW,vS(S,Le,f),Qe,Ke,f.id,We.vertexBuffer,We.indexBuffer,We.segments)}}const bf=[new a.P(0,0),new a.P(a.Z,0),new a.P(a.Z,a.Z),new a.P(0,a.Z)];function wf(S,c,f,b,_,T,I,z,U=!1,q=!1){const J=b[b.length-1].overscaledZ,se=S.context,ne=se.gl,pe=S.useProgram("raster"),ye=S.transform,De=S.style.projection,Ee=S.colorModeForRenderPass(),Le=!S.options.moving;for(const ze of b){const We=S.getDepthModeForSublayer(ze.overscaledZ-J,f.paint.get("raster-opacity")===1?xn.ReadWrite:xn.ReadOnly,ne.LESS),Qe=c.getTile(ze);Qe.registerFadeDuration(f.paint.get("raster-fade-duration"));const Ke=c.findLoadedParent(ze,0),at=c.findLoadedSibling(ze),et=s2(Qe,Ke||at||null,c,f,S.transform,S.style.map.terrain);let vt,gt;const Dt=f.paint.get("raster-resampling")==="nearest"?ne.NEAREST:ne.LINEAR;se.activeTexture.set(ne.TEXTURE0),Qe.texture.bind(Dt,ne.CLAMP_TO_EDGE,ne.LINEAR_MIPMAP_NEAREST),se.activeTexture.set(ne.TEXTURE1),Ke?(Ke.texture.bind(Dt,ne.CLAMP_TO_EDGE,ne.LINEAR_MIPMAP_NEAREST),vt=Math.pow(2,Ke.tileID.overscaledZ-Qe.tileID.overscaledZ),gt=[Qe.tileID.canonical.x*vt%1,Qe.tileID.canonical.y*vt%1]):Qe.texture.bind(Dt,ne.CLAMP_TO_EDGE,ne.LINEAR_MIPMAP_NEAREST),Qe.texture.useMipmap&&se.extTextureFilterAnisotropic&&S.transform.pitch>20&&ne.texParameterf(ne.TEXTURE_2D,se.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,se.extTextureFilterAnisotropicMax);const Bt=S.style.map.terrain&&S.style.map.terrain.getTerrainData(ze),It=ye.getProjectionData({overscaledTileID:ze,aligned:Le,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),di=XL(gt||[0,0],vt||1,et,f,z),ui=De.getMeshFromTileID(se,ze.canonical,T,I,"raster");pe.draw(se,ne.TRIANGLES,We,_?_[ze.overscaledZ]:Vn.disabled,Ee,U?er.frontCCW:er.backCCW,di,Bt,It,f.id,ui.vertexBuffer,ui.indexBuffer,ui.segments)}}function s2(S,c,f,b,_,T){const I=b.paint.get("raster-fade-duration");if(!T&&I>0){const z=v.now(),U=(z-S.timeAdded)/I,q=c?(z-c.timeAdded)/I:-1,J=f.getSource(),se=nt(_,{tileSize:J.tileSize,roundZoom:J.roundZoom}),ne=!c||Math.abs(c.tileID.overscaledZ-se)>Math.abs(S.tileID.overscaledZ-se),pe=ne&&S.refreshedUponExpiration?1:a.ae(ne?U:1-q,0,1);return S.refreshedUponExpiration&&U>=1&&(S.refreshedUponExpiration=!1),c?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}const LS=new a.b7(1,0,0,1),rs=new a.b7(0,1,0,1),Zh=new a.b7(0,0,1,1),el=new a.b7(1,0,1,1),$x=new a.b7(0,1,1,1);function kv(S,c,f,b){tu(S,0,c+f/2,S.transform.width,f,b)}function Wx(S,c,f,b){tu(S,c-f/2,0,f,S.transform.height,b)}function tu(S,c,f,b,_,T){const I=S.context,z=I.gl;z.enable(z.SCISSOR_TEST),z.scissor(c*S.pixelRatio,f*S.pixelRatio,b*S.pixelRatio,_*S.pixelRatio),I.clear({color:T}),z.disable(z.SCISSOR_TEST)}function sm(S,c,f){const b=S.context,_=b.gl,T=S.useProgram("debug"),I=xn.disabled,z=Vn.disabled,U=S.colorModeForRenderPass(),q="$debug",J=S.style.map.terrain&&S.style.map.terrain.getTerrainData(f);b.activeTexture.set(_.TEXTURE0);const se=c.getTileByID(f.key).latestRawTileData,ne=Math.floor((se&&se.byteLength||0)/1024),pe=c.getTile(f).tileSize,ye=512/Math.min(pe,512)*(f.overscaledZ/S.transform.zoom)*.5;let De=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(De+=` => ${f.overscaledZ}`),function(Le,ze){Le.initDebugOverlayCanvas();const We=Le.debugOverlayCanvas,Qe=Le.context.gl,Ke=Le.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,We.width,We.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText(ze,5,5),Ke.strokeText(ze,5,5),Le.debugOverlayTexture.update(We),Le.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)}(S,`${De} ${ne}kB`);const Ee=S.transform.getProjectionData({overscaledTileID:f,applyGlobeMatrix:!0,applyTerrainMatrix:!0});T.draw(b,_.TRIANGLES,I,z,Mr.alphaBlended,er.disabled,vv(a.b7.transparent,ye),null,Ee,q,S.debugBuffer,S.quadTriangleIndexBuffer,S.debugSegments),T.draw(b,_.LINE_STRIP,I,z,U,er.disabled,vv(a.b7.red),J,Ee,q,S.debugBuffer,S.tileBorderIndexBuffer,S.debugSegments)}function Dv(S,c,f,b){const{isRenderingGlobe:_}=b,T=S.context,I=T.gl,z=S.transform,U=S.colorModeForRenderPass(),q=S.getDepthModeFor3D(),J=S.useProgram("terrain");T.bindFramebuffer.set(null),T.viewport.set([0,0,S.width,S.height]);for(const se of f){const ne=c.getTerrainMesh(se.tileID),pe=S.renderToTexture.getTexture(se),ye=c.getTerrainData(se.tileID);T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,pe.texture);const De=c.getMeshFrameDelta(z.zoom),Ee=z.calculateFogMatrix(se.tileID.toUnwrapped()),Le=cc(De,Ee,S.style.sky,z.pitch,_),ze=z.getProjectionData({overscaledTileID:se.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});J.draw(T,I.TRIANGLES,q,Vn.disabled,U,er.backCCW,Le,ye,ze,"terrain",ne.vertexBuffer,ne.indexBuffer,ne.segments)}}function qx(S,c){if(!c.mesh){const f=new a.aF;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(1,1),f.emplaceBack(-1,1);const b=new a.aH;b.emplaceBack(0,1,2),b.emplaceBack(0,2,3),c.mesh=new lr(S.createVertexBuffer(f,ps.members),S.createIndexBuffer(b),a.aG.simpleSegment(0,0,f.length,b.length))}return c.mesh}class FS{constructor(c,f){this.context=new n2(c),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.at(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=oe.maxUnderzooming+oe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new bo}resize(c,f,b){if(this.width=Math.floor(c*b),this.height=Math.floor(f*b),this.pixelRatio=b,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const c=this.context,f=new a.aF;f.emplaceBack(0,0),f.emplaceBack(a.Z,0),f.emplaceBack(0,a.Z),f.emplaceBack(a.Z,a.Z),this.tileExtentBuffer=c.createVertexBuffer(f,ps.members),this.tileExtentSegments=a.aG.simpleSegment(0,0,4,2);const b=new a.aF;b.emplaceBack(0,0),b.emplaceBack(a.Z,0),b.emplaceBack(0,a.Z),b.emplaceBack(a.Z,a.Z),this.debugBuffer=c.createVertexBuffer(b,ps.members),this.debugSegments=a.aG.simpleSegment(0,0,4,5);const _=new a.bW;_.emplaceBack(0,0,0,0),_.emplaceBack(a.Z,0,a.Z,0),_.emplaceBack(0,a.Z,0,a.Z),_.emplaceBack(a.Z,a.Z,a.Z,a.Z),this.rasterBoundsBuffer=c.createVertexBuffer(_,Ox.members),this.rasterBoundsSegments=a.aG.simpleSegment(0,0,4,2);const T=new a.aF;T.emplaceBack(0,0),T.emplaceBack(a.Z,0),T.emplaceBack(0,a.Z),T.emplaceBack(a.Z,a.Z),this.rasterBoundsBufferPosOnly=c.createVertexBuffer(T,ps.members),this.rasterBoundsSegmentsPosOnly=a.aG.simpleSegment(0,0,4,5);const I=new a.aF;I.emplaceBack(0,0),I.emplaceBack(1,0),I.emplaceBack(0,1),I.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(I,ps.members),this.viewportSegments=a.aG.simpleSegment(0,0,4,2);const z=new a.bX;z.emplaceBack(0),z.emplaceBack(1),z.emplaceBack(3),z.emplaceBack(2),z.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(z);const U=new a.aH;U.emplaceBack(1,0,2),U.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(U);const q=this.context.gl;this.stencilClearMode=new Vn({func:q.ALWAYS,mask:0},0,255,q.ZERO,q.ZERO,q.ZERO),this.tileExtentMesh=new lr(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const c=this.context,f=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const b=a.K();a.bO(b,0,this.width,this.height,0,0,1),a.M(b,b,[f.drawingBufferWidth,f.drawingBufferHeight,0]);const _={mainMatrix:b,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:b};this.useProgram("clippingMask",null,!0).draw(c,f.TRIANGLES,xn.disabled,this.stencilClearMode,Mr.disabled,er.disabled,null,null,_,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(c,f,b){if(this.currentStencilSource===c.source||!c.isTileClipped()||!f||!f.length)return;this.currentStencilSource=c.source,this.nextStencilID+f.length>256&&this.clearStencil();const _=this.context;_.setColorMode(Mr.disabled),_.setDepthMode(xn.disabled);const T={};for(const I of f)T[I.key]=this.nextStencilID++;this._renderTileMasks(T,f,b,!0),this._renderTileMasks(T,f,b,!1),this._tileClippingMaskIDs=T}_renderTileMasks(c,f,b,_){const T=this.context,I=T.gl,z=this.style.projection,U=this.transform,q=this.useProgram("clippingMask");for(const J of f){const se=c[J.key],ne=this.style.map.terrain&&this.style.map.terrain.getTerrainData(J),pe=z.getMeshFromTileID(this.context,J.canonical,_,!0,"stencil"),ye=U.getProjectionData({overscaledTileID:J,applyGlobeMatrix:!0,applyTerrainMatrix:!0});q.draw(T,I.TRIANGLES,xn.disabled,new Vn({func:I.ALWAYS,mask:0},se,255,I.KEEP,I.KEEP,I.REPLACE),Mr.disabled,b?er.disabled:er.backCCW,null,ne,ye,"$clipping",pe.vertexBuffer,pe.indexBuffer,pe.segments)}}_renderTilesDepthBuffer(){const c=this.context,f=c.gl,b=this.style.projection,_=this.transform,T=this.useProgram("depth"),I=this.getDepthModeFor3D(),z=Ce(_,{tileSize:_.tileSize});for(const U of z){const q=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U),J=b.getMeshFromTileID(this.context,U.canonical,!0,!0,"raster"),se=_.getProjectionData({overscaledTileID:U,applyGlobeMatrix:!0,applyTerrainMatrix:!0});T.draw(c,f.TRIANGLES,I,Vn.disabled,Mr.disabled,er.backCCW,null,q,se,"$clipping",J.vertexBuffer,J.indexBuffer,J.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,f=this.context.gl;return new Vn({func:f.NOTEQUAL,mask:255},c,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(c){const f=this.context.gl;return new Vn({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,f.KEEP,f.KEEP,f.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(c){const f=this.context.gl,b=c.sort((I,z)=>z.overscaledZ-I.overscaledZ),_=b[b.length-1].overscaledZ,T=b[0].overscaledZ-_+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const I={};for(let z=0;z<T;z++)I[z+_]=new Vn({func:f.GEQUAL,mask:255},z+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=T,[I,b]}return[{[_]:Vn.disabled},b]}stencilConfigForOverlapTwoPass(c){const f=this.context.gl,b=c.sort((I,z)=>z.overscaledZ-I.overscaledZ),_=b[b.length-1].overscaledZ,T=b[0].overscaledZ-_+1;if(this.clearStencil(),T>1){const I={},z={};for(let U=0;U<T;U++)I[U+_]=new Vn({func:f.GREATER,mask:255},T+1+U,255,f.KEEP,f.KEEP,f.REPLACE),z[U+_]=new Vn({func:f.GREATER,mask:255},1+U,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID=2*T+1,[I,z,b]}return this.nextStencilID=3,[{[_]:new Vn({func:f.GREATER,mask:255},2,255,f.KEEP,f.KEEP,f.REPLACE)},{[_]:new Vn({func:f.GREATER,mask:255},1,255,f.KEEP,f.KEEP,f.REPLACE)},b]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new Mr([c.CONSTANT_COLOR,c.ONE],new a.b7(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mr.unblended:Mr.alphaBlended}getDepthModeForSublayer(c,f,b){if(!this.opaquePassEnabledForLayer())return xn.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new xn(b||this.context.gl.LEQUAL,f,[_,_])}getDepthModeFor3D(){return new xn(this.context.gl.LEQUAL,xn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,f){var b,_;this.style=c,this.options=f,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(v.now()),this.imageManager.beginFrame();const T=this.style._order,I=this.style.sourceCaches,z={},U={},q={},J={isRenderingToTexture:!1,isRenderingGlobe:((b=c.projection)===null||b===void 0?void 0:b.transitionState)>0};for(const ne in I){const pe=I[ne];pe.used&&pe.prepare(this.context),z[ne]=pe.getVisibleCoordinates(!1),U[ne]=z[ne].slice().reverse(),q[ne]=pe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ne=0;ne<T.length;ne++)if(this.style._layers[T[ne]].is3D()){this.opaquePassCutoff=ne;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const ne of T){const pe=this.style._layers[ne];if(!pe.hasOffscreenPass()||pe.isHidden(this.transform.zoom))continue;const ye=U[pe.source];(pe.type==="custom"||ye.length)&&this.renderLayer(this,I[pe.source],pe,ye,J)}if((_=this.style.projection)===null||_===void 0||_.updateGPUdependent({context:this.context,useProgram:ne=>this.useProgram(ne)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?a.b7.black:a.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(ne,pe){const ye=ne.context,De=ye.gl,Ee=((at,et,vt)=>{const gt=Math.cos(et.rollInRadians),Dt=Math.sin(et.rollInRadians),Bt=of(et),It=et.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:at.properties.get("sky-color"),u_horizon_color:at.properties.get("horizon-color"),u_horizon:[(et.width/2-Bt*Dt)*vt,(et.height/2+Bt*gt)*vt],u_horizon_normal:[-Dt,gt],u_sky_horizon_blend:at.properties.get("sky-horizon-blend")*et.height/2*vt,u_sky_blend:It}})(pe,ne.style.map.transform,ne.pixelRatio),Le=new xn(De.LEQUAL,xn.ReadWrite,[0,1]),ze=Vn.disabled,We=ne.colorModeForRenderPass(),Qe=ne.useProgram("sky"),Ke=qx(ye,pe);Qe.draw(ye,De.TRIANGLES,Le,ze,We,er.disabled,Ee,null,void 0,"sky",Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)}(this,this.style.sky),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const ne=this.style._layers[T[this.currentLayer]],pe=I[ne.source],ye=z[ne.source];this._renderTileClippingMasks(ne,ye,!1),this.renderLayer(this,pe,ne,ye,J)}this.renderPass="translucent";let se=!1;for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const ne=this.style._layers[T[this.currentLayer]],pe=I[ne.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(ne,J))continue;this.opaquePassEnabledForLayer()||se||(se=!0,J.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ye=(ne.type==="symbol"?q:U)[ne.source];this._renderTileClippingMasks(ne,z[ne.source],!1),this.renderLayer(this,pe,ne,ye,J)}if(J.isRenderingGlobe&&function(ne,pe,ye){const De=ne.context,Ee=De.gl,Le=ne.useProgram("atmosphere"),ze=new xn(Ee.LEQUAL,xn.ReadOnly,[0,1]),We=ne.transform,Qe=function(It,di){const ui=It.properties.get("position"),Ht=[-ui.x,-ui.y,-ui.z],Ri=a.at(new Float64Array(16));return It.properties.get("anchor")==="map"&&(a.a_(Ri,Ri,di.rollInRadians),a.a$(Ri,Ri,-di.pitchInRadians),a.a_(Ri,Ri,di.bearingInRadians),a.a$(Ri,Ri,di.center.lat*Math.PI/180),a.bm(Ri,Ri,-di.center.lng*Math.PI/180)),a.bV(Ht,Ht,Ri),Ht}(ye,ne.transform),Ke=We.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),at=pe.properties.get("atmosphere-blend")*Ke.projectionTransition;if(at===0)return;const et=fv(We.worldSize,We.center.lat),vt=We.inverseProjectionMatrix,gt=new Float64Array(4);gt[3]=1,a.ap(gt,gt,We.modelViewProjectionMatrix),gt[0]/=gt[3],gt[1]/=gt[3],gt[2]/=gt[3],gt[3]=1,a.ap(gt,gt,vt),gt[0]/=gt[3],gt[1]/=gt[3],gt[2]/=gt[3],gt[3]=1;const Dt=((It,di,ui,Ht,Ri)=>({u_sun_pos:It,u_atmosphere_blend:di,u_globe_position:ui,u_globe_radius:Ht,u_inv_proj_matrix:Ri}))(Qe,at,[gt[0],gt[1],gt[2]],et,vt),Bt=qx(De,pe);Le.draw(De,Ee.TRIANGLES,ze,Vn.disabled,Mr.alphaBlended,er.disabled,Dt,null,null,"atmosphere",Bt.vertexBuffer,Bt.indexBuffer,Bt.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const ne=function(pe,ye){let De=null;const Ee=Object.values(pe._layers).flatMap(Qe=>Qe.source&&!Qe.isHidden(ye)?[pe.sourceCaches[Qe.source]]:[]),Le=Ee.filter(Qe=>Qe.getSource().type==="vector"),ze=Ee.filter(Qe=>Qe.getSource().type!=="vector"),We=Qe=>{(!De||De.getSource().maxzoom<Qe.getSource().maxzoom)&&(De=Qe)};return Le.forEach(Qe=>We(Qe)),De||ze.forEach(Qe=>We(Qe)),De}(this.style,this.transform.zoom);ne&&function(pe,ye,De){for(let Ee=0;Ee<De.length;Ee++)sm(pe,ye,De[Ee])}(this,ne,ne.getVisibleCoordinates())}this.options.showPadding&&function(ne){const pe=ne.transform.padding;kv(ne,ne.transform.height-(pe.top||0),3,LS),kv(ne,pe.bottom||0,3,rs),Wx(ne,pe.left||0,3,Zh),Wx(ne,ne.transform.width-(pe.right||0),3,el);const ye=ne.transform.centerPoint;(function(De,Ee,Le,ze){tu(De,Ee-1,Le-10,2,20,ze),tu(De,Ee-10,Le-1,20,2,ze)})(ne,ye.x,ne.transform.height-ye.y,$x)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(c){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,b=this.transform.modelViewProjectionMatrix;let _=this.terrainFacilitator.dirty;_||(_=c?!a.bY(f,b):!a.bZ(f,b)),_||(_=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),_&&(a.b_(f,b),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(T,I){const z=T.context,U=z.gl,q=T.transform,J=Mr.unblended,se=new xn(U.LEQUAL,xn.ReadWrite,[0,1]),ne=I.sourceCache.getRenderableTiles(),pe=T.useProgram("terrainDepth");z.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),z.clear({color:a.b7.transparent,depth:1});for(const ye of ne){const De=I.getTerrainMesh(ye.tileID),Ee=I.getTerrainData(ye.tileID),Le=q.getProjectionData({overscaledTileID:ye.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ze={u_ele_delta:I.getMeshFrameDelta(q.zoom)};pe.draw(z,U.TRIANGLES,se,Vn.disabled,J,er.backCCW,ze,Ee,Le,"terrain",De.vertexBuffer,De.indexBuffer,De.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain),function(T,I){const z=T.context,U=z.gl,q=T.transform,J=Mr.unblended,se=new xn(U.LEQUAL,xn.ReadWrite,[0,1]),ne=I.getCoordsTexture(),pe=I.sourceCache.getRenderableTiles(),ye=T.useProgram("terrainCoords");z.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),z.clear({color:a.b7.transparent,depth:1}),I.coordsIndex=[];for(const De of pe){const Ee=I.getTerrainMesh(De.tileID),Le=I.getTerrainData(De.tileID);z.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,ne.texture);const ze={u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(q.zoom)},We=q.getProjectionData({overscaledTileID:De.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ye.draw(z,U.TRIANGLES,se,Vn.disabled,J,er.backCCW,ze,Le,We,"terrain",Ee.vertexBuffer,Ee.indexBuffer,Ee.segments),I.coordsIndex.push(De.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain))}renderLayer(c,f,b,_,T){b.isHidden(this.transform.zoom)||(b.type==="background"||b.type==="custom"||(_||[]).length)&&(this.id=b.id,a.b$(b)?function(I,z,U,q,J,se){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:ne}=se,pe=Vn.disabled,ye=I.colorModeForRenderPass();(U._unevaluatedLayout.hasValue("text-variable-anchor")||U._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(De,Ee,Le,ze,We,Qe,Ke,at,et){const vt=Ee.transform,gt=Ee.style.map.terrain,Dt=We==="map",Bt=Qe==="map";for(const It of De){const di=ze.getTile(It),ui=di.getBucket(Le);if(!ui||!ui.text||!ui.text.segments.get().length)continue;const Ht=a.ag(ui.textSizeData,vt.zoom),Ri=a.aw(di,1,Ee.transform.zoom),vn=Ae(Dt,Ee.transform,Ri),rr=Le.layout.get("icon-text-fit")!=="none"&&ui.hasIconData();if(Ht){const bn=Math.pow(2,vt.zoom-di.tileID.overscaledZ),pr=gt?(Cr,Rr)=>gt.getElevation(It,Cr,Rr):null;kS(ui,Dt,Bt,et,vt,vn,bn,Ht,rr,a.ax(vt,di,Ke,at),It.toUnwrapped(),pr)}}}(q,I,U,z,U.layout.get("text-rotation-alignment"),U.layout.get("text-pitch-alignment"),U.paint.get("text-translate"),U.paint.get("text-translate-anchor"),J),U.paint.get("icon-opacity").constantOr(1)!==0&&nm(I,z,U,q,!1,U.paint.get("icon-translate"),U.paint.get("icon-translate-anchor"),U.layout.get("icon-rotation-alignment"),U.layout.get("icon-pitch-alignment"),U.layout.get("icon-keep-upright"),pe,ye,ne),U.paint.get("text-opacity").constantOr(1)!==0&&nm(I,z,U,q,!0,U.paint.get("text-translate"),U.paint.get("text-translate-anchor"),U.layout.get("text-rotation-alignment"),U.layout.get("text-pitch-alignment"),U.layout.get("text-keep-upright"),pe,ye,ne),z.map.showCollisionBoxes&&(im(I,z,U,q,!0),im(I,z,U,q,!1))}(c,f,b,_,this.style.placement.variableOffsets,T):a.c0(b)?function(I,z,U,q,J){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:se}=J,ne=U.paint.get("circle-opacity"),pe=U.paint.get("circle-stroke-width"),ye=U.paint.get("circle-stroke-opacity"),De=!U.layout.get("circle-sort-key").isConstant();if(ne.constantOr(1)===0&&(pe.constantOr(1)===0||ye.constantOr(1)===0))return;const Ee=I.context,Le=Ee.gl,ze=I.transform,We=I.getDepthModeForSublayer(0,xn.ReadOnly),Qe=Vn.disabled,Ke=I.colorModeForRenderPass(),at=[],et=ze.getCircleRadiusCorrection();for(let vt=0;vt<q.length;vt++){const gt=q[vt],Dt=z.getTile(gt),Bt=Dt.getBucket(U);if(!Bt)continue;const It=U.paint.get("circle-translate"),di=U.paint.get("circle-translate-anchor"),ui=a.ax(ze,Dt,It,di),Ht=Bt.programConfigurations.get(U.id),Ri=I.useProgram("circle",Ht),vn=Bt.layoutVertexBuffer,rr=Bt.indexBuffer,bn=I.style.map.terrain&&I.style.map.terrain.getTerrainData(gt),pr={programConfiguration:Ht,program:Ri,layoutVertexBuffer:vn,indexBuffer:rr,uniformValues:mS(I,Dt,U,ui,et),terrainData:bn,projectionData:ze.getProjectionData({overscaledTileID:gt,applyGlobeMatrix:!se,applyTerrainMatrix:!0})};if(De){const Cr=Bt.segments.get();for(const Rr of Cr)at.push({segments:new a.aG([Rr]),sortKey:Rr.sortKey,state:pr})}else at.push({segments:Bt.segments,sortKey:0,state:pr})}De&&at.sort((vt,gt)=>vt.sortKey-gt.sortKey);for(const vt of at){const{programConfiguration:gt,program:Dt,layoutVertexBuffer:Bt,indexBuffer:It,uniformValues:di,terrainData:ui,projectionData:Ht}=vt.state;Dt.draw(Ee,Le.TRIANGLES,We,Qe,Ke,er.backCCW,di,ui,Ht,U.id,Bt,It,vt.segments,U.paint,I.transform.zoom,gt)}}(c,f,b,_,T):a.c1(b)?function(I,z,U,q,J){if(U.paint.get("heatmap-opacity")===0)return;const se=I.context,{isRenderingToTexture:ne,isRenderingGlobe:pe}=J;if(I.style.map.terrain){for(const ye of q){const De=z.getTile(ye);z.hasRenderableParent(ye)||(I.renderPass==="offscreen"?r2(I,De,U,ye,pe):I.renderPass==="translucent"&&Ux(I,U,ye,ne,pe))}se.viewport.set([0,0,I.width,I.height])}else I.renderPass==="offscreen"?function(ye,De,Ee,Le){const ze=ye.context,We=ze.gl,Qe=ye.transform,Ke=Vn.disabled,at=new Mr([We.ONE,We.ONE],a.b7.transparent,[!0,!0,!0,!0]);(function(et,vt,gt){const Dt=et.gl;et.activeTexture.set(Dt.TEXTURE1),et.viewport.set([0,0,vt.width/4,vt.height/4]);let Bt=gt.heatmapFbos.get(a.bS);Bt?(Dt.bindTexture(Dt.TEXTURE_2D,Bt.colorAttachment.get()),et.bindFramebuffer.set(Bt.framebuffer)):(Bt=DS(et,vt.width/4,vt.height/4),gt.heatmapFbos.set(a.bS,Bt))})(ze,ye,Ee),ze.clear({color:a.b7.transparent});for(let et=0;et<Le.length;et++){const vt=Le[et];if(De.hasRenderableParent(vt))continue;const gt=De.getTile(vt),Dt=gt.getBucket(Ee);if(!Dt)continue;const Bt=Dt.programConfigurations.get(Ee.id),It=ye.useProgram("heatmap",Bt),di=Qe.getProjectionData({overscaledTileID:vt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),ui=Qe.getCircleRadiusCorrection();It.draw(ze,We.TRIANGLES,xn.disabled,Ke,at,er.backCCW,Tx(gt,Qe.zoom,Ee.paint.get("heatmap-intensity"),ui),null,di,Ee.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Dt.segments,Ee.paint,Qe.zoom,Bt)}ze.viewport.set([0,0,ye.width,ye.height])}(I,z,U,q):I.renderPass==="translucent"&&function(ye,De){const Ee=ye.context,Le=Ee.gl;Ee.setColorMode(ye.colorModeForRenderPass());const ze=De.heatmapFbos.get(a.bS);ze&&(Ee.activeTexture.set(Le.TEXTURE0),Le.bindTexture(Le.TEXTURE_2D,ze.colorAttachment.get()),Ee.activeTexture.set(Le.TEXTURE1),Hx(Ee,De).bind(Le.LINEAR,Le.CLAMP_TO_EDGE),ye.useProgram("heatmapTexture").draw(Ee,Le.TRIANGLES,xn.disabled,Vn.disabled,ye.colorModeForRenderPass(),er.disabled,Rx(ye,De,0,1),null,null,De.id,ye.viewportBuffer,ye.quadTriangleIndexBuffer,ye.viewportSegments,De.paint,ye.transform.zoom))}(I,U)}(c,f,b,_,T):a.c2(b)?function(I,z,U,q,J){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:se}=J,ne=U.paint.get("line-opacity"),pe=U.paint.get("line-width");if(ne.constantOr(1)===0||pe.constantOr(1)===0)return;const ye=I.getDepthModeForSublayer(0,xn.ReadOnly),De=I.colorModeForRenderPass(),Ee=U.paint.get("line-dasharray"),Le=U.paint.get("line-pattern"),ze=Le.constantOr(1),We=U.paint.get("line-gradient"),Qe=U.getCrossfadeParameters(),Ke=ze?"linePattern":Ee?"lineSDF":We?"lineGradient":"line",at=I.context,et=at.gl,vt=I.transform;let gt=!0;for(const Dt of q){const Bt=z.getTile(Dt);if(ze&&!Bt.patternsLoaded())continue;const It=Bt.getBucket(U);if(!It)continue;const di=It.programConfigurations.get(U.id),ui=I.context.program.get(),Ht=I.useProgram(Ke,di),Ri=gt||Ht.program!==ui,vn=I.style.map.terrain&&I.style.map.terrain.getTerrainData(Dt),rr=Le.constantOr(null);if(rr&&Bt.imageAtlas){const hr=Bt.imageAtlas,mr=hr.patternPositions[rr.to.toString()],ms=hr.patternPositions[rr.from.toString()];mr&&ms&&di.setConstantPatternPositions(mr,ms)}const bn=vt.getProjectionData({overscaledTileID:Dt,applyGlobeMatrix:!se,applyTerrainMatrix:!0}),pr=vt.getPixelScale(),Cr=ze?Yp(I,Bt,U,pr,Qe):Ee?ZL(I,Bt,U,pr,Ee,Qe):We?xS(I,Bt,U,pr,It.lineClipsArray.length):yv(I,Bt,U,pr);if(ze)at.activeTexture.set(et.TEXTURE0),Bt.imageAtlasTexture.bind(et.LINEAR,et.CLAMP_TO_EDGE),di.updatePaintBuffers(Qe);else if(Ee&&(Ri||I.lineAtlas.dirty))at.activeTexture.set(et.TEXTURE0),I.lineAtlas.bind(at);else if(We){const hr=It.gradients[U.id];let mr=hr.texture;if(U.gradientVersion!==hr.version){let ms=256;if(U.stepInterpolant){const Ls=z.getSource().maxzoom,Ws=Dt.canonical.z===Ls?Math.ceil(1<<I.transform.maxZoom-Dt.canonical.z):1;ms=a.ae(a.bT(It.maxLineLength/a.Z*1024*Ws),256,at.maxTextureSize)}hr.gradient=a.bU({expression:U.gradientExpression(),evaluationKey:"lineProgress",resolution:ms,image:hr.gradient||void 0,clips:It.lineClipsArray}),hr.texture?hr.texture.update(hr.gradient):hr.texture=new Y(at,hr.gradient,et.RGBA),hr.version=U.gradientVersion,mr=hr.texture}at.activeTexture.set(et.TEXTURE0),mr.bind(U.stepInterpolant?et.NEAREST:et.LINEAR,et.CLAMP_TO_EDGE)}let Rr;if(se){const[hr]=I.getStencilConfigForOverlapAndUpdateStencilID(q);Rr=hr[Dt.overscaledZ]}else Rr=I.stencilModeForClipping(Dt);Ht.draw(at,et.TRIANGLES,ye,Rr,De,er.disabled,Cr,vn,bn,U.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,U.paint,I.transform.zoom,di,It.layoutVertexBuffer2),gt=!1}}(c,f,b,_,T):a.c3(b)?function(I,z,U,q,J){const se=U.paint.get("fill-color"),ne=U.paint.get("fill-opacity");if(ne.constantOr(1)===0)return;const{isRenderingToTexture:pe}=J,ye=I.colorModeForRenderPass(),De=U.paint.get("fill-pattern"),Ee=I.opaquePassEnabledForLayer()&&!De.constantOr(1)&&se.constantOr(a.b7.transparent).a===1&&ne.constantOr(0)===1?"opaque":"translucent";if(I.renderPass===Ee){const Le=I.getDepthModeForSublayer(1,I.renderPass==="opaque"?xn.ReadWrite:xn.ReadOnly);Ev(I,z,U,q,Le,ye,!1,pe)}if(I.renderPass==="translucent"&&U.paint.get("fill-antialias")){const Le=I.getDepthModeForSublayer(U.getPaintProperty("fill-outline-color")?2:0,xn.ReadOnly);Ev(I,z,U,q,Le,ye,!0,pe)}}(c,f,b,_,T):a.c4(b)?function(I,z,U,q,J){const se=U.paint.get("fill-extrusion-opacity");if(se===0)return;const{isRenderingToTexture:ne}=J;if(I.renderPass==="translucent"){const pe=new xn(I.context.gl.LEQUAL,xn.ReadWrite,I.depthRangeFor3D);if(se!==1||U.paint.get("fill-extrusion-pattern").constantOr(1))Av(I,z,U,q,pe,Vn.disabled,Mr.disabled,ne),Av(I,z,U,q,pe,I.stencilModeFor3D(),I.colorModeForRenderPass(),ne);else{const ye=I.colorModeForRenderPass();Av(I,z,U,q,pe,Vn.disabled,ye,ne)}}}(c,f,b,_,T):a.c5(b)?function(I,z,U,q,J){if(I.renderPass!=="offscreen"&&I.renderPass!=="translucent")return;const{isRenderingToTexture:se}=J,ne=I.context,pe=I.style.projection.useSubdivision,ye=I.getDepthModeForSublayer(0,xn.ReadOnly),De=I.colorModeForRenderPass();if(I.renderPass==="offscreen")(function(Ee,Le,ze,We,Qe,Ke,at){const et=Ee.context,vt=et.gl;for(const gt of ze){const Dt=Le.getTile(gt),Bt=Dt.dem;if(!Bt||!Bt.data||!Dt.needsHillshadePrepare)continue;const It=Bt.dim,di=Bt.stride,ui=Bt.getPixels();if(et.activeTexture.set(vt.TEXTURE1),et.pixelStoreUnpackPremultiplyAlpha.set(!1),Dt.demTexture=Dt.demTexture||Ee.getTileTexture(di),Dt.demTexture){const Ri=Dt.demTexture;Ri.update(ui,{premultiply:!1}),Ri.bind(vt.NEAREST,vt.CLAMP_TO_EDGE)}else Dt.demTexture=new Y(et,ui,vt.RGBA,{premultiply:!1}),Dt.demTexture.bind(vt.NEAREST,vt.CLAMP_TO_EDGE);et.activeTexture.set(vt.TEXTURE0);let Ht=Dt.fbo;if(!Ht){const Ri=new Y(et,{width:It,height:It,data:null},vt.RGBA);Ri.bind(vt.LINEAR,vt.CLAMP_TO_EDGE),Ht=Dt.fbo=et.createFramebuffer(It,It,!0,!1),Ht.colorAttachment.set(Ri.texture)}et.bindFramebuffer.set(Ht.framebuffer),et.viewport.set([0,0,It,It]),Ee.useProgram("hillshadePrepare").draw(et,vt.TRIANGLES,Qe,Ke,at,er.disabled,yS(Dt.tileID,Bt),null,null,We.id,Ee.rasterBoundsBuffer,Ee.quadTriangleIndexBuffer,Ee.rasterBoundsSegments),Dt.needsHillshadePrepare=!1}})(I,z,q,U,ye,Vn.disabled,De),ne.viewport.set([0,0,I.width,I.height]);else if(I.renderPass==="translucent")if(pe){const[Ee,Le,ze]=I.stencilConfigForOverlapTwoPass(q);Iv(I,z,U,ze,Ee,ye,De,!1,se),Iv(I,z,U,ze,Le,ye,De,!0,se)}else{const[Ee,Le]=I.getStencilConfigForOverlapAndUpdateStencilID(q);Iv(I,z,U,Le,Ee,ye,De,!1,se)}}(c,f,b,_,T):a.c6(b)?function(I,z,U,q,J){if(I.renderPass!=="translucent"||U.paint.get("raster-opacity")===0||!q.length)return;const{isRenderingToTexture:se}=J,ne=z.getSource(),pe=I.style.projection.useSubdivision;if(ne instanceof st)wf(I,z,U,q,null,!1,!1,ne.tileCoords,ne.flippedWindingOrder,se);else if(pe){const[ye,De,Ee]=I.stencilConfigForOverlapTwoPass(q);wf(I,z,U,Ee,ye,!1,!0,bf,!1,se),wf(I,z,U,Ee,De,!0,!0,bf,!1,se)}else{const[ye,De]=I.getStencilConfigForOverlapAndUpdateStencilID(q);wf(I,z,U,De,ye,!1,!0,bf,!1,se)}}(c,f,b,_,T):a.c7(b)?function(I,z,U,q,J){const se=U.paint.get("background-color"),ne=U.paint.get("background-opacity");if(ne===0)return;const{isRenderingToTexture:pe}=J,ye=I.context,De=ye.gl,Ee=I.style.projection,Le=I.transform,ze=Le.tileSize,We=U.paint.get("background-pattern");if(I.isPatternMissing(We))return;const Qe=!We&&se.a===1&&ne===1&&I.opaquePassEnabledForLayer()?"opaque":"translucent";if(I.renderPass!==Qe)return;const Ke=Vn.disabled,at=I.getDepthModeForSublayer(0,Qe==="opaque"?xn.ReadWrite:xn.ReadOnly),et=I.colorModeForRenderPass(),vt=I.useProgram(We?"backgroundPattern":"background"),gt=q||Ce(Le,{tileSize:ze,terrain:I.style.map.terrain});We&&(ye.activeTexture.set(De.TEXTURE0),I.imageManager.bind(I.context));const Dt=U.getCrossfadeParameters();for(const Bt of gt){const It=Le.getProjectionData({overscaledTileID:Bt,applyGlobeMatrix:!pe,applyTerrainMatrix:!0}),di=We?xv(ne,I,We,{tileID:Bt,tileSize:ze},Dt):_S(ne,se),ui=I.style.map.terrain&&I.style.map.terrain.getTerrainData(Bt),Ht=Ee.getMeshFromTileID(ye,Bt.canonical,!1,!0,"raster");vt.draw(ye,De.TRIANGLES,at,Ke,et,er.backCCW,di,ui,It,U.id,Ht.vertexBuffer,Ht.indexBuffer,Ht.segments)}}(c,0,b,_,T):a.c8(b)&&function(I,z,U,q){const{isRenderingGlobe:J}=q,se=I.context,ne=U.implementation,pe=I.style.projection,ye=I.transform,De=ye.getProjectionDataForCustomLayer(J),Ee={farZ:ye.farZ,nearZ:ye.nearZ,fov:ye.fov*Math.PI/180,modelViewProjectionMatrix:ye.modelViewProjectionMatrix,projectionMatrix:ye.projectionMatrix,shaderData:{variantName:pe.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${pe.shaderPreludeCode.vertexSource}`,define:pe.shaderDefine},defaultProjectionData:De},Le=ne.renderingMode?ne.renderingMode:"2d";if(I.renderPass==="offscreen"){const ze=ne.prerender;ze&&(I.setCustomLayerDefaults(),se.setColorMode(I.colorModeForRenderPass()),ze.call(ne,se.gl,Ee),se.setDirty(),I.setBaseState())}else if(I.renderPass==="translucent"){I.setCustomLayerDefaults(),se.setColorMode(I.colorModeForRenderPass()),se.setStencilMode(Vn.disabled);const ze=Le==="3d"?I.getDepthModeFor3D():I.getDepthModeForSublayer(0,xn.ReadOnly);se.setDepthMode(ze),ne.render(se.gl,Ee),se.setDirty(),I.setBaseState(),se.bindFramebuffer.set(null)}}(c,0,b,T))}saveTileTexture(c){const f=this._tileTextures[c.size[0]];f?f.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const f=this._tileTextures[c];return f&&f.length>0?f.pop():null}isPatternMissing(c){if(!c)return!1;if(!c.from||!c.to)return!0;const f=this.imageManager.getPattern(c.from.toString()),b=this.imageManager.getPattern(c.to.toString());return!f||!b}useProgram(c,f,b=!1){this.cache=this.cache||{};const _=!!this.style.map.terrain,T=this.style.projection,I=c+(f?f.cacheKey:"")+`/${b?ns:T.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"");return this.cache[I]||(this.cache[I]=new Kp(this.context,Ar[c],f,Ix[c],this._showOverdrawInspector,_,b?Ar.projectionMercator:T.shaderPreludeCode,b?is:T.shaderDefine)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Y(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:c,drawingBufferHeight:f}=this.context.gl;return this.width!==c||this.height!==f}}function jx(S,c){let f,b=!1,_=null,T=null;const I=()=>{_=null,b&&(S.apply(T,f),_=setTimeout(I,c),b=!1)};return(...z)=>(b=!0,T=this,f=z,_||I(),_)}class Qx{constructor(c){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let b;return f.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(b=_)}),(b&&b[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(!this._isValidHash(f))return!1;const b=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:b,pitch:+(f[4]||0)}),!0},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,f)},this._removeHash=()=>{const f=this._getCurrentHash();if(f.length===0)return;const b=f.join("/");let _=b;_.split("&").length>0&&(_=_.split("&")[0]),this._hashName&&(_=`${this._hashName}=${b}`);let T=window.location.hash.replace(_,"");T.startsWith("#&")?T=T.slice(0,1)+T.slice(2):T==="#"&&(T="");let I=window.location.href.replace(/(#.+)?$/,T);I=I.replace("&&","&"),window.history.replaceState(window.history.state,null,I)},this._updateHash=jx(this._updateHashUnthrottled,300),this._hashName=c&&encodeURIComponent(c)}addTo(c){return this._map=c,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(c){const f=this._map.getCenter(),b=Math.round(100*this._map.getZoom())/100,_=Math.ceil((b*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,_),I=Math.round(f.lng*T)/T,z=Math.round(f.lat*T)/T,U=this._map.getBearing(),q=this._map.getPitch();let J="";if(J+=c?`/${I}/${z}/${b}`:`${b}/${z}/${I}`,(U||q)&&(J+="/"+Math.round(10*U)/10),q&&(J+=`/${Math.round(q)}`),this._hashName){const se=this._hashName;let ne=!1;const pe=window.location.hash.slice(1).split("&").map(ye=>{const De=ye.split("=")[0];return De===se?(ne=!0,`${De}=${J}`):ye}).filter(ye=>ye);return ne||pe.push(`${se}=${J}`),`#${pe.join("&")}`}return`#${J}`}_isValidHash(c){if(c.length<3||c.some(isNaN))return!1;try{new a.Q(+c[2],+c[1])}catch{return!1}const f=+c[0],b=+(c[3]||0),_=+(c[4]||0);return f>=this._map.getMinZoom()&&f<=this._map.getMaxZoom()&&b>=-180&&b<=180&&_>=this._map.getMinPitch()&&_<=this._map.getMaxPitch()}}const _f={linearity:.3,easing:a.c9(0,0,.3,1)},Xh=a.e({deceleration:2500,maxSpeed:1400},_f),NS=a.e({deceleration:20,maxSpeed:1400},_f),BS=a.e({deceleration:1e3,maxSpeed:360},_f),zS=a.e({deceleration:1e3,maxSpeed:90},_f),VS=a.e({deceleration:1e3,maxSpeed:360},_f);class GS{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,f=v.now();for(;c.length>0&&f-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,roll:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)f.zoom+=T.zoomDelta||0,f.bearing+=T.bearingDelta||0,f.pitch+=T.pitchDelta||0,f.roll+=T.rollDelta||0,T.panDelta&&f.pan._add(T.panDelta),T.around&&(f.around=T.around),T.pinchAround&&(f.pinchAround=T.pinchAround);const b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(f.pan.mag()){const T=Sf(f.pan.mag(),b,a.e({},Xh,c||{})),I=f.pan.mult(T.amount/f.pan.mag()),z=this._map.cameraHelper.handlePanInertia(I,this._map.transform);_.center=z.easingCenter,_.offset=z.easingOffset,Cf(_,T)}if(f.zoom){const T=Sf(f.zoom,b,NS);_.zoom=this._map.transform.zoom+T.amount,Cf(_,T)}if(f.bearing){const T=Sf(f.bearing,b,BS);_.bearing=this._map.transform.bearing+a.ae(T.amount,-179,179),Cf(_,T)}if(f.pitch){const T=Sf(f.pitch,b,zS);_.pitch=this._map.transform.pitch+T.amount,Cf(_,T)}if(f.roll){const T=Sf(f.roll,b,VS);_.roll=this._map.transform.roll+a.ae(T.amount,-179,179),Cf(_,T)}if(_.zoom||_.bearing){const T=f.pinchAround===void 0?f.around:f.pinchAround;_.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),a.e(_,{noMoveStart:!0})}}function Cf(S,c){(!S.duration||S.duration<c.duration)&&(S.duration=c.duration,S.easing=c.easing)}function Sf(S,c,f){const{maxSpeed:b,linearity:_,deceleration:T}=f,I=a.ae(S*_/(c/1e3),-b,b),z=Math.abs(I)/(T*_);return{easing:f.easing,duration:1e3*z,amount:I*(z/2)}}class Co extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,b,_={}){b=b instanceof MouseEvent?b:new MouseEvent(c,b);const T=y.mousePos(f.getCanvas(),b),I=f.unproject(T);super(c,a.e({point:T,lngLat:I,originalEvent:b},_)),this._defaultPrevented=!1,this.target=f}}class Of extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,b){const _=c==="touchend"?b.changedTouches:b.touches,T=y.touchPos(f.getCanvasContainer(),_),I=T.map(U=>f.unproject(U)),z=T.reduce((U,q,J,se)=>U.add(q.div(se.length)),new a.P(0,0));super(c,{points:T,point:z,lngLats:I,lngLat:f.unproject(z),originalEvent:b}),this._defaultPrevented=!1}}class tl extends a.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,b){super(c,{originalEvent:b}),this._defaultPrevented=!1}}class hc{constructor(c,f){this._map=c,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(c){return this._firePreventable(new tl(c.type,this._map,c))}mousedown(c,f){return this._mousedownPos=f,this._firePreventable(new Co(c.type,this._map,c))}mouseup(c){this._map.fire(new Co(c.type,this._map,c))}click(c,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new Co(c.type,this._map,c))}dblclick(c){return this._firePreventable(new Co(c.type,this._map,c))}mouseover(c){this._map.fire(new Co(c.type,this._map,c))}mouseout(c){this._map.fire(new Co(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Of(c.type,this._map,c))}touchmove(c){this._map.fire(new Of(c.type,this._map,c))}touchend(c){this._map.fire(new Of(c.type,this._map,c))}touchcancel(c){this._map.fire(new Of(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class US{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(c){this._map.fire(new Co(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Co("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._ignoreContextMenu||this._map.fire(new Co(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Jo{constructor(c){this._map=c}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(c){return this.transform.screenPointToLocation(a.P.convert(c),this._map.terrain)}}class Kh{constructor(c,f){this._map=c,this._tr=new Jo(c),this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,f){this.isEnabled()&&c.shiftKey&&c.button===0&&(y.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(c,f){if(!this._active)return;const b=f;if(this._lastPos.equals(b)||!this._box&&b.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=b,this._box||(this._box=y.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",c));const T=Math.min(_.x,b.x),I=Math.max(_.x,b.x),z=Math.min(_.y,b.y),U=Math.max(_.y,b.y);y.setTransform(this._box,`translate(${T}px,${z}px)`),this._box.style.width=I-T+"px",this._box.style.height=U-z+"px"}mouseupWindow(c,f){if(!this._active||c.button!==0)return;const b=this._startPos,_=f;if(this.reset(),y.suppressClick(),b.x!==_.x||b.y!==_.y)return this._map.fire(new a.l("boxzoomend",{originalEvent:c})),{cameraAnimation:T=>T.fitScreenCoordinates(b,_,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",c)}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(y.remove(this._box),this._box=null),y.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(c,f){return this._map.fire(new a.l(c,{originalEvent:f}))}}function Zx(S,c){if(S.length!==c.length)throw new Error(`The number of touches and points are not equal - touches ${S.length}, points ${c.length}`);const f={};for(let b=0;b<S.length;b++)f[S[b].identifier]=c[b];return f}class o2{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(c,f,b){(this.centroid||b.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),b.length===this.numTouches&&(this.centroid=function(_){const T=new a.P(0,0);for(const I of _)T._add(I);return T.div(_.length)}(f),this.touches=Zx(b,f)))}touchmove(c,f,b){if(this.aborted||!this.centroid)return;const _=Zx(b,f);for(const T in this.touches){const I=_[T];(!I||I.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(c,f,b){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),b.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Xx{constructor(c){this.singleTap=new o2(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(c,f,b){this.singleTap.touchstart(c,f,b)}touchmove(c,f,b){this.singleTap.touchmove(c,f,b)}touchend(c,f,b){const _=this.singleTap.touchend(c,f,b);if(_){const T=c.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(_)<30;if(T&&I||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class a2{constructor(c){this._tr=new Jo(c),this._zoomIn=new Xx({numTouches:1,numTaps:2}),this._zoomOut=new Xx({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,f,b){this._zoomIn.touchstart(c,f,b),this._zoomOut.touchstart(c,f,b)}touchmove(c,f,b){this._zoomIn.touchmove(c,f,b),this._zoomOut.touchmove(c,f,b)}touchend(c,f,b){const _=this._zoomIn.touchend(c,f,b),T=this._zoomOut.touchend(c,f,b),I=this._tr;return _?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(_)},{originalEvent:c})}):T?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(T)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mf{constructor(c){this._enabled=!!c.enable,this._moveStateManager=c.moveStateManager,this._clickTolerance=c.clickTolerance||1,this._moveFunction=c.move,this._activateOnStart=!!c.activateOnStart,c.assignEvents(this),this.reset()}reset(c){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(c)}_move(...c){const f=this._moveFunction(...c);if(f.bearingDelta||f.pitchDelta||f.rollDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(c,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(c)&&(this._moveStateManager.startMove(c),this._lastPoint=Array.isArray(f)?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(c,f){if(!this.isEnabled())return;const b=this._lastPoint;if(!b)return;if(c.preventDefault(),!this._moveStateManager.isValidMoveEvent(c))return void this.reset(c);const _=Array.isArray(f)?f[0]:f;return!this._moved&&_.dist(b)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=_,this._move(b,_))}dragEnd(c){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(c)&&(this._moved&&y.suppressClick(),this.reset(c))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const om={0:1,2:2};class wa{constructor(c){this._correctEvent=c.checkCorrectEvent}startMove(c){const f=y.mouseButton(c);this._eventButton=f}endMove(c){delete this._eventButton}isValidStartEvent(c){return this._correctEvent(c)}isValidMoveEvent(c){return!function(f,b){const _=om[b];return f.buttons===void 0||(f.buttons&_)!==_}(c,this._eventButton)}isValidEndEvent(c){return y.mouseButton(c)===this._eventButton}}class wi{constructor(){this._firstTouch=void 0}_isOneFingerTouch(c){return c.targetTouches.length===1}_isSameTouchEvent(c){return c.targetTouches[0].identifier===this._firstTouch}startMove(c){this._firstTouch=c.targetTouches[0].identifier}endMove(c){delete this._firstTouch}isValidStartEvent(c){return this._isOneFingerTouch(c)}isValidMoveEvent(c){return this._isOneFingerTouch(c)&&this._isSameTouchEvent(c)}isValidEndEvent(c){return this._isOneFingerTouch(c)&&this._isSameTouchEvent(c)}}class HS{constructor(c=new wa({checkCorrectEvent:()=>!0}),f=new wi){this.mouseMoveStateManager=c,this.oneFingerTouchMoveStateManager=f}_executeRelevantHandler(c,f,b){return c instanceof MouseEvent?f(c):typeof TouchEvent<"u"&&c instanceof TouchEvent?b(c):void 0}startMove(c){this._executeRelevantHandler(c,f=>this.mouseMoveStateManager.startMove(f),f=>this.oneFingerTouchMoveStateManager.startMove(f))}endMove(c){this._executeRelevantHandler(c,f=>this.mouseMoveStateManager.endMove(f),f=>this.oneFingerTouchMoveStateManager.endMove(f))}isValidStartEvent(c){return this._executeRelevantHandler(c,f=>this.mouseMoveStateManager.isValidStartEvent(f),f=>this.oneFingerTouchMoveStateManager.isValidStartEvent(f))}isValidMoveEvent(c){return this._executeRelevantHandler(c,f=>this.mouseMoveStateManager.isValidMoveEvent(f),f=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(f))}isValidEndEvent(c){return this._executeRelevantHandler(c,f=>this.mouseMoveStateManager.isValidEndEvent(f),f=>this.oneFingerTouchMoveStateManager.isValidEndEvent(f))}}const Tf=S=>{S.mousedown=S.dragStart,S.mousemoveWindow=S.dragMove,S.mouseup=S.dragEnd,S.contextmenu=c=>{c.preventDefault()}};class $S{constructor(c,f){this._clickTolerance=c.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(c){return c<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(c,f,b){return this._calculateTransform(c,f,b)}touchmove(c,f,b){if(this._active){if(!this._shouldBePrevented(b.length))return c.preventDefault(),this._calculateTransform(c,f,b);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",c)}}touchend(c,f,b){this._calculateTransform(c,f,b),this._active&&this._shouldBePrevented(b.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,f,b){b.length>0&&(this._active=!0);const _=Zx(b,f),T=new a.P(0,0),I=new a.P(0,0);let z=0;for(const q in _){const J=_[q],se=this._touches[q];se&&(T._add(J),I._add(J.sub(se)),z++,_[q]=J)}if(this._touches=_,this._shouldBePrevented(z)||!I.mag())return;const U=I.div(z);return this._sum._add(U),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(z),panDelta:U}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(c,f,b){this._firstTwoTouches||b.length<2||(this._firstTwoTouches=[b[0].identifier,b[1].identifier],this._start([f[0],f[1]]))}touchmove(c,f,b){if(!this._firstTwoTouches)return;c.preventDefault();const[_,T]=this._firstTwoTouches,I=Fu(b,f,_),z=Fu(b,f,T);if(!I||!z)return;const U=this._aroundCenter?null:I.add(z).div(2);return this._move([I,z],U,c)}touchend(c,f,b){if(!this._firstTwoTouches)return;const[_,T]=this._firstTwoTouches,I=Fu(b,f,_),z=Fu(b,f,T);I&&z||(this._active&&y.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Fu(S,c,f){for(let b=0;b<S.length;b++)if(S[b].identifier===f)return c[b]}function Kx(S,c){return Math.log(S/c)/Math.LN2}class An extends Yh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,f){const b=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Kx(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kx(this._distance,b),pinchAround:f}}}function Lv(S,c){return 180*S.angleWith(c)/Math.PI}class WS extends Yh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,f,b){const _=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Lv(this._vector,_),pinchAround:f}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const f=25/(Math.PI*this._minDiameter)*360,b=Lv(c,this._startVector);return Math.abs(b)<f}}function am(S){return Math.abs(S.y)>Math.abs(S.x)}class qS extends Yh{constructor(c){super(),this._currentTouchCount=0,this._map=c}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(c,f,b){super.touchstart(c,f,b),this._currentTouchCount=b.length}_start(c){this._lastPoints=c,am(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,f,b){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const _=c[0].sub(this._lastPoints[0]),T=c[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,T,b.timeStamp),this._valid?(this._lastPoints=c,this._active=!0,{pitchDelta:(_.y+T.y)/2*-.5}):void 0}gestureBeginsVertically(c,f,b){if(this._valid!==void 0)return this._valid;const _=c.mag()>=2,T=f.mag()>=2;if(!_&&!T)return;if(!_||!T)return this._firstMove===void 0&&(this._firstMove=b),b-this._firstMove<100&&void 0;const I=c.y>0==f.y>0;return am(c)&&am(f)&&I}}const l2={panStep:100,bearingStep:15,pitchStep:10};class Yx{constructor(c){this._tr=new Jo(c);const f=l2;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let f=0,b=0,_=0,T=0,I=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?b=-1:(c.preventDefault(),T=-1);break;case 39:c.shiftKey?b=1:(c.preventDefault(),T=1);break;case 38:c.shiftKey?_=1:(c.preventDefault(),I=-1);break;case 40:c.shiftKey?_=-1:(c.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(b=0,_=0),{cameraAnimation:z=>{const U=this._tr;z.easeTo({duration:300,easeId:"keyboardHandler",easing:Jx,zoom:f?Math.round(U.zoom)+f*(c.shiftKey?2:1):U.zoom,bearing:U.bearing+b*this._bearingStep,pitch:U.pitch+_*this._pitchStep,offset:[-T*this._panStep,-I*this._panStep],center:U.center},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jx(S){return S*(2-S)}const eb=4.000244140625;class jS{constructor(c,f){this._onTimeout=b=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(b)},this._map=c,this._tr=new Jo(c),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(c){return!!this._map.cooperativeGestures.isEnabled()&&!(c.ctrlKey||this._map.cooperativeGestures.isBypassed(c))}wheel(c){if(!this.isEnabled())return;if(this._shouldBePrevented(c))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",c);let f=c.deltaMode===WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const b=v.now(),_=b-(this._lastWheelEventTime||0);this._lastWheelEventTime=b,f!==0&&f%eb==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(_*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),c.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=c,this._delta-=f,this._active||this._start(c)),c.preventDefault()}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=y.mousePos(this._map.getCanvas(),c),b=this._tr;this._aroundPoint=this._aroundCenter?b.transform.locationToScreenPoint(a.Q.convert(b.center)):f,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const z=c.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=z),typeof this._targetZoom=="number"&&(this._targetZoom+=z)}if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>eb?this._wheelZoomRate:this._defaultZoomRate;let U=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&U!==0&&(U=1/U);const q=typeof this._targetZoom!="number"?c.scale:a.aI(this._targetZoom);this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,a.ab(q*U))),this._type==="wheel"&&(this._startZoom=c.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom!="number"?c.zoom:this._targetZoom,b=this._startZoom,_=this._easing;let T,I=!1;if(this._type==="wheel"&&b&&_){const z=v.now()-this._lastWheelEventTime,U=Math.min((z+5)/200,1),q=_(U);T=a.B.number(b,f,q),U<1?this._frameId||(this._frameId=!0):I=!0}else T=f,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=T,{noInertia:!0,needsRenderFrame:!I,zoomDelta:T-c.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let f=a.cb;if(this._prevEase){const b=this._prevEase,_=(v.now()-b.start)/b.duration,T=b.easing(_+.01)-b.easing(_),I=.27/Math.sqrt(T*T+1e-4)*.01,z=Math.sqrt(.0729-I*I);f=a.c9(I,z,.25,1)}return this._prevEase={start:v.now(),duration:c,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class tb{constructor(c,f){this._clickZoom=c,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class c2{constructor(c){this._tr=new Jo(c),this.reset()}reset(){this._active=!1}dblclick(c,f){return c.preventDefault(),{cameraAnimation:b=>{b.easeTo({duration:300,zoom:this._tr.zoom+(c.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class u2{constructor(){this._tap=new Xx({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(c,f,b){if(!this._swipePoint)if(this._tapTime){const _=f[0],T=c.timeStamp-this._tapTime<500,I=this._tapPoint.dist(_)<30;T&&I?b.length>0&&(this._swipePoint=_,this._swipeTouch=b[0].identifier):this.reset()}else this._tap.touchstart(c,f,b)}touchmove(c,f,b){if(this._tapTime){if(this._swipePoint){if(b[0].identifier!==this._swipeTouch)return;const _=f[0],T=_.y-this._swipePoint.y;return this._swipePoint=_,c.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(c,f,b)}touchend(c,f,b){if(this._tapTime)this._swipePoint&&b.length===0&&this.reset();else{const _=this._tap.touchend(c,f,b);_&&(this._tapTime=c.timeStamp,this._tapPoint=_)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class iu{constructor(c,f,b){this._el=c,this._mousePan=f,this._touchPan=b}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Tr{constructor(c,f,b,_){this._pitchWithRotate=c.pitchWithRotate,this._rollEnabled=c.rollEnabled,this._mouseRotate=f,this._mousePitch=b,this._mouseRoll=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class lm{constructor(c,f,b,_){this._el=c,this._touchZoom=f,this._touchRotate=b,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Fv{constructor(c,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=c,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const c=this._map.getCanvasContainer();c.classList.add("maplibregl-cooperative-gestures"),this._container=y.create("div","maplibregl-cooperative-gesture-screen",c);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const b=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),_=document.createElement("div");_.className="maplibregl-desktop-message",_.textContent=f,this._container.appendChild(_);const T=document.createElement("div");T.className="maplibregl-mobile-message",T.textContent=b,this._container.appendChild(T),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(y.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(c){return c[this._bypassKey]}notifyGestureBlocked(c,f){this._enabled&&(this._map.fire(new a.l("cooperativegestureprevented",{gestureType:c,originalEvent:f})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const cm=S=>S.zoom||S.drag||S.roll||S.pitch||S.rotate;class QS extends a.l{}function Nv(S){return S.panDelta&&S.panDelta.mag()||S.zoomDelta||S.bearingDelta||S.pitchDelta||S.rollDelta}class h2{constructor(c,f){this.handleWindowEvent=_=>{this.handleEvent(_,`${_.type}Window`)},this.handleEvent=(_,T)=>{if(_.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=_.type==="renderFrame"?void 0:_,z={needsRenderFrame:!1},U={},q={};for(const{handlerName:ne,handler:pe,allowed:ye}of this._handlers){if(!pe.isEnabled())continue;let De;if(this._blockedByActive(q,ye,ne))pe.reset();else if(pe[T||_.type]){if(a.cc(_,T||_.type)){const Ee=y.mousePos(this._map.getCanvas(),_);De=pe[T||_.type](_,Ee)}else if(a.cd(_,T||_.type)){const Ee=this._getMapTouches(_.touches),Le=y.touchPos(this._map.getCanvas(),Ee);De=pe[T||_.type](_,Le,Ee)}else a.ce(T||_.type)||(De=pe[T||_.type](_));this.mergeHandlerResult(z,U,De,ne,I),De&&De.needsRenderFrame&&this._triggerRenderFrame()}(De||pe.isActive())&&(q[ne]=pe)}const J={};for(const ne in this._previousActiveHandlers)q[ne]||(J[ne]=I);this._previousActiveHandlers=q,(Object.keys(J).length||Nv(z))&&(this._changes.push([z,U,J]),this._triggerRenderFrame()),(Object.keys(q).length||Nv(z))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:se}=z;se&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],se(this._map))},this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new GS(c),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const b=this._el;this._listeners=[[b,"touchstart",{passive:!0}],[b,"touchmove",{passive:!1}],[b,"touchend",void 0],[b,"touchcancel",void 0],[b,"mousedown",void 0],[b,"mousemove",void 0],[b,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[b,"mouseover",void 0],[b,"mouseout",void 0],[b,"dblclick",void 0],[b,"click",void 0],[b,"keydown",{capture:!1}],[b,"keyup",void 0],[b,"wheel",{passive:!1}],[b,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,T,I]of this._listeners)y.addEventListener(_,T,_===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[c,f,b]of this._listeners)y.removeEventListener(c,f,c===document?this.handleWindowEvent:this.handleEvent,b)}_addDefaultHandlers(c){const f=this._map,b=f.getCanvasContainer();this._add("mapEvent",new hc(f,c));const _=f.boxZoom=new Kh(f,c);this._add("boxZoom",_),c.interactive&&c.boxZoom&&_.enable();const T=f.cooperativeGestures=new Fv(f,c.cooperativeGestures);this._add("cooperativeGestures",T),c.cooperativeGestures&&T.enable();const I=new a2(f),z=new c2(f);f.doubleClickZoom=new tb(z,I),this._add("tapZoom",I),this._add("clickZoom",z),c.interactive&&c.doubleClickZoom&&f.doubleClickZoom.enable();const U=new u2;this._add("tapDragZoom",U);const q=f.touchPitch=new qS(f);this._add("touchPitch",q),c.interactive&&c.touchPitch&&f.touchPitch.enable(c.touchPitch);const J=()=>f.project(f.getCenter()),se=function({enable:Qe,clickTolerance:Ke,aroundCenter:at=!0,minPixelCenterThreshold:et=100,rotateDegreesPerPixelMoved:vt=.8},gt){const Dt=new wa({checkCorrectEvent:Bt=>y.mouseButton(Bt)===0&&Bt.ctrlKey||y.mouseButton(Bt)===2&&!Bt.ctrlKey});return new Mf({clickTolerance:Ke,move:(Bt,It)=>{const di=gt();if(at&&Math.abs(di.y-Bt.y)>et)return{bearingDelta:a.ca(new a.P(Bt.x,It.y),It,di)};let ui=(It.x-Bt.x)*vt;return at&&It.y<di.y&&(ui=-ui),{bearingDelta:ui}},moveStateManager:Dt,enable:Qe,assignEvents:Tf})}(c,J),ne=function({enable:Qe,clickTolerance:Ke,pitchDegreesPerPixelMoved:at=-.5}){const et=new wa({checkCorrectEvent:vt=>y.mouseButton(vt)===0&&vt.ctrlKey||y.mouseButton(vt)===2});return new Mf({clickTolerance:Ke,move:(vt,gt)=>({pitchDelta:(gt.y-vt.y)*at}),moveStateManager:et,enable:Qe,assignEvents:Tf})}(c),pe=function({enable:Qe,clickTolerance:Ke,rollDegreesPerPixelMoved:at=.3},et){const vt=new wa({checkCorrectEvent:gt=>y.mouseButton(gt)===2&&gt.ctrlKey});return new Mf({clickTolerance:Ke,move:(gt,Dt)=>{const Bt=et();let It=(Dt.x-gt.x)*at;return Dt.y<Bt.y&&(It=-It),{rollDelta:It}},moveStateManager:vt,enable:Qe,assignEvents:Tf})}(c,J);f.dragRotate=new Tr(c,se,ne,pe),this._add("mouseRotate",se,["mousePitch"]),this._add("mousePitch",ne,["mouseRotate","mouseRoll"]),this._add("mouseRoll",pe,["mousePitch"]),c.interactive&&c.dragRotate&&f.dragRotate.enable();const ye=function({enable:Qe,clickTolerance:Ke}){const at=new wa({checkCorrectEvent:et=>y.mouseButton(et)===0&&!et.ctrlKey});return new Mf({clickTolerance:Ke,move:(et,vt)=>({around:vt,panDelta:vt.sub(et)}),activateOnStart:!0,moveStateManager:at,enable:Qe,assignEvents:Tf})}(c),De=new $S(c,f);f.dragPan=new iu(b,ye,De),this._add("mousePan",ye),this._add("touchPan",De,["touchZoom","touchRotate"]),c.interactive&&c.dragPan&&f.dragPan.enable(c.dragPan);const Ee=new WS,Le=new An;f.touchZoomRotate=new lm(b,Le,Ee,U),this._add("touchRotate",Ee,["touchPan","touchZoom"]),this._add("touchZoom",Le,["touchPan","touchRotate"]),c.interactive&&c.touchZoomRotate&&f.touchZoomRotate.enable(c.touchZoomRotate);const ze=f.scrollZoom=new jS(f,()=>this._triggerRenderFrame());this._add("scrollZoom",ze,["mousePan"]),c.interactive&&c.scrollZoom&&f.scrollZoom.enable(c.scrollZoom);const We=f.keyboard=new Yx(f);this._add("keyboard",We),c.interactive&&c.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new US(f))}_add(c,f,b){this._handlers.push({handlerName:c,handler:f,allowed:b}),this._handlersById[c]=f}stop(c){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!cm(this._eventsInProgress)||this.isZooming()}_blockedByActive(c,f,b){for(const _ in c)if(_!==b&&(!f||f.indexOf(_)<0))return!0;return!1}_getMapTouches(c){const f=[];for(const b of c)this._el.contains(b.target)&&f.push(b);return f}mergeHandlerResult(c,f,b,_,T){if(!b)return;a.e(c,b);const I={handlerName:_,originalEvent:b.originalEvent||T};b.zoomDelta!==void 0&&(f.zoom=I),b.panDelta!==void 0&&(f.drag=I),b.rollDelta!==void 0&&(f.roll=I),b.pitchDelta!==void 0&&(f.pitch=I),b.bearingDelta!==void 0&&(f.rotate=I)}_applyChanges(){const c={},f={},b={};for(const[_,T,I]of this._changes)_.panDelta&&(c.panDelta=(c.panDelta||new a.P(0,0))._add(_.panDelta)),_.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+_.pitchDelta),_.rollDelta&&(c.rollDelta=(c.rollDelta||0)+_.rollDelta),_.around!==void 0&&(c.around=_.around),_.pinchAround!==void 0&&(c.pinchAround=_.pinchAround),_.noInertia&&(c.noInertia=_.noInertia),a.e(f,T),a.e(b,I);this._updateMapTransform(c,f,b),this._changes=[]}_updateMapTransform(c,f,b){const _=this._map,T=_._getTransformForUpdate(),I=_.terrain;if(!(Nv(c)||I&&this._terrainMovement))return this._fireEvents(f,b,!0);_._stop(!0);let{panDelta:z,zoomDelta:U,bearingDelta:q,pitchDelta:J,rollDelta:se,around:ne,pinchAround:pe}=c;pe!==void 0&&(ne=pe),ne=ne||_.transform.centerPoint,I&&!T.isPointOnMapSurface(ne)&&(ne=T.centerPoint);const ye={panDelta:z,zoomDelta:U,rollDelta:se,pitchDelta:J,bearingDelta:q,around:ne};this._map.cameraHelper.useGlobeControls&&!T.isPointOnMapSurface(ne)&&(ne=T.centerPoint);const De=ne.distSqr(T.centerPoint)<.01?T.center:T.screenPointToLocation(z?ne.sub(z):ne);I?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ye,T),this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?T.setCenter(T.screenPointToLocation(T.centerPoint.sub(z))):this._map.cameraHelper.handleMapControlsPan(ye,T,De):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(ye,T,De))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ye,T),this._map.cameraHelper.handleMapControlsPan(ye,T,De)),_._applyUpdatedTransform(T),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(f,b,!0)}_fireEvents(c,f,b){const _=cm(this._eventsInProgress),T=cm(c),I={};for(const se in c){const{originalEvent:ne}=c[se];this._eventsInProgress[se]||(I[`${se}start`]=ne),this._eventsInProgress[se]=c[se]}!_&&T&&this._fireEvent("movestart",T.originalEvent);for(const se in I)this._fireEvent(se,I[se]);T&&this._fireEvent("move",T.originalEvent);for(const se in c){const{originalEvent:ne}=c[se];this._fireEvent(se,ne)}const z={};let U;for(const se in this._eventsInProgress){const{handlerName:ne,originalEvent:pe}=this._eventsInProgress[se];this._handlersById[ne].isActive()||(delete this._eventsInProgress[se],U=f[ne]||pe,z[`${se}end`]=U)}for(const se in z)this._fireEvent(se,z[se]);const q=cm(this._eventsInProgress),J=(_||T)&&!q;if(J&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const se=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&se.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(se)}if(b&&J){this._updatingCamera=!0;const se=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ne=pe=>pe!==0&&-this._bearingSnap<pe&&pe<this._bearingSnap;!se||!se.essential&&v.prefersReducedMotion?(this._map.fire(new a.l("moveend",{originalEvent:U})),ne(this._map.getBearing())&&this._map.resetNorth()):(ne(se.bearing||this._map.getBearing())&&(se.bearing=0),se.freezeElevation=!0,this._map.easeTo(se,{originalEvent:U})),this._updatingCamera=!1}}_fireEvent(c,f){this._map.fire(new a.l(c,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{delete this._frameId,this.handleEvent(new QS("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class dc extends a.E{constructor(c,f,b){super(),this._renderFrameCallback=()=>{const _=Math.min((v.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=b.bearingSnap,this.cameraHelper=f,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(c,f){c.apply(this.transform),this.transform=c,this.cameraHelper=f}getCenter(){return new a.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(c,f){return this.jumpTo({center:c},f)}getCenterElevation(){return this.transform.elevation}setCenterElevation(c,f){return this.jumpTo({elevation:c},f),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(c){this._centerClampedToGround=c}panBy(c,f,b){return c=a.P.convert(c).mult(-1),this.panTo(this.transform.center,a.e({offset:c},f),b)}panTo(c,f,b){return this.easeTo(a.e({center:c},f),b)}getZoom(){return this.transform.zoom}setZoom(c,f){return this.jumpTo({zoom:c},f),this}zoomTo(c,f,b){return this.easeTo(a.e({zoom:c},f),b)}zoomIn(c,f){return this.zoomTo(this.getZoom()+1,c,f),this}zoomOut(c,f){return this.zoomTo(this.getZoom()-1,c,f),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(c,f){return c!=this.transform.fov&&(this.transform.setFov(c),this.fire(new a.l("movestart",f)).fire(new a.l("move",f)).fire(new a.l("moveend",f))),this}getBearing(){return this.transform.bearing}setBearing(c,f){return this.jumpTo({bearing:c},f),this}getPadding(){return this.transform.padding}setPadding(c,f){return this.jumpTo({padding:c},f),this}rotateTo(c,f,b){return this.easeTo(a.e({bearing:c},f),b)}resetNorth(c,f){return this.rotateTo(0,a.e({duration:1e3},c),f),this}resetNorthPitch(c,f){return this.easeTo(a.e({bearing:0,pitch:0,roll:0,duration:1e3},c),f),this}snapToNorth(c,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,f):this}getPitch(){return this.transform.pitch}setPitch(c,f){return this.jumpTo({pitch:c},f),this}getRoll(){return this.transform.roll}setRoll(c,f){return this.jumpTo({roll:c},f),this}cameraForBounds(c,f){c=Re.convert(c).adjustAntiMeridian();const b=f&&f.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),b,f)}_cameraForBoxAndBearing(c,f,b,_){const T={top:0,bottom:0,right:0,left:0};if(typeof(_=a.e({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const q=_.padding;_.padding={top:q,bottom:q,right:q,left:q}}const I=a.e(T,_.padding);_.padding=I;const z=this.transform,U=new Re(c,f);return this.cameraHelper.cameraForBoxAndBearing(_,I,U,b,z)}fitBounds(c,f,b){return this._fitInternal(this.cameraForBounds(c,f),f,b)}fitScreenCoordinates(c,f,b,_,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(a.P.convert(c)),this.transform.screenPointToLocation(a.P.convert(f)),b,_),_,T)}_fitInternal(c,f,b){return c?(delete(f=a.e(c,f)).padding,f.linear?this.easeTo(f,b):this.flyTo(f,b)):this}jumpTo(c,f){this.stop();const b=this._getTransformForUpdate();let _=!1,T=!1,I=!1;const z=b.zoom;this.cameraHelper.handleJumpToCenterZoom(b,c);const U=b.zoom!==z;return"elevation"in c&&b.elevation!==+c.elevation&&b.setElevation(+c.elevation),"bearing"in c&&b.bearing!==+c.bearing&&(_=!0,b.setBearing(+c.bearing)),"pitch"in c&&b.pitch!==+c.pitch&&(T=!0,b.setPitch(+c.pitch)),"roll"in c&&b.roll!==+c.roll&&(I=!0,b.setRoll(+c.roll)),c.padding==null||b.isPaddingEqual(c.padding)||b.setPadding(c.padding),this._applyUpdatedTransform(b),this.fire(new a.l("movestart",f)).fire(new a.l("move",f)),U&&this.fire(new a.l("zoomstart",f)).fire(new a.l("zoom",f)).fire(new a.l("zoomend",f)),_&&this.fire(new a.l("rotatestart",f)).fire(new a.l("rotate",f)).fire(new a.l("rotateend",f)),T&&this.fire(new a.l("pitchstart",f)).fire(new a.l("pitch",f)).fire(new a.l("pitchend",f)),I&&this.fire(new a.l("rollstart",f)).fire(new a.l("roll",f)).fire(new a.l("rollend",f)),this.fire(new a.l("moveend",f))}calculateCameraOptionsFromTo(c,f,b,_=0){const T=a.$.fromLngLat(c,f),I=a.$.fromLngLat(b,_),z=I.x-T.x,U=I.y-T.y,q=I.z-T.z,J=Math.hypot(z,U,q);if(J===0)throw new Error("Can't calculate camera options with same From and To");const se=Math.hypot(z,U),ne=a.ab(this.transform.cameraToCenterDistance/J/this.transform.tileSize),pe=180*Math.atan2(z,-U)/Math.PI;let ye=180*Math.acos(se/J)/Math.PI;return ye=q<0?90-ye:90+ye,{center:I.toLngLat(),elevation:_,zoom:ne,pitch:ye,bearing:pe}}calculateCameraOptionsFromCameraLngLatAltRotation(c,f,b,_,T){const I=this.transform.calculateCenterFromCameraLngLatAlt(c,f,b,_);return{center:I.center,elevation:I.elevation,zoom:I.zoom,bearing:b,pitch:_,roll:T}}easeTo(c,f){this._stop(!1,c.easeId),((c=a.e({offset:[0,0],duration:500,easing:a.cb},c)).animate===!1||!c.essential&&v.prefersReducedMotion)&&(c.duration=0);const b=this._getTransformForUpdate(),_=this.getBearing(),T=b.pitch,I=b.roll,z="bearing"in c?this._normalizeBearing(c.bearing,_):_,U="pitch"in c?+c.pitch:T,q="roll"in c?this._normalizeBearing(c.roll,I):I,J="padding"in c?c.padding:b.padding,se=a.P.convert(c.offset);let ne,pe;c.around&&(ne=a.Q.convert(c.around),pe=b.locationToScreenPoint(ne));const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},De=this.cameraHelper.handleEaseTo(b,{bearing:z,pitch:U,roll:q,padding:J,around:ne,aroundPoint:pe,offsetAsPoint:se,offset:c.offset,zoom:c.zoom,center:c.center});return this._rotating=this._rotating||_!==z,this._pitching=this._pitching||U!==T,this._rolling=this._rolling||q!==I,this._padding=!b.isPaddingEqual(J),this._zooming=this._zooming||De.isZooming,this._easeId=c.easeId,this._prepareEase(f,c.noMoveStart,ye),this.terrain&&this._prepareElevation(De.elevationCenter),this._ease(Ee=>{De.easeFunc(Ee),this.terrain&&!c.freezeElevation&&this._updateElevation(Ee),this._applyUpdatedTransform(b),this._fireMoveEvents(f)},Ee=>{this.terrain&&c.freezeElevation&&this._finalizeElevation(),this._afterEase(f,Ee)},c),this}_prepareEase(c,f,b={}){this._moving=!0,f||b.moving||this.fire(new a.l("movestart",c)),this._zooming&&!b.zooming&&this.fire(new a.l("zoomstart",c)),this._rotating&&!b.rotating&&this.fire(new a.l("rotatestart",c)),this._pitching&&!b.pitching&&this.fire(new a.l("pitchstart",c)),this._rolling&&!b.rolling&&this.fire(new a.l("rollstart",c))}_prepareElevation(c){this._elevationCenter=c,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(c,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(c){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(c<1&&f!==this._elevationTarget){const b=this._elevationTarget-this._elevationStart;this._elevationStart+=c*(b-(f-(b*c+this._elevationStart))/(1-c)),this._elevationTarget=f}this.transform.setElevation(a.B.number(this._elevationStart,this._elevationTarget,c))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(c){if(!this.terrain&&c.elevation>=0&&c.pitch<=90)return{};const f=c.getCameraLngLat(),b=c.getCameraAltitude(),_=this.terrain?this.terrain.getElevationForLngLatZoom(f,c.zoom):0;if(b<_){const T=this.calculateCameraOptionsFromTo(f,_,c.center,c.elevation);return{pitch:T.pitch,zoom:T.zoom}}return{}}_applyUpdatedTransform(c){const f=[];if(f.push(_=>this._elevateCameraIfInsideTerrain(_)),this.transformCameraUpdate&&f.push(_=>this.transformCameraUpdate(_)),!f.length)return;const b=c.clone();for(const _ of f){const T=b.clone(),{center:I,zoom:z,roll:U,pitch:q,bearing:J,elevation:se}=_(T);I&&T.setCenter(I),se!==void 0&&T.setElevation(se),z!==void 0&&T.setZoom(z),U!==void 0&&T.setRoll(U),q!==void 0&&T.setPitch(q),J!==void 0&&T.setBearing(J),b.apply(T)}this.transform.apply(b)}_fireMoveEvents(c){this.fire(new a.l("move",c)),this._zooming&&this.fire(new a.l("zoom",c)),this._rotating&&this.fire(new a.l("rotate",c)),this._pitching&&this.fire(new a.l("pitch",c)),this._rolling&&this.fire(new a.l("roll",c))}_afterEase(c,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const b=this._zooming,_=this._rotating,T=this._pitching,I=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,b&&this.fire(new a.l("zoomend",c)),_&&this.fire(new a.l("rotateend",c)),T&&this.fire(new a.l("pitchend",c)),I&&this.fire(new a.l("rollend",c)),this.fire(new a.l("moveend",c))}flyTo(c,f){if(!c.essential&&v.prefersReducedMotion){const It=a.O(c,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(It,f)}this.stop(),c=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.cb},c);const b=this._getTransformForUpdate(),_=b.bearing,T=b.pitch,I=b.roll,z=b.padding,U="bearing"in c?this._normalizeBearing(c.bearing,_):_,q="pitch"in c?+c.pitch:T,J="roll"in c?this._normalizeBearing(c.roll,I):I,se="padding"in c?c.padding:b.padding,ne=a.P.convert(c.offset);let pe=b.centerPoint.add(ne);const ye=b.screenPointToLocation(pe),De=this.cameraHelper.handleFlyTo(b,{bearing:U,pitch:q,roll:J,padding:se,locationAtOffset:ye,offsetAsPoint:ne,center:c.center,minZoom:c.minZoom,zoom:c.zoom});let Ee=c.curve;const Le=Math.max(b.width,b.height),ze=Le/De.scaleOfZoom,We=De.pixelPathLength;typeof De.scaleOfMinZoom=="number"&&(Ee=Math.sqrt(Le/De.scaleOfMinZoom/We*2));const Qe=Ee*Ee;function Ke(It){const di=(ze*ze-Le*Le+(It?-1:1)*Qe*Qe*We*We)/(2*(It?ze:Le)*Qe*We);return Math.log(Math.sqrt(di*di+1)-di)}function at(It){return(Math.exp(It)-Math.exp(-It))/2}function et(It){return(Math.exp(It)+Math.exp(-It))/2}const vt=Ke(!1);let gt=function(It){return et(vt)/et(vt+Ee*It)},Dt=function(It){return Le*((et(vt)*(at(di=vt+Ee*It)/et(di))-at(vt))/Qe)/We;var di},Bt=(Ke(!0)-vt)/Ee;if(Math.abs(We)<2e-6||!isFinite(Bt)){if(Math.abs(Le-ze)<1e-6)return this.easeTo(c,f);const It=ze<Le?-1:1;Bt=Math.abs(Math.log(ze/Le))/Ee,Dt=()=>0,gt=di=>Math.exp(It*Ee*di)}return c.duration="duration"in c?+c.duration:1e3*Bt/("screenSpeed"in c?+c.screenSpeed/Ee:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=_!==U,this._pitching=q!==T,this._rolling=J!==I,this._padding=!b.isPaddingEqual(se),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(De.targetCenter),this._ease(It=>{const di=It*Bt,ui=1/gt(di),Ht=Dt(di);this._rotating&&b.setBearing(a.B.number(_,U,It)),this._pitching&&b.setPitch(a.B.number(T,q,It)),this._rolling&&b.setRoll(a.B.number(I,J,It)),this._padding&&(b.interpolatePadding(z,se,It),pe=b.centerPoint.add(ne)),De.easeFunc(It,ui,Ht,pe),this.terrain&&!c.freezeElevation&&this._updateElevation(It),this._applyUpdatedTransform(b),this._fireMoveEvents(f)},()=>{this.terrain&&c.freezeElevation&&this._finalizeElevation(),this._afterEase(f)},c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,f){var b;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,f)}return c||(b=this.handlers)===null||b===void 0||b.stop(!1),this}_ease(c,f,b){b.animate===!1||b.duration===0?(c(1),f()):(this._easeStart=v.now(),this._easeOptions=b,this._onEaseFrame=c,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(c,f){c=a.aL(c,-180,180);const b=Math.abs(c-f);return Math.abs(c-360-f)<b&&(c-=360),Math.abs(c+360-f)<b&&(c+=360),c}queryTerrainElevation(c){return this.terrain?this.terrain.getElevationForLngLatZoom(a.Q.convert(c),this.transform.tileZoom):null}}const um={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class zi{constructor(c=um){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=c}getDefaultPosition(){return"bottom-right"}onAdd(c){return this._map=c,this._compact=this.options.compact,this._container=y.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=y.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=y.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(c,f){const b=this._map._getUIString(`AttributionControl.${f}`);c.title=b,c.setAttribute("aria-label",b)}_updateAttributions(){if(!this._map.style)return;let c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const f=this._map.style.sourceCaches;for(const _ in f){const T=f[_];if(T.used||T.usedForTerrain){const I=T.getSource();I.attribution&&c.indexOf(I.attribution)<0&&c.push(I.attribution)}}c=c.filter(_=>String(_).trim()),c.sort((_,T)=>_.length-T.length),c=c.filter((_,T)=>{for(let I=T+1;I<c.length;I++)if(c[I].indexOf(_)>=0)return!1;return!0});const b=c.join(" | ");b!==this._attribHTML&&(this._attribHTML=b,c.length?(this._innerContainer.innerHTML=y.sanitize(b),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ji{constructor(c={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const b=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&b.classList.add("maplibregl-compact"):b.classList.remove("maplibregl-compact")}},this.options=c}getDefaultPosition(){return"bottom-left"}onAdd(c){this._map=c,this._compact=this.options&&this.options.compact,this._container=y.create("div","maplibregl-ctrl");const f=y.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){y.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Bv{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const f=++this._id;return this._queue.push({callback:c,id:f,cancelled:!1}),f}remove(c){const f=this._currentlyRunning,b=f?this._queue.concat(f):this._queue;for(const _ of b)if(_.id===c)return void(_.cancelled=!0)}run(c=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const b of f)if(!b.cancelled&&(b.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ib=a.aD([{name:"a_pos3d",type:"Int16",components:3}]);class nb extends a.E{constructor(c){super(),this._lastTilesetChange=v.now(),this.sourceCache=c,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=c._source.tileSize*2**this.deltaZoom,c.usedForTerrain=!0,c.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(c,f){this.sourceCache.update(c,f),this._renderableTilesKeys=[];const b={};for(const _ of Ce(c,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))b[_.key]=!0,this._renderableTilesKeys.push(_.key),this._tiles[_.key]||(_.terrainRttPosMatrix32f=new Float64Array(16),a.bO(_.terrainRttPosMatrix32f,0,a.Z,a.Z,0,0,1),this._tiles[_.key]=new Nt(_,this.tileSize),this._lastTilesetChange=v.now());for(const _ in this._tiles)b[_]||delete this._tiles[_]}freeRtt(c){for(const f in this._tiles){const b=this._tiles[f];(!c||b.tileID.equals(c)||b.tileID.isChildOf(c)||c.isChildOf(b.tileID))&&(b.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(c=>this.getTileByID(c))}getTileByID(c){return this._tiles[c]}getTerrainCoords(c,f){return f?this._getTerrainCoordsForTileRanges(c,f):this._getTerrainCoordsForRegularTile(c)}_getTerrainCoordsForRegularTile(c){const f={};for(const b of this._renderableTilesKeys){const _=this._tiles[b].tileID,T=c.clone(),I=a.b2();if(_.canonical.equals(c.canonical))a.bO(I,0,a.Z,a.Z,0,0,1);else if(_.canonical.isChildOf(c.canonical)){const z=_.canonical.z-c.canonical.z,U=_.canonical.x-(_.canonical.x>>z<<z),q=_.canonical.y-(_.canonical.y>>z<<z),J=a.Z>>z;a.bO(I,0,J,J,0,0,1),a.L(I,I,[-U*J,-q*J,0])}else{if(!c.canonical.isChildOf(_.canonical))continue;{const z=c.canonical.z-_.canonical.z,U=c.canonical.x-(c.canonical.x>>z<<z),q=c.canonical.y-(c.canonical.y>>z<<z),J=a.Z>>z;a.bO(I,0,a.Z,a.Z,0,0,1),a.L(I,I,[U*J,q*J,0]),a.M(I,I,[1/2**z,1/2**z,0])}}T.terrainRttPosMatrix32f=new Float32Array(I),f[b]=T}return f}_getTerrainCoordsForTileRanges(c,f){const b={};for(const _ of this._renderableTilesKeys){const T=this._tiles[_].tileID;if(!this._isWithinTileRanges(T,f))continue;const I=c.clone(),z=a.b2();if(T.canonical.z===c.canonical.z){const U=c.canonical.x-T.canonical.x,q=c.canonical.y-T.canonical.y;a.bO(z,0,a.Z,a.Z,0,0,1),a.L(z,z,[U*a.Z,q*a.Z,0])}else if(T.canonical.z>c.canonical.z){const U=T.canonical.z-c.canonical.z,q=T.canonical.x-(T.canonical.x>>U<<U),J=T.canonical.y-(T.canonical.y>>U<<U),se=c.canonical.x-(T.canonical.x>>U),ne=c.canonical.y-(T.canonical.y>>U),pe=a.Z>>U;a.bO(z,0,pe,pe,0,0,1),a.L(z,z,[-q*pe+se*a.Z,-J*pe+ne*a.Z,0])}else{const U=c.canonical.z-T.canonical.z,q=c.canonical.x-(c.canonical.x>>U<<U),J=c.canonical.y-(c.canonical.y>>U<<U),se=(c.canonical.x>>U)-T.canonical.x,ne=(c.canonical.y>>U)-T.canonical.y,pe=a.Z<<U;a.bO(z,0,pe,pe,0,0,1),a.L(z,z,[q*a.Z+se*pe,J*a.Z+ne*pe,0])}I.terrainRttPosMatrix32f=new Float32Array(z),b[_]=I}return b}getSourceTile(c,f){const b=this.sourceCache._source;let _=c.overscaledZ-this.deltaZoom;if(_>b.maxzoom&&(_=b.maxzoom),_<b.minzoom)return null;this._sourceTileCache[c.key]||(this._sourceTileCache[c.key]=c.scaledTo(_).key);let T=this.sourceCache.getTileByID(this._sourceTileCache[c.key]);if((!T||!T.dem)&&f)for(;_>=b.minzoom&&(!T||!T.dem);)T=this.sourceCache.getTileByID(c.scaledTo(_--).key);return T}anyTilesAfterTime(c=Date.now()){return this._lastTilesetChange>=c}_isWithinTileRanges(c,f){return f[c.canonical.z]&&c.canonical.x>=f[c.canonical.z].minTileX&&c.canonical.x<=f[c.canonical.z].maxTileX&&c.canonical.y>=f[c.canonical.z].minTileY&&c.canonical.y<=f[c.canonical.z].maxTileY}}class ea{constructor(c,f,b){this._meshCache={},this.painter=c,this.sourceCache=new nb(f),this.options=b,this.exaggeration=typeof b.exaggeration=="number"?b.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(c,f,b,_=a.Z){var T;if(!(f>=0&&f<_&&b>=0&&b<_))return 0;const I=this.getTerrainData(c),z=(T=I.tile)===null||T===void 0?void 0:T.dem;if(!z)return 0;const U=a.cf([],[f/_*a.Z,b/_*a.Z],I.u_terrain_matrix),q=[U[0]*z.dim,U[1]*z.dim],J=Math.floor(q[0]),se=Math.floor(q[1]),ne=q[0]-J,pe=q[1]-se;return z.get(J,se)*(1-ne)*(1-pe)+z.get(J+1,se)*ne*(1-pe)+z.get(J,se+1)*(1-ne)*pe+z.get(J+1,se+1)*ne*pe}getElevationForLngLatZoom(c,f){if(!a.cg(f,c.wrap()))return 0;const{tileID:b,mercatorX:_,mercatorY:T}=this._getOverscaledTileIDFromLngLatZoom(c,f);return this.getElevation(b,_%a.Z,T%a.Z,a.Z)}getElevation(c,f,b,_=a.Z){return this.getDEMElevation(c,f,b,_)*this.exaggeration}getTerrainData(c){if(!this._emptyDemTexture){const _=this.painter.context,T=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Y(_,T,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Y(_,new a.R({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.at([])}const f=this.sourceCache.getSourceTile(c,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const _=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new Y(_,f.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),f.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const b=f&&f+f.tileID.key+c.key;if(b&&!this._demMatrixCache[b]){const _=this.sourceCache.sourceCache._source.maxzoom;let T=c.canonical.z-f.tileID.canonical.z;c.overscaledZ>c.canonical.z&&(c.canonical.z>=_?T=c.canonical.z-_:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=c.canonical.x-(c.canonical.x>>T<<T),z=c.canonical.y-(c.canonical.y>>T<<T),U=a.ch(new Float64Array(16),[1/(a.Z<<T),1/(a.Z<<T),0]);a.L(U,U,[I*a.Z,z*a.Z,0]),this._demMatrixCache[c.key]={matrix:U,coord:c}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:b?this._demMatrixCache[c.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(c){const f=this.painter,b=f.width/devicePixelRatio,_=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===b&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Y(f.context,{width:b,height:_,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Y(f.context,{width:b,height:_,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(b,_,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,b,_))),this._fbo.colorAttachment.set(c==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const c=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let T=0,I=0;T<this._coordsTextureSize;T++)for(let z=0;z<this._coordsTextureSize;z++,I+=4)f[I+0]=255&z,f[I+1]=255&T,f[I+2]=z>>8<<4|T>>8,f[I+3]=0;const b=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),_=new Y(c,b,c.gl.RGBA,{premultiply:!1});return _.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(c){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),b=this.painter.context,_=b.gl,T=Math.round(c.x*this.painter.pixelRatio/devicePixelRatio),I=Math.round(c.y*this.painter.pixelRatio/devicePixelRatio),z=Math.round(this.painter.height/devicePixelRatio);b.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),_.readPixels(T,z-I-1,1,1,_.RGBA,_.UNSIGNED_BYTE,f),b.bindFramebuffer.set(null);const U=f[0]+(f[2]>>4<<8),q=f[1]+((15&f[2])<<8),J=this.coordsIndex[255-f[3]],se=J&&this.sourceCache.getTileByID(J);if(!se)return null;const ne=this._coordsTextureSize,pe=(1<<se.tileID.canonical.z)*ne;return new a.$((se.tileID.canonical.x*ne+U)/pe+se.tileID.wrap,(se.tileID.canonical.y*ne+q)/pe,this.getElevation(se.tileID,U,q,ne))}depthAtPoint(c){const f=new Uint8Array(4),b=this.painter.context,_=b.gl;return b.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),_.readPixels(c.x,this.painter.height/devicePixelRatio-c.y-1,1,1,_.RGBA,_.UNSIGNED_BYTE,f),b.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(c){var f;const b=((f=this.painter.style.projection)===null||f===void 0?void 0:f.transitionState)>0,_=b&&c.canonical.y===0,T=b&&c.canonical.y===(1<<c.canonical.z)-1,I=`m_${_?"n":""}_${T?"s":""}`;if(this._meshCache[I])return this._meshCache[I];const z=this.painter.context,U=new a.ci,q=new a.aH,J=this.meshSize,se=a.Z/J,ne=J*J;for(let et=0;et<=J;et++)for(let vt=0;vt<=J;vt++)U.emplaceBack(vt*se,et*se,0);for(let et=0;et<ne;et+=J+1)for(let vt=0;vt<J;vt++)q.emplaceBack(vt+et,J+vt+et+1,J+vt+et+2),q.emplaceBack(vt+et,J+vt+et+2,vt+et+1);const pe=U.length,ye=pe+(J+1),De=(J+1)*J,Ee=_?a.b9:0,Le=_?0:1,ze=T?a.ba:a.Z,We=T?0:1;for(let et=0;et<=J;et++)U.emplaceBack(et*se,Ee,Le);for(let et=0;et<=J;et++)U.emplaceBack(et*se,ze,We);for(let et=0;et<J;et++)q.emplaceBack(De+et,ye+et,ye+et+1),q.emplaceBack(De+et,ye+et+1,De+et+1),q.emplaceBack(0+et,pe+et+1,pe+et),q.emplaceBack(0+et,0+et+1,pe+et+1);const Qe=U.length,Ke=Qe+2*(J+1);for(const et of[0,1])for(let vt=0;vt<=J;vt++)for(const gt of[0,1])U.emplaceBack(et*a.Z,vt*se,gt);for(let et=0;et<2*J;et+=2)q.emplaceBack(Qe+et,Qe+et+1,Qe+et+3),q.emplaceBack(Qe+et,Qe+et+3,Qe+et+2),q.emplaceBack(Ke+et,Ke+et+3,Ke+et+1),q.emplaceBack(Ke+et,Ke+et+2,Ke+et+3);const at=new lr(z.createVertexBuffer(U,ib.members),z.createIndexBuffer(q),a.aG.simpleSegment(0,0,U.length,q.length));return this._meshCache[I]=at,at}getMeshFrameDelta(c){return 2*Math.PI*a.br/Math.pow(2,Math.max(c,0))/5}getMinTileElevationForLngLatZoom(c,f){var b;const{tileID:_}=this._getOverscaledTileIDFromLngLatZoom(c,f);return(b=this.getMinMaxElevation(_).minElevation)!==null&&b!==void 0?b:0}getMinMaxElevation(c){const f=this.getTerrainData(c).tile,b={minElevation:null,maxElevation:null};return f&&f.dem&&(b.minElevation=f.dem.min*this.exaggeration,b.maxElevation=f.dem.max*this.exaggeration),b}_getOverscaledTileIDFromLngLatZoom(c,f){const b=a.$.fromLngLat(c.wrap()),_=(1<<f)*a.Z,T=b.x*_,I=b.y*_,z=Math.floor(T/a.Z),U=Math.floor(I/a.Z);return{tileID:new a.Y(f,0,f,z,U),mercatorX:T,mercatorY:I}}}class ZS{constructor(c,f,b){this._context=c,this._size=f,this._tileSize=b,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const c of this._objects)c.texture.destroy(),c.fbo.destroy()}_createObject(c){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),b=new Y(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return b.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(b.texture),{id:c,fbo:f,texture:b,stamp:-1,inUse:!1}}getObjectForId(c){return this._objects[c]}useObject(c){c.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>c.id!==f),this._recentlyUsed.push(c.id)}stampObject(c){c.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const c=this._createObject(this._objects.length);return this._objects.push(c),c}freeObject(c){c.inUse=!1}freeAllObjects(){for(const c of this._objects)this.freeObject(c)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(c=>!c.inUse)===!1}}const No={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class d2{constructor(c,f){this.painter=c,this.terrain=f,this.pool=new ZS(c.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(c){return this.pool.getObjectForId(c.rtt[this._stacks.length-1].id).texture}prepareForRender(c,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=c._order.filter(b=>!c._layers[b].isHidden(f)),this._coordsAscending={};for(const b in c.sourceCaches){this._coordsAscending[b]={};const _=c.sourceCaches[b].getVisibleCoordinates(),T=c.sourceCaches[b].getSource(),I=T instanceof st?T.terrainTileRanges:null;for(const z of _){const U=this.terrain.sourceCache.getTerrainCoords(z,I);for(const q in U)this._coordsAscending[b][q]||(this._coordsAscending[b][q]=[]),this._coordsAscending[b][q].push(U[q])}}this._coordsAscendingStr={};for(const b of c._order){const _=c._layers[b],T=_.source;if(No[_.type]&&!this._coordsAscendingStr[T]){this._coordsAscendingStr[T]={};for(const I in this._coordsAscending[T])this._coordsAscendingStr[T][I]=this._coordsAscending[T][I].map(z=>z.key).sort().join()}}for(const b of this._renderableTiles)for(const _ in this._coordsAscendingStr){const T=this._coordsAscendingStr[_][b.tileID.key];T&&T!==b.rttCoords[_]&&(b.rtt=[])}}renderLayer(c,f){if(c.isHidden(this.painter.transform.zoom))return!1;const b=Object.assign(Object.assign({},f),{isRenderingToTexture:!0}),_=c.type,T=this.painter,I=this._renderableLayerIds[this._renderableLayerIds.length-1]===c.id;if(No[_]&&(this._prevType&&No[this._prevType]||this._stacks.push([]),this._prevType=_,this._stacks[this._stacks.length-1].push(c.id),!I))return!0;if(No[this._prevType]||No[_]&&I){this._prevType=_;const z=this._stacks.length-1,U=this._stacks[z]||[];for(const q of this._renderableTiles){if(this.pool.isFull()&&(Dv(this.painter,this.terrain,this._rttTiles,b),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(q),q.rtt[z]){const se=this.pool.getObjectForId(q.rtt[z].id);if(se.stamp===q.rtt[z].stamp){this.pool.useObject(se);continue}}const J=this.pool.getOrCreateFreeObject();this.pool.useObject(J),this.pool.stampObject(J),q.rtt[z]={id:J.id,stamp:J.stamp},T.context.bindFramebuffer.set(J.fbo.framebuffer),T.context.clear({color:a.b7.transparent,stencil:0}),T.currentStencilSource=void 0;for(let se=0;se<U.length;se++){const ne=T.style._layers[U[se]],pe=ne.source?this._coordsAscending[ne.source][q.tileID.key]:[q.tileID];T.context.viewport.set([0,0,J.fbo.width,J.fbo.height]),T._renderTileClippingMasks(ne,pe,!0),T.renderLayer(T,T.style.sourceCaches[ne.source],ne,pe,b),ne.source&&(q.rttCoords[ne.source]=this._coordsAscendingStr[ne.source][q.tileID.key])}}return Dv(this.painter,this.terrain,this._rttTiles,b),this._rttTiles=[],this.pool.freeAllObjects(),No[_]}return!1}}const hm={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use â + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Wr=l,ss={hash:!1,interactive:!0,bearingSnap:7,attributionControl:um,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},XS={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class dm{constructor(c,f,b=!1){this.mousedown=T=>{this.startMove(T,y.mousePos(this.element,T)),y.addEventListener(window,"mousemove",this.mousemove),y.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.move(T,y.mousePos(this.element,T))},this.mouseup=T=>{this._rotatePitchHanlder.dragEnd(T),this.offTemp()},this.touchstart=T=>{T.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=y.touchPos(this.element,T.targetTouches)[0],this.startMove(T,this._startPos),y.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{T.targetTouches.length!==1?this.reset():(this._lastPos=y.touchPos(this.element,T.targetTouches)[0],this.move(T,this._lastPos))},this.touchend=T=>{T.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=f;const _=new HS;this._rotatePitchHanlder=new Mf({clickTolerance:3,move:(T,I)=>{const z=f.getBoundingClientRect(),U=new a.P((z.bottom-z.top)/2,(z.right-z.left)/2);return{bearingDelta:a.ca(new a.P(T.x,I.y),I,U),pitchDelta:b?-.5*(I.y-T.y):void 0}},moveStateManager:_,enable:!0,assignEvents:()=>{}}),this.map=c,y.addEventListener(f,"mousedown",this.mousedown),y.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),y.addEventListener(f,"touchcancel",this.reset)}startMove(c,f){this._rotatePitchHanlder.dragStart(c,f),y.disableDrag()}move(c,f){const b=this.map,{bearingDelta:_,pitchDelta:T}=this._rotatePitchHanlder.dragMove(c,f)||{};_&&b.setBearing(b.getBearing()+_),T&&b.setPitch(b.getPitch()+T)}off(){const c=this.element;y.removeEventListener(c,"mousedown",this.mousedown),y.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.removeEventListener(window,"touchend",this.touchend),y.removeEventListener(c,"touchcancel",this.reset),this.offTemp()}offTemp(){y.enableDrag(),y.removeEventListener(window,"mousemove",this.mousemove),y.removeEventListener(window,"mouseup",this.mouseup),y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.removeEventListener(window,"touchend",this.touchend)}}let fc;function zv(S,c,f){const b=new a.Q(S.lng,S.lat);if(S=new a.Q(S.lng,S.lat),c){const _=new a.Q(S.lng-360,S.lat),T=new a.Q(S.lng+360,S.lat),I=f.locationToScreenPoint(S).distSqr(c);f.locationToScreenPoint(_).distSqr(c)<I?S=_:f.locationToScreenPoint(T).distSqr(c)<I&&(S=T)}for(;Math.abs(S.lng-f.center.lng)>180;){const _=f.locationToScreenPoint(S);if(_.x>=0&&_.y>=0&&_.x<=f.width&&_.y<=f.height)break;S.lng>f.center.lng?S.lng-=360:S.lng+=360}return S.lng!==b.lng&&f.isPointOnMapSurface(f.locationToScreenPoint(S))?S:b}const fm={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vv(S,c,f){const b=S.classList;for(const _ in fm)b.remove(`maplibregl-${f}-anchor-${_}`);b.add(`maplibregl-${f}-anchor-${c}`)}class Jh extends a.E{constructor(c){if(super(),this._onKeyPress=f=>{const b=f.code,_=f.charCode||f.keyCode;b!=="Space"&&b!=="Enter"&&_!==32&&_!==13||this.togglePopup()},this._onMapClick=f=>{const b=f.originalEvent.target,_=this._element;this._popup&&(b===_||_.contains(b))&&this.togglePopup()},this._update=f=>{var b;if(!this._map)return;const _=this._map.loaded()&&!this._map.isMoving();(f?.type==="terrain"||f?.type==="render"&&!_)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?zv(this._lngLat,this._flatPos,this._map.transform):(b=this._lngLat)===null||b===void 0?void 0:b.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let T="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?T=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(T=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||f&&f.type!=="moveend"||(this._pos=this._pos.round()),y.setTransform(this._element,`${fm[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${I} ${T}`),v.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const b=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=b}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.l("dragstart"))),this.fire(new a.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.l("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._subpixelPositioning=c&&c.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,this.setOpacity(c?.opacity,c?.opacityWhenCovered),c&&c.element)this._element=c.element,this._offset=a.P.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=y.create("div");const f=y.createNS("http://www.w3.org/2000/svg","svg"),b=41,_=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${b}px`),f.setAttributeNS(null,"width",`${_}px`),f.setAttributeNS(null,"viewBox",`0 0 ${_} ${b}`);const T=y.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");const I=y.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const z=y.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");const U=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Le of U){const ze=y.createNS("http://www.w3.org/2000/svg","ellipse");ze.setAttributeNS(null,"opacity","0.04"),ze.setAttributeNS(null,"cx","10.5"),ze.setAttributeNS(null,"cy","5.80029008"),ze.setAttributeNS(null,"rx",Le.rx),ze.setAttributeNS(null,"ry",Le.ry),z.appendChild(ze)}const q=y.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"fill",this._color);const J=y.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),q.appendChild(J);const se=y.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"fill","#000000");const ne=y.createNS("http://www.w3.org/2000/svg","path");ne.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),se.appendChild(ne);const pe=y.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),pe.setAttributeNS(null,"fill","#FFFFFF");const ye=y.createNS("http://www.w3.org/2000/svg","g");ye.setAttributeNS(null,"transform","translate(8.0, 8.0)");const De=y.createNS("http://www.w3.org/2000/svg","circle");De.setAttributeNS(null,"fill","#000000"),De.setAttributeNS(null,"opacity","0.25"),De.setAttributeNS(null,"cx","5.5"),De.setAttributeNS(null,"cy","5.5"),De.setAttributeNS(null,"r","5.4999962");const Ee=y.createNS("http://www.w3.org/2000/svg","circle");Ee.setAttributeNS(null,"fill","#FFFFFF"),Ee.setAttributeNS(null,"cx","5.5"),Ee.setAttributeNS(null,"cy","5.5"),Ee.setAttributeNS(null,"r","5.4999962"),ye.appendChild(De),ye.appendChild(Ee),I.appendChild(z),I.appendChild(q),I.appendChild(se),I.appendChild(pe),I.appendChild(ye),f.appendChild(I),f.setAttributeNS(null,"height",b*this._scale+"px"),f.setAttributeNS(null,"width",_*this._scale+"px"),this._element.appendChild(f),this._offset=a.P.convert(c&&c.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),Vv(this._element,this._anchor,"marker"),c&&c.className)for(const f of c.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(c){return this.remove(),this._map=c,this._element.setAttribute("aria-label",c._getUIString("Marker.Title")),c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),c.on("terrain",this._update),c.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),y.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=a.Q.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const _=Math.abs(13.5)/Math.SQRT2;c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(c){return this._subpixelPositioning=c,this}getPopup(){return this._popup}togglePopup(){const c=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:c?(c.isOpen()?c.remove():(c.setLngLat(this._lngLat),c.addTo(this._map)),this):this}_updateOpacity(c=!1){var f,b;if(!(!((f=this._map)===null||f===void 0)&&f.terrain)){const se=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==se&&(this._element.style.opacity=se))}if(c)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const _=this._map,T=_.terrain.depthAtPoint(this._pos),I=_.terrain.getElevationForLngLatZoom(this._lngLat,_.transform.tileZoom);if(_.transform.lngLatToCameraDepth(this._lngLat,I)-T<.006)return void(this._element.style.opacity=this._opacity);const z=-this._offset.y/_.transform.pixelsPerMeter,U=Math.sin(_.getPitch()*Math.PI/180)*z,q=_.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),J=_.transform.lngLatToCameraDepth(this._lngLat,I+U)-q>.006;!((b=this._popup)===null||b===void 0)&&b.isOpen()&&J&&this._popup.remove(),this._element.style.opacity=J?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(c){return this._offset=a.P.convert(c),this._update(),this}addClassName(c){this._element.classList.add(c)}removeClassName(c){this._element.classList.remove(c)}toggleClassName(c){return this._element.classList.toggle(c)}setDraggable(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(c,f){return(this._opacity===void 0||c===void 0&&f===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),c!==void 0&&(this._opacity=c),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const rb={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Rf=0,ed=!1;const sb={maxWidth:100,unit:"metric"};function Gv(S,c,f){const b=f&&f.maxWidth||100,_=S._container.clientHeight/2,T=S._container.clientWidth/2,I=S.unproject([T-b/2,_]),z=S.unproject([T+b/2,_]),U=Math.round(S.project(z).x-S.project(I).x),q=Math.min(b,U,S._container.clientWidth),J=I.distanceTo(z);if(f&&f.unit==="imperial"){const se=3.2808*J;se>5280?td(c,q,se/5280,S._getUIString("ScaleControl.Miles")):td(c,q,se,S._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?td(c,q,J/1852,S._getUIString("ScaleControl.NauticalMiles")):J>=1e3?td(c,q,J/1e3,S._getUIString("ScaleControl.Kilometers")):td(c,q,J,S._getUIString("ScaleControl.Meters"))}function td(S,c,f,b){const _=function(T){const I=Math.pow(10,`${Math.floor(T)}`.length-1);let z=T/I;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(U){const q=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*q)/q}(z),I*z}(f);S.style.width=c*(_/f)+"px",S.innerHTML=`${_}&nbsp;${b}`}const ob={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},ab=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function pm(S){if(S){if(typeof S=="number"){const c=Math.round(Math.abs(S)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,S),"top-left":new a.P(c,c),"top-right":new a.P(-c,c),bottom:new a.P(0,-S),"bottom-left":new a.P(c,-c),"bottom-right":new a.P(-c,-c),left:new a.P(S,0),right:new a.P(-S,0)}}if(S instanceof a.P||Array.isArray(S)){const c=a.P.convert(S);return{center:c,top:c,"top-left":c,"top-right":c,bottom:c,"bottom-left":c,"bottom-right":c,left:c,right:c}}return{center:a.P.convert(S.center||[0,0]),top:a.P.convert(S.top||[0,0]),"top-left":a.P.convert(S["top-left"]||[0,0]),"top-right":a.P.convert(S["top-right"]||[0,0]),bottom:a.P.convert(S.bottom||[0,0]),"bottom-left":a.P.convert(S["bottom-left"]||[0,0]),"bottom-right":a.P.convert(S["bottom-right"]||[0,0]),left:a.P.convert(S.left||[0,0]),right:a.P.convert(S.right||[0,0])}}return pm(new a.P(0,0))}const lb=l;o.AJAXError=a.cm,o.Event=a.l,o.Evented=a.E,o.LngLat=a.Q,o.MercatorCoordinate=a.$,o.Point=a.P,o.addProtocol=a.cn,o.config=a.a,o.removeProtocol=a.co,o.AttributionControl=zi,o.BoxZoomHandler=Kh,o.CanvasSource=he,o.CooperativeGesturesHandler=Fv,o.DoubleClickZoomHandler=tb,o.DragPanHandler=iu,o.DragRotateHandler=Tr,o.EdgeInsets=Ir,o.FullscreenControl=class extends a.E{constructor(S={}){super(),this._onFullscreenChange=()=>{var c;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((c=f?.shadowRoot)===null||c===void 0)&&c.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,S&&S.container&&(S.container instanceof HTMLElement?this._container=S.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(S){return this._map=S,this._container||(this._container=this._map.getContainer()),this._controlContainer=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){y.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const S=this._fullscreenButton=y.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);y.create("span","maplibregl-ctrl-icon",S).setAttribute("aria-hidden","true"),S.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const S=this._getTitle();this._fullscreenButton.setAttribute("aria-label",S),this._fullscreenButton.title=S}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},o.GeoJSONSource=Ct,o.GeolocateControl=class extends a.E{constructor(S){super(),this._onSuccess=c=>{if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new a.l("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.l("geolocate",c)),this._finish()}},this._updateCamera=c=>{const f=new a.Q(c.coords.longitude,c.coords.latitude),b=c.coords.accuracy,_=this._map.getBearing(),T=a.e({bearing:_},this.options.fitBoundsOptions),I=Re.fromLngLat(f,b);this._map.fitBounds(I,T,{geolocateSource:!0})},this._updateMarker=c=>{if(c){const f=new a.Q(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=c=>{if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&ed)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.l("error",c)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=y.create("button","maplibregl-ctrl-geolocate",this._container),y.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=c=>{if(this._map){if(c===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=y.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Jh({element:this._dotElement}),this._circleElement=y.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.l("trackuserlocationend")),this.fire(new a.l("userlocationlostfocus")))})}},this.options=a.e({},rb,S)}onAdd(S){return this._map=S,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(c=!1){if(fc!==void 0&&!c)return fc;if(window.navigator.permissions===void 0)return fc=!!window.navigator.geolocation,fc;try{fc=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{fc=!!window.navigator.geolocation}return fc})}().then(c=>this._finishSetupUI(c)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),y.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Rf=0,ed=!1}_isOutOfMapMaxBounds(S){const c=this._map.getMaxBounds(),f=S.coords;return c&&(f.longitude<c.getWest()||f.longitude>c.getEast()||f.latitude<c.getSouth()||f.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const S=this._map.getBounds(),c=S.getSouthEast(),f=S.getNorthEast(),b=c.distanceTo(f),_=Math.ceil(this._accuracy/(b/this._map._container.clientHeight)*2);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Rf--,ed=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.l("trackuserlocationstart")),this.fire(new a.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let S;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Rf++,Rf>1?(S={maximumAge:6e5,timeout:0},ed=!0):(S=this.options.positionOptions,ed=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,S)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},o.GlobeControl=class{constructor(){this._toggleProjection=()=>{var S;const c=(S=this._map.getProjection())===null||S===void 0?void 0:S.type;this._map.setProjection(c!=="mercator"&&c?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var S;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((S=this._map.getProjection())===null||S===void 0?void 0:S.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(S){return this._map=S,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=y.create("button","maplibregl-ctrl-globe",this._container),y.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){y.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},o.Hash=Qx,o.ImageSource=st,o.KeyboardHandler=Yx,o.LngLatBounds=Re,o.LogoControl=Ji,o.Map=class extends dc{constructor(S){var c,f;a.cj.mark(a.ck.create);const b=Object.assign(Object.assign(Object.assign({},ss),S),{canvasContextAttributes:Object.assign(Object.assign({},ss.canvasContextAttributes),S.canvasContextAttributes)});if(b.minZoom!=null&&b.maxZoom!=null&&b.minZoom>b.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(b.minPitch!=null&&b.maxPitch!=null&&b.minPitch>b.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(b.minPitch!=null&&b.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(b.maxPitch!=null&&b.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const _=new kr,T=new Yo;if(b.minZoom!==void 0&&_.setMinZoom(b.minZoom),b.maxZoom!==void 0&&_.setMaxZoom(b.maxZoom),b.minPitch!==void 0&&_.setMinPitch(b.minPitch),b.maxPitch!==void 0&&_.setMaxPitch(b.maxPitch),b.renderWorldCopies!==void 0&&_.setRenderWorldCopies(b.renderWorldCopies),super(_,T,{bearingSnap:b.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Bv,this._controls=[],this._mapId=a.a4(),this._contextLost=z=>{z.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.l("webglcontextlost",{originalEvent:z}))},this._contextRestored=z=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.l("webglcontextrestored",{originalEvent:z}))},this._onMapScroll=z=>{if(z.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=b.interactive,this._maxTileCacheSize=b.maxTileCacheSize,this._maxTileCacheZoomLevels=b.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},b.canvasContextAttributes),this._trackResize=b.trackResize===!0,this._bearingSnap=b.bearingSnap,this._centerClampedToGround=b.centerClampedToGround,this._refreshExpiredTiles=b.refreshExpiredTiles===!0,this._fadeDuration=b.fadeDuration,this._crossSourceCollisions=b.crossSourceCollisions===!0,this._collectResourceTiming=b.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},hm),b.locale),this._clickTolerance=b.clickTolerance,this._overridePixelRatio=b.pixelRatio,this._maxCanvasSize=b.maxCanvasSize,this.transformCameraUpdate=b.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=b.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=k.addThrottleControl(()=>this.isMoving()),this._requestManager=new $(b.transformRequest),typeof b.container=="string"){if(this._container=document.getElementById(b.container),!this._container)throw new Error(`Container '${b.container}' not found.`)}else{if(!(b.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=b.container}if(b.maxBounds&&this.setMaxBounds(b.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let z=!1;const U=jx(q=>{this._trackResize&&!this._removed&&(this.resize(q),this.redraw())},50);this._resizeObserver=new ResizeObserver(q=>{z?U(q):z=!0}),this._resizeObserver.observe(this._container)}this.handlers=new h2(this,b),this._hash=b.hash&&new Qx(typeof b.hash=="string"&&b.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:b.center,elevation:b.elevation,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch,roll:b.roll}),b.bounds&&(this.resize(),this.fitBounds(b.bounds,a.e({},b.fitBoundsOptions,{duration:0}))));const I=typeof b.style=="string"||((f=(c=b.style)===null||c===void 0?void 0:c.projection)===null||f===void 0?void 0:f.type)!=="globe";this.resize(null,I),this._localIdeographFontFamily=b.localIdeographFontFamily,this._validateStyle=b.validateStyle,b.style&&this.setStyle(b.style,{localIdeographFontFamily:b.localIdeographFontFamily}),b.attributionControl&&this.addControl(new zi(typeof b.attributionControl=="boolean"?void 0:b.attributionControl)),b.maplibreLogo&&this.addControl(new Ji,b.logoPosition),this.on("style.load",()=>{if(I||this._resizeTransform(),this.transform.unmodified){const z=a.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(z)}}),this.on("data",z=>{this._update(z.dataType==="style"),this.fire(new a.l(`${z.dataType}data`,z))}),this.on("dataloading",z=>{this.fire(new a.l(`${z.dataType}dataloading`,z))}),this.on("dataabort",z=>{this.fire(new a.l("sourcedataabort",z))})}_getMapId(){return this._mapId}addControl(S,c){if(c===void 0&&(c=S.getDefaultPosition?S.getDefaultPosition():"top-right"),!S||!S.onAdd)return this.fire(new a.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=S.onAdd(this);this._controls.push(S);const b=this._controlPositions[c];return c.indexOf("bottom")!==-1?b.insertBefore(f,b.firstChild):b.appendChild(f),this}removeControl(S){if(!S||!S.onRemove)return this.fire(new a.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(S);return c>-1&&this._controls.splice(c,1),S.onRemove(this),this}hasControl(S){return this._controls.indexOf(S)>-1}calculateCameraOptionsFromTo(S,c,f,b){return b==null&&this.terrain&&(b=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(S,c,f,b)}resize(S,c=!0){const[f,b]=this._containerDimensions(),_=this._getClampedPixelRatio(f,b);if(this._resizeCanvas(f,b,_),this.painter.resize(f,b,_),this.painter.overLimit()){const I=this.painter.context.gl;this._maxCanvasSize=[I.drawingBufferWidth,I.drawingBufferHeight];const z=this._getClampedPixelRatio(f,b);this._resizeCanvas(f,b,z),this.painter.resize(f,b,z)}this._resizeTransform(c);const T=!this._moving;return T&&(this.stop(),this.fire(new a.l("movestart",S)).fire(new a.l("move",S))),this.fire(new a.l("resize",S)),T&&this.fire(new a.l("moveend",S)),this}_resizeTransform(S=!0){var c;const[f,b]=this._containerDimensions();this.transform.resize(f,b,S),(c=this._requestedCameraState)===null||c===void 0||c.resize(f,b,S)}_getClampedPixelRatio(S,c){const{0:f,1:b}=this._maxCanvasSize,_=this.getPixelRatio(),T=S*_,I=c*_;return Math.min(T>f?f/T:1,I>b?b/I:1)*_}getPixelRatio(){var S;return(S=this._overridePixelRatio)!==null&&S!==void 0?S:devicePixelRatio}setPixelRatio(S){this._overridePixelRatio=S,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(S){return this.transform.setMaxBounds(Re.convert(S)),this._update()}setMinZoom(S){if((S=S??-2)>=-2&&S<=this.transform.maxZoom)return this.transform.setMinZoom(S),this._update(),this.getZoom()<S&&this.setZoom(S),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(S){if((S=S??22)>=this.transform.minZoom)return this.transform.setMaxZoom(S),this._update(),this.getZoom()>S&&this.setZoom(S),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(S){if((S=S??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(S>=0&&S<=this.transform.maxPitch)return this.transform.setMinPitch(S),this._update(),this.getPitch()<S&&this.setPitch(S),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(S){if((S=S??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(S>=this.transform.minPitch)return this.transform.setMaxPitch(S),this._update(),this.getPitch()>S&&this.setPitch(S),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(S){return this.transform.setRenderWorldCopies(S),this._update()}project(S){return this.transform.locationToScreenPoint(a.Q.convert(S),this.style&&this.terrain)}unproject(S){return this.transform.screenPointToLocation(a.P.convert(S),this.terrain)}isMoving(){var S;return this._moving||((S=this.handlers)===null||S===void 0?void 0:S.isMoving())}isZooming(){var S;return this._zooming||((S=this.handlers)===null||S===void 0?void 0:S.isZooming())}isRotating(){var S;return this._rotating||((S=this.handlers)===null||S===void 0?void 0:S.isRotating())}_createDelegatedListener(S,c,f){if(S==="mouseenter"||S==="mouseover"){let b=!1;return{layers:c,listener:f,delegates:{mousemove:T=>{const I=c.filter(U=>this.getLayer(U)),z=I.length!==0?this.queryRenderedFeatures(T.point,{layers:I}):[];z.length?b||(b=!0,f.call(this,new Co(S,this,T.originalEvent,{features:z}))):b=!1},mouseout:()=>{b=!1}}}}if(S==="mouseleave"||S==="mouseout"){let b=!1;return{layers:c,listener:f,delegates:{mousemove:I=>{const z=c.filter(U=>this.getLayer(U));(z.length!==0?this.queryRenderedFeatures(I.point,{layers:z}):[]).length?b=!0:b&&(b=!1,f.call(this,new Co(S,this,I.originalEvent)))},mouseout:I=>{b&&(b=!1,f.call(this,new Co(S,this,I.originalEvent)))}}}}{const b=_=>{const T=c.filter(z=>this.getLayer(z)),I=T.length!==0?this.queryRenderedFeatures(_.point,{layers:T}):[];I.length&&(_.features=I,f.call(this,_),delete _.features)};return{layers:c,listener:f,delegates:{[S]:b}}}}_saveDelegatedListener(S,c){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[S]=this._delegatedListeners[S]||[],this._delegatedListeners[S].push(c)}_removeDelegatedListener(S,c,f){if(!this._delegatedListeners||!this._delegatedListeners[S])return;const b=this._delegatedListeners[S];for(let _=0;_<b.length;_++){const T=b[_];if(T.listener===f&&T.layers.length===c.length&&T.layers.every(I=>c.includes(I))){for(const I in T.delegates)this.off(I,T.delegates[I]);return void b.splice(_,1)}}}on(S,c,f){if(f===void 0)return super.on(S,c);const b=typeof c=="string"?[c]:c,_=this._createDelegatedListener(S,b,f);this._saveDelegatedListener(S,_);for(const T in _.delegates)this.on(T,_.delegates[T]);return{unsubscribe:()=>{this._removeDelegatedListener(S,b,f)}}}once(S,c,f){if(f===void 0)return super.once(S,c);const b=typeof c=="string"?[c]:c,_=this._createDelegatedListener(S,b,f);for(const T in _.delegates){const I=_.delegates[T];_.delegates[T]=(...z)=>{this._removeDelegatedListener(S,b,f),I(...z)}}this._saveDelegatedListener(S,_);for(const T in _.delegates)this.once(T,_.delegates[T]);return this}off(S,c,f){return f===void 0?super.off(S,c):(this._removeDelegatedListener(S,typeof c=="string"?[c]:c,f),this)}queryRenderedFeatures(S,c){if(!this.style)return[];let f;const b=S instanceof a.P||Array.isArray(S),_=b?S:[[0,0],[this.transform.width,this.transform.height]];if(c=c||(b?{}:S)||{},_ instanceof a.P||typeof _[0]=="number")f=[a.P.convert(_)];else{const T=a.P.convert(_[0]),I=a.P.convert(_[1]);f=[T,new a.P(I.x,T.y),I,new a.P(T.x,I.y),T]}return this.style.queryRenderedFeatures(f,c,this.transform)}querySourceFeatures(S,c){return this.style.querySourceFeatures(S,c)}setStyle(S,c){return(c=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},c)).diff!==!1&&c.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&S?(this._diffStyle(S,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._updateStyle(S,c))}setTransformRequest(S){return this._requestManager.setTransformRequest(S),this}_getUIString(S){const c=this._locale[S];if(c==null)throw new Error(`Missing UI string '${S}'`);return c}_updateStyle(S,c){var f,b;if(c.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(S,c));const _=this.style&&c.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!S)),S?(this.style=new df(this,c||{}),this.style.setEventedParent(this,{style:this.style}),typeof S=="string"?this.style.loadURL(S,c,_):this.style.loadJSON(S,c,_),this):((b=(f=this.style)===null||f===void 0?void 0:f.projection)===null||b===void 0||b.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new df(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(S,c){if(typeof S=="string"){const f=this._requestManager.transformRequest(S,"Style");a.j(f,new AbortController).then(b=>{this._updateDiff(b.data,c)}).catch(b=>{b&&this.fire(new a.k(b))})}else typeof S=="object"&&this._updateDiff(S,c)}_updateDiff(S,c){try{this.style.setState(S,c)&&this._update(!0)}catch(f){a.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(S,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(S,c){return this._lazyInitEmptyStyle(),this.style.addSource(S,c),this._update(!0)}isSourceLoaded(S){const c=this.style&&this.style.sourceCaches[S];if(c!==void 0)return c.loaded();this.fire(new a.k(new Error(`There is no source with ID '${S}'`)))}setTerrain(S){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),S){const c=this.style.sourceCaches[S.source];if(!c)throw new Error(`cannot load terrain, because there exists no source with ID: ${S.source}`);this.terrain===null&&c.reload();for(const f in this.style._layers){const b=this.style._layers[f];b.type==="hillshade"&&b.source===S.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ea(this.painter,c,S),this.painter.renderToTexture=new d2(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=f=>{var b;f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==S.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((b=f.source)===null||b===void 0?void 0:b.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new a.l("terrain",{terrain:S})),this}getTerrain(){var S,c;return(c=(S=this.terrain)===null||S===void 0?void 0:S.options)!==null&&c!==void 0?c:null}areTilesLoaded(){const S=this.style&&this.style.sourceCaches;for(const c in S){const f=S[c]._tiles;for(const b in f){const _=f[b];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}removeSource(S){return this.style.removeSource(S),this._update(!0)}getSource(S){return this.style.getSource(S)}addImage(S,c,f={}){const{pixelRatio:b=1,sdf:_=!1,stretchX:T,stretchY:I,content:z,textFitWidth:U,textFitHeight:q}=f;if(this._lazyInitEmptyStyle(),!(c instanceof HTMLImageElement||a.b(c))){if(c.width===void 0||c.height===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:J,height:se,data:ne}=c,pe=c;return this.style.addImage(S,{data:new a.R({width:J,height:se},new Uint8Array(ne)),pixelRatio:b,stretchX:T,stretchY:I,content:z,textFitWidth:U,textFitHeight:q,sdf:_,version:0,userImage:pe}),pe.onAdd&&pe.onAdd(this,S),this}}{const{width:J,height:se,data:ne}=v.getImageData(c);this.style.addImage(S,{data:new a.R({width:J,height:se},ne),pixelRatio:b,stretchX:T,stretchY:I,content:z,textFitWidth:U,textFitHeight:q,sdf:_,version:0})}}updateImage(S,c){const f=this.style.getImage(S);if(!f)return this.fire(new a.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const b=c instanceof HTMLImageElement||a.b(c)?v.getImageData(c):c,{width:_,height:T,data:I}=b;if(_===void 0||T===void 0)return this.fire(new a.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==f.data.width||T!==f.data.height)return this.fire(new a.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const z=!(c instanceof HTMLImageElement||a.b(c));return f.data.replace(I,z),this.style.updateImage(S,f),this}getImage(S){return this.style.getImage(S)}hasImage(S){return S?!!this.style.getImage(S):(this.fire(new a.k(new Error("Missing required image id"))),!1)}removeImage(S){this.style.removeImage(S)}loadImage(S){return k.getImage(this._requestManager.transformRequest(S,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(S,c){return this._lazyInitEmptyStyle(),this.style.addLayer(S,c),this._update(!0)}moveLayer(S,c){return this.style.moveLayer(S,c),this._update(!0)}removeLayer(S){return this.style.removeLayer(S),this._update(!0)}getLayer(S){return this.style.getLayer(S)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(S,c,f){return this.style.setLayerZoomRange(S,c,f),this._update(!0)}setFilter(S,c,f={}){return this.style.setFilter(S,c,f),this._update(!0)}getFilter(S){return this.style.getFilter(S)}setPaintProperty(S,c,f,b={}){return this.style.setPaintProperty(S,c,f,b),this._update(!0)}getPaintProperty(S,c){return this.style.getPaintProperty(S,c)}setLayoutProperty(S,c,f,b={}){return this.style.setLayoutProperty(S,c,f,b),this._update(!0)}getLayoutProperty(S,c){return this.style.getLayoutProperty(S,c)}setGlyphs(S,c={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(S,c),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(S,c,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(S,c,f,b=>{b||this._update(!0)}),this}removeSprite(S){return this._lazyInitEmptyStyle(),this.style.removeSprite(S),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(S,c={}){return this._lazyInitEmptyStyle(),this.style.setSprite(S,c,f=>{f||this._update(!0)}),this}setLight(S,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(S,c),this._update(!0)}getLight(){return this.style.getLight()}setSky(S,c={}){return this._lazyInitEmptyStyle(),this.style.setSky(S,c),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(S,c){return this.style.setFeatureState(S,c),this._update()}removeFeatureState(S,c){return this.style.removeFeatureState(S,c),this._update()}getFeatureState(S){return this.style.getFeatureState(S)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let S=0,c=0;return this._container&&(S=this._container.clientWidth||400,c=this._container.clientHeight||300),[S,c]}_setupContainer(){const S=this._container;S.classList.add("maplibregl-map");const c=this._canvasContainer=y.create("div","maplibregl-canvas-container",S);this._interactive&&c.classList.add("maplibregl-interactive"),this._canvas=y.create("canvas","maplibregl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),b=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],b);const _=this._controlContainer=y.create("div","maplibregl-control-container",S),T=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{T[I]=y.create("div",`maplibregl-ctrl-${I} `,_)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(S,c,f){this._canvas.width=Math.floor(f*S),this._canvas.height=Math.floor(f*c),this._canvas.style.width=`${S}px`,this._canvas.style.height=`${c}px`}_setupPainter(){const S=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let c=null;this._canvas.addEventListener("webglcontextcreationerror",b=>{c={requestedAttributes:S},b&&(c.statusMessage=b.statusMessage,c.type=b.type)},{once:!0});let f=null;if(f=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,S):this._canvas.getContext("webgl2",S)||this._canvas.getContext("webgl",S),!f){const b="Failed to initialize WebGL";throw c?(c.message=b,new Error(JSON.stringify(c))):new Error(b)}this.painter=new FS(f,this.transform),w.testSupport(f)}migrateProjection(S,c){super.migrateProjection(S,c),this.painter.transform=S,this.fire(new a.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(S){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||S,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(S){return this._update(),this._renderTaskQueue.add(S)}_cancelRenderFrame(S){this._renderTaskQueue.remove(S)}_render(S){var c,f,b,_,T;const I=this._idleTriggered?this._fadeDuration:0,z=((c=this.style.projection)===null||c===void 0?void 0:c.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(S),this._removed)return;let U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const se=this.transform.zoom,ne=v.now();this.style.zoomHistory.update(se,ne);const pe=new a.C(se,{now:ne,fadeDuration:I,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ye=pe.crossFadingFactor();ye===1&&ye===this._crossFadingFactor||(U=!0,this._crossFadingFactor=ye),this.style.update(pe)}const q=((f=this.style.projection)===null||f===void 0?void 0:f.transitionState)>0!==z;(b=this.style.projection)===null||b===void 0||b.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((_=this.style.projection)===null||_===void 0?void 0:_.transitionState,(T=this.style.projection)===null||T===void 0?void 0:T.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||q)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,I,this._crossSourceCollisions,q),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:I,showPadding:this.showPadding}),this.fire(new a.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.cj.mark(a.ck.load),this.fire(new a.l("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const J=this._sourcesDirty||this._styleDirty||this._placementDirty;return J||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.l("idle")),!this._loaded||this._fullyLoaded||J||(this._fullyLoaded=!0,a.cj.mark(a.ck.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var S;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),k.removeThrottleControl(this._imageQueueHandle),(S=this._resizeObserver)===null||S===void 0||S.disconnect();const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c?.loseContext&&c.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),y.remove(this._canvasContainer),y.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),a.cj.clearMetrics(),this._removed=!0,this.fire(new a.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,v.frame(this._frameRequest,S=>{a.cj.frame(S),this._frameRequest=null;try{this._render(S)}catch(c){if(!a.cl(c)&&!function(f){return f.message===AS}(c))throw c}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(S){this._showTileBoundaries!==S&&(this._showTileBoundaries=S,this._update())}get showPadding(){return!!this._showPadding}set showPadding(S){this._showPadding!==S&&(this._showPadding=S,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(S){this._showCollisionBoxes!==S&&(this._showCollisionBoxes=S,S?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(S){this._showOverdrawInspector!==S&&(this._showOverdrawInspector=S,this._update())}get repaint(){return!!this._repaint}set repaint(S){this._repaint!==S&&(this._repaint=S,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(S){this._vertices=S,this._update()}get version(){return Wr}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(S){return this._lazyInitEmptyStyle(),this.style.setProjection(S),this._update(!0)}},o.MapMouseEvent=Co,o.MapTouchEvent=Of,o.MapWheelEvent=tl,o.Marker=Jh,o.NavigationControl=class{constructor(S){this._updateZoomButtons=()=>{const c=this._map.getZoom(),f=c===this._map.getMaxZoom(),b=c===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=b,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",b.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(c,f)=>{const b=this._map._getUIString(`NavigationControl.${f}`);c.title=b,c.setAttribute("aria-label",b)},this.options=a.e({},XS,S),this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",c=>this._map.zoomIn({},{originalEvent:c})),y.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",c=>this._map.zoomOut({},{originalEvent:c})),y.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",c=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:c}):this._map.resetNorth({},{originalEvent:c})}),this._compassIcon=y.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(S){return this._map=S,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new dm(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(S,c){const f=y.create("button",S,this._container);return f.type="button",f.addEventListener("click",c),f}},o.Popup=class extends a.E{constructor(S){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&y.remove(this._content),this._container&&(y.remove(this._container),delete this._container),this._closeButton&&this._closeButton.removeEventListener("click",this._onClose),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.l("close"))),this),this._onMouseUp=c=>{this._update(c.point)},this._onMouseMove=c=>{this._update(c.point)},this._onDrag=c=>{this._update(c.point)},this._update=c=>{var f;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=y.create("div","maplibregl-popup",this._map.getContainer()),this._tip=y.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const z of this.options.className.split(" "))this._container.classList.add(z);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?zv(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!c)return;const b=this._flatPos=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&c?c:this._map.transform.locationToScreenPoint(this._lngLat));let _=this.options.anchor;const T=pm(this.options.offset);if(!_){const z=this._container.offsetWidth,U=this._container.offsetHeight;let q;q=b.y+T.bottom.y<U?["top"]:b.y>this._map.transform.height-U?["bottom"]:[],b.x<z/2?q.push("left"):b.x>this._map.transform.width-z/2&&q.push("right"),_=q.length===0?"bottom":q.join("-")}let I=b.add(T[_]);this.options.subpixelPositioning||(I=I.round()),y.setTransform(this._container,`${fm[_]} translate(${I.x}px,${I.y}px)`),Vv(this._container,_,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(ob),S)}addTo(S){return this._map&&this.remove(),this._map=S,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(S){return this._lngLat=a.Q.convert(S),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(S){return this.setDOMContent(document.createTextNode(S))}setHTML(S){const c=document.createDocumentFragment(),f=document.createElement("body");let b;for(f.innerHTML=S;b=f.firstChild,b;)c.appendChild(b);return this.setDOMContent(c)}getMaxWidth(){var S;return(S=this._container)===null||S===void 0?void 0:S.style.maxWidth}setMaxWidth(S){return this.options.maxWidth=S,this._update(),this}setDOMContent(S){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=y.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(S),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(S){return this._container&&this._container.classList.add(S),this}removeClassName(S){return this._container&&this._container.classList.remove(S),this}setOffset(S){return this.options.offset=S,this._update(),this}toggleClassName(S){if(this._container)return this._container.classList.toggle(S)}setSubpixelPositioning(S){this.options.subpixelPositioning=S}_createCloseButton(){this.options.closeButton&&(this._closeButton=y.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const S=this._container.querySelector(ab);S&&S.focus()}},o.RasterDEMTileSource=Ye,o.RasterTileSource=Pe,o.ScaleControl=class{constructor(S){this._onMove=()=>{Gv(this._map,this._container,this.options)},this.setUnit=c=>{this.options.unit=c,Gv(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},sb),S)}getDefaultPosition(){return"bottom-left"}onAdd(S){return this._map=S,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-scale",S.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},o.ScrollZoomHandler=jS,o.Style=df,o.TerrainControl=class{constructor(S){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=S}onAdd(S){return this._map=S,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=y.create("button","maplibregl-ctrl-terrain",this._container),y.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){y.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},o.TwoFingersTouchPitchHandler=qS,o.TwoFingersTouchRotateHandler=WS,o.TwoFingersTouchZoomHandler=An,o.TwoFingersTouchZoomRotateHandler=lm,o.VectorTileSource=it,o.VideoSource=we,o.addSourceType=(S,c)=>a._(void 0,void 0,void 0,function*(){if(Be(S))throw new Error(`A source type called "${S}" already exists.`);((f,b)=>{xe[f]=b})(S,c)}),o.clearPrewarmedResources=function(){const S=Ge;S&&(S.isPreloaded()&&S.numActive()===1?(S.release(je),Ge=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.createTileMesh=hv,o.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},o.getRTLTextPluginStatus=function(){return ot().getRTLTextPluginStatus()},o.getVersion=function(){return lb},o.getWorkerCount=function(){return qe.workerCount},o.getWorkerUrl=function(){return a.a.WORKER_URL},o.importScriptInWorkers=function(S){return Ot().broadcast("IS",S)},o.prewarm=function(){mt().acquire(je)},o.setMaxParallelImageRequests=function(S){a.a.MAX_PARALLEL_IMAGE_REQUESTS=S},o.setRTLTextPlugin=function(S,c){return ot().setRTLTextPlugin(S,c)},o.setWorkerCount=function(S){qe.workerCount=S},o.setWorkerUrl=function(S){a.a.WORKER_URL=S}});var s=i;return s})})(tH);var W5e=tH.exports;const Da=wle(W5e);var Zb=iH;function iH(t,e){return t===e||t!==t&&e!==e?!0:typeof t!=typeof e||{}.toString.call(t)!={}.toString.call(e)||t!==Object(t)||!t?!1:Array.isArray(t)?Cq(t,e):{}.toString.call(t)=="[object Set]"?Cq(Array.from(t),Array.from(e)):{}.toString.call(t)=="[object Object]"?j5e(t,e):q5e(t,e)}function q5e(t,e){return t.toString()===e.toString()}function Cq(t,e){var i=t.length;if(i!=e.length)return!1;for(var n=0;n<i;n++)if(!iH(t[n],e[n]))return!1;return!0}function j5e(t,e){var i=Object.keys(t),n=i.length;if(n!=Object.keys(e).length)return!1;for(var r=0;r<n;r++){var s=i[r];if(!(e.hasOwnProperty(s)&&iH(t[s],e[s])))return!1}return!0}const{LngLatBounds:Q5e,LngLat:Z5e}=Da;function nO(t,e){return Math.abs(t-e)<1e-6}function X5e(t,e){let i=Q5e.convert(t);if(!e)return{equal:!1,bounds:i};let n=i.getNorthEast(),r=e.getNorthEast();if(!nO(n.lat,r.lat)||!nO(n.wrap().lng,r.wrap().lng))return{equal:!1,bounds:i};let s=i.getSouthWest(),o=e.getSouthWest();return!nO(s.lat,o.lat)||!nO(s.wrap().lng,o.wrap().lng)?{equal:!1,bounds:i}:{equal:!0,bounds:i}}function K5e(t,e){const i=t.getSouthWest(),n=t.getNorthEast();if(Array.isArray(e)){if(e.length===4)return[i.lng,i.lat,n.lng,n.lat];if(e.length===2)return e[0]instanceof Z5e?[i,n]:[[i.lng,i.lat],[n.lng,n.lat]]}return t}function Y5e(t,e){Pi(e,!0);const i=Vt(Zd),n=Vt(()=>B(i).map),r=Vt(()=>B(i).loaded);let s=ht(e,"position",3,"top-left"),o=ht(e,"showCompass",3,!0),a=ht(e,"showZoom",3,!0),l=ht(e,"visualizePitch",3,!1),u=Fn(void 0);On(()=>{B(n)&&!B(u)&&(rt(u,kn(new Da.NavigationControl({showCompass:o(),showZoom:a(),visualizePitch:l()}))),B(n).addControl(B(u),s()))}),As(()=>{B(r)&&B(u)&&B(n).removeControl(B(u))}),Ei()}function J5e(t,e){Pi(e,!0);const i=Vt(Zd),n=Vt(()=>B(i).map),r=Vt(()=>B(i).loaded);let s=ht(e,"position",3,"top-left"),o=ht(e,"positionOptions",3,void 0),a=ht(e,"fitBoundsOptions",3,void 0),l=ht(e,"trackUserLocation",3,!1),u=ht(e,"showAccuracyCircle",3,!0),d=ht(e,"showUserLocation",3,!0),p=ht(e,"control",15);On(()=>{B(n)&&!p()&&(p(new Da.GeolocateControl({positionOptions:o(),fitBoundsOptions:a(),trackUserLocation:l(),showAccuracyCircle:u(),showUserLocation:d()})),B(n).addControl(p(),s()))}),As(()=>{B(r)&&p()&&B(n).removeControl(p())}),Ei()}function e8e(t,e){Pi(e,!0);const i=Vt(Zd),n=Vt(()=>B(i).map),r=Vt(()=>B(i).loaded);let s=ht(e,"position",3,"top-left"),o=ht(e,"container",3,void 0),a=Fn(void 0),l=Vt(()=>typeof o()=="string"?document.querySelector(o())??void 0:o());On(()=>{B(a)||(B(l)?rt(a,kn(new Da.FullscreenControl({container:B(l)}))):rt(a,kn(new Da.FullscreenControl)),B(n).addControl(B(a),s()))}),As(()=>{B(r)&&B(a)&&B(n).removeControl(B(a))}),Ei()}function t8e(t,e){Pi(e,!0);const i=Vt(Zd),n=Vt(()=>B(i).map),r=Vt(()=>B(i).loaded);let s=ht(e,"position",3,"bottom-left"),o=ht(e,"maxWidth",3,void 0),a=ht(e,"unit",3,"metric"),l=Fn(void 0);On(()=>{B(n)&&!B(l)&&(rt(l,kn(new Da.ScaleControl({maxWidth:o(),unit:a()}))),B(n).addControl(B(l),s()))}),As(()=>{B(r)&&B(l)&&B(n).removeControl(B(l))}),Ei()}var i8e=hi("<!> <!> <!> <!>",1),n8e=hi("<!> <!>",1),r8e=hi('<div data-testid="map-container"><!></div>');function s8e(t,e){Pi(e,!0);let i=ht(e,"map",15,void 0),n=ht(e,"mapContainer",15,void 0),r=ht(e,"class",3,void 0),s=ht(e,"diffStyleUpdates",3,!1),o=ht(e,"center",15,void 0),a=ht(e,"zoom",15,void 0),l=ht(e,"pitch",15,0),u=ht(e,"bearing",15,0),d=ht(e,"bearingSnap",3,7),p=ht(e,"bounds",15,void 0),v=ht(e,"hash",3,!1),y=ht(e,"projection",3,void 0),w=ht(e,"updateHash",3,Pe=>{window.history.replaceState(window.history.state,"",Pe)}),R=ht(e,"loaded",15,!1),O=ht(e,"minZoom",3,0),P=ht(e,"maxZoom",3,22),N=ht(e,"minPitch",3,0),F=ht(e,"maxPitch",3,60),k=ht(e,"renderWorldCopies",3,void 0),$=ht(e,"dragPan",3,void 0),W=ht(e,"dragRotate",3,void 0),Q=ht(e,"pitchWithRotate",3,void 0),Y=ht(e,"antialias",3,void 0),M=ht(e,"zoomOnDoubleClick",3,!0),D=ht(e,"locale",3,void 0),G=ht(e,"interactive",3,!0),j=ht(e,"attributionControl",3,void 0),Z=ht(e,"cooperativeGestures",3,!1),ie=ht(e,"preserveDrawingBuffer",3,!1),le=ht(e,"maxBounds",3,void 0),me=ht(e,"images",19,()=>[]),be=ht(e,"standardControls",3,!1),fe=ht(e,"filterLayers",3,void 0),Fe=ht(e,"transformRequest",3,void 0),He=Vt(()=>typeof be()=="boolean"?void 0:be());const je=F5e();eH(new Rp(void 0));let qe=Fn(kn(new Set));async function ct(Pe,Ye=!1){if(i()&&!(!i()?.loaded()&&!Ye))if("url"in Pe){B(qe).add(Pe.id);try{let Ct=await i().loadImage(Pe.url);i().addImage(Pe.id,Ct.data,Pe.options),je.loadedImages.add(Pe.id)}catch(Ct){e.onerror?e.onerror({error:Ct}):console.error(Ct)}finally{B(qe).delete(Pe.id)}}else i().addImage(Pe.id,Pe.data,Pe.options),je.loadedImages.add(Pe.id)}On(()=>{if(R()&&i()?.loaded())for(let Pe of me())!je.loadedImages.has(Pe.id)&&!B(qe).has(Pe.id)&&!i().hasImage(Pe.id)&&ct(Pe)});let Ge=Vt(()=>me().every(Pe=>je.loadedImages.has(Pe.id))),Je=Fn(void 0),mt=Fn(void 0),wt=Fn(void 0),Ot=Fn(void 0);function Qt(Pe){e.onerror?e.onerror(Pe):Pe.error.name!=="AbortError"&&console.error(Pe.error)}function ei(Pe){return Yt(),i(je.map=new Da.Map(YU({container:Pe,style:e.style,locale:D(),center:o(),zoom:a(),pitch:l(),bearing:u(),bearingSnap:d(),minZoom:O(),maxZoom:P(),minPitch:N(),maxPitch:F(),renderWorldCopies:k(),dragPan:$(),dragRotate:W(),pitchWithRotate:Q(),antialias:Y(),interactive:G(),preserveDrawingBuffer:ie(),maxBounds:le(),bounds:p(),attributionControl:j(),transformRequest:Fe(),cooperativeGestures:Z()}))),i().on("load",Ye=>{Ye.target.getContainer().setAttribute("data-testid","map"),Ye.target.getCanvas().setAttribute("data-testid","map-canvas"),e.onload&&e.onload(i()),je.loaded=!0,R(!0)}),i().on("error",Qt),e.onmovestart&&i().on("movestart",e.onmovestart),i().on("moveend",Ye=>{if(o(Ye.target.getCenter()),a(Ye.target.getZoom()),l(Ye.target.getPitch()),u(Ye.target.getBearing()),p(K5e(Ye.target.getBounds(),p())),e.onmoveend?.(Ye),v()){let Ct=new URL(window.location.href.replace(/(#.+)?$/,U5e(Ye.target)));w()(Ct)}}),e.onclick&&i().on("click",e.onclick),e.ondblclick&&i().on("dblclick",e.ondblclick),e.oncontextmenu&&i().on("contextmenu",e.oncontextmenu),e.onmousemove&&i().on("mousemove",e.onmousemove),e.onzoomstart&&i().on("zoomstart",e.onzoomstart),e.onzoom&&i().on("zoom",e.onzoom),e.onzoomend&&i().on("zoomend",e.onzoomend),e.onpitch&&i().on("pitch",e.onpitch),e.onrotate&&i().on("rotate",e.onrotate),e.onwheel&&i().on("wheel",e.onwheel),e.ondata&&i().on("data",e.ondata),e.onidle&&i().on("idle",e.onidle),i().on("style.load",Ye=>{if(i()){y()&&i().setProjection(y()),je.loaded=!0,R(!0);const Ct=i().getStyle();if(rt(Je,kn(Ct.layers.map(st=>st.id))),rt(mt,kn(Object.keys(Ct.sources))),B(Ot))for(const[st,we]of Object.entries(B(Ot)))i().addSource(st,we);if(B(wt))for(const st of B(wt))i().addLayer(st);for(const st of me())ct(st,!0);e.onstyleload?.(Ye)}}),i().on("styledata",Ye=>{if(i()&&fe()){const Ct=i().getStyle().layers;if(Ct)for(let st of Ct)fe()(st)||i().setLayoutProperty(st.id,"visibility","none")}e.onstyledata?.(Ye)}),{destroy(){R(!1),je.loaded=!1,i()?.remove()}}}let Jt=Fn(kn(e.style));On(()=>{if(i()&&!Zb(e.style,B(Jt))){const Pe=i().getStyle();if(B(Je)&&rt(wt,kn(Pe.layers.filter(Ye=>!B(Je).includes(Ye.id)))),B(mt)){const Ye=Object.keys(Pe.sources).filter(Ct=>!B(mt).includes(Ct));rt(Ot,kn({}));for(const Ct of Ye)B(Ot)[Ct]=Pe.sources[Ct]}rt(Jt,kn(e.style)),i().setStyle(e.style,{diff:s()}),je.loadedImages.clear(),rt(qe,kn(new Set))}}),On(()=>{if(i()){let Pe={};o()!=null&&!Zb(o(),i().getCenter())&&(Pe.center=o()),a()!=null&&!Zb(a(),i().getZoom())&&(Pe.zoom=a()),u()!=null&&!Zb(u(),i().getBearing())&&(Pe.bearing=u()),l()!=null&&!Zb(l(),i().getPitch())&&(Pe.pitch=l()),Object.keys(Pe).length&&i().easeTo(Pe)}}),On(()=>{y()&&R()&&i()?.setProjection(y())}),On(()=>{if(p()){const{equal:Pe,bounds:Ye}=X5e(p(),i()?.getBounds());Pe||i()?.fitBounds(Ye)}}),On(()=>{M()?i()?.doubleClickZoom.enable():i()?.doubleClickZoom.disable()});function Yt(){if(v()){let Pe=H5e(window.location.hash);Pe.length>=3&&(a(Pe[0]),o([Pe[2],Pe[1]])),Pe.length==5&&(u(Pe[3]),l(Pe[4]))}}var Ut=r8e();Tn("hashchange",JR,Yt);let Re;var gi=Di(Ut);{var it=Pe=>{var Ye=n8e(),Ct=pi(Ye);{var st=he=>{var xe=i8e(),Be=pi(xe);Y5e(Be,{get position(){return B(He)}});var $e=vi(Be,2);J5e($e,{get position(){return B(He)},fitBoundsOptions:{maxZoom:12}});var Ze=vi($e,2);e8e(Ze,{get position(){return B(He)}});var Lt=vi(Ze,2);t8e(Lt,{get position(){return B(He)}}),bt(he,xe)};Yi(Ct,he=>{be()&&he(st)})}var we=vi(Ct,2);hs(we,()=>e.children??to,()=>({map:i(),loaded:R(),loadedImages:je.loadedImages,allImagesLoaded:B(Ge)})),bt(Pe,Ye)};Yi(gi,Pe=>{i()&&Pe(it)})}_i(Ut),es(Ut,Pe=>n(Pe),()=>n()),Us(Ut,Pe=>ei?.(Pe)),Gi(Pe=>Re=xi(Ut,1,Ol(r()),"svelte-p00lfq",Re,Pe),[()=>({"expand-map":!r()})]),bt(t,Ut),Ei()}function o8e(t,e){t.key===" "&&(t.preventDefault(),t.stopPropagation(),e("click"))}var a8e=(t,e)=>{t.stopPropagation(),e("click")},l8e=(t,e)=>{t.stopPropagation(),e("dblclick")},c8e=(t,e)=>{t.stopPropagation(),t.preventDefault(),e("contextmenu")},u8e=(t,e)=>e("mousemove"),h8e=hi("<div><!></div>");function d8e(t,e){Pi(e,!0);let i=ht(e,"marker",15,void 0),n=ht(e,"lngLat",15),r=ht(e,"class",3,void 0),s=ht(e,"interactive",3,!0),o=ht(e,"asButton",3,!1),a=ht(e,"draggable",3,!1),l=ht(e,"feature",3,void 0),u=ht(e,"offset",3,void 0),d=ht(e,"zIndex",3,void 0),p=ht(e,"rotation",3,0),v=ht(e,"opacity",3,1),y=_C(e,["$$slots","$$events","$$legacy","marker","lngLat","class","interactive","asButton","draggable","feature","offset","zIndex","rotation","opacity","anchor","children"]);const w=Vt(Zd),R=Vt(()=>B(w).map),O=Vt(()=>B(w).markerClickManager),{layerEvent:P,marker:N}=z5e();function F(G){N.value=new Da.Marker({element:G,rotation:p(),draggable:a(),offset:u(),anchor:e.anchor,opacity:v().toString()}).setLngLat(n()).addTo(B(R)),i(N.value);const j=()=>Q("dragstart"),Z=()=>{W(),Q("drag")},ie=()=>{W(),Q("dragend")};return a()&&(N.value.on("dragstart",j),N.value.on("drag",Z),N.value.on("dragend",ie)),{destroy(){a()&&(N.value?.off("dragstart",j),N.value?.off("drag",Z),N.value?.off("dragend",ie)),i(void 0),N.value?.remove()}}}function k(G,j){const Z=G.className;function ie(le){le?G.className=`${Z} ${le}`:G.className=Z}return ie(j),{update:ie}}let $=new Rp(n());k5e($),On(()=>{N.value?.setLngLat(n()),$.value=n()}),On(()=>{u()&&N.value?.setOffset(u())}),On(()=>{N.value?.setRotation(p())}),On(()=>{N.value?.setOpacity(v().toString())});function W(){let G=N.value?.getLngLat();G&&(Array.isArray(n())?n([G.lng,G.lat]):n()&&"lon"in n()?n({lon:G.lng,lat:G.lat}):n(G))}function Q(G){if(!s())return;let j=N.value?.getLngLat();if(!j)return;const Z=[j.lng,j.lat];let ie={map:B(R),marker:N.value,lngLat:Z,features:[{type:"Feature",properties:l()?.properties??{},geometry:{type:"Point",coordinates:Z}}]};(G==="click"||G==="contextmenu")&&B(O).handleClick(ie),P.value={...ie,layerType:"marker",type:G};const le=y["on"+G];le?.(ie)}var Y=h8e();Y.__click=[a8e,Q],Y.__dblclick=[l8e,Q],Y.__contextmenu=[c8e,Q],Y.__mousemove=[u8e,Q],Y.__keydown=[o8e,Q];let M;var D=Di(Y);hs(D,()=>e.children??to,()=>({marker:N.value})),_i(Y),Us(Y,G=>F?.(G)),Us(Y,(G,j)=>k?.(G,j),r),Gi(()=>{yr(Y,"tabindex",o()?0:void 0),yr(Y,"role",o()?"button":void 0),M=Jd(Y,"",M,{"z-index":d()})}),Tn("mouseenter",Y,()=>{Q("mouseenter")}),Tn("mouseleave",Y,()=>{Q("mouseleave")}),bt(t,Y),Ei()}Zg(["click","dblclick","contextmenu","mousemove","keydown"]);var f8e=hi('<div class="sv-popup"><!></div>');function p8e(t,e){Pi(e,!0);let i=ht(e,"closeButton",3,void 0),n=ht(e,"closeOnClickOutside",3,!0),r=ht(e,"closeOnClickInside",3,!1),s=ht(e,"closeOnMove",3,!1),o=ht(e,"openOn",3,"click"),a=ht(e,"openIfTopMost",3,!0),l=ht(e,"focusAfterOpen",3,!0),u=ht(e,"anchor",3,void 0),d=ht(e,"offset",3,void 0),p=ht(e,"popupClass",3,void 0),v=ht(e,"maxWidth",3,void 0),y=ht(e,"lngLat",15,void 0),w=ht(e,"html",3,void 0),R=ht(e,"open",15,!1),O=ht(e,"onopen",3,void 0),P=ht(e,"onclose",3,void 0),N=ht(e,"onhover",3,void 0),F=D5e();const k=Vt(Zd),$=Vt(()=>B(k).map),W=Vt(()=>B(k).eventTopMost),Q=Vt(()=>B(k).markerClickManager),Y=Vt(()=>B(k).loaded),M=T5e(),D=I5e(),G=E5e(),j=["click","dblclick","contextmenu"];let Z=Fn(void 0),ie=Fn(!1),le=Fn(void 0);function me(){if(!B(Z))return;let it=B(Z).getElement();!it||it===B(le)||(rt(le,kn(it)),o()==="hover"&&(B(le).style.pointerEvents="none"),B(le).addEventListener("mouseenter",()=>{rt(ie,!0)},{passive:!0}),B(le).addEventListener("mouseleave",()=>{rt(ie,!1)},{passive:!0}),B(le).addEventListener("click",()=>{r()&&R(!1)},{passive:!0}))}Xo(()=>{if(B($))return B($).on("click",Ot),B($).on("contextmenu",Ot),B(Q).add(Qt),typeof G?.value=="string"&&(B($).on("click",G.value,qe),B($).on("dblclick",G.value,qe),B($).on("contextmenu",G.value,qe),B($).on("mousemove",G.value,wt),B($).on("mouseleave",G.value,mt),B($).on("touchstart",G.value,Ge),B($).on("touchend",G.value,Je)),()=>{B(Y)&&(B(Z)?.remove(),B($).off("click",Ot),B($).off("contextmenu",Ot),B(Q).remove(Qt),G?.value instanceof Da.Marker?G.value.getPopup()===B(Z)&&G.value.setPopup(void 0):typeof G?.value=="string"&&(B($).off("click",G.value,qe),B($).off("dblclick",G.value,qe),B($).off("contextmenu",G.value,qe),B($).off("mousemove",G.value,wt),B($).off("mouseleave",G.value,mt),B($).off("touchstart",G.value,Ge),B($).off("touchend",G.value,Je)))}});function be(){if(e.canOpen&&!e.canOpen(B(Fe))){R(!1);return}R(!0)}function fe(it){return a()?!("marker"in it)&&!V5e(it)&&B(W)(it)!==M?.value:!1}let Fe=Fn(void 0),He=Fn("normal");function je(it){"layerType"in it&&it.layerType==="deckgl"?(y(it.coordinate),rt(Fe,kn(it.object?[it.object]:void 0))):(y(it.lngLat),rt(Fe,kn(it.features??[])))}function qe(it){it.type!==o()||fe(it)||(je(it),setTimeout(be))}let ct;function Ge(it){ct=it.point}function Je(it){if(!ct||o()!=="hover")return;let Pe=ct.dist(it.point);ct=void 0,Pe<3&&(y(it.lngLat),rt(Fe,kn(it.features??[])),B(Z)?.isOpen()?rt(He,"justOpened"):(rt(He,"opening"),be()))}function mt(it){o()!=="hover"||ct||B(He)!=="normal"||(R(!1),rt(Fe,void 0))}function wt(it){if(!(o()!=="hover"||ct||B(He)!=="normal")){if(fe(it)){R(!1),rt(Fe,void 0);return}rt(Fe,kn(it.features??[])),y(it.lngLat),be()}}function Ot(it){if(B(He)==="justOpened"){rt(He,"normal");return}if(!n())return;let Pe=[B(le),G?.value instanceof Da.Marker?G.value?.getElement():void 0];R()&&B(Z)?.isOpen()&&!Pe.some(Ye=>Ye?.contains(it.originalEvent.target))&&(it.type==="contextmenu"&&o()==="contextmenu"||it.type!=="contextmenu")&&R(!1)}function Qt(it){n()&&R()&&B(Z)?.isOpen()&&it.marker!==G?.value&&R(!1)}As(()=>{B(Y)&&B(Z)?.isOpen()&&B(Z).remove()});let ei=Fn(void 0),Jt=Vt(()=>i()??(!n()&&!r()));On(()=>{if(!B(Z)){let it=p()?`${p()} sv-maplibregl-popup`:"sv-maplibregl-popup";rt(Z,kn(new Da.Popup({closeButton:B(Jt),closeOnClick:!1,closeOnMove:s(),focusAfterOpen:l(),maxWidth:v(),className:it,anchor:u(),offset:d()}))),rt(le,kn(B(Z).getElement())),B(Z).on("open",()=>{be(),R()&&(me(),O()?.(B(Z)))}),B(Z).on("close",()=>{R(!1),P()?.(B(Z))}),N()&&B(Z).on("hover",()=>{N()?.(B(Z))})}}),On(()=>{B(Z)&&G?.value instanceof Da.Marker&&(o()==="click"?G.value.setPopup(B(Z)):G.value.getPopup()===B(Z)&&G.value.setPopup(void 0))}),On(()=>{j.includes(o())&&D.value?.type===o()&&(qe(D.value),D.value=void 0)});let Yt=Vt(()=>o()==="hover"&&(D.value?.type==="mousemove"||D.value?.type==="mouseenter"));On(()=>{o()==="hover"&&D&&(B(Yt)&&D.value&&je(D.value),B(Yt)||B(ie)?be():R(!1))}),On(()=>{B(ei)?B(Z)?.setDOMContent(B(ei)):w()&&B(Z)?.setHTML(w())}),On(()=>{let it=y()??F?.value??void 0;it&&B(Z)?.setLngLat(it)}),On(()=>{if(B($)&&B(Z)){let it=B(Z).isOpen();R()&&!it?(B(Z).addTo(B($)),B(He)==="opening"&&rt(He,"justOpened")):!R()&&it&&B(Z).remove()}});var Ut=nn(),Re=pi(Ut);{var gi=it=>{var Pe=f8e(),Ye=Di(Pe);{var Ct=st=>{var we=nn(),he=pi(we);hs(he,()=>e.children??to,()=>({features:B(Fe),data:B(Fe)?.[0]??void 0,map:B($),close:()=>R(!1)})),bt(st,we)};Yi(Ye,st=>{(B(Fe)?.length||G?.value instanceof Da.Marker||!G&&R())&&st(Ct)})}_i(Pe),es(Pe,st=>rt(ei,st),()=>B(ei)),bt(it,Pe)};Yi(Re,it=>{e.children&&it(gi)})}bt(t,Ut),Ei()}function Sq(t){let e;return i=>{if(i)for(let n in i){let r=e?.[n],s=i[n];r!==s&&t(n,s,r)}else if(e)for(let n in e)t(n,void 0,e[n]);e=i}}function m8e(t,...e){let i=[t];for(let n of e)if(n)Array.isArray(n)&&n[0]===t?i.push(...n.slice(1)):i.push(n);else continue;if(i.length!==1)return i.length===2?i[1]:i}function g8e(t){return t===!0?["has","point_count"]:t===!1?["!",["has","point_count"]]:void 0}function v8e(t,e){Pi(e,!0);let i=ht(e,"id",19,()=>JU("layer")),n=ht(e,"source",3,void 0),r=ht(e,"sourceLayer",3,void 0),s=ht(e,"beforeId",3,void 0),o=ht(e,"beforeLayerType",3,void 0),a=ht(e,"paint",3,void 0),l=ht(e,"layout",3,void 0),u=ht(e,"filter",3,void 0),d=ht(e,"applyToClusters",3,void 0),p=ht(e,"requireSource",3,!0),v=ht(e,"minzoom",3,void 0),y=ht(e,"maxzoom",3,void 0),w=ht(e,"manageHoverState",3,!1),R=ht(e,"hovered",15),O=ht(e,"interactive",3,!0),P=ht(e,"hoverCursor",3,void 0),N=ht(e,"eventsIfTopMost",3,!1),F=ht(e,"children",3,void 0),k=ht(e,"onclick",3,void 0),$=ht(e,"ondblclick",3,void 0),W=ht(e,"oncontextmenu",3,void 0),Q=ht(e,"onmouseenter",3,void 0),Y=ht(e,"onmousemove",3,void 0),M=ht(e,"onmouseleave",3,void 0);const D=P5e(),G=Vt(Zd),j=Vt(()=>B(G).loaded),{layer:Z}=B5e(),ie=Vt(Zd),le=Vt(()=>B(ie).map),me=Vt(()=>B(ie).eventTopMost),be=Vt(()=>B(ie).layerInfo),fe=Vt(()=>B(ie).minzoom),Fe=Vt(()=>B(ie).maxzoom);As(()=>{Z.value&&(B(be).delete(Z.value),B(le).removeLayer(Z.value))});let He;function je(Pe){if(!O()||!Z.value||!B(le)||N()&&B(me)(Pe)!==Z.value)return;let Ye=Pe.features??[],Ct=Ye[0]?.properties?.cluster_id,st={event:Pe,map:B(le),clusterId:Ct,layer:Z.value,source:B(Jt),features:Ye};switch(Pe.type){case"click":k()?.(st);break;case"dblclick":$()?.(st);break;case"contextmenu":W()?.(st);break}}function qe(Pe){if(!O()||!Z.value||N()&&B(me)(Pe)!==Z.value)return;P()&&(B(le).getCanvas().style.cursor=P());let Ye=Pe.features??[];R(Ye[0]??void 0);let Ct=Ye[0]?.properties?.cluster_id,st={event:Pe,map:B(le),clusterId:Ct,layer:Z.value,source:B(Jt),features:Ye};Q()?.(st)}function ct(Pe){if(!O())return;if(N()&&B(me)(Pe)!==Z.value){R(void 0),w()&&He!==void 0&&(B(le).setFeatureState({source:B(Jt),sourceLayer:r(),id:He},{hover:!1}),He=void 0);return}P()&&(B(le).getCanvas().style.cursor=P());let Ye=Pe.features??[],Ct=Ye[0]?.properties?.cluster_id,st=Ye[0]?.id;st!==He&&(w()&&(He!==void 0&&B(le).setFeatureState({source:B(Jt),id:He,sourceLayer:r()},{hover:!1}),B(le).setFeatureState({source:B(Jt),id:st,sourceLayer:r()},{hover:!0})),He=st,R(Ye[0]??void 0)),Y()?.({event:Pe,map:B(le),clusterId:Ct,layer:Z.value,source:B(Jt),features:Ye})}function Ge(Pe){if(!(!O()||!Z.value||!B(le))){if(P()&&(B(le).getCanvas().style.cursor=""),R(void 0),w()&&He!==void 0){const Ye={source:B(Jt),id:He,sourceLayer:r()};B(le).setFeatureState(Ye,{hover:!1}),He=void 0}M()?.({map:B(le),layer:Z.value,source:B(Jt)})}}let Je=Fn(!0);function mt(Pe){B(le).off("dblclick",Pe,je),B(le).off("contextmenu",Pe,je),B(le).off("mouseenter",Pe,qe),B(le).off("mousemove",Pe,ct),B(le).off("mouseleave",Pe,Ge)}As(()=>{Z.value&&mt(Z.value)});let wt=Vt(()=>g8e(d())),Ot=Vt(()=>m8e("all",B(wt),u())),Qt=Vt(()=>v()??B(fe)),ei=Vt(()=>y()??B(Fe)),Jt=Vt(()=>n()||D?.value);On(()=>{if(Z.value!==i()&&B(j)&&(B(Jt)||!p())){Z.value&&(mt(Z.value),B(be).delete(Z.value));let Pe=s();if(!s()&&o()){let Ye=B(le).getStyle().layers,Ct=typeof o()=="function"?o():we=>we.type===o(),st=Ye?.find(Ct);st&&(Pe=st.id)}Z.value=i(),B(le).addLayer(YU({id:Z.value,type:e.type,source:B(Jt),"source-layer":r(),filter:B(Ot),paint:a(),layout:l(),minzoom:B(Qt),maxzoom:B(ei)}),Pe),rt(Je,!0),B(le).on("click",Z.value,je),B(le).on("dblclick",Z.value,je),B(le).on("contextmenu",Z.value,je),B(le).on("mouseenter",Z.value,qe),B(le).on("mousemove",Z.value,ct),B(le).on("mouseleave",Z.value,Ge)}}),On(()=>{Z.value&&B(be).set(Z.value,{interactive:O()})});let Yt=Vt(()=>Z.value?Sq((Pe,Ye)=>{B(le).style._loaded?B(le).setPaintProperty(Z.value,Pe,Ye):B(le).once("styledata",()=>B(le).setPaintProperty(Z.value,Pe,Ye))}):void 0),Ut=Vt(()=>Z.value?Sq((Pe,Ye)=>{B(le).style._loaded?B(le).setLayoutProperty(Z.value,Pe,Ye):B(le).once("styledata",()=>B(le).setLayoutProperty(Z.value,Pe,Ye))}):void 0);On(()=>{B(Yt)?.(a())}),On(()=>{B(Ut)?.(l())}),On(()=>{Z.value&&B(le).setLayerZoomRange(Z.value,B(Qt),B(ei))}),On(()=>{Z.value&&(B(Je)?rt(Je,!1):B(le).setFilter(Z.value,B(Ot)))});var Re=nn(),gi=pi(Re);{var it=Pe=>{var Ye=nn(),Ct=pi(Ye);sZ(Ct,()=>Z.value,st=>{var we=nn(),he=pi(we);hs(he,()=>F()??to),bt(st,we)}),bt(Pe,Ye)};Yi(gi,Pe=>{Z.value&&Pe(it)})}bt(t,Re),Ei()}Zg(["click"]);function y8e(t,e,i,n,r){let s=!1;t.getSource(e)&&(s=!0,t.removeSource(e));const o=()=>{n(e)&&(t.addSource(e,i),r())};if(s){const a=()=>{e&&(t.getSource(e)?setTimeout(a,1):o())};a()}else o()}function x8e(t,e,i){Hc().then(()=>{if(!t.loaded())return;t.getSource(e)===i&&t.removeSource(e)})}function b8e(t,e){Pi(e,!0);let i=ht(e,"id",19,()=>JU("raster-layer")),n=ht(e,"source",3,void 0),r=ht(e,"beforeId",3,void 0),s=ht(e,"beforeLayerType",3,void 0),o=ht(e,"layout",3,void 0),a=ht(e,"minzoom",3,void 0),l=ht(e,"maxzoom",3,void 0),u=ht(e,"children",3,void 0),d=ht(e,"onclick",3,void 0),p=ht(e,"ondblclick",3,void 0),v=ht(e,"oncontextmenu",3,void 0),y=ht(e,"onmouseenter",3,void 0),w=ht(e,"onmousemove",3,void 0),R=ht(e,"onmouseleave",3,void 0);v8e(t,{get id(){return i()},type:"raster",get source(){return n()},get beforeId(){return r()},get beforeLayerType(){return s()},get paint(){return e.paint},get layout(){return o()},get minzoom(){return a()},get maxzoom(){return l()},get onclick(){return d()},get ondblclick(){return p()},get oncontextmenu(){return v()},get onmouseenter(){return y()},get onmousemove(){return w()},get onmouseleave(){return R()},children:(O,P)=>{var N=nn(),F=pi(N);hs(F,()=>u()??to),bt(O,N)},$$slots:{default:!0}}),Ei()}var n0=Math.pow,Wo=(t,e,i)=>new Promise((n,r)=>{var s=l=>{try{a(i.next(l))}catch(u){r(u)}},o=l=>{try{a(i.throw(l))}catch(u){r(u)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(s,o);a((i=i.apply(t,e)).next())}),Wl=Uint8Array,n_=Uint16Array,w8e=Int32Array,Mte=new Wl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Tte=new Wl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),_8e=new Wl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Rte=function(t,e){for(var i=new n_(31),n=0;n<31;++n)i[n]=e+=1<<t[n-1];for(var r=new w8e(i[30]),n=1;n<30;++n)for(var s=i[n];s<i[n+1];++s)r[s]=s-i[n]<<5|n;return{b:i,r}},Pte=Rte(Mte,2),Ete=Pte.b,C8e=Pte.r;Ete[28]=258,C8e[258]=28;var S8e=Rte(Tte,0),O8e=S8e.b,Ate=new n_(32768);for(vr=0;vr<32768;++vr)ad=(vr&43690)>>1|(vr&21845)<<1,ad=(ad&52428)>>2|(ad&13107)<<2,ad=(ad&61680)>>4|(ad&3855)<<4,Ate[vr]=((ad&65280)>>8|(ad&255)<<8)>>1;var ad,vr,r_=function(t,e,i){for(var n=t.length,r=0,s=new n_(e);r<n;++r)t[r]&&++s[t[r]-1];var o=new n_(e);for(r=1;r<e;++r)o[r]=o[r-1]+s[r-1]<<1;var a;{a=new n_(1<<e);var l=15-e;for(r=0;r<n;++r)if(t[r])for(var u=r<<4|t[r],d=e-t[r],p=o[t[r]-1]++<<d,v=p|(1<<d)-1;p<=v;++p)a[Ate[p]>>l]=u}return a},QC=new Wl(288);for(vr=0;vr<144;++vr)QC[vr]=8;var vr;for(vr=144;vr<256;++vr)QC[vr]=9;var vr;for(vr=256;vr<280;++vr)QC[vr]=7;var vr;for(vr=280;vr<288;++vr)QC[vr]=8;var vr,Ite=new Wl(32);for(vr=0;vr<32;++vr)Ite[vr]=5;var vr,M8e=r_(QC,9),T8e=r_(Ite,5),DN=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},uu=function(t,e,i){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&i},LN=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(e&7)},R8e=function(t){return(t+7)/8|0},P8e=function(t,e,i){(i==null||i>t.length)&&(i=t.length);var n=new Wl(i-e);return n.set(t.subarray(e,i)),n},E8e=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ul=function(t,e,i){var n=new Error(e||E8e[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,Ul),!i)throw n;return n},nH=function(t,e,i,n){var r=t.length,s=0;if(!r||e.f&&!e.l)return i||new Wl(0);var o=!i||e.i!=2,a=e.i;i||(i=new Wl(r*3));var l=function(ei){var Jt=i.length;if(ei>Jt){var Yt=new Wl(Math.max(Jt*2,ei));Yt.set(i),i=Yt}},u=e.f||0,d=e.p||0,p=e.b||0,v=e.l,y=e.d,w=e.m,R=e.n,O=r*8;do{if(!v){u=uu(t,d,1);var P=uu(t,d+1,3);if(d+=3,P)if(P==1)v=M8e,y=T8e,w=9,R=5;else if(P==2){var $=uu(t,d,31)+257,W=uu(t,d+10,15)+4,Q=$+uu(t,d+5,31)+1;d+=14;for(var Y=new Wl(Q),M=new Wl(19),D=0;D<W;++D)M[_8e[D]]=uu(t,d+D*3,7);d+=W*3;for(var G=DN(M),j=(1<<G)-1,Z=r_(M,G),D=0;D<Q;){var ie=Z[uu(t,d,j)];d+=ie&15;var N=ie>>4;if(N<16)Y[D++]=N;else{var le=0,me=0;for(N==16?(me=3+uu(t,d,3),d+=2,le=Y[D-1]):N==17?(me=3+uu(t,d,7),d+=3):N==18&&(me=11+uu(t,d,127),d+=7);me--;)Y[D++]=le}}var be=Y.subarray(0,$),fe=Y.subarray($);w=DN(be),R=DN(fe),v=r_(be,w),y=r_(fe,R)}else Ul(1);else{var N=R8e(d)+4,F=t[N-4]|t[N-3]<<8,k=N+F;if(k>r){a&&Ul(0);break}o&&l(p+F),i.set(t.subarray(N,k),p),e.b=p+=F,e.p=d=k*8,e.f=u;continue}if(d>O){a&&Ul(0);break}}o&&l(p+131072);for(var Fe=(1<<w)-1,He=(1<<R)-1,je=d;;je=d){var le=v[LN(t,d)&Fe],qe=le>>4;if(d+=le&15,d>O){a&&Ul(0);break}if(le||Ul(2),qe<256)i[p++]=qe;else if(qe==256){je=d,v=null;break}else{var ct=qe-254;if(qe>264){var D=qe-257,Ge=Mte[D];ct=uu(t,d,(1<<Ge)-1)+Ete[D],d+=Ge}var Je=y[LN(t,d)&He],mt=Je>>4;Je||Ul(3),d+=Je&15;var fe=O8e[mt];if(mt>3){var Ge=Tte[mt];fe+=LN(t,d)&(1<<Ge)-1,d+=Ge}if(d>O){a&&Ul(0);break}o&&l(p+131072);var wt=p+ct;if(p<fe){var Ot=s-fe,Qt=Math.min(fe,wt);for(Ot+p<0&&Ul(3);p<Qt;++p)i[p]=n[Ot+p]}for(;p<wt;p+=4)i[p]=i[p-fe],i[p+1]=i[p+1-fe],i[p+2]=i[p+2-fe],i[p+3]=i[p+3-fe];p=wt}}e.l=v,e.p=je,e.b=p,e.f=u,v&&(u=1,e.m=w,e.d=y,e.n=R)}while(!u);return p==i.length?i:P8e(i,0,p)},A8e=new Wl(0),I8e=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&Ul(6,"invalid gzip data");var e=t[3],i=10;e&4&&(i+=(t[10]|t[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[i++]);return i+(e&2)},k8e=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},D8e=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&Ul(6,"invalid zlib data"),(t[1]>>5&1)==1&&Ul(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function L8e(t,e){return nH(t,{i:2},e,e)}function F8e(t,e){var i=I8e(t);return i+8>t.length&&Ul(6,"invalid gzip data"),nH(t.subarray(i,-8),{i:2},new Wl(k8e(t)),e)}function N8e(t,e){return nH(t.subarray(D8e(t),-4),{i:2},e,e)}function Jz(t,e){return t[0]==31&&t[1]==139&&t[2]==8?F8e(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?L8e(t,e):N8e(t,e)}var B8e=typeof TextDecoder<"u"&&new TextDecoder,z8e=0;try{B8e.decode(A8e,{stream:!0}),z8e=1}catch{}var kte=(t,e)=>t*n0(2,e),Xb=(t,e)=>Math.floor(t/n0(2,e)),WT=(t,e)=>kte(t.getUint16(e+1,!0),8)+t.getUint8(e),Dte=(t,e)=>kte(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),V8e=(t,e,i,n,r)=>{if(t!==n.getUint8(r))return t-n.getUint8(r);const s=WT(n,r+1);if(e!==s)return e-s;const o=WT(n,r+4);return i!==o?i-o:0},G8e=(t,e,i,n)=>{const r=Lte(t,e|128,i,n);return r?{z:e,x:i,y:n,offset:r[0],length:r[1],isDir:!0}:null},Oq=(t,e,i,n)=>{const r=Lte(t,e,i,n);return r?{z:e,x:i,y:n,offset:r[0],length:r[1],isDir:!1}:null},Lte=(t,e,i,n)=>{let r=0,s=t.byteLength/17-1;for(;r<=s;){const o=s+r>>1,a=V8e(e,i,n,t,o*17);if(a>0)r=o+1;else if(a<0)s=o-1;else return[Dte(t,o*17+7),t.getUint32(o*17+13,!0)]}return null},U8e=(t,e)=>t.isDir&&!e.isDir?1:!t.isDir&&e.isDir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,Fte=(t,e)=>{const i=t.getUint8(e*17);return{z:i&127,x:WT(t,e*17+1),y:WT(t,e*17+4),offset:Dte(t,e*17+7),length:t.getUint32(e*17+13,!0),isDir:i>>7===1}},Mq=t=>{const e=[],i=new DataView(t);for(let n=0;n<i.byteLength/17;n++)e.push(Fte(i,n));return H8e(e)},H8e=t=>{t.sort(U8e);const e=new ArrayBuffer(17*t.length),i=new Uint8Array(e);for(let n=0;n<t.length;n++){const r=t[n];let s=r.z;r.isDir&&(s=s|128),i[n*17]=s,i[n*17+1]=r.x&255,i[n*17+2]=r.x>>8&255,i[n*17+3]=r.x>>16&255,i[n*17+4]=r.y&255,i[n*17+5]=r.y>>8&255,i[n*17+6]=r.y>>16&255,i[n*17+7]=r.offset&255,i[n*17+8]=Xb(r.offset,8)&255,i[n*17+9]=Xb(r.offset,16)&255,i[n*17+10]=Xb(r.offset,24)&255,i[n*17+11]=Xb(r.offset,32)&255,i[n*17+12]=Xb(r.offset,48)&255,i[n*17+13]=r.length&255,i[n*17+14]=r.length>>8&255,i[n*17+15]=r.length>>16&255,i[n*17+16]=r.length>>24&255}return e},$8e=(t,e)=>{if(t.byteLength<17)return null;const i=t.byteLength/17,n=Fte(t,i-1);if(n.isDir){const r=n.z,s=e.z-r,o=Math.trunc(e.x/(1<<s)),a=Math.trunc(e.y/(1<<s));return{z:r,x:o,y:a}}return null};function W8e(t){return Wo(this,null,function*(){const e=yield t.getBytes(0,512e3),i=new DataView(e.data),n=i.getUint32(4,!0),r=i.getUint16(8,!0),s=new TextDecoder("utf-8"),o=JSON.parse(s.decode(new DataView(e.data,10,n)));let a=0;o.compression==="gzip"&&(a=2);let l=0;"minzoom"in o&&(l=+o.minzoom);let u=0;"maxzoom"in o&&(u=+o.maxzoom);let d=0,p=0,v=0,y=-180,w=-85,R=180,O=85;if(o.bounds){const N=o.bounds.split(",");y=+N[0],w=+N[1],R=+N[2],O=+N[3]}if(o.center){const N=o.center.split(",");d=+N[0],p=+N[1],v=+N[2]}return{specVersion:i.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:r*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:l,maxZoom:u,minLon:y,minLat:w,maxLon:R,maxLat:O,centerZoom:v,centerLon:d,centerLat:p,etag:e.etag}})}function q8e(t,e,i,n,r,s,o){return Wo(this,null,function*(){let a=yield i.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(a=Mq(a));const l=Oq(new DataView(a),n,r,s);if(l){let p=(yield e.getBytes(l.offset,l.length,o)).data;const v=new DataView(p);return v.getUint8(0)===31&&v.getUint8(1)===139&&(p=Jz(new Uint8Array(p))),{data:p}}const u=$8e(new DataView(a),{z:n,x:r,y:s});if(u){const d=G8e(new DataView(a),u.z,u.x,u.y);if(d){let p=yield i.getArrayBuffer(e,d.offset,d.length,t);t.specVersion===1&&(p=Mq(p));const v=Oq(new DataView(p),n,r,s);if(v){let w=(yield e.getBytes(v.offset,v.length,o)).data;const R=new DataView(w);return R.getUint8(0)===31&&R.getUint8(1)===139&&(w=Jz(new Uint8Array(w))),{data:w}}}}})}var Nte={getHeader:W8e,getZxy:q8e},j8e=t=>(e,i)=>{if(i instanceof AbortController)return t(e,i);const n=new AbortController;return t(e,n).then(r=>i(void 0,r.data,r.cacheControl||"",r.expires||""),r=>i(r)).catch(r=>i(r)),{cancel:()=>n.abort()}},Q8e=class{constructor(t){this.tilev4=(e,i)=>Wo(this,null,function*(){if(e.type==="json"){const v=e.url.substr(10);let y=this.tiles.get(v);if(y||(y=new Tq(v),this.tiles.set(v,y)),this.metadata)return{data:yield y.getTileJson(e.url)};const w=yield y.getHeader();return{data:{tiles:[`${e.url}/{z}/{x}/{y}`],minzoom:w.minZoom,maxzoom:w.maxZoom,bounds:[w.minLon,w.minLat,w.maxLon,w.maxLat]}}}const n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),r=e.url.match(n);if(!r)throw new Error("Invalid PMTiles protocol URL");const s=r[1];let o=this.tiles.get(s);o||(o=new Tq(s),this.tiles.set(s,o));const a=r[2],l=r[3],u=r[4],d=yield o.getHeader(),p=yield o?.getZxy(+a,+l,+u,i.signal);return p?{data:new Uint8Array(p.data),cacheControl:p.cacheControl,expires:p.expires}:d.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=j8e(this.tilev4),this.tiles=new Map,this.metadata=t?.metadata||!1}add(t){this.tiles.set(t.source.getKey(),t)}get(t){return this.tiles.get(t)}};function ly(t,e){return(e>>>0)*4294967296+(t>>>0)}function Z8e(t,e){const i=e.buf;let n=i[e.pos++],r=(n&112)>>4;if(n<128||(n=i[e.pos++],r|=(n&127)<<3,n<128)||(n=i[e.pos++],r|=(n&127)<<10,n<128)||(n=i[e.pos++],r|=(n&127)<<17,n<128)||(n=i[e.pos++],r|=(n&127)<<24,n<128)||(n=i[e.pos++],r|=(n&1)<<31,n<128))return ly(t,r);throw new Error("Expected varint not more than 10 bytes")}function Kb(t){const e=t.buf;let i=e[t.pos++],n=i&127;return i<128||(i=e[t.pos++],n|=(i&127)<<7,i<128)||(i=e[t.pos++],n|=(i&127)<<14,i<128)||(i=e[t.pos++],n|=(i&127)<<21,i<128)?n:(i=e[t.pos],n|=(i&15)<<28,Z8e(n,t))}function X8e(t,e,i,n){if(n===0){i===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}var K8e=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Y8e(t,e,i){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>n0(2,t)-1||i>n0(2,t)-1)throw Error("tile x/y outside zoom level bounds");const n=K8e[t],r=n0(2,t);let s=0,o=0,a=0;const l=[e,i];let u=r/2;for(;u>0;)s=(l[0]&u)>0?1:0,o=(l[1]&u)>0?1:0,a+=u*u*(3*s^o),X8e(u,l,s,o),u=u/2;return n+a}function Bte(t,e){return Wo(this,null,function*(){if(e===1||e===0)return t;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Jz(new Uint8Array(t));const i=new Response(t).body;if(!i)throw Error("Failed to read response stream");const n=i.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")})}function J8e(t){return t===1?".mvt":t===2?".png":t===3?".jpg":t===4?".webp":t===5?".avif":""}var e4e=127;function t4e(t,e){let i=0,n=t.length-1;for(;i<=n;){const r=n+i>>1,s=e-t[r].tileId;if(s>0)i=r+1;else if(s<0)n=r-1;else return t[r]}return n>=0&&(t[n].runLength===0||e-t[n].tileId<t[n].runLength)?t[n]:null}var i4e=class{constructor(t,e=new Headers){this.url=t,this.customHeaders=e,this.mustReload=!1;let i="";"navigator"in globalThis&&(i=globalThis.navigator.userAgent||"");const n=i.indexOf("Windows")>-1,r=/Chrome|Chromium|Edg|OPR|Brave/.test(i);this.chromeWindowsNoCache=!1,n&&r&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(t){this.customHeaders=t}getBytes(t,e,i,n){return Wo(this,null,function*(){let r,s;i?s=i:(r=new AbortController,s=r.signal);const o=new Headers(this.customHeaders);o.set("range",`bytes=${t}-${t+e-1}`);let a;this.mustReload?a="reload":this.chromeWindowsNoCache&&(a="no-store");let l=yield fetch(this.url,{signal:s,cache:a,headers:o});if(t===0&&l.status===416){const v=l.headers.get("Content-Range");if(!v||!v.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const y=+v.substr(8);l=yield fetch(this.url,{signal:s,cache:"reload",headers:{range:`bytes=0-${y-1}`}})}let u=l.headers.get("Etag");if(u?.startsWith("W/")&&(u=null),l.status===416||n&&u&&u!==n)throw this.mustReload=!0,new eV(`Server returned non-matching ETag ${n} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(l.status>=300)throw Error(`Bad response code: ${l.status}`);const d=l.headers.get("Content-Length");if(l.status===200&&(!d||+d>e))throw r&&r.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield l.arrayBuffer(),etag:u||void 0,cacheControl:l.headers.get("Cache-Control")||void 0,expires:l.headers.get("Expires")||void 0}})}};function hu(t,e){const i=t.getUint32(e+4,!0),n=t.getUint32(e+0,!0);return i*n0(2,32)+n}function n4e(t,e){const i=new DataView(t),n=i.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:hu(i,8),rootDirectoryLength:hu(i,16),jsonMetadataOffset:hu(i,24),jsonMetadataLength:hu(i,32),leafDirectoryOffset:hu(i,40),leafDirectoryLength:hu(i,48),tileDataOffset:hu(i,56),tileDataLength:hu(i,64),numAddressedTiles:hu(i,72),numTileEntries:hu(i,80),numTileContents:hu(i,88),clustered:i.getUint8(96)===1,internalCompression:i.getUint8(97),tileCompression:i.getUint8(98),tileType:i.getUint8(99),minZoom:i.getUint8(100),maxZoom:i.getUint8(101),minLon:i.getInt32(102,!0)/1e7,minLat:i.getInt32(106,!0)/1e7,maxLon:i.getInt32(110,!0)/1e7,maxLat:i.getInt32(114,!0)/1e7,centerZoom:i.getUint8(118),centerLon:i.getInt32(119,!0)/1e7,centerLat:i.getInt32(123,!0)/1e7,etag:e}}function zte(t){const e={buf:new Uint8Array(t),pos:0},i=Kb(e),n=[];let r=0;for(let s=0;s<i;s++){const o=Kb(e);n.push({tileId:r+o,offset:0,length:0,runLength:1}),r+=o}for(let s=0;s<i;s++)n[s].runLength=Kb(e);for(let s=0;s<i;s++)n[s].length=Kb(e);for(let s=0;s<i;s++){const o=Kb(e);o===0&&s>0?n[s].offset=n[s-1].offset+n[s-1].length:n[s].offset=o-1}return n}function r4e(t){const e=new DataView(t);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var eV=class extends Error{};function s4e(t,e){return Wo(this,null,function*(){const i=yield t.getBytes(0,16384);if(new DataView(i.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(r4e(i.data)<3)return[yield Nte.getHeader(t)];const r=i.data.slice(0,e4e),s=n4e(r,i.etag),o=i.data.slice(s.rootDirectoryOffset,s.rootDirectoryOffset+s.rootDirectoryLength),a=`${t.getKey()}|${s.etag||""}|${s.rootDirectoryOffset}|${s.rootDirectoryLength}`,l=zte(yield e(o,s.internalCompression));return[s,[a,l.length,l]]})}function o4e(t,e,i,n,r){return Wo(this,null,function*(){const s=yield t.getBytes(i,n,void 0,r.etag),o=yield e(s.data,r.internalCompression),a=zte(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var a4e=class{constructor(t=100,e=!0,i=Bte){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=t,this.counter=1,this.decompress=i}getHeader(t){return Wo(this,null,function*(){const e=t.getKey(),i=this.cache.get(e);if(i)return i.lastUsed=this.counter++,yield i.data;const n=new Promise((r,s)=>{s4e(t,this.decompress).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),r(o[0]),this.prune()}).catch(o=>{s(o)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(t,e,i,n){return Wo(this,null,function*(){const r=`${t.getKey()}|${n.etag||""}|${e}|${i}`,s=this.cache.get(r);if(s)return s.lastUsed=this.counter++,yield s.data;const o=new Promise((a,l)=>{o4e(t,this.decompress,e,i,n).then(u=>{a(u),this.prune()}).catch(u=>{l(u)})});return this.cache.set(r,{lastUsed:this.counter++,data:o}),o})}getArrayBuffer(t,e,i,n){return Wo(this,null,function*(){const r=`${t.getKey()}|${n.etag||""}|${e}|${i}`,s=this.cache.get(r);if(s)return s.lastUsed=this.counter++,yield s.data;const o=new Promise((a,l)=>{t.getBytes(e,i,void 0,n.etag).then(u=>{a(u.data),this.cache.has(r),this.prune()}).catch(u=>{l(u)})});return this.cache.set(r,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((i,n)=>{i.lastUsed<t&&(t=i.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(t){return Wo(this,null,function*(){const e=t.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(t.getKey());const i=new Promise((n,r)=>{this.getHeader(t).then(s=>{n(),this.invalidations.delete(e)}).catch(s=>{r(s)})});this.invalidations.set(e,i)})}},Tq=class{constructor(t,e,i){typeof t=="string"?this.source=new i4e(t):this.source=t,i?this.decompress=i:this.decompress=Bte,e?this.cache=e:this.cache=new a4e}getHeader(){return Wo(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,i,n){return Wo(this,null,function*(){const r=Y8e(t,e,i),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return Nte.getZxy(s,this.source,this.cache,t,e,i,n);if(t<s.minZoom||t>s.maxZoom)return;let o=s.rootDirectoryOffset,a=s.rootDirectoryLength;for(let l=0;l<=3;l++){const u=yield this.cache.getDirectory(this.source,o,a,s),d=t4e(u,r);if(d){if(d.runLength>0){const p=yield this.source.getBytes(s.tileDataOffset+d.offset,d.length,n,s.etag);return{data:yield this.decompress(p.data,s.tileCompression),cacheControl:p.cacheControl,expires:p.expires}}o=s.leafDirectoryOffset+d.offset,a=d.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(t,e,i,n){return Wo(this,null,function*(){try{return yield this.getZxyAttempt(t,e,i,n)}catch(r){if(r instanceof eV)return this.cache.invalidate(this.source),yield this.getZxyAttempt(t,e,i,n);throw r}})}getMetadataAttempt(){return Wo(this,null,function*(){const t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength,void 0,t.etag),i=yield this.decompress(e.data,t.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(i))})}getMetadata(){return Wo(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof eV)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw t}})}getTileJson(t){return Wo(this,null,function*(){const e=yield this.getHeader(),i=yield this.getMetadata(),n=J8e(e.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${t}/{z}/{x}/{y}${n}`],vector_layers:i.vector_layers,attribution:i.attribution,description:i.description,name:i.name,version:i.version,bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],center:[e.centerLon,e.centerLat,e.centerZoom],minzoom:e.minZoom,maxzoom:e.maxZoom}})}};function l4e(t,e){Pi(e,!0);let i=ht(e,"id",19,()=>JU("raster-source")),n=ht(e,"tiles",3,void 0),r=ht(e,"tileSize",3,void 0),s=ht(e,"url",3,void 0),o=ht(e,"bounds",3,void 0),a=ht(e,"scheme",3,void 0),l=ht(e,"attribution",3,void 0),u=ht(e,"minzoom",3,void 0),d=ht(e,"maxzoom",3,void 0),p=ht(e,"volatile",3,void 0);if(s()&&s().includes("pmtiles://")&&!Object.hasOwn(Da.config.REGISTERED_PROTOCOLS.hasOwnProperty,"pmtiles")){let $=new Q8e;Da.addProtocol("pmtiles",$.tile)}const v=Vt(Zd),y=Vt(()=>B(v).map),w=Vt(()=>B(v).loaded),{source:R}=N5e();let O=Fn(void 0),P=Fn(!0);On(()=>{B(y)&&B(w)&&R.value!==i()&&(R.value=i(),y8e(B(y),R.value,YU({type:"raster",tiles:n(),tileSize:r(),url:s(),bounds:o(),scheme:a(),attribution:l(),minzoom:u(),maxzoom:d(),volatile:p()}),$=>B(y)&&$===R.value,()=>{R.value&&(rt(O,kn(B(y).getSource(R.value))),rt(P,!0))}))}),On(()=>{B(O)&&(B(P)?rt(P,!1):n()?B(O).setTiles(n()):B(O).setUrl(s()))}),On(()=>{B(y).on("style.load",()=>{rt(O,kn(B(y).getSource(i())))})}),As(()=>{R.value&&B(O)&&B(y)&&(x8e(B(y),R.value,B(O)),R.value=void 0,rt(O,void 0))});var N=nn(),F=pi(N);{var k=$=>{var W=nn(),Q=pi(W);sZ(Q,()=>R.value,Y=>{var M=nn(),D=pi(M);hs(D,()=>e.children??to),bt(Y,M)}),bt($,W)};Yi(F,$=>{R.value&&$(k)})}bt(t,N),Ei()}var c4e=hi("<span><!></span>");function u4e(t,e){Pi(e,!0);const i=Xi("pageContext");function n(){return e.layoutStructure}function r(){}function s(){return[{name:"icon",type:"string"},{name:"color",type:"color"}]}const o=Vt(()=>$n(e.layoutStructure.props?.class,i,e.dataValues,!1)+(e.layoutStructure.props?.background?` bg-[url(${e.layoutStructure.props?.background})] bg-no-repeat bg-cover bg-center`:"")),a=Vt(()=>$n(e.layoutStructure.props?.icon,i,e.dataValues,!1));var l=c4e(),u=Di(l);const d=Vt(()=>$n(e.layoutStructure.props?.color,i,e.dataValues,!1)),p=Vt(()=>$n(e.layoutStructure.props?.size+"",i,e.dataValues,!1)),v=Vt(()=>$n(e.layoutStructure.props?.size+"",i,e.dataValues,!1));return jM(u,{get color(){return B(d)},get icon(){return B(a)},get width(){return B(p)},get height(){return B(v)}}),_i(l),Gi(()=>{xi(l,1,Ol(B(o))),yr(l,"draggable",e.layoutStructure.props?.draggable)}),bt(t,l),Ei({getLayout:n,getEvents:r,getProps:s})}var h4e=hi('<div class="text-lg font-bold"> </div> <div class="w-64"><!></div>',1),d4e=hi("<!> <!>",1),f4e=hi("<!> <!>",1),p4e=hi("<div><!></div>");function Zrt(t,e){Pi(e,!0);const i=Xi("pageContext");function n(){return e.layoutStructure}function r(){return[]}function s(){return[{name:"dataSource",type:"dataSource"},{name:"popup",type:"string"},{name:"tileLayer",type:"string"},{name:"rasterLayer",type:"string"},{name:"zoom",type:"string"},{name:"center",type:"string"},{name:"markerColor",type:"color"},{name:"markerIcon",type:"string"},{name:"markerSize",type:"string"}]}const o=Vt(()=>$n(e.layoutStructure.props?.class,i,e.dataValues,!1)+(e.layoutStructure.props?.background?` bg-[url(${e.layoutStructure.props?.background})] bg-no-repeat bg-cover bg-center`:"")),a=i.data[e.layoutStructure.props?.dataSource];var l=p4e(),u=Di(l);const d=Vt(()=>e.layoutStructure.props?.tileLayer),p=Vt(()=>e.layoutStructure.props?.zoom),v=Vt(()=>Array.isArray(e.layoutStructure.props?.center)?e.layoutStructure.props?.center:JSON.parse(e.layoutStructure.props?.center));return s8e(u,{get style(){return B(d)},get class(){return B(o)},standardControls:!0,get zoom(){return B(p)},get center(){return B(v)},children:(y,w)=>{var R=f4e(),O=pi(R);{var P=F=>{const k=Vt(()=>[e.layoutStructure.props?.rasterLayer]);l4e(F,{get tiles(){return B(k)},tileSize:256,children:($,W)=>{b8e($,{paint:{}})},$$slots:{default:!0}})};Yi(O,F=>{e.layoutStructure.props?.rasterLayer&&F(P)})}var N=vi(O,2);Ur(N,17,()=>a,F=>F.label,(F,k)=>{d8e(F,{get lngLat(){return B(k).lngLat},children:($,W)=>{var Q=d4e(),Y=pi(Q);const M=Vt(()=>({props:{color:e.layoutStructure.props?.markerColor?e.layoutStructure.props?.markerColor:"blue",icon:e.layoutStructure.props?.markerIcon?e.layoutStructure.props?.markerIcon:"mdi:location",size:e.layoutStructure.props?.markerSize?e.layoutStructure.props?.markerSize:36}}));u4e(Y,{get layoutStructure(){return B(M)}});var D=vi(Y,2);{var G=j=>{p8e(j,{openOn:"hover",offset:[0,-10],children:(Z,ie)=>{var le=h4e(),me=pi(le),be=Di(me,!0);_i(me);var fe=vi(me,2),Fe=Di(fe);const He=Vt(()=>JSON.parse(e.layoutStructure.props?.popup));kg(Fe,{get layoutStructure(){return B(He)},get dataValues(){return B(k)},dataSources:[]}),_i(fe),Gi(()=>zd(be,B(k).name)),bt(Z,le)},$$slots:{default:!0}})};Yi(D,j=>{e.layoutStructure.props?.popup&&j(G)})}bt($,Q)},$$slots:{default:!0}})}),bt(y,R)},$$slots:{default:!0}}),_i(l),Gi(()=>xi(l,1,Ol(B(o)))),bt(t,l),Ei({getLayout:n,getEvents:r,getProps:s})}const m4e=t=>{debugger;const e=(r,s)=>{if(!Array.isArray(r)||r.length===0)return{score:0,path:s};let o=0,a=0,l=0,u=new Set;if(o+=Math.min(r.length*2,20),r.every(p=>typeof p==typeof r[0])&&(o+=15,typeof r[0]=="object"&&r[0]!==null)){const p=Object.keys(r[0]).sort().join(","),v=r.filter(P=>P&&Object.keys(P).sort().join(",")===p).length;o+=v/r.length*25;const y=Object.keys(r[0]||{});a=y.length,o+=Math.min(a*2,30);const w=[/^(id|key|code)$/i,/^.*?(id|key|code)$/i,/^(name|title|label|caption)$/i,/^(filename|path|url)$/i,/^(date|time|timestamp|created|updated)$/i];l=y.filter(P=>w.some(N=>N.test(P))).length,o+=l*5,u=new Set(y.map(P=>typeof r[0][P])),o+=u.size*5;const R=["category","type","status","description","comments","price","cost","amount","quantity","size","width","height","depth","weight","dimensions","user","author","owner","creator","member","group","department","organization","company","location","address","city","country","region"],O=y.filter(P=>R.some(N=>P.toLowerCase().includes(N.toLowerCase()))).length;o+=O*3}o+=s===""?15:s.split(".").length===1?10:0;const d=r.some(p=>typeof p=="object"&&p!==null?Object.values(p).some(v=>v!=null&&v!==""&&!(Array.isArray(v)&&v.length===0)):!0);return d&&(o+=10),{score:o,path:s,details:{structureQuality:Math.min(a*2,30)/30,identifierStrength:a>0?l*5/(a*5):0,dataTypeVariety:u.size/4,contentQuality:d?1:0}}},i=(r,s="")=>{let o=[];return Array.isArray(r)?(o.push({array:r,path:s}),r.forEach((a,l)=>{o=o.concat(i(a,`${s}[${l}]`))})):r&&typeof r=="object"&&Object.entries(r).forEach(([a,l])=>{const u=s?`${s}.${a}`:a;o=o.concat(i(l,u))}),o};return(r=>{const o=i(r).map(({array:u,path:d})=>({...e(u,d),array:u,sampleData:u[0],itemCount:u.length,structureConsistency:u.every(p=>typeof p==typeof u[0]&&(!p||Object.keys(p).length===Object.keys(u[0]||{}).length))}));o.sort((u,d)=>d.score-u.score);const a=o.length>0?o[0]:null;let l=null;if(a){const{array:u,path:d,score:p,details:v,sampleData:y}=a;l={path:d,confidence:Math.min(p/100,1),qualityMetrics:v,length:u.length,sample:y,schema:typeof y=="object"?Object.entries(y).reduce((w,[R,O])=>(w[R]={type:typeof O,nullable:u.some(P=>P[R]===null),hasEmptyValues:u.some(P=>P[R]==="")},w),{}):typeof y,uniqueValueCount:new Set(u.map(JSON.stringify)).size}}return{meaningfulArray:l,allArrays:o.map(({path:u,score:d,details:p,itemCount:v,structureConsistency:y})=>({path:u,confidence:Math.min(d/100,1),qualityMetrics:p,itemCount:v,structureConsistency:y}))}})(t)};function g4e(t){let e=[];return Object.keys(t).forEach(i=>{e.push({visible:!0,column:i,type:t[i].type,label:i,resizable:!0,editable:!0,filter:!0})}),e}var v4e=hi(`<h3 class="text-lg font-bold">You dropped a URL for a data source; what would you like me to
				do?</h3>`),y4e=(t,e)=>e(),x4e=hi(`<p class="py-4">Here's a preview of the data you dropped. If you like, I can
			memorize it as a data provider, so you can use it as a source of
			data for your layouts.</p> <!> <div class="modal-action w-full"><input type="hidden" name="type" value="REST"> <input type="hidden" name="definition"> <input type="hidden" name="schema"> <input type="hidden" name="map"> Data source name: <input class="border" name="name"> <button class="btn btn-primary btn-sm">Save</button></div>`,1),b4e=hi("<div>+</div> <!>",1);function qT(t,e){Pi(e,!0);let i,n=Fn(!1);function r(D){D.preventDefault(),D.stopPropagation(),rt(n,!1);const G=D.dataTransfer.types;console.log("Available data types:",G),G.forEach(ie=>{});let j=D.dataTransfer.getData("text/uri-list"),Z=D.dataTransfer.getData("text/plain");if(j)a(j).then(ie=>{ie.type=="image"&&(alert("It's an image! "+j),e.notifyDropped(e.index,{type:"image",props:{class:"w-64",src:j}})),ie.type=="json"&&O(j)});else if(Z)try{JSON.parse(Z)}catch{alert(Z);let le=!1;try{let me=new URL(Z);le=!0}catch(me){alert(me)}le?(alert("You dropped a URL. I'll built an image component for you."),e.notifyDropped(e.index,{type:"image",props:{src:Z}})):(alert("You dropped plaintext. I'll built a text component for you."),e.notifyDropped(e.index,{type:"text",props:{value:Z}}))}try{e.notifyDropped(e.index,JSON.parse(D.dataTransfer.getData("text/plain")))}catch{}}function s(D){D.preventDefault(),rt(n,!0)}function o(D){rt(n,!1)}async function a(D){try{const G=await fetch(D,{method:"HEAD"}),j=G.headers.get("content-type");if(console.log("contentType: "+j),!j){const Z=await fetch(D),ie=Z.headers.get("content-type");if(ie.includes("application/json")){const le=await Z.json();return{type:"json",contentType:ie,structure:u(le)}}else if(ie.includes("xml")){const le=await Z.text();return{type:"xml",contentType:ie,rootElement:d(le)}}return{type:l(ie),contentType:ie,size:Z.headers.get("content-length")}}return{type:l(j),contentType:j,size:G.headers.get("content-length")}}catch(G){return{error:G.message,type:"unknown"}}}function l(D){return D.includes("image/")?"image":D.includes("application/json")?"json":D.includes("text/html")?"html":D.includes("text/xml")||D.includes("application/xml")?"xml":D.includes("text/")?"text":D.includes("audio/")?"audio":D.includes("video/")?"video":D.includes("application/pdf")?"pdf":"other"}function u(D){return Array.isArray(D)?{type:"array",length:D.length,sampleKeys:D.length>0?Object.keys(D[0]):[]}:{type:"object",keys:Object.keys(D)}}function d(D){const G=D.match(/<([^\s>]+)/);return G?G[1]:"unknown"}Xi("editLayout");const p=Xi("pageContext");let v=Fn(void 0),y=Fn(""),w=Fn(void 0),R=Fn(void 0);function O(D){rt(v,kn(D));try{fetch(D,{}).then(G=>G.json()).then(G=>{let j=m4e(G);rt(w,kn(g4e(j?.meaningfulArray?.schema))),console.log(B(w));let Z;j.meaningfulArray?.path?Z=G[j.meaningfulArray?.path]:Z=G,rt(R,kn(j.meaningfulArray?.path)),F=k(Z),rt(N,kn(Z)),rt(P,!0)})}catch(G){alert(G)}}let P=Fn(!1),N=Fn(kn([])),F=[];function k(D){return D?(F=[],Object.keys(D[0]).forEach(G=>{F.push({field:G,sortable:!0,resizable:!0})}),F):[]}function $(){p.data[B(y)]=B(N),rt(P,!1),e.notifyDropped(e.index,{type:"table",props:{dataSource:B(y),editable:!0}})}var W=b4e(),Q=pi(W);es(Q,D=>i=D,()=>i);var Y=vi(Q,2);{var M=D=>{Zve(D,{get showModal(){return B(P)},set showModal(j){rt(P,kn(j))},header:j=>{var Z=v4e();bt(j,Z)},children:(j,Z)=>{var ie=x4e(),le=vi(pi(ie),2);see(le,{get rowData(){return B(N)}});var me=vi(le,2),be=Di(me),fe=vi(be,2);Ny(fe);var Fe=vi(fe,2);Ny(Fe);var He=vi(Fe,2);Ny(He);var je=vi(He,2);Ny(je);var qe=vi(je,2);qe.__click=[y4e,$],_i(me),Gi((ct,Ge)=>{lF(fe,B(v)),lF(Fe,ct),lF(He,Ge),qe.disabled=B(y).length==0},[()=>JSON.stringify(B(w)),()=>JSON.stringify({childProps:{},topLevelArrayProp:B(R)})]),JV(je,()=>B(y),ct=>rt(y,ct)),bt(j,ie)},$$slots:{header:!0,default:!0}})};Yi(Y,D=>{B(N)&&B(P)&&D(M)})}Gi(()=>xi(Q,1,Ol([B(n)&&"crasshatch min-w-5","min-w-5 text-center text-xl font-bold"]),"svelte-nxkl5c")),Tn("dragleave",Q,o),Tn("dragover",Q,s),Tn("drop",Q,r),bt(t,W),Ei()}Zg(["click"]);var w4e=hi("<!> <!>",1),_4e=hi("<div><!> <!></div>");function Xrt(t,e){Pi(e,!0);const i=Xi("pageContext");function n(){return e.layoutStructure}function r(){return["onclick"]}function s(){return[{name:"disabled",type:"boolean"},{name:"label",type:"string"}]}const o=Vt(()=>$n(e.layoutStructure.props?.class,i,e.dataValues,!1)+(e.layoutStructure.props?.background?` bg-[url(${e.layoutStructure.props?.background})] bg-no-repeat bg-cover bg-center`:""));function a(v,y){e.layoutStructure.children?.splice(y,0,v)}var l=_4e(),u=Di(l);Ur(u,18,()=>e.layoutStructure.children,v=>v,(v,y,w)=>{var R=w4e(),O=pi(R);{var P=F=>{qT(F,{get index(){return B(w)},get layoutStructure(){return e.layoutStructure},notifyDropped:(k,$)=>a($,k)})};Yi(O,F=>{i.editMode&&F(P)})}var N=vi(O,2);kg(N,{get layoutStructure(){return y},get dataValues(){return e.dataValues},get parent(){return e.layoutStructure},get index(){return B(w)}}),bt(v,R)});var d=vi(u,2);{var p=v=>{const y=Vt(()=>e.layoutStructure.children?.length);qT(v,{get index(){return B(y)},get layoutStructure(){return e.layoutStructure},notifyDropped:(w,R)=>a(R,w)})};Yi(d,v=>{i.editMode&&v(p)})}return _i(l),Gi(()=>{xi(l,1,Ol(B(o))),yr(l,"draggable",e.layoutStructure.props?.draggable)}),bt(t,l),Ei({getLayout:n,getEvents:r,getProps:s})}var C4e=hi("<img>");function Krt(t,e){Pi(e,!0);const i=Xi("pageContext");function n(){return e.layoutStructure}function r(){return["onclick"]}function s(){return[{name:"src",type:"string"},{name:"alt",type:"string"}]}const o=Vt(()=>$n(e.layoutStructure.props?.class,i,e.dataValues,!1)+(e.layoutStructure.props?.background?` bg-[url(${e.layoutStructure.props?.background})] bg-no-repeat bg-cover bg-center`:"")),a=Vt(()=>$n(e.layoutStructure.props?.src,i,e.dataValues,!1));var l=C4e();let u;return Us(l,(d,p)=>ZG?.(d,p),()=>({content:$n(e.layoutStructure.props?.tooltip,e.dataValues,!1)})),Gi(d=>u=Ch(l,u,{class:B(o),...d,draggable:e.layoutStructure.props?.draggable,src:B(a),alt:e.layoutStructure.props?.alt}),[()=>ex(e.layoutStructure.actions,{page:i,data:e.dataValues,self:e.myself},e.dataValues)]),mle(l),bt(t,l),Ei({getLayout:n,getEvents:r,getProps:s})}var S4e=hi("<input>");function O4e(t,e){Pi(e,!0);let i=ht(e,"layoutStructure",7);const n=Xi("pageContext");function r(){return i()}function s(){return["oninput","onchange"]}function o(){return[{name:"disabled",type:"boolean"},{name:"value",type:"string"}]}const a=Vt(()=>$n(i().props?.class,n,e.dataValues,!1)+(i().props?.background?` bg-[url(${i().props?.background})] bg-no-repeat bg-cover bg-center`:""));var l=S4e();Ny(l);let u;return Gi((d,p)=>u=Ch(l,u,{class:B(a),...d,draggable:i().props?.draggable,disabled:i().props?.disabled,type:"text",placeholder:p}),[()=>ex(i().actions,{page:n,data:e.dataValues,self:e.myself},e.dataValues),()=>$n(i().props?.placeholder,n,e.dataValues,!1)]),JV(l,()=>i().props.value,d=>i().props.value=d),bt(t,l),Ei({getLayout:r,getEvents:s,getProps:o})}let FN=null,Rq=0;async function M4e(){const{browser:t}=await rZ(async()=>{const{browser:e}=await import("./BV4Ep9CS.js");return{browser:e}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url);if(!t)return console.log("loadAdobe skipped on server"),Promise.resolve();if(!FN){if(document.querySelector('script[src="https://acrobatservices.adobe.com/view-sdk/viewer.js"]')&&(console.log("AdobeDC script already present in DOM"),typeof window.AdobeDC<"u"))return console.log("AdobeDC already initialized"),Promise.resolve();FN=new Promise((e,i)=>{if(typeof window.AdobeDC<"u"){console.log("AdobeDC already available before script load"),e();return}const n=document.createElement("script");n.src="https://acrobatservices.adobe.com/view-sdk/viewer.js",n.async=!0,n.onload=()=>{console.log("AdobeDC script load event fired"),setTimeout(()=>{typeof window.AdobeDC<"u"?(console.log("AdobeDC initialized successfully:",window.AdobeDC),e()):(console.error("AdobeDC not found after script load"),i(new Error("AdobeDC not initialized after script load")))},500)},n.onerror=()=>{console.error("AdobeDC script failed to load from network"),i(new Error("Failed to load AdobeDC script"))},document.head.appendChild(n)})}return FN}function T4e(){return Rq++,`pdf-div-${Rq}`}var R4e=hi("<div></div>");function Yrt(t,e){Pi(e,!0);let i=ht(e,"fileName",3,"Document.pdf"),n=ht(e,"width",3,"100%"),r=ht(e,"height",3,"500px"),s=T4e(),o=null,a=Fn(!1);async function l(){o&&typeof o.destroy=="function"&&(o.destroy(),console.log("Existing viewer destroyed"));const d=document.getElementById(s);d&&(d.innerHTML="");try{if(await M4e(),typeof window.AdobeDC>"u"){console.error("AdobeDC is undefined");return}o=new window.AdobeDC.View({clientId:"485df48fec2440939b889168b1dbbfad",divId:s}),console.log("AdobeDC Viewer initialized:",o),rt(a,!0),console.log("Viewer marked as ready")}catch(p){console.error("Error initializing viewer:",p.message)}}Xo(async()=>{await l()}),On(()=>{console.log("Effect running with URL:",e.layoutStructure.props?.url),e.layoutStructure.props?.url&&l().then(()=>{if(B(a)&&o&&e.layoutStructure.props?.url)try{o.previewFile({content:{location:{url:e.layoutStructure.props?.url}},metaData:{fileName:i()}}),console.log("Previewed PDF:",e.layoutStructure.props?.url)}catch(d){console.error("Error previewing PDF:",d.message)}})}),As(()=>{if(o&&typeof o.destroy=="function")try{o.destroy(),console.log("Viewer destroyed successfully")}catch(p){console.error("Error destroying viewer:",p.message)}o=null,rt(a,!1);const d=document.getElementById(s);d&&(d.innerHTML="")});var u=R4e();yr(u,"id",s),Gi(()=>Jd(u,`width: ${n()??""}; height: ${r()??""}; border: 1px solid #ccc;`)),bt(t,u),Ei()}function Jrt(t,e){Pi(e,!0),Xi("pageContext");const i=Vt(()=>e.layoutStructure.props?.script),n=Vt(Hve);Qge(t,{get value(){return B(i)},get lang(){return B(n)}}),Ei()}var P4e=hi("<p><!></p>");function est(t,e){Pi(e,!0);const i=Xi("pageContext");function n(){return e.layoutStructure}function r(){return["oninput","onchange"]}function s(){return[{name:"value",type:"string"}]}const o=Vt(()=>$n(e.layoutStructure.props?.class,i,e.dataValues,!1)+(e.layoutStructure.props?.background?` bg-[url(${e.layoutStructure.props?.background})] bg-no-repeat bg-cover bg-center`:"")),a=Vt(()=>$n(e.layoutStructure.props?.value,i,e.dataValues,!1));var l=P4e();let u;var d=Di(l);return aZ(d,()=>B(a),!1,!1),_i(l),Gi(p=>u=Ch(l,u,{class:B(o),draggable:e.layoutStructure.props?.draggable,...p}),[()=>ex(e.layoutStructure.actions,{page:i,data:e.dataValues,self:e.myself},e.dataValues)]),bt(t,l),Ei({getLayout:n,getEvents:r,getProps:s})}var E4e=hi('<li><div class="timeline-middle"><!></div> <div><!></div> <hr></li>'),A4e=hi("<ul></ul>");function tst(t,e){Pi(e,!0);const i=Xi("pageContext");function n(){return e.layoutStructure}function r(){return[]}function s(){return[{name:"dataSource",type:"dataSource"},{name:"icon",type:"string"},{name:"iconColor",type:"color"},{name:"nodeWidth",type:"string"},{name:"timeField",type:"string"},{name:"itemLayout",type:"string"}]}let o=Vt(()=>e.layoutStructure.props?.nodeWidth||64),a=Vt(()=>B(o)?"w-"+B(o):"");const l=Vt(()=>$n(e.layoutStructure.props?.class,i,e.dataValues,!1)+(e.layoutStructure.props?.background?` bg-[url(${e.layoutStructure.props?.background})] bg-no-repeat bg-cover bg-center`:""));let u=Vt(()=>i.data[e.layoutStructure.props?.dataSource]);var d=A4e();return Ur(d,22,()=>B(u),p=>p,(p,v,y)=>{var w=E4e(),R=Di(w),O=Di(R);const P=Vt(()=>$n(e.layoutStructure.props?.iconColor,i,v,!1)||"blue"),N=Vt(()=>$n(e.layoutStructure.props?.icon,i,v,!1)||"mdi:location"),F=Vt(()=>e.layoutStructure.props?.iconSize||36);jM(O,{get color(){return B(P)},get icon(){return B(N)},get width(){return B(F)}}),_i(R);var k=vi(R,2),$=Di(k);const W=Vt(()=>JSON.parse(e.layoutStructure.props?.itemLayout));kg($,{get layoutStructure(){return B(W)},get dataValues(){return v}}),_i(k),QV(2),_i(w),Gi(()=>xi(k,1,Ol(B(y)%2===0?B(a)+" timeline-start mb-10 md:text-end":B(a)+" timeline-end mb-10 md:text-start"))),bt(p,w)}),_i(d),Gi(()=>xi(d,1,Ol(B(l)))),bt(t,d),Ei({getLayout:n,getEvents:r,getProps:s})}const I4e={type:"container",props:{},children:[{type:"repeater",props:{class:"grid grid-cols-3 gap-2",dataSource:"NCPS galleries"},children:[{type:"container",props:{class:"mb-5",disabled:!1},children:[{type:"text",props:{class:"text-base-content text-xl text-center",value:"{data.galleryName}"}},{type:"image",props:{src:"https://nc-photo.org/gallery/{data.firstName}%20{data.lastName}/{data.galleryName}/slides/{data.fileName}",class:"rounded-xl shadow aspect-video object-cover"}},{type:"text",props:{class:"text-base-content",value:"{data.galleryDesc:hideEmpty}"}}]}]},{type:"container",props:{class:"flex flex-wrap gap-2"},children:[{type:"imageupload",props:{class:"btn btn-sm btn-primary",label:"Upload to Cloudinary",cloudinaryFolder:"samples",cloudinaryPreset:"Bleth_preset"}},{type:"button",props:{class:"btn btn-sm btn-primary",tooltip:"Show this when user hovers",label:"Query Cloudinary",disabled:!1},actions:{onclick:{type:"clientScript",script:`// Construct the API URL
 const apiUrl = 'https://voiceofsoftware.com/hello.php';
  
  fetch(apiUrl, {
    method: 'GET',
    headers: {
      'Content-Type': 'application/json'
    }
  })
    .then(response => {
      if (!response.ok) {
        throw new Error(\`HTTP error! status: \${response.status}\`);
      }
      return response.json();
    })
    .then(data => {
      console.log(data);
      data.resources.forEach((item)=>{item.url=('https://res.cloudinary.com/dzoumeu1e/image/upload/'+'q_auto,w_200/'+item.secure_url.split('https://res.cloudinary.com/dzoumeu1e/image/upload/')[1])});
      page.data.cloudinary = data.resources;
      return data;
    })
    .catch(error => {
      console.error('Error fetching Cloudinary images:', error);
      throw error;
    });`}}}]},{type:"repeater",props:{class:"flex flex-wrap",dataSource:"cloudinary",draggable:!1},children:[{type:"image",props:{src:"{data.url}",class:"w-32"}}]},{type:"container",props:{class:"mockup-phone scale-90"},children:[{type:"container",props:{class:"camera"}},{type:"container",props:{class:"display w-[440px] h-[844px] bg-gradient-to-b from-indigo-500 via-purple-500 to-pink-500"},children:[{type:"text",props:{class:"pt-2 pl-3 text-gray-100",value:"safe area"}},{type:"container",props:{class:"flex flex-wrap place-content-center gap-2"},children:[{type:"button",actions:{onclick:{type:"clientScript",script:`fetch("https://dummyjson.com/recipes")
  .then(response => response.json())
  .then(j => {
    page.data.recipes = j.recipes;
  });`}},props:{class:"btn btn-sm btn-primary",tooltip:"Fetch recipes from API",label:"Get Recipes",draggable:!1}},{type:"button",actions:{onclick:{type:"clientScript",script:"page.data.recipes=[];"}},props:{class:"btn btn-sm btn-error",tooltip:"Clear recipe data",label:"Clear Recipes",draggable:!1}}]},{type:"repeater",props:{class:"grid grid-cols-2 p-3 gap-3 overflow-y-auto h-screen",dataSource:"recipes"},children:[{type:"container",props:{},children:[{type:"text",props:{class:"text-base-content text-center",value:"{data.name}"}},{type:"image",props:{class:"rounded-full",src:"{data.image}"}}]}]}]}]},{type:"button",props:{class:"btn btn-sm btn-info",label:"ð Dark Mode"},actions:{onclick:{type:"clientScript",script:"document.documentElement.setAttribute('data-theme','dark')"}}},{type:"button",props:{class:"btn btn-sm btn-info",label:"âï¸ Light Mode"},actions:{onclick:{type:"clientScript",script:"document.documentElement.setAttribute('data-theme','light')"}}},{type:"calendar",props:{dataSource:"calendarEvents",startTimeField:"start",endTimeField:"end",titleField:"shortdescription",idField:"id"}},{type:"chart",props:{dataSource:"chartData",title:"Chart Title",xColumn:"x",yColumn:"y",color:"#009999",type:"treemap"}},{type:"choice",props:{class:"border border-gray-300 rounded",dataSource:"names",optionValueField:"name",optionTitleField:"name",value:"Mary Ann"},actions:{onchange:{type:"clientScript",script:'alert("onchange "+self.props.value)'},oninput:{type:"clientScript",script:'alert("oninput "+self.props.value)'}}},{type:"container",props:{class:"flex gap-2"},children:[{type:"text",props:{class:"border p-1 m-1 shadow-xl",value:"left"}},{type:"text",props:{class:"border p-1 m-1 shadow-xl",value:"middle"}},{type:"text",props:{class:"border p-1 m-1 shadow-xl",value:"right"}}]},{type:"container",props:{class:"flex flex-col gap-2"},children:[{type:"text",props:{class:"border p-1 m-1 shadow",value:"top"}},{type:"text",props:{class:"border p-1 m-1 shadow",value:"center"}},{type:"text",props:{class:"border p-1 m-1 shadow",value:"bottom"}}]},{type:"icon",props:{color:"{page.exampleIcon.color}",icon:"game-icons:abstract-005",size:"{page.exampleIcon.size}"}},{type:"iframe",props:{class:"w-full",url:"https://nc-photo.org"}},{type:"image",props:{class:"w-96",background:"https://media.formula1.com/image/upload/content/dam/fom-website/2018-redesign-assets/Flags%2016x9/united-kingdom-flag.png",src:"https://media.formula1.com/d_team_car_fallback_image.png/content/dam/fom-website/teams/2025/mclaren.png"}},{type:"imageupload",props:{class:"btn btn-sm btn-primary",label:"Upload to Cloudinary",cloudinaryFolder:"test",cloudinaryPreset:"Bleth_preset"}},{type:"input",props:{class:"input input-sm input-bordered w-64",placeholder:"{page.exampleInput.placeholder}",value:""},actions:{onchange:{type:"clientScript",script:'alert("onchange "+self.value)'},oninput:{type:"clientScript",script:'alert("oninput "+self.value)'}}},{type:"map",props:{class:"relative aspect-[9/16] max-h-[70vh] w-full sm:aspect-video sm:max-h-full",dataSource:"mapMarkers",zoom:2,rasterLayer:"https://a.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayer:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:[-117.165975,33.088782],markerIcon:"mdi:location",markerColor:"blue",markerSize:36}},{type:"repeater",props:{class:"flex gap-2",dataSource:"names"},children:[{type:"text",props:{class:"bg-accent text-xl p-1",value:"{data.name}"}}]},{type:"richtext",props:{class:"w-1/3",value:"This is <b>rich</b> editable text"}},{type:"script",props:{class:"border w-full",script:`// This is a syntax-aware Javascript editor

let a='hello';`}},{type:"container",props:{class:"flex w-full"},children:[{type:"slider",props:{class:"w-96 range range-info",min:"{page.exampleSlider.min}",max:"{page.exampleSlider.max}",value:7},actions:{oninput:{type:"setProperty",objectName:"sliderValue",property:"value",value:"{self.props.value}"}}},{type:"text",id:"sliderValue",props:{class:"ml-2",value:"Move the slider!"}}]},{type:"table",props:{class:"w-full",dataSource:"calendarEvents"}},{type:"text",props:{class:"text-3xl font-thin font-sans",value:"This is <i>some</i> text, {page.f1Driver1}"}},{type:"timeline",props:{class:"timeline timeline-snap-icon timeline-vertical max-md:timeline-compact h-96 overflow-y-auto",dataSource:"calendarEvents",icon:"mdi:{data.icon}",iconColor:"blue",nodeWidth:"64",timeField:"start",itemLayout:'{"type":"button","class":"btn btn-xs","props":{"label":"hello {page.f1Driver1}"}}'}}]},k4e={type:"repeater",props:{class:"flex gap-2",dataSource:"examples"},children:[{type:"container",props:{class:"border w-16"},children:[]},{type:"icon",props:{color:"{data.iconColor}",icon:"{data.iconShape}",size:"{data.iconSize}"}},{type:"button",props:{class:"btn btn-sm",label:"{data.buttonLabel}"}},{type:"image",props:{class:"w-16",src:"{data.exampleImage}"}},{type:"input",props:{class:"input input-sm input-bordered w-16",placeholder:"{data.hint}"}},{type:"text",props:{class:"w-10",value:"<b>{data.text}</b>"}},{type:"slider",props:{class:"w-16 range range-info",min:0,max:10,value:7}}]},D4e={type:"container",props:{class:"flex border shadow-2xl m-5 p-5",draggable:!1},children:[{type:"icon",props:{draggable:!0,icon:"lucide:image",size:"1.5em",color:"blue"}},{type:"icon",props:{icon:"lucide:image",size:"1.5em",color:"green"}},{type:"container",props:{class:"flex flex-col"},children:[{type:"text",props:{class:"text-base-content text-xl font-bold font-serif",value:"{page.f1Driver1}",draggable:!0}},{type:"text",props:{class:"text-base-content text-xl font-thin italic",value:"Team Ferrari Driver 1",draggable:!0}},{type:"text",props:{class:"text-base-content text-xl font-black",value:"Team Ferrari Driver 1",draggable:!0}},{type:"slider",props:{class:"range range-info",value:50,max:100,min:0}}]},{type:"richtext",props:{value:"<p>Hi {page.f1Driver1} <layout-component></layout-component> <input-component></input-component> <counter-component></counter-component></p>"}},{type:"button",props:{class:"ml-auto btn btn-sm btn-accent",label:"Button Title",draggable:!0}}]},L4e={type:"repeater",props:{dataSource:"names",class:"flex gap-2",draggable:!0},children:[{type:"button",props:{class:"btn btn-sm {data.color}",label:"Button{data.name:formatSuffix}"},actions:{onclick:{type:"navigate",URL:"{data.navigate}",newTab:!0},onclick2:{type:"clientScript",value:"alert(self.props.content); page.namedPageObjects['theButton'].getLayout()['class']='btn btn-accent'; alert(JSON.stringify(page.namedPageObjects['theButton'].getLayout()['class']));"}}}]},F4e={type:"repeater",props:{class:"grid sm:grid-cols-2 gap-5",dataSource:"names"},children:[{type:"named",class:"",props:{name:"f1"}}]},N4e={type:"container",id:"f1",props:{class:"flex flex-col"},children:[{type:"image",props:{class:"w-64 mx-auto bg-accent rounded-full",src:"{page.exampleNestedJSON.photo.inner}",background:"https://hulbertfamily.com/gltf/grid.png",draggable:!0}},{type:"text",props:{class:"text-base-content text-xl mx-auto",value:"Team Ferrari {data.name}",draggable:!0}},{type:"input",props:{class:"input input-bordered mx-auto",value:"Ivanka/ivy",placeholder:"Ivanka's Friend's Name",disabled:!1,draggable:!0}},{type:"button",props:{class:"btn btn-sm btn-error mx-auto",label:"Save Team Ferrari"}}]},B4e={oneOfEachPageData:I4e,oneOfEachRepeaterData:k4e,horizontalIcons:D4e,named:F4e,f1:N4e,repeater:L4e};function ist(t,e){Pi(e,!0),Xi("pageContext"),kg(t,{get layoutStructure(){return B4e[e.layoutStructure.props.name]},get dataValues(){return e.dataValues}}),Ei()}var z4e=hi("<!> <!>",1),V4e=hi("<div><!> <!></div>"),G4e=hi("<div></div>");function nst(t,e){Pi(e,!0);const i=Xi("pageContext");function n(){return e.layoutStructure}function r(){return["onclick"]}function s(){return[{name:"dataSource",type:"dataSource"}]}const o=Vt(()=>$n(e.layoutStructure.props?.class,i,e.dataValues,!1)+(e.layoutStructure.props?.background?` bg-[url(${e.layoutStructure.props?.background})] bg-no-repeat bg-cover bg-center`:""));function a(v,y){e.layoutStructure.children?.splice(y,0,v)}var l=nn(),u=pi(l);{var d=v=>{var y=V4e(),w=Di(y);Ur(w,18,()=>e.layoutStructure.children,P=>P,(P,N,F)=>{var k=z4e(),$=pi(k);qT($,{get index(){return B(F)},get layoutStructure(){return e.layoutStructure},notifyDropped:(Q,Y)=>a(Y,Q)});var W=vi($,2);kg(W,{get layoutStructure(){return N},dataValues:{},get parent(){return e.layoutStructure},get index(){return B(F)}}),bt(P,k)});var R=vi(w,2);const O=Vt(()=>e.layoutStructure.children?.length);qT(R,{get index(){return B(O)},get layoutStructure(){return e.layoutStructure},notifyDropped:(P,N)=>a(N,P)}),_i(y),Gi(()=>{xi(y,1,B(o)+" repeater-section","svelte-r5x81t"),yr(y,"draggable",e.layoutStructure.props?.draggable)}),bt(v,y)},p=v=>{var y=G4e();Ur(y,21,()=>i.data[e.layoutStructure.props?.dataSource],Sl,(w,R)=>{var O=nn(),P=pi(O);Ur(P,18,()=>e.layoutStructure.children,N=>N,(N,F)=>{kg(N,{get layoutStructure(){return F},get dataValues(){return B(R)}})}),bt(w,O)}),_i(y),Gi(()=>{xi(y,1,Ol(B(o)),"svelte-r5x81t"),yr(y,"draggable",e.layoutStructure.props?.draggable)}),bt(v,y)};Yi(u,v=>{i.editMode?v(d):v(p,!1)})}return bt(t,l),Ei({getLayout:n,getEvents:r,getProps:s})}var U4e=hi("<input>");function rst(t,e){Pi(e,!0);let i=ht(e,"layoutStructure",7);const n=Xi("pageContext");function r(){return i()}function s(){return["onchange","oninput"]}function o(){return[{name:"min",type:"string"},{name:"max",type:"string"},{name:"value",type:"string"},{name:"step",type:"string"}]}const a=Vt(()=>$n(i().props?.class,n,e.dataValues,!1)+(i().props?.background?` bg-[url(${i().props?.background})] bg-no-repeat bg-cover bg-center`:""));var l=U4e();Ny(l);let u;return Gi((d,p,v,y)=>u=Ch(l,u,{class:B(a),...d,type:"range",min:p,max:v,step:y}),[()=>ex(i().actions,{page:n,data:e.dataValues,self:e.myself},e.dataValues),()=>$n(i().props?.min+"",n,e.dataValues,!1),()=>$n(i().props?.max+"",n,e.dataValues,!1),()=>$n(i().props?.step+"",n,e.dataValues,!1)]),JV(l,()=>i().props.value,d=>i().props.value=d),bt(t,l),Ei({getLayout:r,getEvents:s,getProps:o})}function Go(t){this.content=t}Go.prototype={constructor:Go,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,i){var n=i&&i!=t?this.remove(i):this,r=n.find(t),s=n.content.slice();return r==-1?s.push(i||t,e):(s[r+1]=e,i&&(s[r]=i)),new Go(s)},remove:function(t){var e=this.find(t);if(e==-1)return this;var i=this.content.slice();return i.splice(e,2),new Go(i)},addToStart:function(t,e){return new Go([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var i=this.remove(t).content.slice();return i.push(t,e),new Go(i)},addBefore:function(t,e,i){var n=this.remove(e),r=n.content.slice(),s=n.find(t);return r.splice(s==-1?r.length:s,0,e,i),new Go(r)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Go.from(t),t.size?new Go(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Go.from(t),t.size?new Go(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Go.from(t);for(var i=0;i<t.content.length;i+=2)e=e.remove(t.content[i]);return e},toObject:function(){var t={};return this.forEach(function(e,i){t[e]=i}),t},get size(){return this.content.length>>1}};Go.from=function(t){if(t instanceof Go)return t;var e=[];if(t)for(var i in t)e.push(i,t[i]);return new Go(e)};function Vte(t,e,i){for(let n=0;;n++){if(n==t.childCount||n==e.childCount)return t.childCount==e.childCount?null:i;let r=t.child(n),s=e.child(n);if(r==s){i+=r.nodeSize;continue}if(!r.sameMarkup(s))return i;if(r.isText&&r.text!=s.text){for(let o=0;r.text[o]==s.text[o];o++)i++;return i}if(r.content.size||s.content.size){let o=Vte(r.content,s.content,i+1);if(o!=null)return o}i+=r.nodeSize}}function Gte(t,e,i,n){for(let r=t.childCount,s=e.childCount;;){if(r==0||s==0)return r==s?null:{a:i,b:n};let o=t.child(--r),a=e.child(--s),l=o.nodeSize;if(o==a){i-=l,n-=l;continue}if(!o.sameMarkup(a))return{a:i,b:n};if(o.isText&&o.text!=a.text){let u=0,d=Math.min(o.text.length,a.text.length);for(;u<d&&o.text[o.text.length-u-1]==a.text[a.text.length-u-1];)u++,i--,n--;return{a:i,b:n}}if(o.content.size||a.content.size){let u=Gte(o.content,a.content,i-1,n-1);if(u)return u}i-=l,n-=l}}class ai{constructor(e,i){if(this.content=e,this.size=i||0,i==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,i,n,r=0,s){for(let o=0,a=0;a<i;o++){let l=this.content[o],u=a+l.nodeSize;if(u>e&&n(l,r+a,s||null,o)!==!1&&l.content.size){let d=a+1;l.nodesBetween(Math.max(0,e-d),Math.min(l.content.size,i-d),n,r+d)}a=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,i,n,r){let s="",o=!0;return this.nodesBetween(e,i,(a,l)=>{let u=a.isText?a.text.slice(Math.max(e,l)-l,i-l):a.isLeaf?r?typeof r=="function"?r(a):r:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&u||a.isTextblock)&&n&&(o?o=!1:s+=n),s+=u},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let i=this.lastChild,n=e.firstChild,r=this.content.slice(),s=0;for(i.isText&&i.sameMarkup(n)&&(r[r.length-1]=i.withText(i.text+n.text),s=1);s<e.content.length;s++)r.push(e.content[s]);return new ai(r,this.size+e.size)}cut(e,i=this.size){if(e==0&&i==this.size)return this;let n=[],r=0;if(i>e)for(let s=0,o=0;o<i;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>i)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,i-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,i-o-1))),n.push(a),r+=a.nodeSize),o=l}return new ai(n,r)}cutByIndex(e,i){return e==i?ai.empty:e==0&&i==this.content.length?this:new ai(this.content.slice(e,i))}replaceChild(e,i){let n=this.content[e];if(n==i)return this;let r=this.content.slice(),s=this.size+i.nodeSize-n.nodeSize;return r[e]=i,new ai(r,s)}addToStart(e){return new ai([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new ai(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let i=0;i<this.content.length;i++)if(!this.content[i].eq(e.content[i]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let i=this.content[e];if(!i)throw new RangeError("Index "+e+" out of range for "+this);return i}maybeChild(e){return this.content[e]||null}forEach(e){for(let i=0,n=0;i<this.content.length;i++){let r=this.content[i];e(r,n,i),n+=r.nodeSize}}findDiffStart(e,i=0){return Vte(this,e,i)}findDiffEnd(e,i=this.size,n=e.size){return Gte(this,e,i,n)}findIndex(e,i=-1){if(e==0)return rO(0,e);if(e==this.size)return rO(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let s=this.child(n),o=r+s.nodeSize;if(o>=e)return o==e||i>0?rO(n+1,o):rO(n,r);r=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,i){if(!i)return ai.empty;if(!Array.isArray(i))throw new RangeError("Invalid input for Fragment.fromJSON");return new ai(i.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return ai.empty;let i,n=0;for(let r=0;r<e.length;r++){let s=e[r];n+=s.nodeSize,r&&s.isText&&e[r-1].sameMarkup(s)?(i||(i=e.slice(0,r)),i[i.length-1]=s.withText(i[i.length-1].text+s.text)):i&&i.push(s)}return new ai(i||e,n)}static from(e){if(!e)return ai.empty;if(e instanceof ai)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new ai([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}ai.empty=new ai([],0);const NN={index:0,offset:0};function rO(t,e){return NN.index=t,NN.offset=e,NN}function jT(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let i=Array.isArray(t);if(Array.isArray(e)!=i)return!1;if(i){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!jT(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!jT(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}let zr=class tV{constructor(e,i){this.type=e,this.attrs=i}addToSet(e){let i,n=!1;for(let r=0;r<e.length;r++){let s=e[r];if(this.eq(s))return e;if(this.type.excludes(s.type))i||(i=e.slice(0,r));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(i||(i=e.slice(0,r)),i.push(this),n=!0),i&&i.push(s)}}return i||(i=e.slice()),n||i.push(this),i}removeFromSet(e){for(let i=0;i<e.length;i++)if(this.eq(e[i]))return e.slice(0,i).concat(e.slice(i+1));return e}isInSet(e){for(let i=0;i<e.length;i++)if(this.eq(e[i]))return!0;return!1}eq(e){return this==e||this.type==e.type&&jT(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let i in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,i){if(!i)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[i.type];if(!n)throw new RangeError(`There is no mark type ${i.type} in this schema`);let r=n.create(i.attrs);return n.checkAttrs(r.attrs),r}static sameSet(e,i){if(e==i)return!0;if(e.length!=i.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(i[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return tV.none;if(e instanceof tV)return[e];let i=e.slice();return i.sort((n,r)=>n.type.rank-r.type.rank),i}};zr.none=[];class QT extends Error{}class Ii{constructor(e,i,n){this.content=e,this.openStart=i,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,i){let n=Hte(this.content,e+this.openStart,i);return n&&new Ii(n,this.openStart,this.openEnd)}removeBetween(e,i){return new Ii(Ute(this.content,e+this.openStart,i+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,i){if(!i)return Ii.empty;let n=i.openStart||0,r=i.openEnd||0;if(typeof n!="number"||typeof r!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Ii(ai.fromJSON(e,i.content),n,r)}static maxOpen(e,i=!0){let n=0,r=0;for(let s=e.firstChild;s&&!s.isLeaf&&(i||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(i||!s.type.spec.isolating);s=s.lastChild)r++;return new Ii(e,n,r)}}Ii.empty=new Ii(ai.empty,0,0);function Ute(t,e,i){let{index:n,offset:r}=t.findIndex(e),s=t.maybeChild(n),{index:o,offset:a}=t.findIndex(i);if(r==e||s.isText){if(a!=i&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(i))}if(n!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(n,s.copy(Ute(s.content,e-r-1,i-r-1)))}function Hte(t,e,i,n){let{index:r,offset:s}=t.findIndex(e),o=t.maybeChild(r);if(s==e||o.isText)return t.cut(0,e).append(i).append(t.cut(e));let a=Hte(o.content,e-s-1,i);return a&&t.replaceChild(r,o.copy(a))}function H4e(t,e,i){if(i.openStart>t.depth)throw new QT("Inserted content deeper than insertion position");if(t.depth-i.openStart!=e.depth-i.openEnd)throw new QT("Inconsistent open depths");return $te(t,e,i,0)}function $te(t,e,i,n){let r=t.index(n),s=t.node(n);if(r==e.index(n)&&n<t.depth-i.openStart){let o=$te(t,e,i,n+1);return s.copy(s.content.replaceChild(r,o))}else if(i.content.size)if(!i.openStart&&!i.openEnd&&t.depth==n&&e.depth==n){let o=t.parent,a=o.content;return vg(o,a.cut(0,t.parentOffset).append(i.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=$4e(i,t);return vg(s,qte(t,o,a,e,n))}else return vg(s,ZT(t,e,n))}function Wte(t,e){if(!e.type.compatibleContent(t.type))throw new QT("Cannot join "+e.type.name+" onto "+t.type.name)}function iV(t,e,i){let n=t.node(i);return Wte(n,e.node(i)),n}function gg(t,e){let i=e.length-1;i>=0&&t.isText&&t.sameMarkup(e[i])?e[i]=t.withText(e[i].text+t.text):e.push(t)}function s_(t,e,i,n){let r=(e||t).node(i),s=0,o=e?e.index(i):r.childCount;t&&(s=t.index(i),t.depth>i?s++:t.textOffset&&(gg(t.nodeAfter,n),s++));for(let a=s;a<o;a++)gg(r.child(a),n);e&&e.depth==i&&e.textOffset&&gg(e.nodeBefore,n)}function vg(t,e){return t.type.checkContent(e),t.copy(e)}function qte(t,e,i,n,r){let s=t.depth>r&&iV(t,e,r+1),o=n.depth>r&&iV(i,n,r+1),a=[];return s_(null,t,r,a),s&&o&&e.index(r)==i.index(r)?(Wte(s,o),gg(vg(s,qte(t,e,i,n,r+1)),a)):(s&&gg(vg(s,ZT(t,e,r+1)),a),s_(e,i,r,a),o&&gg(vg(o,ZT(i,n,r+1)),a)),s_(n,null,r,a),new ai(a)}function ZT(t,e,i){let n=[];if(s_(null,t,i,n),t.depth>i){let r=iV(t,e,i+1);gg(vg(r,ZT(t,e,i+1)),n)}return s_(e,null,i,n),new ai(n)}function $4e(t,e){let i=e.depth-t.openStart,r=e.node(i).copy(t.content);for(let s=i-1;s>=0;s--)r=e.node(s).copy(ai.from(r));return{start:r.resolveNoCache(t.openStart+i),end:r.resolveNoCache(r.content.size-t.openEnd-i)}}class K_{constructor(e,i,n){this.pos=e,this.path=i,this.parentOffset=n,this.depth=i.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,i=this.index(this.depth);if(i==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=e.child(i);return n?e.child(i).cut(n):r}get nodeBefore(){let e=this.index(this.depth),i=this.pos-this.path[this.path.length-1];return i?this.parent.child(e).cut(0,i):e==0?null:this.parent.child(e-1)}posAtIndex(e,i){i=this.resolveDepth(i);let n=this.path[i*3],r=i==0?0:this.path[i*3-1]+1;for(let s=0;s<e;s++)r+=n.child(s).nodeSize;return r}marks(){let e=this.parent,i=this.index();if(e.content.size==0)return zr.none;if(this.textOffset)return e.child(i).marks;let n=e.maybeChild(i-1),r=e.maybeChild(i);if(!n){let a=n;n=r,r=a}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!r||!s[o].isInSet(r.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let i=this.parent.maybeChild(this.index());if(!i||!i.isInline)return null;let n=i.marks,r=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!r||!n[s].isInSet(r.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let i=this.depth;i>0;i--)if(this.start(i)<=e&&this.end(i)>=e)return i;return 0}blockRange(e=this,i){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!i||i(this.node(n))))return new XT(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let i=1;i<=this.depth;i++)e+=(e?"/":"")+this.node(i).type.name+"_"+this.index(i-1);return e+":"+this.parentOffset}static resolve(e,i){if(!(i>=0&&i<=e.content.size))throw new RangeError("Position "+i+" out of range");let n=[],r=0,s=i;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),u=s-l;if(n.push(o,a,r+l),!u||(o=o.child(a),o.isText))break;s=u-1,r+=l+1}return new K_(i,n,s)}static resolveCached(e,i){let n=Pq.get(e);if(n)for(let s=0;s<n.elts.length;s++){let o=n.elts[s];if(o.pos==i)return o}else Pq.set(e,n=new W4e);let r=n.elts[n.i]=K_.resolve(e,i);return n.i=(n.i+1)%q4e,r}}class W4e{constructor(){this.elts=[],this.i=0}}const q4e=12,Pq=new WeakMap;class XT{constructor(e,i,n){this.$from=e,this.$to=i,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const j4e=Object.create(null);let vp=class nV{constructor(e,i,n,r=zr.none){this.type=e,this.attrs=i,this.marks=r,this.content=n||ai.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,i,n,r=0){this.content.nodesBetween(e,i,n,r,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,i,n,r){return this.content.textBetween(e,i,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,i,n){return this.type==e&&jT(this.attrs,i||e.defaultAttrs||j4e)&&zr.sameSet(this.marks,n||zr.none)}copy(e=null){return e==this.content?this:new nV(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new nV(this.type,this.attrs,this.content,e)}cut(e,i=this.content.size){return e==0&&i==this.content.size?this:this.copy(this.content.cut(e,i))}slice(e,i=this.content.size,n=!1){if(e==i)return Ii.empty;let r=this.resolve(e),s=this.resolve(i),o=n?0:r.sharedDepth(i),a=r.start(o),u=r.node(o).content.cut(r.pos-a,s.pos-a);return new Ii(u,r.depth-o,s.depth-o)}replace(e,i,n){return H4e(this.resolve(e),this.resolve(i),n)}nodeAt(e){for(let i=this;;){let{index:n,offset:r}=i.content.findIndex(e);if(i=i.maybeChild(n),!i)return null;if(r==e||i.isText)return i;e-=r+1}}childAfter(e){let{index:i,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(i),index:i,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:i,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(i),index:i,offset:n};let r=this.content.child(i-1);return{node:r,index:i-1,offset:n-r.nodeSize}}resolve(e){return K_.resolveCached(this,e)}resolveNoCache(e){return K_.resolve(this,e)}rangeHasMark(e,i,n){let r=!1;return i>e&&this.nodesBetween(e,i,s=>(n.isInSet(s.marks)&&(r=!0),!r)),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),jte(this.marks,e)}contentMatchAt(e){let i=this.type.contentMatch.matchFragment(this.content,0,e);if(!i)throw new Error("Called contentMatchAt on a node with invalid content");return i}canReplace(e,i,n=ai.empty,r=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,r,s),a=o&&o.matchFragment(this.content,i);if(!a||!a.validEnd)return!1;for(let l=r;l<s;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,i,n,r){if(r&&!this.type.allowsMarks(r))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,i);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=zr.none;for(let i=0;i<this.marks.length;i++){let n=this.marks[i];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!zr.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(i=>i.type.name)}`);this.content.forEach(i=>i.check())}toJSON(){let e={type:this.type.name};for(let i in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(i=>i.toJSON())),e}static fromJSON(e,i){if(!i)throw new RangeError("Invalid input for Node.fromJSON");let n;if(i.marks){if(!Array.isArray(i.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=i.marks.map(e.markFromJSON)}if(i.type=="text"){if(typeof i.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(i.text,n)}let r=ai.fromJSON(e,i.content),s=e.nodeType(i.type).create(i.attrs,r,n);return s.type.checkAttrs(s.attrs),s}};vp.prototype.text=void 0;class KT extends vp{constructor(e,i,n,r){if(super(e,i,null,r),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):jte(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,i){return this.text.slice(e,i)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new KT(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new KT(this.type,this.attrs,e,this.marks)}cut(e=0,i=this.text.length){return e==0&&i==this.text.length?this:this.withText(this.text.slice(e,i))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function jte(t,e){for(let i=t.length-1;i>=0;i--)e=t[i].type.name+"("+e+")";return e}class zg{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,i){let n=new Q4e(e,i);if(n.next==null)return zg.empty;let r=Qte(n);n.next&&n.err("Unexpected trailing text");let s=t$e(e$e(r));return i$e(s,n),s}matchType(e){for(let i=0;i<this.next.length;i++)if(this.next[i].type==e)return this.next[i].next;return null}matchFragment(e,i=0,n=e.childCount){let r=this;for(let s=i;r&&s<n;s++)r=r.matchType(e.child(s).type);return r}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:i}=this.next[e];if(!(i.isText||i.hasRequiredAttrs()))return i}return null}compatible(e){for(let i=0;i<this.next.length;i++)for(let n=0;n<e.next.length;n++)if(this.next[i].type==e.next[n].type)return!0;return!1}fillBefore(e,i=!1,n=0){let r=[this];function s(o,a){let l=o.matchFragment(e,n);if(l&&(!i||l.validEnd))return ai.from(a.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:d,next:p}=o.next[u];if(!(d.isText||d.hasRequiredAttrs())&&r.indexOf(p)==-1){r.push(p);let v=s(p,a.concat(d));if(v)return v}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let i=this.computeWrapping(e);return this.wrapCache.push(e,i),i}computeWrapping(e){let i=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let r=n.shift(),s=r.match;if(s.matchType(e)){let o=[];for(let a=r;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in i)&&(!r.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:r}),i[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function i(n){e.push(n);for(let r=0;r<n.next.length;r++)e.indexOf(n.next[r].next)==-1&&i(n.next[r].next)}return i(this),e.map((n,r)=>{let s=r+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}}zg.empty=new zg(!0);class Q4e{constructor(e,i){this.string=e,this.nodeTypes=i,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function Qte(t){let e=[];do e.push(Z4e(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function Z4e(t){let e=[];do e.push(X4e(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function X4e(t){let e=J4e(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=K4e(t,e);else break;return e}function Eq(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function K4e(t,e){let i=Eq(t),n=i;return t.eat(",")&&(t.next!="}"?n=Eq(t):n=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:i,max:n,expr:e}}function Y4e(t,e){let i=t.nodeTypes,n=i[e];if(n)return[n];let r=[];for(let s in i){let o=i[s];o.isInGroup(e)&&r.push(o)}return r.length==0&&t.err("No node type or group '"+e+"' found"),r}function J4e(t){if(t.eat("(")){let e=Qte(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=Y4e(t,t.next).map(i=>(t.inline==null?t.inline=i.isInline:t.inline!=i.isInline&&t.err("Mixing inline and block content"),{type:"name",value:i}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function e$e(t){let e=[[]];return r(s(t,0),i()),e;function i(){return e.push([])-1}function n(o,a,l){let u={term:l,to:a};return e[o].push(u),u}function r(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,u)=>l.concat(s(u,a)),[]);if(o.type=="seq")for(let l=0;;l++){let u=s(o.exprs[l],a);if(l==o.exprs.length-1)return u;r(u,a=i())}else if(o.type=="star"){let l=i();return n(a,l),r(s(o.expr,l),l),[n(l)]}else if(o.type=="plus"){let l=i();return r(s(o.expr,a),l),r(s(o.expr,l),l),[n(l)]}else{if(o.type=="opt")return[n(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let u=0;u<o.min;u++){let d=i();r(s(o.expr,l),d),l=d}if(o.max==-1)r(s(o.expr,l),l);else for(let u=o.min;u<o.max;u++){let d=i();n(l,d),r(s(o.expr,l),d),l=d}return[n(l)]}else{if(o.type=="name")return[n(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Zte(t,e){return e-t}function Aq(t,e){let i=[];return n(e),i.sort(Zte);function n(r){let s=t[r];if(s.length==1&&!s[0].term)return n(s[0].to);i.push(r);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&i.indexOf(l)==-1&&n(l)}}}function t$e(t){let e=Object.create(null);return i(Aq(t,0));function i(n){let r=[];n.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let u;for(let d=0;d<r.length;d++)r[d][0]==a&&(u=r[d][1]);Aq(t,l).forEach(d=>{u||r.push([a,u=[]]),u.indexOf(d)==-1&&u.push(d)})})});let s=e[n.join(",")]=new zg(n.indexOf(t.length-1)>-1);for(let o=0;o<r.length;o++){let a=r[o][1].sort(Zte);s.next.push({type:r[o][0],next:e[a.join(",")]||i(a)})}return s}}function i$e(t,e){for(let i=0,n=[t];i<n.length;i++){let r=n[i],s=!r.validEnd,o=[];for(let a=0;a<r.next.length;a++){let{type:l,next:u}=r.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),n.indexOf(u)==-1&&n.push(u)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Xte(t){let e=Object.create(null);for(let i in t){let n=t[i];if(!n.hasDefault)return null;e[i]=n.default}return e}function Kte(t,e){let i=Object.create(null);for(let n in t){let r=e&&e[n];if(r===void 0){let s=t[n];if(s.hasDefault)r=s.default;else throw new RangeError("No value supplied for attribute "+n)}i[n]=r}return i}function Yte(t,e,i,n){for(let r in e)if(!(r in t))throw new RangeError(`Unsupported attribute ${r} for ${i} of type ${r}`);for(let r in t){let s=t[r];s.validate&&s.validate(e[r])}}function Jte(t,e){let i=Object.create(null);if(e)for(let n in e)i[n]=new r$e(t,n,e[n]);return i}let Iq=class eie{constructor(e,i,n){this.name=e,this.schema=i,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Jte(e,n.attrs),this.defaultAttrs=Xte(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==zg.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Kte(this.attrs,e)}create(e=null,i,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new vp(this,this.computeAttrs(e),ai.from(i),zr.setFrom(n))}createChecked(e=null,i,n){return i=ai.from(i),this.checkContent(i),new vp(this,this.computeAttrs(e),i,zr.setFrom(n))}createAndFill(e=null,i,n){if(e=this.computeAttrs(e),i=ai.from(i),i.size){let o=this.contentMatch.fillBefore(i);if(!o)return null;i=o.append(i)}let r=this.contentMatch.matchFragment(i),s=r&&r.fillBefore(ai.empty,!0);return s?new vp(this,e,i.append(s),zr.setFrom(n)):null}validContent(e){let i=this.contentMatch.matchFragment(e);if(!i||!i.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Yte(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let i=0;i<e.length;i++)if(!this.allowsMarkType(e[i].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let i;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?i&&i.push(e[n]):i||(i=e.slice(0,n));return i?i.length?i:zr.none:e}static compile(e,i){let n=Object.create(null);e.forEach((s,o)=>n[s]=new eie(s,i,o));let r=i.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function n$e(t,e,i){let n=i.split("|");return r=>{let s=r===null?"null":typeof r;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${t}, got ${s}`)}}class r$e{constructor(e,i,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?n$e(e,i,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class HD{constructor(e,i,n,r){this.name=e,this.rank=i,this.schema=n,this.spec=r,this.attrs=Jte(e,r.attrs),this.excluded=null;let s=Xte(this.attrs);this.instance=s?new zr(this,s):null}create(e=null){return!e&&this.instance?this.instance:new zr(this,Kte(this.attrs,e))}static compile(e,i){let n=Object.create(null),r=0;return e.forEach((s,o)=>n[s]=new HD(s,r++,i,o)),n}removeFromSet(e){for(var i=0;i<e.length;i++)e[i].type==this&&(e=e.slice(0,i).concat(e.slice(i+1)),i--);return e}isInSet(e){for(let i=0;i<e.length;i++)if(e[i].type==this)return e[i]}checkAttrs(e){Yte(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class tie{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let i=this.spec={};for(let r in e)i[r]=e[r];i.nodes=Go.from(e.nodes),i.marks=Go.from(e.marks||{}),this.nodes=Iq.compile(this.spec.nodes,this),this.marks=HD.compile(this.spec.marks,this);let n=Object.create(null);for(let r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");let s=this.nodes[r],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=n[o]||(n[o]=zg.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?kq(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let r in this.marks){let s=this.marks[r],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:kq(this,o.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,i=null,n,r){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof Iq){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(i,n,r)}text(e,i){let n=this.nodes.text;return new KT(n,n.defaultAttrs,e,zr.setFrom(i))}mark(e,i){return typeof e=="string"&&(e=this.marks[e]),e.create(i)}nodeFromJSON(e){return vp.fromJSON(this,e)}markFromJSON(e){return zr.fromJSON(this,e)}nodeType(e){let i=this.nodes[e];if(!i)throw new RangeError("Unknown node type: "+e);return i}}function kq(t,e){let i=[];for(let n=0;n<e.length;n++){let r=e[n],s=t.marks[r],o=s;if(s)i.push(s);else for(let a in t.marks){let l=t.marks[a];(r=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(r)>-1)&&i.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return i}function s$e(t){return t.tag!=null}function o$e(t){return t.style!=null}let o_=class rV{constructor(e,i){this.schema=e,this.rules=i,this.tags=[],this.styles=[];let n=this.matchedStyles=[];i.forEach(r=>{if(s$e(r))this.tags.push(r);else if(o$e(r)){let s=/[^=]*/.exec(r.style)[0];n.indexOf(s)<0&&n.push(s),this.styles.push(r)}}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let s=e.nodes[r.node];return s.contentMatch.matchType(s)})}parse(e,i={}){let n=new Lq(this,i,!1);return n.addAll(e,zr.none,i.from,i.to),n.finish()}parseSlice(e,i={}){let n=new Lq(this,i,!0);return n.addAll(e,zr.none,i.from,i.to),Ii.maxOpen(n.finish())}matchTag(e,i,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let s=this.tags[r];if(c$e(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||i.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,i,n,r){for(let s=r?this.styles.indexOf(r)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=i))){if(o.getAttrs){let l=o.getAttrs(i);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let i=[];function n(r){let s=r.priority==null?50:r.priority,o=0;for(;o<i.length;o++){let a=i[o];if((a.priority==null?50:a.priority)<s)break}i.splice(o,0,r)}for(let r in e.marks){let s=e.marks[r].spec.parseDOM;s&&s.forEach(o=>{n(o=Fq(o)),o.mark||o.ignore||o.clearMark||(o.mark=r)})}for(let r in e.nodes){let s=e.nodes[r].spec.parseDOM;s&&s.forEach(o=>{n(o=Fq(o)),o.node||o.ignore||o.mark||(o.node=r)})}return i}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new rV(e,rV.schemaRules(e)))}};const iie={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},a$e={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},nie={ol:!0,ul:!0},Y_=1,sV=2,kM=4;function Dq(t,e,i){return e!=null?(e?Y_:0)|(e==="full"?sV:0):t&&t.whitespace=="pre"?Y_|sV:i&-5}class sO{constructor(e,i,n,r,s,o){this.type=e,this.attrs=i,this.marks=n,this.solid=r,this.options=o,this.content=[],this.activeMarks=zr.none,this.match=s||(o&kM?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let i=this.type.contentMatch.fillBefore(ai.from(e));if(i)this.match=this.type.contentMatch.matchFragment(i);else{let n=this.type.contentMatch,r;return(r=n.findWrapping(e.type))?(this.match=n,r):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Y_)){let n=this.content[this.content.length-1],r;if(n&&n.isText&&(r=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==r[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-r[0].length))}}let i=ai.from(this.content);return!e&&this.match&&(i=i.append(this.match.fillBefore(ai.empty,!0))),this.type?this.type.create(this.attrs,i,this.marks):i}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!iie.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Lq{constructor(e,i,n){this.parser=e,this.options=i,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let r=i.topNode,s,o=Dq(null,i.preserveWhitespace,0)|(n?kM:0);r?s=new sO(r.type,r.attrs,zr.none,!0,i.topMatch||r.type.contentMatch,o):n?s=new sO(null,null,zr.none,!0,null,o):s=new sO(e.schema.topNodeType,null,zr.none,!0,null,o),this.nodes=[s],this.find=i.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,i){e.nodeType==3?this.addTextNode(e,i):e.nodeType==1&&this.addElement(e,i)}addTextNode(e,i){let n=e.nodeValue,r=this.top,s=r.options&sV?"full":this.localPreserveWS||(r.options&Y_)>0;if(s==="full"||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(s)s!=="full"?n=n.replace(/\r?\n|\r/g," "):n=n.replace(/\r\n?/g,`
`);else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let o=r.content[r.content.length-1],a=e.previousSibling;(!o||a&&a.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),i),this.findInText(e)}else this.findInside(e)}addElement(e,i,n){let r=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;nie.hasOwnProperty(o)&&this.parser.normalizeLists&&l$e(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(l?l.ignore:a$e.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,i);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let u,d=this.needsBlock;if(iie.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),u=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,i);break e}let p=l&&l.skip?i:this.readStyles(e,i);p&&this.addAll(e,p),u&&this.sync(s),this.needsBlock=d}else{let u=this.readStyles(e,i);u&&this.addElementByRule(e,l,u,l.consuming===!1?a:void 0)}this.localPreserveWS=r}leafFallback(e,i){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),i)}ignoreFallback(e,i){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),i)}readStyles(e,i){let n=e.style;if(n&&n.length)for(let r=0;r<this.parser.matchedStyles.length;r++){let s=this.parser.matchedStyles[r],o=n.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?i=i.filter(u=>!l.clearMark(u)):i=i.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return i}addElementByRule(e,i,n,r){let s,o;if(i.node)if(o=this.parser.schema.nodes[i.node],o.isLeaf)this.insertNode(o.create(i.attrs),n)||this.leafFallback(e,n);else{let l=this.enter(o,i.attrs||null,n,i.preserveWhitespace);l&&(s=!0,n=l)}else{let l=this.parser.schema.marks[i.mark];n=n.concat(l.create(i.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(r)this.addElement(e,n,r);else if(i.getContent)this.findInside(e),i.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n));else{let l=e;typeof i.contentElement=="string"?l=e.querySelector(i.contentElement):typeof i.contentElement=="function"?l=i.contentElement(e):i.contentElement&&(l=i.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,i,n,r){let s=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=r==null?null:e.childNodes[r];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,i);this.findAtPoint(e,s)}findPlace(e,i){let n,r;for(let s=this.open;s>=0;s--){let o=this.nodes[s],a=o.findWrapping(e);if(a&&(!n||n.length>a.length)&&(n=a,r=o,!a.length)||o.solid)break}if(!n)return null;this.sync(r);for(let s=0;s<n.length;s++)i=this.enterInner(n[s],null,i,!1);return i}insertNode(e,i){if(e.isInline&&this.needsBlock&&!this.top.type){let r=this.textblockFromContext();r&&(i=this.enterInner(r,null,i))}let n=this.findPlace(e,i);if(n){this.closeExtra();let r=this.top;r.match&&(r.match=r.match.matchType(e.type));let s=zr.none;for(let o of n.concat(e.marks))(r.type?r.type.allowsMarkType(o.type):Nq(o.type,e.type))&&(s=o.addToSet(s));return r.content.push(e.mark(s)),!0}return!1}enter(e,i,n,r){let s=this.findPlace(e.create(i),n);return s&&(s=this.enterInner(e,i,n,!0,r)),s}enterInner(e,i,n,r=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=Dq(e,s,o.options);o.options&kM&&o.content.length==0&&(a|=kM);let l=zr.none;return n=n.filter(u=>(o.type?o.type.allowsMarkType(u.type):Nq(u.type,e))?(l=u.addToSet(l),!1):!0),this.nodes.push(new sO(e,i,l,r,null,a)),this.open++,n}closeExtra(e=!1){let i=this.nodes.length-1;if(i>this.open){for(;i>this.open;i--)this.nodes[i-1].content.push(this.nodes[i].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let i=this.open;i>=0;i--){if(this.nodes[i]==e)return this.open=i,!0;this.localPreserveWS&&(this.nodes[i].options|=Y_)}return!1}get currentPos(){this.closeExtra();let e=0;for(let i=this.open;i>=0;i--){let n=this.nodes[i].content;for(let r=n.length-1;r>=0;r--)e+=n[r].nodeSize;i&&e++}return e}findAtPoint(e,i){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==i&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&(this.find[i].pos=this.currentPos)}findAround(e,i,n){if(e!=i&&this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&i.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}findInText(e){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==e&&(this.find[i].pos=this.currentPos-(e.nodeValue.length-this.find[i].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let i=e.split("/"),n=this.options.context,r=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(r?0:1),o=(a,l)=>{for(;a>=0;a--){let u=i[a];if(u==""){if(a==i.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let d=l>0||l==0&&r?this.nodes[l].type:n&&l>=s?n.node(l-s).type:null;if(!d||d.name!=u&&!d.isInGroup(u))return!1;l--}}return!0};return o(i.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let i=e.depth;i>=0;i--){let n=e.node(i).contentMatchAt(e.indexAfter(i)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let i in this.parser.schema.nodes){let n=this.parser.schema.nodes[i];if(n.isTextblock&&n.defaultAttrs)return n}}}function l$e(t){for(let e=t.firstChild,i=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&nie.hasOwnProperty(n)&&i?(i.appendChild(e),e=i):n=="li"?i=e:n&&(i=null)}}function c$e(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function Fq(t){let e={};for(let i in t)e[i]=t[i];return e}function Nq(t,e){let i=e.schema.nodes;for(let n in i){let r=i[n];if(!r.allowsMarkType(t))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:u,next:d}=a.edge(l);if(u==e||s.indexOf(d)<0&&o(d))return!0}};if(o(r.contentMatch))return!0}}class rv{constructor(e,i){this.nodes=e,this.marks=i}serializeFragment(e,i={},n){n||(n=BN(i).createDocumentFragment());let r=n,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let a=0,l=0;for(;a<s.length&&l<o.marks.length;){let u=o.marks[l];if(!this.marks[u.type.name]){l++;continue}if(!u.eq(s[a][0])||u.type.spec.spanning===!1)break;a++,l++}for(;a<s.length;)r=s.pop()[1];for(;l<o.marks.length;){let u=o.marks[l++],d=this.serializeMark(u,o.isInline,i);d&&(s.push([u,r]),r.appendChild(d.dom),r=d.contentDOM||d.dom)}}r.appendChild(this.serializeNodeInner(o,i))}),n}serializeNodeInner(e,i){let{dom:n,contentDOM:r}=DM(BN(i),this.nodes[e.type.name](e),null,e.attrs);if(r){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,i,r)}return n}serializeNode(e,i={}){let n=this.serializeNodeInner(e,i);for(let r=e.marks.length-1;r>=0;r--){let s=this.serializeMark(e.marks[r],e.isInline,i);s&&((s.contentDOM||s.dom).appendChild(n),n=s.dom)}return n}serializeMark(e,i,n={}){let r=this.marks[e.type.name];return r&&DM(BN(n),r(e,i),null,e.attrs)}static renderSpec(e,i,n=null,r){return DM(e,i,n,r)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new rv(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let i=Bq(e.nodes);return i.text||(i.text=n=>n.text),i}static marksFromSchema(e){return Bq(e.marks)}}function Bq(t){let e={};for(let i in t){let n=t[i].spec.toDOM;n&&(e[i]=n)}return e}function BN(t){return t.document||window.document}const zq=new WeakMap;function u$e(t){let e=zq.get(t);return e===void 0&&zq.set(t,e=h$e(t)),e}function h$e(t){let e=null;function i(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")e||(e=[]),e.push(n);else for(let r=0;r<n.length;r++)i(n[r]);else for(let r in n)i(n[r])}return i(t),e}function DM(t,e,i,n){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let r=e[0],s;if(typeof r!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(s=u$e(n))&&s.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=r.indexOf(" ");o>0&&(i=r.slice(0,o),r=r.slice(o+1));let a,l=i?t.createElementNS(i,r):t.createElement(r),u=e[1],d=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){d=2;for(let p in u)if(u[p]!=null){let v=p.indexOf(" ");v>0?l.setAttributeNS(p.slice(0,v),p.slice(v+1),u[p]):l.setAttribute(p,u[p])}}for(let p=d;p<e.length;p++){let v=e[p];if(v===0){if(p<e.length-1||p>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:y,contentDOM:w}=DM(t,v,i,n);if(l.appendChild(y),w){if(a)throw new RangeError("Multiple content holes");a=w}}}return{dom:l,contentDOM:a}}const rie=65535,sie=Math.pow(2,16);function d$e(t,e){return t+e*sie}function Vq(t){return t&rie}function f$e(t){return(t-(t&rie))/sie}const oie=1,aie=2,LM=4,lie=8;class oV{constructor(e,i,n){this.pos=e,this.delInfo=i,this.recover=n}get deleted(){return(this.delInfo&lie)>0}get deletedBefore(){return(this.delInfo&(oie|LM))>0}get deletedAfter(){return(this.delInfo&(aie|LM))>0}get deletedAcross(){return(this.delInfo&LM)>0}}class ql{constructor(e,i=!1){if(this.ranges=e,this.inverted=i,!e.length&&ql.empty)return ql.empty}recover(e){let i=0,n=Vq(e);if(!this.inverted)for(let r=0;r<n;r++)i+=this.ranges[r*3+2]-this.ranges[r*3+1];return this.ranges[n*3]+i+f$e(e)}mapResult(e,i=1){return this._map(e,i,!1)}map(e,i=1){return this._map(e,i,!0)}_map(e,i,n){let r=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let u=this.ranges[a+s],d=this.ranges[a+o],p=l+u;if(e<=p){let v=u?e==l?-1:e==p?1:i:i,y=l+r+(v<0?0:d);if(n)return y;let w=e==(i<0?l:p)?null:d$e(a/3,e-l),R=e==l?aie:e==p?oie:LM;return(i<0?e!=l:e!=p)&&(R|=lie),new oV(y,R,w)}r+=d-u}return n?e+r:new oV(e+r,0,null)}touches(e,i){let n=0,r=Vq(i),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;let u=this.ranges[a+s],d=l+u;if(e<=d&&a==r*3)return!0;n+=this.ranges[a+o]-u}return!1}forEach(e){let i=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,s=0;r<this.ranges.length;r+=3){let o=this.ranges[r],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),u=this.ranges[r+i],d=this.ranges[r+n];e(a,a+u,l,l+d),s+=d-u}}invert(){return new ql(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ql.empty:new ql(e<0?[0,-e,0]:[0,0,e])}}ql.empty=new ql([]);class J_{constructor(e,i,n=0,r=e?e.length:0){this.mirror=i,this.from=n,this.to=r,this._maps=e||[],this.ownData=!(e||i)}get maps(){return this._maps}slice(e=0,i=this.maps.length){return new J_(this._maps,this.mirror,e,i)}appendMap(e,i){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),i!=null&&this.setMirror(this._maps.length-1,i)}appendMapping(e){for(let i=0,n=this._maps.length;i<e._maps.length;i++){let r=e.getMirror(i);this.appendMap(e._maps[i],r!=null&&r<i?n+r:void 0)}}getMirror(e){if(this.mirror){for(let i=0;i<this.mirror.length;i++)if(this.mirror[i]==e)return this.mirror[i+(i%2?-1:1)]}}setMirror(e,i){this.mirror||(this.mirror=[]),this.mirror.push(e,i)}appendMappingInverted(e){for(let i=e.maps.length-1,n=this._maps.length+e._maps.length;i>=0;i--){let r=e.getMirror(i);this.appendMap(e._maps[i].invert(),r!=null&&r>i?n-r-1:void 0)}}invert(){let e=new J_;return e.appendMappingInverted(this),e}map(e,i=1){if(this.mirror)return this._map(e,i,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,i);return e}mapResult(e,i=1){return this._map(e,i,!1)}_map(e,i,n){let r=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,i);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}r|=a.delInfo,e=a.pos}return n?e:new oV(e,r,null)}}const zN=Object.create(null);class ya{getMap(){return ql.empty}merge(e){return null}static fromJSON(e,i){if(!i||!i.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=zN[i.stepType];if(!n)throw new RangeError(`No step type ${i.stepType} defined`);return n.fromJSON(e,i)}static jsonID(e,i){if(e in zN)throw new RangeError("Duplicate use of step JSON ID "+e);return zN[e]=i,i.prototype.jsonID=e,i}}class eo{constructor(e,i){this.doc=e,this.failed=i}static ok(e){return new eo(e,null)}static fail(e){return new eo(null,e)}static fromReplace(e,i,n,r){try{return eo.ok(e.replace(i,n,r))}catch(s){if(s instanceof QT)return eo.fail(s.message);throw s}}}function rH(t,e,i){let n=[];for(let r=0;r<t.childCount;r++){let s=t.child(r);s.content.size&&(s=s.copy(rH(s.content,e,s))),s.isInline&&(s=e(s,i,r)),n.push(s)}return ai.fromArray(n)}class cp extends ya{constructor(e,i,n){super(),this.from=e,this.to=i,this.mark=n}apply(e){let i=e.slice(this.from,this.to),n=e.resolve(this.from),r=n.node(n.sharedDepth(this.to)),s=new Ii(rH(i.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),r),i.openStart,i.openEnd);return eo.fromReplace(e,this.from,this.to,s)}invert(){return new ph(this.from,this.to,this.mark)}map(e){let i=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return i.deleted&&n.deleted||i.pos>=n.pos?null:new cp(i.pos,n.pos,this.mark)}merge(e){return e instanceof cp&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new cp(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,i){if(typeof i.from!="number"||typeof i.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new cp(i.from,i.to,e.markFromJSON(i.mark))}}ya.jsonID("addMark",cp);class ph extends ya{constructor(e,i,n){super(),this.from=e,this.to=i,this.mark=n}apply(e){let i=e.slice(this.from,this.to),n=new Ii(rH(i.content,r=>r.mark(this.mark.removeFromSet(r.marks)),e),i.openStart,i.openEnd);return eo.fromReplace(e,this.from,this.to,n)}invert(){return new cp(this.from,this.to,this.mark)}map(e){let i=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return i.deleted&&n.deleted||i.pos>=n.pos?null:new ph(i.pos,n.pos,this.mark)}merge(e){return e instanceof ph&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ph(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,i){if(typeof i.from!="number"||typeof i.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new ph(i.from,i.to,e.markFromJSON(i.mark))}}ya.jsonID("removeMark",ph);class up extends ya{constructor(e,i){super(),this.pos=e,this.mark=i}apply(e){let i=e.nodeAt(this.pos);if(!i)return eo.fail("No node at mark step's position");let n=i.type.create(i.attrs,null,this.mark.addToSet(i.marks));return eo.fromReplace(e,this.pos,this.pos+1,new Ii(ai.from(n),0,i.isLeaf?0:1))}invert(e){let i=e.nodeAt(this.pos);if(i){let n=this.mark.addToSet(i.marks);if(n.length==i.marks.length){for(let r=0;r<i.marks.length;r++)if(!i.marks[r].isInSet(n))return new up(this.pos,i.marks[r]);return new up(this.pos,this.mark)}}return new A0(this.pos,this.mark)}map(e){let i=e.mapResult(this.pos,1);return i.deletedAfter?null:new up(i.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,i){if(typeof i.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new up(i.pos,e.markFromJSON(i.mark))}}ya.jsonID("addNodeMark",up);class A0 extends ya{constructor(e,i){super(),this.pos=e,this.mark=i}apply(e){let i=e.nodeAt(this.pos);if(!i)return eo.fail("No node at mark step's position");let n=i.type.create(i.attrs,null,this.mark.removeFromSet(i.marks));return eo.fromReplace(e,this.pos,this.pos+1,new Ii(ai.from(n),0,i.isLeaf?0:1))}invert(e){let i=e.nodeAt(this.pos);return!i||!this.mark.isInSet(i.marks)?this:new up(this.pos,this.mark)}map(e){let i=e.mapResult(this.pos,1);return i.deletedAfter?null:new A0(i.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,i){if(typeof i.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new A0(i.pos,e.markFromJSON(i.mark))}}ya.jsonID("removeNodeMark",A0);class Po extends ya{constructor(e,i,n,r=!1){super(),this.from=e,this.to=i,this.slice=n,this.structure=r}apply(e){return this.structure&&aV(e,this.from,this.to)?eo.fail("Structure replace would overwrite content"):eo.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ql([this.from,this.to-this.from,this.slice.size])}invert(e){return new Po(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let i=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return i.deletedAcross&&n.deletedAcross?null:new Po(i.pos,Math.max(i.pos,n.pos),this.slice)}merge(e){if(!(e instanceof Po)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let i=this.slice.size+e.slice.size==0?Ii.empty:new Ii(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Po(this.from,this.to+(e.to-e.from),i,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let i=this.slice.size+e.slice.size==0?Ii.empty:new Ii(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Po(e.from,this.to,i,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,i){if(typeof i.from!="number"||typeof i.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Po(i.from,i.to,Ii.fromJSON(e,i.slice),!!i.structure)}}ya.jsonID("replace",Po);class Ao extends ya{constructor(e,i,n,r,s,o,a=!1){super(),this.from=e,this.to=i,this.gapFrom=n,this.gapTo=r,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(aV(e,this.from,this.gapFrom)||aV(e,this.gapTo,this.to)))return eo.fail("Structure gap-replace would overwrite content");let i=e.slice(this.gapFrom,this.gapTo);if(i.openStart||i.openEnd)return eo.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,i.content);return n?eo.fromReplace(e,this.from,this.to,n):eo.fail("Content does not fit in gap")}getMap(){return new ql([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let i=this.gapTo-this.gapFrom;return new Ao(this.from,this.from+this.slice.size+i,this.from+this.insert,this.from+this.insert+i,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let i=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),r=this.from==this.gapFrom?i.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return i.deletedAcross&&n.deletedAcross||r<i.pos||s>n.pos?null:new Ao(i.pos,n.pos,r,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,i){if(typeof i.from!="number"||typeof i.to!="number"||typeof i.gapFrom!="number"||typeof i.gapTo!="number"||typeof i.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Ao(i.from,i.to,i.gapFrom,i.gapTo,Ii.fromJSON(e,i.slice),i.insert,!!i.structure)}}ya.jsonID("replaceAround",Ao);function aV(t,e,i){let n=t.resolve(e),r=i-e,s=n.depth;for(;r>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,r--;if(r>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;r>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,r--}}return!1}function p$e(t,e,i,n){let r=[],s=[],o,a;t.doc.nodesBetween(e,i,(l,u,d)=>{if(!l.isInline)return;let p=l.marks;if(!n.isInSet(p)&&d.type.allowsMarkType(n.type)){let v=Math.max(u,e),y=Math.min(u+l.nodeSize,i),w=n.addToSet(p);for(let R=0;R<p.length;R++)p[R].isInSet(w)||(o&&o.to==v&&o.mark.eq(p[R])?o.to=y:r.push(o=new ph(v,y,p[R])));a&&a.to==v?a.to=y:s.push(a=new cp(v,y,n))}}),r.forEach(l=>t.step(l)),s.forEach(l=>t.step(l))}function m$e(t,e,i,n){let r=[],s=0;t.doc.nodesBetween(e,i,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(n instanceof HD){let u=o.marks,d;for(;d=n.isInSet(u);)(l||(l=[])).push(d),u=d.removeFromSet(u)}else n?n.isInSet(o.marks)&&(l=[n]):l=o.marks;if(l&&l.length){let u=Math.min(a+o.nodeSize,i);for(let d=0;d<l.length;d++){let p=l[d],v;for(let y=0;y<r.length;y++){let w=r[y];w.step==s-1&&p.eq(r[y].style)&&(v=w)}v?(v.to=u,v.step=s):r.push({style:p,from:Math.max(a,e),to:u,step:s})}}}),r.forEach(o=>t.step(new ph(o.from,o.to,o.style)))}function sH(t,e,i,n=i.contentMatch,r=!0){let s=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let u=s.child(l),d=a+u.nodeSize,p=n.matchType(u.type);if(!p)o.push(new Po(a,d,Ii.empty));else{n=p;for(let v=0;v<u.marks.length;v++)i.allowsMarkType(u.marks[v].type)||t.step(new ph(a,d,u.marks[v]));if(r&&u.isText&&i.whitespace!="pre"){let v,y=/\r?\n|\r/g,w;for(;v=y.exec(u.text);)w||(w=new Ii(ai.from(i.schema.text(" ",i.allowedMarks(u.marks))),0,0)),o.push(new Po(a+v.index,a+v.index+v[0].length,w))}}a=d}if(!n.validEnd){let l=n.fillBefore(ai.empty,!0);t.replace(a,a,new Ii(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function g$e(t,e,i){return(e==0||t.canReplace(e,t.childCount))&&(i==t.childCount||t.canReplace(0,i))}function fx(t){let i=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let n=t.depth;;--n){let r=t.$from.node(n),s=t.$from.index(n),o=t.$to.indexAfter(n);if(n<t.depth&&r.canReplace(s,o,i))return n;if(n==0||r.type.spec.isolating||!g$e(r,s,o))break}return null}function v$e(t,e,i){let{$from:n,$to:r,depth:s}=e,o=n.before(s+1),a=r.after(s+1),l=o,u=a,d=ai.empty,p=0;for(let w=s,R=!1;w>i;w--)R||n.index(w)>0?(R=!0,d=ai.from(n.node(w).copy(d)),p++):l--;let v=ai.empty,y=0;for(let w=s,R=!1;w>i;w--)R||r.after(w+1)<r.end(w)?(R=!0,v=ai.from(r.node(w).copy(v)),y++):u++;t.step(new Ao(l,u,o,a,new Ii(d.append(v),p,y),d.size-p,!0))}function oH(t,e,i=null,n=t){let r=y$e(t,e),s=r&&x$e(n,e);return s?r.map(Gq).concat({type:e,attrs:i}).concat(s.map(Gq)):null}function Gq(t){return{type:t,attrs:null}}function y$e(t,e){let{parent:i,startIndex:n,endIndex:r}=t,s=i.contentMatchAt(n).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return i.canReplaceWith(n,r,o)?s:null}function x$e(t,e){let{parent:i,startIndex:n,endIndex:r}=t,s=i.child(n),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let u=n;l&&u<r;u++)l=l.matchType(i.child(u).type);return!l||!l.validEnd?null:o}function b$e(t,e,i){let n=ai.empty;for(let o=i.length-1;o>=0;o--){if(n.size){let a=i[o].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=ai.from(i[o].type.create(i[o].attrs,n))}let r=e.start,s=e.end;t.step(new Ao(r,s,r,s,new Ii(n,0,0),i.length,!0))}function w$e(t,e,i,n,r){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=t.steps.length;t.doc.nodesBetween(e,i,(o,a)=>{let l=typeof r=="function"?r(o):r;if(o.isTextblock&&!o.hasMarkup(n,l)&&_$e(t.doc,t.mapping.slice(s).map(a),n)){let u=null;if(n.schema.linebreakReplacement){let y=n.whitespace=="pre",w=!!n.contentMatch.matchType(n.schema.linebreakReplacement);y&&!w?u=!1:!y&&w&&(u=!0)}u===!1&&uie(t,o,a,s),sH(t,t.mapping.slice(s).map(a,1),n,void 0,u===null);let d=t.mapping.slice(s),p=d.map(a,1),v=d.map(a+o.nodeSize,1);return t.step(new Ao(p,v,p+1,v-1,new Ii(ai.from(n.create(l,null,o.marks)),0,0),1,!0)),u===!0&&cie(t,o,a,s),!1}})}function cie(t,e,i,n){e.forEach((r,s)=>{if(r.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(r.text);){let l=t.mapping.slice(n).map(i+1+s+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function uie(t,e,i,n){e.forEach((r,s)=>{if(r.type==r.type.schema.linebreakReplacement){let o=t.mapping.slice(n).map(i+1+s);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function _$e(t,e,i){let n=t.resolve(e),r=n.index();return n.parent.canReplaceWith(r,r+1,i)}function C$e(t,e,i,n,r){let s=t.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");i||(i=s.type);let o=i.create(n,null,r||s.marks);if(s.isLeaf)return t.replaceWith(e,e+s.nodeSize,o);if(!i.validContent(s.content))throw new RangeError("Invalid content for node type "+i.name);t.step(new Ao(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new Ii(ai.from(o),0,0),1,!0))}function kd(t,e,i=1,n){let r=t.resolve(e),s=r.depth-i,o=n&&n[n.length-1]||r.parent;if(s<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!o.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let u=r.depth-1,d=i-2;u>s;u--,d--){let p=r.node(u),v=r.index(u);if(p.type.spec.isolating)return!1;let y=p.content.cutByIndex(v,p.childCount),w=n&&n[d+1];w&&(y=y.replaceChild(0,w.type.create(w.attrs)));let R=n&&n[d]||p;if(!p.canReplace(v+1,p.childCount)||!R.type.validContent(y))return!1}let a=r.indexAfter(s),l=n&&n[0];return r.node(s).canReplaceWith(a,a,l?l.type:r.node(s+1).type)}function S$e(t,e,i=1,n){let r=t.doc.resolve(e),s=ai.empty,o=ai.empty;for(let a=r.depth,l=r.depth-i,u=i-1;a>l;a--,u--){s=ai.from(r.node(a).copy(s));let d=n&&n[u];o=ai.from(d?d.type.create(d.attrs,o):r.node(a).copy(o))}t.step(new Po(e,e,new Ii(s.append(o),i,i),!0))}function zp(t,e){let i=t.resolve(e),n=i.index();return hie(i.nodeBefore,i.nodeAfter)&&i.parent.canReplace(n,n+1)}function O$e(t,e){e.content.size||t.type.compatibleContent(e.type);let i=t.contentMatchAt(t.childCount),{linebreakReplacement:n}=t.type.schema;for(let r=0;r<e.childCount;r++){let s=e.child(r),o=s.type==n?t.type.schema.nodes.text:s.type;if(i=i.matchType(o),!i||!t.type.allowsMarks(s.marks))return!1}return i.validEnd}function hie(t,e){return!!(t&&e&&!t.isLeaf&&O$e(t,e))}function $D(t,e,i=-1){let n=t.resolve(e);for(let r=n.depth;;r--){let s,o,a=n.index(r);if(r==n.depth?(s=n.nodeBefore,o=n.nodeAfter):i>0?(s=n.node(r+1),a++,o=n.node(r).maybeChild(a)):(s=n.node(r).maybeChild(a-1),o=n.node(r+1)),s&&!s.isTextblock&&hie(s,o)&&n.node(r).canReplace(a,a+1))return e;if(r==0)break;e=i<0?n.before(r):n.after(r)}}function M$e(t,e,i){let n=null,{linebreakReplacement:r}=t.doc.type.schema,s=t.doc.resolve(e-i),o=s.node().type;if(r&&o.inlineContent){let d=o.whitespace=="pre",p=!!o.contentMatch.matchType(r);d&&!p?n=!1:!d&&p&&(n=!0)}let a=t.steps.length;if(n===!1){let d=t.doc.resolve(e+i);uie(t,d.node(),d.before(),a)}o.inlineContent&&sH(t,e+i-1,o,s.node().contentMatchAt(s.index()),n==null);let l=t.mapping.slice(a),u=l.map(e-i);if(t.step(new Po(u,l.map(e+i,-1),Ii.empty,!0)),n===!0){let d=t.doc.resolve(u);cie(t,d.node(),d.before(),t.steps.length)}return t}function T$e(t,e,i){let n=t.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),i))return e;if(n.parentOffset==0)for(let r=n.depth-1;r>=0;r--){let s=n.index(r);if(n.node(r).canReplaceWith(s,s,i))return n.before(r+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let r=n.depth-1;r>=0;r--){let s=n.indexAfter(r);if(n.node(r).canReplaceWith(s,s,i))return n.after(r+1);if(s<n.node(r).childCount)return null}return null}function die(t,e,i){let n=t.resolve(e);if(!i.content.size)return e;let r=i.content;for(let s=0;s<i.openStart;s++)r=r.firstChild.content;for(let s=1;s<=(i.openStart==0&&i.size?2:1);s++)for(let o=n.depth;o>=0;o--){let a=o==n.depth?0:n.pos<=(n.start(o+1)+n.end(o+1))/2?-1:1,l=n.index(o)+(a>0?1:0),u=n.node(o),d=!1;if(s==1)d=u.canReplace(l,l,r);else{let p=u.contentMatchAt(l).findWrapping(r.firstChild.type);d=p&&u.canReplaceWith(l,l,p[0])}if(d)return a==0?n.pos:a<0?n.before(o+1):n.after(o+1)}return null}function WD(t,e,i=e,n=Ii.empty){if(e==i&&!n.size)return null;let r=t.resolve(e),s=t.resolve(i);return fie(r,s,n)?new Po(e,i,n):new R$e(r,s,n).fit()}function fie(t,e,i){return!i.openStart&&!i.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),i.content)}class R$e{constructor(e,i,n){this.$from=e,this.$to=i,this.unplaced=n,this.frontier=[],this.placed=ai.empty;for(let r=0;r<=e.depth;r++){let s=e.node(r);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(r))})}for(let r=e.depth;r>0;r--)this.placed=ai.from(e.node(r).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),i=this.placed.size-this.depth-this.$from.depth,n=this.$from,r=this.close(e<0?this.$to:n.doc.resolve(e));if(!r)return null;let s=this.placed,o=n.depth,a=r.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new Ii(s,o,a);return e>-1?new Ao(n.pos,e,this.$to.pos,this.$to.end(),l,i):l.size||n.pos!=this.$to.pos?new Po(n.pos,r.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let i=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<e;n++){let s=i.firstChild;if(i.childCount>1&&(r=0),s.type.spec.isolating&&r<=n){e=n;break}i=s.content}for(let i=1;i<=2;i++)for(let n=i==1?e:this.unplaced.openStart;n>=0;n--){let r,s=null;n?(s=VN(this.unplaced.content,n-1).firstChild,r=s.content):r=this.unplaced.content;let o=r.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:u}=this.frontier[a],d,p=null;if(i==1&&(o?u.matchType(o.type)||(p=u.fillBefore(ai.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:a,parent:s,inject:p};if(i==2&&o&&(d=u.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:a,parent:s,wrap:d};if(s&&u.matchType(s.type))break}}}openMore(){let{content:e,openStart:i,openEnd:n}=this.unplaced,r=VN(e,i);return!r.childCount||r.firstChild.isLeaf?!1:(this.unplaced=new Ii(e,i+1,Math.max(n,r.size+i>=e.size-n?i+1:0)),!0)}dropNode(){let{content:e,openStart:i,openEnd:n}=this.unplaced,r=VN(e,i);if(r.childCount<=1&&i>0){let s=e.size-i<=i+r.size;this.unplaced=new Ii(Tw(e,i-1,1),i-1,s?i-1:n)}else this.unplaced=new Ii(Tw(e,i,1),i,n)}placeNodes({sliceDepth:e,frontierDepth:i,parent:n,inject:r,wrap:s}){for(;this.depth>i;)this.closeFrontierNode();if(s)for(let R=0;R<s.length;R++)this.openFrontierNode(s[R]);let o=this.unplaced,a=n?n.content:o.content,l=o.openStart-e,u=0,d=[],{match:p,type:v}=this.frontier[i];if(r){for(let R=0;R<r.childCount;R++)d.push(r.child(R));p=p.matchFragment(r)}let y=a.size+e-(o.content.size-o.openEnd);for(;u<a.childCount;){let R=a.child(u),O=p.matchType(R.type);if(!O)break;u++,(u>1||l==0||R.content.size)&&(p=O,d.push(pie(R.mark(v.allowedMarks(R.marks)),u==1?l:0,u==a.childCount?y:-1)))}let w=u==a.childCount;w||(y=-1),this.placed=Rw(this.placed,i,ai.from(d)),this.frontier[i].match=p,w&&y<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let R=0,O=a;R<y;R++){let P=O.lastChild;this.frontier.push({type:P.type,match:P.contentMatchAt(P.childCount)}),O=P.content}this.unplaced=w?e==0?Ii.empty:new Ii(Tw(o.content,e-1,1),e-1,y<0?o.openEnd:e-1):new Ii(Tw(o.content,e,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],i;if(!e.type.isTextblock||!GN(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(i=this.findCloseLevel(this.$to))&&i.depth==this.depth)return-1;let{depth:n}=this.$to,r=this.$to.after(n);for(;n>1&&r==this.$to.end(--n);)++r;return r}findCloseLevel(e){e:for(let i=Math.min(this.depth,e.depth);i>=0;i--){let{match:n,type:r}=this.frontier[i],s=i<e.depth&&e.end(i+1)==e.pos+(e.depth-(i+1)),o=GN(e,i,r,n,s);if(o){for(let a=i-1;a>=0;a--){let{match:l,type:u}=this.frontier[a],d=GN(e,a,u,l,!0);if(!d||d.childCount)continue e}return{depth:i,fit:o,move:s?e.doc.resolve(e.after(i+1)):e}}}}close(e){let i=this.findCloseLevel(e);if(!i)return null;for(;this.depth>i.depth;)this.closeFrontierNode();i.fit.childCount&&(this.placed=Rw(this.placed,i.depth,i.fit)),e=i.move;for(let n=i.depth+1;n<=e.depth;n++){let r=e.node(n),s=r.type.contentMatch.fillBefore(r.content,!0,e.index(n));this.openFrontierNode(r.type,r.attrs,s)}return e}openFrontierNode(e,i=null,n){let r=this.frontier[this.depth];r.match=r.match.matchType(e),this.placed=Rw(this.placed,this.depth,ai.from(e.create(i,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let i=this.frontier.pop().match.fillBefore(ai.empty,!0);i.childCount&&(this.placed=Rw(this.placed,this.frontier.length,i))}}function Tw(t,e,i){return e==0?t.cutByIndex(i,t.childCount):t.replaceChild(0,t.firstChild.copy(Tw(t.firstChild.content,e-1,i)))}function Rw(t,e,i){return e==0?t.append(i):t.replaceChild(t.childCount-1,t.lastChild.copy(Rw(t.lastChild.content,e-1,i)))}function VN(t,e){for(let i=0;i<e;i++)t=t.firstChild.content;return t}function pie(t,e,i){if(e<=0)return t;let n=t.content;return e>1&&(n=n.replaceChild(0,pie(n.firstChild,e-1,n.childCount==1?i-1:0))),e>0&&(n=t.type.contentMatch.fillBefore(n).append(n),i<=0&&(n=n.append(t.type.contentMatch.matchFragment(n).fillBefore(ai.empty,!0)))),t.copy(n)}function GN(t,e,i,n,r){let s=t.node(e),o=r?t.indexAfter(e):t.index(e);if(o==s.childCount&&!i.compatibleContent(s.type))return null;let a=n.fillBefore(s.content,!0,o);return a&&!P$e(i,s.content,o)?a:null}function P$e(t,e,i){for(let n=i;n<e.childCount;n++)if(!t.allowsMarks(e.child(n).marks))return!0;return!1}function E$e(t){return t.spec.defining||t.spec.definingForContent}function A$e(t,e,i,n){if(!n.size)return t.deleteRange(e,i);let r=t.doc.resolve(e),s=t.doc.resolve(i);if(fie(r,s,n))return t.step(new Po(e,i,n));let o=gie(r,t.doc.resolve(i));o[o.length-1]==0&&o.pop();let a=-(r.depth+1);o.unshift(a);for(let v=r.depth,y=r.pos-1;v>0;v--,y--){let w=r.node(v).type.spec;if(w.defining||w.definingAsContext||w.isolating)break;o.indexOf(v)>-1?a=v:r.before(v)==y&&o.splice(1,0,-v)}let l=o.indexOf(a),u=[],d=n.openStart;for(let v=n.content,y=0;;y++){let w=v.firstChild;if(u.push(w),y==n.openStart)break;v=w.content}for(let v=d-1;v>=0;v--){let y=u[v],w=E$e(y.type);if(w&&!y.sameMarkup(r.node(Math.abs(a)-1)))d=v;else if(w||!y.type.isTextblock)break}for(let v=n.openStart;v>=0;v--){let y=(v+d+1)%(n.openStart+1),w=u[y];if(w)for(let R=0;R<o.length;R++){let O=o[(R+l)%o.length],P=!0;O<0&&(P=!1,O=-O);let N=r.node(O-1),F=r.index(O-1);if(N.canReplaceWith(F,F,w.type,w.marks))return t.replace(r.before(O),P?s.after(O):i,new Ii(mie(n.content,0,n.openStart,y),y,n.openEnd))}}let p=t.steps.length;for(let v=o.length-1;v>=0&&(t.replace(e,i,n),!(t.steps.length>p));v--){let y=o[v];y<0||(e=r.before(y),i=s.after(y))}}function mie(t,e,i,n,r){if(e<i){let s=t.firstChild;t=t.replaceChild(0,s.copy(mie(s.content,e+1,i,n,s)))}if(e>n){let s=r.contentMatchAt(0),o=s.fillBefore(t).append(t);t=o.append(s.matchFragment(o).fillBefore(ai.empty,!0))}return t}function I$e(t,e,i,n){if(!n.isInline&&e==i&&t.doc.resolve(e).parent.content.size){let r=T$e(t.doc,e,n.type);r!=null&&(e=i=r)}t.replaceRange(e,i,new Ii(ai.from(n),0,0))}function k$e(t,e,i){let n=t.doc.resolve(e),r=t.doc.resolve(i),s=gie(n,r);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return t.delete(n.start(a),r.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),r.indexAfter(a-1))))return t.delete(n.before(a),r.after(a))}for(let o=1;o<=n.depth&&o<=r.depth;o++)if(e-n.start(o)==n.depth-o&&i>n.end(o)&&r.end(o)-i!=r.depth-o&&n.start(o-1)==r.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),r.index(o-1)))return t.delete(n.before(o),i);t.delete(e,i)}function gie(t,e){let i=[],n=Math.min(t.depth,e.depth);for(let r=n;r>=0;r--){let s=t.start(r);if(s<t.pos-(t.depth-r)||e.end(r)>e.pos+(e.depth-r)||t.node(r).type.spec.isolating||e.node(r).type.spec.isolating)break;(s==e.start(r)||r==t.depth&&r==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&r&&e.start(r-1)==s-1)&&i.push(r)}return i}class r0 extends ya{constructor(e,i,n){super(),this.pos=e,this.attr=i,this.value=n}apply(e){let i=e.nodeAt(this.pos);if(!i)return eo.fail("No node at attribute step's position");let n=Object.create(null);for(let s in i.attrs)n[s]=i.attrs[s];n[this.attr]=this.value;let r=i.type.create(n,null,i.marks);return eo.fromReplace(e,this.pos,this.pos+1,new Ii(ai.from(r),0,i.isLeaf?0:1))}getMap(){return ql.empty}invert(e){return new r0(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let i=e.mapResult(this.pos,1);return i.deletedAfter?null:new r0(i.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,i){if(typeof i.pos!="number"||typeof i.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new r0(i.pos,i.attr,i.value)}}ya.jsonID("attr",r0);class eC extends ya{constructor(e,i){super(),this.attr=e,this.value=i}apply(e){let i=Object.create(null);for(let r in e.attrs)i[r]=e.attrs[r];i[this.attr]=this.value;let n=e.type.create(i,e.content,e.marks);return eo.ok(n)}getMap(){return ql.empty}invert(e){return new eC(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,i){if(typeof i.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new eC(i.attr,i.value)}}ya.jsonID("docAttr",eC);let I0=class extends Error{};I0=function t(e){let i=Error.call(this,e);return i.__proto__=t.prototype,i};I0.prototype=Object.create(Error.prototype);I0.prototype.constructor=I0;I0.prototype.name="TransformError";class D$e{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new J_}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let i=this.maybeStep(e);if(i.failed)throw new I0(i.failed);return this}maybeStep(e){let i=e.apply(this.doc);return i.failed||this.addStep(e,i.doc),i}get docChanged(){return this.steps.length>0}addStep(e,i){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=i}replace(e,i=e,n=Ii.empty){let r=WD(this.doc,e,i,n);return r&&this.step(r),this}replaceWith(e,i,n){return this.replace(e,i,new Ii(ai.from(n),0,0))}delete(e,i){return this.replace(e,i,Ii.empty)}insert(e,i){return this.replaceWith(e,e,i)}replaceRange(e,i,n){return A$e(this,e,i,n),this}replaceRangeWith(e,i,n){return I$e(this,e,i,n),this}deleteRange(e,i){return k$e(this,e,i),this}lift(e,i){return v$e(this,e,i),this}join(e,i=1){return M$e(this,e,i),this}wrap(e,i){return b$e(this,e,i),this}setBlockType(e,i=e,n,r=null){return w$e(this,e,i,n,r),this}setNodeMarkup(e,i,n=null,r){return C$e(this,e,i,n,r),this}setNodeAttribute(e,i,n){return this.step(new r0(e,i,n)),this}setDocAttribute(e,i){return this.step(new eC(e,i)),this}addNodeMark(e,i){return this.step(new up(e,i)),this}removeNodeMark(e,i){if(!(i instanceof zr)){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(i=i.isInSet(n.marks),!i)return this}return this.step(new A0(e,i)),this}split(e,i=1,n){return S$e(this,e,i,n),this}addMark(e,i,n){return p$e(this,e,i,n),this}removeMark(e,i,n){return m$e(this,e,i,n),this}clearIncompatible(e,i,n){return sH(this,e,i,n),this}}const UN=Object.create(null);class Nn{constructor(e,i,n){this.$anchor=e,this.$head=i,this.ranges=n||[new L$e(e.min(i),e.max(i))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let i=0;i<e.length;i++)if(e[i].$from.pos!=e[i].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,i=Ii.empty){let n=i.content.lastChild,r=null;for(let a=0;a<i.openEnd;a++)r=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:u}=o[a],d=e.mapping.slice(s);e.replaceRange(d.map(l.pos),d.map(u.pos),a?Ii.empty:i),a==0&&$q(e,s,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(e,i){let n=e.steps.length,r=this.ranges;for(let s=0;s<r.length;s++){let{$from:o,$to:a}=r[s],l=e.mapping.slice(n),u=l.map(o.pos),d=l.map(a.pos);s?e.deleteRange(u,d):(e.replaceRangeWith(u,d,i),$q(e,n,i.isInline?-1:1))}}static findFrom(e,i,n=!1){let r=e.parent.inlineContent?new Cn(e):Dy(e.node(0),e.parent,e.pos,e.index(),i,n);if(r)return r;for(let s=e.depth-1;s>=0;s--){let o=i<0?Dy(e.node(0),e.node(s),e.before(s+1),e.index(s),i,n):Dy(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,i,n);if(o)return o}return null}static near(e,i=1){return this.findFrom(e,i)||this.findFrom(e,-i)||new ec(e.node(0))}static atStart(e){return Dy(e,e,0,0,1)||new ec(e)}static atEnd(e){return Dy(e,e,e.content.size,e.childCount,-1)||new ec(e)}static fromJSON(e,i){if(!i||!i.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=UN[i.type];if(!n)throw new RangeError(`No selection type ${i.type} defined`);return n.fromJSON(e,i)}static jsonID(e,i){if(e in UN)throw new RangeError("Duplicate use of selection JSON ID "+e);return UN[e]=i,i.prototype.jsonID=e,i}getBookmark(){return Cn.between(this.$anchor,this.$head).getBookmark()}}Nn.prototype.visible=!0;class L$e{constructor(e,i){this.$from=e,this.$to=i}}let Uq=!1;function Hq(t){!Uq&&!t.parent.inlineContent&&(Uq=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class Cn extends Nn{constructor(e,i=e){Hq(e),Hq(i),super(e,i)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,i){let n=e.resolve(i.map(this.head));if(!n.parent.inlineContent)return Nn.near(n);let r=e.resolve(i.map(this.anchor));return new Cn(r.parent.inlineContent?r:n,n)}replace(e,i=Ii.empty){if(super.replace(e,i),i==Ii.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof Cn&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new qD(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,i){if(typeof i.anchor!="number"||typeof i.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new Cn(e.resolve(i.anchor),e.resolve(i.head))}static create(e,i,n=i){let r=e.resolve(i);return new this(r,n==i?r:e.resolve(n))}static between(e,i,n){let r=e.pos-i.pos;if((!n||r)&&(n=r>=0?1:-1),!i.parent.inlineContent){let s=Nn.findFrom(i,n,!0)||Nn.findFrom(i,-n,!0);if(s)i=s.$head;else return Nn.near(i,n)}return e.parent.inlineContent||(r==0?e=i:(e=(Nn.findFrom(e,-n,!0)||Nn.findFrom(e,n,!0)).$anchor,e.pos<i.pos!=r<0&&(e=i))),new Cn(e,i)}}Nn.jsonID("text",Cn);class qD{constructor(e,i){this.anchor=e,this.head=i}map(e){return new qD(e.map(this.anchor),e.map(this.head))}resolve(e){return Cn.between(e.resolve(this.anchor),e.resolve(this.head))}}class cn extends Nn{constructor(e){let i=e.nodeAfter,n=e.node(0).resolve(e.pos+i.nodeSize);super(e,n),this.node=i}map(e,i){let{deleted:n,pos:r}=i.mapResult(this.anchor),s=e.resolve(r);return n?Nn.near(s):new cn(s)}content(){return new Ii(ai.from(this.node),0,0)}eq(e){return e instanceof cn&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new aH(this.anchor)}static fromJSON(e,i){if(typeof i.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new cn(e.resolve(i.anchor))}static create(e,i){return new cn(e.resolve(i))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}cn.prototype.visible=!1;Nn.jsonID("node",cn);class aH{constructor(e){this.anchor=e}map(e){let{deleted:i,pos:n}=e.mapResult(this.anchor);return i?new qD(n,n):new aH(n)}resolve(e){let i=e.resolve(this.anchor),n=i.nodeAfter;return n&&cn.isSelectable(n)?new cn(i):Nn.near(i)}}class ec extends Nn{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,i=Ii.empty){if(i==Ii.empty){e.delete(0,e.doc.content.size);let n=Nn.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,i)}toJSON(){return{type:"all"}}static fromJSON(e){return new ec(e)}map(e){return new ec(e)}eq(e){return e instanceof ec}getBookmark(){return F$e}}Nn.jsonID("all",ec);const F$e={map(){return this},resolve(t){return new ec(t)}};function Dy(t,e,i,n,r,s=!1){if(e.inlineContent)return Cn.create(t,i);for(let o=n-(r>0?0:1);r>0?o<e.childCount:o>=0;o+=r){let a=e.child(o);if(a.isAtom){if(!s&&cn.isSelectable(a))return cn.create(t,i-(r<0?a.nodeSize:0))}else{let l=Dy(t,a,i+r,r<0?a.childCount:0,r,s);if(l)return l}i+=a.nodeSize*r}return null}function $q(t,e,i){let n=t.steps.length-1;if(n<e)return;let r=t.steps[n];if(!(r instanceof Po||r instanceof Ao))return;let s=t.mapping.maps[n],o;s.forEach((a,l,u,d)=>{o==null&&(o=d)}),t.setSelection(Nn.near(t.doc.resolve(o),i))}const Wq=1,qq=2,jq=4;class N$e extends D$e{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Wq)&-3,this.storedMarks=null,this}get selectionSet(){return(this.updated&Wq)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=qq,this}ensureMarks(e){return zr.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&qq)>0}addStep(e,i){super.addStep(e,i),this.updated=this.updated&-3,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,i=!0){let n=this.selection;return i&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||zr.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,i,n){let r=this.doc.type.schema;if(i==null)return e?this.replaceSelectionWith(r.text(e),!0):this.deleteSelection();{if(n==null&&(n=i),n=n??i,!e)return this.deleteRange(i,n);let s=this.storedMarks;if(!s){let o=this.doc.resolve(i);s=n==i?o.marks():o.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(i,n,r.text(e,s)),this.selection.empty||this.setSelection(Nn.near(this.selection.$to)),this}}setMeta(e,i){return this.meta[typeof e=="string"?e:e.key]=i,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=jq,this}get scrolledIntoView(){return(this.updated&jq)>0}}function Qq(t,e){return!e||!t?t:t.bind(e)}class Pw{constructor(e,i,n){this.name=e,this.init=Qq(i.init,n),this.apply=Qq(i.apply,n)}}const B$e=[new Pw("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Pw("selection",{init(t,e){return t.selection||Nn.atStart(e.doc)},apply(t){return t.selection}}),new Pw("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,i,n){return n.selection.$cursor?t.storedMarks:null}}),new Pw("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class HN{constructor(e,i){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=B$e.slice(),i&&i.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new Pw(n.key,n.spec.state,n))})}}class Uy{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,i=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=i){let r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let i=[e],n=this.applyInner(e),r=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=r?r[o].n:0,u=r?r[o].state:this,d=l<i.length&&a.spec.appendTransaction.call(a,l?i.slice(l):i,u,n);if(d&&n.filterTransaction(d,o)){if(d.setMeta("appendedTransaction",e),!r){r=[];for(let p=0;p<this.config.plugins.length;p++)r.push(p<o?{state:n,n:i.length}:{state:this,n:0})}i.push(d),n=n.applyInner(d),s=!0}r&&(r[o]={state:n,n:i.length})}}if(!s)return{state:n,transactions:i}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let i=new Uy(this.config),n=this.config.fields;for(let r=0;r<n.length;r++){let s=n[r];i[s.name]=s.apply(e,this[s.name],this,i)}return i}get tr(){return new N$e(this)}static create(e){let i=new HN(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new Uy(i);for(let r=0;r<i.fields.length;r++)n[i.fields[r].name]=i.fields[r].init(e,n);return n}reconfigure(e){let i=new HN(this.schema,e.plugins),n=i.fields,r=new Uy(i);for(let s=0;s<n.length;s++){let o=n[s].name;r[o]=this.hasOwnProperty(o)?this[o]:n[s].init(e,r)}return r}toJSON(e){let i={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(i.storedMarks=this.storedMarks.map(n=>n.toJSON())),e&&typeof e=="object")for(let n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let r=e[n],s=r.spec.state;s&&s.toJSON&&(i[n]=s.toJSON.call(r,this[r.key]))}return i}static fromJSON(e,i,n){if(!i)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let r=new HN(e.schema,e.plugins),s=new Uy(r);return r.fields.forEach(o=>{if(o.name=="doc")s.doc=vp.fromJSON(e.schema,i.doc);else if(o.name=="selection")s.selection=Nn.fromJSON(s.doc,i.selection);else if(o.name=="storedMarks")i.storedMarks&&(s.storedMarks=i.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let a in n){let l=n[a],u=l.spec.state;if(l.key==o.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(i,a)){s[o.name]=u.fromJSON.call(l,e,i[a],s);return}}s[o.name]=o.init(e,s)}}),s}}function vie(t,e,i){for(let n in t){let r=t[n];r instanceof Function?r=r.bind(e):n=="handleDOMEvents"&&(r=vie(r,e,{})),i[n]=r}return i}class Ml{constructor(e){this.spec=e,this.props={},e.props&&vie(e.props,this,this.props),this.key=e.key?e.key.key:yie("plugin")}getState(e){return e[this.key]}}const $N=Object.create(null);function yie(t){return t in $N?t+"$"+ ++$N[t]:($N[t]=0,t+"$")}class Gh{constructor(e="key"){this.key=yie(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const qo=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},k0=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let lV=null;const md=function(t,e,i){let n=lV||(lV=document.createRange());return n.setEnd(t,i??t.nodeValue.length),n.setStart(t,e||0),n},z$e=function(){lV=null},Vg=function(t,e,i,n){return i&&(Zq(t,e,i,n,-1)||Zq(t,e,i,n,1))},V$e=/^(img|br|input|textarea|hr)$/i;function Zq(t,e,i,n,r){for(;;){if(t==i&&e==n)return!0;if(e==(r<0?0:Rc(t))){let s=t.parentNode;if(!s||s.nodeType!=1||ZC(t)||V$e.test(t.nodeName)||t.contentEditable=="false")return!1;e=qo(t)+(r<0?0:1),t=s}else if(t.nodeType==1){if(t=t.childNodes[e+(r<0?-1:0)],t.contentEditable=="false")return!1;e=r<0?Rc(t):0}else return!1}}function Rc(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function G$e(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Rc(t)}else if(t.parentNode&&!ZC(t))e=qo(t),t=t.parentNode;else return null}}function U$e(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!ZC(t))e=qo(t)+1,t=t.parentNode;else return null}}function H$e(t,e,i){for(let n=e==0,r=e==Rc(t);n||r;){if(t==i)return!0;let s=qo(t);if(t=t.parentNode,!t)return!1;n=n&&s==0,r=r&&s==Rc(t)}}function ZC(t){let e;for(let i=t;i&&!(e=i.pmViewDesc);i=i.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const jD=function(t){return t.focusNode&&Vg(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function jm(t,e){let i=document.createEvent("Event");return i.initEvent("keydown",!0,!0),i.keyCode=t,i.key=i.code=e,i}function $$e(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function W$e(t,e,i){if(t.caretPositionFromPoint)try{let n=t.caretPositionFromPoint(e,i);if(n)return{node:n.offsetNode,offset:Math.min(Rc(n.offsetNode),n.offset)}}catch{}if(t.caretRangeFromPoint){let n=t.caretRangeFromPoint(e,i);if(n)return{node:n.startContainer,offset:Math.min(Rc(n.startContainer),n.startOffset)}}}const Ah=typeof navigator<"u"?navigator:null,Xq=typeof document<"u"?document:null,Vp=Ah&&Ah.userAgent||"",cV=/Edge\/(\d+)/.exec(Vp),xie=/MSIE \d/.exec(Vp),uV=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Vp),Cl=!!(xie||uV||cV),yp=xie?document.documentMode:uV?+uV[1]:cV?+cV[1]:0,Mu=!Cl&&/gecko\/(\d+)/i.test(Vp);Mu&&+(/Firefox\/(\d+)/.exec(Vp)||[0,0])[1];const hV=!Cl&&/Chrome\/(\d+)/.exec(Vp),da=!!hV,bie=hV?+hV[1]:0,$a=!Cl&&!!Ah&&/Apple Computer/.test(Ah.vendor),D0=$a&&(/Mobile\/\w+/.test(Vp)||!!Ah&&Ah.maxTouchPoints>2),_c=D0||(Ah?/Mac/.test(Ah.platform):!1),q$e=Ah?/Win/.test(Ah.platform):!1,Od=/Android \d/.test(Vp),XC=!!Xq&&"webkitFontSmoothing"in Xq.documentElement.style,j$e=XC?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Q$e(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function ld(t,e){return typeof t=="number"?t:t[e]}function Z$e(t){let e=t.getBoundingClientRect(),i=e.width/t.offsetWidth||1,n=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*i,top:e.top,bottom:e.top+t.clientHeight*n}}function Kq(t,e,i){let n=t.someProp("scrollThreshold")||0,r=t.someProp("scrollMargin")||5,s=t.dom.ownerDocument;for(let o=i||t.dom;o;){if(o.nodeType!=1){o=k0(o);continue}let a=o,l=a==s.body,u=l?Q$e(s):Z$e(a),d=0,p=0;if(e.top<u.top+ld(n,"top")?p=-(u.top-e.top+ld(r,"top")):e.bottom>u.bottom-ld(n,"bottom")&&(p=e.bottom-e.top>u.bottom-u.top?e.top+ld(r,"top")-u.top:e.bottom-u.bottom+ld(r,"bottom")),e.left<u.left+ld(n,"left")?d=-(u.left-e.left+ld(r,"left")):e.right>u.right-ld(n,"right")&&(d=e.right-u.right+ld(r,"right")),d||p)if(l)s.defaultView.scrollBy(d,p);else{let y=a.scrollLeft,w=a.scrollTop;p&&(a.scrollTop+=p),d&&(a.scrollLeft+=d);let R=a.scrollLeft-y,O=a.scrollTop-w;e={left:e.left-R,top:e.top-O,right:e.right-R,bottom:e.bottom-O}}let v=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(v))break;o=v=="absolute"?o.offsetParent:k0(o)}}function X$e(t){let e=t.dom.getBoundingClientRect(),i=Math.max(0,e.top),n,r;for(let s=(e.left+e.right)/2,o=i+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(s,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=i-20){n=a,r=l.top;break}}return{refDOM:n,refTop:r,stack:wie(t.dom)}}function wie(t){let e=[],i=t.ownerDocument;for(let n=t;n&&(e.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),t!=i);n=k0(n));return e}function K$e({refDOM:t,refTop:e,stack:i}){let n=t?t.getBoundingClientRect().top:0;_ie(i,n==0?0:n-e)}function _ie(t,e){for(let i=0;i<t.length;i++){let{dom:n,top:r,left:s}=t[i];n.scrollTop!=r+e&&(n.scrollTop=r+e),n.scrollLeft!=s&&(n.scrollLeft=s)}}let cy=null;function Y$e(t){if(t.setActive)return t.setActive();if(cy)return t.focus(cy);let e=wie(t);t.focus(cy==null?{get preventScroll(){return cy={preventScroll:!0},!0}}:void 0),cy||(cy=!1,_ie(e,0))}function Cie(t,e){let i,n=2e8,r,s=0,o=e.top,a=e.top,l,u;for(let d=t.firstChild,p=0;d;d=d.nextSibling,p++){let v;if(d.nodeType==1)v=d.getClientRects();else if(d.nodeType==3)v=md(d).getClientRects();else continue;for(let y=0;y<v.length;y++){let w=v[y];if(w.top<=o&&w.bottom>=a){o=Math.max(w.bottom,o),a=Math.min(w.top,a);let R=w.left>e.left?w.left-e.left:w.right<e.left?e.left-w.right:0;if(R<n){i=d,n=R,r=R&&i.nodeType==3?{left:w.right<e.left?w.right:w.left,top:e.top}:e,d.nodeType==1&&R&&(s=p+(e.left>=(w.left+w.right)/2?1:0));continue}}else w.top>e.top&&!l&&w.left<=e.left&&w.right>=e.left&&(l=d,u={left:Math.max(w.left,Math.min(w.right,e.left)),top:w.top});!i&&(e.left>=w.right&&e.top>=w.top||e.left>=w.left&&e.top>=w.bottom)&&(s=p+1)}}return!i&&l&&(i=l,r=u,n=0),i&&i.nodeType==3?J$e(i,r):!i||n&&i.nodeType==1?{node:t,offset:s}:Cie(i,r)}function J$e(t,e){let i=t.nodeValue.length,n=document.createRange();for(let r=0;r<i;r++){n.setEnd(t,r+1),n.setStart(t,r);let s=Wf(n,1);if(s.top!=s.bottom&&lH(e,s))return{node:t,offset:r+(e.left>=(s.left+s.right)/2?1:0)}}return{node:t,offset:0}}function lH(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function eWe(t,e){let i=t.parentNode;return i&&/^li$/i.test(i.nodeName)&&e.left<t.getBoundingClientRect().left?i:t}function tWe(t,e,i){let{node:n,offset:r}=Cie(e,i),s=-1;if(n.nodeType==1&&!n.firstChild){let o=n.getBoundingClientRect();s=o.left!=o.right&&i.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(n,r,s)}function iWe(t,e,i,n){let r=-1;for(let s=e,o=!1;s!=t.dom;){let a=t.docView.nearestDesc(s,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&(!o&&l.left>n.left||l.top>n.top?r=a.posBefore:(!o&&l.right<n.left||l.bottom<n.top)&&(r=a.posAfter),o=!0),!a.contentDOM&&r<0&&!a.node.isText))return(a.node.isBlock?n.top<(l.top+l.bottom)/2:n.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;s=a.dom.parentNode}return r>-1?r:t.docView.posFromDOM(e,i,-1)}function Sie(t,e,i){let n=t.childNodes.length;if(n&&i.top<i.bottom)for(let r=Math.max(0,Math.min(n-1,Math.floor(n*(e.top-i.top)/(i.bottom-i.top))-2)),s=r;;){let o=t.childNodes[s];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let u=a[l];if(lH(e,u))return Sie(o,e,u)}}if((s=(s+1)%n)==r)break}return t}function nWe(t,e){let i=t.dom.ownerDocument,n,r=0,s=W$e(i,e.left,e.top);s&&({node:n,offset:r}=s);let o=(t.root.elementFromPoint?t.root:i).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let u=t.dom.getBoundingClientRect();if(!lH(e,u)||(o=Sie(t.dom,e,u),!o))return null}if($a)for(let u=o;n&&u;u=k0(u))u.draggable&&(n=void 0);if(o=eWe(o,e),n){if(Mu&&n.nodeType==1&&(r=Math.min(r,n.childNodes.length),r<n.childNodes.length)){let d=n.childNodes[r],p;d.nodeName=="IMG"&&(p=d.getBoundingClientRect()).right<=e.left&&p.bottom>e.top&&r++}let u;XC&&r&&n.nodeType==1&&(u=n.childNodes[r-1]).nodeType==1&&u.contentEditable=="false"&&u.getBoundingClientRect().top>=e.top&&r--,n==t.dom&&r==n.childNodes.length-1&&n.lastChild.nodeType==1&&e.top>n.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(r==0||n.nodeType!=1||n.childNodes[r-1].nodeName!="BR")&&(a=iWe(t,n,r,e))}a==null&&(a=tWe(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function Yq(t){return t.top<t.bottom||t.left<t.right}function Wf(t,e){let i=t.getClientRects();if(i.length){let n=i[e<0?0:i.length-1];if(Yq(n))return n}return Array.prototype.find.call(i,Yq)||t.getBoundingClientRect()}const rWe=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Oie(t,e,i){let{node:n,offset:r,atom:s}=t.docView.domFromPos(e,i<0?-1:1),o=XC||Mu;if(n.nodeType==3)if(o&&(rWe.test(n.nodeValue)||(i<0?!r:r==n.nodeValue.length))){let l=Wf(md(n,r,r),i);if(Mu&&r&&/\s/.test(n.nodeValue[r-1])&&r<n.nodeValue.length){let u=Wf(md(n,r-1,r-1),-1);if(u.top==l.top){let d=Wf(md(n,r,r+1),-1);if(d.top!=l.top)return Yb(d,d.left<u.left)}}return l}else{let l=r,u=r,d=i<0?1:-1;return i<0&&!r?(u++,d=-1):i>=0&&r==n.nodeValue.length?(l--,d=1):i<0?l--:u++,Yb(Wf(md(n,l,u),d),d<0)}if(!t.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&r&&(i<0||r==Rc(n))){let l=n.childNodes[r-1];if(l.nodeType==1)return WN(l.getBoundingClientRect(),!1)}if(s==null&&r<Rc(n)){let l=n.childNodes[r];if(l.nodeType==1)return WN(l.getBoundingClientRect(),!0)}return WN(n.getBoundingClientRect(),i>=0)}if(s==null&&r&&(i<0||r==Rc(n))){let l=n.childNodes[r-1],u=l.nodeType==3?md(l,Rc(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(u)return Yb(Wf(u,1),!1)}if(s==null&&r<Rc(n)){let l=n.childNodes[r];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let u=l?l.nodeType==3?md(l,0,o?0:1):l.nodeType==1?l:null:null;if(u)return Yb(Wf(u,-1),!0)}return Yb(Wf(n.nodeType==3?md(n):n,-i),i>=0)}function Yb(t,e){if(t.width==0)return t;let i=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:i,right:i}}function WN(t,e){if(t.height==0)return t;let i=e?t.top:t.bottom;return{top:i,bottom:i,left:t.left,right:t.right}}function Mie(t,e,i){let n=t.state,r=t.root.activeElement;n!=e&&t.updateState(e),r!=t.dom&&t.focus();try{return i()}finally{n!=e&&t.updateState(n),r!=t.dom&&r&&r.focus()}}function sWe(t,e,i){let n=e.selection,r=i=="up"?n.$from:n.$to;return Mie(t,e,()=>{let{node:s}=t.docView.domFromPos(r.pos,i=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.contentDOM||a.dom;break}s=a.dom.parentNode}let o=Oie(t,r.pos,1);for(let a=s.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=md(a,0,a.nodeValue.length).getClientRects();else continue;for(let u=0;u<l.length;u++){let d=l[u];if(d.bottom>d.top+1&&(i=="up"?o.top-d.top>(d.bottom-o.top)*2:d.bottom-o.bottom>(o.bottom-d.top)*2))return!1}}return!0})}const oWe=/[\u0590-\u08ac]/;function aWe(t,e,i){let{$head:n}=e.selection;if(!n.parent.isTextblock)return!1;let r=n.parentOffset,s=!r,o=r==n.parent.content.size,a=t.domSelection();return a?!oWe.test(n.parent.textContent)||!a.modify?i=="left"||i=="backward"?s:o:Mie(t,e,()=>{let{focusNode:l,focusOffset:u,anchorNode:d,anchorOffset:p}=t.domSelectionRange(),v=a.caretBidiLevel;a.modify("move",i,"character");let y=n.depth?t.docView.domAfterPos(n.before()):t.dom,{focusNode:w,focusOffset:R}=t.domSelectionRange(),O=w&&!y.contains(w.nodeType==1?w:w.parentNode)||l==w&&u==R;try{a.collapse(d,p),l&&(l!=d||u!=p)&&a.extend&&a.extend(l,u)}catch{}return v!=null&&(a.caretBidiLevel=v),O}):n.pos==n.start()||n.pos==n.end()}let Jq=null,ej=null,tj=!1;function lWe(t,e,i){return Jq==e&&ej==i?tj:(Jq=e,ej=i,tj=i=="up"||i=="down"?sWe(t,e,i):aWe(t,e,i))}const Uc=0,ij=1,Ym=2,Ih=3;class KC{constructor(e,i,n,r){this.parent=e,this.children=i,this.dom=n,this.contentDOM=r,this.dirty=Uc,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,i,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let i=0;i<this.children.length;i++)e+=this.children[i].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let i=0,n=this.posAtStart;;i++){let r=this.children[i];if(r==e)return n;n+=r.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,i,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){let s,o;if(e==this.contentDOM)s=e.childNodes[i-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[i];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let r;if(e==this.dom&&this.contentDOM)r=i>qo(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))r=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(i==0)for(let s=e;;s=s.parentNode){if(s==this.dom){r=!1;break}if(s.previousSibling)break}if(r==null&&i==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){r=!0;break}if(s.nextSibling)break}}return r??n>0?this.posAtEnd:this.posAtStart}nearestDesc(e,i=!1){for(let n=!0,r=e;r;r=r.parentNode){let s=this.getDesc(r),o;if(s&&(!i||s.node))if(n&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))n=!1;else return s}}getDesc(e){let i=e.pmViewDesc;for(let n=i;n;n=n.parent)if(n==this)return i}posFromDOM(e,i,n){for(let r=e;r;r=r.parentNode){let s=this.getDesc(r);if(s)return s.localPosFromDOM(e,i,n)}return-1}descAt(e){for(let i=0,n=0;i<this.children.length;i++){let r=this.children[i],s=n+r.size;if(n==e&&s!=n){for(;!r.border&&r.children.length;)for(let o=0;o<r.children.length;o++){let a=r.children[o];if(a.size){r=a;break}}return r}if(e<s)return r.descAt(e-n-r.border);n=s}}domFromPos(e,i){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,r=0;for(let s=0;n<this.children.length;n++){let o=this.children[n],a=s+o.size;if(a>e||o instanceof Rie){r=e-s;break}s=a}if(r)return this.children[n].domFromPos(r-this.children[n].border,i);for(let s;n&&!(s=this.children[n-1]).size&&s instanceof Tie&&s.side>=0;n--);if(i<=0){let s,o=!0;for(;s=n?this.children[n-1]:null,!(!s||s.dom.parentNode==this.contentDOM);n--,o=!1);return s&&i&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,i):{node:this.contentDOM,offset:s?qo(s.dom)+1:0}}else{let s,o=!0;for(;s=n<this.children.length?this.children[n]:null,!(!s||s.dom.parentNode==this.contentDOM);n++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,i):{node:this.contentDOM,offset:s?qo(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,i,n=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:i,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let r=-1,s=-1;for(let o=n,a=0;;a++){let l=this.children[a],u=o+l.size;if(r==-1&&e<=u){let d=o+l.border;if(e>=d&&i<=u-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,i,d);e=o;for(let p=a;p>0;p--){let v=this.children[p-1];if(v.size&&v.dom.parentNode==this.contentDOM&&!v.emptyChildAt(1)){r=qo(v.dom)+1;break}e-=v.size}r==-1&&(r=0)}if(r>-1&&(u>i||a==this.children.length-1)){i=u;for(let d=a+1;d<this.children.length;d++){let p=this.children[d];if(p.size&&p.dom.parentNode==this.contentDOM&&!p.emptyChildAt(-1)){s=qo(p.dom);break}i+=p.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=u}return{node:this.contentDOM,from:e,to:i,fromOffset:r,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let i=this.children[e<0?0:this.children.length-1];return i.size==0||i.emptyChildAt(e)}domAfterPos(e){let{node:i,offset:n}=this.domFromPos(e,0);if(i.nodeType!=1||n==i.childNodes.length)throw new RangeError("No node after pos "+e);return i.childNodes[n]}setSelection(e,i,n,r=!1){let s=Math.min(e,i),o=Math.max(e,i);for(let y=0,w=0;y<this.children.length;y++){let R=this.children[y],O=w+R.size;if(s>w&&o<O)return R.setSelection(e-w-R.border,i-w-R.border,n,r);w=O}let a=this.domFromPos(e,e?-1:1),l=i==e?a:this.domFromPos(i,i?-1:1),u=n.root.getSelection(),d=n.domSelectionRange(),p=!1;if((Mu||$a)&&e==i){let{node:y,offset:w}=a;if(y.nodeType==3){if(p=!!(w&&y.nodeValue[w-1]==`
`),p&&w==y.nodeValue.length)for(let R=y,O;R;R=R.parentNode){if(O=R.nextSibling){O.nodeName=="BR"&&(a=l={node:O.parentNode,offset:qo(O)+1});break}let P=R.pmViewDesc;if(P&&P.node&&P.node.isBlock)break}}else{let R=y.childNodes[w-1];p=R&&(R.nodeName=="BR"||R.contentEditable=="false")}}if(Mu&&d.focusNode&&d.focusNode!=l.node&&d.focusNode.nodeType==1){let y=d.focusNode.childNodes[d.focusOffset];y&&y.contentEditable=="false"&&(r=!0)}if(!(r||p&&$a)&&Vg(a.node,a.offset,d.anchorNode,d.anchorOffset)&&Vg(l.node,l.offset,d.focusNode,d.focusOffset))return;let v=!1;if((u.extend||e==i)&&!p){u.collapse(a.node,a.offset);try{e!=i&&u.extend(l.node,l.offset),v=!0}catch{}}if(!v){if(e>i){let w=a;a=l,l=w}let y=document.createRange();y.setEnd(l.node,l.offset),y.setStart(a.node,a.offset),u.removeAllRanges(),u.addRange(y)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,i){for(let n=0,r=0;r<this.children.length;r++){let s=this.children[r],o=n+s.size;if(n==o?e<=o&&i>=n:e<o&&i>n){let a=n+s.border,l=o-s.border;if(e>=a&&i<=l){this.dirty=e==n||i==o?Ym:ij,e==a&&i==l&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=Ih:s.markDirty(e-a,i-a);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?Ym:Ih}n=o}this.dirty=Ym}markParentsDirty(){let e=1;for(let i=this.parent;i;i=i.parent,e++){let n=e==1?Ym:ij;i.dirty<n&&(i.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}isText(e){return!1}}class Tie extends KC{constructor(e,i,n,r){let s,o=i.type.toDOM;if(typeof o=="function"&&(o=o(n,()=>{if(!s)return r;if(s.parent)return s.parent.posBeforeChild(s)})),!i.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=i,this.widget=i,s=this}matchesWidget(e){return this.dirty==Uc&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let i=this.widget.spec.stopEvent;return i?i(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class cWe extends KC{constructor(e,i,n,r){super(e,[],i,null),this.textDOM=n,this.text=r}get size(){return this.text.length}localPosFromDOM(e,i){return e!=this.textDOM?this.posAtStart+(i?this.size:0):this.posAtStart+i}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Gg extends KC{constructor(e,i,n,r,s){super(e,[],n,r),this.mark=i,this.spec=s}static create(e,i,n,r){let s=r.nodeViews[i.type.name],o=s&&s(i,r,n);return(!o||!o.dom)&&(o=rv.renderSpec(document,i.type.spec.toDOM(i,n),null,i.attrs)),new Gg(e,i,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&Ih||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Ih&&this.mark.eq(e)}markDirty(e,i){if(super.markDirty(e,i),this.dirty!=Uc){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=Uc}}slice(e,i,n){let r=Gg.create(this.parent,this.mark,!0,n),s=this.children,o=this.size;i<o&&(s=fV(s,i,o,n)),e>0&&(s=fV(s,0,e,n));for(let a=0;a<s.length;a++)s[a].parent=r;return r.children=s,r}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class xp extends KC{constructor(e,i,n,r,s,o,a,l,u){super(e,[],s,o),this.node=i,this.outerDeco=n,this.innerDeco=r,this.nodeDOM=a}static create(e,i,n,r,s,o){let a=s.nodeViews[i.type.name],l,u=a&&a(i,s,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},n,r),d=u&&u.dom,p=u&&u.contentDOM;if(i.isText){if(!d)d=document.createTextNode(i.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||({dom:d,contentDOM:p}=rv.renderSpec(document,i.type.spec.toDOM(i),null,i.attrs));!p&&!i.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable="false"),i.type.spec.draggable&&(d.draggable=!0));let v=d;return d=Aie(d,n,i),u?l=new uWe(e,i,n,r,d,p||null,v,u,s,o+1):i.isText?new QD(e,i,n,r,d,v,s):new xp(e,i,n,r,d,p||null,v,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let i=this.children.length-1;i>=0;i--){let n=this.children[i];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>ai.empty)}return e}matchesNode(e,i,n){return this.dirty==Uc&&e.eq(this.node)&&YT(i,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,i){let n=this.node.inlineContent,r=i,s=e.composing?this.localCompositionInfo(e,i):null,o=s&&s.pos>-1?s:null,a=s&&s.pos<0,l=new dWe(this,o&&o.node,e);mWe(this.node,this.innerDeco,(u,d,p)=>{u.spec.marks?l.syncToMarks(u.spec.marks,n,e):u.type.side>=0&&!p&&l.syncToMarks(d==this.node.childCount?zr.none:this.node.child(d).marks,n,e),l.placeWidget(u,e,r)},(u,d,p,v)=>{l.syncToMarks(u.marks,n,e);let y;l.findNodeMatch(u,d,p,v)||a&&e.state.selection.from>r&&e.state.selection.to<r+u.nodeSize&&(y=l.findIndexWithChild(s.node))>-1&&l.updateNodeAt(u,d,p,y,e)||l.updateNextNode(u,d,p,e,v,r)||l.addNode(u,d,p,e,r),r+=u.nodeSize}),l.syncToMarks([],n,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Ym)&&(o&&this.protectLocalComposition(e,o),Pie(this.contentDOM,this.children,e),D0&&gWe(this.dom))}localCompositionInfo(e,i){let{from:n,to:r}=e.state.selection;if(!(e.state.selection instanceof Cn)||n<i||r>i+this.node.content.size)return null;let s=e.input.compositionNode;if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let o=s.nodeValue,a=vWe(this.node.content,o,n-i,r-i);return a<0?null:{node:s,pos:a,text:o}}else return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:i,pos:n,text:r}){if(this.getDesc(i))return;let s=i;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new cWe(this,s,i,r);e.input.compositionNodes.push(o),this.children=fV(this.children,n,n+r.length,e,o)}update(e,i,n,r){return this.dirty==Ih||!e.sameMarkup(this.node)?!1:(this.updateInner(e,i,n,r),!0)}updateInner(e,i,n,r){this.updateOuterDeco(i),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=Uc}updateOuterDeco(e){if(YT(e,this.outerDeco))return;let i=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=Eie(this.dom,this.nodeDOM,dV(this.outerDeco,this.node,i),dV(e,this.node,i)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function nj(t,e,i,n,r){Aie(n,e,t);let s=new xp(void 0,t,e,i,n,n,n,r,0);return s.contentDOM&&s.updateChildren(r,0),s}class QD extends xp{constructor(e,i,n,r,s,o,a){super(e,i,n,r,s,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,i,n,r){return this.dirty==Ih||this.dirty!=Uc&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(i),(this.dirty!=Uc||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=e,this.dirty=Uc,!0)}inParent(){let e=this.parent.contentDOM;for(let i=this.nodeDOM;i;i=i.parentNode)if(i==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,i,n){return e==this.nodeDOM?this.posAtStart+Math.min(i,this.node.text.length):super.localPosFromDOM(e,i,n)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,i,n){let r=this.node.cut(e,i),s=document.createTextNode(r.text);return new QD(this.parent,r,this.outerDeco,this.innerDeco,s,s,n)}markDirty(e,i){super.markDirty(e,i),this.dom!=this.nodeDOM&&(e==0||i==this.nodeDOM.nodeValue.length)&&(this.dirty=Ih)}get domAtom(){return!1}isText(e){return this.node.text==e}}class Rie extends KC{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Uc&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class uWe extends xp{constructor(e,i,n,r,s,o,a,l,u,d){super(e,i,n,r,s,o,a,u,d),this.spec=l}update(e,i,n,r){if(this.dirty==Ih)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let s=this.spec.update(e,i,n);return s&&this.updateInner(e,i,n,r),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,i,n,r)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,i,n,r){this.spec.setSelection?this.spec.setSelection(e,i,n.root):super.setSelection(e,i,n,r)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function Pie(t,e,i){let n=t.firstChild,r=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==t){for(;a!=n;)n=rj(n),r=!0;n=n.nextSibling}else r=!0,t.insertBefore(a,n);if(o instanceof Gg){let l=n?n.previousSibling:t.lastChild;Pie(o.contentDOM,o.children,i),n=l?l.nextSibling:t.firstChild}}for(;n;)n=rj(n),r=!0;r&&i.trackWrites==t&&(i.trackWrites=null)}const a_=function(t){t&&(this.nodeName=t)};a_.prototype=Object.create(null);const Jm=[new a_];function dV(t,e,i){if(t.length==0)return Jm;let n=i?Jm[0]:new a_,r=[n];for(let s=0;s<t.length;s++){let o=t[s].type.attrs;if(o){o.nodeName&&r.push(n=new a_(o.nodeName));for(let a in o){let l=o[a];l!=null&&(i&&r.length==1&&r.push(n=new a_(e.isInline?"span":"div")),a=="class"?n.class=(n.class?n.class+" ":"")+l:a=="style"?n.style=(n.style?n.style+";":"")+l:a!="nodeName"&&(n[a]=l))}}}return r}function Eie(t,e,i,n){if(i==Jm&&n==Jm)return e;let r=e;for(let s=0;s<n.length;s++){let o=n[s],a=i[s];if(s){let l;a&&a.nodeName==o.nodeName&&r!=t&&(l=r.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(r),a=Jm[0]),r=l}hWe(r,a||Jm[0],o)}return r}function hWe(t,e,i){for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&!(n in i)&&t.removeAttribute(n);for(let n in i)n!="class"&&n!="style"&&n!="nodeName"&&i[n]!=e[n]&&t.setAttribute(n,i[n]);if(e.class!=i.class){let n=e.class?e.class.split(" ").filter(Boolean):[],r=i.class?i.class.split(" ").filter(Boolean):[];for(let s=0;s<n.length;s++)r.indexOf(n[s])==-1&&t.classList.remove(n[s]);for(let s=0;s<r.length;s++)n.indexOf(r[s])==-1&&t.classList.add(r[s]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=i.style){if(e.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,r;for(;r=n.exec(e.style);)t.style.removeProperty(r[1])}i.style&&(t.style.cssText+=i.style)}}function Aie(t,e,i){return Eie(t,t,Jm,dV(e,i,t.nodeType!=1))}function YT(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(!t[i].type.eq(e[i].type))return!1;return!0}function rj(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class dWe{constructor(e,i,n){this.lock=i,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=fWe(e.node.content,e)}destroyBetween(e,i){if(e!=i){for(let n=e;n<i;n++)this.top.children[n].destroy();this.top.children.splice(e,i-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,i,n){let r=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;r<o&&(r==s-1?this.top:this.stack[r+1<<1]).matchesMark(e[r])&&e[r].type.spec.spanning!==!1;)r++;for(;r<s;)this.destroyRest(),this.top.dirty=Uc,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let u=this.top.children[l];if(u.matchesMark(e[s])&&!this.isLocked(u.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=Gg.create(this.top,e[s],i,n);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,s++}}findNodeMatch(e,i,n,r){let s=-1,o;if(r>=this.preMatch.index&&(o=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&o.matchesNode(e,i,n))s=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let u=this.top.children[a];if(u.matchesNode(e,i,n)&&!this.preMatch.matched.has(u)){s=a;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,i,n,r,s){let o=this.top.children[r];return o.dirty==Ih&&o.dom==o.contentDOM&&(o.dirty=Ym),o.update(e,i,n,s)?(this.destroyBetween(this.index,r),this.index++,!0):!1}findIndexWithChild(e){for(;;){let i=e.parentNode;if(!i)return-1;if(i==this.top.contentDOM){let n=e.pmViewDesc;if(n){for(let r=this.index;r<this.top.children.length;r++)if(this.top.children[r]==n)return r}return-1}e=i}}updateNextNode(e,i,n,r,s,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof xp){let u=this.preMatch.matched.get(l);if(u!=null&&u!=s)return!1;let d=l.dom,p,v=this.isLocked(d)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=Ih&&YT(i,l.outerDeco));if(!v&&l.update(e,i,n,r))return this.destroyBetween(this.index,a),l.dom!=d&&(this.changed=!0),this.index++,!0;if(!v&&(p=this.recreateWrapper(l,e,i,n,r,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=p,p.contentDOM&&(p.dirty=Ym,p.updateChildren(r,o+1),p.dirty=Uc),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,i,n,r,s,o){if(e.dirty||i.isAtom||!e.children.length||!e.node.content.eq(i.content)||!YT(n,e.outerDeco)||!r.eq(e.innerDeco))return null;let a=xp.create(this.top,i,n,r,s,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,i,n,r,s){let o=xp.create(this.top,e,i,n,r,s);o.contentDOM&&o.updateChildren(r,s+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,i,n){let r=this.index<this.top.children.length?this.top.children[this.index]:null;if(r&&r.matchesWidget(e)&&(e==r.widget||!r.widget.type.toDOM.parentNode))this.index++;else{let s=new Tie(this.top,e,i,n);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],i=this.top;for(;e instanceof Gg;)i=e,e=i.children[i.children.length-1];(!e||!(e instanceof QD)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&(($a||da)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",i),this.addHackNode("BR",this.top))}addHackNode(e,i){if(i==this.top&&this.index<i.children.length&&i.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);e=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),e=="BR"&&(n.className="ProseMirror-trailingBreak");let r=new Rie(this.top,[],n,null);i!=this.top?i.children.push(r):i.children.splice(this.index++,0,r),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function fWe(t,e){let i=e,n=i.children.length,r=t.childCount,s=new Map,o=[];e:for(;r>0;){let a;for(;;)if(n){let u=i.children[n-1];if(u instanceof Gg)i=u,n=u.children.length;else{a=u,n--;break}}else{if(i==e)break e;n=i.parent.children.indexOf(i),i=i.parent}let l=a.node;if(l){if(l!=t.child(r-1))break;--r,s.set(a,r),o.push(a)}}return{index:r,matched:s,matches:o.reverse()}}function pWe(t,e){return t.type.side-e.type.side}function mWe(t,e,i,n){let r=e.locals(t),s=0;if(r.length==0){for(let u=0;u<t.childCount;u++){let d=t.child(u);n(d,r,e.forChild(s,d),u),s+=d.nodeSize}return}let o=0,a=[],l=null;for(let u=0;;){let d,p;for(;o<r.length&&r[o].to==s;){let O=r[o++];O.widget&&(d?(p||(p=[d])).push(O):d=O)}if(d)if(p){p.sort(pWe);for(let O=0;O<p.length;O++)i(p[O],u,!!l)}else i(d,u,!!l);let v,y;if(l)y=-1,v=l,l=null;else if(u<t.childCount)y=u,v=t.child(u++);else break;for(let O=0;O<a.length;O++)a[O].to<=s&&a.splice(O--,1);for(;o<r.length&&r[o].from<=s&&r[o].to>s;)a.push(r[o++]);let w=s+v.nodeSize;if(v.isText){let O=w;o<r.length&&r[o].from<O&&(O=r[o].from);for(let P=0;P<a.length;P++)a[P].to<O&&(O=a[P].to);O<w&&(l=v.cut(O-s),v=v.cut(0,O-s),w=O,y=-1)}else for(;o<r.length&&r[o].to<w;)o++;let R=v.isInline&&!v.isLeaf?a.filter(O=>!O.inline):a.slice();n(v,R,e.forChild(s,v),y),s=w}}function gWe(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function vWe(t,e,i,n){for(let r=0,s=0;r<t.childCount&&s<=n;){let o=t.child(r++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;r<t.childCount;){let u=t.child(r++);if(s+=u.nodeSize,!u.isText)break;l+=u.text}if(s>=i){if(s>=n&&l.slice(n-e.length-a,n-a)==e)return n-e.length;let u=a<n?l.lastIndexOf(e,n-a-1):-1;if(u>=0&&u+e.length+a>=i)return a+u;if(i==n&&l.length>=n+e.length-a&&l.slice(n-a,n-a+e.length)==e)return n}}return-1}function fV(t,e,i,n,r){let s=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],u=a,d=a+=l.size;u>=i||d<=e?s.push(l):(u<e&&s.push(l.slice(0,e-u,n)),r&&(s.push(r),r=void 0),d>i&&s.push(l.slice(i-u,l.size,n)))}return s}function cH(t,e=null){let i=t.domSelectionRange(),n=t.state.doc;if(!i.focusNode)return null;let r=t.docView.nearestDesc(i.focusNode),s=r&&r.size==0,o=t.docView.posFromDOM(i.focusNode,i.focusOffset,1);if(o<0)return null;let a=n.resolve(o),l,u;if(jD(i)){for(l=o;r&&!r.node;)r=r.parent;let p=r.node;if(r&&p.isAtom&&cn.isSelectable(p)&&r.parent&&!(p.isInline&&H$e(i.focusNode,i.focusOffset,r.dom))){let v=r.posBefore;u=new cn(o==v?a:n.resolve(v))}}else{if(i instanceof t.dom.ownerDocument.defaultView.Selection&&i.rangeCount>1){let p=o,v=o;for(let y=0;y<i.rangeCount;y++){let w=i.getRangeAt(y);p=Math.min(p,t.docView.posFromDOM(w.startContainer,w.startOffset,1)),v=Math.max(v,t.docView.posFromDOM(w.endContainer,w.endOffset,-1))}if(p<0)return null;[l,o]=v==t.state.selection.anchor?[v,p]:[p,v],a=n.resolve(o)}else l=t.docView.posFromDOM(i.anchorNode,i.anchorOffset,1);if(l<0)return null}let d=n.resolve(l);if(!u){let p=e=="pointer"||t.state.selection.head<a.pos&&!s?1:-1;u=uH(t,d,a,p)}return u}function Iie(t){return t.editable?t.hasFocus():Die(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Dd(t,e=!1){let i=t.state.selection;if(kie(t,i),!!Iie(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&da){let n=t.domSelectionRange(),r=t.domObserver.currentSelection;if(n.anchorNode&&r.anchorNode&&Vg(n.anchorNode,n.anchorOffset,r.anchorNode,r.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)xWe(t);else{let{anchor:n,head:r}=i,s,o;sj&&!(i instanceof Cn)&&(i.$from.parent.inlineContent||(s=oj(t,i.from)),!i.empty&&!i.$from.parent.inlineContent&&(o=oj(t,i.to))),t.docView.setSelection(n,r,t,e),sj&&(s&&aj(s),o&&aj(o)),i.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&yWe(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const sj=$a||da&&bie<63;function oj(t,e){let{node:i,offset:n}=t.docView.domFromPos(e,0),r=n<i.childNodes.length?i.childNodes[n]:null,s=n?i.childNodes[n-1]:null;if($a&&r&&r.contentEditable=="false")return qN(r);if((!r||r.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(r)return qN(r);if(s)return qN(s)}}function qN(t){return t.contentEditable="true",$a&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function aj(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function yWe(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let i=t.domSelectionRange(),n=i.anchorNode,r=i.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(i.anchorNode!=n||i.anchorOffset!=r)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!Iie(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function xWe(t){let e=t.domSelection(),i=document.createRange();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?i.setStart(n.parentNode,qo(n)+1):i.setStart(n,0),i.collapse(!0),e.removeAllRanges(),e.addRange(i),!r&&!t.state.selection.visible&&Cl&&yp<=11&&(n.disabled=!0,n.disabled=!1)}function kie(t,e){if(e instanceof cn){let i=t.docView.descAt(e.from);i!=t.lastSelectedViewDesc&&(lj(t),i&&i.selectNode(),t.lastSelectedViewDesc=i)}else lj(t)}function lj(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function uH(t,e,i,n){return t.someProp("createSelectionBetween",r=>r(t,e,i))||Cn.between(e,i,n)}function cj(t){return t.editable&&!t.hasFocus()?!1:Die(t)}function Die(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function bWe(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),i=t.domSelectionRange();return Vg(e.node,e.offset,i.anchorNode,i.anchorOffset)}function pV(t,e){let{$anchor:i,$head:n}=t.selection,r=e>0?i.max(n):i.min(n),s=r.parent.inlineContent?r.depth?t.doc.resolve(e>0?r.after():r.before()):null:r;return s&&Nn.findFrom(s,e)}function Yf(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function uj(t,e,i){let n=t.state.selection;if(n instanceof Cn)if(i.indexOf("s")>-1){let{$head:r}=n,s=r.textOffset?null:e<0?r.nodeBefore:r.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;let o=t.state.doc.resolve(r.pos+s.nodeSize*(e<0?-1:1));return Yf(t,new Cn(n.$anchor,o))}else if(n.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let r=pV(t.state,e);return r&&r instanceof cn?Yf(t,r):!1}else if(!(_c&&i.indexOf("m")>-1)){let r=n.$head,s=r.textOffset?null:e<0?r.nodeBefore:r.nodeAfter,o;if(!s||s.isText)return!1;let a=e<0?r.pos-s.nodeSize:r.pos;return s.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?cn.isSelectable(s)?Yf(t,new cn(e<0?t.state.doc.resolve(r.pos-s.nodeSize):r)):XC?Yf(t,new Cn(t.state.doc.resolve(e<0?a:a+s.nodeSize))):!1:!1}}else return!1;else{if(n instanceof cn&&n.node.isInline)return Yf(t,new Cn(e>0?n.$to:n.$from));{let r=pV(t.state,e);return r?Yf(t,r):!1}}}function JT(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function l_(t,e){let i=t.pmViewDesc;return i&&i.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function uy(t,e){return e<0?wWe(t):_We(t)}function wWe(t){let e=t.domSelectionRange(),i=e.focusNode,n=e.focusOffset;if(!i)return;let r,s,o=!1;for(Mu&&i.nodeType==1&&n<JT(i)&&l_(i.childNodes[n],-1)&&(o=!0);;)if(n>0){if(i.nodeType!=1)break;{let a=i.childNodes[n-1];if(l_(a,-1))r=i,s=--n;else if(a.nodeType==3)i=a,n=i.nodeValue.length;else break}}else{if(Lie(i))break;{let a=i.previousSibling;for(;a&&l_(a,-1);)r=i.parentNode,s=qo(a),a=a.previousSibling;if(a)i=a,n=JT(i);else{if(i=i.parentNode,i==t.dom)break;n=0}}}o?mV(t,i,n):r&&mV(t,r,s)}function _We(t){let e=t.domSelectionRange(),i=e.focusNode,n=e.focusOffset;if(!i)return;let r=JT(i),s,o;for(;;)if(n<r){if(i.nodeType!=1)break;let a=i.childNodes[n];if(l_(a,1))s=i,o=++n;else break}else{if(Lie(i))break;{let a=i.nextSibling;for(;a&&l_(a,1);)s=a.parentNode,o=qo(a)+1,a=a.nextSibling;if(a)i=a,n=0,r=JT(i);else{if(i=i.parentNode,i==t.dom)break;n=r=0}}}s&&mV(t,s,o)}function Lie(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function CWe(t,e){for(;t&&e==t.childNodes.length&&!ZC(t);)e=qo(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let i=t.childNodes[e];if(i.nodeType==3)return i;if(i.nodeType==1&&i.contentEditable=="false")break;t=i,e=0}}function SWe(t,e){for(;t&&!e&&!ZC(t);)e=qo(t),t=t.parentNode;for(;t&&e;){let i=t.childNodes[e-1];if(i.nodeType==3)return i;if(i.nodeType==1&&i.contentEditable=="false")break;t=i,e=t.childNodes.length}}function mV(t,e,i){if(e.nodeType!=3){let s,o;(o=CWe(e,i))?(e=o,i=0):(s=SWe(e,i))&&(e=s,i=s.nodeValue.length)}let n=t.domSelection();if(!n)return;if(jD(n)){let s=document.createRange();s.setEnd(e,i),s.setStart(e,i),n.removeAllRanges(),n.addRange(s)}else n.extend&&n.extend(e,i);t.domObserver.setCurSelection();let{state:r}=t;setTimeout(()=>{t.state==r&&Dd(t)},50)}function hj(t,e){let i=t.state.doc.resolve(e);if(!(da||q$e)&&i.parent.inlineContent){let r=t.coordsAtPos(e);if(e>i.start()){let s=t.coordsAtPos(e-1),o=(s.top+s.bottom)/2;if(o>r.top&&o<r.bottom&&Math.abs(s.left-r.left)>1)return s.left<r.left?"ltr":"rtl"}if(e<i.end()){let s=t.coordsAtPos(e+1),o=(s.top+s.bottom)/2;if(o>r.top&&o<r.bottom&&Math.abs(s.left-r.left)>1)return s.left>r.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function dj(t,e,i){let n=t.state.selection;if(n instanceof Cn&&!n.empty||i.indexOf("s")>-1||_c&&i.indexOf("m")>-1)return!1;let{$from:r,$to:s}=n;if(!r.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=pV(t.state,e);if(o&&o instanceof cn)return Yf(t,o)}if(!r.parent.inlineContent){let o=e<0?r:s,a=n instanceof ec?Nn.near(o,e):Nn.findFrom(o,e);return a?Yf(t,a):!1}return!1}function fj(t,e){if(!(t.state.selection instanceof Cn))return!0;let{$head:i,$anchor:n,empty:r}=t.state.selection;if(!i.sameParent(n))return!0;if(!r)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!i.textOffset&&(e<0?i.nodeBefore:i.nodeAfter);if(s&&!s.isText){let o=t.state.tr;return e<0?o.delete(i.pos-s.nodeSize,i.pos):o.delete(i.pos,i.pos+s.nodeSize),t.dispatch(o),!0}return!1}function pj(t,e,i){t.domObserver.stop(),e.contentEditable=i,t.domObserver.start()}function OWe(t){if(!$a||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:i}=t.domSelectionRange();if(e&&e.nodeType==1&&i==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let n=e.firstChild;pj(t,n,"true"),setTimeout(()=>pj(t,n,"false"),20)}return!1}function MWe(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function TWe(t,e){let i=e.keyCode,n=MWe(e);if(i==8||_c&&i==72&&n=="c")return fj(t,-1)||uy(t,-1);if(i==46&&!e.shiftKey||_c&&i==68&&n=="c")return fj(t,1)||uy(t,1);if(i==13||i==27)return!0;if(i==37||_c&&i==66&&n=="c"){let r=i==37?hj(t,t.state.selection.from)=="ltr"?-1:1:-1;return uj(t,r,n)||uy(t,r)}else if(i==39||_c&&i==70&&n=="c"){let r=i==39?hj(t,t.state.selection.from)=="ltr"?1:-1:1;return uj(t,r,n)||uy(t,r)}else{if(i==38||_c&&i==80&&n=="c")return dj(t,-1,n)||uy(t,-1);if(i==40||_c&&i==78&&n=="c")return OWe(t)||dj(t,1,n)||uy(t,1);if(n==(_c?"m":"c")&&(i==66||i==73||i==89||i==90))return!0}return!1}function hH(t,e){t.someProp("transformCopied",y=>{e=y(e,t)});let i=[],{content:n,openStart:r,openEnd:s}=e;for(;r>1&&s>1&&n.childCount==1&&n.firstChild.childCount==1;){r--,s--;let y=n.firstChild;i.push(y.type.name,y.attrs!=y.type.defaultAttrs?y.attrs:null),n=y.content}let o=t.someProp("clipboardSerializer")||rv.fromSchema(t.state.schema),a=Gie(),l=a.createElement("div");l.appendChild(o.serializeFragment(n,{document:a}));let u=l.firstChild,d,p=0;for(;u&&u.nodeType==1&&(d=Vie[u.nodeName.toLowerCase()]);){for(let y=d.length-1;y>=0;y--){let w=a.createElement(d[y]);for(;l.firstChild;)w.appendChild(l.firstChild);l.appendChild(w),p++}u=l.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${r} ${s}${p?` -${p}`:""} ${JSON.stringify(i)}`);let v=t.someProp("clipboardTextSerializer",y=>y(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:v,slice:e}}function Fie(t,e,i,n,r){let s=r.parent.type.spec.code,o,a;if(!i&&!e)return null;let l=e&&(n||s||!i);if(l){if(t.someProp("transformPastedText",v=>{e=v(e,s||n,t)}),s)return e?new Ii(ai.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):Ii.empty;let p=t.someProp("clipboardTextParser",v=>v(e,r,n,t));if(p)a=p;else{let v=r.marks(),{schema:y}=t.state,w=rv.fromSchema(y);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(R=>{let O=o.appendChild(document.createElement("p"));R&&O.appendChild(w.serializeNode(y.text(R,v)))})}}else t.someProp("transformPastedHTML",p=>{i=p(i,t)}),o=AWe(i),XC&&IWe(o);let u=o&&o.querySelector("[data-pm-slice]"),d=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let p=+d[3];p>0;p--){let v=o.firstChild;for(;v&&v.nodeType!=1;)v=v.nextSibling;if(!v)break;o=v}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||o_.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||d),context:r,ruleFromNode(v){return v.nodeName=="BR"&&!v.nextSibling&&v.parentNode&&!RWe.test(v.parentNode.nodeName)?{ignore:!0}:null}})),d)a=kWe(mj(a,+d[1],+d[2]),d[4]);else if(a=Ii.maxOpen(PWe(a.content,r),!0),a.openStart||a.openEnd){let p=0,v=0;for(let y=a.content.firstChild;p<a.openStart&&!y.type.spec.isolating;p++,y=y.firstChild);for(let y=a.content.lastChild;v<a.openEnd&&!y.type.spec.isolating;v++,y=y.lastChild);a=mj(a,p,v)}return t.someProp("transformPasted",p=>{a=p(a,t)}),a}const RWe=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function PWe(t,e){if(t.childCount<2)return t;for(let i=e.depth;i>=0;i--){let r=e.node(i).contentMatchAt(e.index(i)),s,o=[];if(t.forEach(a=>{if(!o)return;let l=r.findWrapping(a.type),u;if(!l)return o=null;if(u=o.length&&s.length&&Bie(l,s,a,o[o.length-1],0))o[o.length-1]=u;else{o.length&&(o[o.length-1]=zie(o[o.length-1],s.length));let d=Nie(a,l);o.push(d),r=r.matchType(d.type),s=l}}),o)return ai.from(o)}return t}function Nie(t,e,i=0){for(let n=e.length-1;n>=i;n--)t=e[n].create(null,ai.from(t));return t}function Bie(t,e,i,n,r){if(r<t.length&&r<e.length&&t[r]==e[r]){let s=Bie(t,e,i,n.lastChild,r+1);if(s)return n.copy(n.content.replaceChild(n.childCount-1,s));if(n.contentMatchAt(n.childCount).matchType(r==t.length-1?i.type:t[r+1]))return n.copy(n.content.append(ai.from(Nie(i,t,r+1))))}}function zie(t,e){if(e==0)return t;let i=t.content.replaceChild(t.childCount-1,zie(t.lastChild,e-1)),n=t.contentMatchAt(t.childCount).fillBefore(ai.empty,!0);return t.copy(i.append(n))}function gV(t,e,i,n,r,s){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(s=0),r<n-1&&(a=gV(a,e,i,n,r+1,s)),r>=i&&(a=e<0?o.contentMatchAt(0).fillBefore(a,s<=r).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(ai.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function mj(t,e,i){return e<t.openStart&&(t=new Ii(gV(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),i<t.openEnd&&(t=new Ii(gV(t.content,1,i,t.openEnd,0,0),t.openStart,i)),t}const Vie={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let gj=null;function Gie(){return gj||(gj=document.implementation.createHTMLDocument("title"))}let jN=null;function EWe(t){let e=window.trustedTypes;return e?(jN||(jN=e.createPolicy("ProseMirrorClipboard",{createHTML:i=>i})),jN.createHTML(t)):t}function AWe(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let i=Gie().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(t),r;if((r=n&&Vie[n[1].toLowerCase()])&&(t=r.map(s=>"<"+s+">").join("")+t+r.map(s=>"</"+s+">").reverse().join("")),i.innerHTML=EWe(t),r)for(let s=0;s<r.length;s++)i=i.querySelector(r[s])||i;return i}function IWe(t){let e=t.querySelectorAll(da?"span:not([class]):not([style])":"span.Apple-converted-space");for(let i=0;i<e.length;i++){let n=e[i];n.childNodes.length==1&&n.textContent=="Â "&&n.parentNode&&n.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),n)}}function kWe(t,e){if(!t.size)return t;let i=t.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch{return t}let{content:r,openStart:s,openEnd:o}=t;for(let a=n.length-2;a>=0;a-=2){let l=i.nodes[n[a]];if(!l||l.hasRequiredAttrs())break;r=ai.from(l.create(n[a+1],r)),s++,o++}return new Ii(r,s,o)}const Wa={},qa={},DWe={touchstart:!0,touchmove:!0};class LWe{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function FWe(t){for(let e in Wa){let i=Wa[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=n=>{BWe(t,n)&&!dH(t,n)&&(t.editable||!(n.type in qa))&&i(t,n)},DWe[e]?{passive:!0}:void 0)}$a&&t.dom.addEventListener("input",()=>null),vV(t)}function hp(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function NWe(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function vV(t){t.someProp("handleDOMEvents",e=>{for(let i in e)t.input.eventHandlers[i]||t.dom.addEventListener(i,t.input.eventHandlers[i]=n=>dH(t,n))})}function dH(t,e){return t.someProp("handleDOMEvents",i=>{let n=i[e.type];return n?n(t,e)||e.defaultPrevented:!1})}function BWe(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let i=e.target;i!=t.dom;i=i.parentNode)if(!i||i.nodeType==11||i.pmViewDesc&&i.pmViewDesc.stopEvent(e))return!1;return!0}function zWe(t,e){!dH(t,e)&&Wa[e.type]&&(t.editable||!(e.type in qa))&&Wa[e.type](t,e)}qa.keydown=(t,e)=>{let i=e;if(t.input.shiftKey=i.keyCode==16||i.shiftKey,!Hie(t,i)&&(t.input.lastKeyCode=i.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Od&&da&&i.keyCode==13)))if(i.keyCode!=229&&t.domObserver.forceFlush(),D0&&i.keyCode==13&&!i.ctrlKey&&!i.altKey&&!i.metaKey){let n=Date.now();t.input.lastIOSEnter=n,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==n&&(t.someProp("handleKeyDown",r=>r(t,jm(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",n=>n(t,i))||TWe(t,i)?i.preventDefault():hp(t,"key")};qa.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};qa.keypress=(t,e)=>{let i=e;if(Hie(t,i)||!i.charCode||i.ctrlKey&&!i.altKey||_c&&i.metaKey)return;if(t.someProp("handleKeyPress",r=>r(t,i))){i.preventDefault();return}let n=t.state.selection;if(!(n instanceof Cn)||!n.$from.sameParent(n.$to)){let r=String.fromCharCode(i.charCode);!/[\r\n]/.test(r)&&!t.someProp("handleTextInput",s=>s(t,n.$from.pos,n.$to.pos,r))&&t.dispatch(t.state.tr.insertText(r).scrollIntoView()),i.preventDefault()}};function ZD(t){return{left:t.clientX,top:t.clientY}}function VWe(t,e){let i=e.x-t.clientX,n=e.y-t.clientY;return i*i+n*n<100}function fH(t,e,i,n,r){if(n==-1)return!1;let s=t.state.doc.resolve(n);for(let o=s.depth+1;o>0;o--)if(t.someProp(e,a=>o>s.depth?a(t,i,s.nodeAfter,s.before(o),r,!0):a(t,i,s.node(o),s.before(o),r,!1)))return!0;return!1}function s0(t,e,i){if(t.focused||t.focus(),t.state.selection.eq(e))return;let n=t.state.tr.setSelection(e);n.setMeta("pointer",!0),t.dispatch(n)}function GWe(t,e){if(e==-1)return!1;let i=t.state.doc.resolve(e),n=i.nodeAfter;return n&&n.isAtom&&cn.isSelectable(n)?(s0(t,new cn(i)),!0):!1}function UWe(t,e){if(e==-1)return!1;let i=t.state.selection,n,r;i instanceof cn&&(n=i.node);let s=t.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o);if(cn.isSelectable(a)){n&&i.$from.depth>0&&o>=i.$from.depth&&s.before(i.$from.depth+1)==i.$from.pos?r=s.before(i.$from.depth):r=s.before(o);break}}return r!=null?(s0(t,cn.create(t.state.doc,r)),!0):!1}function HWe(t,e,i,n,r){return fH(t,"handleClickOn",e,i,n)||t.someProp("handleClick",s=>s(t,e,n))||(r?UWe(t,i):GWe(t,i))}function $We(t,e,i,n){return fH(t,"handleDoubleClickOn",e,i,n)||t.someProp("handleDoubleClick",r=>r(t,e,n))}function WWe(t,e,i,n){return fH(t,"handleTripleClickOn",e,i,n)||t.someProp("handleTripleClick",r=>r(t,e,n))||qWe(t,i,n)}function qWe(t,e,i){if(i.button!=0)return!1;let n=t.state.doc;if(e==-1)return n.inlineContent?(s0(t,Cn.create(n,0,n.content.size)),!0):!1;let r=n.resolve(e);for(let s=r.depth+1;s>0;s--){let o=s>r.depth?r.nodeAfter:r.node(s),a=r.before(s);if(o.inlineContent)s0(t,Cn.create(n,a+1,a+1+o.content.size));else if(cn.isSelectable(o))s0(t,cn.create(n,a));else continue;return!0}}function pH(t){return eR(t)}const Uie=_c?"metaKey":"ctrlKey";Wa.mousedown=(t,e)=>{let i=e;t.input.shiftKey=i.shiftKey;let n=pH(t),r=Date.now(),s="singleClick";r-t.input.lastClick.time<500&&VWe(i,t.input.lastClick)&&!i[Uie]&&(t.input.lastClick.type=="singleClick"?s="doubleClick":t.input.lastClick.type=="doubleClick"&&(s="tripleClick")),t.input.lastClick={time:r,x:i.clientX,y:i.clientY,type:s};let o=t.posAtCoords(ZD(i));o&&(s=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new jWe(t,o,i,!!n)):(s=="doubleClick"?$We:WWe)(t,o.pos,o.inside,i)?i.preventDefault():hp(t,"pointer"))};class jWe{constructor(e,i,n,r){this.view=e,this.pos=i,this.event=n,this.flushed=r,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[Uie],this.allowDefault=n.shiftKey;let s,o;if(i.inside>-1)s=e.state.doc.nodeAt(i.inside),o=i.inside;else{let d=e.state.doc.resolve(i.pos);s=d.parent,o=d.depth?d.before():0}const a=r?null:n.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.dom.nodeType==1?l.dom:null;let{selection:u}=e.state;(n.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||u instanceof cn&&u.from<=o&&u.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Mu&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),hp(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Dd(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let i=this.pos;this.view.state.doc!=this.startDoc&&(i=this.view.posAtCoords(ZD(e))),this.updateAllowDefault(e),this.allowDefault||!i?hp(this.view,"pointer"):HWe(this.view,i.pos,i.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||$a&&this.mightDrag&&!this.mightDrag.node.isAtom||da&&!this.view.state.selection.visible&&Math.min(Math.abs(i.pos-this.view.state.selection.from),Math.abs(i.pos-this.view.state.selection.to))<=2)?(s0(this.view,Nn.near(this.view.state.doc.resolve(i.pos))),e.preventDefault()):hp(this.view,"pointer")}move(e){this.updateAllowDefault(e),hp(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Wa.touchstart=t=>{t.input.lastTouch=Date.now(),pH(t),hp(t,"pointer")};Wa.touchmove=t=>{t.input.lastTouch=Date.now(),hp(t,"pointer")};Wa.contextmenu=t=>pH(t);function Hie(t,e){return t.composing?!0:$a&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const QWe=Od?5e3:-1;qa.compositionstart=qa.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,i=e.selection.$to;if(e.selection instanceof Cn&&(e.storedMarks||!i.textOffset&&i.parentOffset&&i.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||i.marks(),eR(t,!0),t.markCursor=null;else if(eR(t,!e.selection.empty),Mu&&e.selection.empty&&i.parentOffset&&!i.textOffset&&i.nodeBefore.marks.length){let n=t.domSelectionRange();for(let r=n.focusNode,s=n.focusOffset;r&&r.nodeType==1&&s!=0;){let o=s<0?r.lastChild:r.childNodes[s-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else r=o,s=-1}}t.input.composing=!0}$ie(t,QWe)};qa.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,$ie(t,20))};function $ie(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>eR(t),e))}function Wie(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=XWe());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function ZWe(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let i=G$e(e.focusNode,e.focusOffset),n=U$e(e.focusNode,e.focusOffset);if(i&&n&&i!=n){let r=n.pmViewDesc,s=t.domObserver.lastChangedTextNode;if(i==s||n==s)return s;if(!r||!r.isText(n.nodeValue))return n;if(t.input.compositionNode==n){let o=i.pmViewDesc;if(!(!o||!o.isText(i.nodeValue)))return n}}return i||n}function XWe(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function eR(t,e=!1){if(!(Od&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),Wie(t),e||t.docView&&t.docView.dirty){let i=cH(t);return i&&!i.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(i)):(t.markCursor||e)&&!t.state.selection.empty?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function KWe(t,e){if(!t.dom.parentNode)return;let i=t.dom.parentNode.appendChild(document.createElement("div"));i.appendChild(e),i.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),r=document.createRange();r.selectNodeContents(e),t.dom.blur(),n.removeAllRanges(),n.addRange(r),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i),t.focus()},50)}const tC=Cl&&yp<15||D0&&j$e<604;Wa.copy=qa.cut=(t,e)=>{let i=e,n=t.state.selection,r=i.type=="cut";if(n.empty)return;let s=tC?null:i.clipboardData,o=n.content(),{dom:a,text:l}=hH(t,o);s?(i.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):KWe(t,a),r&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function YWe(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function JWe(t,e){if(!t.dom.parentNode)return;let i=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,n=t.dom.parentNode.appendChild(document.createElement(i?"textarea":"div"));i||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let r=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),n.parentNode&&n.parentNode.removeChild(n),i?iC(t,n.value,null,r,e):iC(t,n.textContent,n.innerHTML,r,e)},50)}function iC(t,e,i,n,r){let s=Fie(t,e,i,n,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,r,s||Ii.empty)))return!0;if(!s)return!1;let o=YWe(s),a=o?t.state.tr.replaceSelectionWith(o,n):t.state.tr.replaceSelection(s);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function qie(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let i=t.getData("text/uri-list");return i?i.replace(/\r?\n/g," "):""}qa.paste=(t,e)=>{let i=e;if(t.composing&&!Od)return;let n=tC?null:i.clipboardData,r=t.input.shiftKey&&t.input.lastKeyCode!=45;n&&iC(t,qie(n),n.getData("text/html"),r,i)?i.preventDefault():JWe(t,i)};class jie{constructor(e,i,n){this.slice=e,this.move=i,this.node=n}}const Qie=_c?"altKey":"ctrlKey";Wa.dragstart=(t,e)=>{let i=e,n=t.input.mouseDown;if(n&&n.done(),!i.dataTransfer)return;let r=t.state.selection,s=r.empty?null:t.posAtCoords(ZD(i)),o;if(!(s&&s.pos>=r.from&&s.pos<=(r instanceof cn?r.to-1:r.to))){if(n&&n.mightDrag)o=cn.create(t.state.doc,n.mightDrag.pos);else if(i.target&&i.target.nodeType==1){let p=t.docView.nearestDesc(i.target,!0);p&&p.node.type.spec.draggable&&p!=t.docView&&(o=cn.create(t.state.doc,p.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:u,slice:d}=hH(t,a);(!i.dataTransfer.files.length||!da||bie>120)&&i.dataTransfer.clearData(),i.dataTransfer.setData(tC?"Text":"text/html",l.innerHTML),i.dataTransfer.effectAllowed="copyMove",tC||i.dataTransfer.setData("text/plain",u),t.dragging=new jie(d,!i[Qie],o)};Wa.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};qa.dragover=qa.dragenter=(t,e)=>e.preventDefault();qa.drop=(t,e)=>{let i=e,n=t.dragging;if(t.dragging=null,!i.dataTransfer)return;let r=t.posAtCoords(ZD(i));if(!r)return;let s=t.state.doc.resolve(r.pos),o=n&&n.slice;o?t.someProp("transformPasted",w=>{o=w(o,t)}):o=Fie(t,qie(i.dataTransfer),tC?null:i.dataTransfer.getData("text/html"),!1,s);let a=!!(n&&!i[Qie]);if(t.someProp("handleDrop",w=>w(t,i,o||Ii.empty,a))){i.preventDefault();return}if(!o)return;i.preventDefault();let l=o?die(t.state.doc,s.pos,o):s.pos;l==null&&(l=s.pos);let u=t.state.tr;if(a){let{node:w}=n;w?w.replace(u):u.deleteSelection()}let d=u.mapping.map(l),p=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,v=u.doc;if(p?u.replaceRangeWith(d,d,o.content.firstChild):u.replaceRange(d,d,o),u.doc.eq(v))return;let y=u.doc.resolve(d);if(p&&cn.isSelectable(o.content.firstChild)&&y.nodeAfter&&y.nodeAfter.sameMarkup(o.content.firstChild))u.setSelection(new cn(y));else{let w=u.mapping.map(l);u.mapping.maps[u.mapping.maps.length-1].forEach((R,O,P,N)=>w=N),u.setSelection(uH(t,y,u.doc.resolve(w)))}t.focus(),t.dispatch(u.setMeta("uiEvent","drop"))};Wa.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Dd(t)},20))};Wa.blur=(t,e)=>{let i=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),i.relatedTarget&&t.dom.contains(i.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Wa.beforeinput=(t,e)=>{if(da&&Od&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:n}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=n||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",s=>s(t,jm(8,"Backspace")))))return;let{$cursor:r}=t.state.selection;r&&r.pos>0&&t.dispatch(t.state.tr.delete(r.pos-1,r.pos).scrollIntoView())},50)}};for(let t in qa)Wa[t]=qa[t];function nC(t,e){if(t==e)return!0;for(let i in t)if(t[i]!==e[i])return!1;for(let i in e)if(!(i in t))return!1;return!0}class tR{constructor(e,i){this.toDOM=e,this.spec=i||yg,this.side=this.spec.side||0}map(e,i,n,r){let{pos:s,deleted:o}=e.mapResult(i.from+r,this.side<0?-1:1);return o?null:new Lc(s-n,s-n,this)}valid(){return!0}eq(e){return this==e||e instanceof tR&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&nC(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class bp{constructor(e,i){this.attrs=e,this.spec=i||yg}map(e,i,n,r){let s=e.map(i.from+r,this.spec.inclusiveStart?-1:1)-n,o=e.map(i.to+r,this.spec.inclusiveEnd?1:-1)-n;return s>=o?null:new Lc(s,o,this)}valid(e,i){return i.from<i.to}eq(e){return this==e||e instanceof bp&&nC(this.attrs,e.attrs)&&nC(this.spec,e.spec)}static is(e){return e.type instanceof bp}destroy(){}}class mH{constructor(e,i){this.attrs=e,this.spec=i||yg}map(e,i,n,r){let s=e.mapResult(i.from+r,1);if(s.deleted)return null;let o=e.mapResult(i.to+r,-1);return o.deleted||o.pos<=s.pos?null:new Lc(s.pos-n,o.pos-n,this)}valid(e,i){let{index:n,offset:r}=e.content.findIndex(i.from),s;return r==i.from&&!(s=e.child(n)).isText&&r+s.nodeSize==i.to}eq(e){return this==e||e instanceof mH&&nC(this.attrs,e.attrs)&&nC(this.spec,e.spec)}destroy(){}}class Lc{constructor(e,i,n){this.from=e,this.to=i,this.type=n}copy(e,i){return new Lc(e,i,this.type)}eq(e,i=0){return this.type.eq(e.type)&&this.from+i==e.from&&this.to+i==e.to}map(e,i,n){return this.type.map(e,this,i,n)}static widget(e,i,n){return new Lc(e,e,new tR(i,n))}static inline(e,i,n,r){return new Lc(e,i,new bp(n,r))}static node(e,i,n,r){return new Lc(e,i,new mH(n,r))}get spec(){return this.type.spec}get inline(){return this.type instanceof bp}get widget(){return this.type instanceof tR}}const Ly=[],yg={};class lo{constructor(e,i){this.local=e.length?e:Ly,this.children=i.length?i:Ly}static create(e,i){return i.length?iR(i,e,0,yg):oa}find(e,i,n){let r=[];return this.findInner(e??0,i??1e9,r,0,n),r}findInner(e,i,n,r,s){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=i&&a.to>=e&&(!s||s(a.spec))&&n.push(a.copy(a.from+r,a.to+r))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<i&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,i-a,n,r+a,s)}}map(e,i,n){return this==oa||e.maps.length==0?this:this.mapInner(e,i,0,0,n||yg)}mapInner(e,i,n,r,s){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,n,r);l&&l.type.valid(i,l)?(o||(o=[])).push(l):s.onRemove&&s.onRemove(this.local[a].spec)}return this.children.length?e6e(this.children,o||[],e,i,n,r,s):o?new lo(o.sort(xg),Ly):oa}add(e,i){return i.length?this==oa?lo.create(e,i):this.addInner(e,i,0):this}addInner(e,i,n){let r,s=0;e.forEach((a,l)=>{let u=l+n,d;if(d=Xie(i,a,u)){for(r||(r=this.children.slice());s<r.length&&r[s]<l;)s+=3;r[s]==l?r[s+2]=r[s+2].addInner(a,d,u+1):r.splice(s,0,l,l+a.nodeSize,iR(d,a,u+1,yg)),s+=3}});let o=Zie(s?Kie(i):i,-n);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new lo(o.length?this.local.concat(o).sort(xg):this.local,r||this.children)}remove(e){return e.length==0||this==oa?this:this.removeInner(e,0)}removeInner(e,i){let n=this.children,r=this.local;for(let s=0;s<n.length;s+=3){let o,a=n[s]+i,l=n[s+1]+i;for(let d=0,p;d<e.length;d++)(p=e[d])&&p.from>a&&p.to<l&&(e[d]=null,(o||(o=[])).push(p));if(!o)continue;n==this.children&&(n=this.children.slice());let u=n[s+2].removeInner(o,a+1);u!=oa?n[s+2]=u:(n.splice(s,3),s-=3)}if(r.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let a=0;a<r.length;a++)r[a].eq(o,i)&&(r==this.local&&(r=this.local.slice()),r.splice(a--,1))}return n==this.children&&r==this.local?this:r.length||n.length?new lo(r,n):oa}forChild(e,i){if(this==oa)return this;if(i.isLeaf)return lo.empty;let n,r;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(n=this.children[a+2]);break}let s=e+1,o=s+i.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>s&&l.type instanceof bp){let u=Math.max(s,l.from)-s,d=Math.min(o,l.to)-s;u<d&&(r||(r=[])).push(l.copy(u,d))}}if(r){let a=new lo(r.sort(xg),Ly);return n?new np([a,n]):a}return n||oa}eq(e){if(this==e)return!0;if(!(e instanceof lo)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let i=0;i<this.local.length;i++)if(!this.local[i].eq(e.local[i]))return!1;for(let i=0;i<this.children.length;i+=3)if(this.children[i]!=e.children[i]||this.children[i+1]!=e.children[i+1]||!this.children[i+2].eq(e.children[i+2]))return!1;return!0}locals(e){return gH(this.localsInner(e))}localsInner(e){if(this==oa)return Ly;if(e.inlineContent||!this.local.some(bp.is))return this.local;let i=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof bp||i.push(this.local[n]);return i}forEachSet(e){e(this)}}lo.empty=new lo([],[]);lo.removeOverlap=gH;const oa=lo.empty;class np{constructor(e){this.members=e}map(e,i){const n=this.members.map(r=>r.map(e,i,yg));return np.from(n)}forChild(e,i){if(i.isLeaf)return lo.empty;let n=[];for(let r=0;r<this.members.length;r++){let s=this.members[r].forChild(e,i);s!=oa&&(s instanceof np?n=n.concat(s.members):n.push(s))}return np.from(n)}eq(e){if(!(e instanceof np)||e.members.length!=this.members.length)return!1;for(let i=0;i<this.members.length;i++)if(!this.members[i].eq(e.members[i]))return!1;return!0}locals(e){let i,n=!0;for(let r=0;r<this.members.length;r++){let s=this.members[r].localsInner(e);if(s.length)if(!i)i=s;else{n&&(i=i.slice(),n=!1);for(let o=0;o<s.length;o++)i.push(s[o])}}return i?gH(n?i:i.sort(xg)):Ly}static from(e){switch(e.length){case 0:return oa;case 1:return e[0];default:return new np(e.every(i=>i instanceof lo)?e:e.reduce((i,n)=>i.concat(n instanceof lo?n:n.members),[]))}}forEachSet(e){for(let i=0;i<this.members.length;i++)this.members[i].forEachSet(e)}}function e6e(t,e,i,n,r,s,o){let a=t.slice();for(let u=0,d=s;u<i.maps.length;u++){let p=0;i.maps[u].forEach((v,y,w,R)=>{let O=R-w-(y-v);for(let P=0;P<a.length;P+=3){let N=a[P+1];if(N<0||v>N+d-p)continue;let F=a[P]+d-p;y>=F?a[P+1]=v<=F?-2:-1:v>=d&&O&&(a[P]+=O,a[P+1]+=O)}p+=O}),d=i.maps[u].map(d,-1)}let l=!1;for(let u=0;u<a.length;u+=3)if(a[u+1]<0){if(a[u+1]==-2){l=!0,a[u+1]=-1;continue}let d=i.map(t[u]+s),p=d-r;if(p<0||p>=n.content.size){l=!0;continue}let v=i.map(t[u+1]+s,-1),y=v-r,{index:w,offset:R}=n.content.findIndex(p),O=n.maybeChild(w);if(O&&R==p&&R+O.nodeSize==y){let P=a[u+2].mapInner(i,O,d+1,t[u]+s+1,o);P!=oa?(a[u]=p,a[u+1]=y,a[u+2]=P):(a[u+1]=-2,l=!0)}else l=!0}if(l){let u=t6e(a,t,e,i,r,s,o),d=iR(u,n,0,o);e=d.local;for(let p=0;p<a.length;p+=3)a[p+1]<0&&(a.splice(p,3),p-=3);for(let p=0,v=0;p<d.children.length;p+=3){let y=d.children[p];for(;v<a.length&&a[v]<y;)v+=3;a.splice(v,0,d.children[p],d.children[p+1],d.children[p+2])}}return new lo(e.sort(xg),a)}function Zie(t,e){if(!e||!t.length)return t;let i=[];for(let n=0;n<t.length;n++){let r=t[n];i.push(new Lc(r.from+e,r.to+e,r.type))}return i}function t6e(t,e,i,n,r,s,o){function a(l,u){for(let d=0;d<l.local.length;d++){let p=l.local[d].map(n,r,u);p?i.push(p):o.onRemove&&o.onRemove(l.local[d].spec)}for(let d=0;d<l.children.length;d+=3)a(l.children[d+2],l.children[d]+u+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+s+1);return i}function Xie(t,e,i){if(e.isLeaf)return null;let n=i+e.nodeSize,r=null;for(let s=0,o;s<t.length;s++)(o=t[s])&&o.from>i&&o.to<n&&((r||(r=[])).push(o),t[s]=null);return r}function Kie(t){let e=[];for(let i=0;i<t.length;i++)t[i]!=null&&e.push(t[i]);return e}function iR(t,e,i,n){let r=[],s=!1;e.forEach((a,l)=>{let u=Xie(t,a,l+i);if(u){s=!0;let d=iR(u,a,i+l+1,n);d!=oa&&r.push(l,l+a.nodeSize,d)}});let o=Zie(s?Kie(t):t,-i).sort(xg);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(n.onRemove&&n.onRemove(o[a].spec),o.splice(a--,1));return o.length||r.length?new lo(o,r):oa}function xg(t,e){return t.from-e.from||t.to-e.to}function gH(t){let e=t;for(let i=0;i<e.length-1;i++){let n=e[i];if(n.from!=n.to)for(let r=i+1;r<e.length;r++){let s=e[r];if(s.from==n.from){s.to!=n.to&&(e==t&&(e=t.slice()),e[r]=s.copy(s.from,n.to),vj(e,r+1,s.copy(n.to,s.to)));continue}else{s.from<n.to&&(e==t&&(e=t.slice()),e[i]=n.copy(n.from,s.from),vj(e,r,n.copy(s.from,n.to)));break}}}return e}function vj(t,e,i){for(;e<t.length&&xg(i,t[e])>0;)e++;t.splice(e,0,i)}function QN(t){let e=[];return t.someProp("decorations",i=>{let n=i(t.state);n&&n!=oa&&e.push(n)}),t.cursorWrapper&&e.push(lo.create(t.state.doc,[t.cursorWrapper.deco])),np.from(e)}const i6e={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},n6e=Cl&&yp<=11;class r6e{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class s6e{constructor(e,i){this.view=e,this.handleDOMChange=i,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new r6e,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let r=0;r<n.length;r++)this.queue.push(n[r]);Cl&&yp<=11&&n.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),n6e&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,i6e)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let i=0;i<e.length;i++)this.queue.push(e[i]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(cj(this.view)){if(this.suppressingSelectionUpdates)return Dd(this.view);if(Cl&&yp<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Vg(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let i=new Set,n;for(let s=e.focusNode;s;s=k0(s))i.add(s);for(let s=e.anchorNode;s;s=k0(s))if(i.has(s)){n=s;break}let r=n&&this.view.docView.nearestDesc(n);if(r&&r.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let i=this.pendingRecords();i.length&&(this.queue=[]);let n=e.domSelectionRange(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&cj(e)&&!this.ignoreSelectionChange(n),s=-1,o=-1,a=!1,l=[];if(e.editable)for(let d=0;d<i.length;d++){let p=this.registerMutation(i[d],l);p&&(s=s<0?p.from:Math.min(p.from,s),o=o<0?p.to:Math.max(p.to,o),p.typeOver&&(a=!0))}if(Mu&&l.length){let d=l.filter(p=>p.nodeName=="BR");if(d.length==2){let[p,v]=d;p.parentNode&&p.parentNode.parentNode==v.parentNode?v.remove():p.remove()}else{let{focusNode:p}=this.currentSelection;for(let v of d){let y=v.parentNode;y&&y.nodeName=="LI"&&(!p||l6e(e,p)!=y)&&v.remove()}}}let u=null;s<0&&r&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&jD(n)&&(u=cH(e))&&u.eq(Nn.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Dd(e),this.currentSelection.set(n),e.scrollToSelection()):(s>-1||r)&&(s>-1&&(e.docView.markDirty(s,o),o6e(e)),this.handleDOMChange(s,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||Dd(e),this.currentSelection.set(n))}registerMutation(e,i){if(i.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(n==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!n||n.ignoreMutation(e))return null;if(e.type=="childList"){for(let d=0;d<e.addedNodes.length;d++){let p=e.addedNodes[d];i.push(p),p.nodeType==3&&(this.lastChangedTextNode=p)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let r=e.previousSibling,s=e.nextSibling;if(Cl&&yp<=11&&e.addedNodes.length)for(let d=0;d<e.addedNodes.length;d++){let{previousSibling:p,nextSibling:v}=e.addedNodes[d];(!p||Array.prototype.indexOf.call(e.addedNodes,p)<0)&&(r=p),(!v||Array.prototype.indexOf.call(e.addedNodes,v)<0)&&(s=v)}let o=r&&r.parentNode==e.target?qo(r)+1:0,a=n.localPosFromDOM(e.target,o,-1),l=s&&s.parentNode==e.target?qo(s):e.target.childNodes.length,u=n.localPosFromDOM(e.target,l,1);return{from:a,to:u}}else return e.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let yj=new WeakMap,xj=!1;function o6e(t){if(!yj.has(t)&&(yj.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Mu,xj)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),xj=!0}}function bj(t,e){let i=e.startContainer,n=e.startOffset,r=e.endContainer,s=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return Vg(o.node,o.offset,r,s)&&([i,n,r,s]=[r,s,i,n]),{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:s}}function a6e(t,e){if(e.getComposedRanges){let r=e.getComposedRanges(t.root)[0];if(r)return bj(t,r)}let i;function n(r){r.preventDefault(),r.stopImmediatePropagation(),i=r.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",n,!0),i?bj(t,i):null}function l6e(t,e){for(let i=e.parentNode;i&&i!=t.dom;i=i.parentNode){let n=t.docView.nearestDesc(i,!0);if(n&&n.node.isBlock)return i}return null}function c6e(t,e,i){let{node:n,fromOffset:r,toOffset:s,from:o,to:a}=t.docView.parseRange(e,i),l=t.domSelectionRange(),u,d=l.anchorNode;if(d&&t.dom.contains(d.nodeType==1?d:d.parentNode)&&(u=[{node:d,offset:l.anchorOffset}],jD(l)||u.push({node:l.focusNode,offset:l.focusOffset})),da&&t.input.lastKeyCode===8)for(let O=s;O>r;O--){let P=n.childNodes[O-1],N=P.pmViewDesc;if(P.nodeName=="BR"&&!N){s=O;break}if(!N||N.size)break}let p=t.state.doc,v=t.someProp("domParser")||o_.fromSchema(t.state.schema),y=p.resolve(o),w=null,R=v.parse(n,{topNode:y.parent,topMatch:y.parent.contentMatchAt(y.index()),topOpen:!0,from:r,to:s,preserveWhitespace:y.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:u6e,context:y});if(u&&u[0].pos!=null){let O=u[0].pos,P=u[1]&&u[1].pos;P==null&&(P=O),w={anchor:O+o,head:P+o}}return{doc:R,sel:w,from:o,to:a}}function u6e(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if($a&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let i=document.createElement("div");return i.appendChild(document.createElement("li")),{skip:i}}else if(t.parentNode.lastChild==t||$a&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const h6e=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function d6e(t,e,i,n,r){let s=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let M=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,D=cH(t,M);if(D&&!t.state.selection.eq(D)){if(da&&Od&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",j=>j(t,jm(13,"Enter"))))return;let G=t.state.tr.setSelection(D);M=="pointer"?G.setMeta("pointer",!0):M=="key"&&G.scrollIntoView(),s&&G.setMeta("composition",s),t.dispatch(G)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(i);e=o.before(a+1),i=t.state.doc.resolve(i).after(a+1);let l=t.state.selection,u=c6e(t,e,i),d=t.state.doc,p=d.slice(u.from,u.to),v,y;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(v=t.state.selection.to,y="end"):(v=t.state.selection.from,y="start"),t.input.lastKeyCode=null;let w=m6e(p.content,u.doc.content,u.from,v,y);if(w&&t.input.domChangeCount++,(D0&&t.input.lastIOSEnter>Date.now()-225||Od)&&r.some(M=>M.nodeType==1&&!h6e.test(M.nodeName))&&(!w||w.endA>=w.endB)&&t.someProp("handleKeyDown",M=>M(t,jm(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!w)if(n&&l instanceof Cn&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(u.sel&&u.sel.anchor!=u.sel.head))w={start:l.from,endA:l.to,endB:l.to};else{if(u.sel){let M=wj(t,t.state.doc,u.sel);if(M&&!M.eq(t.state.selection)){let D=t.state.tr.setSelection(M);s&&D.setMeta("composition",s),t.dispatch(D)}}return}t.state.selection.from<t.state.selection.to&&w.start==w.endB&&t.state.selection instanceof Cn&&(w.start>t.state.selection.from&&w.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?w.start=t.state.selection.from:w.endA<t.state.selection.to&&w.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(w.endB+=t.state.selection.to-w.endA,w.endA=t.state.selection.to)),Cl&&yp<=11&&w.endB==w.start+1&&w.endA==w.start&&w.start>u.from&&u.doc.textBetween(w.start-u.from-1,w.start-u.from+1)==" Â "&&(w.start--,w.endA--,w.endB--);let R=u.doc.resolveNoCache(w.start-u.from),O=u.doc.resolveNoCache(w.endB-u.from),P=d.resolve(w.start),N=R.sameParent(O)&&R.parent.inlineContent&&P.end()>=w.endA,F;if((D0&&t.input.lastIOSEnter>Date.now()-225&&(!N||r.some(M=>M.nodeName=="DIV"||M.nodeName=="P"))||!N&&R.pos<u.doc.content.size&&!R.sameParent(O)&&(F=Nn.findFrom(u.doc.resolve(R.pos+1),1,!0))&&F.head==O.pos)&&t.someProp("handleKeyDown",M=>M(t,jm(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>w.start&&p6e(d,w.start,w.endA,R,O)&&t.someProp("handleKeyDown",M=>M(t,jm(8,"Backspace")))){Od&&da&&t.domObserver.suppressSelectionUpdates();return}da&&w.endB==w.start&&(t.input.lastChromeDelete=Date.now()),Od&&!N&&R.start()!=O.start()&&O.parentOffset==0&&R.depth==O.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==w.endA&&(w.endB-=2,O=u.doc.resolveNoCache(w.endB-u.from),setTimeout(()=>{t.someProp("handleKeyDown",function(M){return M(t,jm(13,"Enter"))})},20));let k=w.start,$=w.endA,W,Q,Y;if(N){if(R.pos==O.pos)Cl&&yp<=11&&R.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Dd(t),20)),W=t.state.tr.delete(k,$),Q=d.resolve(w.start).marksAcross(d.resolve(w.endA));else if(w.endA==w.endB&&(Y=f6e(R.parent.content.cut(R.parentOffset,O.parentOffset),P.parent.content.cut(P.parentOffset,w.endA-P.start()))))W=t.state.tr,Y.type=="add"?W.addMark(k,$,Y.mark):W.removeMark(k,$,Y.mark);else if(R.parent.child(R.index()).isText&&R.index()==O.index()-(O.textOffset?0:1)){let M=R.parent.textBetween(R.parentOffset,O.parentOffset);if(t.someProp("handleTextInput",D=>D(t,k,$,M)))return;W=t.state.tr.insertText(M,k,$)}}if(W||(W=t.state.tr.replace(k,$,u.doc.slice(w.start-u.from,w.endB-u.from))),u.sel){let M=wj(t,W.doc,u.sel);M&&!(da&&t.composing&&M.empty&&(w.start!=w.endB||t.input.lastChromeDelete<Date.now()-100)&&(M.head==k||M.head==W.mapping.map($)-1)||Cl&&M.empty&&M.head==k)&&W.setSelection(M)}Q&&W.ensureMarks(Q),s&&W.setMeta("composition",s),t.dispatch(W.scrollIntoView())}function wj(t,e,i){return Math.max(i.anchor,i.head)>e.content.size?null:uH(t,e.resolve(i.anchor),e.resolve(i.head))}function f6e(t,e){let i=t.firstChild.marks,n=e.firstChild.marks,r=i,s=n,o,a,l;for(let d=0;d<n.length;d++)r=n[d].removeFromSet(r);for(let d=0;d<i.length;d++)s=i[d].removeFromSet(s);if(r.length==1&&s.length==0)a=r[0],o="add",l=d=>d.mark(a.addToSet(d.marks));else if(r.length==0&&s.length==1)a=s[0],o="remove",l=d=>d.mark(a.removeFromSet(d.marks));else return null;let u=[];for(let d=0;d<e.childCount;d++)u.push(l(e.child(d)));if(ai.from(u).eq(t))return{mark:a,type:o}}function p6e(t,e,i,n,r){if(i-e<=r.pos-n.pos||ZN(n,!0,!1)<r.pos)return!1;let s=t.resolve(e);if(!n.parent.isTextblock){let a=s.nodeAfter;return a!=null&&i==e+a.nodeSize}if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=t.resolve(ZN(s,!0,!0));return!o.parent.isTextblock||o.pos>i||ZN(o,!0,!1)<i?!1:n.parent.content.cut(n.parentOffset).eq(o.parent.content)}function ZN(t,e,i){let n=t.depth,r=e?t.end():t.pos;for(;n>0&&(e||t.indexAfter(n)==t.node(n).childCount);)n--,r++,e=!1;if(i){let s=t.node(n).maybeChild(t.indexAfter(n));for(;s&&!s.isLeaf;)s=s.firstChild,r++}return r}function m6e(t,e,i,n,r){let s=t.findDiffStart(e,i);if(s==null)return null;let{a:o,b:a}=t.findDiffEnd(e,i+t.size,i+e.size);if(r=="end"){let l=Math.max(0,s-Math.min(o,a));n-=o+l-s}if(o<s&&t.size<e.size){let l=n<=s&&n>=o?s-n:0;s-=l,s&&s<e.size&&_j(e.textBetween(s-1,s+1))&&(s+=l?1:-1),a=s+(a-o),o=s}else if(a<s){let l=n<=s&&n>=a?s-n:0;s-=l,s&&s<t.size&&_j(t.textBetween(s-1,s+1))&&(s+=l?1:-1),o=s+(o-a),a=s}return{start:s,endA:o,endB:a}}function _j(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),i=t.charCodeAt(1);return e>=56320&&e<=57343&&i>=55296&&i<=56319}class g6e{constructor(e,i){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new LWe,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=i,this.state=i.state,this.directPlugins=i.plugins||[],this.directPlugins.forEach(Tj),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=Oj(this),Sj(this),this.nodeViews=Mj(this),this.docView=nj(this.state.doc,Cj(this),QN(this),this.dom,this),this.domObserver=new s6e(this,(n,r,s,o)=>d6e(this,n,r,s,o)),this.domObserver.start(),FWe(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let i in e)this._props[i]=e[i];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&vV(this);let i=this._props;this._props=e,e.plugins&&(e.plugins.forEach(Tj),this.directPlugins=e.plugins),this.updateStateInner(e.state,i)}setProps(e){let i={};for(let n in this._props)i[n]=this._props[n];i.state=this.state;for(let n in e)i[n]=e[n];this.update(i)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,i){var n;let r=this.state,s=!1,o=!1;e.storedMarks&&this.composing&&(Wie(this),o=!0),this.state=e;let a=r.plugins!=e.plugins||this._props.plugins!=i.plugins;if(a||this._props.plugins!=i.plugins||this._props.nodeViews!=i.nodeViews){let y=Mj(this);y6e(y,this.nodeViews)&&(this.nodeViews=y,s=!0)}(a||i.handleDOMEvents!=this._props.handleDOMEvents)&&vV(this),this.editable=Oj(this),Sj(this);let l=QN(this),u=Cj(this),d=r.plugins!=e.plugins&&!r.doc.eq(e.doc)?"reset":e.scrollToSelection>r.scrollToSelection?"to selection":"preserve",p=s||!this.docView.matchesNode(e.doc,u,l);(p||!e.selection.eq(r.selection))&&(o=!0);let v=d=="preserve"&&o&&this.dom.style.overflowAnchor==null&&X$e(this);if(o){this.domObserver.stop();let y=p&&(Cl||da)&&!this.composing&&!r.selection.empty&&!e.selection.empty&&v6e(r.selection,e.selection);if(p){let w=da?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=ZWe(this)),(s||!this.docView.update(e.doc,u,l,this))&&(this.docView.updateOuterDeco(u),this.docView.destroy(),this.docView=nj(e.doc,u,l,this.dom,this)),w&&!this.trackWrites&&(y=!0)}y||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&bWe(this))?Dd(this,y):(kie(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(r),!((n=this.dragging)===null||n===void 0)&&n.node&&!r.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,r),d=="reset"?this.dom.scrollTop=0:d=="to selection"?this.scrollToSelection():v&&K$e(v)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",i=>i(this)))if(this.state.selection instanceof cn){let i=this.docView.domAfterPos(this.state.selection.from);i.nodeType==1&&Kq(this,i.getBoundingClientRect(),e)}else Kq(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let i=0;i<this.directPlugins.length;i++){let n=this.directPlugins[i];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let i=0;i<this.state.plugins.length;i++){let n=this.state.plugins[i];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let i=0;i<this.pluginViews.length;i++){let n=this.pluginViews[i];n.update&&n.update(this,e)}}updateDraggedNode(e,i){let n=e.node,r=-1;if(this.state.doc.nodeAt(n.from)==n.node)r=n.from;else{let s=n.from+(this.state.doc.content.size-i.doc.content.size);(s>0&&this.state.doc.nodeAt(s))==n.node&&(r=s)}this.dragging=new jie(e.slice,e.move,r<0?void 0:cn.create(this.state.doc,r))}someProp(e,i){let n=this._props&&this._props[e],r;if(n!=null&&(r=i?i(n):n))return r;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(r=i?i(a):a))return r}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let a=s[o].props[e];if(a!=null&&(r=i?i(a):a))return r}}hasFocus(){if(Cl){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Y$e(this.dom),Dd(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let i=this.dom.parentNode;i;i=i.parentNode)if(i.nodeType==9||i.nodeType==11&&i.host)return i.getSelection||(Object.getPrototypeOf(i).getSelection=()=>i.ownerDocument.getSelection()),this._root=i}return e||document}updateRoot(){this._root=null}posAtCoords(e){return nWe(this,e)}coordsAtPos(e,i=1){return Oie(this,e,i)}domAtPos(e,i=0){return this.docView.domFromPos(e,i)}nodeDOM(e){let i=this.docView.descAt(e);return i?i.nodeDOM:null}posAtDOM(e,i,n=-1){let r=this.docView.posFromDOM(e,i,n);if(r==null)throw new RangeError("DOM position not inside the editor");return r}endOfTextblock(e,i){return lWe(this,i||this.state,e)}pasteHTML(e,i){return iC(this,"",e,!1,i||new ClipboardEvent("paste"))}pasteText(e,i){return iC(this,e,null,!0,i||new ClipboardEvent("paste"))}serializeForClipboard(e){return hH(this,e)}destroy(){this.docView&&(NWe(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],QN(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,z$e())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return zWe(this,e)}dispatch(e){let i=this._props.dispatchTransaction;i?i.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){let e=this.domSelection();return e?$a&&this.root.nodeType===11&&$$e(this.dom.ownerDocument)==this.dom&&a6e(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function Cj(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",i=>{if(typeof i=="function"&&(i=i(t.state)),i)for(let n in i)n=="class"?e.class+=" "+i[n]:n=="style"?e.style=(e.style?e.style+";":"")+i[n]:!e[n]&&n!="contenteditable"&&n!="nodeName"&&(e[n]=String(i[n]))}),e.translate||(e.translate="no"),[Lc.node(0,t.state.doc.content.size,e)]}function Sj(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Lc.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function Oj(t){return!t.someProp("editable",e=>e(t.state)===!1)}function v6e(t,e){let i=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(i)!=e.$anchor.start(i)}function Mj(t){let e=Object.create(null);function i(n){for(let r in n)Object.prototype.hasOwnProperty.call(e,r)||(e[r]=n[r])}return t.someProp("nodeViews",i),t.someProp("markViews",i),e}function y6e(t,e){let i=0,n=0;for(let r in t){if(t[r]!=e[r])return!0;i++}for(let r in e)n++;return i!=n}function Tj(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}const x6e=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function b6e(t){let e=t.split(/-(?!$)/),i=e[e.length-1];i=="Space"&&(i=" ");let n,r,s,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))r=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))x6e?o=!0:r=!0;else throw new Error("Unrecognized modifier name: "+l)}return n&&(i="Alt-"+i),r&&(i="Ctrl-"+i),o&&(i="Meta-"+i),s&&(i="Shift-"+i),i}function w6e(t){let e=Object.create(null);for(let i in t)e[b6e(i)]=t[i];return e}function XN(t,e,i=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),i&&e.shiftKey&&(t="Shift-"+t),t}function _6e(t){return new Ml({props:{handleKeyDown:Yie(t)}})}function Yie(t){let e=w6e(t);return function(i,n){let r=ZZ(n),s,o=e[XN(r,n)];if(o&&o(i.state,i.dispatch,i))return!0;if(r.length==1&&r!=" "){if(n.shiftKey){let a=e[XN(r,n,!1)];if(a&&a(i.state,i.dispatch,i))return!0}if((n.shiftKey||n.altKey||n.metaKey||r.charCodeAt(0)>127)&&(s=Gd[n.keyCode])&&s!=r){let a=e[XN(s,n)];if(a&&a(i.state,i.dispatch,i))return!0}}return!1}}const vH=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function Jie(t,e){let{$cursor:i}=t.selection;return!i||(e?!e.endOfTextblock("backward",t):i.parentOffset>0)?null:i}const ene=(t,e,i)=>{let n=Jie(t,i);if(!n)return!1;let r=yH(n);if(!r){let o=n.blockRange(),a=o&&fx(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let s=r.nodeBefore;if(cne(t,r,e,-1))return!0;if(n.parent.content.size==0&&(L0(s,"end")||cn.isSelectable(s)))for(let o=n.depth;;o--){let a=WD(t.doc,n.before(o),n.after(o),Ii.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(L0(s,"end")?Nn.findFrom(l.doc.resolve(l.mapping.map(r.pos,-1)),-1):cn.create(l.doc,r.pos-s.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||n.node(o-1).childCount>1)break}return s.isAtom&&r.depth==n.depth-1?(e&&e(t.tr.delete(r.pos-s.nodeSize,r.pos).scrollIntoView()),!0):!1},C6e=(t,e,i)=>{let n=Jie(t,i);if(!n)return!1;let r=yH(n);return r?tne(t,r,e):!1},S6e=(t,e,i)=>{let n=nne(t,i);if(!n)return!1;let r=xH(n);return r?tne(t,r,e):!1};function tne(t,e,i){let n=e.nodeBefore,r=n,s=e.pos-1;for(;!r.isTextblock;s--){if(r.type.spec.isolating)return!1;let d=r.lastChild;if(!d)return!1;r=d}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let d=a.firstChild;if(!d)return!1;a=d}let u=WD(t.doc,s,l,Ii.empty);if(!u||u.from!=s||u instanceof Po&&u.slice.size>=l-s)return!1;if(i){let d=t.tr.step(u);d.setSelection(Cn.create(d.doc,s)),i(d.scrollIntoView())}return!0}function L0(t,e,i=!1){for(let n=t;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(i&&n.childCount!=1)return!1}return!1}const ine=(t,e,i)=>{let{$head:n,empty:r}=t.selection,s=n;if(!r)return!1;if(n.parent.isTextblock){if(i?!i.endOfTextblock("backward",t):n.parentOffset>0)return!1;s=yH(n)}let o=s&&s.nodeBefore;return!o||!cn.isSelectable(o)?!1:(e&&e(t.tr.setSelection(cn.create(t.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function yH(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function nne(t,e){let{$cursor:i}=t.selection;return!i||(e?!e.endOfTextblock("forward",t):i.parentOffset<i.parent.content.size)?null:i}const rne=(t,e,i)=>{let n=nne(t,i);if(!n)return!1;let r=xH(n);if(!r)return!1;let s=r.nodeAfter;if(cne(t,r,e,1))return!0;if(n.parent.content.size==0&&(L0(s,"start")||cn.isSelectable(s))){let o=WD(t.doc,n.before(),n.after(),Ii.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(L0(s,"start")?Nn.findFrom(a.doc.resolve(a.mapping.map(r.pos)),1):cn.create(a.doc,a.mapping.map(r.pos))),e(a.scrollIntoView())}return!0}}return s.isAtom&&r.depth==n.depth-1?(e&&e(t.tr.delete(r.pos,r.pos+s.nodeSize).scrollIntoView()),!0):!1},sne=(t,e,i)=>{let{$head:n,empty:r}=t.selection,s=n;if(!r)return!1;if(n.parent.isTextblock){if(i?!i.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)return!1;s=xH(n)}let o=s&&s.nodeAfter;return!o||!cn.isSelectable(o)?!1:(e&&e(t.tr.setSelection(cn.create(t.doc,s.pos)).scrollIntoView()),!0)};function xH(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let i=t.node(e);if(t.index(e)+1<i.childCount)return t.doc.resolve(t.after(e+1));if(i.type.spec.isolating)break}return null}const O6e=(t,e)=>{let i=t.selection,n=i instanceof cn,r;if(n){if(i.node.isTextblock||!zp(t.doc,i.from))return!1;r=i.from}else if(r=$D(t.doc,i.from,-1),r==null)return!1;if(e){let s=t.tr.join(r);n&&s.setSelection(cn.create(s.doc,r-t.doc.resolve(r).nodeBefore.nodeSize)),e(s.scrollIntoView())}return!0},M6e=(t,e)=>{let i=t.selection,n;if(i instanceof cn){if(i.node.isTextblock||!zp(t.doc,i.to))return!1;n=i.to}else if(n=$D(t.doc,i.to,1),n==null)return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0},T6e=(t,e)=>{let{$from:i,$to:n}=t.selection,r=i.blockRange(n),s=r&&fx(r);return s==null?!1:(e&&e(t.tr.lift(r,s).scrollIntoView()),!0)},one=(t,e)=>{let{$head:i,$anchor:n}=t.selection;return!i.parent.type.spec.code||!i.sameParent(n)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function bH(t){for(let e=0;e<t.edgeCount;e++){let{type:i}=t.edge(e);if(i.isTextblock&&!i.hasRequiredAttrs())return i}return null}const R6e=(t,e)=>{let{$head:i,$anchor:n}=t.selection;if(!i.parent.type.spec.code||!i.sameParent(n))return!1;let r=i.node(-1),s=i.indexAfter(-1),o=bH(r.contentMatchAt(s));if(!o||!r.canReplaceWith(s,s,o))return!1;if(e){let a=i.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(Nn.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},ane=(t,e)=>{let i=t.selection,{$from:n,$to:r}=i;if(i instanceof ec||n.parent.inlineContent||r.parent.inlineContent)return!1;let s=bH(r.parent.contentMatchAt(r.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let o=(!n.parentOffset&&r.index()<r.parent.childCount?n:r).pos,a=t.tr.insert(o,s.createAndFill());a.setSelection(Cn.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},lne=(t,e)=>{let{$cursor:i}=t.selection;if(!i||i.parent.content.size)return!1;if(i.depth>1&&i.after()!=i.end(-1)){let s=i.before();if(kd(t.doc,s))return e&&e(t.tr.split(s).scrollIntoView()),!0}let n=i.blockRange(),r=n&&fx(n);return r==null?!1:(e&&e(t.tr.lift(n,r).scrollIntoView()),!0)};function P6e(t){return(e,i)=>{let{$from:n,$to:r}=e.selection;if(e.selection instanceof cn&&e.selection.node.isBlock)return!n.parentOffset||!kd(e.doc,n.pos)?!1:(i&&i(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let s=[],o,a,l=!1,u=!1;for(let y=n.depth;;y--)if(n.node(y).isBlock){l=n.end(y)==n.pos+(n.depth-y),u=n.start(y)==n.pos-(n.depth-y),a=bH(n.node(y-1).contentMatchAt(n.indexAfter(y-1))),s.unshift(l&&a?{type:a}:null),o=y;break}else{if(y==1)return!1;s.unshift(null)}let d=e.tr;(e.selection instanceof Cn||e.selection instanceof ec)&&d.deleteSelection();let p=d.mapping.map(n.pos),v=kd(d.doc,p,s.length,s);if(v||(s[0]=a?{type:a}:null,v=kd(d.doc,p,s.length,s)),d.split(p,s.length,s),!l&&u&&n.node(o).type!=a){let y=d.mapping.map(n.before(o)),w=d.doc.resolve(y);a&&n.node(o-1).canReplaceWith(w.index(),w.index()+1,a)&&d.setNodeMarkup(d.mapping.map(n.before(o)),a)}return i&&i(d.scrollIntoView()),!0}}const E6e=P6e(),A6e=(t,e)=>{let{$from:i,to:n}=t.selection,r,s=i.sharedDepth(n);return s==0?!1:(r=i.before(s),e&&e(t.tr.setSelection(cn.create(t.doc,r))),!0)};function I6e(t,e,i){let n=e.nodeBefore,r=e.nodeAfter,s=e.index();return!n||!r||!n.type.compatibleContent(r.type)?!1:!n.content.size&&e.parent.canReplace(s-1,s)?(i&&i(t.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(s,s+1)||!(r.isTextblock||zp(t.doc,e.pos))?!1:(i&&i(t.tr.join(e.pos).scrollIntoView()),!0)}function cne(t,e,i,n){let r=e.nodeBefore,s=e.nodeAfter,o,a,l=r.type.spec.isolating||s.type.spec.isolating;if(!l&&I6e(t,e,i))return!0;let u=!l&&e.parent.canReplace(e.index(),e.index()+1);if(u&&(o=(a=r.contentMatchAt(r.childCount)).findWrapping(s.type))&&a.matchType(o[0]||s.type).validEnd){if(i){let y=e.pos+s.nodeSize,w=ai.empty;for(let P=o.length-1;P>=0;P--)w=ai.from(o[P].create(null,w));w=ai.from(r.copy(w));let R=t.tr.step(new Ao(e.pos-1,y,e.pos,y,new Ii(w,1,0),o.length,!0)),O=R.doc.resolve(y+2*o.length);O.nodeAfter&&O.nodeAfter.type==r.type&&zp(R.doc,O.pos)&&R.join(O.pos),i(R.scrollIntoView())}return!0}let d=s.type.spec.isolating||n>0&&l?null:Nn.findFrom(e,1),p=d&&d.$from.blockRange(d.$to),v=p&&fx(p);if(v!=null&&v>=e.depth)return i&&i(t.tr.lift(p,v).scrollIntoView()),!0;if(u&&L0(s,"start",!0)&&L0(r,"end")){let y=r,w=[];for(;w.push(y),!y.isTextblock;)y=y.lastChild;let R=s,O=1;for(;!R.isTextblock;R=R.firstChild)O++;if(y.canReplace(y.childCount,y.childCount,R.content)){if(i){let P=ai.empty;for(let F=w.length-1;F>=0;F--)P=ai.from(w[F].copy(P));let N=t.tr.step(new Ao(e.pos-w.length,e.pos+s.nodeSize,e.pos+O,e.pos+s.nodeSize-O,new Ii(P,w.length,0),0,!0));i(N.scrollIntoView())}return!0}}return!1}function une(t){return function(e,i){let n=e.selection,r=t<0?n.$from:n.$to,s=r.depth;for(;r.node(s).isInline;){if(!s)return!1;s--}return r.node(s).isTextblock?(i&&i(e.tr.setSelection(Cn.create(e.doc,t<0?r.start(s):r.end(s)))),!0):!1}}const k6e=une(-1),D6e=une(1);function L6e(t,e=null){return function(i,n){let{$from:r,$to:s}=i.selection,o=r.blockRange(s),a=o&&oH(o,t,e);return a?(n&&n(i.tr.wrap(o,a).scrollIntoView()),!0):!1}}function Rj(t,e=null){return function(i,n){let r=!1;for(let s=0;s<i.selection.ranges.length&&!r;s++){let{$from:{pos:o},$to:{pos:a}}=i.selection.ranges[s];i.doc.nodesBetween(o,a,(l,u)=>{if(r)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)r=!0;else{let d=i.doc.resolve(u),p=d.index();r=d.parent.canReplaceWith(p,p+1,t)}})}if(!r)return!1;if(n){let s=i.tr;for(let o=0;o<i.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=i.selection.ranges[o];s.setBlockType(a,l,t,e)}n(s.scrollIntoView())}return!0}}function wH(...t){return function(e,i,n){for(let r=0;r<t.length;r++)if(t[r](e,i,n))return!0;return!1}}wH(vH,ene,ine);wH(vH,rne,sne);wH(one,ane,lne,E6e);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function F6e(t,e=null){return function(i,n){let{$from:r,$to:s}=i.selection,o=r.blockRange(s);if(!o)return!1;let a=n?i.tr:null;return N6e(a,o,t,e)?(n&&n(a.scrollIntoView()),!0):!1}}function N6e(t,e,i,n=null){let r=!1,s=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(i)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);s=new XT(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new XT(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),r=!0}let a=oH(s,i,n,e);return a?(t&&B6e(t,e,a,r,i),!0):!1}function B6e(t,e,i,n,r){let s=ai.empty;for(let d=i.length-1;d>=0;d--)s=ai.from(i[d].type.create(i[d].attrs,s));t.step(new Ao(e.start-(n?2:0),e.end,e.start,e.end,new Ii(s,0,0),i.length,!0));let o=0;for(let d=0;d<i.length;d++)i[d].type==r&&(o=d+1);let a=i.length-o,l=e.start+i.length-(n?2:0),u=e.parent;for(let d=e.startIndex,p=e.endIndex,v=!0;d<p;d++,v=!1)!v&&kd(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=u.child(d).nodeSize;return t}function z6e(t){return function(e,i){let{$from:n,$to:r}=e.selection,s=n.blockRange(r,o=>o.childCount>0&&o.firstChild.type==t);return s?i?n.node(s.depth-1).type==t?V6e(e,i,t,s):G6e(e,i,s):!0:!1}}function V6e(t,e,i,n){let r=t.tr,s=n.end,o=n.$to.end(n.depth);s<o&&(r.step(new Ao(s-1,o,s,o,new Ii(ai.from(i.create(null,n.parent.copy())),1,0),1,!0)),n=new XT(r.doc.resolve(n.$from.pos),r.doc.resolve(o),n.depth));const a=fx(n);if(a==null)return!1;r.lift(n,a);let l=r.doc.resolve(r.mapping.map(s,-1)-1);return zp(r.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&r.join(l.pos),e(r.scrollIntoView()),!0}function G6e(t,e,i){let n=t.tr,r=i.parent;for(let y=i.end,w=i.endIndex-1,R=i.startIndex;w>R;w--)y-=r.child(w).nodeSize,n.delete(y-1,y+1);let s=n.doc.resolve(i.start),o=s.nodeAfter;if(n.mapping.map(i.end)!=i.start+s.nodeAfter.nodeSize)return!1;let a=i.startIndex==0,l=i.endIndex==r.childCount,u=s.node(-1),d=s.index(-1);if(!u.canReplace(d+(a?0:1),d+1,o.content.append(l?ai.empty:ai.from(r))))return!1;let p=s.pos,v=p+o.nodeSize;return n.step(new Ao(p-(a?1:0),v+(l?1:0),p+1,v-1,new Ii((a?ai.empty:ai.from(r.copy(ai.empty))).append(l?ai.empty:ai.from(r.copy(ai.empty))),a?0:1,l?0:1),a?0:1)),e(n.scrollIntoView()),!0}function U6e(t){return function(e,i){let{$from:n,$to:r}=e.selection,s=n.blockRange(r,u=>u.childCount>0&&u.firstChild.type==t);if(!s)return!1;let o=s.startIndex;if(o==0)return!1;let a=s.parent,l=a.child(o-1);if(l.type!=t)return!1;if(i){let u=l.lastChild&&l.lastChild.type==a.type,d=ai.from(u?t.create():null),p=new Ii(ai.from(t.create(null,ai.from(a.type.create(null,d)))),u?3:1,0),v=s.start,y=s.end;i(e.tr.step(new Ao(v-(u?3:1),y,v,y,p,1,!0)).scrollIntoView())}return!0}}function XD(t){const{state:e,transaction:i}=t;let{selection:n}=i,{doc:r}=i,{storedMarks:s}=i;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return n},get doc(){return r},get tr(){return n=i.selection,r=i.doc,s=i.storedMarks,i}}}class KD{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:i,state:n}=this,{view:r}=i,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...d)=>{const p=l(...d)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(s),p}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,i=!0){const{rawCommands:n,editor:r,state:s}=this,{view:o}=r,a=[],l=!!e,u=e||s.tr,d=()=>(!l&&i&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),a.every(v=>v===!0)),p={...Object.fromEntries(Object.entries(n).map(([v,y])=>[v,(...R)=>{const O=this.buildProps(u,i),P=y(...R)(O);return a.push(P),p}])),run:d};return p}createCan(e){const{rawCommands:i,state:n}=this,r=!1,s=e||n.tr,o=this.buildProps(s,r);return{...Object.fromEntries(Object.entries(i).map(([l,u])=>[l,(...d)=>u(...d)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,r)}}buildProps(e,i=!0){const{rawCommands:n,editor:r,state:s}=this,{view:o}=r,a={tr:e,editor:r,view:o,state:XD({state:s,transaction:e}),dispatch:i?()=>{}:void 0,chain:()=>this.createChain(e,i),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([l,u])=>[l,(...d)=>u(...d)(a)]))}};return a}}class H6e{constructor(){this.callbacks={}}on(e,i){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(i),this}emit(e,...i){const n=this.callbacks[e];return n&&n.forEach(r=>r.apply(this,i)),this}off(e,i){const n=this.callbacks[e];return n&&(i?this.callbacks[e]=n.filter(r=>r!==i):delete this.callbacks[e]),this}once(e,i){const n=(...r)=>{this.off(e,n),i.apply(this,r)};return this.on(e,n)}removeAllListeners(){this.callbacks={}}}function qi(t,e,i){return t.config[e]===void 0&&t.parent?qi(t.parent,e,i):typeof t.config[e]=="function"?t.config[e].bind({...i,parent:t.parent?qi(t.parent,e,i):null}):t.config[e]}function YD(t){const e=t.filter(r=>r.type==="extension"),i=t.filter(r=>r.type==="node"),n=t.filter(r=>r.type==="mark");return{baseExtensions:e,nodeExtensions:i,markExtensions:n}}function hne(t){const e=[],{nodeExtensions:i,markExtensions:n}=YD(t),r=[...i,...n],s={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:r},l=qi(o,"addGlobalAttributes",a);if(!l)return;l().forEach(d=>{d.types.forEach(p=>{Object.entries(d.attributes).forEach(([v,y])=>{e.push({type:p,name:v,attribute:{...s,...y}})})})})}),r.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=qi(o,"addAttributes",a);if(!l)return;const u=l();Object.entries(u).forEach(([d,p])=>{const v={...s,...p};typeof v?.default=="function"&&(v.default=v.default()),v?.isRequired&&v?.default===void 0&&delete v.default,e.push({type:o.name,name:d,attribute:v})})}),e}function ko(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function go(...t){return t.filter(e=>!!e).reduce((e,i)=>{const n={...e};return Object.entries(i).forEach(([r,s])=>{if(!n[r]){n[r]=s;return}if(r==="class"){const a=s?String(s).split(" "):[],l=n[r]?n[r].split(" "):[],u=a.filter(d=>!l.includes(d));n[r]=[...l,...u].join(" ")}else if(r==="style"){const a=s?s.split(";").map(d=>d.trim()).filter(Boolean):[],l=n[r]?n[r].split(";").map(d=>d.trim()).filter(Boolean):[],u=new Map;l.forEach(d=>{const[p,v]=d.split(":").map(y=>y.trim());u.set(p,v)}),a.forEach(d=>{const[p,v]=d.split(":").map(y=>y.trim());u.set(p,v)}),n[r]=Array.from(u.entries()).map(([d,p])=>`${d}: ${p}`).join("; ")}else n[r]=s}),n},{})}function nR(t,e){return e.filter(i=>i.type===t.type.name).filter(i=>i.attribute.rendered).map(i=>i.attribute.renderHTML?i.attribute.renderHTML(t.attrs)||{}:{[i.name]:t.attrs[i.name]}).reduce((i,n)=>go(i,n),{})}function dne(t){return typeof t=="function"}function Gn(t,e=void 0,...i){return dne(t)?e?t.bind(e)(...i):t(...i):t}function $6e(t={}){return Object.keys(t).length===0&&t.constructor===Object}function W6e(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function Pj(t,e){return"style"in t?t:{...t,getAttrs:i=>{const n=t.getAttrs?t.getAttrs(i):t.attrs;if(n===!1)return!1;const r=e.reduce((s,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(i):W6e(i.getAttribute(o.name));return a==null?s:{...s,[o.name]:a}},{});return{...n,...r}}}}function Ej(t){return Object.fromEntries(Object.entries(t).filter(([e,i])=>e==="attrs"&&$6e(i)?!1:i!=null))}function q6e(t,e){var i;const n=hne(t),{nodeExtensions:r,markExtensions:s}=YD(t),o=(i=r.find(u=>qi(u,"topNode")))===null||i===void 0?void 0:i.name,a=Object.fromEntries(r.map(u=>{const d=n.filter(P=>P.type===u.name),p={name:u.name,options:u.options,storage:u.storage,editor:e},v=t.reduce((P,N)=>{const F=qi(N,"extendNodeSchema",p);return{...P,...F?F(u):{}}},{}),y=Ej({...v,content:Gn(qi(u,"content",p)),marks:Gn(qi(u,"marks",p)),group:Gn(qi(u,"group",p)),inline:Gn(qi(u,"inline",p)),atom:Gn(qi(u,"atom",p)),selectable:Gn(qi(u,"selectable",p)),draggable:Gn(qi(u,"draggable",p)),code:Gn(qi(u,"code",p)),whitespace:Gn(qi(u,"whitespace",p)),linebreakReplacement:Gn(qi(u,"linebreakReplacement",p)),defining:Gn(qi(u,"defining",p)),isolating:Gn(qi(u,"isolating",p)),attrs:Object.fromEntries(d.map(P=>{var N;return[P.name,{default:(N=P?.attribute)===null||N===void 0?void 0:N.default}]}))}),w=Gn(qi(u,"parseHTML",p));w&&(y.parseDOM=w.map(P=>Pj(P,d)));const R=qi(u,"renderHTML",p);R&&(y.toDOM=P=>R({node:P,HTMLAttributes:nR(P,d)}));const O=qi(u,"renderText",p);return O&&(y.toText=O),[u.name,y]})),l=Object.fromEntries(s.map(u=>{const d=n.filter(O=>O.type===u.name),p={name:u.name,options:u.options,storage:u.storage,editor:e},v=t.reduce((O,P)=>{const N=qi(P,"extendMarkSchema",p);return{...O,...N?N(u):{}}},{}),y=Ej({...v,inclusive:Gn(qi(u,"inclusive",p)),excludes:Gn(qi(u,"excludes",p)),group:Gn(qi(u,"group",p)),spanning:Gn(qi(u,"spanning",p)),code:Gn(qi(u,"code",p)),attrs:Object.fromEntries(d.map(O=>{var P;return[O.name,{default:(P=O?.attribute)===null||P===void 0?void 0:P.default}]}))}),w=Gn(qi(u,"parseHTML",p));w&&(y.parseDOM=w.map(O=>Pj(O,d)));const R=qi(u,"renderHTML",p);return R&&(y.toDOM=O=>R({mark:O,HTMLAttributes:nR(O,d)})),[u.name,y]}));return new tie({topNode:o,nodes:a,marks:l})}function KN(t,e){return e.nodes[t]||e.marks[t]||null}function Aj(t,e){return Array.isArray(e)?e.some(i=>(typeof i=="string"?i:i.name)===t.name):e}function _H(t,e){const i=rv.fromSchema(e).serializeFragment(t),r=document.implementation.createHTMLDocument().createElement("div");return r.appendChild(i),r.innerHTML}const j6e=(t,e=500)=>{let i="";const n=t.parentOffset;return t.parent.nodesBetween(Math.max(0,n-e),n,(r,s,o,a)=>{var l,u;const d=((u=(l=r.type.spec).toText)===null||u===void 0?void 0:u.call(l,{node:r,pos:s,parent:o,index:a}))||r.textContent||"%leaf%";i+=r.isAtom&&!r.isText?d:d.slice(0,Math.max(0,n-s))}),i};function CH(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class JD{constructor(e){this.find=e.find,this.handler=e.handler}}const Q6e=(t,e)=>{if(CH(e))return e.exec(t);const i=e(t);if(!i)return null;const n=[i.text];return n.index=i.index,n.input=t,n.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),n.push(i.replaceWith)),n};function oO(t){var e;const{editor:i,from:n,to:r,text:s,rules:o,plugin:a}=t,{view:l}=i;if(l.composing)return!1;const u=l.state.doc.resolve(n);if(u.parent.type.spec.code||!((e=u.nodeBefore||u.nodeAfter)===null||e===void 0)&&e.marks.find(v=>v.type.spec.code))return!1;let d=!1;const p=j6e(u)+s;return o.forEach(v=>{if(d)return;const y=Q6e(p,v.find);if(!y)return;const w=l.state.tr,R=XD({state:l.state,transaction:w}),O={from:n-(y[0].length-s.length),to:r},{commands:P,chain:N,can:F}=new KD({editor:i,state:R});v.handler({state:R,range:O,match:y,commands:P,chain:N,can:F})===null||!w.steps.length||(w.setMeta(a,{transform:w,from:n,to:r,text:s}),l.dispatch(w),d=!0)}),d}function Z6e(t){const{editor:e,rules:i}=t,n=new Ml({state:{init(){return null},apply(r,s,o){const a=r.getMeta(n);if(a)return a;const l=r.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:d}=l;typeof d=="string"?d=d:d=_H(ai.from(d),o.schema);const{from:p}=l,v=p+d.length;oO({editor:e,from:p,to:v,text:d,rules:i,plugin:n})}),r.selectionSet||r.docChanged?null:s}},props:{handleTextInput(r,s,o,a){return oO({editor:e,from:s,to:o,text:a,rules:i,plugin:n})},handleDOMEvents:{compositionend:r=>(setTimeout(()=>{const{$cursor:s}=r.state.selection;s&&oO({editor:e,from:s.pos,to:s.pos,text:"",rules:i,plugin:n})}),!1)},handleKeyDown(r,s){if(s.key!=="Enter")return!1;const{$cursor:o}=r.state.selection;return o?oO({editor:e,from:o.pos,to:o.pos,text:`
`,rules:i,plugin:n}):!1}},isInputRules:!0});return n}function X6e(t){return Object.prototype.toString.call(t).slice(8,-1)}function aO(t){return X6e(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function eL(t,e){const i={...t};return aO(t)&&aO(e)&&Object.keys(e).forEach(n=>{aO(e[n])&&aO(t[n])?i[n]=eL(t[n],e[n]):i[n]=e[n]}),i}class Pp{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Gn(qi(this,"addOptions",{name:this.name}))),this.storage=Gn(qi(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Pp(e)}configure(e={}){const i=this.extend({...this.config,addOptions:()=>eL(this.options,e)});return i.name=this.name,i.parent=this.parent,i}extend(e={}){const i=new Pp(e);return i.parent=this,this.child=i,i.name=e.name?e.name:i.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${i.name}".`),i.options=Gn(qi(i,"addOptions",{name:i.name})),i.storage=Gn(qi(i,"addStorage",{name:i.name,options:i.options})),i}static handleExit({editor:e,mark:i}){const{tr:n}=e.state,r=e.state.selection.$from;if(r.pos===r.end()){const o=r.marks();if(!!!o.find(u=>u?.type.name===i.name))return!1;const l=o.find(u=>u?.type.name===i.name);return l&&n.removeStoredMark(l),n.insertText(" ",r.pos),e.view.dispatch(n),!0}return!1}}function K6e(t){return typeof t=="number"}class Y6e{constructor(e){this.find=e.find,this.handler=e.handler}}const J6e=(t,e,i)=>{if(CH(e))return[...t.matchAll(e)];const n=e(t,i);return n?n.map(r=>{const s=[r.text];return s.index=r.index,s.input=t,s.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),s.push(r.replaceWith)),s}):[]};function eqe(t){const{editor:e,state:i,from:n,to:r,rule:s,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:u,can:d}=new KD({editor:e,state:i}),p=[];return i.doc.nodesBetween(n,r,(y,w)=>{if(!y.isTextblock||y.type.spec.code)return;const R=Math.max(n,w),O=Math.min(r,w+y.content.size),P=y.textBetween(R-w,O-w,void 0,"ï¿¼");J6e(P,s.find,o).forEach(F=>{if(F.index===void 0)return;const k=R+F.index+1,$=k+F[0].length,W={from:i.tr.mapping.map(k),to:i.tr.mapping.map($)},Q=s.handler({state:i,range:W,match:F,commands:l,chain:u,can:d,pasteEvent:o,dropEvent:a});p.push(Q)})}),p.every(y=>y!==null)}let lO=null;const tqe=t=>{var e;const i=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=i.clipboardData)===null||e===void 0||e.setData("text/html",t),i};function iqe(t){const{editor:e,rules:i}=t;let n=null,r=!1,s=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:d,from:p,to:v,rule:y,pasteEvt:w})=>{const R=d.tr,O=XD({state:d,transaction:R});if(!(!eqe({editor:e,state:O,from:Math.max(p-1,0),to:v.b-1,rule:y,pasteEvent:w,dropEvent:a})||!R.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,R}};return i.map(d=>new Ml({view(p){const v=w=>{var R;n=!((R=p.dom.parentElement)===null||R===void 0)&&R.contains(w.target)?p.dom.parentElement:null,n&&(lO=e)},y=()=>{lO&&(lO=null)};return window.addEventListener("dragstart",v),window.addEventListener("dragend",y),{destroy(){window.removeEventListener("dragstart",v),window.removeEventListener("dragend",y)}}},props:{handleDOMEvents:{drop:(p,v)=>{if(s=n===p.dom.parentElement,a=v,!s){const y=lO;y&&setTimeout(()=>{const w=y.state.selection;w&&y.commands.deleteRange({from:w.from,to:w.to})},10)}return!1},paste:(p,v)=>{var y;const w=(y=v.clipboardData)===null||y===void 0?void 0:y.getData("text/html");return o=v,r=!!w?.includes("data-pm-slice"),!1}}},appendTransaction:(p,v,y)=>{const w=p[0],R=w.getMeta("uiEvent")==="paste"&&!r,O=w.getMeta("uiEvent")==="drop"&&!s,P=w.getMeta("applyPasteRules"),N=!!P;if(!R&&!O&&!N)return;if(N){let{text:$}=P;typeof $=="string"?$=$:$=_H(ai.from($),y.schema);const{from:W}=P,Q=W+$.length,Y=tqe($);return l({rule:d,state:y,from:W,to:{b:Q},pasteEvt:Y})}const F=v.doc.content.findDiffStart(y.doc.content),k=v.doc.content.findDiffEnd(y.doc.content);if(!(!K6e(F)||!k||F===k.b))return l({rule:d,state:y,from:F,to:k,pasteEvt:o})}}))}function nqe(t){const e=t.filter((i,n)=>t.indexOf(i)!==n);return Array.from(new Set(e))}class Hy{constructor(e,i){this.splittableMarks=[],this.editor=i,this.extensions=Hy.resolve(e),this.schema=q6e(this.extensions,i),this.setupExtensions()}static resolve(e){const i=Hy.sort(Hy.flatten(e)),n=nqe(i.map(r=>r.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(r=>`'${r}'`).join(", ")}]. This can lead to issues.`),i}static flatten(e){return e.map(i=>{const n={name:i.name,options:i.options,storage:i.storage},r=qi(i,"addExtensions",n);return r?[i,...this.flatten(r())]:i}).flat(10)}static sort(e){return e.sort((n,r)=>{const s=qi(n,"priority")||100,o=qi(r,"priority")||100;return s>o?-1:s<o?1:0})}get commands(){return this.extensions.reduce((e,i)=>{const n={name:i.name,options:i.options,storage:i.storage,editor:this.editor,type:KN(i.name,this.schema)},r=qi(i,"addCommands",n);return r?{...e,...r()}:e},{})}get plugins(){const{editor:e}=this,i=Hy.sort([...this.extensions].reverse()),n=[],r=[],s=i.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:KN(o.name,this.schema)},l=[],u=qi(o,"addKeyboardShortcuts",a);let d={};if(o.type==="mark"&&qi(o,"exitable",a)&&(d.ArrowRight=()=>Pp.handleExit({editor:e,mark:o})),u){const R=Object.fromEntries(Object.entries(u()).map(([O,P])=>[O,()=>P({editor:e})]));d={...d,...R}}const p=_6e(d);l.push(p);const v=qi(o,"addInputRules",a);Aj(o,e.options.enableInputRules)&&v&&n.push(...v());const y=qi(o,"addPasteRules",a);Aj(o,e.options.enablePasteRules)&&y&&r.push(...y());const w=qi(o,"addProseMirrorPlugins",a);if(w){const R=w();l.push(...R)}return l}).flat();return[Z6e({editor:e,rules:n}),...iqe({editor:e,rules:r}),...s]}get attributes(){return hne(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:i}=YD(this.extensions);return Object.fromEntries(i.filter(n=>!!qi(n,"addNodeView")).map(n=>{const r=this.attributes.filter(l=>l.type===n.name),s={name:n.name,options:n.options,storage:n.storage,editor:e,type:ko(n.name,this.schema)},o=qi(n,"addNodeView",s);if(!o)return[];const a=(l,u,d,p,v)=>{const y=nR(l,r);return o()({node:l,view:u,getPos:d,decorations:p,innerDecorations:v,editor:e,extension:n,HTMLAttributes:y})};return[n.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var i;this.editor.extensionStorage[e.name]=e.storage;const n={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:KN(e.name,this.schema)};e.type==="mark"&&(!((i=Gn(qi(e,"keepOnSplit",n)))!==null&&i!==void 0)||i)&&this.splittableMarks.push(e.name);const r=qi(e,"onBeforeCreate",n),s=qi(e,"onCreate",n),o=qi(e,"onUpdate",n),a=qi(e,"onSelectionUpdate",n),l=qi(e,"onTransaction",n),u=qi(e,"onFocus",n),d=qi(e,"onBlur",n),p=qi(e,"onDestroy",n);r&&this.editor.on("beforeCreate",r),s&&this.editor.on("create",s),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),u&&this.editor.on("focus",u),d&&this.editor.on("blur",d),p&&this.editor.on("destroy",p)})}}class ja{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Gn(qi(this,"addOptions",{name:this.name}))),this.storage=Gn(qi(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ja(e)}configure(e={}){const i=this.extend({...this.config,addOptions:()=>eL(this.options,e)});return i.name=this.name,i.parent=this.parent,i}extend(e={}){const i=new ja({...this.config,...e});return i.parent=this,this.child=i,i.name=e.name?e.name:i.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${i.name}".`),i.options=Gn(qi(i,"addOptions",{name:i.name})),i.storage=Gn(qi(i,"addStorage",{name:i.name,options:i.options})),i}}function fne(t,e,i){const{from:n,to:r}=e,{blockSeparator:s=`

`,textSerializers:o={}}=i||{};let a="";return t.nodesBetween(n,r,(l,u,d,p)=>{var v;l.isBlock&&u>n&&(a+=s);const y=o?.[l.type.name];if(y)return d&&(a+=y({node:l,pos:u,parent:d,index:p,range:e})),!1;l.isText&&(a+=(v=l?.text)===null||v===void 0?void 0:v.slice(Math.max(n,u)-u,r-u))}),a}function pne(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,i])=>[e,i.spec.toText]))}const rqe=ja.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Ml({key:new Gh("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:i}=t,{doc:n,selection:r}=e,{ranges:s}=r,o=Math.min(...s.map(d=>d.$from.pos)),a=Math.max(...s.map(d=>d.$to.pos)),l=pne(i);return fne(n,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),sqe=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var i;t.isDestroyed||(e.dom.blur(),(i=window?.getSelection())===null||i===void 0||i.removeAllRanges())}),!0),oqe=(t=!1)=>({commands:e})=>e.setContent("",t),aqe=()=>({state:t,tr:e,dispatch:i})=>{const{selection:n}=e,{ranges:r}=n;return i&&r.forEach(({$from:s,$to:o})=>{t.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:u,mapping:d}=e,p=u.resolve(d.map(l)),v=u.resolve(d.map(l+a.nodeSize)),y=p.blockRange(v);if(!y)return;const w=fx(y);if(a.type.isTextblock){const{defaultType:R}=p.parent.contentMatchAt(p.index());e.setNodeMarkup(y.start,R)}(w||w===0)&&e.lift(y,w)})}),!0},lqe=t=>e=>t(e),cqe=()=>({state:t,dispatch:e})=>ane(t,e),uqe=(t,e)=>({editor:i,tr:n})=>{const{state:r}=i,s=r.doc.slice(t.from,t.to);n.deleteRange(t.from,t.to);const o=n.mapping.map(e);return n.insert(o,s.content),n.setSelection(new Cn(n.doc.resolve(o-1))),!0},hqe=()=>({tr:t,dispatch:e})=>{const{selection:i}=t,n=i.$anchor.node();if(n.content.size>0)return!1;const r=t.selection.$anchor;for(let s=r.depth;s>0;s-=1)if(r.node(s).type===n.type){if(e){const a=r.before(s),l=r.after(s);t.delete(a,l).scrollIntoView()}return!0}return!1},dqe=t=>({tr:e,state:i,dispatch:n})=>{const r=ko(t,i.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===r){if(n){const l=s.before(o),u=s.after(o);e.delete(l,u).scrollIntoView()}return!0}return!1},fqe=t=>({tr:e,dispatch:i})=>{const{from:n,to:r}=t;return i&&e.delete(n,r),!0},pqe=()=>({state:t,dispatch:e})=>vH(t,e),mqe=()=>({commands:t})=>t.keyboardShortcut("Enter"),gqe=()=>({state:t,dispatch:e})=>R6e(t,e);function rR(t,e,i={strict:!0}){const n=Object.keys(e);return n.length?n.every(r=>i.strict?e[r]===t[r]:CH(e[r])?e[r].test(t[r]):e[r]===t[r]):!0}function mne(t,e,i={}){return t.find(n=>n.type===e&&rR(Object.fromEntries(Object.keys(i).map(r=>[r,n.attrs[r]])),i))}function Ij(t,e,i={}){return!!mne(t,e,i)}function SH(t,e,i){var n;if(!t||!e)return;let r=t.parent.childAfter(t.parentOffset);if((!r.node||!r.node.marks.some(d=>d.type===e))&&(r=t.parent.childBefore(t.parentOffset)),!r.node||!r.node.marks.some(d=>d.type===e)||(i=i||((n=r.node.marks[0])===null||n===void 0?void 0:n.attrs),!mne([...r.node.marks],e,i)))return;let o=r.index,a=t.start()+r.offset,l=o+1,u=a+r.node.nodeSize;for(;o>0&&Ij([...t.parent.child(o-1).marks],e,i);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&Ij([...t.parent.child(l).marks],e,i);)u+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:u}}function Gp(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const vqe=(t,e={})=>({tr:i,state:n,dispatch:r})=>{const s=Gp(t,n.schema),{doc:o,selection:a}=i,{$from:l,from:u,to:d}=a;if(r){const p=SH(l,s,e);if(p&&p.from<=u&&p.to>=d){const v=Cn.create(o,p.from,p.to);i.setSelection(v)}}return!0},yqe=t=>e=>{const i=typeof t=="function"?t(e):t;for(let n=0;n<i.length;n+=1)if(i[n](e))return!0;return!1};function gne(t){return t instanceof Cn}function eg(t=0,e=0,i=0){return Math.min(Math.max(t,e),i)}function vne(t,e=null){if(!e)return null;const i=Nn.atStart(t),n=Nn.atEnd(t);if(e==="start"||e===!0)return i;if(e==="end")return n;const r=i.from,s=n.to;return e==="all"?Cn.create(t,eg(0,r,s),eg(t.content.size,r,s)):Cn.create(t,eg(e,r,s),eg(e,r,s))}function yne(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function tL(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const xqe=(t=null,e={})=>({editor:i,view:n,tr:r,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(tL()||yne())&&n.dom.focus(),requestAnimationFrame(()=>{i.isDestroyed||(n.focus(),e?.scrollIntoView&&i.commands.scrollIntoView())})};if(n.hasFocus()&&t===null||t===!1)return!0;if(s&&t===null&&!gne(i.state.selection))return o(),!0;const a=vne(r.doc,t)||i.state.selection,l=i.state.selection.eq(a);return s&&(l||r.setSelection(a),l&&r.storedMarks&&r.setStoredMarks(r.storedMarks),o()),!0},bqe=(t,e)=>i=>t.every((n,r)=>e(n,{...i,index:r})),wqe=(t,e)=>({tr:i,commands:n})=>n.insertContentAt({from:i.selection.from,to:i.selection.to},t,e),xne=t=>{const e=t.childNodes;for(let i=e.length-1;i>=0;i-=1){const n=e[i];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?t.removeChild(n):n.nodeType===1&&xne(n)}return t};function cO(t){const e=`<body>${t}</body>`,i=new window.DOMParser().parseFromString(e,"text/html").body;return xne(i)}function sR(t,e,i){if(t instanceof vp||t instanceof ai)return t;i={slice:!0,parseOptions:{},...i};const n=typeof t=="object"&&t!==null,r=typeof t=="string";if(n)try{if(Array.isArray(t)&&t.length>0)return ai.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return i.errorOnInvalidContent&&o.check(),o}catch(s){if(i.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",s),sR("",e,i)}if(r){if(i.errorOnInvalidContent){let o=!1,a="";const l=new tie({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:u=>(o=!0,a=typeof u=="string"?u:u.outerHTML,null)}]}})});if(i.slice?o_.fromSchema(l).parseSlice(cO(t),i.parseOptions):o_.fromSchema(l).parse(cO(t),i.parseOptions),i.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=o_.fromSchema(e);return i.slice?s.parseSlice(cO(t),i.parseOptions).content:s.parse(cO(t),i.parseOptions)}return sR("",e,i)}function _qe(t,e,i){const n=t.steps.length-1;if(n<e)return;const r=t.steps[n];if(!(r instanceof Po||r instanceof Ao))return;const s=t.mapping.maps[n];let o=0;s.forEach((a,l,u,d)=>{o===0&&(o=d)}),t.setSelection(Nn.near(t.doc.resolve(o),i))}const Cqe=t=>!("type"in t),Sqe=(t,e,i)=>({tr:n,dispatch:r,editor:s})=>{var o;if(r){i={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...i};let a;try{a=sR(e,s.schema,{parseOptions:{preserveWhitespace:"full",...i.parseOptions},errorOnInvalidContent:(o=i.errorOnInvalidContent)!==null&&o!==void 0?o:s.options.enableContentCheck})}catch(w){return s.emit("contentError",{editor:s,error:w,disableCollaboration:()=>{s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}}),!1}let{from:l,to:u}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},d=!0,p=!0;if((Cqe(a)?a:[a]).forEach(w=>{w.check(),d=d?w.isText&&w.marks.length===0:!1,p=p?w.isBlock:!1}),l===u&&p){const{parent:w}=n.doc.resolve(l);w.isTextblock&&!w.type.spec.code&&!w.childCount&&(l-=1,u+=1)}let y;if(d){if(Array.isArray(e))y=e.map(w=>w.text||"").join("");else if(e instanceof ai){let w="";e.forEach(R=>{R.text&&(w+=R.text)}),y=w}else typeof e=="object"&&e&&e.text?y=e.text:y=e;n.insertText(y,l,u)}else y=a,n.replaceWith(l,u,y);i.updateSelection&&_qe(n,n.steps.length-1,-1),i.applyInputRules&&n.setMeta("applyInputRules",{from:l,text:y}),i.applyPasteRules&&n.setMeta("applyPasteRules",{from:l,text:y})}return!0},Oqe=()=>({state:t,dispatch:e})=>O6e(t,e),Mqe=()=>({state:t,dispatch:e})=>M6e(t,e),Tqe=()=>({state:t,dispatch:e})=>ene(t,e),Rqe=()=>({state:t,dispatch:e})=>rne(t,e),Pqe=()=>({state:t,dispatch:e,tr:i})=>{try{const n=$D(t.doc,t.selection.$from.pos,-1);return n==null?!1:(i.join(n,2),e&&e(i),!0)}catch{return!1}},Eqe=()=>({state:t,dispatch:e,tr:i})=>{try{const n=$D(t.doc,t.selection.$from.pos,1);return n==null?!1:(i.join(n,2),e&&e(i),!0)}catch{return!1}},Aqe=()=>({state:t,dispatch:e})=>C6e(t,e),Iqe=()=>({state:t,dispatch:e})=>S6e(t,e);function bne(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function kqe(t){const e=t.split(/-(?!$)/);let i=e[e.length-1];i==="Space"&&(i=" ");let n,r,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))r=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))tL()||bne()?o=!0:r=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(i=`Alt-${i}`),r&&(i=`Ctrl-${i}`),o&&(i=`Meta-${i}`),s&&(i=`Shift-${i}`),i}const Dqe=t=>({editor:e,view:i,tr:n,dispatch:r})=>{const s=kqe(t).split(/-(?!$)/),o=s.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{i.someProp("handleKeyDown",u=>u(i,a))});return l?.steps.forEach(u=>{const d=u.map(n.mapping);d&&r&&n.maybeStep(d)}),!0};function rC(t,e,i={}){const{from:n,to:r,empty:s}=t.selection,o=e?ko(e,t.schema):null,a=[];t.doc.nodesBetween(n,r,(p,v)=>{if(p.isText)return;const y=Math.max(n,v),w=Math.min(r,v+p.nodeSize);a.push({node:p,from:y,to:w})});const l=r-n,u=a.filter(p=>o?o.name===p.node.type.name:!0).filter(p=>rR(p.node.attrs,i,{strict:!1}));return s?!!u.length:u.reduce((p,v)=>p+v.to-v.from,0)>=l}const Lqe=(t,e={})=>({state:i,dispatch:n})=>{const r=ko(t,i.schema);return rC(i,r,e)?T6e(i,n):!1},Fqe=()=>({state:t,dispatch:e})=>lne(t,e),Nqe=t=>({state:e,dispatch:i})=>{const n=ko(t,e.schema);return z6e(n)(e,i)},Bqe=()=>({state:t,dispatch:e})=>one(t,e);function iL(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function kj(t,e){const i=typeof e=="string"?[e]:e;return Object.keys(t).reduce((n,r)=>(i.includes(r)||(n[r]=t[r]),n),{})}const zqe=(t,e)=>({tr:i,state:n,dispatch:r})=>{let s=null,o=null;const a=iL(typeof t=="string"?t:t.name,n.schema);return a?(a==="node"&&(s=ko(t,n.schema)),a==="mark"&&(o=Gp(t,n.schema)),r&&i.selection.ranges.forEach(l=>{n.doc.nodesBetween(l.$from.pos,l.$to.pos,(u,d)=>{s&&s===u.type&&i.setNodeMarkup(d,void 0,kj(u.attrs,e)),o&&u.marks.length&&u.marks.forEach(p=>{o===p.type&&i.addMark(d,d+u.nodeSize,o.create(kj(p.attrs,e)))})})}),!0):!1},Vqe=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),Gqe=()=>({tr:t,dispatch:e})=>{if(e){const i=new ec(t.doc);t.setSelection(i)}return!0},Uqe=()=>({state:t,dispatch:e})=>ine(t,e),Hqe=()=>({state:t,dispatch:e})=>sne(t,e),$qe=()=>({state:t,dispatch:e})=>A6e(t,e),Wqe=()=>({state:t,dispatch:e})=>D6e(t,e),qqe=()=>({state:t,dispatch:e})=>k6e(t,e);function yV(t,e,i={},n={}){return sR(t,e,{slice:!1,parseOptions:i,errorOnInvalidContent:n.errorOnInvalidContent})}const jqe=(t,e=!1,i={},n={})=>({editor:r,tr:s,dispatch:o,commands:a})=>{var l,u;const{doc:d}=s;if(i.preserveWhitespace!=="full"){const p=yV(t,r.schema,i,{errorOnInvalidContent:(l=n.errorOnInvalidContent)!==null&&l!==void 0?l:r.options.enableContentCheck});return o&&s.replaceWith(0,d.content.size,p).setMeta("preventUpdate",!e),!0}return o&&s.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:d.content.size},t,{parseOptions:i,errorOnInvalidContent:(u=n.errorOnInvalidContent)!==null&&u!==void 0?u:r.options.enableContentCheck})};function wne(t,e){const i=Gp(e,t.schema),{from:n,to:r,empty:s}=t.selection,o=[];s?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(n,r,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===i.name);return a?{...a.attrs}:{}}function Qqe(t){for(let e=0;e<t.edgeCount;e+=1){const{type:i}=t.edge(e);if(i.isTextblock&&!i.hasRequiredAttrs())return i}return null}function Zqe(t,e){for(let i=t.depth;i>0;i-=1){const n=t.node(i);if(e(n))return{pos:i>0?t.before(i):0,start:t.start(i),depth:i,node:n}}}function OH(t){return e=>Zqe(e.$from,t)}function Xqe(t,e){const i={from:0,to:t.content.size};return fne(t,i,e)}function Kqe(t,e){const i=ko(e,t.schema),{from:n,to:r}=t.selection,s=[];t.doc.nodesBetween(n,r,a=>{s.push(a)});const o=s.reverse().find(a=>a.type.name===i.name);return o?{...o.attrs}:{}}function Yqe(t,e){const i=iL(typeof e=="string"?e:e.name,t.schema);return i==="node"?Kqe(t,e):i==="mark"?wne(t,e):{}}function _ne(t,e,i){const n=[];return t===e?i.resolve(t).marks().forEach(r=>{const s=i.resolve(t),o=SH(s,r.type);o&&n.push({mark:r,...o})}):i.nodesBetween(t,e,(r,s)=>{!r||r?.nodeSize===void 0||n.push(...r.marks.map(o=>({from:s,to:s+r.nodeSize,mark:o})))}),n}function FM(t,e,i){return Object.fromEntries(Object.entries(i).filter(([n])=>{const r=t.find(s=>s.type===e&&s.name===n);return r?r.attribute.keepOnSplit:!1}))}function xV(t,e,i={}){const{empty:n,ranges:r}=t.selection,s=e?Gp(e,t.schema):null;if(n)return!!(t.storedMarks||t.selection.$from.marks()).filter(p=>s?s.name===p.type.name:!0).find(p=>rR(p.attrs,i,{strict:!1}));let o=0;const a=[];if(r.forEach(({$from:p,$to:v})=>{const y=p.pos,w=v.pos;t.doc.nodesBetween(y,w,(R,O)=>{if(!R.isText&&!R.marks.length)return;const P=Math.max(y,O),N=Math.min(w,O+R.nodeSize),F=N-P;o+=F,a.push(...R.marks.map(k=>({mark:k,from:P,to:N})))})}),o===0)return!1;const l=a.filter(p=>s?s.name===p.mark.type.name:!0).filter(p=>rR(p.mark.attrs,i,{strict:!1})).reduce((p,v)=>p+v.to-v.from,0),u=a.filter(p=>s?p.mark.type!==s&&p.mark.type.excludes(s):!0).reduce((p,v)=>p+v.to-v.from,0);return(l>0?l+u:l)>=o}function Jqe(t,e,i={}){if(!e)return rC(t,null,i)||xV(t,null,i);const n=iL(e,t.schema);return n==="node"?rC(t,e,i):n==="mark"?xV(t,e,i):!1}function Dj(t,e){const{nodeExtensions:i}=YD(e),n=i.find(o=>o.name===t);if(!n)return!1;const r={name:n.name,options:n.options,storage:n.storage},s=Gn(qi(n,"group",r));return typeof s!="string"?!1:s.split(" ").includes("list")}function MH(t,{checkChildren:e=!0,ignoreWhitespace:i=!1}={}){var n;if(i){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((n=t.text)!==null&&n!==void 0?n:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let r=!0;return t.content.forEach(s=>{r!==!1&&(MH(s,{ignoreWhitespace:i,checkChildren:e})||(r=!1))}),r}return!1}function eje(t){return t instanceof cn}function tje(t,e,i){var n;const{selection:r}=e;let s=null;if(gne(r)&&(s=r.$cursor),s){const a=(n=t.storedMarks)!==null&&n!==void 0?n:s.marks();return!!i.isInSet(a)||!a.some(l=>l.type.excludes(i))}const{ranges:o}=r;return o.some(({$from:a,$to:l})=>{let u=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(i):!1;return t.doc.nodesBetween(a.pos,l.pos,(d,p,v)=>{if(u)return!1;if(d.isInline){const y=!v||v.type.allowsMarkType(i),w=!!i.isInSet(d.marks)||!d.marks.some(R=>R.type.excludes(i));u=y&&w}return!u}),u})}const ije=(t,e={})=>({tr:i,state:n,dispatch:r})=>{const{selection:s}=i,{empty:o,ranges:a}=s,l=Gp(t,n.schema);if(r)if(o){const u=wne(n,l);i.addStoredMark(l.create({...u,...e}))}else a.forEach(u=>{const d=u.$from.pos,p=u.$to.pos;n.doc.nodesBetween(d,p,(v,y)=>{const w=Math.max(y,d),R=Math.min(y+v.nodeSize,p);v.marks.find(P=>P.type===l)?v.marks.forEach(P=>{l===P.type&&i.addMark(w,R,l.create({...P.attrs,...e}))}):i.addMark(w,R,l.create(e))})});return tje(n,i,l)},nje=(t,e)=>({tr:i})=>(i.setMeta(t,e),!0),rje=(t,e={})=>({state:i,dispatch:n,chain:r})=>{const s=ko(t,i.schema);let o;return i.selection.$anchor.sameParent(i.selection.$head)&&(o=i.selection.$anchor.parent.attrs),s.isTextblock?r().command(({commands:a})=>Rj(s,{...o,...e})(i)?!0:a.clearNodes()).command(({state:a})=>Rj(s,{...o,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},sje=t=>({tr:e,dispatch:i})=>{if(i){const{doc:n}=e,r=eg(t,0,n.content.size),s=cn.create(n,r);e.setSelection(s)}return!0},oje=t=>({tr:e,dispatch:i})=>{if(i){const{doc:n}=e,{from:r,to:s}=typeof t=="number"?{from:t,to:t}:t,o=Cn.atStart(n).from,a=Cn.atEnd(n).to,l=eg(r,o,a),u=eg(s,o,a),d=Cn.create(n,l,u);e.setSelection(d)}return!0},aje=t=>({state:e,dispatch:i})=>{const n=ko(t,e.schema);return U6e(n)(e,i)};function Lj(t,e){const i=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(i){const n=i.filter(r=>e?.includes(r.type.name));t.tr.ensureMarks(n)}}const lje=({keepMarks:t=!0}={})=>({tr:e,state:i,dispatch:n,editor:r})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,u=r.extensionManager.attributes,d=FM(u,a.node().type.name,a.node().attrs);if(s instanceof cn&&s.node.isBlock)return!a.parentOffset||!kd(o,a.pos)?!1:(n&&(t&&Lj(i,r.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const p=l.parentOffset===l.parent.content.size,v=a.depth===0?void 0:Qqe(a.node(-1).contentMatchAt(a.indexAfter(-1)));let y=p&&v?[{type:v,attrs:d}]:void 0,w=kd(e.doc,e.mapping.map(a.pos),1,y);if(!y&&!w&&kd(e.doc,e.mapping.map(a.pos),1,v?[{type:v}]:void 0)&&(w=!0,y=v?[{type:v,attrs:d}]:void 0),n){if(w&&(s instanceof Cn&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,y),v&&!p&&!a.parentOffset&&a.parent.type!==v)){const R=e.mapping.map(a.before()),O=e.doc.resolve(R);a.node(-1).canReplaceWith(O.index(),O.index()+1,v)&&e.setNodeMarkup(e.mapping.map(a.before()),v)}t&&Lj(i,r.extensionManager.splittableMarks),e.scrollIntoView()}return w},cje=(t,e={})=>({tr:i,state:n,dispatch:r,editor:s})=>{var o;const a=ko(t,n.schema),{$from:l,$to:u}=n.selection,d=n.selection.node;if(d&&d.isBlock||l.depth<2||!l.sameParent(u))return!1;const p=l.node(-1);if(p.type!==a)return!1;const v=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(r){let P=ai.empty;const N=l.index(-1)?1:l.index(-2)?2:3;for(let Y=l.depth-N;Y>=l.depth-3;Y-=1)P=ai.from(l.node(Y).copy(P));const F=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,k={...FM(v,l.node().type.name,l.node().attrs),...e},$=((o=a.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(k))||void 0;P=P.append(ai.from(a.createAndFill(null,$)||void 0));const W=l.before(l.depth-(N-1));i.replace(W,l.after(-F),new Ii(P,4-N,0));let Q=-1;i.doc.nodesBetween(W,i.doc.content.size,(Y,M)=>{if(Q>-1)return!1;Y.isTextblock&&Y.content.size===0&&(Q=M+1)}),Q>-1&&i.setSelection(Cn.near(i.doc.resolve(Q))),i.scrollIntoView()}return!0}const y=u.pos===l.end()?p.contentMatchAt(0).defaultType:null,w={...FM(v,p.type.name,p.attrs),...e},R={...FM(v,l.node().type.name,l.node().attrs),...e};i.delete(l.pos,u.pos);const O=y?[{type:a,attrs:w},{type:y,attrs:R}]:[{type:a,attrs:w}];if(!kd(i.doc,l.pos,2))return!1;if(r){const{selection:P,storedMarks:N}=n,{splittableMarks:F}=s.extensionManager,k=N||P.$to.parentOffset&&P.$from.marks();if(i.split(l.pos,2,O).scrollIntoView(),!k||!r)return!0;const $=k.filter(W=>F.includes(W.type.name));i.ensureMarks($)}return!0},YN=(t,e)=>{const i=OH(o=>o.type===e)(t.selection);if(!i)return!0;const n=t.doc.resolve(Math.max(0,i.pos-1)).before(i.depth);if(n===void 0)return!0;const r=t.doc.nodeAt(n);return i.node.type===r?.type&&zp(t.doc,i.pos)&&t.join(i.pos),!0},JN=(t,e)=>{const i=OH(o=>o.type===e)(t.selection);if(!i)return!0;const n=t.doc.resolve(i.start).after(i.depth);if(n===void 0)return!0;const r=t.doc.nodeAt(n);return i.node.type===r?.type&&zp(t.doc,n)&&t.join(n),!0},uje=(t,e,i,n={})=>({editor:r,tr:s,state:o,dispatch:a,chain:l,commands:u,can:d})=>{const{extensions:p,splittableMarks:v}=r.extensionManager,y=ko(t,o.schema),w=ko(e,o.schema),{selection:R,storedMarks:O}=o,{$from:P,$to:N}=R,F=P.blockRange(N),k=O||R.$to.parentOffset&&R.$from.marks();if(!F)return!1;const $=OH(W=>Dj(W.type.name,p))(R);if(F.depth>=1&&$&&F.depth-$.depth<=1){if($.node.type===y)return u.liftListItem(w);if(Dj($.node.type.name,p)&&y.validContent($.node.content)&&a)return l().command(()=>(s.setNodeMarkup($.pos,y),!0)).command(()=>YN(s,y)).command(()=>JN(s,y)).run()}return!i||!k||!a?l().command(()=>d().wrapInList(y,n)?!0:u.clearNodes()).wrapInList(y,n).command(()=>YN(s,y)).command(()=>JN(s,y)).run():l().command(()=>{const W=d().wrapInList(y,n),Q=k.filter(Y=>v.includes(Y.type.name));return s.ensureMarks(Q),W?!0:u.clearNodes()}).wrapInList(y,n).command(()=>YN(s,y)).command(()=>JN(s,y)).run()},hje=(t,e={},i={})=>({state:n,commands:r})=>{const{extendEmptyMarkRange:s=!1}=i,o=Gp(t,n.schema);return xV(n,o,e)?r.unsetMark(o,{extendEmptyMarkRange:s}):r.setMark(o,e)},dje=(t,e,i={})=>({state:n,commands:r})=>{const s=ko(t,n.schema),o=ko(e,n.schema),a=rC(n,s,i);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?r.setNode(o,l):r.setNode(s,{...l,...i})},fje=(t,e={})=>({state:i,commands:n})=>{const r=ko(t,i.schema);return rC(i,r,e)?n.lift(r):n.wrapIn(r,e)},pje=()=>({state:t,dispatch:e})=>{const i=t.plugins;for(let n=0;n<i.length;n+=1){const r=i[n];let s;if(r.spec.isInputRules&&(s=r.getState(t))){if(e){const o=t.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,t.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},mje=()=>({tr:t,dispatch:e})=>{const{selection:i}=t,{empty:n,ranges:r}=i;return n||e&&r.forEach(s=>{t.removeMark(s.$from.pos,s.$to.pos)}),!0},gje=(t,e={})=>({tr:i,state:n,dispatch:r})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=i,l=Gp(t,n.schema),{$from:u,empty:d,ranges:p}=a;if(!r)return!0;if(d&&o){let{from:v,to:y}=a;const w=(s=u.marks().find(O=>O.type===l))===null||s===void 0?void 0:s.attrs,R=SH(u,l,w);R&&(v=R.from,y=R.to),i.removeMark(v,y,l)}else p.forEach(v=>{i.removeMark(v.$from.pos,v.$to.pos,l)});return i.removeStoredMark(l),!0},vje=(t,e={})=>({tr:i,state:n,dispatch:r})=>{let s=null,o=null;const a=iL(typeof t=="string"?t:t.name,n.schema);return a?(a==="node"&&(s=ko(t,n.schema)),a==="mark"&&(o=Gp(t,n.schema)),r&&i.selection.ranges.forEach(l=>{const u=l.$from.pos,d=l.$to.pos;let p,v,y,w;i.selection.empty?n.doc.nodesBetween(u,d,(R,O)=>{s&&s===R.type&&(y=Math.max(O,u),w=Math.min(O+R.nodeSize,d),p=O,v=R)}):n.doc.nodesBetween(u,d,(R,O)=>{O<u&&s&&s===R.type&&(y=Math.max(O,u),w=Math.min(O+R.nodeSize,d),p=O,v=R),O>=u&&O<=d&&(s&&s===R.type&&i.setNodeMarkup(O,void 0,{...R.attrs,...e}),o&&R.marks.length&&R.marks.forEach(P=>{if(o===P.type){const N=Math.max(O,u),F=Math.min(O+R.nodeSize,d);i.addMark(N,F,o.create({...P.attrs,...e}))}}))}),v&&(p!==void 0&&i.setNodeMarkup(p,void 0,{...v.attrs,...e}),o&&v.marks.length&&v.marks.forEach(R=>{o===R.type&&i.addMark(y,w,o.create({...R.attrs,...e}))}))}),!0):!1},yje=(t,e={})=>({state:i,dispatch:n})=>{const r=ko(t,i.schema);return L6e(r,e)(i,n)},xje=(t,e={})=>({state:i,dispatch:n})=>{const r=ko(t,i.schema);return F6e(r,e)(i,n)};var bje=Object.freeze({__proto__:null,blur:sqe,clearContent:oqe,clearNodes:aqe,command:lqe,createParagraphNear:cqe,cut:uqe,deleteCurrentNode:hqe,deleteNode:dqe,deleteRange:fqe,deleteSelection:pqe,enter:mqe,exitCode:gqe,extendMarkRange:vqe,first:yqe,focus:xqe,forEach:bqe,insertContent:wqe,insertContentAt:Sqe,joinBackward:Tqe,joinDown:Mqe,joinForward:Rqe,joinItemBackward:Pqe,joinItemForward:Eqe,joinTextblockBackward:Aqe,joinTextblockForward:Iqe,joinUp:Oqe,keyboardShortcut:Dqe,lift:Lqe,liftEmptyBlock:Fqe,liftListItem:Nqe,newlineInCode:Bqe,resetAttributes:zqe,scrollIntoView:Vqe,selectAll:Gqe,selectNodeBackward:Uqe,selectNodeForward:Hqe,selectParentNode:$qe,selectTextblockEnd:Wqe,selectTextblockStart:qqe,setContent:jqe,setMark:ije,setMeta:nje,setNode:rje,setNodeSelection:sje,setTextSelection:oje,sinkListItem:aje,splitBlock:lje,splitListItem:cje,toggleList:uje,toggleMark:hje,toggleNode:dje,toggleWrap:fje,undoInputRule:pje,unsetAllMarks:mje,unsetMark:gje,updateAttributes:vje,wrapIn:yje,wrapInList:xje});const wje=ja.create({name:"commands",addCommands(){return{...bje}}}),_je=ja.create({name:"drop",addProseMirrorPlugins(){return[new Ml({key:new Gh("tiptapDrop"),props:{handleDrop:(t,e,i,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:i,moved:n})}}})]}}),Cje=ja.create({name:"editable",addProseMirrorPlugins(){return[new Ml({key:new Gh("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Sje=ja.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Ml({key:new Gh("focusEvents"),props:{handleDOMEvents:{focus:(e,i)=>{t.isFocused=!0;const n=t.state.tr.setMeta("focus",{event:i}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,i)=>{t.isFocused=!1;const n=t.state.tr.setMeta("blur",{event:i}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),Oje=ja.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:u}=a,{empty:d,$anchor:p}=l,{pos:v,parent:y}=p,w=p.parent.isTextblock&&v>0?a.doc.resolve(v-1):p,R=w.parent.type.spec.isolating,O=p.pos-p.parentOffset,P=R&&w.parent.childCount===1?O===p.pos:Nn.atStart(u).from===v;return!d||!y.type.isTextblock||y.textContent.length||!P||P&&p.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},r={...n},s={...n,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return tL()||bne()?s:r},addProseMirrorPlugins(){return[new Ml({key:new Gh("clearDocument"),appendTransaction:(t,e,i)=>{if(t.some(R=>R.getMeta("composition")))return;const n=t.some(R=>R.docChanged)&&!e.doc.eq(i.doc),r=t.some(R=>R.getMeta("preventClearDocument"));if(!n||r)return;const{empty:s,from:o,to:a}=e.selection,l=Nn.atStart(e.doc).from,u=Nn.atEnd(e.doc).to;if(s||!(o===l&&a===u)||!MH(i.doc))return;const v=i.tr,y=XD({state:i,transaction:v}),{commands:w}=new KD({editor:this.editor,state:y});if(w.clearNodes(),!!v.steps.length)return v}})]}}),Mje=ja.create({name:"paste",addProseMirrorPlugins(){return[new Ml({key:new Gh("tiptapPaste"),props:{handlePaste:(t,e,i)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:i})}}})]}}),Tje=ja.create({name:"tabindex",addProseMirrorPlugins(){return[new Ml({key:new Gh("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class Qm{get name(){return this.node.type.name}constructor(e,i,n=!1,r=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=i,this.currentNode=r}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let i=this.from,n=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You canât set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}i=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:i,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),i=this.resolvedPos.doc.resolve(e);return new Qm(i,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Qm(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Qm(e,this.editor)}get children(){const e=[];return this.node.content.forEach((i,n)=>{const r=i.isBlock&&!i.isTextblock,s=i.isAtom&&!i.isText,o=this.pos+n+(s?0:1),a=this.resolvedPos.doc.resolve(o);if(!r&&a.depth<=this.depth)return;const l=new Qm(a,this.editor,r,r?i:null);r&&(l.actualDepth=this.depth+1),e.push(new Qm(a,this.editor,r,r?i:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,i={}){let n=null,r=this.parent;for(;r&&!n;){if(r.node.type.name===e)if(Object.keys(i).length>0){const s=r.node.attrs,o=Object.keys(i);for(let a=0;a<o.length;a+=1){const l=o[a];if(s[l]!==i[l])break}}else n=r;r=r.parent}return n}querySelector(e,i={}){return this.querySelectorAll(e,i,!0)[0]||null}querySelectorAll(e,i={},n=!1){let r=[];if(!this.children||this.children.length===0)return r;const s=Object.keys(i);return this.children.forEach(o=>{n&&r.length>0||(o.node.type.name===e&&s.every(l=>i[l]===o.node.attrs[l])&&r.push(o),!(n&&r.length>0)&&(r=r.concat(o.querySelectorAll(e,i,n))))}),r}setAttribute(e){const{tr:i}=this.editor.state;i.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(i)}}const Rje=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function Pje(t,e,i){const n=document.querySelector("style[data-tiptap-style]");if(n!==null)return n;const r=document.createElement("style");return e&&r.setAttribute("nonce",e),r.setAttribute("data-tiptap-style",""),r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r),r}let Eje=class extends H6e{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:i})=>{throw i},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:i,slice:n,moved:r})=>this.options.onDrop(i,n,r)),this.on("paste",({event:i,slice:n})=>this.options.onPaste(i,n)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=Pje(Rje,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,i=!0){this.setOptions({editable:e}),i&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,i){const n=dne(i)?i(e,[...this.state.plugins]):[...this.state.plugins,e],r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}unregisterPlugin(e){if(this.isDestroyed)return;const i=this.state.plugins;let n=i;if([].concat(e).forEach(s=>{const o=typeof s=="string"?`${s}$`:s.key;n=i.filter(a=>!a.key.startsWith(o))}),i.length===n.length)return;const r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}createExtensionManager(){var e,i;const r=[...this.options.enableCoreExtensions?[Cje,rqe.configure({blockSeparator:(i=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||i===void 0?void 0:i.blockSeparator}),wje,Sje,Oje,Tje,_je,Mje].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s?.type));this.extensionManager=new Hy(r,this)}createCommandManager(){this.commandManager=new KD({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let i;try{i=yV(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),i=yV(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const n=vne(i,this.options.autofocus);this.view=new g6e(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:Uy.create({doc:i,selection:n||void 0})});const r=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(r),this.createNodeViews(),this.prependClass();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const i=this.capturedTransaction;return this.capturedTransaction=null,i}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const i=this.state.apply(e),n=!this.state.selection.eq(i.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:i}),this.view.updateState(i),this.emit("transaction",{editor:this,transaction:e}),n&&this.emit("selectionUpdate",{editor:this,transaction:e});const r=e.getMeta("focus"),s=e.getMeta("blur");r&&this.emit("focus",{editor:this,event:r.event,transaction:e}),s&&this.emit("blur",{editor:this,event:s.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return Yqe(this.state,e)}isActive(e,i){const n=typeof e=="string"?e:null,r=typeof e=="string"?i:e;return Jqe(this.state,n,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return _H(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:i=`

`,textSerializers:n={}}=e||{};return Xqe(this.state.doc,{blockSeparator:i,textSerializers:{...pne(this.schema),...n}})}get isEmpty(){return MH(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,i){var n;return((n=this.$doc)===null||n===void 0?void 0:n.querySelector(e,i))||null}$nodes(e,i){var n;return((n=this.$doc)===null||n===void 0?void 0:n.querySelectorAll(e,i))||null}$pos(e){const i=this.state.doc.resolve(e);return new Qm(i,this)}get $doc(){return this.$pos(0)}};function F0(t){return new JD({find:t.find,handler:({state:e,range:i,match:n})=>{const r=Gn(t.getAttributes,void 0,n);if(r===!1||r===null)return null;const{tr:s}=e,o=n[n.length-1],a=n[0];if(o){const l=a.search(/\S/),u=i.from+a.indexOf(o),d=u+o.length;if(_ne(i.from,i.to,e.doc).filter(y=>y.mark.type.excluded.find(R=>R===t.type&&R!==y.mark.type)).filter(y=>y.to>u).length)return null;d<i.to&&s.delete(d,i.to),u>i.from&&s.delete(i.from+l,u);const v=i.from+l+o.length;s.addMark(i.from+l,v,t.type.create(r||{})),s.removeStoredMark(t.type)}}})}function Cne(t){return new JD({find:t.find,handler:({state:e,range:i,match:n})=>{const r=Gn(t.getAttributes,void 0,n)||{},{tr:s}=e,o=i.from;let a=i.to;const l=t.type.create(r);if(n[1]){const u=n[0].lastIndexOf(n[1]);let d=o+u;d>a?d=a:a=d+n[1].length;const p=n[0][n[0].length-1];s.insertText(p,o+n[0].length-1),s.replaceWith(d,a,l)}else if(n[0]){const u=t.type.isInline?o:o-1;s.insert(u,t.type.create(r)).delete(s.mapping.map(o),s.mapping.map(a))}s.scrollIntoView()}})}function bV(t){return new JD({find:t.find,handler:({state:e,range:i,match:n})=>{const r=e.doc.resolve(i.from),s=Gn(t.getAttributes,void 0,n)||{};if(!r.node(-1).canReplaceWith(r.index(-1),r.indexAfter(-1),t.type))return null;e.tr.delete(i.from,i.to).setBlockType(i.from,i.from,t.type,s)}})}function sC(t){return new JD({find:t.find,handler:({state:e,range:i,match:n,chain:r})=>{const s=Gn(t.getAttributes,void 0,n)||{},o=e.tr.delete(i.from,i.to),l=o.doc.resolve(i.from).blockRange(),u=l&&oH(l,t.type,s);if(!u)return null;if(o.wrap(l,u),t.keepMarks&&t.editor){const{selection:p,storedMarks:v}=e,{splittableMarks:y}=t.editor.extensionManager,w=v||p.$to.parentOffset&&p.$from.marks();if(w){const R=w.filter(O=>y.includes(O.type.name));o.ensureMarks(R)}}if(t.keepAttributes){const p=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";r().updateAttributes(p,s).run()}const d=o.doc.resolve(i.from-1).nodeBefore;d&&d.type===t.type&&zp(o.doc,i.from-1)&&(!t.joinPredicate||t.joinPredicate(n,d))&&o.join(i.from-1)}})}let Za=class wV{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Gn(qi(this,"addOptions",{name:this.name}))),this.storage=Gn(qi(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new wV(e)}configure(e={}){const i=this.extend({...this.config,addOptions:()=>eL(this.options,e)});return i.name=this.name,i.parent=this.parent,i}extend(e={}){const i=new wV(e);return i.parent=this,this.child=i,i.name=e.name?e.name:i.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${i.name}".`),i.options=Gn(qi(i,"addOptions",{name:i.name})),i.storage=Gn(qi(i,"addStorage",{name:i.name,options:i.options})),i}};class Aje{constructor(e,i,n){this.isDragging=!1,this.component=e,this.editor=i.editor,this.options={stopEvent:null,ignoreMutation:null,...n},this.extension=i.extension,this.node=i.node,this.decorations=i.decorations,this.innerDecorations=i.innerDecorations,this.view=i.view,this.HTMLAttributes=i.HTMLAttributes,this.getPos=i.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(e){var i,n,r,s,o,a,l;const{view:u}=this.editor,d=e.target,p=d.nodeType===3?(i=d.parentElement)===null||i===void 0?void 0:i.closest("[data-drag-handle]"):d.closest("[data-drag-handle]");if(!this.dom||!((n=this.contentDOM)===null||n===void 0)&&n.contains(d)||!p)return;let v=0,y=0;if(this.dom!==p){const P=this.dom.getBoundingClientRect(),N=p.getBoundingClientRect(),F=(r=e.offsetX)!==null&&r!==void 0?r:(s=e.nativeEvent)===null||s===void 0?void 0:s.offsetX,k=(o=e.offsetY)!==null&&o!==void 0?o:(a=e.nativeEvent)===null||a===void 0?void 0:a.offsetY;v=N.x-P.x+F,y=N.y-P.y+k}(l=e.dataTransfer)===null||l===void 0||l.setDragImage(this.dom,v,y);const w=this.getPos();if(typeof w!="number")return;const R=cn.create(u.state.doc,w),O=u.state.tr.setSelection(R);u.dispatch(O)}stopEvent(e){var i;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:e});const n=e.target;if(!(this.dom.contains(n)&&!(!((i=this.contentDOM)===null||i===void 0)&&i.contains(n))))return!1;const s=e.type.startsWith("drag"),o=e.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(n.tagName)||n.isContentEditable)&&!o&&!s)return!0;const{isEditable:l}=this.editor,{isDragging:u}=this,d=!!this.node.type.spec.draggable,p=cn.isSelectable(this.node),v=e.type==="copy",y=e.type==="paste",w=e.type==="cut",R=e.type==="mousedown";if(!d&&p&&s&&e.target===this.dom&&e.preventDefault(),d&&s&&!u&&e.target===this.dom)return e.preventDefault(),!1;if(d&&l&&!u&&R){const O=n.closest("[data-drag-handle]");O&&(this.dom===O||this.dom.contains(O))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(u||o||v||y||w||R&&p)}ignoreMutation(e){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:e}):this.node.isLeaf||this.node.isAtom?!0:e.type==="selection"||this.dom.contains(e.target)&&e.type==="childList"&&(tL()||yne())&&this.editor.isFocused&&[...Array.from(e.addedNodes),...Array.from(e.removedNodes)].every(n=>n.isContentEditable)?!1:this.contentDOM===e.target&&e.type==="attributes"?!0:!this.contentDOM.contains(e.target)}updateAttributes(e){this.editor.commands.command(({tr:i})=>{const n=this.getPos();return typeof n!="number"?!1:(i.setNodeMarkup(n,void 0,{...this.node.attrs,...e}),!0)})}deleteNode(){const e=this.getPos();if(typeof e!="number")return;const i=e+this.node.nodeSize;this.editor.commands.deleteRange({from:e,to:i})}}function N0(t){return new Y6e({find:t.find,handler:({state:e,range:i,match:n,pasteEvent:r})=>{const s=Gn(t.getAttributes,void 0,n,r);if(s===!1||s===null)return null;const{tr:o}=e,a=n[n.length-1],l=n[0];let u=i.to;if(a){const d=l.search(/\S/),p=i.from+l.indexOf(a),v=p+a.length;if(_ne(i.from,i.to,e.doc).filter(w=>w.mark.type.excluded.find(O=>O===t.type&&O!==w.mark.type)).filter(w=>w.to>p).length)return null;v<i.to&&o.delete(v,i.to),p>i.from&&o.delete(i.from+d,p),u=i.from+d+a.length,o.addMark(i.from+d,u,t.type.create(s||{})),o.removeStoredMark(t.type)}}})}const Ije=/^\s*>\s$/,kje=Za.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",go(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[sC({find:Ije,type:this.type})]}}),Dje=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Lje=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Fje=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Nje=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Bje=Pp.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",go(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[F0({find:Dje,type:this.type}),F0({find:Fje,type:this.type})]},addPasteRules(){return[N0({find:Lje,type:this.type}),N0({find:Nje,type:this.type})]}}),zje="listItem",Fj="textStyle",Nj=/^\s*([-+*])\s$/,Vje=Za.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",go(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(zje,this.editor.getAttributes(Fj)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=sC({find:Nj,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=sC({find:Nj,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Fj),editor:this.editor})),[t]}}),Gje=/(^|[^`])`([^`]+)`(?!`)/,Uje=/(^|[^`])`([^`]+)`(?!`)/g,Hje=Pp.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",go(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[F0({find:Gje,type:this.type})]},addPasteRules(){return[N0({find:Uje,type:this.type})]}}),$je=/^```([a-z]+)?[\s\n]$/,Wje=/^~~~([a-z]+)?[\s\n]$/,qje=Za.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:i}=this.options,s=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(i)).map(o=>o.replace(i,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",go(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,i=e.pos===1;return!t||e.parent.type.name!==this.name?!1:i||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:i}=e,{$from:n,empty:r}=i;if(!r||n.parent.type!==this.type)return!1;const s=n.parentOffset===n.parent.nodeSize-2,o=n.parent.textContent.endsWith(`

`);return!s||!o?!1:t.chain().command(({tr:a})=>(a.delete(n.pos-2,n.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:i,doc:n}=e,{$from:r,empty:s}=i;if(!s||r.parent.type!==this.type||!(r.parentOffset===r.parent.nodeSize-2))return!1;const a=r.after();return a===void 0?!1:n.nodeAt(a)?t.commands.command(({tr:u})=>(u.setSelection(Nn.near(n.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[bV({find:$je,type:this.type,getAttributes:t=>({language:t[1]})}),bV({find:Wje,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Ml({key:new Gh("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const i=e.clipboardData.getData("text/plain"),n=e.clipboardData.getData("vscode-editor-data"),r=n?JSON.parse(n):void 0,s=r?.mode;if(!i||!s)return!1;const{tr:o,schema:a}=t.state,l=a.text(i.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:s},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(Cn.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),jje=Za.create({name:"doc",topNode:!0,content:"block+"});function Qje(t={}){return new Ml({view(e){return new Zje(e,t)}})}class Zje{constructor(e,i){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(n=i.width)!==null&&n!==void 0?n:1,this.color=i.color===!1?void 0:i.color||"black",this.class=i.class,this.handlers=["dragover","dragend","drop","dragleave"].map(r=>{let s=o=>{this[r](o)};return e.dom.addEventListener(r,s),{name:r,handler:s}})}destroy(){this.handlers.forEach(({name:e,handler:i})=>this.editorView.dom.removeEventListener(e,i))}update(e,i){this.cursorPos!=null&&i.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),i=!e.parent.inlineContent,n;if(i){let a=e.nodeBefore,l=e.nodeAfter;if(a||l){let u=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0));if(u){let d=u.getBoundingClientRect(),p=a?d.bottom:d.top;a&&l&&(p=(p+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),n={left:d.left,right:d.right,top:p-this.width/2,bottom:p+this.width/2}}}}if(!n){let a=this.editorView.coordsAtPos(this.cursorPos);n={left:a.left-this.width/2,right:a.left+this.width/2,top:a.top,bottom:a.bottom}}let r=this.editorView.dom.offsetParent;this.element||(this.element=r.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",i),this.element.classList.toggle("prosemirror-dropcursor-inline",!i);let s,o;if(!r||r==document.body&&getComputedStyle(r).position=="static")s=-pageXOffset,o=-pageYOffset;else{let a=r.getBoundingClientRect();s=a.left-r.scrollLeft,o=a.top-r.scrollTop}this.element.style.left=n.left-s+"px",this.element.style.top=n.top-o+"px",this.element.style.width=n.right-n.left+"px",this.element.style.height=n.bottom-n.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let i=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=i&&i.inside>=0&&this.editorView.state.doc.nodeAt(i.inside),r=n&&n.type.spec.disableDropCursor,s=typeof r=="function"?r(this.editorView,i,e):r;if(i&&!s){let o=i.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=die(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}}const Xje=ja.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Qje(this.options)]}});class Ts extends Nn{constructor(e){super(e,e)}map(e,i){let n=e.resolve(i.map(this.head));return Ts.valid(n)?new Ts(n):Nn.near(n)}content(){return Ii.empty}eq(e){return e instanceof Ts&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,i){if(typeof i.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Ts(e.resolve(i.pos))}getBookmark(){return new TH(this.anchor)}static valid(e){let i=e.parent;if(i.isTextblock||!Kje(e)||!Yje(e))return!1;let n=i.type.spec.allowGapCursor;if(n!=null)return n;let r=i.contentMatchAt(e.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(e,i,n=!1){e:for(;;){if(!n&&Ts.valid(e))return e;let r=e.pos,s=null;for(let o=e.depth;;o--){let a=e.node(o);if(i>0?e.indexAfter(o)<a.childCount:e.index(o)>0){s=a.child(i>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;r+=i;let l=e.doc.resolve(r);if(Ts.valid(l))return l}for(;;){let o=i>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!cn.isSelectable(s)){e=e.doc.resolve(r+s.nodeSize*i),n=!1;continue e}break}s=o,r+=i;let a=e.doc.resolve(r);if(Ts.valid(a))return a}return null}}}Ts.prototype.visible=!1;Ts.findFrom=Ts.findGapCursorFrom;Nn.jsonID("gapcursor",Ts);class TH{constructor(e){this.pos=e}map(e){return new TH(e.map(this.pos))}resolve(e){let i=e.resolve(this.pos);return Ts.valid(i)?new Ts(i):Nn.near(i)}}function Kje(t){for(let e=t.depth;e>=0;e--){let i=t.index(e),n=t.node(e);if(i==0){if(n.type.spec.isolating)return!0;continue}for(let r=n.child(i-1);;r=r.lastChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function Yje(t){for(let e=t.depth;e>=0;e--){let i=t.indexAfter(e),n=t.node(e);if(i==n.childCount){if(n.type.spec.isolating)return!0;continue}for(let r=n.child(i);;r=r.firstChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function Jje(){return new Ml({props:{decorations:n9e,createSelectionBetween(t,e,i){return e.pos==i.pos&&Ts.valid(i)?new Ts(i):null},handleClick:t9e,handleKeyDown:e9e,handleDOMEvents:{beforeinput:i9e}}})}const e9e=Yie({ArrowLeft:uO("horiz",-1),ArrowRight:uO("horiz",1),ArrowUp:uO("vert",-1),ArrowDown:uO("vert",1)});function uO(t,e){const i=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(n,r,s){let o=n.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof Cn){if(!s.endOfTextblock(i)||a.depth==0)return!1;l=!1,a=n.doc.resolve(e>0?a.after():a.before())}let u=Ts.findGapCursorFrom(a,e,l);return u?(r&&r(n.tr.setSelection(new Ts(u))),!0):!1}}function t9e(t,e,i){if(!t||!t.editable)return!1;let n=t.state.doc.resolve(e);if(!Ts.valid(n))return!1;let r=t.posAtCoords({left:i.clientX,top:i.clientY});return r&&r.inside>-1&&cn.isSelectable(t.state.doc.nodeAt(r.inside))?!1:(t.dispatch(t.state.tr.setSelection(new Ts(n))),!0)}function i9e(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof Ts))return!1;let{$from:i}=t.state.selection,n=i.parent.contentMatchAt(i.index()).findWrapping(t.state.schema.nodes.text);if(!n)return!1;let r=ai.empty;for(let o=n.length-1;o>=0;o--)r=ai.from(n[o].createAndFill(null,r));let s=t.state.tr.replace(i.pos,i.pos,new Ii(r,0,0));return s.setSelection(Cn.near(s.doc.resolve(i.pos+1))),t.dispatch(s),!1}function n9e(t){if(!(t.selection instanceof Ts))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",lo.create(t.doc,[Lc.widget(t.selection.head,e,{key:"gapcursor"})])}const r9e=ja.create({name:"gapCursor",addProseMirrorPlugins(){return[Jje()]},extendNodeSchema(t){var e;const i={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=Gn(qi(t,"allowGapCursor",i)))!==null&&e!==void 0?e:null}}}),s9e=Za.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",go(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:i,editor:n})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:r,storedMarks:s}=i;if(r.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=n.extensionManager,l=s||r.$to.parentOffset&&r.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:d})=>{if(d&&l&&o){const p=l.filter(v=>a.includes(v.type.name));u.ensureMarks(p)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),o9e=Za.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,go(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>bV({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var oR=200,Io=function(){};Io.prototype.append=function(e){return e.length?(e=Io.from(e),!this.length&&e||e.length<oR&&this.leafAppend(e)||this.length<oR&&e.leafPrepend(this)||this.appendInner(e)):this};Io.prototype.prepend=function(e){return e.length?Io.from(e).append(this):this};Io.prototype.appendInner=function(e){return new a9e(this,e)};Io.prototype.slice=function(e,i){return e===void 0&&(e=0),i===void 0&&(i=this.length),e>=i?Io.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,i))};Io.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Io.prototype.forEach=function(e,i,n){i===void 0&&(i=0),n===void 0&&(n=this.length),i<=n?this.forEachInner(e,i,n,0):this.forEachInvertedInner(e,i,n,0)};Io.prototype.map=function(e,i,n){i===void 0&&(i=0),n===void 0&&(n=this.length);var r=[];return this.forEach(function(s,o){return r.push(e(s,o))},i,n),r};Io.from=function(e){return e instanceof Io?e:e&&e.length?new Sne(e):Io.empty};var Sne=function(t){function e(n){t.call(this),this.values=n}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(r,s){return r==0&&s==this.length?this:new e(this.values.slice(r,s))},e.prototype.getInner=function(r){return this.values[r]},e.prototype.forEachInner=function(r,s,o,a){for(var l=s;l<o;l++)if(r(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,o,a){for(var l=s-1;l>=o;l--)if(r(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(r){if(this.length+r.length<=oR)return new e(this.values.concat(r.flatten()))},e.prototype.leafPrepend=function(r){if(this.length+r.length<=oR)return new e(r.flatten().concat(this.values))},i.length.get=function(){return this.values.length},i.depth.get=function(){return 0},Object.defineProperties(e.prototype,i),e}(Io);Io.empty=new Sne([]);var a9e=function(t){function e(i,n){t.call(this),this.left=i,this.right=n,this.length=i.length+n.length,this.depth=Math.max(i.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,r,s,o){var a=this.left.length;if(r<a&&this.left.forEachInner(n,r,Math.min(s,a),o)===!1||s>a&&this.right.forEachInner(n,Math.max(r-a,0),Math.min(this.length,s)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(n,r,s,o){var a=this.left.length;if(r>a&&this.right.forEachInvertedInner(n,r-a,Math.max(s,a)-a,o+a)===!1||s<a&&this.left.forEachInvertedInner(n,Math.min(r,a),s,o)===!1)return!1},e.prototype.sliceInner=function(n,r){if(n==0&&r==this.length)return this;var s=this.left.length;return r<=s?this.left.slice(n,r):n>=s?this.right.slice(n-s,r-s):this.left.slice(n,s).append(this.right.slice(0,r-s))},e.prototype.leafAppend=function(n){var r=this.right.leafAppend(n);if(r)return new e(this.left,r)},e.prototype.leafPrepend=function(n){var r=this.left.leafPrepend(n);if(r)return new e(r,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e}(Io);const l9e=500;class yu{constructor(e,i){this.items=e,this.eventCount=i}popEvent(e,i){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let r,s;i&&(r=this.remapping(n,this.items.length),s=r.maps.length);let o=e.tr,a,l,u=[],d=[];return this.items.forEach((p,v)=>{if(!p.step){r||(r=this.remapping(n,v+1),s=r.maps.length),s--,d.push(p);return}if(r){d.push(new eh(p.map));let y=p.step.map(r.slice(s)),w;y&&o.maybeStep(y).doc&&(w=o.mapping.maps[o.mapping.maps.length-1],u.push(new eh(w,void 0,void 0,u.length+d.length))),s--,w&&r.appendMap(w,s)}else o.maybeStep(p.step);if(p.selection)return a=r?p.selection.map(r.slice(s)):p.selection,l=new yu(this.items.slice(0,n).append(d.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,i,n,r){let s=[],o=this.eventCount,a=this.items,l=!r&&a.length?a.get(a.length-1):null;for(let d=0;d<e.steps.length;d++){let p=e.steps[d].invert(e.docs[d]),v=new eh(e.mapping.maps[d],p,i),y;(y=l&&l.merge(v))&&(v=y,d?s.pop():a=a.slice(0,a.length-1)),s.push(v),i&&(o++,i=void 0),r||(l=v)}let u=o-n.depth;return u>u9e&&(a=c9e(a,u),o-=u),new yu(a.append(s),o)}remapping(e,i){let n=new J_;return this.items.forEach((r,s)=>{let o=r.mirrorOffset!=null&&s-r.mirrorOffset>=e?n.maps.length-r.mirrorOffset:void 0;n.appendMap(r.map,o)},e,i),n}addMaps(e){return this.eventCount==0?this:new yu(this.items.append(e.map(i=>new eh(i))),this.eventCount)}rebased(e,i){if(!this.eventCount)return this;let n=[],r=Math.max(0,this.items.length-i),s=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(v=>{v.selection&&a--},r);let l=i;this.items.forEach(v=>{let y=s.getMirror(--l);if(y==null)return;o=Math.min(o,y);let w=s.maps[y];if(v.step){let R=e.steps[y].invert(e.docs[y]),O=v.selection&&v.selection.map(s.slice(l+1,y));O&&a++,n.push(new eh(w,R,O))}else n.push(new eh(w))},r);let u=[];for(let v=i;v<o;v++)u.push(new eh(s.maps[v]));let d=this.items.slice(0,r).append(u).append(n),p=new yu(d,a);return p.emptyItemCount()>l9e&&(p=p.compress(this.items.length-n.length)),p}emptyItemCount(){let e=0;return this.items.forEach(i=>{i.step||e++}),e}compress(e=this.items.length){let i=this.remapping(0,e),n=i.maps.length,r=[],s=0;return this.items.forEach((o,a)=>{if(a>=e)r.push(o),o.selection&&s++;else if(o.step){let l=o.step.map(i.slice(n)),u=l&&l.getMap();if(n--,u&&i.appendMap(u,n),l){let d=o.selection&&o.selection.map(i.slice(n));d&&s++;let p=new eh(u.invert(),l,d),v,y=r.length-1;(v=r.length&&r[y].merge(p))?r[y]=v:r.push(p)}}else o.map&&n--},this.items.length,0),new yu(Io.from(r.reverse()),s)}}yu.empty=new yu(Io.empty,0);function c9e(t,e){let i;return t.forEach((n,r)=>{if(n.selection&&e--==0)return i=r,!1}),t.slice(i)}class eh{constructor(e,i,n,r){this.map=e,this.step=i,this.selection=n,this.mirrorOffset=r}merge(e){if(this.step&&e.step&&!e.selection){let i=e.step.merge(this.step);if(i)return new eh(i.getMap().invert(),i,this.selection)}}}class Jf{constructor(e,i,n,r,s){this.done=e,this.undone=i,this.prevRanges=n,this.prevTime=r,this.prevComposition=s}}const u9e=20;function h9e(t,e,i,n){let r=i.getMeta(bg),s;if(r)return r.historyState;i.getMeta(p9e)&&(t=new Jf(t.done,t.undone,null,0,-1));let o=i.getMeta("appendedTransaction");if(i.steps.length==0)return t;if(o&&o.getMeta(bg))return o.getMeta(bg).redo?new Jf(t.done.addTransform(i,void 0,n,NM(e)),t.undone,Bj(i.mapping.maps),t.prevTime,t.prevComposition):new Jf(t.done,t.undone.addTransform(i,void 0,n,NM(e)),null,t.prevTime,t.prevComposition);if(i.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=i.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(i.time||0)-n.newGroupDelay||!d9e(i,t.prevRanges)),u=o?eB(t.prevRanges,i.mapping):Bj(i.mapping.maps);return new Jf(t.done.addTransform(i,l?e.selection.getBookmark():void 0,n,NM(e)),yu.empty,u,i.time,a??t.prevComposition)}else return(s=i.getMeta("rebased"))?new Jf(t.done.rebased(i,s),t.undone.rebased(i,s),eB(t.prevRanges,i.mapping),t.prevTime,t.prevComposition):new Jf(t.done.addMaps(i.mapping.maps),t.undone.addMaps(i.mapping.maps),eB(t.prevRanges,i.mapping),t.prevTime,t.prevComposition)}function d9e(t,e){if(!e)return!1;if(!t.docChanged)return!0;let i=!1;return t.mapping.maps[0].forEach((n,r)=>{for(let s=0;s<e.length;s+=2)n<=e[s+1]&&r>=e[s]&&(i=!0)}),i}function Bj(t){let e=[];for(let i=t.length-1;i>=0&&e.length==0;i--)t[i].forEach((n,r,s,o)=>e.push(s,o));return e}function eB(t,e){if(!t)return null;let i=[];for(let n=0;n<t.length;n+=2){let r=e.map(t[n],1),s=e.map(t[n+1],-1);r<=s&&i.push(r,s)}return i}function f9e(t,e,i){let n=NM(e),r=bg.get(e).spec.config,s=(i?t.undone:t.done).popEvent(e,n);if(!s)return null;let o=s.selection.resolve(s.transform.doc),a=(i?t.done:t.undone).addTransform(s.transform,e.selection.getBookmark(),r,n),l=new Jf(i?a:s.remaining,i?s.remaining:a,null,0,-1);return s.transform.setSelection(o).setMeta(bg,{redo:i,historyState:l})}let tB=!1,zj=null;function NM(t){let e=t.plugins;if(zj!=e){tB=!1,zj=e;for(let i=0;i<e.length;i++)if(e[i].spec.historyPreserveItems){tB=!0;break}}return tB}const bg=new Gh("history"),p9e=new Gh("closeHistory");function m9e(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Ml({key:bg,state:{init(){return new Jf(yu.empty,yu.empty,null,0,-1)},apply(e,i,n){return h9e(i,n,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,i){let n=i.inputType,r=n=="historyUndo"?Mne:n=="historyRedo"?Tne:null;return r?(i.preventDefault(),r(e.state,e.dispatch)):!1}}}})}function One(t,e){return(i,n)=>{let r=bg.getState(i);if(!r||(t?r.undone:r.done).eventCount==0)return!1;if(n){let s=f9e(r,i,t);s&&n(e?s.scrollIntoView():s)}return!0}}const Mne=One(!1,!0),Tne=One(!0,!0),g9e=ja.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>Mne(t,e),redo:()=>({state:t,dispatch:e})=>Tne(t,e)}},addProseMirrorPlugins(){return[m9e(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-Ñ":()=>this.editor.commands.undo(),"Shift-Mod-Ñ":()=>this.editor.commands.redo()}}}),v9e=Za.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",go(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{const{selection:i}=e,{$from:n,$to:r}=i,s=t();return n.parentOffset===0?s.insertContentAt({from:Math.max(n.pos-1,0),to:r.pos},{type:this.name}):eje(i)?s.insertContentAt(r.pos,{type:this.name}):s.insertContent({type:this.name}),s.command(({tr:o,dispatch:a})=>{var l;if(a){const{$to:u}=o.selection,d=u.end();if(u.nodeAfter)u.nodeAfter.isTextblock?o.setSelection(Cn.create(o.doc,u.pos+1)):u.nodeAfter.isBlock?o.setSelection(cn.create(o.doc,u.pos)):o.setSelection(Cn.create(o.doc,u.pos));else{const p=(l=u.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();p&&(o.insert(d,p),o.setSelection(Cn.create(o.doc,d+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[Cne({find:/^(?:---|â-|___\s|\*\*\*\s)$/,type:this.type})]}}),y9e=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,x9e=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,b9e=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,w9e=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,_9e=Pp.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",go(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[F0({find:y9e,type:this.type}),F0({find:b9e,type:this.type})]},addPasteRules(){return[N0({find:x9e,type:this.type}),N0({find:w9e,type:this.type})]}}),C9e=Za.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",go(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),S9e="listItem",Vj="textStyle",Gj=/^(\d+)\.\s$/,O9e=Za.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:void 0,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...i}=t;return e===1?["ol",go(this.options.HTMLAttributes,i),0]:["ol",go(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(S9e,this.editor.getAttributes(Vj)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=sC({find:Gj,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,i)=>i.childCount+i.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=sC({find:Gj,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(Vj)}),joinPredicate:(e,i)=>i.childCount+i.attrs.start===+e[1],editor:this.editor})),[t]}}),M9e=Za.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",go(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),T9e=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,R9e=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,P9e=Pp.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",go(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[F0({find:T9e,type:this.type})]},addPasteRules(){return[N0({find:R9e,type:this.type})]}}),E9e=Za.create({name:"text",group:"inline"}),A9e=ja.create({name:"starterKit",addExtensions(){var t,e,i,n,r,s,o,a,l,u,d,p,v,y,w,R,O,P;const N=[];return this.options.bold!==!1&&N.push(Bje.configure((t=this.options)===null||t===void 0?void 0:t.bold)),this.options.blockquote!==!1&&N.push(kje.configure((e=this.options)===null||e===void 0?void 0:e.blockquote)),this.options.bulletList!==!1&&N.push(Vje.configure((i=this.options)===null||i===void 0?void 0:i.bulletList)),this.options.code!==!1&&N.push(Hje.configure((n=this.options)===null||n===void 0?void 0:n.code)),this.options.codeBlock!==!1&&N.push(qje.configure((r=this.options)===null||r===void 0?void 0:r.codeBlock)),this.options.document!==!1&&N.push(jje.configure((s=this.options)===null||s===void 0?void 0:s.document)),this.options.dropcursor!==!1&&N.push(Xje.configure((o=this.options)===null||o===void 0?void 0:o.dropcursor)),this.options.gapcursor!==!1&&N.push(r9e.configure((a=this.options)===null||a===void 0?void 0:a.gapcursor)),this.options.hardBreak!==!1&&N.push(s9e.configure((l=this.options)===null||l===void 0?void 0:l.hardBreak)),this.options.heading!==!1&&N.push(o9e.configure((u=this.options)===null||u===void 0?void 0:u.heading)),this.options.history!==!1&&N.push(g9e.configure((d=this.options)===null||d===void 0?void 0:d.history)),this.options.horizontalRule!==!1&&N.push(v9e.configure((p=this.options)===null||p===void 0?void 0:p.horizontalRule)),this.options.italic!==!1&&N.push(_9e.configure((v=this.options)===null||v===void 0?void 0:v.italic)),this.options.listItem!==!1&&N.push(C9e.configure((y=this.options)===null||y===void 0?void 0:y.listItem)),this.options.orderedList!==!1&&N.push(O9e.configure((w=this.options)===null||w===void 0?void 0:w.orderedList)),this.options.paragraph!==!1&&N.push(M9e.configure((R=this.options)===null||R===void 0?void 0:R.paragraph)),this.options.strike!==!1&&N.push(P9e.configure((O=this.options)===null||O===void 0?void 0:O.strike)),this.options.text!==!1&&N.push(E9e.configure((P=this.options)===null||P===void 0?void 0:P.text)),N}}),I9e=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,k9e=Za.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",go(this.options.HTMLAttributes,t)]},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[Cne({find:I9e,type:this.type,getAttributes:t=>{const[,,e,i,n]=t;return{src:i,alt:e,title:n}}})]}});class D9e{component;props;dom;constructor(e,{element:i,props:n}){this.component=e,this.props=n,this.dom=i,this.dom.classList.add("svelte-renderer")}updateProps(e){Object.assign(this.props,e)}updateAttributes(e){Object.keys(e).forEach(i=>{this.dom.setAttribute(i,e[i])})}destroy(){gle(this.component)}}const Rne="TipTapNodeView",L9e=(t,e)=>{if(!t)throw new Error(e)};class F9e extends Aje{mount(){const e=this.component,i=kn({editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extension,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(a={})=>this.updateAttributes(a),deleteNode:()=>this.deleteNode()});this.contentDOMElement=this.node.isLeaf?null:document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");const n=new Map;n.set(Rne,{onDragStart:this.onDragStart.bind(this)});const r=this.options.as??(this.node.isInline?"span":"div"),s=document.createElement(r);s.classList.add(`node-${this.node.type.name}`),this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate);const o=vle(e,{target:s,props:i,context:n});this.renderer=new D9e(o,{element:s,props:i}),this.appendContendDom(),this.updateElementAttributes()}appendContendDom(){const e=this.dom.querySelector("[data-node-view-content]");this.contentDOMElement&&e&&!e.contains(this.contentDOMElement)&&e.appendChild(this.contentDOMElement)}get dom(){return L9e(this.renderer.dom.firstElementChild?.hasAttribute("data-node-view-wrapper"),"Please use the NodeViewWrapper component for your node view."),this.renderer.dom}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:i}=this.editor.state.selection,n=this.getPos();if(typeof n=="number")if(e<=n&&i>=n+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,i,n){const r=s=>{this.renderer.updateProps(s),typeof this.options.attrs=="function"&&this.updateElementAttributes()};if(typeof this.options.update=="function"){const s=this.node,o=this.decorations,a=this.innerDecorations;return this.node=e,this.decorations=i,this.innerDecorations=n,this.options.update({oldNode:s,oldDecorations:o,oldInnerDecorations:a,newNode:e,newDecorations:i,newInnerDecorations:n,updateProps:()=>r({node:e,decorations:i,innerDecorations:n})})}return e.type!==this.node.type?!1:(e===this.node&&this.decorations===i&&this.innerDecorations===n||(this.node=e,this.decorations=i,this.innerDecorations=n,r({node:e,decorations:i,innerDecorations:n})),!0)}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.dom.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.dom.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}updateElementAttributes(){if(this.options.attrs){let e={};if(typeof this.options.attrs=="function"){const i=this.editor.extensionManager.attributes,n=nR(this.node,i);e=this.options.attrs({node:this.node,HTMLAttributes:n})}else e=this.options.attrs;this.renderer.updateAttributes(e)}}}const RH=(t,e)=>i=>new F9e(t,i,e);function PH(t,e){Pi(e,!0);const i=ht(e,"as",3,"div"),n=_C(e,["$$slots","$$events","$$legacy","as","children"]),{onDragStart:r}=Xi(Rne);let s;Xo(async()=>{await Hc(),s.style.whiteSpace="normal"});var o=nn(),a=pi(o);Mle(a,i,!1,(l,u)=>{es(l,w=>s=w,()=>s);let d;Gi(()=>d=Ch(l,d,{"data-node-view-wrapper":"",role:"none",...n,ondragstart:r}));var p=nn(),v=pi(p);{var y=w=>{var R=nn(),O=pi(R);hs(O,()=>e.children),bt(w,R)};Yi(v,w=>{e.children&&w(y)})}bt(u,p)}),bt(t,o),Ei()}var N9e=hi('<button class="btn btn-xs btn-info" type="button"> </button>');function B9e(t,e){Pi(e,!0);const i=()=>{e.updateAttributes({count:e.node.attrs.count+1})};PH(t,{class:"counter-component",as:"span",children:(n,r)=>{var s=N9e(),o=Di(s);_i(s),Gi(()=>zd(o,`Count: ${e.node.attrs.count??""}`)),Tn("click",s,i),bt(n,s)},$$slots:{default:!0}}),Ei()}const z9e=Za.create({name:"counterComponent",group:"inline",atom:!0,draggable:!0,inline:!0,addAttributes(){return{count:{default:0}}},parseHTML(){return[{tag:"counter-component"}]},renderHTML({HTMLAttributes:t}){return["counter-component",go(t)]},addNodeView(){return RH(B9e)}});function V9e(t){PH(t,{class:"input",as:"span",children:(e,i)=>{O4e(e,{layoutStructure:{props:{class:"input input-sm input-bordered w-16"}}})},$$slots:{default:!0}})}const G9e=Za.create({name:"inputComponent",group:"inline",atom:!0,draggable:!0,inline:!0,addAttributes(){return{}},parseHTML(){return[{tag:"input-component"}]},renderHTML({HTMLAttributes:t}){return["input-component",go(t)]},addNodeView(){return RH(V9e)}});function U9e(t){PH(t,{class:"input",as:"span",children:(e,i)=>{kg(e,{layoutStructure:{type:"icon",props:{color:"green",icon:"mdi:gear",size:"20"}},dataValues:{}})},$$slots:{default:!0}})}const H9e=Za.create({name:"layoutComponent",group:"inline",atom:!0,draggable:!0,inline:!0,addAttributes(){return{}},parseHTML(){return[{tag:"layout-component"}]},renderHTML({HTMLAttributes:t}){return["layout-component",go(t)]},addNodeView(){return RH(U9e)}});var $9e=hi("<button>Bold</button> <button>Strike</button> <button>H1</button> <button>H2</button> <button>P</button> <button>Image</button>",1),W9e=hi("<!> <div></div>",1);function q9e(t,e){Pi(e,!0);let i=ht(e,"content",15,""),n=ht(e,"editing",3,!1),r=null,s=Fn(!1),o=Fn(!1),a=Fn(!1),l=Fn(!1),u=Fn(!1),d=Fn(!1),p;Xo(()=>(r=new Eje({element:p,extensions:[A9e,z9e,G9e,H9e,k9e.configure({inline:!0})],content:i(),onTransaction:()=>{rt(s,kn(r.isActive("bold"))),rt(o,kn(r.isActive("strike"))),rt(a,kn(r.isActive("heading",{level:1}))),rt(l,kn(r.isActive("heading",{level:2}))),rt(u,kn(r.isActive("paragraph"))),rt(d,kn(r.isActive("image")))}}),r.on("update",({editor:O})=>{i(O.getHTML())}),()=>{r&&(r.destroy(),r=null)}));var v=W9e(),y=pi(v);{var w=O=>{var P=$9e(),N=pi(P);N.__click=()=>r?.chain().focus().toggleBold().run();let F;var k=vi(N,2);k.__click=()=>r?.chain().focus().toggleStrike().run();let $;var W=vi(k,2);W.__click=()=>r?.chain().focus().toggleHeading({level:1}).run();let Q;var Y=vi(W,2);Y.__click=()=>r?.chain().focus().toggleHeading({level:2}).run();let M;var D=vi(Y,2);D.__click=()=>r?.chain().focus().setParagraph().run();let G;var j=vi(D,2);j.__click=()=>r?.chain().focus().setImage({src:"https://media.formula1.com/image/upload/f_auto,c_limit,w_112,q_auto/nwp-navigation/f1-tv-logo"}).run();let Z;Gi((ie,le,me,be,fe,Fe)=>{F=xi(N,1,"svelte-166a1n7",null,F,ie),$=xi(k,1,"svelte-166a1n7",null,$,le),Q=xi(W,1,"svelte-166a1n7",null,Q,me),M=xi(Y,1,"svelte-166a1n7",null,M,be),G=xi(D,1,"svelte-166a1n7",null,G,fe),Z=xi(j,1,"svelte-166a1n7",null,Z,Fe)},[()=>({active:B(s)}),()=>({active:B(o)}),()=>({active:B(a)}),()=>({active:B(l)}),()=>({active:B(u)}),()=>({active:B(d)})]),bt(O,P)};Yi(y,O=>{n()&&O(w)})}var R=vi(y,2);es(R,O=>p=O,()=>p),bt(t,v),Ei()}Zg(["click"]);var j9e=hi("<div><!></div>");function ost(t,e){Pi(e,!0);const i=Xi("pageContext"),n=Vt(()=>$n(e.layoutStructure.props?.class,i,e.dataValues,!1)+(e.layoutStructure.props?.background?` bg-[url(${e.layoutStructure.props?.background})] bg-no-repeat bg-cover bg-center`:"")),r=Vt(()=>$n(e.layoutStructure.props.value,i,e.dataValues,!1));var s=j9e(),o=Di(s);q9e(o,{get content(){return B(r)},get editing(){return i.editMode}}),_i(s),Gi(()=>{xi(s,1,Ol(B(n))),yr(s,"draggable",e.layoutStructure.props?.draggable)}),bt(t,s),Ei()}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const nL="175",Q9e={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Z9e={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Pne=0,_V=1,Ene=2,X9e=3,K9e=0,EH=1,c_=2,th=3,kh=0,Ha=1,Pc=2,Ld=0,wg=1,CV=2,SV=3,OV=4,Ane=5,rp=100,Ine=101,kne=102,Dne=103,Lne=104,Fne=200,Nne=201,Bne=202,zne=203,aR=204,lR=205,Vne=206,Gne=207,Une=208,Hne=209,$ne=210,Wne=211,qne=212,jne=213,Qne=214,cR=0,uR=1,hR=2,Ug=3,dR=4,fR=5,pR=6,mR=7,YC=0,Zne=1,Xne=2,Fd=0,Kne=1,Yne=2,Jne=3,ere=4,tre=5,gR=6,ire=7,MV="attached",nre="detached",rL=300,Xd=301,Ep=302,oC=303,aC=304,px=306,Ap=1e3,Zl=1001,B0=1002,fo=1003,sL=1004,Y9e=1004,tg=1005,J9e=1005,Ps=1006,o0=1007,eQe=1007,Fc=1008,tQe=1008,Dh=1009,AH=1010,IH=1011,z0=1012,oL=1013,Kd=1014,gl=1015,mx=1016,aL=1017,lL=1018,V0=1020,kH=35902,DH=1021,LH=1022,za=1023,FH=1024,NH=1025,G0=1026,U0=1027,cL=1028,JC=1029,BH=1030,uL=1031,iQe=1032,hL=1033,u_=33776,h_=33777,d_=33778,f_=33779,vR=35840,yR=35841,xR=35842,bR=35843,wR=36196,_R=37492,CR=37496,SR=37808,OR=37809,MR=37810,TR=37811,RR=37812,PR=37813,ER=37814,AR=37815,IR=37816,kR=37817,DR=37818,LR=37819,FR=37820,NR=37821,p_=36492,BR=36494,zR=36495,zH=36283,VR=36284,GR=36285,UR=36286,rre=2200,sre=2201,ore=2202,H0=2300,$0=2301,BM=2302,ig=2400,ng=2401,lC=2402,dL=2500,VH=2501,are=0,GH=1,HR=2,lre=3200,cre=3201,nQe=3202,rQe=3203,Up=0,ure=1,_d="",co="srgb",ma="srgb-linear",cC="linear",Or="srgb",sQe=0,Gm=7680,oQe=7681,aQe=7682,lQe=7683,cQe=34055,uQe=34056,hQe=5386,dQe=512,fQe=513,pQe=514,mQe=515,gQe=516,vQe=517,yQe=518,TV=519,hre=512,dre=513,fre=514,UH=515,pre=516,mre=517,gre=518,vre=519,uC=35044,yre=35048,xQe=35040,bQe=35045,wQe=35049,_Qe=35041,CQe=35046,SQe=35050,OQe=35042,MQe="100",RV="300 es",wu=2e3,hC=2001,TQe={COMPUTE:"compute",RENDER:"render"};class Uh{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(i)===-1&&n[e].push(i)}hasEventListener(e,i){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(i)!==-1}removeEventListener(e,i){const n=this._listeners;if(n===void 0)return;const r=n[e];if(r!==void 0){const s=r.indexOf(i);s!==-1&&r.splice(s,1)}}dispatchEvent(e){const i=this._listeners;if(i===void 0)return;const n=i[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const na=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Uj=1234567;const _g=Math.PI/180,W0=180/Math.PI;function tc(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(na[t&255]+na[t>>8&255]+na[t>>16&255]+na[t>>24&255]+"-"+na[e&255]+na[e>>8&255]+"-"+na[e>>16&15|64]+na[e>>24&255]+"-"+na[i&63|128]+na[i>>8&255]+"-"+na[i>>16&255]+na[i>>24&255]+na[n&255]+na[n>>8&255]+na[n>>16&255]+na[n>>24&255]).toLowerCase()}function Sn(t,e,i){return Math.max(e,Math.min(i,t))}function HH(t,e){return(t%e+e)%e}function RQe(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)}function PQe(t,e,i){return t!==e?(i-t)/(e-t):0}function m_(t,e,i){return(1-i)*t+i*e}function EQe(t,e,i,n){return m_(t,e,1-Math.exp(-i*n))}function AQe(t,e=1){return e-Math.abs(HH(t,e*2)-e)}function IQe(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))}function kQe(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(t*6-15)+10))}function DQe(t,e){return t+Math.floor(Math.random()*(e-t+1))}function LQe(t,e){return t+Math.random()*(e-t)}function FQe(t){return t*(.5-Math.random())}function NQe(t){t!==void 0&&(Uj=t);let e=Uj+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function BQe(t){return t*_g}function zQe(t){return t*W0}function VQe(t){return(t&t-1)===0&&t!==0}function GQe(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function UQe(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function HQe(t,e,i,n,r){const s=Math.cos,o=Math.sin,a=s(i/2),l=o(i/2),u=s((e+n)/2),d=o((e+n)/2),p=s((e-n)/2),v=o((e-n)/2),y=s((n-e)/2),w=o((n-e)/2);switch(r){case"XYX":t.set(a*d,l*p,l*v,a*u);break;case"YZY":t.set(l*v,a*d,l*p,a*u);break;case"ZXZ":t.set(l*p,l*v,a*d,a*u);break;case"XZX":t.set(a*d,l*w,l*y,a*u);break;case"YXY":t.set(l*y,a*d,l*w,a*u);break;case"ZYZ":t.set(l*w,l*y,a*d,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function La(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function In(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const $H={DEG2RAD:_g,RAD2DEG:W0,generateUUID:tc,clamp:Sn,euclideanModulo:HH,mapLinear:RQe,inverseLerp:PQe,lerp:m_,damp:EQe,pingpong:AQe,smoothstep:IQe,smootherstep:kQe,randInt:DQe,randFloat:LQe,randFloatSpread:FQe,seededRandom:NQe,degToRad:BQe,radToDeg:zQe,isPowerOfTwo:VQe,ceilPowerOfTwo:GQe,floorPowerOfTwo:UQe,setQuaternionFromProperEuler:HQe,normalize:In,denormalize:La};class Xt{constructor(e=0,i=0){Xt.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,n=this.y,r=e.elements;return this.x=r[0]*i+r[3]*n+r[6],this.y=r[1]*i+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Sn(this.x,e.x,i.x),this.y=Sn(this.y,e.y,i.y),this}clampScalar(e,i){return this.x=Sn(this.x,e,i),this.y=Sn(this.y,e,i),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Sn(n,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Sn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y;return i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const n=Math.cos(i),r=Math.sin(i),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class wn{constructor(e,i,n,r,s,o,a,l,u){wn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,n,r,s,o,a,l,u)}set(e,i,n,r,s,o,a,l,u){const d=this.elements;return d[0]=e,d[1]=r,d[2]=a,d[3]=i,d[4]=s,d[5]=l,d[6]=n,d[7]=o,d[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],this}extractBasis(e,i,n){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,r=i.elements,s=this.elements,o=n[0],a=n[3],l=n[6],u=n[1],d=n[4],p=n[7],v=n[2],y=n[5],w=n[8],R=r[0],O=r[3],P=r[6],N=r[1],F=r[4],k=r[7],$=r[2],W=r[5],Q=r[8];return s[0]=o*R+a*N+l*$,s[3]=o*O+a*F+l*W,s[6]=o*P+a*k+l*Q,s[1]=u*R+d*N+p*$,s[4]=u*O+d*F+p*W,s[7]=u*P+d*k+p*Q,s[2]=v*R+y*N+w*$,s[5]=v*O+y*F+w*W,s[8]=v*P+y*k+w*Q,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],d=e[8];return i*o*d-i*a*u-n*s*d+n*a*l+r*s*u-r*o*l}invert(){const e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],d=e[8],p=d*o-a*u,v=a*l-d*s,y=u*s-o*l,w=i*p+n*v+r*y;if(w===0)return this.set(0,0,0,0,0,0,0,0,0);const R=1/w;return e[0]=p*R,e[1]=(r*u-d*n)*R,e[2]=(a*n-r*o)*R,e[3]=v*R,e[4]=(d*i-r*l)*R,e[5]=(r*s-a*i)*R,e[6]=y*R,e[7]=(n*l-u*i)*R,e[8]=(o*i-n*s)*R,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,n,r,s,o,a){const l=Math.cos(s),u=Math.sin(s);return this.set(n*l,n*u,-n*(l*o+u*a)+o+e,-r*u,r*l,-r*(-u*o+l*a)+a+i,0,0,1),this}scale(e,i){return this.premultiply(iB.makeScale(e,i)),this}rotate(e){return this.premultiply(iB.makeRotation(-e)),this}translate(e,i){return this.premultiply(iB.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,n,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,n=e.elements;for(let r=0;r<9;r++)if(i[r]!==n[r])return!1;return!0}fromArray(e,i=0){for(let n=0;n<9;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const iB=new wn;function xre(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const $Qe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function $y(t,e){return new $Qe[t](e)}function dC(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function bre(){const t=dC("canvas");return t.style.display="block",t}const Hj={};function zM(t){t in Hj||(Hj[t]=!0,console.warn(t))}function WQe(t,e,i){return new Promise(function(n,r){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:r();break;case t.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:n()}}setTimeout(s,i)})}function qQe(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function jQe(t){const e=t.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const $j=new wn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Wj=new wn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function QQe(){const t={enabled:!0,workingColorSpace:ma,spaces:{},convert:function(r,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===Or&&(r.r=Nd(r.r),r.g=Nd(r.g),r.b=Nd(r.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Or&&(r.r=a0(r.r),r.g=a0(r.g),r.b=a0(r.b))),r},fromWorkingColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},toWorkingColorSpace:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===_d?cC:this.spaces[r].transfer},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,o){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],n=[.3127,.329];return t.define({[ma]:{primaries:e,whitePoint:n,transfer:cC,toXYZ:$j,fromXYZ:Wj,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:co},outputColorSpaceConfig:{drawingBufferColorSpace:co}},[co]:{primaries:e,whitePoint:n,transfer:Or,toXYZ:$j,fromXYZ:Wj,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:co}}}),t}const Xn=QQe();function Nd(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function a0(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let hy;class wre{static getDataURL(e,i="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{hy===void 0&&(hy=dC("canvas")),hy.width=e.width,hy.height=e.height;const r=hy.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=hy}return n.toDataURL(i)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=dC("canvas");i.width=e.width,i.height=e.height;const n=i.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=Nd(s[o]/255)*255;return n.putImageData(r,0,0),i}else if(e.data){const i=e.data.slice(0);for(let n=0;n<i.length;n++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[n]=Math.floor(Nd(i[n]/255)*255):i[n]=Nd(i[n]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let ZQe=0;class dp{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:ZQe++}),this.uuid=tc(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(nB(r[o].image)):s.push(nB(r[o]))}else s=nB(r);n.url=s}return i||(e.images[this.uuid]=n),n}}function nB(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?wre.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let XQe=0;class ds extends Uh{constructor(e=ds.DEFAULT_IMAGE,i=ds.DEFAULT_MAPPING,n=Zl,r=Zl,s=Ps,o=Fc,a=za,l=Dh,u=ds.DEFAULT_ANISOTROPY,d=_d){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:XQe++}),this.uuid=tc(),this.name="",this.source=new dp(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=u,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Xt(0,0),this.repeat=new Xt(1,1),this.center=new Xt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new wn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),i||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==rL)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ap:e.x=e.x-Math.floor(e.x);break;case Zl:e.x=e.x<0?0:1;break;case B0:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ap:e.y=e.y-Math.floor(e.y);break;case Zl:e.y=e.y<0?0:1;break;case B0:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}ds.DEFAULT_IMAGE=null;ds.DEFAULT_MAPPING=rL;ds.DEFAULT_ANISOTROPY=1;class Mn{constructor(e=0,i=0,n=0,r=1){Mn.prototype.isVector4=!0,this.x=e,this.y=i,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,n,r){return this.x=e,this.y=i,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*i+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*i+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*i+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*i+o[7]*n+o[11]*r+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,n,r,s;const l=e.elements,u=l[0],d=l[4],p=l[8],v=l[1],y=l[5],w=l[9],R=l[2],O=l[6],P=l[10];if(Math.abs(d-v)<.01&&Math.abs(p-R)<.01&&Math.abs(w-O)<.01){if(Math.abs(d+v)<.1&&Math.abs(p+R)<.1&&Math.abs(w+O)<.1&&Math.abs(u+y+P-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const F=(u+1)/2,k=(y+1)/2,$=(P+1)/2,W=(d+v)/4,Q=(p+R)/4,Y=(w+O)/4;return F>k&&F>$?F<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(F),r=W/n,s=Q/n):k>$?k<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(k),n=W/r,s=Y/r):$<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt($),n=Q/s,r=Y/s),this.set(n,r,s,i),this}let N=Math.sqrt((O-w)*(O-w)+(p-R)*(p-R)+(v-d)*(v-d));return Math.abs(N)<.001&&(N=1),this.x=(O-w)/N,this.y=(p-R)/N,this.z=(v-d)/N,this.w=Math.acos((u+y+P-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Sn(this.x,e.x,i.x),this.y=Sn(this.y,e.y,i.y),this.z=Sn(this.z,e.z,i.z),this.w=Sn(this.w,e.w,i.w),this}clampScalar(e,i){return this.x=Sn(this.x,e,i),this.y=Sn(this.y,e,i),this.z=Sn(this.z,e,i),this.w=Sn(this.w,e,i),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Sn(n,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this.w=e.w+(i.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class fL extends Uh{constructor(e=1,i=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=1,this.scissor=new Mn(0,0,e,i),this.scissorTest=!1,this.viewport=new Mn(0,0,e,i);const r={width:e,height:i,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ps,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const s=new ds(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);s.flipY=!1,s.generateMipmaps=n.generateMipmaps,s.internalFormat=n.internalFormat,this.textures=[];const o=n.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,i,n=1){if(this.width!==e||this.height!==i||this.depth!==n){this.width=e,this.height=i,this.depth=n;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=i,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,n=e.textures.length;i<n;i++){this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0,this.textures[i].renderTarget=this;const r=Object.assign({},e.textures[i].image);this.textures[i].source=new dp(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Lh extends fL{constructor(e=1,i=1,n={}){super(e,i,n),this.isWebGLRenderTarget=!0}}class eS extends ds{constructor(e=null,i=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:n,depth:r},this.magFilter=fo,this.minFilter=fo,this.wrapR=Zl,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class KQe extends Lh{constructor(e=1,i=1,n=1,r={}){super(e,i,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new eS(null,e,i,n),this.texture.isRenderTargetTexture=!0}}class pL extends ds{constructor(e=null,i=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:n,depth:r},this.magFilter=fo,this.minFilter=fo,this.wrapR=Zl,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class YQe extends Lh{constructor(e=1,i=1,n=1,r={}){super(e,i,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new pL(null,e,i,n),this.texture.isRenderTargetTexture=!0}}class pa{constructor(e=0,i=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=n,this._w=r}static slerpFlat(e,i,n,r,s,o,a){let l=n[r+0],u=n[r+1],d=n[r+2],p=n[r+3];const v=s[o+0],y=s[o+1],w=s[o+2],R=s[o+3];if(a===0){e[i+0]=l,e[i+1]=u,e[i+2]=d,e[i+3]=p;return}if(a===1){e[i+0]=v,e[i+1]=y,e[i+2]=w,e[i+3]=R;return}if(p!==R||l!==v||u!==y||d!==w){let O=1-a;const P=l*v+u*y+d*w+p*R,N=P>=0?1:-1,F=1-P*P;if(F>Number.EPSILON){const $=Math.sqrt(F),W=Math.atan2($,P*N);O=Math.sin(O*W)/$,a=Math.sin(a*W)/$}const k=a*N;if(l=l*O+v*k,u=u*O+y*k,d=d*O+w*k,p=p*O+R*k,O===1-a){const $=1/Math.sqrt(l*l+u*u+d*d+p*p);l*=$,u*=$,d*=$,p*=$}}e[i]=l,e[i+1]=u,e[i+2]=d,e[i+3]=p}static multiplyQuaternionsFlat(e,i,n,r,s,o){const a=n[r],l=n[r+1],u=n[r+2],d=n[r+3],p=s[o],v=s[o+1],y=s[o+2],w=s[o+3];return e[i]=a*w+d*p+l*y-u*v,e[i+1]=l*w+d*v+u*p-a*y,e[i+2]=u*w+d*y+a*v-l*p,e[i+3]=d*w-a*p-l*v-u*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,n,r){return this._x=e,this._y=i,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){const n=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,u=a(n/2),d=a(r/2),p=a(s/2),v=l(n/2),y=l(r/2),w=l(s/2);switch(o){case"XYZ":this._x=v*d*p+u*y*w,this._y=u*y*p-v*d*w,this._z=u*d*w+v*y*p,this._w=u*d*p-v*y*w;break;case"YXZ":this._x=v*d*p+u*y*w,this._y=u*y*p-v*d*w,this._z=u*d*w-v*y*p,this._w=u*d*p+v*y*w;break;case"ZXY":this._x=v*d*p-u*y*w,this._y=u*y*p+v*d*w,this._z=u*d*w+v*y*p,this._w=u*d*p-v*y*w;break;case"ZYX":this._x=v*d*p-u*y*w,this._y=u*y*p+v*d*w,this._z=u*d*w-v*y*p,this._w=u*d*p+v*y*w;break;case"YZX":this._x=v*d*p+u*y*w,this._y=u*y*p+v*d*w,this._z=u*d*w-v*y*p,this._w=u*d*p-v*y*w;break;case"XZY":this._x=v*d*p-u*y*w,this._y=u*y*p-v*d*w,this._z=u*d*w+v*y*p,this._w=u*d*p+v*y*w;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const n=i/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,n=i[0],r=i[4],s=i[8],o=i[1],a=i[5],l=i[9],u=i[2],d=i[6],p=i[10],v=n+a+p;if(v>0){const y=.5/Math.sqrt(v+1);this._w=.25/y,this._x=(d-l)*y,this._y=(s-u)*y,this._z=(o-r)*y}else if(n>a&&n>p){const y=2*Math.sqrt(1+n-a-p);this._w=(d-l)/y,this._x=.25*y,this._y=(r+o)/y,this._z=(s+u)/y}else if(a>p){const y=2*Math.sqrt(1+a-n-p);this._w=(s-u)/y,this._x=(r+o)/y,this._y=.25*y,this._z=(l+d)/y}else{const y=2*Math.sqrt(1+p-n-a);this._w=(o-r)/y,this._x=(s+u)/y,this._y=(l+d)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let n=e.dot(i)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Sn(this.dot(e),-1,1)))}rotateTowards(e,i){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,i/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const n=e._x,r=e._y,s=e._z,o=e._w,a=i._x,l=i._y,u=i._z,d=i._w;return this._x=n*d+o*a+r*u-s*l,this._y=r*d+o*l+s*a-n*u,this._z=s*d+o*u+n*l-r*a,this._w=o*d-n*a-r*l-s*u,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const y=1-i;return this._w=y*o+i*this._w,this._x=y*n+i*this._x,this._y=y*r+i*this._y,this._z=y*s+i*this._z,this.normalize(),this}const u=Math.sqrt(l),d=Math.atan2(u,a),p=Math.sin((1-i)*d)/u,v=Math.sin(i*d)/u;return this._w=o*p+this._w*v,this._x=n*p+this._x*v,this._y=r*p+this._y*v,this._z=s*p+this._z*v,this._onChangeCallback(),this}slerpQuaternions(e,i,n){return this.copy(e).slerp(i,n)}random(){const e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(i),s*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ie{constructor(e=0,i=0,n=0){Ie.prototype.isVector3=!0,this.x=e,this.y=i,this.z=n}set(e,i,n){return n===void 0&&(n=this.z),this.x=e,this.y=i,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(qj.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(qj.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*i+s[3]*n+s[6]*r,this.y=s[1]*i+s[4]*n+s[7]*r,this.z=s[2]*i+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*i+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*i+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*i+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*i+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const i=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,u=2*(o*r-a*n),d=2*(a*i-s*r),p=2*(s*n-o*i);return this.x=i+l*u+o*p-a*d,this.y=n+l*d+a*u-s*p,this.z=r+l*p+s*d-o*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*i+s[4]*n+s[8]*r,this.y=s[1]*i+s[5]*n+s[9]*r,this.z=s[2]*i+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Sn(this.x,e.x,i.x),this.y=Sn(this.y,e.y,i.y),this.z=Sn(this.z,e.z,i.z),this}clampScalar(e,i){return this.x=Sn(this.x,e,i),this.y=Sn(this.y,e,i),this.z=Sn(this.z,e,i),this}clampLength(e,i){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Sn(n,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,n){return this.x=e.x+(i.x-e.x)*n,this.y=e.y+(i.y-e.y)*n,this.z=e.z+(i.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const n=e.x,r=e.y,s=e.z,o=i.x,a=i.y,l=i.z;return this.x=r*l-s*a,this.y=s*o-n*l,this.z=n*a-r*o,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const n=e.dot(this)/i;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return rB.copy(this).projectOnVector(e),this.sub(rB)}reflect(e){return this.sub(rB.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const n=this.dot(e)/i;return Math.acos(Sn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return i*i+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,n){const r=Math.sin(i)*e;return this.x=r*Math.sin(n),this.y=Math.cos(i)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,n){return this.x=e*Math.sin(i),this.y=n,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=n,this.z=r,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,n=Math.sqrt(1-i*i);return this.x=n*Math.cos(e),this.y=i,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const rB=new Ie,qj=new pa;class Es{constructor(e=new Ie(1/0,1/0,1/0),i=new Ie(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i+=3)this.expandByPoint(du.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,n=e.count;i<n;i++)this.expandByPoint(du.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const n=du.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(i===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,du):du.fromBufferAttribute(s,o),du.applyMatrix4(e.matrixWorld),this.expandByPoint(du);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),hO.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),hO.copy(n.boundingBox)),hO.applyMatrix4(e.matrixWorld),this.union(hO)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],i);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,du),du.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,n;return e.normal.x>0?(i=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),i<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Jb),dO.subVectors(this.max,Jb),dy.subVectors(e.a,Jb),fy.subVectors(e.b,Jb),py.subVectors(e.c,Jb),Ff.subVectors(fy,dy),Nf.subVectors(py,fy),_m.subVectors(dy,py);let i=[0,-Ff.z,Ff.y,0,-Nf.z,Nf.y,0,-_m.z,_m.y,Ff.z,0,-Ff.x,Nf.z,0,-Nf.x,_m.z,0,-_m.x,-Ff.y,Ff.x,0,-Nf.y,Nf.x,0,-_m.y,_m.x,0];return!sB(i,dy,fy,py,dO)||(i=[1,0,0,0,1,0,0,0,1],!sB(i,dy,fy,py,dO))?!1:(fO.crossVectors(Ff,Nf),i=[fO.x,fO.y,fO.z],sB(i,dy,fy,py,dO))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,du).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(du).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(cd[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),cd[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),cd[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),cd[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),cd[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),cd[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),cd[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),cd[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(cd),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const cd=[new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie,new Ie],du=new Ie,hO=new Es,dy=new Ie,fy=new Ie,py=new Ie,Ff=new Ie,Nf=new Ie,_m=new Ie,Jb=new Ie,dO=new Ie,fO=new Ie,Cm=new Ie;function sB(t,e,i,n,r){for(let s=0,o=t.length-3;s<=o;s+=3){Cm.fromArray(t,s);const a=r.x*Math.abs(Cm.x)+r.y*Math.abs(Cm.y)+r.z*Math.abs(Cm.z),l=e.dot(Cm),u=i.dot(Cm),d=n.dot(Cm);if(Math.max(-Math.max(l,u,d),Math.min(l,u,d))>a)return!1}return!0}const JQe=new Es,ew=new Ie,oB=new Ie;class Hs{constructor(e=new Ie,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const n=this.center;i!==void 0?n.copy(i):JQe.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const n=this.center.distanceToSquared(e);return i.copy(e),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ew.subVectors(e,this.center);const i=ew.lengthSq();if(i>this.radius*this.radius){const n=Math.sqrt(i),r=(n-this.radius)*.5;this.center.addScaledVector(ew,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(oB.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(ew.copy(e.center).add(oB)),this.expandByPoint(ew.copy(e.center).sub(oB))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ud=new Ie,aB=new Ie,pO=new Ie,Bf=new Ie,lB=new Ie,mO=new Ie,cB=new Ie;class sv{constructor(e=new Ie,i=new Ie(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ud)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=ud.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(ud.copy(this.origin).addScaledVector(this.direction,i),ud.distanceToSquared(e))}distanceSqToSegment(e,i,n,r){aB.copy(e).add(i).multiplyScalar(.5),pO.copy(i).sub(e).normalize(),Bf.copy(this.origin).sub(aB);const s=e.distanceTo(i)*.5,o=-this.direction.dot(pO),a=Bf.dot(this.direction),l=-Bf.dot(pO),u=Bf.lengthSq(),d=Math.abs(1-o*o);let p,v,y,w;if(d>0)if(p=o*l-a,v=o*a-l,w=s*d,p>=0)if(v>=-w)if(v<=w){const R=1/d;p*=R,v*=R,y=p*(p+o*v+2*a)+v*(o*p+v+2*l)+u}else v=s,p=Math.max(0,-(o*v+a)),y=-p*p+v*(v+2*l)+u;else v=-s,p=Math.max(0,-(o*v+a)),y=-p*p+v*(v+2*l)+u;else v<=-w?(p=Math.max(0,-(-o*s+a)),v=p>0?-s:Math.min(Math.max(-s,-l),s),y=-p*p+v*(v+2*l)+u):v<=w?(p=0,v=Math.min(Math.max(-s,-l),s),y=v*(v+2*l)+u):(p=Math.max(0,-(o*s+a)),v=p>0?s:Math.min(Math.max(-s,-l),s),y=-p*p+v*(v+2*l)+u);else v=o>0?-s:s,p=Math.max(0,-(o*v+a)),y=-p*p+v*(v+2*l)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,p),r&&r.copy(aB).addScaledVector(pO,v),y}intersectSphere(e,i){ud.subVectors(e.center,this.origin);const n=ud.dot(this.direction),r=ud.dot(ud)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=n-o,l=n+o;return l<0?null:a<0?this.at(l,i):this.at(a,i)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/i;return n>=0?n:null}intersectPlane(e,i){const n=this.distanceToPlane(e);return n===null?null:this.at(n,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let n,r,s,o,a,l;const u=1/this.direction.x,d=1/this.direction.y,p=1/this.direction.z,v=this.origin;return u>=0?(n=(e.min.x-v.x)*u,r=(e.max.x-v.x)*u):(n=(e.max.x-v.x)*u,r=(e.min.x-v.x)*u),d>=0?(s=(e.min.y-v.y)*d,o=(e.max.y-v.y)*d):(s=(e.max.y-v.y)*d,o=(e.min.y-v.y)*d),n>o||s>r||((s>n||isNaN(n))&&(n=s),(o<r||isNaN(r))&&(r=o),p>=0?(a=(e.min.z-v.z)*p,l=(e.max.z-v.z)*p):(a=(e.max.z-v.z)*p,l=(e.min.z-v.z)*p),n>l||a>r)||((a>n||n!==n)&&(n=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(n>=0?n:r,i)}intersectsBox(e){return this.intersectBox(e,ud)!==null}intersectTriangle(e,i,n,r,s){lB.subVectors(i,e),mO.subVectors(n,e),cB.crossVectors(lB,mO);let o=this.direction.dot(cB),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Bf.subVectors(this.origin,e);const l=a*this.direction.dot(mO.crossVectors(Bf,mO));if(l<0)return null;const u=a*this.direction.dot(lB.cross(Bf));if(u<0||l+u>o)return null;const d=-a*Bf.dot(cB);return d<0?null:this.at(d/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class sn{constructor(e,i,n,r,s,o,a,l,u,d,p,v,y,w,R,O){sn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,n,r,s,o,a,l,u,d,p,v,y,w,R,O)}set(e,i,n,r,s,o,a,l,u,d,p,v,y,w,R,O){const P=this.elements;return P[0]=e,P[4]=i,P[8]=n,P[12]=r,P[1]=s,P[5]=o,P[9]=a,P[13]=l,P[2]=u,P[6]=d,P[10]=p,P[14]=v,P[3]=y,P[7]=w,P[11]=R,P[15]=O,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new sn().fromArray(this.elements)}copy(e){const i=this.elements,n=e.elements;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this}copyPosition(e){const i=this.elements,n=e.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,n){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,n=e.elements,r=1/my.setFromMatrixColumn(e,0).length(),s=1/my.setFromMatrixColumn(e,1).length(),o=1/my.setFromMatrixColumn(e,2).length();return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[3]=0,i[4]=n[4]*s,i[5]=n[5]*s,i[6]=n[6]*s,i[7]=0,i[8]=n[8]*o,i[9]=n[9]*o,i[10]=n[10]*o,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(r),u=Math.sin(r),d=Math.cos(s),p=Math.sin(s);if(e.order==="XYZ"){const v=o*d,y=o*p,w=a*d,R=a*p;i[0]=l*d,i[4]=-l*p,i[8]=u,i[1]=y+w*u,i[5]=v-R*u,i[9]=-a*l,i[2]=R-v*u,i[6]=w+y*u,i[10]=o*l}else if(e.order==="YXZ"){const v=l*d,y=l*p,w=u*d,R=u*p;i[0]=v+R*a,i[4]=w*a-y,i[8]=o*u,i[1]=o*p,i[5]=o*d,i[9]=-a,i[2]=y*a-w,i[6]=R+v*a,i[10]=o*l}else if(e.order==="ZXY"){const v=l*d,y=l*p,w=u*d,R=u*p;i[0]=v-R*a,i[4]=-o*p,i[8]=w+y*a,i[1]=y+w*a,i[5]=o*d,i[9]=R-v*a,i[2]=-o*u,i[6]=a,i[10]=o*l}else if(e.order==="ZYX"){const v=o*d,y=o*p,w=a*d,R=a*p;i[0]=l*d,i[4]=w*u-y,i[8]=v*u+R,i[1]=l*p,i[5]=R*u+v,i[9]=y*u-w,i[2]=-u,i[6]=a*l,i[10]=o*l}else if(e.order==="YZX"){const v=o*l,y=o*u,w=a*l,R=a*u;i[0]=l*d,i[4]=R-v*p,i[8]=w*p+y,i[1]=p,i[5]=o*d,i[9]=-a*d,i[2]=-u*d,i[6]=y*p+w,i[10]=v-R*p}else if(e.order==="XZY"){const v=o*l,y=o*u,w=a*l,R=a*u;i[0]=l*d,i[4]=-p,i[8]=u*d,i[1]=v*p+R,i[5]=o*d,i[9]=y*p-w,i[2]=w*p-y,i[6]=a*d,i[10]=R*p+v}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(eZe,e,tZe)}lookAt(e,i,n){const r=this.elements;return zl.subVectors(e,i),zl.lengthSq()===0&&(zl.z=1),zl.normalize(),zf.crossVectors(n,zl),zf.lengthSq()===0&&(Math.abs(n.z)===1?zl.x+=1e-4:zl.z+=1e-4,zl.normalize(),zf.crossVectors(n,zl)),zf.normalize(),gO.crossVectors(zl,zf),r[0]=zf.x,r[4]=gO.x,r[8]=zl.x,r[1]=zf.y,r[5]=gO.y,r[9]=zl.y,r[2]=zf.z,r[6]=gO.z,r[10]=zl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const n=e.elements,r=i.elements,s=this.elements,o=n[0],a=n[4],l=n[8],u=n[12],d=n[1],p=n[5],v=n[9],y=n[13],w=n[2],R=n[6],O=n[10],P=n[14],N=n[3],F=n[7],k=n[11],$=n[15],W=r[0],Q=r[4],Y=r[8],M=r[12],D=r[1],G=r[5],j=r[9],Z=r[13],ie=r[2],le=r[6],me=r[10],be=r[14],fe=r[3],Fe=r[7],He=r[11],je=r[15];return s[0]=o*W+a*D+l*ie+u*fe,s[4]=o*Q+a*G+l*le+u*Fe,s[8]=o*Y+a*j+l*me+u*He,s[12]=o*M+a*Z+l*be+u*je,s[1]=d*W+p*D+v*ie+y*fe,s[5]=d*Q+p*G+v*le+y*Fe,s[9]=d*Y+p*j+v*me+y*He,s[13]=d*M+p*Z+v*be+y*je,s[2]=w*W+R*D+O*ie+P*fe,s[6]=w*Q+R*G+O*le+P*Fe,s[10]=w*Y+R*j+O*me+P*He,s[14]=w*M+R*Z+O*be+P*je,s[3]=N*W+F*D+k*ie+$*fe,s[7]=N*Q+F*G+k*le+$*Fe,s[11]=N*Y+F*j+k*me+$*He,s[15]=N*M+F*Z+k*be+$*je,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],n=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],u=e[13],d=e[2],p=e[6],v=e[10],y=e[14],w=e[3],R=e[7],O=e[11],P=e[15];return w*(+s*l*p-r*u*p-s*a*v+n*u*v+r*a*y-n*l*y)+R*(+i*l*y-i*u*v+s*o*v-r*o*y+r*u*d-s*l*d)+O*(+i*u*p-i*a*y-s*o*p+n*o*y+s*a*d-n*u*d)+P*(-r*a*d-i*l*p+i*a*v+r*o*p-n*o*v+n*l*d)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=i,r[14]=n),this}invert(){const e=this.elements,i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],d=e[8],p=e[9],v=e[10],y=e[11],w=e[12],R=e[13],O=e[14],P=e[15],N=p*O*u-R*v*u+R*l*y-a*O*y-p*l*P+a*v*P,F=w*v*u-d*O*u-w*l*y+o*O*y+d*l*P-o*v*P,k=d*R*u-w*p*u+w*a*y-o*R*y-d*a*P+o*p*P,$=w*p*l-d*R*l-w*a*v+o*R*v+d*a*O-o*p*O,W=i*N+n*F+r*k+s*$;if(W===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Q=1/W;return e[0]=N*Q,e[1]=(R*v*s-p*O*s-R*r*y+n*O*y+p*r*P-n*v*P)*Q,e[2]=(a*O*s-R*l*s+R*r*u-n*O*u-a*r*P+n*l*P)*Q,e[3]=(p*l*s-a*v*s-p*r*u+n*v*u+a*r*y-n*l*y)*Q,e[4]=F*Q,e[5]=(d*O*s-w*v*s+w*r*y-i*O*y-d*r*P+i*v*P)*Q,e[6]=(w*l*s-o*O*s-w*r*u+i*O*u+o*r*P-i*l*P)*Q,e[7]=(o*v*s-d*l*s+d*r*u-i*v*u-o*r*y+i*l*y)*Q,e[8]=k*Q,e[9]=(w*p*s-d*R*s-w*n*y+i*R*y+d*n*P-i*p*P)*Q,e[10]=(o*R*s-w*a*s+w*n*u-i*R*u-o*n*P+i*a*P)*Q,e[11]=(d*a*s-o*p*s-d*n*u+i*p*u+o*n*y-i*a*y)*Q,e[12]=$*Q,e[13]=(d*R*r-w*p*r+w*n*v-i*R*v-d*n*O+i*p*O)*Q,e[14]=(w*a*r-o*R*r-w*n*l+i*R*l+o*n*O-i*a*O)*Q,e[15]=(o*p*r-d*a*r+d*n*l-i*p*l-o*n*v+i*a*v)*Q,this}scale(e){const i=this.elements,n=e.x,r=e.y,s=e.z;return i[0]*=n,i[4]*=r,i[8]*=s,i[1]*=n,i[5]*=r,i[9]*=s,i[2]*=n,i[6]*=r,i[10]*=s,i[3]*=n,i[7]*=r,i[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,n,r))}makeTranslation(e,i,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,n,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),n=Math.sin(e);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const n=Math.cos(i),r=Math.sin(i),s=1-n,o=e.x,a=e.y,l=e.z,u=s*o,d=s*a;return this.set(u*o+n,u*a-r*l,u*l+r*a,0,u*a+r*l,d*a+n,d*l-r*o,0,u*l-r*a,d*l+r*o,s*l*l+n,0,0,0,0,1),this}makeScale(e,i,n){return this.set(e,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,i,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,i,r,1,0,0,0,0,1),this}compose(e,i,n){const r=this.elements,s=i._x,o=i._y,a=i._z,l=i._w,u=s+s,d=o+o,p=a+a,v=s*u,y=s*d,w=s*p,R=o*d,O=o*p,P=a*p,N=l*u,F=l*d,k=l*p,$=n.x,W=n.y,Q=n.z;return r[0]=(1-(R+P))*$,r[1]=(y+k)*$,r[2]=(w-F)*$,r[3]=0,r[4]=(y-k)*W,r[5]=(1-(v+P))*W,r[6]=(O+N)*W,r[7]=0,r[8]=(w+F)*Q,r[9]=(O-N)*Q,r[10]=(1-(v+R))*Q,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,i,n){const r=this.elements;let s=my.set(r[0],r[1],r[2]).length();const o=my.set(r[4],r[5],r[6]).length(),a=my.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],fu.copy(this);const u=1/s,d=1/o,p=1/a;return fu.elements[0]*=u,fu.elements[1]*=u,fu.elements[2]*=u,fu.elements[4]*=d,fu.elements[5]*=d,fu.elements[6]*=d,fu.elements[8]*=p,fu.elements[9]*=p,fu.elements[10]*=p,i.setFromRotationMatrix(fu),n.x=s,n.y=o,n.z=a,this}makePerspective(e,i,n,r,s,o,a=wu){const l=this.elements,u=2*s/(i-e),d=2*s/(n-r),p=(i+e)/(i-e),v=(n+r)/(n-r);let y,w;if(a===wu)y=-(o+s)/(o-s),w=-2*o*s/(o-s);else if(a===hC)y=-o/(o-s),w=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=u,l[4]=0,l[8]=p,l[12]=0,l[1]=0,l[5]=d,l[9]=v,l[13]=0,l[2]=0,l[6]=0,l[10]=y,l[14]=w,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,i,n,r,s,o,a=wu){const l=this.elements,u=1/(i-e),d=1/(n-r),p=1/(o-s),v=(i+e)*u,y=(n+r)*d;let w,R;if(a===wu)w=(o+s)*p,R=-2*p;else if(a===hC)w=s*p,R=-1*p;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*u,l[4]=0,l[8]=0,l[12]=-v,l[1]=0,l[5]=2*d,l[9]=0,l[13]=-y,l[2]=0,l[6]=0,l[10]=R,l[14]=-w,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const i=this.elements,n=e.elements;for(let r=0;r<16;r++)if(i[r]!==n[r])return!1;return!0}fromArray(e,i=0){for(let n=0;n<16;n++)this.elements[n]=e[n+i];return this}toArray(e=[],i=0){const n=this.elements;return e[i]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e}}const my=new Ie,fu=new sn,eZe=new Ie(0,0,0),tZe=new Ie(1,1,1),zf=new Ie,gO=new Ie,zl=new Ie,jj=new sn,Qj=new pa;class sc{constructor(e=0,i=0,n=0,r=sc.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,n,r=this._order){return this._x=e,this._y=i,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],u=r[5],d=r[9],p=r[2],v=r[6],y=r[10];switch(i){case"XYZ":this._y=Math.asin(Sn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-d,y),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(v,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Sn(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(a,y),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-p,s),this._z=0);break;case"ZXY":this._x=Math.asin(Sn(v,-1,1)),Math.abs(v)<.9999999?(this._y=Math.atan2(-p,y),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Sn(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(v,y),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(Sn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,u),this._y=Math.atan2(-p,s)):(this._x=0,this._y=Math.atan2(a,y));break;case"XZY":this._z=Math.asin(-Sn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(v,u),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-d,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,n){return jj.makeRotationFromQuaternion(e),this.setFromRotationMatrix(jj,i,n)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return Qj.setFromEuler(this),this.setFromQuaternion(Qj,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}sc.DEFAULT_ORDER="XYZ";class mL{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let iZe=0;const Zj=new Ie,gy=new pa,hd=new sn,vO=new Ie,tw=new Ie,nZe=new Ie,rZe=new pa,Xj=new Ie(1,0,0),Kj=new Ie(0,1,0),Yj=new Ie(0,0,1),Jj={type:"added"},sZe={type:"removed"},vy={type:"childadded",child:null},uB={type:"childremoved",child:null};class Qn extends Uh{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:iZe++}),this.uuid=tc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Qn.DEFAULT_UP.clone();const e=new Ie,i=new sc,n=new pa,r=new Ie(1,1,1);function s(){n.setFromEuler(i,!1)}function o(){i.setFromQuaternion(n,void 0,!1)}i._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new sn},normalMatrix:{value:new wn}}),this.matrix=new sn,this.matrixWorld=new sn,this.matrixAutoUpdate=Qn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Qn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new mL,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return gy.setFromAxisAngle(e,i),this.quaternion.multiply(gy),this}rotateOnWorldAxis(e,i){return gy.setFromAxisAngle(e,i),this.quaternion.premultiply(gy),this}rotateX(e){return this.rotateOnAxis(Xj,e)}rotateY(e){return this.rotateOnAxis(Kj,e)}rotateZ(e){return this.rotateOnAxis(Yj,e)}translateOnAxis(e,i){return Zj.copy(e).applyQuaternion(this.quaternion),this.position.add(Zj.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(Xj,e)}translateY(e){return this.translateOnAxis(Kj,e)}translateZ(e){return this.translateOnAxis(Yj,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(hd.copy(this.matrixWorld).invert())}lookAt(e,i,n){e.isVector3?vO.copy(e):vO.set(e,i,n);const r=this.parent;this.updateWorldMatrix(!0,!1),tw.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?hd.lookAt(tw,vO,this.up):hd.lookAt(vO,tw,this.up),this.quaternion.setFromRotationMatrix(hd),r&&(hd.extractRotation(r.matrixWorld),gy.setFromRotationMatrix(hd),this.quaternion.premultiply(gy.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Jj),vy.child=e,this.dispatchEvent(vy),vy.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(sZe),uB.child=e,this.dispatchEvent(uB),uB.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),hd.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),hd.multiply(e.parent.matrixWorld)),e.applyMatrix4(hd),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Jj),vy.child=e,this.dispatchEvent(vy),vy.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,i);if(o!==void 0)return o}}getObjectsByProperty(e,i,n=[]){this[e]===i&&n.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,i,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tw,e,nZe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tw,rZe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].updateMatrixWorld(e)}updateWorldMatrix(e,i){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",n={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let u=0,d=l.length;u<d;u++){const p=l[u];s(e.shapes,p)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,u=this.material.length;l<u;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(i){const a=o(e.geometries),l=o(e.materials),u=o(e.textures),d=o(e.images),p=o(e.shapes),v=o(e.skeletons),y=o(e.animations),w=o(e.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),u.length>0&&(n.textures=u),d.length>0&&(n.images=d),p.length>0&&(n.shapes=p),v.length>0&&(n.skeletons=v),y.length>0&&(n.animations=y),w.length>0&&(n.nodes=w)}return n.object=r,n;function o(a){const l=[];for(const u in a){const d=a[u];delete d.metadata,l.push(d)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}}Qn.DEFAULT_UP=new Ie(0,1,0);Qn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Qn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const pu=new Ie,dd=new Ie,hB=new Ie,fd=new Ie,yy=new Ie,xy=new Ie,e9=new Ie,dB=new Ie,fB=new Ie,pB=new Ie,mB=new Mn,gB=new Mn,vB=new Mn;class hl{constructor(e=new Ie,i=new Ie,n=new Ie){this.a=e,this.b=i,this.c=n}static getNormal(e,i,n,r){r.subVectors(n,i),pu.subVectors(e,i),r.cross(pu);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,i,n,r,s){pu.subVectors(r,i),dd.subVectors(n,i),hB.subVectors(e,i);const o=pu.dot(pu),a=pu.dot(dd),l=pu.dot(hB),u=dd.dot(dd),d=dd.dot(hB),p=o*u-a*a;if(p===0)return s.set(0,0,0),null;const v=1/p,y=(u*l-a*d)*v,w=(o*d-a*l)*v;return s.set(1-y-w,w,y)}static containsPoint(e,i,n,r){return this.getBarycoord(e,i,n,r,fd)===null?!1:fd.x>=0&&fd.y>=0&&fd.x+fd.y<=1}static getInterpolation(e,i,n,r,s,o,a,l){return this.getBarycoord(e,i,n,r,fd)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,fd.x),l.addScaledVector(o,fd.y),l.addScaledVector(a,fd.z),l)}static getInterpolatedAttribute(e,i,n,r,s,o){return mB.setScalar(0),gB.setScalar(0),vB.setScalar(0),mB.fromBufferAttribute(e,i),gB.fromBufferAttribute(e,n),vB.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(mB,s.x),o.addScaledVector(gB,s.y),o.addScaledVector(vB,s.z),o}static isFrontFacing(e,i,n,r){return pu.subVectors(n,i),dd.subVectors(e,i),pu.cross(dd).dot(r)<0}set(e,i,n){return this.a.copy(e),this.b.copy(i),this.c.copy(n),this}setFromPointsAndIndices(e,i,n,r){return this.a.copy(e[i]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,i,n,r){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return pu.subVectors(this.c,this.b),dd.subVectors(this.a,this.b),pu.cross(dd).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return hl.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return hl.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,n,r,s){return hl.getInterpolation(e,this.a,this.b,this.c,i,n,r,s)}containsPoint(e){return hl.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return hl.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const n=this.a,r=this.b,s=this.c;let o,a;yy.subVectors(r,n),xy.subVectors(s,n),dB.subVectors(e,n);const l=yy.dot(dB),u=xy.dot(dB);if(l<=0&&u<=0)return i.copy(n);fB.subVectors(e,r);const d=yy.dot(fB),p=xy.dot(fB);if(d>=0&&p<=d)return i.copy(r);const v=l*p-d*u;if(v<=0&&l>=0&&d<=0)return o=l/(l-d),i.copy(n).addScaledVector(yy,o);pB.subVectors(e,s);const y=yy.dot(pB),w=xy.dot(pB);if(w>=0&&y<=w)return i.copy(s);const R=y*u-l*w;if(R<=0&&u>=0&&w<=0)return a=u/(u-w),i.copy(n).addScaledVector(xy,a);const O=d*w-y*p;if(O<=0&&p-d>=0&&y-w>=0)return e9.subVectors(s,r),a=(p-d)/(p-d+(y-w)),i.copy(r).addScaledVector(e9,a);const P=1/(O+R+v);return o=R*P,a=v*P,i.copy(n).addScaledVector(yy,o).addScaledVector(xy,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const _re={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Vf={h:0,s:0,l:0},yO={h:0,s:0,l:0};function yB(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}class Si{constructor(e,i,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,n)}set(e,i,n){if(i===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,i,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=co){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Xn.toWorkingColorSpace(this,i),this}setRGB(e,i,n,r=Xn.workingColorSpace){return this.r=e,this.g=i,this.b=n,Xn.toWorkingColorSpace(this,r),this}setHSL(e,i,n,r=Xn.workingColorSpace){if(e=HH(e,1),i=Sn(i,0,1),n=Sn(n,0,1),i===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+i):n+i-n*i,o=2*n-s;this.r=yB(o,s,e+1/3),this.g=yB(o,s,e),this.b=yB(o,s,e-1/3)}return Xn.toWorkingColorSpace(this,r),this}setStyle(e,i=co){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,i);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,i);if(o===6)return this.setHex(parseInt(s,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=co){const n=_re[e.toLowerCase()];return n!==void 0?this.setHex(n,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Nd(e.r),this.g=Nd(e.g),this.b=Nd(e.b),this}copyLinearToSRGB(e){return this.r=a0(e.r),this.g=a0(e.g),this.b=a0(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=co){return Xn.fromWorkingColorSpace(ra.copy(this),e),Math.round(Sn(ra.r*255,0,255))*65536+Math.round(Sn(ra.g*255,0,255))*256+Math.round(Sn(ra.b*255,0,255))}getHexString(e=co){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=Xn.workingColorSpace){Xn.fromWorkingColorSpace(ra.copy(this),i);const n=ra.r,r=ra.g,s=ra.b,o=Math.max(n,r,s),a=Math.min(n,r,s);let l,u;const d=(a+o)/2;if(a===o)l=0,u=0;else{const p=o-a;switch(u=d<=.5?p/(o+a):p/(2-o-a),o){case n:l=(r-s)/p+(r<s?6:0);break;case r:l=(s-n)/p+2;break;case s:l=(n-r)/p+4;break}l/=6}return e.h=l,e.s=u,e.l=d,e}getRGB(e,i=Xn.workingColorSpace){return Xn.fromWorkingColorSpace(ra.copy(this),i),e.r=ra.r,e.g=ra.g,e.b=ra.b,e}getStyle(e=co){Xn.fromWorkingColorSpace(ra.copy(this),e);const i=ra.r,n=ra.g,r=ra.b;return e!==co?`color(${e} ${i.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,i,n){return this.getHSL(Vf),this.setHSL(Vf.h+e,Vf.s+i,Vf.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,n){return this.r=e.r+(i.r-e.r)*n,this.g=e.g+(i.g-e.g)*n,this.b=e.b+(i.b-e.b)*n,this}lerpHSL(e,i){this.getHSL(Vf),e.getHSL(yO);const n=m_(Vf.h,yO.h,i),r=m_(Vf.s,yO.s,i),s=m_(Vf.l,yO.l,i);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*i+s[3]*n+s[6]*r,this.g=s[1]*i+s[4]*n+s[7]*r,this.b=s[2]*i+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ra=new Si;Si.NAMES=_re;let oZe=0;class po extends Uh{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:oZe++}),this.uuid=tc(),this.name="",this.type="Material",this.blending=wg,this.side=kh,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=aR,this.blendDst=lR,this.blendEquation=rp,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Si(0,0,0),this.blendAlpha=0,this.depthFunc=Ug,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=TV,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Gm,this.stencilZFail=Gm,this.stencilZPass=Gm,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const n=e[i];if(n===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const r=this[i];if(r===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[i]=n}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==wg&&(n.blending=this.blending),this.side!==kh&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==aR&&(n.blendSrc=this.blendSrc),this.blendDst!==lR&&(n.blendDst=this.blendDst),this.blendEquation!==rp&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Ug&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==TV&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Gm&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Gm&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Gm&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(i){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let n=null;if(i!==null){const r=i.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=i[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class vl extends po{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Si(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new sc,this.combine=YC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Cd=aZe();function aZe(){const t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),n=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const u=l-127;u<-27?(n[l]=0,n[l|256]=32768,r[l]=24,r[l|256]=24):u<-14?(n[l]=1024>>-u-14,n[l|256]=1024>>-u-14|32768,r[l]=-u-1,r[l|256]=-u-1):u<=15?(n[l]=u+15<<10,n[l|256]=u+15<<10|32768,r[l]=13,r[l|256]=13):u<128?(n[l]=31744,n[l|256]=64512,r[l]=24,r[l|256]=24):(n[l]=31744,n[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,d=0;for(;(u&8388608)===0;)u<<=1,d-=8388608;u&=-8388609,d+=947912704,s[l]=u|d}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function sl(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Sn(t,-65504,65504),Cd.floatView[0]=t;const e=Cd.uint32View[0],i=e>>23&511;return Cd.baseTable[i]+((e&8388607)>>Cd.shiftTable[i])}function Ew(t){const e=t>>10;return Cd.uint32View[0]=Cd.mantissaTable[Cd.offsetTable[e]+(t&1023)]+Cd.exponentTable[e],Cd.floatView[0]}class lZe{static toHalfFloat(e){return sl(e)}static fromHalfFloat(e){return Ew(e)}}const Xs=new Ie,xO=new Xt;let cZe=0;class xr{constructor(e,i,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:cZe++}),this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=n,this.usage=uC,this.updateRanges=[],this.gpuType=gl,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,n){e*=this.itemSize,n*=i.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=i.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,n=this.count;i<n;i++)xO.fromBufferAttribute(this,i),xO.applyMatrix3(e),this.setXY(i,xO.x,xO.y);else if(this.itemSize===3)for(let i=0,n=this.count;i<n;i++)Xs.fromBufferAttribute(this,i),Xs.applyMatrix3(e),this.setXYZ(i,Xs.x,Xs.y,Xs.z);return this}applyMatrix4(e){for(let i=0,n=this.count;i<n;i++)Xs.fromBufferAttribute(this,i),Xs.applyMatrix4(e),this.setXYZ(i,Xs.x,Xs.y,Xs.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)Xs.fromBufferAttribute(this,i),Xs.applyNormalMatrix(e),this.setXYZ(i,Xs.x,Xs.y,Xs.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)Xs.fromBufferAttribute(this,i),Xs.transformDirection(e),this.setXYZ(i,Xs.x,Xs.y,Xs.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let n=this.array[e*this.itemSize+i];return this.normalized&&(n=La(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=In(n,this.array)),this.array[e*this.itemSize+i]=n,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=La(i,this.array)),i}setX(e,i){return this.normalized&&(i=In(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=La(i,this.array)),i}setY(e,i){return this.normalized&&(i=In(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=La(i,this.array)),i}setZ(e,i){return this.normalized&&(i=In(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=La(i,this.array)),i}setW(e,i){return this.normalized&&(i=In(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=In(i,this.array),n=In(n,this.array)),this.array[e+0]=i,this.array[e+1]=n,this}setXYZ(e,i,n,r){return e*=this.itemSize,this.normalized&&(i=In(i,this.array),n=In(n,this.array),r=In(r,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,i,n,r,s){return e*=this.itemSize,this.normalized&&(i=In(i,this.array),n=In(n,this.array),r=In(r,this.array),s=In(s,this.array)),this.array[e+0]=i,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==uC&&(e.usage=this.usage),e}}class uZe extends xr{constructor(e,i,n){super(new Int8Array(e),i,n)}}class hZe extends xr{constructor(e,i,n){super(new Uint8Array(e),i,n)}}class dZe extends xr{constructor(e,i,n){super(new Uint8ClampedArray(e),i,n)}}class fZe extends xr{constructor(e,i,n){super(new Int16Array(e),i,n)}}class WH extends xr{constructor(e,i,n){super(new Uint16Array(e),i,n)}}class pZe extends xr{constructor(e,i,n){super(new Int32Array(e),i,n)}}class qH extends xr{constructor(e,i,n){super(new Uint32Array(e),i,n)}}class mZe extends xr{constructor(e,i,n){super(new Uint16Array(e),i,n),this.isFloat16BufferAttribute=!0}getX(e){let i=Ew(this.array[e*this.itemSize]);return this.normalized&&(i=La(i,this.array)),i}setX(e,i){return this.normalized&&(i=In(i,this.array)),this.array[e*this.itemSize]=sl(i),this}getY(e){let i=Ew(this.array[e*this.itemSize+1]);return this.normalized&&(i=La(i,this.array)),i}setY(e,i){return this.normalized&&(i=In(i,this.array)),this.array[e*this.itemSize+1]=sl(i),this}getZ(e){let i=Ew(this.array[e*this.itemSize+2]);return this.normalized&&(i=La(i,this.array)),i}setZ(e,i){return this.normalized&&(i=In(i,this.array)),this.array[e*this.itemSize+2]=sl(i),this}getW(e){let i=Ew(this.array[e*this.itemSize+3]);return this.normalized&&(i=La(i,this.array)),i}setW(e,i){return this.normalized&&(i=In(i,this.array)),this.array[e*this.itemSize+3]=sl(i),this}setXY(e,i,n){return e*=this.itemSize,this.normalized&&(i=In(i,this.array),n=In(n,this.array)),this.array[e+0]=sl(i),this.array[e+1]=sl(n),this}setXYZ(e,i,n,r){return e*=this.itemSize,this.normalized&&(i=In(i,this.array),n=In(n,this.array),r=In(r,this.array)),this.array[e+0]=sl(i),this.array[e+1]=sl(n),this.array[e+2]=sl(r),this}setXYZW(e,i,n,r,s){return e*=this.itemSize,this.normalized&&(i=In(i,this.array),n=In(n,this.array),r=In(r,this.array),s=In(s,this.array)),this.array[e+0]=sl(i),this.array[e+1]=sl(n),this.array[e+2]=sl(r),this.array[e+3]=sl(s),this}}class Hi extends xr{constructor(e,i,n){super(new Float32Array(e),i,n)}}let gZe=0;const xc=new sn,xB=new Qn,by=new Ie,Vl=new Es,iw=new Es,Mo=new Ie;class Rn extends Uh{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:gZe++}),this.uuid=tc(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(xre(e)?qH:WH)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,n=0){this.groups.push({start:e,count:i,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new wn().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return xc.makeRotationFromQuaternion(e),this.applyMatrix4(xc),this}rotateX(e){return xc.makeRotationX(e),this.applyMatrix4(xc),this}rotateY(e){return xc.makeRotationY(e),this.applyMatrix4(xc),this}rotateZ(e){return xc.makeRotationZ(e),this.applyMatrix4(xc),this}translate(e,i,n){return xc.makeTranslation(e,i,n),this.applyMatrix4(xc),this}scale(e,i,n){return xc.makeScale(e,i,n),this.applyMatrix4(xc),this}lookAt(e){return xB.lookAt(e),xB.updateMatrix(),this.applyMatrix4(xB.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(by).negate(),this.translate(by.x,by.y,by.z),this}setFromPoints(e){const i=this.getAttribute("position");if(i===void 0){const n=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];n.push(o.x,o.y,o.z||0)}this.setAttribute("position",new Hi(n,3))}else{const n=Math.min(e.length,i.count);for(let r=0;r<n;r++){const s=e[r];i.setXYZ(r,s.x,s.y,s.z||0)}e.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Es);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Ie(-1/0,-1/0,-1/0),new Ie(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let n=0,r=i.length;n<r;n++){const s=i[n];Vl.setFromBufferAttribute(s),this.morphTargetsRelative?(Mo.addVectors(this.boundingBox.min,Vl.min),this.boundingBox.expandByPoint(Mo),Mo.addVectors(this.boundingBox.max,Vl.max),this.boundingBox.expandByPoint(Mo)):(this.boundingBox.expandByPoint(Vl.min),this.boundingBox.expandByPoint(Vl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Hs);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Ie,1/0);return}if(e){const n=this.boundingSphere.center;if(Vl.setFromBufferAttribute(e),i)for(let s=0,o=i.length;s<o;s++){const a=i[s];iw.setFromBufferAttribute(a),this.morphTargetsRelative?(Mo.addVectors(Vl.min,iw.min),Vl.expandByPoint(Mo),Mo.addVectors(Vl.max,iw.max),Vl.expandByPoint(Mo)):(Vl.expandByPoint(iw.min),Vl.expandByPoint(iw.max))}Vl.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)Mo.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(Mo));if(i)for(let s=0,o=i.length;s<o;s++){const a=i[s],l=this.morphTargetsRelative;for(let u=0,d=a.count;u<d;u++)Mo.fromBufferAttribute(a,u),l&&(by.fromBufferAttribute(e,u),Mo.add(by)),r=Math.max(r,n.distanceToSquared(Mo))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=i.position,r=i.normal,s=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new xr(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let Y=0;Y<n.count;Y++)a[Y]=new Ie,l[Y]=new Ie;const u=new Ie,d=new Ie,p=new Ie,v=new Xt,y=new Xt,w=new Xt,R=new Ie,O=new Ie;function P(Y,M,D){u.fromBufferAttribute(n,Y),d.fromBufferAttribute(n,M),p.fromBufferAttribute(n,D),v.fromBufferAttribute(s,Y),y.fromBufferAttribute(s,M),w.fromBufferAttribute(s,D),d.sub(u),p.sub(u),y.sub(v),w.sub(v);const G=1/(y.x*w.y-w.x*y.y);isFinite(G)&&(R.copy(d).multiplyScalar(w.y).addScaledVector(p,-y.y).multiplyScalar(G),O.copy(p).multiplyScalar(y.x).addScaledVector(d,-w.x).multiplyScalar(G),a[Y].add(R),a[M].add(R),a[D].add(R),l[Y].add(O),l[M].add(O),l[D].add(O))}let N=this.groups;N.length===0&&(N=[{start:0,count:e.count}]);for(let Y=0,M=N.length;Y<M;++Y){const D=N[Y],G=D.start,j=D.count;for(let Z=G,ie=G+j;Z<ie;Z+=3)P(e.getX(Z+0),e.getX(Z+1),e.getX(Z+2))}const F=new Ie,k=new Ie,$=new Ie,W=new Ie;function Q(Y){$.fromBufferAttribute(r,Y),W.copy($);const M=a[Y];F.copy(M),F.sub($.multiplyScalar($.dot(M))).normalize(),k.crossVectors(W,M);const G=k.dot(l[Y])<0?-1:1;o.setXYZW(Y,F.x,F.y,F.z,G)}for(let Y=0,M=N.length;Y<M;++Y){const D=N[Y],G=D.start,j=D.count;for(let Z=G,ie=G+j;Z<ie;Z+=3)Q(e.getX(Z+0)),Q(e.getX(Z+1)),Q(e.getX(Z+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new xr(new Float32Array(i.count*3),3),this.setAttribute("normal",n);else for(let v=0,y=n.count;v<y;v++)n.setXYZ(v,0,0,0);const r=new Ie,s=new Ie,o=new Ie,a=new Ie,l=new Ie,u=new Ie,d=new Ie,p=new Ie;if(e)for(let v=0,y=e.count;v<y;v+=3){const w=e.getX(v+0),R=e.getX(v+1),O=e.getX(v+2);r.fromBufferAttribute(i,w),s.fromBufferAttribute(i,R),o.fromBufferAttribute(i,O),d.subVectors(o,s),p.subVectors(r,s),d.cross(p),a.fromBufferAttribute(n,w),l.fromBufferAttribute(n,R),u.fromBufferAttribute(n,O),a.add(d),l.add(d),u.add(d),n.setXYZ(w,a.x,a.y,a.z),n.setXYZ(R,l.x,l.y,l.z),n.setXYZ(O,u.x,u.y,u.z)}else for(let v=0,y=i.count;v<y;v+=3)r.fromBufferAttribute(i,v+0),s.fromBufferAttribute(i,v+1),o.fromBufferAttribute(i,v+2),d.subVectors(o,s),p.subVectors(r,s),d.cross(p),n.setXYZ(v+0,d.x,d.y,d.z),n.setXYZ(v+1,d.x,d.y,d.z),n.setXYZ(v+2,d.x,d.y,d.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,n=e.count;i<n;i++)Mo.fromBufferAttribute(e,i),Mo.normalize(),e.setXYZ(i,Mo.x,Mo.y,Mo.z)}toNonIndexed(){function e(a,l){const u=a.array,d=a.itemSize,p=a.normalized,v=new u.constructor(l.length*d);let y=0,w=0;for(let R=0,O=l.length;R<O;R++){a.isInterleavedBufferAttribute?y=l[R]*a.data.stride+a.offset:y=l[R]*d;for(let P=0;P<d;P++)v[w++]=u[y++]}return new xr(v,d,p)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Rn,n=this.index.array,r=this.attributes;for(const a in r){const l=r[a],u=e(l,n);i.setAttribute(a,u)}const s=this.morphAttributes;for(const a in s){const l=[],u=s[a];for(let d=0,p=u.length;d<p;d++){const v=u[d],y=e(v,n);l.push(y)}i.morphAttributes[a]=l}i.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const u=o[a];i.addGroup(u.start,u.count,u.materialIndex)}return i}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const u in l)l[u]!==void 0&&(e[u]=l[u]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const n=this.attributes;for(const l in n){const u=n[l];e.data.attributes[l]=u.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],d=[];for(let p=0,v=u.length;p<v;p++){const y=u[p];d.push(y.toJSON(e.data))}d.length>0&&(r[l]=d,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const r=e.attributes;for(const u in r){const d=r[u];this.setAttribute(u,d.clone(i))}const s=e.morphAttributes;for(const u in s){const d=[],p=s[u];for(let v=0,y=p.length;v<y;v++)d.push(p[v].clone(i));this.morphAttributes[u]=d}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let u=0,d=o.length;u<d;u++){const p=o[u];this.addGroup(p.start,p.count,p.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const t9=new sn,Sm=new sv,bO=new Hs,i9=new Ie,wO=new Ie,_O=new Ie,CO=new Ie,bB=new Ie,SO=new Ie,n9=new Ie,OO=new Ie;class us extends Qn{constructor(e=new Rn,i=new vl){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,n=Object.keys(i);if(n.length>0){const r=i[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,i){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;i.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){SO.set(0,0,0);for(let l=0,u=s.length;l<u;l++){const d=a[l],p=s[l];d!==0&&(bB.fromBufferAttribute(p,e),o?SO.addScaledVector(bB,d):SO.addScaledVector(bB.sub(i),d))}i.add(SO)}return i}raycast(e,i){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),bO.copy(n.boundingSphere),bO.applyMatrix4(s),Sm.copy(e.ray).recast(e.near),!(bO.containsPoint(Sm.origin)===!1&&(Sm.intersectSphere(bO,i9)===null||Sm.origin.distanceToSquared(i9)>(e.far-e.near)**2))&&(t9.copy(s).invert(),Sm.copy(e.ray).applyMatrix4(t9),!(n.boundingBox!==null&&Sm.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,i,Sm)))}_computeIntersections(e,i,n){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,u=s.attributes.uv,d=s.attributes.uv1,p=s.attributes.normal,v=s.groups,y=s.drawRange;if(a!==null)if(Array.isArray(o))for(let w=0,R=v.length;w<R;w++){const O=v[w],P=o[O.materialIndex],N=Math.max(O.start,y.start),F=Math.min(a.count,Math.min(O.start+O.count,y.start+y.count));for(let k=N,$=F;k<$;k+=3){const W=a.getX(k),Q=a.getX(k+1),Y=a.getX(k+2);r=MO(this,P,e,n,u,d,p,W,Q,Y),r&&(r.faceIndex=Math.floor(k/3),r.face.materialIndex=O.materialIndex,i.push(r))}}else{const w=Math.max(0,y.start),R=Math.min(a.count,y.start+y.count);for(let O=w,P=R;O<P;O+=3){const N=a.getX(O),F=a.getX(O+1),k=a.getX(O+2);r=MO(this,o,e,n,u,d,p,N,F,k),r&&(r.faceIndex=Math.floor(O/3),i.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let w=0,R=v.length;w<R;w++){const O=v[w],P=o[O.materialIndex],N=Math.max(O.start,y.start),F=Math.min(l.count,Math.min(O.start+O.count,y.start+y.count));for(let k=N,$=F;k<$;k+=3){const W=k,Q=k+1,Y=k+2;r=MO(this,P,e,n,u,d,p,W,Q,Y),r&&(r.faceIndex=Math.floor(k/3),r.face.materialIndex=O.materialIndex,i.push(r))}}else{const w=Math.max(0,y.start),R=Math.min(l.count,y.start+y.count);for(let O=w,P=R;O<P;O+=3){const N=O,F=O+1,k=O+2;r=MO(this,o,e,n,u,d,p,N,F,k),r&&(r.faceIndex=Math.floor(O/3),i.push(r))}}}}function vZe(t,e,i,n,r,s,o,a){let l;if(e.side===Ha?l=n.intersectTriangle(o,s,r,!0,a):l=n.intersectTriangle(r,s,o,e.side===kh,a),l===null)return null;OO.copy(a),OO.applyMatrix4(t.matrixWorld);const u=i.ray.origin.distanceTo(OO);return u<i.near||u>i.far?null:{distance:u,point:OO.clone(),object:t}}function MO(t,e,i,n,r,s,o,a,l,u){t.getVertexPosition(a,wO),t.getVertexPosition(l,_O),t.getVertexPosition(u,CO);const d=vZe(t,e,i,n,wO,_O,CO,n9);if(d){const p=new Ie;hl.getBarycoord(n9,wO,_O,CO,p),r&&(d.uv=hl.getInterpolatedAttribute(r,a,l,u,p,new Xt)),s&&(d.uv1=hl.getInterpolatedAttribute(s,a,l,u,p,new Xt)),o&&(d.normal=hl.getInterpolatedAttribute(o,a,l,u,p,new Ie),d.normal.dot(n.direction)>0&&d.normal.multiplyScalar(-1));const v={a,b:l,c:u,normal:new Ie,materialIndex:0};hl.getNormal(wO,_O,CO,v.normal),d.face=v,d.barycoord=p}return d}class Hp extends Rn{constructor(e=1,i=1,n=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],u=[],d=[],p=[];let v=0,y=0;w("z","y","x",-1,-1,n,i,e,o,s,0),w("z","y","x",1,-1,n,i,-e,o,s,1),w("x","z","y",1,1,e,n,i,r,o,2),w("x","z","y",1,-1,e,n,-i,r,o,3),w("x","y","z",1,-1,e,i,n,r,s,4),w("x","y","z",-1,-1,e,i,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new Hi(u,3)),this.setAttribute("normal",new Hi(d,3)),this.setAttribute("uv",new Hi(p,2));function w(R,O,P,N,F,k,$,W,Q,Y,M){const D=k/Q,G=$/Y,j=k/2,Z=$/2,ie=W/2,le=Q+1,me=Y+1;let be=0,fe=0;const Fe=new Ie;for(let He=0;He<me;He++){const je=He*G-Z;for(let qe=0;qe<le;qe++){const ct=qe*D-j;Fe[R]=ct*N,Fe[O]=je*F,Fe[P]=ie,u.push(Fe.x,Fe.y,Fe.z),Fe[R]=0,Fe[O]=0,Fe[P]=W>0?1:-1,d.push(Fe.x,Fe.y,Fe.z),p.push(qe/Q),p.push(1-He/Y),be+=1}}for(let He=0;He<Y;He++)for(let je=0;je<Q;je++){const qe=v+je+le*He,ct=v+je+le*(He+1),Ge=v+(je+1)+le*(He+1),Je=v+(je+1)+le*He;l.push(qe,ct,Je),l.push(ct,Ge,Je),fe+=6}a.addGroup(y,fe,M),y+=fe,v+=be}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hp(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function q0(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][n]=null):e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function Pa(t){const e={};for(let i=0;i<t.length;i++){const n=q0(t[i]);for(const r in n)e[r]=n[r]}return e}function yZe(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}function Cre(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Xn.workingColorSpace}const tS={clone:q0,merge:Pa};var xZe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,bZe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Qc extends po{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=xZe,this.fragmentShader=bZe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=q0(e.uniforms),this.uniformsGroups=yZe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?i.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?i.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?i.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?i.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?i.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?i.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?i.uniforms[r]={type:"m4",value:o.toArray()}:i.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(i.extensions=n),i}}class gL extends Qn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new sn,this.projectionMatrix=new sn,this.projectionMatrixInverse=new sn,this.coordinateSystem=wu}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Gf=new Ie,r9=new Xt,s9=new Xt;class ho extends gL{constructor(e=50,i=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=W0*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(_g*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return W0*2*Math.atan(Math.tan(_g*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,n){Gf.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Gf.x,Gf.y).multiplyScalar(-e/Gf.z),Gf.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Gf.x,Gf.y).multiplyScalar(-e/Gf.z)}getViewSize(e,i){return this.getViewBounds(e,r9,s9),i.subVectors(s9,r9)}setViewOffset(e,i,n,r,s,o){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(_g*.5*this.fov)/this.zoom,n=2*i,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,u=o.fullHeight;s+=o.offsetX*r/l,i-=o.offsetY*n/u,r*=o.width/l,n*=o.height/u}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,i,i-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const wy=-90,_y=1;class Sre extends Qn{constructor(e,i,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new ho(wy,_y,e,i);r.layers=this.layers,this.add(r);const s=new ho(wy,_y,e,i);s.layers=this.layers,this.add(s);const o=new ho(wy,_y,e,i);o.layers=this.layers,this.add(o);const a=new ho(wy,_y,e,i);a.layers=this.layers,this.add(a);const l=new ho(wy,_y,e,i);l.layers=this.layers,this.add(l);const u=new ho(wy,_y,e,i);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,i=this.children.concat(),[n,r,s,o,a,l]=i;for(const u of i)this.remove(u);if(e===wu)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===hC)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of i)this.add(u),u.updateMatrixWorld()}update(e,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,u,d]=this.children,p=e.getRenderTarget(),v=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),w=e.xr.enabled;e.xr.enabled=!1;const R=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(i,s),e.setRenderTarget(n,1,r),e.render(i,o),e.setRenderTarget(n,2,r),e.render(i,a),e.setRenderTarget(n,3,r),e.render(i,l),e.setRenderTarget(n,4,r),e.render(i,u),n.texture.generateMipmaps=R,e.setRenderTarget(n,5,r),e.render(i,d),e.setRenderTarget(p,v,y),e.xr.enabled=w,n.texture.needsPMREMUpdate=!0}}class iS extends ds{constructor(e=[],i=Xd,n,r,s,o,a,l,u,d){super(e,i,n,r,s,o,a,l,u,d),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Ore extends Lh{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new iS(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Ps}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Hp(5,5,5),s=new Qc({name:"CubemapFromEquirect",uniforms:q0(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ha,blending:Ld});s.uniforms.tEquirect.value=i;const o=new us(r,s),a=i.minFilter;return i.minFilter===Fc&&(i.minFilter=Ps),new Sre(1,10,this).update(e,o),i.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,i=!0,n=!0,r=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(i,n,r);e.setRenderTarget(s)}}class Xl extends Qn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const wZe={type:"move"};class VM{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Xl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Xl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ie,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ie),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Xl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ie,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ie),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const i=this._hand;if(i)for(const n of e.hand.values())this._getHandJoint(i,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,n){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,u=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(u&&e.hand){o=!0;for(const R of e.hand.values()){const O=i.getJointPose(R,n),P=this._getHandJoint(u,R);O!==null&&(P.matrix.fromArray(O.transform.matrix),P.matrix.decompose(P.position,P.rotation,P.scale),P.matrixWorldNeedsUpdate=!0,P.jointRadius=O.radius),P.visible=O!==null}const d=u.joints["index-finger-tip"],p=u.joints["thumb-tip"],v=d.position.distanceTo(p.position),y=.02,w=.005;u.inputState.pinching&&v>y+w?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&v<=y-w&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=i.getPose(e.gripSpace,n),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=i.getPose(e.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(wZe)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),u!==null&&(u.visible=o!==null),this}_getHandJoint(e,i){if(e.joints[i.jointName]===void 0){const n=new Xl;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[i.jointName]=n,e.add(n)}return e.joints[i.jointName]}}class vL{constructor(e,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new Si(e),this.density=i}clone(){return new vL(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class yL{constructor(e,i=1,n=1e3){this.isFog=!0,this.name="",this.color=new Si(e),this.near=i,this.far=n}clone(){return new yL(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}let jH=class extends Qn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new sc,this.environmentIntensity=1,this.environmentRotation=new sc,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}};class nS{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=uC,this.updateRanges=[],this.version=0,this.uuid=tc()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,n){e*=this.stride,n*=i.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=i.array[n+r];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=tc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(i,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=tc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ra=new Ie;class yl{constructor(e,i,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,n=this.data.count;i<n;i++)Ra.fromBufferAttribute(this,i),Ra.applyMatrix4(e),this.setXYZ(i,Ra.x,Ra.y,Ra.z);return this}applyNormalMatrix(e){for(let i=0,n=this.count;i<n;i++)Ra.fromBufferAttribute(this,i),Ra.applyNormalMatrix(e),this.setXYZ(i,Ra.x,Ra.y,Ra.z);return this}transformDirection(e){for(let i=0,n=this.count;i<n;i++)Ra.fromBufferAttribute(this,i),Ra.transformDirection(e),this.setXYZ(i,Ra.x,Ra.y,Ra.z);return this}getComponent(e,i){let n=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(n=La(n,this.array)),n}setComponent(e,i,n){return this.normalized&&(n=In(n,this.array)),this.data.array[e*this.data.stride+this.offset+i]=n,this}setX(e,i){return this.normalized&&(i=In(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=In(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=In(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=In(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=La(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=La(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=La(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=La(i,this.array)),i}setXY(e,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(i=In(i,this.array),n=In(n,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this}setXYZ(e,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=In(i,this.array),n=In(n,this.array),r=In(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,i,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=In(i,this.array),n=In(n,this.array),r=In(r,this.array),s=In(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[r+s])}return new xr(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new yl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class QH extends po{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Si(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Cy;const nw=new Ie,Sy=new Ie,Oy=new Ie,My=new Xt,rw=new Xt,Mre=new sn,TO=new Ie,sw=new Ie,RO=new Ie,o9=new Xt,wB=new Xt,a9=new Xt;class Tre extends Qn{constructor(e=new QH){if(super(),this.isSprite=!0,this.type="Sprite",Cy===void 0){Cy=new Rn;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new nS(i,5);Cy.setIndex([0,1,2,0,2,3]),Cy.setAttribute("position",new yl(n,3,0,!1)),Cy.setAttribute("uv",new yl(n,2,3,!1))}this.geometry=Cy,this.material=e,this.center=new Xt(.5,.5)}raycast(e,i){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Sy.setFromMatrixScale(this.matrixWorld),Mre.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Oy.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Sy.multiplyScalar(-Oy.z);const n=this.material.rotation;let r,s;n!==0&&(s=Math.cos(n),r=Math.sin(n));const o=this.center;PO(TO.set(-.5,-.5,0),Oy,o,Sy,r,s),PO(sw.set(.5,-.5,0),Oy,o,Sy,r,s),PO(RO.set(.5,.5,0),Oy,o,Sy,r,s),o9.set(0,0),wB.set(1,0),a9.set(1,1);let a=e.ray.intersectTriangle(TO,sw,RO,!1,nw);if(a===null&&(PO(sw.set(-.5,.5,0),Oy,o,Sy,r,s),wB.set(0,1),a=e.ray.intersectTriangle(TO,RO,sw,!1,nw),a===null))return;const l=e.ray.origin.distanceTo(nw);l<e.near||l>e.far||i.push({distance:l,point:nw.clone(),uv:hl.getInterpolation(nw,TO,sw,RO,o9,wB,a9,new Xt),face:null,object:this})}copy(e,i){return super.copy(e,i),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function PO(t,e,i,n,r,s){My.subVectors(t,i).addScalar(.5).multiply(n),r!==void 0?(rw.x=s*My.x-r*My.y,rw.y=r*My.x+s*My.y):rw.copy(My),t.copy(e),t.x+=rw.x,t.y+=rw.y,t.applyMatrix4(Mre)}const EO=new Ie,l9=new Ie;class Rre extends Qn{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const i=e.levels;for(let n=0,r=i.length;n<r;n++){const s=i[n];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,i=0,n=0){i=Math.abs(i);const r=this.levels;let s;for(s=0;s<r.length&&!(i<r[s].distance);s++);return r.splice(s,0,{distance:i,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const i=this.levels;for(let n=0;n<i.length;n++)if(i[n].distance===e){const r=i.splice(n,1);return this.remove(r[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const i=this.levels;if(i.length>0){let n,r;for(n=1,r=i.length;n<r;n++){let s=i[n].distance;if(i[n].object.visible&&(s-=s*i[n].hysteresis),e<s)break}return i[n-1].object}return null}raycast(e,i){if(this.levels.length>0){EO.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(EO);this.getObjectForDistance(r).raycast(e,i)}}update(e){const i=this.levels;if(i.length>1){EO.setFromMatrixPosition(e.matrixWorld),l9.setFromMatrixPosition(this.matrixWorld);const n=EO.distanceTo(l9)/e.zoom;i[0].object.visible=!0;let r,s;for(r=1,s=i.length;r<s;r++){let o=i[r].distance;if(i[r].object.visible&&(o-=o*i[r].hysteresis),n>=o)i[r-1].object.visible=!1,i[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<s;r++)i[r].object.visible=!1}}toJSON(e){const i=super.toJSON(e);this.autoUpdate===!1&&(i.object.autoUpdate=!1),i.object.levels=[];const n=this.levels;for(let r=0,s=n.length;r<s;r++){const o=n[r];i.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return i}}const c9=new Ie,u9=new Mn,h9=new Mn,_Ze=new Ie,d9=new sn,AO=new Ie,_B=new Hs,f9=new sn,CB=new sv;class ZH extends us{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=MV,this.bindMatrix=new sn,this.bindMatrixInverse=new sn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Es),this.boundingBox.makeEmpty();const i=e.getAttribute("position");for(let n=0;n<i.count;n++)this.getVertexPosition(n,AO),this.boundingBox.expandByPoint(AO)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Hs),this.boundingSphere.makeEmpty();const i=e.getAttribute("position");for(let n=0;n<i.count;n++)this.getVertexPosition(n,AO),this.boundingSphere.expandByPoint(AO)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){const n=this.material,r=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_B.copy(this.boundingSphere),_B.applyMatrix4(r),e.ray.intersectsSphere(_B)!==!1&&(f9.copy(r).invert(),CB.copy(e.ray).applyMatrix4(f9),!(this.boundingBox!==null&&CB.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,i,CB)))}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Mn,i=this.geometry.attributes.skinWeight;for(let n=0,r=i.count;n<r;n++){e.fromBufferAttribute(i,n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),i.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===MV?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===nre?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){const n=this.skeleton,r=this.geometry;u9.fromBufferAttribute(r.attributes.skinIndex,e),h9.fromBufferAttribute(r.attributes.skinWeight,e),c9.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let s=0;s<4;s++){const o=h9.getComponent(s);if(o!==0){const a=u9.getComponent(s);d9.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),i.addScaledVector(_Ze.copy(c9).applyMatrix4(d9),o)}}return i.applyMatrix4(this.bindMatrixInverse)}}class xL extends Qn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class bh extends ds{constructor(e=null,i=1,n=1,r,s,o,a,l,u=fo,d=fo,p,v){super(null,o,a,l,u,d,r,s,p,v),this.isDataTexture=!0,this.image={data:e,width:i,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const p9=new sn,CZe=new sn;class rS{constructor(e=[],i=[]){this.uuid=tc(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new sn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const n=new sn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,i=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:CZe;p9.multiplyMatrices(a,i[s]),p9.toArray(n,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new rS(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const n=new bh(i,e,e,za,gl);return n.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=n,this}getBoneByName(e){for(let i=0,n=this.bones.length;i<n;i++){const r=this.bones[i];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const s=e.bones[n];let o=i[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new xL),this.bones.push(o),this.boneInverses.push(new sn().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,n=this.boneInverses;for(let r=0,s=i.length;r<s;r++){const o=i[r];e.bones.push(o.uuid);const a=n[r];e.boneInverses.push(a.toArray())}return e}}class Hg extends xr{constructor(e,i,n,r=1){super(e,i,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Ty=new sn,m9=new sn,IO=[],g9=new Es,SZe=new sn,ow=new us,aw=new Hs;class bL extends us{constructor(e,i,n){super(e,i),this.isInstancedMesh=!0,this.instanceMatrix=new Hg(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<n;r++)this.setMatrixAt(r,SZe)}computeBoundingBox(){const e=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new Es),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<i;n++)this.getMatrixAt(n,Ty),g9.copy(e.boundingBox).applyMatrix4(Ty),this.boundingBox.union(g9)}computeBoundingSphere(){const e=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new Hs),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<i;n++)this.getMatrixAt(n,Ty),aw.copy(e.boundingSphere).applyMatrix4(Ty),this.boundingSphere.union(aw)}copy(e,i){return super.copy(e,i),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,i){i.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,i){i.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,i){const n=i.morphTargetInfluences,r=this.morphTexture.source.data.data,s=n.length+1,o=e*s+1;for(let a=0;a<n.length;a++)n[a]=r[o+a]}raycast(e,i){const n=this.matrixWorld,r=this.count;if(ow.geometry=this.geometry,ow.material=this.material,ow.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),aw.copy(this.boundingSphere),aw.applyMatrix4(n),e.ray.intersectsSphere(aw)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,Ty),m9.multiplyMatrices(n,Ty),ow.matrixWorld=m9,ow.raycast(e,IO);for(let o=0,a=IO.length;o<a;o++){const l=IO[o];l.instanceId=s,l.object=this,i.push(l)}IO.length=0}}setColorAt(e,i){this.instanceColor===null&&(this.instanceColor=new Hg(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),i.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,i){i.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,i){const n=i.morphTargetInfluences,r=n.length+1;this.morphTexture===null&&(this.morphTexture=new bh(new Float32Array(r*this.count),r,this.count,cL,gl));const s=this.morphTexture.source.data.data;let o=0;for(let u=0;u<n.length;u++)o+=n[u];const a=this.geometry.morphTargetsRelative?1:1-o,l=r*e;s[l]=a,s.set(n,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const SB=new Ie,OZe=new Ie,MZe=new wn;class ep{constructor(e=new Ie(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,n,r){return this.normal.set(e,i,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,n){const r=SB.subVectors(n,i).cross(OZe.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){const n=e.delta(SB),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:i.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const i=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return i<0&&n>0||n<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const n=i||MZe.getNormalMatrix(e),r=this.coplanarPoint(SB).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Om=new Hs,kO=new Ie;class sS{constructor(e=new ep,i=new ep,n=new ep,r=new ep,s=new ep,o=new ep){this.planes=[e,i,n,r,s,o]}set(e,i,n,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(i),a[2].copy(n),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const i=this.planes;for(let n=0;n<6;n++)i[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,i=wu){const n=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],u=r[4],d=r[5],p=r[6],v=r[7],y=r[8],w=r[9],R=r[10],O=r[11],P=r[12],N=r[13],F=r[14],k=r[15];if(n[0].setComponents(l-s,v-u,O-y,k-P).normalize(),n[1].setComponents(l+s,v+u,O+y,k+P).normalize(),n[2].setComponents(l+o,v+d,O+w,k+N).normalize(),n[3].setComponents(l-o,v-d,O-w,k-N).normalize(),n[4].setComponents(l-a,v-p,O-R,k-F).normalize(),i===wu)n[5].setComponents(l+a,v+p,O+R,k+F).normalize();else if(i===hC)n[5].setComponents(a,p,R,F).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Om.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const i=e.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),Om.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Om)}intersectsSprite(e){return Om.center.set(0,0,0),Om.radius=.7071067811865476,Om.applyMatrix4(e.matrixWorld),this.intersectsSphere(Om)}intersectsSphere(e){const i=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(i[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const i=this.planes;for(let n=0;n<6;n++){const r=i[n];if(kO.x=r.normal.x>0?e.max.x:e.min.x,kO.y=r.normal.y>0?e.max.y:e.min.y,kO.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(kO)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let n=0;n<6;n++)if(i[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function OB(t,e){return t-e}function TZe(t,e){return t.z-e.z}function RZe(t,e){return e.z-t.z}class PZe{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,i,n,r){const s=this.pool,o=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const a=s[this.index];o.push(a),this.index++,a.start=e,a.count=i,a.z=n,a.index=r}reset(){this.list.length=0,this.index=0}}const rl=new sn,EZe=new Si(1,1,1),MB=new sS,DO=new Es,Mm=new Hs,lw=new Ie,v9=new Ie,AZe=new Ie,TB=new PZe,sa=new us,LO=[];function IZe(t,e,i=0){const n=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const r=t.count;for(let s=0;s<r;s++)for(let o=0;o<n;o++)e.setComponent(s+i,o,t.getComponent(s,o))}else e.array.set(t.array,i*n);e.needsUpdate=!0}function Tm(t,e){if(t.constructor!==e.constructor){const i=Math.min(t.length,e.length);for(let n=0;n<i;n++)e[n]=t[n]}else{const i=Math.min(t.length,e.length);e.set(new t.constructor(t.buffer,0,i))}}class Pre extends us{constructor(e,i,n=i*2,r){super(new Rn,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=i,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4),n=new bh(i,e,e,za,gl);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const i=new Uint32Array(e*e),n=new bh(i,e,e,JC,Kd);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const i=new Float32Array(e*e*4).fill(1),n=new bh(i,e,e,za,gl);n.colorSpace=Xn.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const i=this.geometry,n=this._maxVertexCount,r=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const o=e.getAttribute(s),{array:a,itemSize:l,normalized:u}=o,d=new a.constructor(n*l),p=new xr(d,l,u);i.setAttribute(s,p)}if(e.getIndex()!==null){const s=n>65535?new Uint32Array(r):new Uint16Array(r);i.setIndex(new xr(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const i=this.geometry;if(!!e.getIndex()!=!!i.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in i.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const r=e.getAttribute(n),s=i.getAttribute(n);if(r.itemSize!==s.itemSize||r.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const i=this._instanceInfo;if(e<0||e>=i.length||i[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const i=this._geometryInfo;if(e<0||e>=i.length||i[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Es);const e=this.boundingBox,i=this._instanceInfo;e.makeEmpty();for(let n=0,r=i.length;n<r;n++){if(i[n].active===!1)continue;const s=i[n].geometryIndex;this.getMatrixAt(n,rl),this.getBoundingBoxAt(s,DO).applyMatrix4(rl),e.union(DO)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Hs);const e=this.boundingSphere,i=this._instanceInfo;e.makeEmpty();for(let n=0,r=i.length;n<r;n++){if(i[n].active===!1)continue;const s=i[n].geometryIndex;this.getMatrixAt(n,rl),this.getBoundingSphereAt(s,Mm).applyMatrix4(rl),e.union(Mm)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const n={visible:!0,active:!0,geometryIndex:e};let r=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(OB),r=this._availableInstanceIds.shift(),this._instanceInfo[r]=n):(r=this._instanceInfo.length,this._instanceInfo.push(n));const s=this._matricesTexture;rl.identity().toArray(s.image.data,r*16),s.needsUpdate=!0;const o=this._colorsTexture;return o&&(EZe.toArray(o.image.data,r*4),o.needsUpdate=!0),this._visibilityChanged=!0,r}addGeometry(e,i=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=i===-1?e.getAttribute("position").count:i;const o=e.getIndex();if(o!==null&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=n===-1?o.count:n),r.indexStart!==-1&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(OB),l=this._availableGeometryIds.shift(),s[l]=r):(l=this._geometryCount,this._geometryCount++,s.push(r)),this.setGeometryAt(l,e),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,l}setGeometryAt(e,i){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const n=this.geometry,r=n.getIndex()!==null,s=n.getIndex(),o=i.getIndex(),a=this._geometryInfo[e];if(r&&o.count>a.reservedIndexCount||i.attributes.position.count>a.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const l=a.vertexStart,u=a.reservedVertexCount;a.vertexCount=i.getAttribute("position").count;for(const d in n.attributes){const p=i.getAttribute(d),v=n.getAttribute(d);IZe(p,v,l);const y=p.itemSize;for(let w=p.count,R=u;w<R;w++){const O=l+w;for(let P=0;P<y;P++)v.setComponent(O,P,0)}v.needsUpdate=!0,v.addUpdateRange(l*y,u*y)}if(r){const d=a.indexStart,p=a.reservedIndexCount;a.indexCount=i.getIndex().count;for(let v=0;v<o.count;v++)s.setX(d+v,l+o.getX(v));for(let v=o.count,y=p;v<y;v++)s.setX(d+v,l);s.needsUpdate=!0,s.addUpdateRange(d,a.reservedIndexCount)}return a.start=r?a.indexStart:a.vertexStart,a.count=r?a.indexCount:a.vertexCount,a.boundingBox=null,i.boundingBox!==null&&(a.boundingBox=i.boundingBox.clone()),a.boundingSphere=null,i.boundingSphere!==null&&(a.boundingSphere=i.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const i=this._geometryInfo;if(e>=i.length||i[e].active===!1)return this;const n=this._instanceInfo;for(let r=0,s=n.length;r<s;r++)n[r].active&&n[r].geometryIndex===e&&this.deleteInstance(r);return i[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,i=0;const n=this._geometryInfo,r=n.map((o,a)=>a).sort((o,a)=>n[o].vertexStart-n[a].vertexStart),s=this.geometry;for(let o=0,a=n.length;o<a;o++){const l=r[o],u=n[l];if(u.active!==!1){if(s.index!==null){if(u.indexStart!==i){const{indexStart:d,vertexStart:p,reservedIndexCount:v}=u,y=s.index,w=y.array,R=e-p;for(let O=d;O<d+v;O++)w[O]=w[O]+R;y.array.copyWithin(i,d,d+v),y.addUpdateRange(i,v),u.indexStart=i}i+=u.reservedIndexCount}if(u.vertexStart!==e){const{vertexStart:d,reservedVertexCount:p}=u,v=s.attributes;for(const y in v){const w=v[y],{array:R,itemSize:O}=w;R.copyWithin(e*O,d*O,(d+p)*O),w.addUpdateRange(e*O,p*O)}u.vertexStart=e}e+=u.reservedVertexCount,u.start=s.index?u.indexStart:u.vertexStart,this._nextIndexStart=s.index?u.indexStart+u.reservedIndexCount:0,this._nextVertexStart=u.vertexStart+u.reservedVertexCount}}return this}getBoundingBoxAt(e,i){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(r.boundingBox===null){const s=new Es,o=n.index,a=n.attributes.position;for(let l=r.start,u=r.start+r.count;l<u;l++){let d=l;o&&(d=o.getX(d)),s.expandByPoint(lw.fromBufferAttribute(a,d))}r.boundingBox=s}return i.copy(r.boundingBox),i}getBoundingSphereAt(e,i){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(r.boundingSphere===null){const s=new Hs;this.getBoundingBoxAt(e,DO),DO.getCenter(s.center);const o=n.index,a=n.attributes.position;let l=0;for(let u=r.start,d=r.start+r.count;u<d;u++){let p=u;o&&(p=o.getX(p)),lw.fromBufferAttribute(a,p),l=Math.max(l,s.center.distanceToSquared(lw))}s.radius=Math.sqrt(l),r.boundingSphere=s}return i.copy(r.boundingSphere),i}setMatrixAt(e,i){this.validateInstanceId(e);const n=this._matricesTexture,r=this._matricesTexture.image.data;return i.toArray(r,e*16),n.needsUpdate=!0,this}getMatrixAt(e,i){return this.validateInstanceId(e),i.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,i){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),i.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,i){return this.validateInstanceId(e),i.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,i){return this.validateInstanceId(e),this._instanceInfo[e].visible===i?this:(this._instanceInfo[e].visible=i,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,i){return this.validateInstanceId(e),this.validateGeometryId(i),this._instanceInfo[e].geometryIndex=i,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,i={}){this.validateGeometryId(e);const n=this._geometryInfo[e];return i.vertexStart=n.vertexStart,i.vertexCount=n.vertexCount,i.reservedVertexCount=n.reservedVertexCount,i.indexStart=n.indexStart,i.indexCount=n.indexCount,i.reservedIndexCount=n.reservedIndexCount,i.start=n.start,i.count=n.count,i}setInstanceCount(e){const i=this._availableInstanceIds,n=this._instanceInfo;for(i.sort(OB);i[i.length-1]===n.length;)n.pop(),i.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const r=new Int32Array(e),s=new Int32Array(e);Tm(this._multiDrawCounts,r),Tm(this._multiDrawStarts,s),this._multiDrawCounts=r,this._multiDrawStarts=s,this._maxInstanceCount=e;const o=this._indirectTexture,a=this._matricesTexture,l=this._colorsTexture;o.dispose(),this._initIndirectTexture(),Tm(o.image.data,this._indirectTexture.image.data),a.dispose(),this._initMatricesTexture(),Tm(a.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),Tm(l.image.data,this._colorsTexture.image.data))}setGeometrySize(e,i){const n=[...this._geometryInfo].filter(a=>a.active);if(Math.max(...n.map(a=>a.vertexStart+a.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${i}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(l=>l.indexStart+l.reservedIndexCount))>i)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${i}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=i,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Rn,this._initializeGeometry(s));const o=this.geometry;s.index&&Tm(s.index.array,o.index.array);for(const a in s.attributes)Tm(s.attributes[a].array,o.attributes[a].array)}raycast(e,i){const n=this._instanceInfo,r=this._geometryInfo,s=this.matrixWorld,o=this.geometry;sa.material=this.material,sa.geometry.index=o.index,sa.geometry.attributes=o.attributes,sa.geometry.boundingBox===null&&(sa.geometry.boundingBox=new Es),sa.geometry.boundingSphere===null&&(sa.geometry.boundingSphere=new Hs);for(let a=0,l=n.length;a<l;a++){if(!n[a].visible||!n[a].active)continue;const u=n[a].geometryIndex,d=r[u];sa.geometry.setDrawRange(d.start,d.count),this.getMatrixAt(a,sa.matrixWorld).premultiply(s),this.getBoundingBoxAt(u,sa.geometry.boundingBox),this.getBoundingSphereAt(u,sa.geometry.boundingSphere),sa.raycast(e,LO);for(let p=0,v=LO.length;p<v;p++){const y=LO[p];y.object=this,y.batchId=a,i.push(y)}LO.length=0}sa.material=null,sa.geometry.index=null,sa.geometry.attributes={},sa.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(i=>({...i,boundingBox:i.boundingBox!==null?i.boundingBox.clone():null,boundingSphere:i.boundingSphere!==null?i.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(i=>({...i})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,i,n,r,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=r.getIndex(),a=o===null?1:o.array.BYTES_PER_ELEMENT,l=this._instanceInfo,u=this._multiDrawStarts,d=this._multiDrawCounts,p=this._geometryInfo,v=this.perObjectFrustumCulled,y=this._indirectTexture,w=y.image.data;v&&(rl.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),MB.setFromProjectionMatrix(rl,e.coordinateSystem));let R=0;if(this.sortObjects){rl.copy(this.matrixWorld).invert(),lw.setFromMatrixPosition(n.matrixWorld).applyMatrix4(rl),v9.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(rl);for(let N=0,F=l.length;N<F;N++)if(l[N].visible&&l[N].active){const k=l[N].geometryIndex;this.getMatrixAt(N,rl),this.getBoundingSphereAt(k,Mm).applyMatrix4(rl);let $=!1;if(v&&($=!MB.intersectsSphere(Mm)),!$){const W=p[k],Q=AZe.subVectors(Mm.center,lw).dot(v9);TB.push(W.start,W.count,Q,N)}}const O=TB.list,P=this.customSort;P===null?O.sort(s.transparent?RZe:TZe):P.call(this,O,n);for(let N=0,F=O.length;N<F;N++){const k=O[N];u[R]=k.start*a,d[R]=k.count,w[R]=k.index,R++}TB.reset()}else for(let O=0,P=l.length;O<P;O++)if(l[O].visible&&l[O].active){const N=l[O].geometryIndex;let F=!1;if(v&&(this.getMatrixAt(O,rl),this.getBoundingSphereAt(N,Mm).applyMatrix4(rl),F=!MB.intersectsSphere(Mm)),!F){const k=p[N];u[R]=k.start*a,d[R]=k.count,w[R]=O,R++}}y.needsUpdate=!0,this._multiDrawCount=R,this._visibilityChanged=!1}onBeforeShadow(e,i,n,r,s,o){this.onBeforeRender(e,null,r,s,o)}}class xa extends po{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Si(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const $R=new Ie,WR=new Ie,y9=new sn,cw=new sv,FO=new Hs,RB=new Ie,x9=new Ie;class Yd extends Qn{constructor(e=new Rn,i=new xa){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,n=[0];for(let r=1,s=i.count;r<s;r++)$R.fromBufferAttribute(i,r-1),WR.fromBufferAttribute(i,r),n[r]=n[r-1],n[r]+=$R.distanceTo(WR);e.setAttribute("lineDistance",new Hi(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){const n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),FO.copy(n.boundingSphere),FO.applyMatrix4(r),FO.radius+=s,e.ray.intersectsSphere(FO)===!1)return;y9.copy(r).invert(),cw.copy(e.ray).applyMatrix4(y9);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,u=this.isLineSegments?2:1,d=n.index,v=n.attributes.position;if(d!==null){const y=Math.max(0,o.start),w=Math.min(d.count,o.start+o.count);for(let R=y,O=w-1;R<O;R+=u){const P=d.getX(R),N=d.getX(R+1),F=NO(this,e,cw,l,P,N,R);F&&i.push(F)}if(this.isLineLoop){const R=d.getX(w-1),O=d.getX(y),P=NO(this,e,cw,l,R,O,w-1);P&&i.push(P)}}else{const y=Math.max(0,o.start),w=Math.min(v.count,o.start+o.count);for(let R=y,O=w-1;R<O;R+=u){const P=NO(this,e,cw,l,R,R+1,R);P&&i.push(P)}if(this.isLineLoop){const R=NO(this,e,cw,l,w-1,y,w-1);R&&i.push(R)}}}updateMorphTargets(){const i=this.geometry.morphAttributes,n=Object.keys(i);if(n.length>0){const r=i[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function NO(t,e,i,n,r,s,o){const a=t.geometry.attributes.position;if($R.fromBufferAttribute(a,r),WR.fromBufferAttribute(a,s),i.distanceSqToSegment($R,WR,RB,x9)>n)return;RB.applyMatrix4(t.matrixWorld);const u=e.ray.origin.distanceTo(RB);if(!(u<e.near||u>e.far))return{distance:u,point:x9.clone().applyMatrix4(t.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:t}}const b9=new Ie,w9=new Ie;class Eu extends Yd{constructor(e,i){super(e,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,n=[];for(let r=0,s=i.count;r<s;r+=2)b9.fromBufferAttribute(i,r),w9.fromBufferAttribute(i,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+b9.distanceTo(w9);e.setAttribute("lineDistance",new Hi(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class XH extends Yd{constructor(e,i){super(e,i),this.isLineLoop=!0,this.type="LineLoop"}}class wL extends po{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Si(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const _9=new sn,PV=new sv,BO=new Hs,zO=new Ie;class KH extends Qn{constructor(e=new Rn,i=new wL){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,i){const n=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),BO.copy(n.boundingSphere),BO.applyMatrix4(r),BO.radius+=s,e.ray.intersectsSphere(BO)===!1)return;_9.copy(r).invert(),PV.copy(e.ray).applyMatrix4(_9);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,u=n.index,p=n.attributes.position;if(u!==null){const v=Math.max(0,o.start),y=Math.min(u.count,o.start+o.count);for(let w=v,R=y;w<R;w++){const O=u.getX(w);zO.fromBufferAttribute(p,O),C9(zO,O,l,r,e,i,this)}}else{const v=Math.max(0,o.start),y=Math.min(p.count,o.start+o.count);for(let w=v,R=y;w<R;w++)zO.fromBufferAttribute(p,w),C9(zO,w,l,r,e,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,n=Object.keys(i);if(n.length>0){const r=i[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function C9(t,e,i,n,r,s,o){const a=PV.distanceSqToPoint(t);if(a<i){const l=new Ie;PV.closestPointToPoint(t,l),l.applyMatrix4(n);const u=r.ray.origin.distanceTo(l);if(u<r.near||u>r.far)return;s.push({distance:u,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class Ere extends ds{constructor(e,i,n,r,s=Ps,o=Ps,a,l,u){super(e,i,n,r,s,o,a,l,u),this.isVideoTexture=!0,this.generateMipmaps=!1;const d=this;function p(){d.needsUpdate=!0,e.requestVideoFrameCallback(p)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(p)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class kZe extends Ere{constructor(e,i,n,r,s,o,a,l){super({},e,i,n,r,s,o,a,l),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class DZe extends ds{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=fo,this.minFilter=fo,this.generateMipmaps=!1,this.needsUpdate=!0}}class _L extends ds{constructor(e,i,n,r,s,o,a,l,u,d,p,v){super(null,o,a,l,u,d,r,s,p,v),this.isCompressedTexture=!0,this.image={width:i,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class LZe extends _L{constructor(e,i,n,r,s,o){super(e,i,n,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Zl,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class FZe extends _L{constructor(e,i,n){super(void 0,e[0].width,e[0].height,i,n,Xd),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class NZe extends ds{constructor(e,i,n,r,s,o,a,l,u){super(e,i,n,r,s,o,a,l,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class YH extends ds{constructor(e,i,n=Kd,r,s,o,a=fo,l=fo,u,d=G0){if(d!==G0&&d!==U0)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,r,s,o,a,l,d,n,u),this.isDepthTexture=!0,this.image={width:e,height:i},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new dp(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const i=super.toJSON(e);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}class Au{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,i){const n=this.getUtoTmapping(e);return this.getPoint(n,i)}getPoints(e=5){const i=[];for(let n=0;n<=e;n++)i.push(this.getPoint(n/e));return i}getSpacedPoints(e=5){const i=[];for(let n=0;n<=e;n++)i.push(this.getPointAt(n/e));return i}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let n,r=this.getPoint(0),s=0;i.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),s+=n.distanceTo(r),i.push(s),r=n;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i=null){const n=this.getLengths();let r=0;const s=n.length;let o;i?o=i:o=e*n[s-1];let a=0,l=s-1,u;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),u=n[r]-o,u<0)a=r+1;else if(u>0)l=r-1;else{l=r;break}if(r=l,n[r]===o)return r/(s-1);const d=n[r],v=n[r+1]-d,y=(o-d)/v;return(r+y)/(s-1)}getTangent(e,i){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=i||(o.isVector2?new Xt:new Ie);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,i){const n=this.getUtoTmapping(e);return this.getTangent(n,i)}computeFrenetFrames(e,i=!1){const n=new Ie,r=[],s=[],o=[],a=new Ie,l=new sn;for(let y=0;y<=e;y++){const w=y/e;r[y]=this.getTangentAt(w,new Ie)}s[0]=new Ie,o[0]=new Ie;let u=Number.MAX_VALUE;const d=Math.abs(r[0].x),p=Math.abs(r[0].y),v=Math.abs(r[0].z);d<=u&&(u=d,n.set(1,0,0)),p<=u&&(u=p,n.set(0,1,0)),v<=u&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let y=1;y<=e;y++){if(s[y]=s[y-1].clone(),o[y]=o[y-1].clone(),a.crossVectors(r[y-1],r[y]),a.length()>Number.EPSILON){a.normalize();const w=Math.acos(Sn(r[y-1].dot(r[y]),-1,1));s[y].applyMatrix4(l.makeRotationAxis(a,w))}o[y].crossVectors(r[y],s[y])}if(i===!0){let y=Math.acos(Sn(s[0].dot(s[e]),-1,1));y/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(y=-y);for(let w=1;w<=e;w++)s[w].applyMatrix4(l.makeRotationAxis(r[w],y*w)),o[w].crossVectors(r[w],s[w])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class CL extends Au{constructor(e=0,i=0,n=1,r=1,s=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,i=new Xt){const n=i,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),u=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const d=Math.cos(this.aRotation),p=Math.sin(this.aRotation),v=l-this.aX,y=u-this.aY;l=v*d-y*p+this.aX,u=v*p+y*d+this.aY}return n.set(l,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Are extends CL{constructor(e,i,n,r,s,o){super(e,i,n,n,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function JH(){let t=0,e=0,i=0,n=0;function r(s,o,a,l){t=s,e=a,i=-3*s+3*o-2*a-l,n=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,u){r(o,a,u*(a-s),u*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,u,d,p){let v=(o-s)/u-(a-s)/(u+d)+(a-o)/d,y=(a-o)/d-(l-o)/(d+p)+(l-a)/p;v*=d,y*=d,r(o,a,v,y)},calc:function(s){const o=s*s,a=o*s;return t+e*s+i*o+n*a}}}const VO=new Ie,PB=new JH,EB=new JH,AB=new JH;class Ire extends Au{constructor(e=[],i=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=n,this.tension=r}getPoint(e,i=new Ie){const n=i,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let u,d;this.closed||a>0?u=r[(a-1)%s]:(VO.subVectors(r[0],r[1]).add(r[0]),u=VO);const p=r[a%s],v=r[(a+1)%s];if(this.closed||a+2<s?d=r[(a+2)%s]:(VO.subVectors(r[s-1],r[s-2]).add(r[s-1]),d=VO),this.curveType==="centripetal"||this.curveType==="chordal"){const y=this.curveType==="chordal"?.5:.25;let w=Math.pow(u.distanceToSquared(p),y),R=Math.pow(p.distanceToSquared(v),y),O=Math.pow(v.distanceToSquared(d),y);R<1e-4&&(R=1),w<1e-4&&(w=R),O<1e-4&&(O=R),PB.initNonuniformCatmullRom(u.x,p.x,v.x,d.x,w,R,O),EB.initNonuniformCatmullRom(u.y,p.y,v.y,d.y,w,R,O),AB.initNonuniformCatmullRom(u.z,p.z,v.z,d.z,w,R,O)}else this.curveType==="catmullrom"&&(PB.initCatmullRom(u.x,p.x,v.x,d.x,this.tension),EB.initCatmullRom(u.y,p.y,v.y,d.y,this.tension),AB.initCatmullRom(u.z,p.z,v.z,d.z,this.tension));return n.set(PB.calc(l),EB.calc(l),AB.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const r=e.points[i];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){const r=this.points[i];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const r=e.points[i];this.points.push(new Ie().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function S9(t,e,i,n,r){const s=(n-e)*.5,o=(r-i)*.5,a=t*t,l=t*a;return(2*i-2*n+s+o)*l+(-3*i+3*n-2*s-o)*a+s*t+i}function BZe(t,e){const i=1-t;return i*i*e}function zZe(t,e){return 2*(1-t)*t*e}function VZe(t,e){return t*t*e}function g_(t,e,i,n){return BZe(t,e)+zZe(t,i)+VZe(t,n)}function GZe(t,e){const i=1-t;return i*i*i*e}function UZe(t,e){const i=1-t;return 3*i*i*t*e}function HZe(t,e){return 3*(1-t)*t*t*e}function $Ze(t,e){return t*t*t*e}function v_(t,e,i,n,r){return GZe(t,e)+UZe(t,i)+HZe(t,n)+$Ze(t,r)}class e5 extends Au{constructor(e=new Xt,i=new Xt,n=new Xt,r=new Xt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=n,this.v3=r}getPoint(e,i=new Xt){const n=i,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(v_(e,r.x,s.x,o.x,a.x),v_(e,r.y,s.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class kre extends Au{constructor(e=new Ie,i=new Ie,n=new Ie,r=new Ie){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=n,this.v3=r}getPoint(e,i=new Ie){const n=i,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(v_(e,r.x,s.x,o.x,a.x),v_(e,r.y,s.y,o.y,a.y),v_(e,r.z,s.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class t5 extends Au{constructor(e=new Xt,i=new Xt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new Xt){const n=i;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new Xt){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Dre extends Au{constructor(e=new Ie,i=new Ie){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new Ie){const n=i;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new Ie){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class i5 extends Au{constructor(e=new Xt,i=new Xt,n=new Xt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new Xt){const n=i,r=this.v0,s=this.v1,o=this.v2;return n.set(g_(e,r.x,s.x,o.x),g_(e,r.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class SL extends Au{constructor(e=new Ie,i=new Ie,n=new Ie){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=n}getPoint(e,i=new Ie){const n=i,r=this.v0,s=this.v1,o=this.v2;return n.set(g_(e,r.x,s.x,o.x),g_(e,r.y,s.y,o.y),g_(e,r.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class n5 extends Au{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new Xt){const n=i,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[o===0?o:o-1],u=r[o],d=r[o>r.length-2?r.length-1:o+1],p=r[o>r.length-3?r.length-1:o+2];return n.set(S9(a,l.x,u.x,d.x,p.x),S9(a,l.y,u.y,d.y,p.y)),n}copy(e){super.copy(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const r=e.points[i];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,n=this.points.length;i<n;i++){const r=this.points[i];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,n=e.points.length;i<n;i++){const r=e.points[i];this.points.push(new Xt().fromArray(r))}return this}}var qR=Object.freeze({__proto__:null,ArcCurve:Are,CatmullRomCurve3:Ire,CubicBezierCurve:e5,CubicBezierCurve3:kre,EllipseCurve:CL,LineCurve:t5,LineCurve3:Dre,QuadraticBezierCurve:i5,QuadraticBezierCurve3:SL,SplineCurve:n5});class Lre extends Au{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(i)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new qR[n](i,e))}return this}getPoint(e,i){const n=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=n){const o=r[s]-n,a=this.curves[s],l=a.getLength(),u=l===0?0:1-o/l;return a.getPointAt(u,i)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let i=0;for(let n=0,r=this.curves.length;n<r;n++)i+=this.curves[n].getLength(),e.push(i);return this.cacheLengths=e,e}getSpacedPoints(e=40){const i=[];for(let n=0;n<=e;n++)i.push(this.getPoint(n/e));return this.autoClose&&i.push(i[0]),i}getPoints(e=12){const i=[];let n;for(let r=0,s=this.curves;r<s.length;r++){const o=s[r],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let u=0;u<l.length;u++){const d=l[u];n&&n.equals(d)||(i.push(d),n=d)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let i=0,n=e.curves.length;i<n;i++){const r=e.curves[i];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let i=0,n=this.curves.length;i<n;i++){const r=this.curves[i];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let i=0,n=e.curves.length;i<n;i++){const r=e.curves[i];this.curves.push(new qR[r.type]().fromJSON(r))}return this}}class fC extends Lre{constructor(e){super(),this.type="Path",this.currentPoint=new Xt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let i=1,n=e.length;i<n;i++)this.lineTo(e[i].x,e[i].y);return this}moveTo(e,i){return this.currentPoint.set(e,i),this}lineTo(e,i){const n=new t5(this.currentPoint.clone(),new Xt(e,i));return this.curves.push(n),this.currentPoint.set(e,i),this}quadraticCurveTo(e,i,n,r){const s=new i5(this.currentPoint.clone(),new Xt(e,i),new Xt(n,r));return this.curves.push(s),this.currentPoint.set(n,r),this}bezierCurveTo(e,i,n,r,s,o){const a=new e5(this.currentPoint.clone(),new Xt(e,i),new Xt(n,r),new Xt(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const i=[this.currentPoint.clone()].concat(e),n=new n5(i);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,i,n,r,s,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,i+l,n,r,s,o),this}absarc(e,i,n,r,s,o){return this.absellipse(e,i,n,n,r,s,o),this}ellipse(e,i,n,r,s,o,a,l){const u=this.currentPoint.x,d=this.currentPoint.y;return this.absellipse(e+u,i+d,n,r,s,o,a,l),this}absellipse(e,i,n,r,s,o,a,l){const u=new CL(e,i,n,r,s,o,a,l);if(this.curves.length>0){const p=u.getPoint(0);p.equals(this.currentPoint)||this.lineTo(p.x,p.y)}this.curves.push(u);const d=u.getPoint(1);return this.currentPoint.copy(d),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class oS extends Rn{constructor(e=[new Xt(0,-.5),new Xt(.5,0),new Xt(0,.5)],i=12,n=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:i,phiStart:n,phiLength:r},i=Math.floor(i),r=Sn(r,0,Math.PI*2);const s=[],o=[],a=[],l=[],u=[],d=1/i,p=new Ie,v=new Xt,y=new Ie,w=new Ie,R=new Ie;let O=0,P=0;for(let N=0;N<=e.length-1;N++)switch(N){case 0:O=e[N+1].x-e[N].x,P=e[N+1].y-e[N].y,y.x=P*1,y.y=-O,y.z=P*0,R.copy(y),y.normalize(),l.push(y.x,y.y,y.z);break;case e.length-1:l.push(R.x,R.y,R.z);break;default:O=e[N+1].x-e[N].x,P=e[N+1].y-e[N].y,y.x=P*1,y.y=-O,y.z=P*0,w.copy(y),y.x+=R.x,y.y+=R.y,y.z+=R.z,y.normalize(),l.push(y.x,y.y,y.z),R.copy(w)}for(let N=0;N<=i;N++){const F=n+N*d*r,k=Math.sin(F),$=Math.cos(F);for(let W=0;W<=e.length-1;W++){p.x=e[W].x*k,p.y=e[W].y,p.z=e[W].x*$,o.push(p.x,p.y,p.z),v.x=N/i,v.y=W/(e.length-1),a.push(v.x,v.y);const Q=l[3*W+0]*k,Y=l[3*W+1],M=l[3*W+0]*$;u.push(Q,Y,M)}}for(let N=0;N<i;N++)for(let F=0;F<e.length-1;F++){const k=F+N*e.length,$=k,W=k+e.length,Q=k+e.length+1,Y=k+1;s.push($,W,Y),s.push(Q,Y,W)}this.setIndex(s),this.setAttribute("position",new Hi(o,3)),this.setAttribute("uv",new Hi(a,2)),this.setAttribute("normal",new Hi(u,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new oS(e.points,e.segments,e.phiStart,e.phiLength)}}class OL extends oS{constructor(e=1,i=1,n=4,r=8){const s=new fC;s.absarc(0,-i/2,e,Math.PI*1.5,0),s.absarc(0,i/2,e,0,Math.PI*.5),super(s.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:i,capSegments:n,radialSegments:r}}static fromJSON(e){return new OL(e.radius,e.length,e.capSegments,e.radialSegments)}}class ML extends Rn{constructor(e=1,i=32,n=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:n,thetaLength:r},i=Math.max(3,i);const s=[],o=[],a=[],l=[],u=new Ie,d=new Xt;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let p=0,v=3;p<=i;p++,v+=3){const y=n+p/i*r;u.x=e*Math.cos(y),u.y=e*Math.sin(y),o.push(u.x,u.y,u.z),a.push(0,0,1),d.x=(o[v]/e+1)/2,d.y=(o[v+1]/e+1)/2,l.push(d.x,d.y)}for(let p=1;p<=i;p++)s.push(p,p+1,0);this.setIndex(s),this.setAttribute("position",new Hi(o,3)),this.setAttribute("normal",new Hi(a,3)),this.setAttribute("uv",new Hi(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ML(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class gx extends Rn{constructor(e=1,i=1,n=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const u=this;r=Math.floor(r),s=Math.floor(s);const d=[],p=[],v=[],y=[];let w=0;const R=[],O=n/2;let P=0;N(),o===!1&&(e>0&&F(!0),i>0&&F(!1)),this.setIndex(d),this.setAttribute("position",new Hi(p,3)),this.setAttribute("normal",new Hi(v,3)),this.setAttribute("uv",new Hi(y,2));function N(){const k=new Ie,$=new Ie;let W=0;const Q=(i-e)/n;for(let Y=0;Y<=s;Y++){const M=[],D=Y/s,G=D*(i-e)+e;for(let j=0;j<=r;j++){const Z=j/r,ie=Z*l+a,le=Math.sin(ie),me=Math.cos(ie);$.x=G*le,$.y=-D*n+O,$.z=G*me,p.push($.x,$.y,$.z),k.set(le,Q,me).normalize(),v.push(k.x,k.y,k.z),y.push(Z,1-D),M.push(w++)}R.push(M)}for(let Y=0;Y<r;Y++)for(let M=0;M<s;M++){const D=R[M][Y],G=R[M+1][Y],j=R[M+1][Y+1],Z=R[M][Y+1];(e>0||M!==0)&&(d.push(D,G,Z),W+=3),(i>0||M!==s-1)&&(d.push(G,j,Z),W+=3)}u.addGroup(P,W,0),P+=W}function F(k){const $=w,W=new Xt,Q=new Ie;let Y=0;const M=k===!0?e:i,D=k===!0?1:-1;for(let j=1;j<=r;j++)p.push(0,O*D,0),v.push(0,D,0),y.push(.5,.5),w++;const G=w;for(let j=0;j<=r;j++){const ie=j/r*l+a,le=Math.cos(ie),me=Math.sin(ie);Q.x=M*me,Q.y=O*D,Q.z=M*le,p.push(Q.x,Q.y,Q.z),v.push(0,D,0),W.x=le*.5+.5,W.y=me*.5*D+.5,y.push(W.x,W.y),w++}for(let j=0;j<r;j++){const Z=$+j,ie=G+j;k===!0?d.push(ie,ie+1,Z):d.push(ie+1,ie,Z),Y+=3}u.addGroup(P,Y,k===!0?1:2),P+=Y}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gx(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class TL extends gx{constructor(e=1,i=1,n=32,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,i,n,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new TL(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class $p extends Rn{constructor(e=[],i=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:i,radius:n,detail:r};const s=[],o=[];a(r),u(n),d(),this.setAttribute("position",new Hi(s,3)),this.setAttribute("normal",new Hi(s.slice(),3)),this.setAttribute("uv",new Hi(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(N){const F=new Ie,k=new Ie,$=new Ie;for(let W=0;W<i.length;W+=3)y(i[W+0],F),y(i[W+1],k),y(i[W+2],$),l(F,k,$,N)}function l(N,F,k,$){const W=$+1,Q=[];for(let Y=0;Y<=W;Y++){Q[Y]=[];const M=N.clone().lerp(k,Y/W),D=F.clone().lerp(k,Y/W),G=W-Y;for(let j=0;j<=G;j++)j===0&&Y===W?Q[Y][j]=M:Q[Y][j]=M.clone().lerp(D,j/G)}for(let Y=0;Y<W;Y++)for(let M=0;M<2*(W-Y)-1;M++){const D=Math.floor(M/2);M%2===0?(v(Q[Y][D+1]),v(Q[Y+1][D]),v(Q[Y][D])):(v(Q[Y][D+1]),v(Q[Y+1][D+1]),v(Q[Y+1][D]))}}function u(N){const F=new Ie;for(let k=0;k<s.length;k+=3)F.x=s[k+0],F.y=s[k+1],F.z=s[k+2],F.normalize().multiplyScalar(N),s[k+0]=F.x,s[k+1]=F.y,s[k+2]=F.z}function d(){const N=new Ie;for(let F=0;F<s.length;F+=3){N.x=s[F+0],N.y=s[F+1],N.z=s[F+2];const k=O(N)/2/Math.PI+.5,$=P(N)/Math.PI+.5;o.push(k,1-$)}w(),p()}function p(){for(let N=0;N<o.length;N+=6){const F=o[N+0],k=o[N+2],$=o[N+4],W=Math.max(F,k,$),Q=Math.min(F,k,$);W>.9&&Q<.1&&(F<.2&&(o[N+0]+=1),k<.2&&(o[N+2]+=1),$<.2&&(o[N+4]+=1))}}function v(N){s.push(N.x,N.y,N.z)}function y(N,F){const k=N*3;F.x=e[k+0],F.y=e[k+1],F.z=e[k+2]}function w(){const N=new Ie,F=new Ie,k=new Ie,$=new Ie,W=new Xt,Q=new Xt,Y=new Xt;for(let M=0,D=0;M<s.length;M+=9,D+=6){N.set(s[M+0],s[M+1],s[M+2]),F.set(s[M+3],s[M+4],s[M+5]),k.set(s[M+6],s[M+7],s[M+8]),W.set(o[D+0],o[D+1]),Q.set(o[D+2],o[D+3]),Y.set(o[D+4],o[D+5]),$.copy(N).add(F).add(k).divideScalar(3);const G=O($);R(W,D+0,N,G),R(Q,D+2,F,G),R(Y,D+4,k,G)}}function R(N,F,k,$){$<0&&N.x===1&&(o[F]=N.x-1),k.x===0&&k.z===0&&(o[F]=$/2/Math.PI+.5)}function O(N){return Math.atan2(N.z,-N.x)}function P(N){return Math.atan2(-N.y,Math.sqrt(N.x*N.x+N.z*N.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $p(e.vertices,e.indices,e.radius,e.details)}}class RL extends $p{constructor(e=1,i=0){const n=(1+Math.sqrt(5))/2,r=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,o,e,i),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new RL(e.radius,e.detail)}}const GO=new Ie,UO=new Ie,IB=new Ie,HO=new hl;class Fre extends Rn{constructor(e=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:i},e!==null){const r=Math.pow(10,4),s=Math.cos(_g*i),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,u=[0,0,0],d=["a","b","c"],p=new Array(3),v={},y=[];for(let w=0;w<l;w+=3){o?(u[0]=o.getX(w),u[1]=o.getX(w+1),u[2]=o.getX(w+2)):(u[0]=w,u[1]=w+1,u[2]=w+2);const{a:R,b:O,c:P}=HO;if(R.fromBufferAttribute(a,u[0]),O.fromBufferAttribute(a,u[1]),P.fromBufferAttribute(a,u[2]),HO.getNormal(IB),p[0]=`${Math.round(R.x*r)},${Math.round(R.y*r)},${Math.round(R.z*r)}`,p[1]=`${Math.round(O.x*r)},${Math.round(O.y*r)},${Math.round(O.z*r)}`,p[2]=`${Math.round(P.x*r)},${Math.round(P.y*r)},${Math.round(P.z*r)}`,!(p[0]===p[1]||p[1]===p[2]||p[2]===p[0]))for(let N=0;N<3;N++){const F=(N+1)%3,k=p[N],$=p[F],W=HO[d[N]],Q=HO[d[F]],Y=`${k}_${$}`,M=`${$}_${k}`;M in v&&v[M]?(IB.dot(v[M].normal)<=s&&(y.push(W.x,W.y,W.z),y.push(Q.x,Q.y,Q.z)),v[M]=null):Y in v||(v[Y]={index0:u[N],index1:u[F],normal:IB.clone()})}}for(const w in v)if(v[w]){const{index0:R,index1:O}=v[w];GO.fromBufferAttribute(a,R),UO.fromBufferAttribute(a,O),y.push(GO.x,GO.y,GO.z),y.push(UO.x,UO.y,UO.z)}this.setAttribute("position",new Hi(y,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Cg extends fC{constructor(e){super(e),this.uuid=tc(),this.type="Shape",this.holes=[]}getPointsHoles(e){const i=[];for(let n=0,r=this.holes.length;n<r;n++)i[n]=this.holes[n].getPoints(e);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let i=0,n=e.holes.length;i<n;i++){const r=e.holes[i];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let i=0,n=this.holes.length;i<n;i++){const r=this.holes[i];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let i=0,n=e.holes.length;i<n;i++){const r=e.holes[i];this.holes.push(new fC().fromJSON(r))}return this}}function WZe(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let s=Nre(t,0,r,i,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,u;if(n&&(s=XZe(t,e,s,i)),t.length>80*i){a=1/0,l=1/0;let d=-1/0,p=-1/0;for(let v=i;v<r;v+=i){const y=t[v],w=t[v+1];y<a&&(a=y),w<l&&(l=w),y>d&&(d=y),w>p&&(p=w)}u=Math.max(d-a,p-l),u=u!==0?32767/u:0}return pC(s,o,i,a,l,u,0),o}function Nre(t,e,i,n,r){let s;if(r===a7e(t,e,i,n)>0)for(let o=e;o<i;o+=n)s=O9(o/n|0,t[o],t[o+1],s);else for(let o=i-n;o>=e;o-=n)s=O9(o/n|0,t[o],t[o+1],s);return s&&j0(s,s.next)&&(gC(s),s=s.next),s}function $g(t,e){if(!t)return t;e||(e=t);let i=t,n;do if(n=!1,!i.steiner&&(j0(i,i.next)||vs(i.prev,i,i.next)===0)){if(gC(i),i=e=i.prev,i===i.next)break;n=!0}else i=i.next;while(n||i!==e);return e}function pC(t,e,i,n,r,s,o){if(!t)return;!o&&s&&t7e(t,n,r,s);let a=t;for(;t.prev!==t.next;){const l=t.prev,u=t.next;if(s?jZe(t,n,r,s):qZe(t)){e.push(l.i,t.i,u.i),gC(t),t=u.next,a=u.next;continue}if(t=u,t===a){o?o===1?(t=QZe($g(t),e),pC(t,e,i,n,r,s,2)):o===2&&ZZe(t,e,i,n,r,s):pC($g(t),e,i,n,r,s,1);break}}}function qZe(t){const e=t.prev,i=t,n=t.next;if(vs(e,i,n)>=0)return!1;const r=e.x,s=i.x,o=n.x,a=e.y,l=i.y,u=n.y,d=Math.min(r,s,o),p=Math.min(a,l,u),v=Math.max(r,s,o),y=Math.max(a,l,u);let w=n.next;for(;w!==e;){if(w.x>=d&&w.x<=v&&w.y>=p&&w.y<=y&&Aw(r,a,s,l,o,u,w.x,w.y)&&vs(w.prev,w,w.next)>=0)return!1;w=w.next}return!0}function jZe(t,e,i,n){const r=t.prev,s=t,o=t.next;if(vs(r,s,o)>=0)return!1;const a=r.x,l=s.x,u=o.x,d=r.y,p=s.y,v=o.y,y=Math.min(a,l,u),w=Math.min(d,p,v),R=Math.max(a,l,u),O=Math.max(d,p,v),P=EV(y,w,e,i,n),N=EV(R,O,e,i,n);let F=t.prevZ,k=t.nextZ;for(;F&&F.z>=P&&k&&k.z<=N;){if(F.x>=y&&F.x<=R&&F.y>=w&&F.y<=O&&F!==r&&F!==o&&Aw(a,d,l,p,u,v,F.x,F.y)&&vs(F.prev,F,F.next)>=0||(F=F.prevZ,k.x>=y&&k.x<=R&&k.y>=w&&k.y<=O&&k!==r&&k!==o&&Aw(a,d,l,p,u,v,k.x,k.y)&&vs(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;F&&F.z>=P;){if(F.x>=y&&F.x<=R&&F.y>=w&&F.y<=O&&F!==r&&F!==o&&Aw(a,d,l,p,u,v,F.x,F.y)&&vs(F.prev,F,F.next)>=0)return!1;F=F.prevZ}for(;k&&k.z<=N;){if(k.x>=y&&k.x<=R&&k.y>=w&&k.y<=O&&k!==r&&k!==o&&Aw(a,d,l,p,u,v,k.x,k.y)&&vs(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function QZe(t,e){let i=t;do{const n=i.prev,r=i.next.next;!j0(n,r)&&zre(n,i,i.next,r)&&mC(n,r)&&mC(r,n)&&(e.push(n.i,i.i,r.i),gC(i),gC(i.next),i=t=r),i=i.next}while(i!==t);return $g(i)}function ZZe(t,e,i,n,r,s){let o=t;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&r7e(o,a)){let l=Vre(o,a);o=$g(o,o.next),l=$g(l,l.next),pC(o,e,i,n,r,s,0),pC(l,e,i,n,r,s,0);return}a=a.next}o=o.next}while(o!==t)}function XZe(t,e,i,n){const r=[];for(let s=0,o=e.length;s<o;s++){const a=e[s]*n,l=s<o-1?e[s+1]*n:t.length,u=Nre(t,a,l,n,!1);u===u.next&&(u.steiner=!0),r.push(n7e(u))}r.sort(KZe);for(let s=0;s<r.length;s++)i=YZe(r[s],i);return i}function KZe(t,e){let i=t.x-e.x;if(i===0&&(i=t.y-e.y,i===0)){const n=(t.next.y-t.y)/(t.next.x-t.x),r=(e.next.y-e.y)/(e.next.x-e.x);i=n-r}return i}function YZe(t,e){const i=JZe(t,e);if(!i)return e;const n=Vre(i,t);return $g(n,n.next),$g(i,i.next)}function JZe(t,e){let i=e;const n=t.x,r=t.y;let s=-1/0,o;if(j0(t,i))return i;do{if(j0(t,i.next))return i.next;if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const p=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(p<=n&&p>s&&(s=p,o=i.x<i.next.x?i:i.next,p===n))return o}i=i.next}while(i!==e);if(!o)return null;const a=o,l=o.x,u=o.y;let d=1/0;i=o;do{if(n>=i.x&&i.x>=l&&n!==i.x&&Bre(r<u?n:s,r,l,u,r<u?s:n,r,i.x,i.y)){const p=Math.abs(r-i.y)/(n-i.x);mC(i,t)&&(p<d||p===d&&(i.x>o.x||i.x===o.x&&e7e(o,i)))&&(o=i,d=p)}i=i.next}while(i!==a);return o}function e7e(t,e){return vs(t.prev,t,e.prev)<0&&vs(e.next,t,t.next)<0}function t7e(t,e,i,n){let r=t;do r.z===0&&(r.z=EV(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,i7e(r)}function i7e(t){let e,i=1;do{let n=t,r;t=null;let s=null;for(e=0;n;){e++;let o=n,a=0;for(let u=0;u<i&&(a++,o=o.nextZ,!!o);u++);let l=i;for(;a>0||l>0&&o;)a!==0&&(l===0||!o||n.z<=o.z)?(r=n,n=n.nextZ,a--):(r=o,o=o.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=o}s.nextZ=null,i*=2}while(e>1);return t}function EV(t,e,i,n,r){return t=(t-i)*r|0,e=(e-n)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function n7e(t){let e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Bre(t,e,i,n,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(n-a)>=(i-o)*(e-a)&&(i-o)*(s-a)>=(r-o)*(n-a)}function Aw(t,e,i,n,r,s,o,a){return!(t===o&&e===a)&&Bre(t,e,i,n,r,s,o,a)}function r7e(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!s7e(t,e)&&(mC(t,e)&&mC(e,t)&&o7e(t,e)&&(vs(t.prev,t,e.prev)||vs(t,e.prev,e))||j0(t,e)&&vs(t.prev,t,t.next)>0&&vs(e.prev,e,e.next)>0)}function vs(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function j0(t,e){return t.x===e.x&&t.y===e.y}function zre(t,e,i,n){const r=WO(vs(t,e,i)),s=WO(vs(t,e,n)),o=WO(vs(i,n,t)),a=WO(vs(i,n,e));return!!(r!==s&&o!==a||r===0&&$O(t,i,e)||s===0&&$O(t,n,e)||o===0&&$O(i,t,n)||a===0&&$O(i,e,n))}function $O(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function WO(t){return t>0?1:t<0?-1:0}function s7e(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&zre(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function mC(t,e){return vs(t.prev,t,t.next)<0?vs(t,e,t.next)>=0&&vs(t,t.prev,e)>=0:vs(t,e,t.prev)<0||vs(t,t.next,e)<0}function o7e(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==t);return n}function Vre(t,e){const i=AV(t.i,t.x,t.y),n=AV(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function O9(t,e,i,n){const r=AV(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function gC(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function AV(t,e,i){return{i:t,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function a7e(t,e,i,n){let r=0;for(let s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}class l7e{static triangulate(e,i,n=2){return WZe(e,i,n)}}class wh{static area(e){const i=e.length;let n=0;for(let r=i-1,s=0;s<i;r=s++)n+=e[r].x*e[s].y-e[s].x*e[r].y;return n*.5}static isClockWise(e){return wh.area(e)<0}static triangulateShape(e,i){const n=[],r=[],s=[];M9(e),T9(n,e);let o=e.length;i.forEach(M9);for(let l=0;l<i.length;l++)r.push(o),o+=i[l].length,T9(n,i[l]);const a=l7e.triangulate(n,r);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function M9(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function T9(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class PL extends Rn{constructor(e=new Cg([new Xt(.5,.5),new Xt(-.5,.5),new Xt(-.5,-.5),new Xt(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:i},e=Array.isArray(e)?e:[e];const n=this,r=[],s=[];for(let a=0,l=e.length;a<l;a++){const u=e[a];o(u)}this.setAttribute("position",new Hi(r,3)),this.setAttribute("uv",new Hi(s,2)),this.computeVertexNormals();function o(a){const l=[],u=i.curveSegments!==void 0?i.curveSegments:12,d=i.steps!==void 0?i.steps:1,p=i.depth!==void 0?i.depth:1;let v=i.bevelEnabled!==void 0?i.bevelEnabled:!0,y=i.bevelThickness!==void 0?i.bevelThickness:.2,w=i.bevelSize!==void 0?i.bevelSize:y-.1,R=i.bevelOffset!==void 0?i.bevelOffset:0,O=i.bevelSegments!==void 0?i.bevelSegments:3;const P=i.extrudePath,N=i.UVGenerator!==void 0?i.UVGenerator:c7e;let F,k=!1,$,W,Q,Y;P&&(F=P.getSpacedPoints(d),k=!0,v=!1,$=P.computeFrenetFrames(d,!1),W=new Ie,Q=new Ie,Y=new Ie),v||(O=0,y=0,w=0,R=0);const M=a.extractPoints(u);let D=M.shape;const G=M.holes;if(!wh.isClockWise(D)){D=D.reverse();for(let it=0,Pe=G.length;it<Pe;it++){const Ye=G[it];wh.isClockWise(Ye)&&(G[it]=Ye.reverse())}}function Z(it){const Ye=10000000000000001e-36;let Ct=it[0];for(let st=1;st<=it.length;st++){const we=st%it.length,he=it[we],xe=he.x-Ct.x,Be=he.y-Ct.y,$e=xe*xe+Be*Be,Ze=Math.max(Math.abs(he.x),Math.abs(he.y),Math.abs(Ct.x),Math.abs(Ct.y)),Lt=Ye*Ze*Ze;if($e<=Lt){it.splice(we,1),st--;continue}Ct=he}}Z(D),G.forEach(Z);const ie=G.length,le=D;for(let it=0;it<ie;it++){const Pe=G[it];D=D.concat(Pe)}function me(it,Pe,Ye){return Pe||console.error("THREE.ExtrudeGeometry: vec does not exist"),it.clone().addScaledVector(Pe,Ye)}const be=D.length;function fe(it,Pe,Ye){let Ct,st,we;const he=it.x-Pe.x,xe=it.y-Pe.y,Be=Ye.x-it.x,$e=Ye.y-it.y,Ze=he*he+xe*xe,Lt=he*$e-xe*Be;if(Math.abs(Lt)>Number.EPSILON){const ot=Math.sqrt(Ze),Nt=Math.sqrt(Be*Be+$e*$e),fi=Pe.x-xe/ot,Pt=Pe.y+he/ot,ni=Ye.x-$e/Nt,ti=Ye.y+Be/Nt,nt=((ni-fi)*$e-(ti-Pt)*Be)/(he*$e-xe*Be);Ct=fi+he*nt-it.x,st=Pt+xe*nt-it.y;const Ce=Ct*Ct+st*st;if(Ce<=2)return new Xt(Ct,st);we=Math.sqrt(Ce/2)}else{let ot=!1;he>Number.EPSILON?Be>Number.EPSILON&&(ot=!0):he<-Number.EPSILON?Be<-Number.EPSILON&&(ot=!0):Math.sign(xe)===Math.sign($e)&&(ot=!0),ot?(Ct=-xe,st=he,we=Math.sqrt(Ze)):(Ct=he,st=xe,we=Math.sqrt(Ze/2))}return new Xt(Ct/we,st/we)}const Fe=[];for(let it=0,Pe=le.length,Ye=Pe-1,Ct=it+1;it<Pe;it++,Ye++,Ct++)Ye===Pe&&(Ye=0),Ct===Pe&&(Ct=0),Fe[it]=fe(le[it],le[Ye],le[Ct]);const He=[];let je,qe=Fe.concat();for(let it=0,Pe=ie;it<Pe;it++){const Ye=G[it];je=[];for(let Ct=0,st=Ye.length,we=st-1,he=Ct+1;Ct<st;Ct++,we++,he++)we===st&&(we=0),he===st&&(he=0),je[Ct]=fe(Ye[Ct],Ye[we],Ye[he]);He.push(je),qe=qe.concat(je)}const ct=[],Ge=[];for(let it=0;it<O;it++){const Pe=it/O,Ye=y*Math.cos(Pe*Math.PI/2),Ct=w*Math.sin(Pe*Math.PI/2)+R;for(let st=0,we=le.length;st<we;st++){const he=me(le[st],Fe[st],Ct);Jt(he.x,he.y,-Ye),Pe==0&&ct.push(he)}for(let st=0,we=ie;st<we;st++){const he=G[st];je=He[st];const xe=[];for(let Be=0,$e=he.length;Be<$e;Be++){const Ze=me(he[Be],je[Be],Ct);Jt(Ze.x,Ze.y,-Ye),Pe==0&&xe.push(Ze)}Pe==0&&Ge.push(xe)}}const Je=wh.triangulateShape(ct,Ge),mt=Je.length,wt=w+R;for(let it=0;it<be;it++){const Pe=v?me(D[it],qe[it],wt):D[it];k?(Q.copy($.normals[0]).multiplyScalar(Pe.x),W.copy($.binormals[0]).multiplyScalar(Pe.y),Y.copy(F[0]).add(Q).add(W),Jt(Y.x,Y.y,Y.z)):Jt(Pe.x,Pe.y,0)}for(let it=1;it<=d;it++)for(let Pe=0;Pe<be;Pe++){const Ye=v?me(D[Pe],qe[Pe],wt):D[Pe];k?(Q.copy($.normals[it]).multiplyScalar(Ye.x),W.copy($.binormals[it]).multiplyScalar(Ye.y),Y.copy(F[it]).add(Q).add(W),Jt(Y.x,Y.y,Y.z)):Jt(Ye.x,Ye.y,p/d*it)}for(let it=O-1;it>=0;it--){const Pe=it/O,Ye=y*Math.cos(Pe*Math.PI/2),Ct=w*Math.sin(Pe*Math.PI/2)+R;for(let st=0,we=le.length;st<we;st++){const he=me(le[st],Fe[st],Ct);Jt(he.x,he.y,p+Ye)}for(let st=0,we=G.length;st<we;st++){const he=G[st];je=He[st];for(let xe=0,Be=he.length;xe<Be;xe++){const $e=me(he[xe],je[xe],Ct);k?Jt($e.x,$e.y+F[d-1].y,F[d-1].x+Ye):Jt($e.x,$e.y,p+Ye)}}}Ot(),Qt();function Ot(){const it=r.length/3;if(v){let Pe=0,Ye=be*Pe;for(let Ct=0;Ct<mt;Ct++){const st=Je[Ct];Yt(st[2]+Ye,st[1]+Ye,st[0]+Ye)}Pe=d+O*2,Ye=be*Pe;for(let Ct=0;Ct<mt;Ct++){const st=Je[Ct];Yt(st[0]+Ye,st[1]+Ye,st[2]+Ye)}}else{for(let Pe=0;Pe<mt;Pe++){const Ye=Je[Pe];Yt(Ye[2],Ye[1],Ye[0])}for(let Pe=0;Pe<mt;Pe++){const Ye=Je[Pe];Yt(Ye[0]+be*d,Ye[1]+be*d,Ye[2]+be*d)}}n.addGroup(it,r.length/3-it,0)}function Qt(){const it=r.length/3;let Pe=0;ei(le,Pe),Pe+=le.length;for(let Ye=0,Ct=G.length;Ye<Ct;Ye++){const st=G[Ye];ei(st,Pe),Pe+=st.length}n.addGroup(it,r.length/3-it,1)}function ei(it,Pe){let Ye=it.length;for(;--Ye>=0;){const Ct=Ye;let st=Ye-1;st<0&&(st=it.length-1);for(let we=0,he=d+O*2;we<he;we++){const xe=be*we,Be=be*(we+1),$e=Pe+Ct+xe,Ze=Pe+st+xe,Lt=Pe+st+Be,ot=Pe+Ct+Be;Ut($e,Ze,Lt,ot)}}}function Jt(it,Pe,Ye){l.push(it),l.push(Pe),l.push(Ye)}function Yt(it,Pe,Ye){Re(it),Re(Pe),Re(Ye);const Ct=r.length/3,st=N.generateTopUV(n,r,Ct-3,Ct-2,Ct-1);gi(st[0]),gi(st[1]),gi(st[2])}function Ut(it,Pe,Ye,Ct){Re(it),Re(Pe),Re(Ct),Re(Pe),Re(Ye),Re(Ct);const st=r.length/3,we=N.generateSideWallUV(n,r,st-6,st-3,st-2,st-1);gi(we[0]),gi(we[1]),gi(we[3]),gi(we[1]),gi(we[2]),gi(we[3])}function Re(it){r.push(l[it*3+0]),r.push(l[it*3+1]),r.push(l[it*3+2])}function gi(it){s.push(it.x),s.push(it.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes,n=this.parameters.options;return u7e(i,n,e)}static fromJSON(e,i){const n=[];for(let s=0,o=e.shapes.length;s<o;s++){const a=i[e.shapes[s]];n.push(a)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new qR[r.type]().fromJSON(r)),new PL(n,e.options)}}const c7e={generateTopUV:function(t,e,i,n,r){const s=e[i*3],o=e[i*3+1],a=e[n*3],l=e[n*3+1],u=e[r*3],d=e[r*3+1];return[new Xt(s,o),new Xt(a,l),new Xt(u,d)]},generateSideWallUV:function(t,e,i,n,r,s){const o=e[i*3],a=e[i*3+1],l=e[i*3+2],u=e[n*3],d=e[n*3+1],p=e[n*3+2],v=e[r*3],y=e[r*3+1],w=e[r*3+2],R=e[s*3],O=e[s*3+1],P=e[s*3+2];return Math.abs(a-d)<Math.abs(o-u)?[new Xt(o,1-l),new Xt(u,1-p),new Xt(v,1-w),new Xt(R,1-P)]:[new Xt(a,1-l),new Xt(d,1-p),new Xt(y,1-w),new Xt(O,1-P)]}};function u7e(t,e,i){if(i.shapes=[],Array.isArray(t))for(let n=0,r=t.length;n<r;n++){const s=t[n];i.shapes.push(s.uuid)}else i.shapes.push(t.uuid);return i.options=Object.assign({},e),e.extrudePath!==void 0&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class EL extends $p{constructor(e=1,i=0){const n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,i),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new EL(e.radius,e.detail)}}class aS extends $p{constructor(e=1,i=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,r,e,i),this.type="OctahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new aS(e.radius,e.detail)}}class vx extends Rn{constructor(e=1,i=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:n,heightSegments:r};const s=e/2,o=i/2,a=Math.floor(n),l=Math.floor(r),u=a+1,d=l+1,p=e/a,v=i/l,y=[],w=[],R=[],O=[];for(let P=0;P<d;P++){const N=P*v-o;for(let F=0;F<u;F++){const k=F*p-s;w.push(k,-N,0),R.push(0,0,1),O.push(F/a),O.push(1-P/l)}}for(let P=0;P<l;P++)for(let N=0;N<a;N++){const F=N+u*P,k=N+u*(P+1),$=N+1+u*(P+1),W=N+1+u*P;y.push(F,k,W),y.push(k,$,W)}this.setIndex(y),this.setAttribute("position",new Hi(w,3)),this.setAttribute("normal",new Hi(R,3)),this.setAttribute("uv",new Hi(O,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vx(e.width,e.height,e.widthSegments,e.heightSegments)}}class AL extends Rn{constructor(e=.5,i=1,n=32,r=1,s=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:i,thetaSegments:n,phiSegments:r,thetaStart:s,thetaLength:o},n=Math.max(3,n),r=Math.max(1,r);const a=[],l=[],u=[],d=[];let p=e;const v=(i-e)/r,y=new Ie,w=new Xt;for(let R=0;R<=r;R++){for(let O=0;O<=n;O++){const P=s+O/n*o;y.x=p*Math.cos(P),y.y=p*Math.sin(P),l.push(y.x,y.y,y.z),u.push(0,0,1),w.x=(y.x/i+1)/2,w.y=(y.y/i+1)/2,d.push(w.x,w.y)}p+=v}for(let R=0;R<r;R++){const O=R*(n+1);for(let P=0;P<n;P++){const N=P+O,F=N,k=N+n+1,$=N+n+2,W=N+1;a.push(F,k,W),a.push(k,$,W)}}this.setIndex(a),this.setAttribute("position",new Hi(l,3)),this.setAttribute("normal",new Hi(u,3)),this.setAttribute("uv",new Hi(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new AL(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class IL extends Rn{constructor(e=new Cg([new Xt(0,.5),new Xt(-.5,-.5),new Xt(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:i};const n=[],r=[],s=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)u(e);else for(let d=0;d<e.length;d++)u(e[d]),this.addGroup(a,l,d),a+=l,l=0;this.setIndex(n),this.setAttribute("position",new Hi(r,3)),this.setAttribute("normal",new Hi(s,3)),this.setAttribute("uv",new Hi(o,2));function u(d){const p=r.length/3,v=d.extractPoints(i);let y=v.shape;const w=v.holes;wh.isClockWise(y)===!1&&(y=y.reverse());for(let O=0,P=w.length;O<P;O++){const N=w[O];wh.isClockWise(N)===!0&&(w[O]=N.reverse())}const R=wh.triangulateShape(y,w);for(let O=0,P=w.length;O<P;O++){const N=w[O];y=y.concat(N)}for(let O=0,P=y.length;O<P;O++){const N=y[O];r.push(N.x,N.y,0),s.push(0,0,1),o.push(N.x,N.y)}for(let O=0,P=R.length;O<P;O++){const N=R[O],F=N[0]+p,k=N[1]+p,$=N[2]+p;n.push(F,k,$),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes;return h7e(i,e)}static fromJSON(e,i){const n=[];for(let r=0,s=e.shapes.length;r<s;r++){const o=i[e.shapes[r]];n.push(o)}return new IL(n,e.curveSegments)}}function h7e(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const r=t[i];e.shapes.push(r.uuid)}else e.shapes.push(t.uuid);return e}class ov extends Rn{constructor(e=1,i=32,n=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:n,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},i=Math.max(3,Math.floor(i)),n=Math.max(2,Math.floor(n));const l=Math.min(o+a,Math.PI);let u=0;const d=[],p=new Ie,v=new Ie,y=[],w=[],R=[],O=[];for(let P=0;P<=n;P++){const N=[],F=P/n;let k=0;P===0&&o===0?k=.5/i:P===n&&l===Math.PI&&(k=-.5/i);for(let $=0;$<=i;$++){const W=$/i;p.x=-e*Math.cos(r+W*s)*Math.sin(o+F*a),p.y=e*Math.cos(o+F*a),p.z=e*Math.sin(r+W*s)*Math.sin(o+F*a),w.push(p.x,p.y,p.z),v.copy(p).normalize(),R.push(v.x,v.y,v.z),O.push(W+k,1-F),N.push(u++)}d.push(N)}for(let P=0;P<n;P++)for(let N=0;N<i;N++){const F=d[P][N+1],k=d[P][N],$=d[P+1][N],W=d[P+1][N+1];(P!==0||o>0)&&y.push(F,k,W),(P!==n-1||l<Math.PI)&&y.push(k,$,W)}this.setIndex(y),this.setAttribute("position",new Hi(w,3)),this.setAttribute("normal",new Hi(R,3)),this.setAttribute("uv",new Hi(O,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ov(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class kL extends $p{constructor(e=1,i=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,r,e,i),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new kL(e.radius,e.detail)}}class DL extends Rn{constructor(e=1,i=.4,n=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:i,radialSegments:n,tubularSegments:r,arc:s},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],l=[],u=[],d=new Ie,p=new Ie,v=new Ie;for(let y=0;y<=n;y++)for(let w=0;w<=r;w++){const R=w/r*s,O=y/n*Math.PI*2;p.x=(e+i*Math.cos(O))*Math.cos(R),p.y=(e+i*Math.cos(O))*Math.sin(R),p.z=i*Math.sin(O),a.push(p.x,p.y,p.z),d.x=e*Math.cos(R),d.y=e*Math.sin(R),v.subVectors(p,d).normalize(),l.push(v.x,v.y,v.z),u.push(w/r),u.push(y/n)}for(let y=1;y<=n;y++)for(let w=1;w<=r;w++){const R=(r+1)*y+w-1,O=(r+1)*(y-1)+w-1,P=(r+1)*(y-1)+w,N=(r+1)*y+w;o.push(R,O,N),o.push(O,P,N)}this.setIndex(o),this.setAttribute("position",new Hi(a,3)),this.setAttribute("normal",new Hi(l,3)),this.setAttribute("uv",new Hi(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new DL(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class LL extends Rn{constructor(e=1,i=.4,n=64,r=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:i,tubularSegments:n,radialSegments:r,p:s,q:o},n=Math.floor(n),r=Math.floor(r);const a=[],l=[],u=[],d=[],p=new Ie,v=new Ie,y=new Ie,w=new Ie,R=new Ie,O=new Ie,P=new Ie;for(let F=0;F<=n;++F){const k=F/n*s*Math.PI*2;N(k,s,o,e,y),N(k+.01,s,o,e,w),O.subVectors(w,y),P.addVectors(w,y),R.crossVectors(O,P),P.crossVectors(R,O),R.normalize(),P.normalize();for(let $=0;$<=r;++$){const W=$/r*Math.PI*2,Q=-i*Math.cos(W),Y=i*Math.sin(W);p.x=y.x+(Q*P.x+Y*R.x),p.y=y.y+(Q*P.y+Y*R.y),p.z=y.z+(Q*P.z+Y*R.z),l.push(p.x,p.y,p.z),v.subVectors(p,y).normalize(),u.push(v.x,v.y,v.z),d.push(F/n),d.push($/r)}}for(let F=1;F<=n;F++)for(let k=1;k<=r;k++){const $=(r+1)*(F-1)+(k-1),W=(r+1)*F+(k-1),Q=(r+1)*F+k,Y=(r+1)*(F-1)+k;a.push($,W,Y),a.push(W,Q,Y)}this.setIndex(a),this.setAttribute("position",new Hi(l,3)),this.setAttribute("normal",new Hi(u,3)),this.setAttribute("uv",new Hi(d,2));function N(F,k,$,W,Q){const Y=Math.cos(F),M=Math.sin(F),D=$/k*F,G=Math.cos(D);Q.x=W*(2+G)*.5*Y,Q.y=W*(2+G)*M*.5,Q.z=W*Math.sin(D)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new LL(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class FL extends Rn{constructor(e=new SL(new Ie(-1,-1,0),new Ie(-1,1,0),new Ie(1,1,0)),i=64,n=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:n,radialSegments:r,closed:s};const o=e.computeFrenetFrames(i,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new Ie,l=new Ie,u=new Xt;let d=new Ie;const p=[],v=[],y=[],w=[];R(),this.setIndex(w),this.setAttribute("position",new Hi(p,3)),this.setAttribute("normal",new Hi(v,3)),this.setAttribute("uv",new Hi(y,2));function R(){for(let F=0;F<i;F++)O(F);O(s===!1?i:0),N(),P()}function O(F){d=e.getPointAt(F/i,d);const k=o.normals[F],$=o.binormals[F];for(let W=0;W<=r;W++){const Q=W/r*Math.PI*2,Y=Math.sin(Q),M=-Math.cos(Q);l.x=M*k.x+Y*$.x,l.y=M*k.y+Y*$.y,l.z=M*k.z+Y*$.z,l.normalize(),v.push(l.x,l.y,l.z),a.x=d.x+n*l.x,a.y=d.y+n*l.y,a.z=d.z+n*l.z,p.push(a.x,a.y,a.z)}}function P(){for(let F=1;F<=i;F++)for(let k=1;k<=r;k++){const $=(r+1)*(F-1)+(k-1),W=(r+1)*F+(k-1),Q=(r+1)*F+k,Y=(r+1)*(F-1)+k;w.push($,W,Y),w.push(W,Q,Y)}}function N(){for(let F=0;F<=i;F++)for(let k=0;k<=r;k++)u.x=F/i,u.y=k/r,y.push(u.x,u.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new FL(new qR[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class r5 extends Rn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const i=[],n=new Set,r=new Ie,s=new Ie;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let u=0,d=l.length;u<d;++u){const p=l[u],v=p.start,y=p.count;for(let w=v,R=v+y;w<R;w+=3)for(let O=0;O<3;O++){const P=a.getX(w+O),N=a.getX(w+(O+1)%3);r.fromBufferAttribute(o,P),s.fromBufferAttribute(o,N),R9(r,s,n)===!0&&(i.push(r.x,r.y,r.z),i.push(s.x,s.y,s.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let u=0;u<3;u++){const d=3*a+u,p=3*a+(u+1)%3;r.fromBufferAttribute(o,d),s.fromBufferAttribute(o,p),R9(r,s,n)===!0&&(i.push(r.x,r.y,r.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new Hi(i,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function R9(t,e,i){const n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return i.has(n)===!0||i.has(r)===!0?!1:(i.add(n),i.add(r),!0)}var P9=Object.freeze({__proto__:null,BoxGeometry:Hp,CapsuleGeometry:OL,CircleGeometry:ML,ConeGeometry:TL,CylinderGeometry:gx,DodecahedronGeometry:RL,EdgesGeometry:Fre,ExtrudeGeometry:PL,IcosahedronGeometry:EL,LatheGeometry:oS,OctahedronGeometry:aS,PlaneGeometry:vx,PolyhedronGeometry:$p,RingGeometry:AL,ShapeGeometry:IL,SphereGeometry:ov,TetrahedronGeometry:kL,TorusGeometry:DL,TorusKnotGeometry:LL,TubeGeometry:FL,WireframeGeometry:r5});class Gre extends po{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Si(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class s5 extends Qc{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class yx extends po{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Si(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Si(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Up,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new sc,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Yc extends yx{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Xt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Sn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Si(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Si(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Si(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Ure extends po{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Si(16777215),this.specular=new Si(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Si(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Up,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new sc,this.combine=YC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Hre extends po{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Si(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Si(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Up,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class $re extends po{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Up,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Wre extends po{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Si(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Si(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Up,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new sc,this.combine=YC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class o5 extends po{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=lre,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class a5 extends po{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class qre extends po{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Si(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Up,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class jre extends xa{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function rg(t,e){return!t||t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function Qre(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Zre(t){function e(r,s){return t[r]-t[s]}const i=t.length,n=new Array(i);for(let r=0;r!==i;++r)n[r]=r;return n.sort(e),n}function IV(t,e,i){const n=t.length,r=new t.constructor(n);for(let s=0,o=0;o!==n;++s){const a=i[s]*e;for(let l=0;l!==e;++l)r[o++]=t[a+l]}return r}function l5(t,e,i,n){let r=1,s=t[0];for(;s!==void 0&&s[n]===void 0;)s=t[r++];if(s===void 0)return;let o=s[n];if(o!==void 0)if(Array.isArray(o))do o=s[n],o!==void 0&&(e.push(s.time),i.push(...o)),s=t[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[n],o!==void 0&&(e.push(s.time),o.toArray(i,i.length)),s=t[r++];while(s!==void 0);else do o=s[n],o!==void 0&&(e.push(s.time),i.push(o)),s=t[r++];while(s!==void 0)}function d7e(t,e,i,n,r=30){const s=t.clone();s.name=e;const o=[];for(let l=0;l<s.tracks.length;++l){const u=s.tracks[l],d=u.getValueSize(),p=[],v=[];for(let y=0;y<u.times.length;++y){const w=u.times[y]*r;if(!(w<i||w>=n)){p.push(u.times[y]);for(let R=0;R<d;++R)v.push(u.values[y*d+R])}}p.length!==0&&(u.times=rg(p,u.times.constructor),u.values=rg(v,u.values.constructor),o.push(u))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s}function f7e(t,e=0,i=t,n=30){n<=0&&(n=30);const r=i.tracks.length,s=e/n;for(let o=0;o<r;++o){const a=i.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const u=t.tracks.find(function(P){return P.name===a.name&&P.ValueTypeName===l});if(u===void 0)continue;let d=0;const p=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);let v=0;const y=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(v=y/3);const w=a.times.length-1;let R;if(s<=a.times[0]){const P=d,N=p-d;R=a.values.slice(P,N)}else if(s>=a.times[w]){const P=w*p+d,N=P+p-d;R=a.values.slice(P,N)}else{const P=a.createInterpolant(),N=d,F=p-d;P.evaluate(s),R=P.resultBuffer.slice(N,F)}l==="quaternion"&&new pa().fromArray(R).normalize().conjugate().toArray(R);const O=u.times.length;for(let P=0;P<O;++P){const N=P*y+v;if(l==="quaternion")pa.multiplyQuaternionsFlat(u.values,N,R,0,u.values,N);else{const F=y-v*2;for(let k=0;k<F;++k)u.values[N+k]-=R[k]}}}return t.blendMode=VH,t}class p7e{static convertArray(e,i){return rg(e,i)}static isTypedArray(e){return Qre(e)}static getKeyframeOrder(e){return Zre(e)}static sortedArray(e,i,n){return IV(e,i,n)}static flattenJSON(e,i,n,r){l5(e,i,n,r)}static subclip(e,i,n,r,s=30){return d7e(e,i,n,r,s)}static makeClipAdditive(e,i=0,n=e,r=30){return f7e(e,i,n,r)}}class xx{constructor(e,i,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new i.constructor(n),this.sampleValues=i,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const i=this.parameterPositions;let n=this._cachedIndex,r=i[n],s=i[n-1];e:{t:{let o;i:{n:if(!(e<r)){for(let a=n+2;;){if(r===void 0){if(e<s)break n;return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(s=r,r=i[++n],e<r)break t}o=i.length;break i}if(!(e>=s)){const a=i[1];e<a&&(n=2,s=a);for(let l=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(r=s,s=i[--n-1],e>=s)break t}o=n,n=0;break i}break e}for(;n<o;){const a=n+o>>>1;e<i[a]?o=a:n=a+1}if(r=i[n],s=i[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return n=i.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,r)}return this.interpolate_(n,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const i=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)i[o]=n[s+o];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Xre extends xx{constructor(e,i,n,r){super(e,i,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ig,endingEnd:ig}}intervalChanged_(e,i,n){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case ng:s=e,a=2*i-n;break;case lC:s=r.length-2,a=i+r[s]-r[s+1];break;default:s=e,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case ng:o=e,l=2*n-i;break;case lC:o=1,l=n+r[1]-r[0];break;default:o=e-1,l=i}const u=(n-i)*.5,d=this.valueSize;this._weightPrev=u/(i-a),this._weightNext=u/(l-n),this._offsetPrev=s*d,this._offsetNext=o*d}interpolate_(e,i,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,u=l-a,d=this._offsetPrev,p=this._offsetNext,v=this._weightPrev,y=this._weightNext,w=(n-i)/(r-i),R=w*w,O=R*w,P=-v*O+2*v*R-v*w,N=(1+v)*O+(-1.5-2*v)*R+(-.5+v)*w+1,F=(-1-y)*O+(1.5+y)*R+.5*w,k=y*O-y*R;for(let $=0;$!==a;++$)s[$]=P*o[d+$]+N*o[u+$]+F*o[l+$]+k*o[p+$];return s}}class c5 extends xx{constructor(e,i,n,r){super(e,i,n,r)}interpolate_(e,i,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,u=l-a,d=(n-i)/(r-i),p=1-d;for(let v=0;v!==a;++v)s[v]=o[u+v]*p+o[l+v]*d;return s}}class Kre extends xx{constructor(e,i,n,r){super(e,i,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Jc{constructor(e,i,n,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=rg(i,this.TimeBufferType),this.values=rg(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const i=e.constructor;let n;if(i.toJSON!==this.toJSON)n=i.toJSON(e);else{n={name:e.name,times:rg(e.times,Array),values:rg(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(n.interpolation=r)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Kre(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new c5(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Xre(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case H0:i=this.InterpolantFactoryMethodDiscrete;break;case $0:i=this.InterpolantFactoryMethodLinear;break;case BM:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return H0;case this.InterpolantFactoryMethodLinear:return $0;case this.InterpolantFactoryMethodSmooth:return BM}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const i=this.times;for(let n=0,r=i.length;n!==r;++n)i[n]+=e}return this}scale(e){if(e!==1){const i=this.times;for(let n=0,r=i.length;n!==r;++n)i[n]*=e}return this}trim(e,i){const n=this.times,r=n.length;let s=0,o=r-1;for(;s!==r&&n[s]<e;)++s;for(;o!==-1&&n[o]>i;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=n.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(r!==void 0&&Qre(r))for(let a=0,l=r.length;a!==l;++a){const u=r[a];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,u),e=!1;break}}return e}optimize(){const e=this.times.slice(),i=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===BM,s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const u=e[a],d=e[a+1];if(u!==d&&(a!==1||u!==e[0]))if(r)l=!0;else{const p=a*n,v=p-n,y=p+n;for(let w=0;w!==n;++w){const R=i[p+w];if(R!==i[v+w]||R!==i[y+w]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const p=a*n,v=o*n;for(let y=0;y!==n;++y)i[v+y]=i[p+y]}++o}}if(s>0){e[o]=e[s];for(let a=s*n,l=o*n,u=0;u!==n;++u)i[l+u]=i[a+u];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=i.slice(0,o*n)):(this.times=e,this.values=i),this}clone(){const e=this.times.slice(),i=this.values.slice(),n=this.constructor,r=new n(this.name,e,i);return r.createInterpolant=this.createInterpolant,r}}Jc.prototype.ValueTypeName="";Jc.prototype.TimeBufferType=Float32Array;Jc.prototype.ValueBufferType=Float32Array;Jc.prototype.DefaultInterpolation=$0;class av extends Jc{constructor(e,i,n){super(e,i,n)}}av.prototype.ValueTypeName="bool";av.prototype.ValueBufferType=Array;av.prototype.DefaultInterpolation=H0;av.prototype.InterpolantFactoryMethodLinear=void 0;av.prototype.InterpolantFactoryMethodSmooth=void 0;class u5 extends Jc{constructor(e,i,n,r){super(e,i,n,r)}}u5.prototype.ValueTypeName="color";class Wg extends Jc{constructor(e,i,n,r){super(e,i,n,r)}}Wg.prototype.ValueTypeName="number";class Yre extends xx{constructor(e,i,n,r){super(e,i,n,r)}interpolate_(e,i,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(n-i)/(r-i);let u=e*a;for(let d=u+a;u!==d;u+=4)pa.slerpFlat(s,0,o,u-a,o,u,l);return s}}class qg extends Jc{constructor(e,i,n,r){super(e,i,n,r)}InterpolantFactoryMethodLinear(e){return new Yre(this.times,this.values,this.getValueSize(),e)}}qg.prototype.ValueTypeName="quaternion";qg.prototype.InterpolantFactoryMethodSmooth=void 0;class lv extends Jc{constructor(e,i,n){super(e,i,n)}}lv.prototype.ValueTypeName="string";lv.prototype.ValueBufferType=Array;lv.prototype.DefaultInterpolation=H0;lv.prototype.InterpolantFactoryMethodLinear=void 0;lv.prototype.InterpolantFactoryMethodSmooth=void 0;class jg extends Jc{constructor(e,i,n,r){super(e,i,n,r)}}jg.prototype.ValueTypeName="vector";class Q0{constructor(e="",i=-1,n=[],r=dL){this.name=e,this.tracks=n,this.duration=i,this.blendMode=r,this.uuid=tc(),this.duration<0&&this.resetDuration()}static parse(e){const i=[],n=e.tracks,r=1/(e.fps||1);for(let o=0,a=n.length;o!==a;++o)i.push(g7e(n[o]).scale(r));const s=new this(e.name,e.duration,i,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const i=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=n.length;s!==o;++s)i.push(Jc.toJSON(n[s]));return r}static CreateFromMorphTargetSequence(e,i,n,r){const s=i.length,o=[];for(let a=0;a<s;a++){let l=[],u=[];l.push((a+s-1)%s,a,(a+1)%s),u.push(0,1,0);const d=Zre(l);l=IV(l,1,d),u=IV(u,1,d),!r&&l[0]===0&&(l.push(s),u.push(u[0])),o.push(new Wg(".morphTargetInfluences["+i[a].name+"]",l,u).scale(1/n))}return new this(e,-1,o)}static findByName(e,i){let n=e;if(!Array.isArray(e)){const r=e;n=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<n.length;r++)if(n[r].name===i)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,i,n){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const u=e[a],d=u.name.match(s);if(d&&d.length>1){const p=d[1];let v=r[p];v||(r[p]=v=[]),v.push(u)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],i,n));return o}static parseAnimation(e,i){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(p,v,y,w,R){if(y.length!==0){const O=[],P=[];l5(y,O,P,w),O.length!==0&&R.push(new p(v,O,P))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const u=e.hierarchy||[];for(let p=0;p<u.length;p++){const v=u[p].keys;if(!(!v||v.length===0))if(v[0].morphTargets){const y={};let w;for(w=0;w<v.length;w++)if(v[w].morphTargets)for(let R=0;R<v[w].morphTargets.length;R++)y[v[w].morphTargets[R]]=-1;for(const R in y){const O=[],P=[];for(let N=0;N!==v[w].morphTargets.length;++N){const F=v[w];O.push(F.time),P.push(F.morphTarget===R?1:0)}r.push(new Wg(".morphTargetInfluence["+R+"]",O,P))}l=y.length*o}else{const y=".bones["+i[p].name+"]";n(jg,y+".position",v,"pos",r),n(qg,y+".quaternion",v,"rot",r),n(jg,y+".scale",v,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const e=this.tracks;let i=0;for(let n=0,r=e.length;n!==r;++n){const s=this.tracks[n];i=Math.max(i,s.times[s.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function m7e(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Wg;case"vector":case"vector2":case"vector3":case"vector4":return jg;case"color":return u5;case"quaternion":return qg;case"bool":case"boolean":return av;case"string":return lv}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function g7e(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=m7e(t.type);if(t.times===void 0){const i=[],n=[];l5(t.keys,i,n,"value"),t.times=i,t.values=n}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Md={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class h5{constructor(e,i,n){const r=this;let s=!1,o=0,a=0,l;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=n,this.itemStart=function(d){a++,s===!1&&r.onStart!==void 0&&r.onStart(d,o,a),s=!0},this.itemEnd=function(d){o++,r.onProgress!==void 0&&r.onProgress(d,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(d){r.onError!==void 0&&r.onError(d)},this.resolveURL=function(d){return l?l(d):d},this.setURLModifier=function(d){return l=d,this},this.addHandler=function(d,p){return u.push(d,p),this},this.removeHandler=function(d){const p=u.indexOf(d);return p!==-1&&u.splice(p,2),this},this.getHandler=function(d){for(let p=0,v=u.length;p<v;p+=2){const y=u[p],w=u[p+1];if(y.global&&(y.lastIndex=0),y.test(d))return w}return null}}}const cv=new h5;class Xa{constructor(e){this.manager=e!==void 0?e:cv,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){const n=this;return new Promise(function(r,s){n.load(e,r,i,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Xa.DEFAULT_MATERIAL_NAME="__DEFAULT";const pd={};class v7e extends Error{constructor(e,i){super(e),this.response=i}}class Tu extends Xa{constructor(e){super(e),this.mimeType="",this.responseType=""}load(e,i,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Md.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(s),this.manager.itemEnd(e)},0),s;if(pd[e]!==void 0){pd[e].push({onLoad:i,onProgress:n,onError:r});return}pd[e]=[],pd[e].push({onLoad:i,onProgress:n,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const d=pd[e],p=u.body.getReader(),v=u.headers.get("X-File-Size")||u.headers.get("Content-Length"),y=v?parseInt(v):0,w=y!==0;let R=0;const O=new ReadableStream({start(P){N();function N(){p.read().then(({done:F,value:k})=>{if(F)P.close();else{R+=k.byteLength;const $=new ProgressEvent("progress",{lengthComputable:w,loaded:R,total:y});for(let W=0,Q=d.length;W<Q;W++){const Y=d[W];Y.onProgress&&Y.onProgress($)}P.enqueue(k),N()}},F=>{P.error(F)})}}});return new Response(O)}else throw new v7e(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(l){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(d=>new DOMParser().parseFromString(d,a));case"json":return u.json();default:if(a==="")return u.text();{const p=/charset="?([^;"\s]*)"?/i.exec(a),v=p&&p[1]?p[1].toLowerCase():void 0,y=new TextDecoder(v);return u.arrayBuffer().then(w=>y.decode(w))}}}).then(u=>{Md.add(e,u);const d=pd[e];delete pd[e];for(let p=0,v=d.length;p<v;p++){const y=d[p];y.onLoad&&y.onLoad(u)}}).catch(u=>{const d=pd[e];if(d===void 0)throw this.manager.itemError(e),u;delete pd[e];for(let p=0,v=d.length;p<v;p++){const y=d[p];y.onError&&y.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class y7e extends Xa{constructor(e){super(e)}load(e,i,n,r){const s=this,o=new Tu(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{i(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const i=[];for(let n=0;n<e.length;n++){const r=Q0.parse(e[n]);i.push(r)}return i}}class x7e extends Xa{constructor(e){super(e)}load(e,i,n,r){const s=this,o=[],a=new _L,l=new Tu(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let u=0;function d(p){l.load(e[p],function(v){const y=s.parse(v,!0);o[p]={width:y.width,height:y.height,format:y.format,mipmaps:y.mipmaps},u+=1,u===6&&(y.mipmapCount===1&&(a.minFilter=Ps),a.image=o,a.format=y.format,a.needsUpdate=!0,i&&i(a))},n,r)}if(Array.isArray(e))for(let p=0,v=e.length;p<v;++p)d(p);else l.load(e,function(p){const v=s.parse(p,!0);if(v.isCubemap){const y=v.mipmaps.length/v.mipmapCount;for(let w=0;w<y;w++){o[w]={mipmaps:[]};for(let R=0;R<v.mipmapCount;R++)o[w].mipmaps.push(v.mipmaps[w*v.mipmapCount+R]),o[w].format=v.format,o[w].width=v.width,o[w].height=v.height}a.image=o}else a.image.width=v.width,a.image.height=v.height,a.mipmaps=v.mipmaps;v.mipmapCount===1&&(a.minFilter=Ps),a.format=v.format,a.needsUpdate=!0,i&&i(a)},n,r);return a}}class vC extends Xa{constructor(e){super(e)}load(e,i,n,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Md.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){i&&i(o),s.manager.itemEnd(e)},0),o;const a=dC("img");function l(){d(),Md.add(e,this),i&&i(this),s.manager.itemEnd(e)}function u(p){d(),r&&r(p),s.manager.itemError(e),s.manager.itemEnd(e)}function d(){a.removeEventListener("load",l,!1),a.removeEventListener("error",u,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class b7e extends Xa{constructor(e){super(e)}load(e,i,n,r){const s=new iS;s.colorSpace=co;const o=new vC(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(u){o.load(e[u],function(d){s.images[u]=d,a++,a===6&&(s.needsUpdate=!0,i&&i(s))},void 0,r)}for(let u=0;u<e.length;++u)l(u);return s}}class w7e extends Xa{constructor(e){super(e)}load(e,i,n,r){const s=this,o=new bh,a=new Tu(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(e,function(l){let u;try{u=s.parse(l)}catch(d){if(r!==void 0)r(d);else{console.error(d);return}}u.image!==void 0?o.image=u.image:u.data!==void 0&&(o.image.width=u.width,o.image.height=u.height,o.image.data=u.data),o.wrapS=u.wrapS!==void 0?u.wrapS:Zl,o.wrapT=u.wrapT!==void 0?u.wrapT:Zl,o.magFilter=u.magFilter!==void 0?u.magFilter:Ps,o.minFilter=u.minFilter!==void 0?u.minFilter:Ps,o.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.colorSpace!==void 0&&(o.colorSpace=u.colorSpace),u.flipY!==void 0&&(o.flipY=u.flipY),u.format!==void 0&&(o.format=u.format),u.type!==void 0&&(o.type=u.type),u.mipmaps!==void 0&&(o.mipmaps=u.mipmaps,o.minFilter=Fc),u.mipmapCount===1&&(o.minFilter=Ps),u.generateMipmaps!==void 0&&(o.generateMipmaps=u.generateMipmaps),o.needsUpdate=!0,i&&i(o,u)},n,r),o}}class Jre extends Xa{constructor(e){super(e)}load(e,i,n,r){const s=new ds,o=new vC(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,i!==void 0&&i(s)},n,r),s}}class Wp extends Qn{constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new Si(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(i.object.target=this.target.uuid),i}}class ese extends Wp{constructor(e,i,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Qn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Si(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}const kB=new sn,E9=new Ie,A9=new Ie;class d5{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Xt(512,512),this.map=null,this.mapPass=null,this.matrix=new sn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new sS,this._frameExtents=new Xt(1,1),this._viewportCount=1,this._viewports=[new Mn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const i=this.camera,n=this.matrix;E9.setFromMatrixPosition(e.matrixWorld),i.position.copy(E9),A9.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(A9),i.updateMatrixWorld(),kB.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(kB),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(kB)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class _7e extends d5{constructor(){super(new ho(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const i=this.camera,n=W0*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||i.far;(n!==i.fov||r!==i.aspect||s!==i.far)&&(i.fov=n,i.aspect=r,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class f5 extends Wp{constructor(e,i,n=0,r=Math.PI/3,s=0,o=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Qn.DEFAULT_UP),this.updateMatrix(),this.target=new Qn,this.distance=n,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new _7e}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const I9=new sn,uw=new Ie,DB=new Ie;class C7e extends d5{constructor(){super(new ho(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Xt(4,2),this._viewportCount=6,this._viewports=[new Mn(2,1,1,1),new Mn(0,1,1,1),new Mn(3,1,1,1),new Mn(1,1,1,1),new Mn(3,0,1,1),new Mn(1,0,1,1)],this._cubeDirections=[new Ie(1,0,0),new Ie(-1,0,0),new Ie(0,0,1),new Ie(0,0,-1),new Ie(0,1,0),new Ie(0,-1,0)],this._cubeUps=[new Ie(0,1,0),new Ie(0,1,0),new Ie(0,1,0),new Ie(0,1,0),new Ie(0,0,1),new Ie(0,0,-1)]}updateMatrices(e,i=0){const n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),uw.setFromMatrixPosition(e.matrixWorld),n.position.copy(uw),DB.copy(n.position),DB.add(this._cubeDirections[i]),n.up.copy(this._cubeUps[i]),n.lookAt(DB),n.updateMatrixWorld(),r.makeTranslation(-uw.x,-uw.y,-uw.z),I9.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(I9)}}class p5 extends Wp{constructor(e,i,n=0,r=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new C7e}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class bx extends gL{constructor(e=-1,i=1,n=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,a=r+i,l=r-i;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,o=s+u*this.view.width,a-=d*this.view.offsetY,l=a-d*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}class S7e extends d5{constructor(){super(new bx(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class m5 extends Wp{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Qn.DEFAULT_UP),this.updateMatrix(),this.target=new Qn,this.shadow=new S7e}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class tse extends Wp{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class ise extends Wp{constructor(e,i,n=10,r=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class nse{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Ie)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return i.copy(o[0]).multiplyScalar(.282095),i.addScaledVector(o[1],.488603*r),i.addScaledVector(o[2],.488603*s),i.addScaledVector(o[3],.488603*n),i.addScaledVector(o[4],1.092548*(n*r)),i.addScaledVector(o[5],1.092548*(r*s)),i.addScaledVector(o[6],.315392*(3*s*s-1)),i.addScaledVector(o[7],1.092548*(n*s)),i.addScaledVector(o[8],.546274*(n*n-r*r)),i}getIrradianceAt(e,i){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return i.copy(o[0]).multiplyScalar(.886227),i.addScaledVector(o[1],2*.511664*r),i.addScaledVector(o[2],2*.511664*s),i.addScaledVector(o[3],2*.511664*n),i.addScaledVector(o[4],2*.429043*n*r),i.addScaledVector(o[5],2*.429043*r*s),i.addScaledVector(o[6],.743125*s*s-.247708),i.addScaledVector(o[7],2*.429043*n*s),i.addScaledVector(o[8],.429043*(n*n-r*r)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,i+r*3);return this}toArray(e=[],i=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,i+r*3);return e}static getBasisAt(e,i){const n=e.x,r=e.y,s=e.z;i[0]=.282095,i[1]=.488603*r,i[2]=.488603*s,i[3]=.488603*n,i[4]=1.092548*n*r,i[5]=1.092548*r*s,i[6]=.315392*(3*s*s-1),i[7]=1.092548*n*s,i[8]=.546274*(n*n-r*r)}}class rse extends Wp{constructor(e=new nse,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class NL extends Xa{constructor(e){super(e),this.textures={}}load(e,i,n,r){const s=this,o=new Tu(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{i(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const i=this.textures;function n(s){return i[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),i[s]}const r=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new Si().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(r.dispersion=e.dispersion),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(r.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(r.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(r.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(r.blendSrc=e.blendSrc),e.blendDst!==void 0&&(r.blendDst=e.blendDst),e.blendEquation!==void 0&&(r.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(r.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(r.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(r.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&r.blendColor!==void 0&&r.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(r.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==void 0&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const o=e.uniforms[s];switch(r.uniforms[s]={},o.type){case"t":r.uniforms[s].value=n(o.value);break;case"c":r.uniforms[s].value=new Si().setHex(o.value);break;case"v2":r.uniforms[s].value=new Xt().fromArray(o.value);break;case"v3":r.uniforms[s].value=new Ie().fromArray(o.value);break;case"v4":r.uniforms[s].value=new Mn().fromArray(o.value);break;case"m3":r.uniforms[s].value=new wn().fromArray(o.value);break;case"m4":r.uniforms[s].value=new sn().fromArray(o.value);break;default:r.uniforms[s].value=o.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(r.lights=e.lights),e.clipping!==void 0&&(r.clipping=e.clipping),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=n(e.map)),e.matcap!==void 0&&(r.matcap=n(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),r.normalScale=new Xt().fromArray(s)}return e.displacementMap!==void 0&&(r.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=n(e.envMap)),e.envMapRotation!==void 0&&r.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new Xt().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(r.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return NL.createMaterialFromType(e)}static createMaterialFromType(e){const i={ShadowMaterial:Gre,SpriteMaterial:QH,RawShaderMaterial:s5,ShaderMaterial:Qc,PointsMaterial:wL,MeshPhysicalMaterial:Yc,MeshStandardMaterial:yx,MeshPhongMaterial:Ure,MeshToonMaterial:Hre,MeshNormalMaterial:$re,MeshLambertMaterial:Wre,MeshDepthMaterial:o5,MeshDistanceMaterial:a5,MeshBasicMaterial:vl,MeshMatcapMaterial:qre,LineDashedMaterial:jre,LineBasicMaterial:xa,Material:po};return new i[e]}}class wp{static extractUrlBase(e){const i=e.lastIndexOf("/");return i===-1?"./":e.slice(0,i+1)}static resolveURL(e,i){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:i+e)}}class g5 extends Rn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class sse extends Xa{constructor(e){super(e)}load(e,i,n,r){const s=this,o=new Tu(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{i(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const i={},n={};function r(y,w){if(i[w]!==void 0)return i[w];const O=y.interleavedBuffers[w],P=s(y,O.buffer),N=$y(O.type,P),F=new nS(N,O.stride);return F.uuid=O.uuid,i[w]=F,F}function s(y,w){if(n[w]!==void 0)return n[w];const O=y.arrayBuffers[w],P=new Uint32Array(O).buffer;return n[w]=P,P}const o=e.isInstancedBufferGeometry?new g5:new Rn,a=e.data.index;if(a!==void 0){const y=$y(a.type,a.array);o.setIndex(new xr(y,1))}const l=e.data.attributes;for(const y in l){const w=l[y];let R;if(w.isInterleavedBufferAttribute){const O=r(e.data,w.data);R=new yl(O,w.itemSize,w.offset,w.normalized)}else{const O=$y(w.type,w.array),P=w.isInstancedBufferAttribute?Hg:xr;R=new P(O,w.itemSize,w.normalized)}w.name!==void 0&&(R.name=w.name),w.usage!==void 0&&R.setUsage(w.usage),o.setAttribute(y,R)}const u=e.data.morphAttributes;if(u)for(const y in u){const w=u[y],R=[];for(let O=0,P=w.length;O<P;O++){const N=w[O];let F;if(N.isInterleavedBufferAttribute){const k=r(e.data,N.data);F=new yl(k,N.itemSize,N.offset,N.normalized)}else{const k=$y(N.type,N.array);F=new xr(k,N.itemSize,N.normalized)}N.name!==void 0&&(F.name=N.name),R.push(F)}o.morphAttributes[y]=R}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const p=e.data.groups||e.data.drawcalls||e.data.offsets;if(p!==void 0)for(let y=0,w=p.length;y!==w;++y){const R=p[y];o.addGroup(R.start,R.count,R.materialIndex)}const v=e.data.boundingSphere;if(v!==void 0){const y=new Ie;v.center!==void 0&&y.fromArray(v.center),o.boundingSphere=new Hs(y,v.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class O7e extends Xa{constructor(e){super(e)}load(e,i,n,r){const s=this,o=this.path===""?wp.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new Tu(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let u=null;try{u=JSON.parse(l)}catch(p){r!==void 0&&r(p),console.error("THREE:ObjectLoader: Can't parse "+e+".",p.message);return}const d=u.metadata;if(d===void 0||d.type===void 0||d.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(u,i)},n,r)}async loadAsync(e,i){const n=this,r=this.path===""?wp.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const s=new Tu(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,i),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(a)}parse(e,i){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){i!==void 0&&i(u)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),u=this.parseObject(e.object,s,l,a,n),d=this.parseSkeletons(e.skeletons,u);if(this.bindSkeletons(u,d),this.bindLightTargets(u),i!==void 0){let p=!1;for(const v in o)if(o[v].data instanceof HTMLImageElement){p=!0;break}p===!1&&i(u)}return u}async parseAsync(e){const i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,o,i),u=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,u),this.bindLightTargets(l),l}parseShapes(e){const i={};if(e!==void 0)for(let n=0,r=e.length;n<r;n++){const s=new Cg().fromJSON(e[n]);i[s.uuid]=s}return i}parseSkeletons(e,i){const n={},r={};if(i.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=new rS().fromJSON(e[s],r);n[a.uuid]=a}return n}parseGeometries(e,i){const n={};if(e!==void 0){const r=new sse;for(let s=0,o=e.length;s<o;s++){let a;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(l);break;default:l.type in P9?a=P9[l.type].fromJSON(l,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),n[l.uuid]=a}}return n}parseMaterials(e,i){const n={},r={};if(e!==void 0){const s=new NL;s.setTextures(i);for(let o=0,a=e.length;o<a;o++){const l=e[o];n[l.uuid]===void 0&&(n[l.uuid]=s.parse(l)),r[l.uuid]=n[l.uuid]}}return r}parseAnimations(e){const i={};if(e!==void 0)for(let n=0;n<e.length;n++){const r=e[n],s=Q0.parse(r);i[s.uuid]=s}return i}parseImages(e,i){const n=this,r={};let s;function o(l){return n.manager.itemStart(l),s.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const u=l,d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:n.resourcePath+u;return o(d)}else return l.data?{data:$y(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new h5(i);s=new vC(l),s.setCrossOrigin(this.crossOrigin);for(let u=0,d=e.length;u<d;u++){const p=e[u],v=p.url;if(Array.isArray(v)){const y=[];for(let w=0,R=v.length;w<R;w++){const O=v[w],P=a(O);P!==null&&(P instanceof HTMLImageElement?y.push(P):y.push(new bh(P.data,P.width,P.height)))}r[p.uuid]=new dp(y)}else{const y=a(p.url);r[p.uuid]=new dp(y)}}}return r}async parseImagesAsync(e){const i=this,n={};let r;async function s(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:i.resourcePath+a;return await r.loadAsync(l)}else return o.data?{data:$y(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){r=new vC(this.manager),r.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],u=l.url;if(Array.isArray(u)){const d=[];for(let p=0,v=u.length;p<v;p++){const y=u[p],w=await s(y);w!==null&&(w instanceof HTMLImageElement?d.push(w):d.push(new bh(w.data,w.width,w.height)))}n[l.uuid]=new dp(d)}else{const d=await s(l.url);n[l.uuid]=new dp(d)}}}return n}parseTextures(e,i){function n(s,o){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),o[s])}const r={};if(e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=e[s];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),i[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=i[a.image],u=l.data;let d;Array.isArray(u)?(d=new iS,u.length===6&&(d.needsUpdate=!0)):(u&&u.data?d=new bh:d=new ds,u&&(d.needsUpdate=!0)),d.source=l,d.uuid=a.uuid,a.name!==void 0&&(d.name=a.name),a.mapping!==void 0&&(d.mapping=n(a.mapping,M7e)),a.channel!==void 0&&(d.channel=a.channel),a.offset!==void 0&&d.offset.fromArray(a.offset),a.repeat!==void 0&&d.repeat.fromArray(a.repeat),a.center!==void 0&&d.center.fromArray(a.center),a.rotation!==void 0&&(d.rotation=a.rotation),a.wrap!==void 0&&(d.wrapS=n(a.wrap[0],k9),d.wrapT=n(a.wrap[1],k9)),a.format!==void 0&&(d.format=a.format),a.internalFormat!==void 0&&(d.internalFormat=a.internalFormat),a.type!==void 0&&(d.type=a.type),a.colorSpace!==void 0&&(d.colorSpace=a.colorSpace),a.minFilter!==void 0&&(d.minFilter=n(a.minFilter,D9)),a.magFilter!==void 0&&(d.magFilter=n(a.magFilter,D9)),a.anisotropy!==void 0&&(d.anisotropy=a.anisotropy),a.flipY!==void 0&&(d.flipY=a.flipY),a.generateMipmaps!==void 0&&(d.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(d.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(d.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(d.compareFunction=a.compareFunction),a.userData!==void 0&&(d.userData=a.userData),r[a.uuid]=d}return r}parseObject(e,i,n,r,s){let o;function a(v){return i[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",v),i[v]}function l(v){if(v!==void 0){if(Array.isArray(v)){const y=[];for(let w=0,R=v.length;w<R;w++){const O=v[w];n[O]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",O),y.push(n[O])}return y}return n[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",v),n[v]}}function u(v){return r[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",v),r[v]}let d,p;switch(e.type){case"Scene":o=new jH,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new Si(e.background):o.background=u(e.background)),e.environment!==void 0&&(o.environment=u(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new yL(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new vL(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&o.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(o.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&o.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":o=new ho(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new bx(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new tse(e.color,e.intensity);break;case"DirectionalLight":o=new m5(e.color,e.intensity),o.target=e.target||"";break;case"PointLight":o=new p5(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new ise(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new f5(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),o.target=e.target||"";break;case"HemisphereLight":o=new ese(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new rse().fromJSON(e);break;case"SkinnedMesh":d=a(e.geometry),p=l(e.material),o=new ZH(d,p),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":d=a(e.geometry),p=l(e.material),o=new us(d,p);break;case"InstancedMesh":d=a(e.geometry),p=l(e.material);const v=e.count,y=e.instanceMatrix,w=e.instanceColor;o=new bL(d,p,v),o.instanceMatrix=new Hg(new Float32Array(y.array),16),w!==void 0&&(o.instanceColor=new Hg(new Float32Array(w.array),w.itemSize));break;case"BatchedMesh":d=a(e.geometry),p=l(e.material),o=new Pre(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,p),o.geometry=d,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map(R=>{const O=new Es;O.min.fromArray(R.boxMin),O.max.fromArray(R.boxMax);const P=new Hs;return P.radius=R.sphereRadius,P.center.fromArray(R.sphereCenter),{boxInitialized:R.boxInitialized,box:O,sphereInitialized:R.sphereInitialized,sphere:P}}),o._maxInstanceCount=e.maxInstanceCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=u(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(o._colorsTexture=u(e.colorsTexture.uuid));break;case"LOD":o=new Rre;break;case"Line":o=new Yd(a(e.geometry),l(e.material));break;case"LineLoop":o=new XH(a(e.geometry),l(e.material));break;case"LineSegments":o=new Eu(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new KH(a(e.geometry),l(e.material));break;case"Sprite":o=new Tre(l(e.material));break;case"Group":o=new Xl;break;case"Bone":o=new xL;break;default:o=new Qn}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(o.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const v=e.children;for(let y=0;y<v.length;y++)o.add(this.parseObject(v[y],i,n,r,s))}if(e.animations!==void 0){const v=e.animations;for(let y=0;y<v.length;y++){const w=v[y];o.animations.push(s[w])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const v=e.levels;for(let y=0;y<v.length;y++){const w=v[y],R=o.getObjectByProperty("uuid",w.object);R!==void 0&&o.addLevel(R,w.distance,w.hysteresis)}}return o}bindSkeletons(e,i){Object.keys(i).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const r=i[n.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(r,n.bindMatrix)}})}bindLightTargets(e){e.traverse(function(i){if(i.isDirectionalLight||i.isSpotLight){const n=i.target,r=e.getObjectByProperty("uuid",n);r!==void 0?i.target=r:i.target=new Qn}})}}const M7e={UVMapping:rL,CubeReflectionMapping:Xd,CubeRefractionMapping:Ep,EquirectangularReflectionMapping:oC,EquirectangularRefractionMapping:aC,CubeUVReflectionMapping:px},k9={RepeatWrapping:Ap,ClampToEdgeWrapping:Zl,MirroredRepeatWrapping:B0},D9={NearestFilter:fo,NearestMipmapNearestFilter:sL,NearestMipmapLinearFilter:tg,LinearFilter:Ps,LinearMipmapNearestFilter:o0,LinearMipmapLinearFilter:Fc};class ose extends Xa{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,i,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Md.get(e);if(o!==void 0){if(s.manager.itemStart(e),o.then){o.then(u=>{i&&i(u),s.manager.itemEnd(e)}).catch(u=>{r&&r(u)});return}return setTimeout(function(){i&&i(o),s.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(u){return u.blob()}).then(function(u){return createImageBitmap(u,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(u){return Md.add(e,u),i&&i(u),s.manager.itemEnd(e),u}).catch(function(u){r&&r(u),Md.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});Md.add(e,l),s.manager.itemStart(e)}}let qO;class v5{static getContext(){return qO===void 0&&(qO=new(window.AudioContext||window.webkitAudioContext)),qO}static setContext(e){qO=e}}class T7e extends Xa{constructor(e){super(e)}load(e,i,n,r){const s=this,o=new Tu(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const u=l.slice(0);v5.getContext().decodeAudioData(u,function(p){i(p)}).catch(a)}catch(u){a(u)}},n,r);function a(l){r?r(l):console.error(l),s.manager.itemError(e)}}}const L9=new sn,F9=new sn,Rm=new sn;class R7e{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ho,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ho,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const i=this._cache;if(i.focus!==e.focus||i.fov!==e.fov||i.aspect!==e.aspect*this.aspect||i.near!==e.near||i.far!==e.far||i.zoom!==e.zoom||i.eyeSep!==this.eyeSep){i.focus=e.focus,i.fov=e.fov,i.aspect=e.aspect*this.aspect,i.near=e.near,i.far=e.far,i.zoom=e.zoom,i.eyeSep=this.eyeSep,Rm.copy(e.projectionMatrix);const r=i.eyeSep/2,s=r*i.near/i.focus,o=i.near*Math.tan(_g*i.fov*.5)/i.zoom;let a,l;F9.elements[12]=-r,L9.elements[12]=r,a=-o*i.aspect+s,l=o*i.aspect+s,Rm.elements[0]=2*i.near/(l-a),Rm.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(Rm),a=-o*i.aspect-s,l=o*i.aspect-s,Rm.elements[0]=2*i.near/(l-a),Rm.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(Rm)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(F9),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(L9)}}class ase extends ho{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e,this.index=0}}class lse{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=N9(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=N9();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}function N9(){return performance.now()}const Pm=new Ie,B9=new pa,P7e=new Ie,Em=new Ie;class E7e extends Qn{constructor(){super(),this.type="AudioListener",this.context=v5.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new lse}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const i=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Pm,B9,P7e),Em.set(0,0,-1).applyQuaternion(B9),i.positionX){const r=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(Pm.x,r),i.positionY.linearRampToValueAtTime(Pm.y,r),i.positionZ.linearRampToValueAtTime(Pm.z,r),i.forwardX.linearRampToValueAtTime(Em.x,r),i.forwardY.linearRampToValueAtTime(Em.y,r),i.forwardZ.linearRampToValueAtTime(Em.z,r),i.upX.linearRampToValueAtTime(n.x,r),i.upY.linearRampToValueAtTime(n.y,r),i.upZ.linearRampToValueAtTime(n.z,r)}else i.setPosition(Pm.x,Pm.y,Pm.z),i.setOrientation(Em.x,Em.y,Em.z,n.x,n.y,n.z)}}class cse extends Qn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,i){return super.copy(e,i),e.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const Am=new Ie,z9=new pa,A7e=new Ie,Im=new Ie;class I7e extends cse{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,i,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Am,z9,A7e),Im.set(0,0,1).applyQuaternion(z9);const i=this.panner;if(i.positionX){const n=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(Am.x,n),i.positionY.linearRampToValueAtTime(Am.y,n),i.positionZ.linearRampToValueAtTime(Am.z,n),i.orientationX.linearRampToValueAtTime(Im.x,n),i.orientationY.linearRampToValueAtTime(Im.y,n),i.orientationZ.linearRampToValueAtTime(Im.z,n)}else i.setPosition(Am.x,Am.y,Am.z),i.setOrientation(Im.x,Im.y,Im.z)}}class k7e{constructor(e,i=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const i=this.getFrequencyData();for(let n=0;n<i.length;n++)e+=i[n];return e/i.length}}class use{constructor(e,i,n){this.binding=e,this.valueSize=n;let r,s,o;switch(i){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,i){const n=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)n[s+a]=n[a];o=i}else{o+=i;const a=i/o;this._mixBufferRegion(n,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const i=this.buffer,n=this.valueSize,r=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const i=this.valueSize,n=this.buffer,r=e*i+i,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=i*this._origIndex;this._mixBufferRegion(n,r,l,1-s,i)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*i,1,i);for(let l=i,u=i+i;l!==u;++l)if(n[l]!==n[l+i]){a.setValue(n,r);break}}saveOriginalState(){const e=this.binding,i=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(i,r);for(let s=n,o=r;s!==o;++s)i[s]=i[r+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,i=e+this.valueSize;for(let n=e;n<i;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[i+n]=this.buffer[e+n]}_select(e,i,n,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[i+o]=e[n+o]}_slerp(e,i,n,r){pa.slerpFlat(e,i,e,i,e,n,r)}_slerpAdditive(e,i,n,r,s){const o=this._workIndex*s;pa.multiplyQuaternionsFlat(e,o,e,i,e,n),pa.slerpFlat(e,i,e,i,e,o,r)}_lerp(e,i,n,r,s){const o=1-r;for(let a=0;a!==s;++a){const l=i+a;e[l]=e[l]*o+e[n+a]*r}}_lerpAdditive(e,i,n,r,s){for(let o=0;o!==s;++o){const a=i+o;e[a]=e[a]+e[n+o]*r}}}const y5="\\[\\]\\.:\\/",D7e=new RegExp("["+y5+"]","g"),x5="[^"+y5+"]",L7e="[^"+y5.replace("\\.","")+"]",F7e=/((?:WC+[\/:])*)/.source.replace("WC",x5),N7e=/(WCOD+)?/.source.replace("WCOD",L7e),B7e=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",x5),z7e=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",x5),V7e=new RegExp("^"+F7e+N7e+B7e+z7e+"$"),G7e=["material","materials","bones","map"];class U7e{constructor(e,i,n){const r=n||cr.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,r)}getValue(e,i){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(e,i)}setValue(e,i){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=n.length;r!==s;++r)n[r].setValue(e,i)}bind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].bind()}unbind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=e.length;i!==n;++i)e[i].unbind()}}class cr{constructor(e,i,n){this.path=i,this.parsedPath=n||cr.parseTrackName(i),this.node=cr.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,n){return e&&e.isAnimationObjectGroup?new cr.Composite(e,i,n):new cr(e,i,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(D7e,"")}static parseTrackName(e){const i=V7e.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=n.nodeName.substring(r+1);G7e.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(i);if(n!==void 0)return n}if(e.children){const n=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===i||a.uuid===i)return a;const l=n(a.children);if(l)return l}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)e[i++]=n[r]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,n=i.objectName,r=i.propertyName;let s=i.propertyIndex;if(e||(e=cr.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let u=i.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let d=0;d<e.length;d++)if(e[d].name===u){u=d;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(u!==void 0){if(e[u]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[u]}}const o=e[r];if(o===void 0){const u=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?a=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}cr.Composite=U7e;cr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};cr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};cr.prototype.GetterByBindingType=[cr.prototype._getValue_direct,cr.prototype._getValue_array,cr.prototype._getValue_arrayElement,cr.prototype._getValue_toArray];cr.prototype.SetterByBindingTypeAndVersioning=[[cr.prototype._setValue_direct,cr.prototype._setValue_direct_setNeedsUpdate,cr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[cr.prototype._setValue_array,cr.prototype._setValue_array_setNeedsUpdate,cr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[cr.prototype._setValue_arrayElement,cr.prototype._setValue_arrayElement_setNeedsUpdate,cr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[cr.prototype._setValue_fromArray,cr.prototype._setValue_fromArray_setNeedsUpdate,cr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class H7e{constructor(){this.isAnimationObjectGroup=!0,this.uuid=tc(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,r=arguments.length;n!==r;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const e=this._objects,i=this._indicesByUUID,n=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length;let a,l=e.length,u=this.nCachedObjects_;for(let d=0,p=arguments.length;d!==p;++d){const v=arguments[d],y=v.uuid;let w=i[y];if(w===void 0){w=l++,i[y]=w,e.push(v);for(let R=0,O=o;R!==O;++R)s[R].push(new cr(v,n[R],r[R]))}else if(w<u){a=e[w];const R=--u,O=e[R];i[O.uuid]=w,e[w]=O,i[y]=R,e[R]=v;for(let P=0,N=o;P!==N;++P){const F=s[P],k=F[R];let $=F[w];F[w]=k,$===void 0&&($=new cr(v,n[P],r[P])),F[R]=$}}else e[w]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const e=this._objects,i=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],u=l.uuid,d=i[u];if(d!==void 0&&d>=s){const p=s++,v=e[p];i[v.uuid]=d,e[d]=v,i[u]=p,e[p]=l;for(let y=0,w=r;y!==w;++y){const R=n[y],O=R[p],P=R[d];R[d]=O,R[p]=P}}}this.nCachedObjects_=s}uncache(){const e=this._objects,i=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const u=arguments[a],d=u.uuid,p=i[d];if(p!==void 0)if(delete i[d],p<s){const v=--s,y=e[v],w=--o,R=e[w];i[y.uuid]=p,e[p]=y,i[R.uuid]=v,e[v]=R,e.pop();for(let O=0,P=r;O!==P;++O){const N=n[O],F=N[v],k=N[w];N[p]=F,N[v]=k,N.pop()}}else{const v=--o,y=e[v];v>0&&(i[y.uuid]=p),e[p]=y,e.pop();for(let w=0,R=r;w!==R;++w){const O=n[w];O[p]=O[v],O.pop()}}}this.nCachedObjects_=s}subscribe_(e,i){const n=this._bindingsIndicesByPath;let r=n[e];const s=this._bindings;if(r!==void 0)return s[r];const o=this._paths,a=this._parsedPaths,l=this._objects,u=l.length,d=this.nCachedObjects_,p=new Array(u);r=s.length,n[e]=r,o.push(e),a.push(i),s.push(p);for(let v=d,y=l.length;v!==y;++v){const w=l[v];p[v]=new cr(w,e,i)}return p}unsubscribe_(e){const i=this._bindingsIndicesByPath,n=i[e];if(n!==void 0){const r=this._paths,s=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],u=e[a];i[u]=n,o[n]=l,o.pop(),s[n]=s[a],s.pop(),r[n]=r[a],r.pop()}}}class hse{constructor(e,i,n=null,r=i.blendMode){this._mixer=e,this._clip=i,this._localRoot=n,this.blendMode=r;const s=i.tracks,o=s.length,a=new Array(o),l={endingStart:ig,endingEnd:ig};for(let u=0;u!==o;++u){const d=s[u].createInterpolant(null);a[u]=d,d.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=sre,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,i){return this.loop=e,this.repetitions=i,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,i,n=!1){if(e.fadeOut(i),this.fadeIn(i),n===!0){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,i),this.warp(a,1,i)}return this}crossFadeTo(e,i,n=!1){return e.crossFadeFrom(this,i,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,i,n){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,u=a.sampleValues;return l[0]=s,l[1]=s+n,u[0]=e/o,u[1]=i/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,i,n,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*n;l<0||n===0?i=0:(this._startTime=null,i=n*l)}i*=this._updateTimeScale(e);const o=this._updateTime(i),a=this._updateWeight(e);if(a>0){const l=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case VH:for(let d=0,p=l.length;d!==p;++d)l[d].evaluate(o),u[d].accumulateAdditive(a);break;case dL:default:for(let d=0,p=l.length;d!==p;++d)l[d].evaluate(o),u[d].accumulate(r,a)}}}_updateWeight(e){let i=0;if(this.enabled){i=this.weight;const n=this._weightInterpolant;if(n!==null){const r=n.evaluate(e)[0];i*=r,e>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(e){let i=0;if(!this.paused){i=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const r=n.evaluate(e)[0];i*=r,e>n.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(e){const i=this._clip.duration,n=this.loop;let r=this.time+e,s=this._loopCount;const o=n===ore;if(e===0)return s===-1?r:o&&(s&1)===1?i-r:r;if(n===rre){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=i)r=i;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=i||r<0){const a=Math.floor(r/i);r-=i*a,s+=Math.abs(a);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?i:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const u=e<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)===1)return i-r}return r}_setEndings(e,i,n){const r=this._interpolantSettings;n?(r.endingStart=ng,r.endingEnd=ng):(e?r.endingStart=this.zeroSlopeAtStart?ng:ig:r.endingStart=lC,i?r.endingEnd=this.zeroSlopeAtEnd?ng:ig:r.endingEnd=lC)}_scheduleFading(e,i,n){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,l[0]=i,a[1]=s+e,l[1]=n,this}}const $7e=new Float32Array(1);class W7e extends Uh{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,i){const n=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,l=n.uuid,u=this._bindingsByRootAndName;let d=u[l];d===void 0&&(d={},u[l]=d);for(let p=0;p!==s;++p){const v=r[p],y=v.name;let w=d[y];if(w!==void 0)++w.referenceCount,o[p]=w;else{if(w=o[p],w!==void 0){w._cacheIndex===null&&(++w.referenceCount,this._addInactiveBinding(w,l,y));continue}const R=i&&i._propertyBindings[p].binding.parsedPath;w=new use(cr.create(n,y,R),v.ValueTypeName,v.getValueSize()),++w.referenceCount,this._addInactiveBinding(w,l,y),o[p]=w}a[p].resultBuffer=w.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,n)}const i=e._propertyBindings;for(let n=0,r=i.length;n!==r;++n){const s=i[n];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const i=e._propertyBindings;for(let n=0,r=i.length;n!==r;++n){const s=i[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const i=e._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(e,i,n){const r=this._actions,s=this._actionsByClip;let o=s[i];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[i]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const i=this._actions,n=i[i.length-1],r=e._cacheIndex;n._cacheIndex=r,i[r]=n,i.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],l=a.knownActions,u=l[l.length-1],d=e._byClipCacheIndex;u._byClipCacheIndex=d,l[d]=u,l.pop(),e._byClipCacheIndex=null;const p=a.actionByRoot,v=(e._localRoot||this._root).uuid;delete p[v],l.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const i=e._propertyBindings;for(let n=0,r=i.length;n!==r;++n){const s=i[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const i=this._actions,n=e._cacheIndex,r=this._nActiveActions++,s=i[r];e._cacheIndex=r,i[r]=e,s._cacheIndex=n,i[n]=s}_takeBackAction(e){const i=this._actions,n=e._cacheIndex,r=--this._nActiveActions,s=i[r];e._cacheIndex=r,i[r]=e,s._cacheIndex=n,i[n]=s}_addInactiveBinding(e,i,n){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[i];o===void 0&&(o={},r[i]=o),o[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const i=this._bindings,n=e.binding,r=n.rootNode.uuid,s=n.path,o=this._bindingsByRootAndName,a=o[r],l=i[i.length-1],u=e._cacheIndex;l._cacheIndex=u,i[u]=l,i.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const i=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,s=i[r];e._cacheIndex=r,i[r]=e,s._cacheIndex=n,i[n]=s}_takeBackBinding(e){const i=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,s=i[r];e._cacheIndex=r,i[r]=e,s._cacheIndex=n,i[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,i=this._nActiveControlInterpolants++;let n=e[i];return n===void 0&&(n=new c5(new Float32Array(2),new Float32Array(2),1,$7e),n.__cacheIndex=i,e[i]=n),n}_takeBackControlInterpolant(e){const i=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=i[r];e.__cacheIndex=r,i[r]=e,s.__cacheIndex=n,i[n]=s}clipAction(e,i,n){const r=i||this._root,s=r.uuid;let o=typeof e=="string"?Q0.findByName(r,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let u=null;if(n===void 0&&(o!==null?n=o.blendMode:n=dL),l!==void 0){const p=l.actionByRoot[s];if(p!==void 0&&p.blendMode===n)return p;u=l.knownActions[0],o===null&&(o=u._clip)}if(o===null)return null;const d=new hse(this,o,i,n);return this._bindAction(d,u),this._addInactiveAction(d,a,s),d}existingAction(e,i){const n=i||this._root,r=n.uuid,s=typeof e=="string"?Q0.findByName(n,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,i=this._nActiveActions;for(let n=i-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const i=this._actions,n=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let u=0;u!==n;++u)i[u]._update(r,e,s,o);const a=this._bindings,l=this._nActiveBindings;for(let u=0;u!==l;++u)a[u].apply(o);return this}setTime(e){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const i=this._actions,n=e.uuid,r=this._actionsByClip,s=r[n];if(s!==void 0){const o=s.knownActions;for(let a=0,l=o.length;a!==l;++a){const u=o[a];this._deactivateAction(u);const d=u._cacheIndex,p=i[i.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,p._cacheIndex=d,i[d]=p,i.pop(),this._removeInactiveBindingsForAction(u)}delete r[n]}}uncacheRoot(e){const i=e.uuid,n=this._actionsByClip;for(const o in n){const a=n[o].actionByRoot,l=a[i];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[i];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,i){const n=this.existingAction(e,i);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class q7e extends fL{constructor(e=1,i=1,n=1,r={}){super(e,i,r),this.isRenderTarget3D=!0,this.depth=n,this.texture=new pL(null,e,i,n),this.texture.isRenderTargetTexture=!0}}class j7e extends fL{constructor(e=1,i=1,n=1,r={}){super(e,i,r),this.isRenderTargetArray=!0,this.depth=n,this.texture=new eS(null,e,i,n),this.texture.isRenderTargetTexture=!0}}class b5{constructor(e){this.value=e}clone(){return new b5(this.value.clone===void 0?this.value:this.value.clone())}}let Q7e=0;class Z7e extends Uh{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Q7e++}),this.name="",this.usage=uC,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const i=this.uniforms.indexOf(e);return i!==-1&&this.uniforms.splice(i,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const i=e.uniforms;this.uniforms.length=0;for(let n=0,r=i.length;n<r;n++){const s=Array.isArray(i[n])?i[n]:[i[n]];for(let o=0;o<s.length;o++)this.uniforms.push(s[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class jR extends nS{constructor(e,i,n=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){const i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class X7e{constructor(e,i,n,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=i,this.itemSize=n,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,i){return this.type=e,this.elementSize=i,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const V9=new sn;class dse{constructor(e,i,n=0,r=1/0){this.ray=new sv(e,i),this.near=n,this.far=r,this.camera=null,this.layers=new mL,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}setFromXRController(e){return V9.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(V9),this}intersectObject(e,i=!0,n=[]){return kV(e,this,n,i),n.sort(G9),n}intersectObjects(e,i=!0,n=[]){for(let r=0,s=e.length;r<s;r++)kV(e[r],this,n,i);return n.sort(G9),n}}function G9(t,e){return t.distance-e.distance}function kV(t,e,i,n){let r=!0;if(t.layers.test(e.layers)&&t.raycast(e,i)===!1&&(r=!1),r===!0&&n===!0){const s=t.children;for(let o=0,a=s.length;o<a;o++)kV(s[o],e,i,!0)}}class K7e{constructor(e=1,i=0,n=0){this.radius=e,this.phi=i,this.theta=n}set(e,i,n){return this.radius=e,this.phi=i,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Sn(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,n){return this.radius=Math.sqrt(e*e+i*i+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Sn(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Y7e{constructor(e=1,i=0,n=0){this.radius=e,this.theta=i,this.y=n}set(e,i,n){return this.radius=e,this.theta=i,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=i,this}clone(){return new this.constructor().copy(this)}}class w5{constructor(e,i,n,r){w5.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,i,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,i=0){for(let n=0;n<4;n++)this.elements[n]=e[n+i];return this}set(e,i,n,r){const s=this.elements;return s[0]=e,s[2]=i,s[1]=n,s[3]=r,this}}const U9=new Xt;class J7e{constructor(e=new Xt(1/0,1/0),i=new Xt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromPoints(e){this.makeEmpty();for(let i=0,n=e.length;i<n;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const n=U9.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,U9).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const H9=new Ie,jO=new Ie;class _5{constructor(e=new Ie,i=new Ie){this.start=e,this.end=i}set(e,i){return this.start.copy(e),this.end.copy(i),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,i){return this.delta(i).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,i){H9.subVectors(e,this.start),jO.subVectors(this.end,this.start);const n=jO.dot(jO);let s=jO.dot(H9)/n;return i&&(s=Sn(s,0,1)),s}closestPointToPoint(e,i,n){const r=this.closestPointToPointParameter(e,i);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const $9=new Ie;class eXe extends Qn{constructor(e,i){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const n=new Rn,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const u=o/l*Math.PI*2,d=a/l*Math.PI*2;r.push(Math.cos(u),Math.sin(u),1,Math.cos(d),Math.sin(d),1)}n.setAttribute("position",new Hi(r,3));const s=new xa({fog:!1,toneMapped:!1});this.cone=new Eu(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,i=e*Math.tan(this.light.angle);this.cone.scale.set(i,i,e),$9.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt($9),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Uf=new Ie,QO=new sn,LB=new sn;class tXe extends Eu{constructor(e){const i=fse(e),n=new Rn,r=[],s=[],o=new Si(0,0,1),a=new Si(0,1,0);for(let u=0;u<i.length;u++){const d=i[u];d.parent&&d.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(o.r,o.g,o.b),s.push(a.r,a.g,a.b))}n.setAttribute("position",new Hi(r,3)),n.setAttribute("color",new Hi(s,3));const l=new xa({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=i,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const i=this.bones,n=this.geometry,r=n.getAttribute("position");LB.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<i.length;s++){const a=i[s];a.parent&&a.parent.isBone&&(QO.multiplyMatrices(LB,a.matrixWorld),Uf.setFromMatrixPosition(QO),r.setXYZ(o,Uf.x,Uf.y,Uf.z),QO.multiplyMatrices(LB,a.parent.matrixWorld),Uf.setFromMatrixPosition(QO),r.setXYZ(o+1,Uf.x,Uf.y,Uf.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function fse(t){const e=[];t.isBone===!0&&e.push(t);for(let i=0;i<t.children.length;i++)e.push(...fse(t.children[i]));return e}class iXe extends us{constructor(e,i,n){const r=new ov(i,4,2),s=new vl({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const nXe=new Ie,W9=new Si,q9=new Si;class rXe extends Qn{constructor(e,i,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new aS(i);r.rotateY(Math.PI*.5),this.material=new vl({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),o=new Float32Array(s.count*3);r.setAttribute("color",new xr(o,3)),this.add(new us(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=e.geometry.getAttribute("color");W9.copy(this.light.color),q9.copy(this.light.groundColor);for(let n=0,r=i.count;n<r;n++){const s=n<r/2?W9:q9;i.setXYZ(n,s.r,s.g,s.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(nXe.setFromMatrixPosition(this.light.matrixWorld).negate())}}class sXe extends Eu{constructor(e=10,i=10,n=4473924,r=8947848){n=new Si(n),r=new Si(r);const s=i/2,o=e/i,a=e/2,l=[],u=[];for(let v=0,y=0,w=-a;v<=i;v++,w+=o){l.push(-a,0,w,a,0,w),l.push(w,0,-a,w,0,a);const R=v===s?n:r;R.toArray(u,y),y+=3,R.toArray(u,y),y+=3,R.toArray(u,y),y+=3,R.toArray(u,y),y+=3}const d=new Rn;d.setAttribute("position",new Hi(l,3)),d.setAttribute("color",new Hi(u,3));const p=new xa({vertexColors:!0,toneMapped:!1});super(d,p),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class oXe extends Eu{constructor(e=10,i=16,n=8,r=64,s=4473924,o=8947848){s=new Si(s),o=new Si(o);const a=[],l=[];if(i>1)for(let p=0;p<i;p++){const v=p/i*(Math.PI*2),y=Math.sin(v)*e,w=Math.cos(v)*e;a.push(0,0,0),a.push(y,0,w);const R=p&1?s:o;l.push(R.r,R.g,R.b),l.push(R.r,R.g,R.b)}for(let p=0;p<n;p++){const v=p&1?s:o,y=e-e/n*p;for(let w=0;w<r;w++){let R=w/r*(Math.PI*2),O=Math.sin(R)*y,P=Math.cos(R)*y;a.push(O,0,P),l.push(v.r,v.g,v.b),R=(w+1)/r*(Math.PI*2),O=Math.sin(R)*y,P=Math.cos(R)*y,a.push(O,0,P),l.push(v.r,v.g,v.b)}}const u=new Rn;u.setAttribute("position",new Hi(a,3)),u.setAttribute("color",new Hi(l,3));const d=new xa({vertexColors:!0,toneMapped:!1});super(u,d),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const j9=new Ie,ZO=new Ie,Q9=new Ie;class aXe extends Qn{constructor(e,i,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",i===void 0&&(i=1);let r=new Rn;r.setAttribute("position",new Hi([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const s=new xa({fog:!1,toneMapped:!1});this.lightPlane=new Yd(r,s),this.add(this.lightPlane),r=new Rn,r.setAttribute("position",new Hi([0,0,0,0,0,1],3)),this.targetLine=new Yd(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),j9.setFromMatrixPosition(this.light.matrixWorld),ZO.setFromMatrixPosition(this.light.target.matrixWorld),Q9.subVectors(ZO,j9),this.lightPlane.lookAt(ZO),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ZO),this.targetLine.scale.z=Q9.length()}}const XO=new Ie,Os=new gL;class lXe extends Eu{constructor(e){const i=new Rn,n=new xa({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(w,R){l(w),l(R)}function l(w){r.push(0,0,0),s.push(0,0,0),o[w]===void 0&&(o[w]=[]),o[w].push(r.length/3-1)}i.setAttribute("position",new Hi(r,3)),i.setAttribute("color",new Hi(s,3)),super(i,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const u=new Si(16755200),d=new Si(16711680),p=new Si(43775),v=new Si(16777215),y=new Si(3355443);this.setColors(u,d,p,v,y)}setColors(e,i,n,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,i.r,i.g,i.b),a.setXYZ(25,i.r,i.g,i.b),a.setXYZ(26,i.r,i.g,i.b),a.setXYZ(27,i.r,i.g,i.b),a.setXYZ(28,i.r,i.g,i.b),a.setXYZ(29,i.r,i.g,i.b),a.setXYZ(30,i.r,i.g,i.b),a.setXYZ(31,i.r,i.g,i.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const e=this.geometry,i=this.pointMap,n=1,r=1;Os.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const s=this.camera.coordinateSystem===wu?-1:0;zs("c",i,e,Os,0,0,s),zs("t",i,e,Os,0,0,1),zs("n1",i,e,Os,-1,-1,s),zs("n2",i,e,Os,n,-1,s),zs("n3",i,e,Os,-1,r,s),zs("n4",i,e,Os,n,r,s),zs("f1",i,e,Os,-1,-1,1),zs("f2",i,e,Os,n,-1,1),zs("f3",i,e,Os,-1,r,1),zs("f4",i,e,Os,n,r,1),zs("u1",i,e,Os,n*.7,r*1.1,s),zs("u2",i,e,Os,-1*.7,r*1.1,s),zs("u3",i,e,Os,0,r*2,s),zs("cf1",i,e,Os,-1,0,1),zs("cf2",i,e,Os,n,0,1),zs("cf3",i,e,Os,0,-1,1),zs("cf4",i,e,Os,0,r,1),zs("cn1",i,e,Os,-1,0,s),zs("cn2",i,e,Os,n,0,s),zs("cn3",i,e,Os,0,-1,s),zs("cn4",i,e,Os,0,r,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function zs(t,e,i,n,r,s,o){XO.set(r,s,o).unproject(n);const a=e[t];if(a!==void 0){const l=i.getAttribute("position");for(let u=0,d=a.length;u<d;u++)l.setXYZ(a[u],XO.x,XO.y,XO.z)}}const KO=new Es;class cXe extends Eu{constructor(e,i=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),s=new Rn;s.setIndex(new xr(n,1)),s.setAttribute("position",new xr(r,3)),super(s,new xa({color:i,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&KO.setFromObject(this.object),KO.isEmpty())return;const e=KO.min,i=KO.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,i){return super.copy(e,i),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class uXe extends Eu{constructor(e,i=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Rn;s.setIndex(new xr(n,1)),s.setAttribute("position",new Hi(r,3)),super(s,new xa({color:i,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class hXe extends Yd{constructor(e,i=1,n=16776960){const r=n,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new Rn;o.setAttribute("position",new Hi(s,3)),o.computeBoundingSphere(),super(o,new xa({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=i;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Rn;l.setAttribute("position",new Hi(a,3)),l.computeBoundingSphere(),this.add(new us(l,new vl({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Z9=new Ie;let YO,FB;class dXe extends Qn{constructor(e=new Ie(0,0,1),i=new Ie(0,0,0),n=1,r=16776960,s=n*.2,o=s*.2){super(),this.type="ArrowHelper",YO===void 0&&(YO=new Rn,YO.setAttribute("position",new Hi([0,0,0,0,1,0],3)),FB=new gx(0,.5,1,5,1),FB.translate(0,-.5,0)),this.position.copy(i),this.line=new Yd(YO,new xa({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new us(FB,new vl({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Z9.set(e.z,0,-e.x).normalize();const i=Math.acos(e.y);this.quaternion.setFromAxisAngle(Z9,i)}}setLength(e,i=e*.2,n=i*.2){this.line.scale.set(1,Math.max(1e-4,e-i),1),this.line.updateMatrix(),this.cone.scale.set(n,i,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class fXe extends Eu{constructor(e=1){const i=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Rn;r.setAttribute("position",new Hi(i,3)),r.setAttribute("color",new Hi(n,3));const s=new xa({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,i,n){const r=new Si,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(i),r.toArray(s,6),r.toArray(s,9),r.set(n),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class pXe{constructor(){this.type="ShapePath",this.color=new Si,this.subPaths=[],this.currentPath=null}moveTo(e,i){return this.currentPath=new fC,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,i),this}lineTo(e,i){return this.currentPath.lineTo(e,i),this}quadraticCurveTo(e,i,n,r){return this.currentPath.quadraticCurveTo(e,i,n,r),this}bezierCurveTo(e,i,n,r,s,o){return this.currentPath.bezierCurveTo(e,i,n,r,s,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function i(P){const N=[];for(let F=0,k=P.length;F<k;F++){const $=P[F],W=new Cg;W.curves=$.curves,N.push(W)}return N}function n(P,N){const F=N.length;let k=!1;for(let $=F-1,W=0;W<F;$=W++){let Q=N[$],Y=N[W],M=Y.x-Q.x,D=Y.y-Q.y;if(Math.abs(D)>Number.EPSILON){if(D<0&&(Q=N[W],M=-M,Y=N[$],D=-D),P.y<Q.y||P.y>Y.y)continue;if(P.y===Q.y){if(P.x===Q.x)return!0}else{const G=D*(P.x-Q.x)-M*(P.y-Q.y);if(G===0)return!0;if(G<0)continue;k=!k}}else{if(P.y!==Q.y)continue;if(Y.x<=P.x&&P.x<=Q.x||Q.x<=P.x&&P.x<=Y.x)return!0}}return k}const r=wh.isClockWise,s=this.subPaths;if(s.length===0)return[];let o,a,l;const u=[];if(s.length===1)return a=s[0],l=new Cg,l.curves=a.curves,u.push(l),u;let d=!r(s[0].getPoints());d=e?!d:d;const p=[],v=[];let y=[],w=0,R;v[w]=void 0,y[w]=[];for(let P=0,N=s.length;P<N;P++)a=s[P],R=a.getPoints(),o=r(R),o=e?!o:o,o?(!d&&v[w]&&w++,v[w]={s:new Cg,p:R},v[w].s.curves=a.curves,d&&w++,y[w]=[]):y[w].push({h:a,p:R[0]});if(!v[0])return i(s);if(v.length>1){let P=!1,N=0;for(let F=0,k=v.length;F<k;F++)p[F]=[];for(let F=0,k=v.length;F<k;F++){const $=y[F];for(let W=0;W<$.length;W++){const Q=$[W];let Y=!0;for(let M=0;M<v.length;M++)n(Q.p,v[M].p)&&(F!==M&&N++,Y?(Y=!1,p[M].push(Q)):P=!0);Y&&p[F].push(Q)}}N>0&&P===!1&&(y=p)}let O;for(let P=0,N=v.length;P<N;P++){l=v[P].s,u.push(l),O=y[P];for(let F=0,k=O.length;F<k;F++)l.holes.push(O[F].h)}return u}}class mXe extends Uh{constructor(e,i=null){super(),this.object=e,this.domElement=i,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function gXe(t,e){const i=t.image&&t.image.width?t.image.width/t.image.height:1;return i>e?(t.repeat.x=1,t.repeat.y=i/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2):(t.repeat.x=e/i,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0),t}function vXe(t,e){const i=t.image&&t.image.width?t.image.width/t.image.height:1;return i>e?(t.repeat.x=e/i,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0):(t.repeat.x=1,t.repeat.y=i/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2),t}function yXe(t){return t.repeat.x=1,t.repeat.y=1,t.offset.x=0,t.offset.y=0,t}function DV(t,e,i,n){const r=xXe(n);switch(i){case DH:return t*e;case FH:return t*e;case NH:return t*e*2;case cL:return t*e/r.components*r.byteLength;case JC:return t*e/r.components*r.byteLength;case BH:return t*e*2/r.components*r.byteLength;case uL:return t*e*2/r.components*r.byteLength;case LH:return t*e*3/r.components*r.byteLength;case za:return t*e*4/r.components*r.byteLength;case hL:return t*e*4/r.components*r.byteLength;case u_:case h_:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case d_:case f_:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case yR:case bR:return Math.max(t,16)*Math.max(e,8)/4;case vR:case xR:return Math.max(t,8)*Math.max(e,8)/2;case wR:case _R:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case CR:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case SR:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case OR:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case MR:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case TR:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case RR:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case PR:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case ER:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case AR:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case IR:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case kR:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case DR:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case LR:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case FR:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case NR:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case p_:case BR:case zR:return Math.ceil(t/4)*Math.ceil(e/4)*16;case zH:case VR:return Math.ceil(t/4)*Math.ceil(e/4)*8;case GR:case UR:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}function xXe(t){switch(t){case Dh:case AH:return{byteLength:1,components:1};case z0:case IH:case mx:return{byteLength:2,components:1};case aL:case lL:return{byteLength:2,components:4};case Kd:case oL:case gl:return{byteLength:4,components:1};case kH:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}class bXe{static contain(e,i){return gXe(e,i)}static cover(e,i){return vXe(e,i)}static fill(e){return yXe(e)}static getByteLength(e,i,n,r){return DV(e,i,n,r)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:nL}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=nL);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function pse(){let t=null,e=!1,i=null,n=null;function r(s,o){i(s,o),n=t.requestAnimationFrame(r)}return{start:function(){e!==!0&&i!==null&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){i=s},setContext:function(s){t=s}}}function wXe(t){const e=new WeakMap;function i(a,l){const u=a.array,d=a.usage,p=u.byteLength,v=t.createBuffer();t.bindBuffer(l,v),t.bufferData(l,u,d),a.onUploadCallback();let y;if(u instanceof Float32Array)y=t.FLOAT;else if(u instanceof Uint16Array)a.isFloat16BufferAttribute?y=t.HALF_FLOAT:y=t.UNSIGNED_SHORT;else if(u instanceof Int16Array)y=t.SHORT;else if(u instanceof Uint32Array)y=t.UNSIGNED_INT;else if(u instanceof Int32Array)y=t.INT;else if(u instanceof Int8Array)y=t.BYTE;else if(u instanceof Uint8Array)y=t.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)y=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:v,type:y,bytesPerElement:u.BYTES_PER_ELEMENT,version:a.version,size:p}}function n(a,l,u){const d=l.array,p=l.updateRanges;if(t.bindBuffer(u,a),p.length===0)t.bufferSubData(u,0,d);else{p.sort((y,w)=>y.start-w.start);let v=0;for(let y=1;y<p.length;y++){const w=p[v],R=p[y];R.start<=w.start+w.count+1?w.count=Math.max(w.count,R.start+R.count-w.start):(++v,p[v]=R)}p.length=v+1;for(let y=0,w=p.length;y<w;y++){const R=p[y];t.bufferSubData(u,R.start*d.BYTES_PER_ELEMENT,d,R.start,R.count)}l.clearUpdateRanges()}l.onUploadCallback()}function r(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(t.deleteBuffer(l.buffer),e.delete(a))}function o(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const d=e.get(a);(!d||d.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const u=e.get(a);if(u===void 0)e.set(a,i(a,l));else if(u.version<a.version){if(u.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(u.buffer,a,l),u.version=a.version}}return{get:r,remove:s,update:o}}var _Xe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,CXe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,SXe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,OXe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,MXe=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,TXe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,RXe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,PXe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,EXe=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,AXe=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,IXe=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,kXe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,DXe=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,LXe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,FXe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,NXe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,BXe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,zXe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,VXe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,GXe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,UXe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,HXe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,$Xe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,WXe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,qXe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,jXe=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,QXe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,ZXe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,XXe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,KXe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,YXe="gl_FragColor = linearToOutputTexel( gl_FragColor );",JXe=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,eKe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,tKe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,iKe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,nKe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,rKe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,sKe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,oKe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,aKe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,lKe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,cKe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,uKe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,hKe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,dKe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,fKe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,pKe=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,mKe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,gKe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,vKe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,yKe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,xKe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,bKe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,wKe=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,_Ke=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,CKe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,SKe=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,OKe=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,MKe=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,TKe=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,RKe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,PKe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,EKe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,AKe=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,IKe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,kKe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,DKe=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,LKe=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,FKe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,NKe=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,BKe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,zKe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,VKe=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,GKe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,UKe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,HKe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,$Ke=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,WKe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,qKe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,jKe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,QKe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,ZKe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,XKe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,KKe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,YKe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,JKe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,eYe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,tYe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,iYe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,nYe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,rYe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,sYe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,oYe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,aYe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,lYe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,cYe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,uYe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,hYe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,dYe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,fYe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,pYe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,mYe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,gYe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,vYe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,yYe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,xYe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,bYe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const wYe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,_Ye=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,CYe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,SYe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,OYe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,MYe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,TYe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,RYe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,PYe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,EYe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,AYe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,IYe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,kYe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,DYe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,LYe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,FYe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,NYe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,BYe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zYe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,VYe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,GYe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,UYe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,HYe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$Ye=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,WYe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,qYe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,jYe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,QYe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ZYe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,XYe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,KYe=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,YYe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,JYe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,eJe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,mn={alphahash_fragment:_Xe,alphahash_pars_fragment:CXe,alphamap_fragment:SXe,alphamap_pars_fragment:OXe,alphatest_fragment:MXe,alphatest_pars_fragment:TXe,aomap_fragment:RXe,aomap_pars_fragment:PXe,batching_pars_vertex:EXe,batching_vertex:AXe,begin_vertex:IXe,beginnormal_vertex:kXe,bsdfs:DXe,iridescence_fragment:LXe,bumpmap_pars_fragment:FXe,clipping_planes_fragment:NXe,clipping_planes_pars_fragment:BXe,clipping_planes_pars_vertex:zXe,clipping_planes_vertex:VXe,color_fragment:GXe,color_pars_fragment:UXe,color_pars_vertex:HXe,color_vertex:$Xe,common:WXe,cube_uv_reflection_fragment:qXe,defaultnormal_vertex:jXe,displacementmap_pars_vertex:QXe,displacementmap_vertex:ZXe,emissivemap_fragment:XXe,emissivemap_pars_fragment:KXe,colorspace_fragment:YXe,colorspace_pars_fragment:JXe,envmap_fragment:eKe,envmap_common_pars_fragment:tKe,envmap_pars_fragment:iKe,envmap_pars_vertex:nKe,envmap_physical_pars_fragment:pKe,envmap_vertex:rKe,fog_vertex:sKe,fog_pars_vertex:oKe,fog_fragment:aKe,fog_pars_fragment:lKe,gradientmap_pars_fragment:cKe,lightmap_pars_fragment:uKe,lights_lambert_fragment:hKe,lights_lambert_pars_fragment:dKe,lights_pars_begin:fKe,lights_toon_fragment:mKe,lights_toon_pars_fragment:gKe,lights_phong_fragment:vKe,lights_phong_pars_fragment:yKe,lights_physical_fragment:xKe,lights_physical_pars_fragment:bKe,lights_fragment_begin:wKe,lights_fragment_maps:_Ke,lights_fragment_end:CKe,logdepthbuf_fragment:SKe,logdepthbuf_pars_fragment:OKe,logdepthbuf_pars_vertex:MKe,logdepthbuf_vertex:TKe,map_fragment:RKe,map_pars_fragment:PKe,map_particle_fragment:EKe,map_particle_pars_fragment:AKe,metalnessmap_fragment:IKe,metalnessmap_pars_fragment:kKe,morphinstance_vertex:DKe,morphcolor_vertex:LKe,morphnormal_vertex:FKe,morphtarget_pars_vertex:NKe,morphtarget_vertex:BKe,normal_fragment_begin:zKe,normal_fragment_maps:VKe,normal_pars_fragment:GKe,normal_pars_vertex:UKe,normal_vertex:HKe,normalmap_pars_fragment:$Ke,clearcoat_normal_fragment_begin:WKe,clearcoat_normal_fragment_maps:qKe,clearcoat_pars_fragment:jKe,iridescence_pars_fragment:QKe,opaque_fragment:ZKe,packing:XKe,premultiplied_alpha_fragment:KKe,project_vertex:YKe,dithering_fragment:JKe,dithering_pars_fragment:eYe,roughnessmap_fragment:tYe,roughnessmap_pars_fragment:iYe,shadowmap_pars_fragment:nYe,shadowmap_pars_vertex:rYe,shadowmap_vertex:sYe,shadowmask_pars_fragment:oYe,skinbase_vertex:aYe,skinning_pars_vertex:lYe,skinning_vertex:cYe,skinnormal_vertex:uYe,specularmap_fragment:hYe,specularmap_pars_fragment:dYe,tonemapping_fragment:fYe,tonemapping_pars_fragment:pYe,transmission_fragment:mYe,transmission_pars_fragment:gYe,uv_pars_fragment:vYe,uv_pars_vertex:yYe,uv_vertex:xYe,worldpos_vertex:bYe,background_vert:wYe,background_frag:_Ye,backgroundCube_vert:CYe,backgroundCube_frag:SYe,cube_vert:OYe,cube_frag:MYe,depth_vert:TYe,depth_frag:RYe,distanceRGBA_vert:PYe,distanceRGBA_frag:EYe,equirect_vert:AYe,equirect_frag:IYe,linedashed_vert:kYe,linedashed_frag:DYe,meshbasic_vert:LYe,meshbasic_frag:FYe,meshlambert_vert:NYe,meshlambert_frag:BYe,meshmatcap_vert:zYe,meshmatcap_frag:VYe,meshnormal_vert:GYe,meshnormal_frag:UYe,meshphong_vert:HYe,meshphong_frag:$Ye,meshphysical_vert:WYe,meshphysical_frag:qYe,meshtoon_vert:jYe,meshtoon_frag:QYe,points_vert:ZYe,points_frag:XYe,shadow_vert:KYe,shadow_frag:YYe,sprite_vert:JYe,sprite_frag:eJe},mi={common:{diffuse:{value:new Si(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new wn},alphaMap:{value:null},alphaMapTransform:{value:new wn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new wn}},envmap:{envMap:{value:null},envMapRotation:{value:new wn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new wn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new wn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new wn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new wn},normalScale:{value:new Xt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new wn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new wn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new wn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new wn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Si(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Si(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new wn},alphaTest:{value:0},uvTransform:{value:new wn}},sprite:{diffuse:{value:new Si(16777215)},opacity:{value:1},center:{value:new Xt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new wn},alphaMap:{value:null},alphaMapTransform:{value:new wn},alphaTest:{value:0}}},ca={basic:{uniforms:Pa([mi.common,mi.specularmap,mi.envmap,mi.aomap,mi.lightmap,mi.fog]),vertexShader:mn.meshbasic_vert,fragmentShader:mn.meshbasic_frag},lambert:{uniforms:Pa([mi.common,mi.specularmap,mi.envmap,mi.aomap,mi.lightmap,mi.emissivemap,mi.bumpmap,mi.normalmap,mi.displacementmap,mi.fog,mi.lights,{emissive:{value:new Si(0)}}]),vertexShader:mn.meshlambert_vert,fragmentShader:mn.meshlambert_frag},phong:{uniforms:Pa([mi.common,mi.specularmap,mi.envmap,mi.aomap,mi.lightmap,mi.emissivemap,mi.bumpmap,mi.normalmap,mi.displacementmap,mi.fog,mi.lights,{emissive:{value:new Si(0)},specular:{value:new Si(1118481)},shininess:{value:30}}]),vertexShader:mn.meshphong_vert,fragmentShader:mn.meshphong_frag},standard:{uniforms:Pa([mi.common,mi.envmap,mi.aomap,mi.lightmap,mi.emissivemap,mi.bumpmap,mi.normalmap,mi.displacementmap,mi.roughnessmap,mi.metalnessmap,mi.fog,mi.lights,{emissive:{value:new Si(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:mn.meshphysical_vert,fragmentShader:mn.meshphysical_frag},toon:{uniforms:Pa([mi.common,mi.aomap,mi.lightmap,mi.emissivemap,mi.bumpmap,mi.normalmap,mi.displacementmap,mi.gradientmap,mi.fog,mi.lights,{emissive:{value:new Si(0)}}]),vertexShader:mn.meshtoon_vert,fragmentShader:mn.meshtoon_frag},matcap:{uniforms:Pa([mi.common,mi.bumpmap,mi.normalmap,mi.displacementmap,mi.fog,{matcap:{value:null}}]),vertexShader:mn.meshmatcap_vert,fragmentShader:mn.meshmatcap_frag},points:{uniforms:Pa([mi.points,mi.fog]),vertexShader:mn.points_vert,fragmentShader:mn.points_frag},dashed:{uniforms:Pa([mi.common,mi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:mn.linedashed_vert,fragmentShader:mn.linedashed_frag},depth:{uniforms:Pa([mi.common,mi.displacementmap]),vertexShader:mn.depth_vert,fragmentShader:mn.depth_frag},normal:{uniforms:Pa([mi.common,mi.bumpmap,mi.normalmap,mi.displacementmap,{opacity:{value:1}}]),vertexShader:mn.meshnormal_vert,fragmentShader:mn.meshnormal_frag},sprite:{uniforms:Pa([mi.sprite,mi.fog]),vertexShader:mn.sprite_vert,fragmentShader:mn.sprite_frag},background:{uniforms:{uvTransform:{value:new wn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:mn.background_vert,fragmentShader:mn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new wn}},vertexShader:mn.backgroundCube_vert,fragmentShader:mn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:mn.cube_vert,fragmentShader:mn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:mn.equirect_vert,fragmentShader:mn.equirect_frag},distanceRGBA:{uniforms:Pa([mi.common,mi.displacementmap,{referencePosition:{value:new Ie},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:mn.distanceRGBA_vert,fragmentShader:mn.distanceRGBA_frag},shadow:{uniforms:Pa([mi.lights,mi.fog,{color:{value:new Si(0)},opacity:{value:1}}]),vertexShader:mn.shadow_vert,fragmentShader:mn.shadow_frag}};ca.physical={uniforms:Pa([ca.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new wn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new wn},clearcoatNormalScale:{value:new Xt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new wn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new wn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new wn},sheen:{value:0},sheenColor:{value:new Si(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new wn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new wn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new wn},transmissionSamplerSize:{value:new Xt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new wn},attenuationDistance:{value:0},attenuationColor:{value:new Si(0)},specularColor:{value:new Si(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new wn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new wn},anisotropyVector:{value:new Xt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new wn}}]),vertexShader:mn.meshphysical_vert,fragmentShader:mn.meshphysical_frag};const JO={r:0,b:0,g:0},km=new sc,tJe=new sn;function iJe(t,e,i,n,r,s,o){const a=new Si(0);let l=s===!0?0:1,u,d,p=null,v=0,y=null;function w(F){let k=F.isScene===!0?F.background:null;return k&&k.isTexture&&(k=(F.backgroundBlurriness>0?i:e).get(k)),k}function R(F){let k=!1;const $=w(F);$===null?P(a,l):$&&$.isColor&&(P($,1),k=!0);const W=t.xr.getEnvironmentBlendMode();W==="additive"?n.buffers.color.setClear(0,0,0,1,o):W==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(t.autoClear||k)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function O(F,k){const $=w(k);$&&($.isCubeTexture||$.mapping===px)?(d===void 0&&(d=new us(new Hp(1,1,1),new Qc({name:"BackgroundCubeMaterial",uniforms:q0(ca.backgroundCube.uniforms),vertexShader:ca.backgroundCube.vertexShader,fragmentShader:ca.backgroundCube.fragmentShader,side:Ha,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(W,Q,Y){this.matrixWorld.copyPosition(Y.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(d)),km.copy(k.backgroundRotation),km.x*=-1,km.y*=-1,km.z*=-1,$.isCubeTexture&&$.isRenderTargetTexture===!1&&(km.y*=-1,km.z*=-1),d.material.uniforms.envMap.value=$,d.material.uniforms.flipEnvMap.value=$.isCubeTexture&&$.isRenderTargetTexture===!1?-1:1,d.material.uniforms.backgroundBlurriness.value=k.backgroundBlurriness,d.material.uniforms.backgroundIntensity.value=k.backgroundIntensity,d.material.uniforms.backgroundRotation.value.setFromMatrix4(tJe.makeRotationFromEuler(km)),d.material.toneMapped=Xn.getTransfer($.colorSpace)!==Or,(p!==$||v!==$.version||y!==t.toneMapping)&&(d.material.needsUpdate=!0,p=$,v=$.version,y=t.toneMapping),d.layers.enableAll(),F.unshift(d,d.geometry,d.material,0,0,null)):$&&$.isTexture&&(u===void 0&&(u=new us(new vx(2,2),new Qc({name:"BackgroundMaterial",uniforms:q0(ca.background.uniforms),vertexShader:ca.background.vertexShader,fragmentShader:ca.background.fragmentShader,side:kh,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(u)),u.material.uniforms.t2D.value=$,u.material.uniforms.backgroundIntensity.value=k.backgroundIntensity,u.material.toneMapped=Xn.getTransfer($.colorSpace)!==Or,$.matrixAutoUpdate===!0&&$.updateMatrix(),u.material.uniforms.uvTransform.value.copy($.matrix),(p!==$||v!==$.version||y!==t.toneMapping)&&(u.material.needsUpdate=!0,p=$,v=$.version,y=t.toneMapping),u.layers.enableAll(),F.unshift(u,u.geometry,u.material,0,0,null))}function P(F,k){F.getRGB(JO,Cre(t)),n.buffers.color.setClear(JO.r,JO.g,JO.b,k,o)}function N(){d!==void 0&&(d.geometry.dispose(),d.material.dispose(),d=void 0),u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0)}return{getClearColor:function(){return a},setClearColor:function(F,k=1){a.set(F),l=k,P(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(F){l=F,P(a,l)},render:R,addToRenderList:O,dispose:N}}function nJe(t,e){const i=t.getParameter(t.MAX_VERTEX_ATTRIBS),n={},r=v(null);let s=r,o=!1;function a(D,G,j,Z,ie){let le=!1;const me=p(Z,j,G);s!==me&&(s=me,u(s.object)),le=y(D,Z,j,ie),le&&w(D,Z,j,ie),ie!==null&&e.update(ie,t.ELEMENT_ARRAY_BUFFER),(le||o)&&(o=!1,k(D,G,j,Z),ie!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(ie).buffer))}function l(){return t.createVertexArray()}function u(D){return t.bindVertexArray(D)}function d(D){return t.deleteVertexArray(D)}function p(D,G,j){const Z=j.wireframe===!0;let ie=n[D.id];ie===void 0&&(ie={},n[D.id]=ie);let le=ie[G.id];le===void 0&&(le={},ie[G.id]=le);let me=le[Z];return me===void 0&&(me=v(l()),le[Z]=me),me}function v(D){const G=[],j=[],Z=[];for(let ie=0;ie<i;ie++)G[ie]=0,j[ie]=0,Z[ie]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:G,enabledAttributes:j,attributeDivisors:Z,object:D,attributes:{},index:null}}function y(D,G,j,Z){const ie=s.attributes,le=G.attributes;let me=0;const be=j.getAttributes();for(const fe in be)if(be[fe].location>=0){const He=ie[fe];let je=le[fe];if(je===void 0&&(fe==="instanceMatrix"&&D.instanceMatrix&&(je=D.instanceMatrix),fe==="instanceColor"&&D.instanceColor&&(je=D.instanceColor)),He===void 0||He.attribute!==je||je&&He.data!==je.data)return!0;me++}return s.attributesNum!==me||s.index!==Z}function w(D,G,j,Z){const ie={},le=G.attributes;let me=0;const be=j.getAttributes();for(const fe in be)if(be[fe].location>=0){let He=le[fe];He===void 0&&(fe==="instanceMatrix"&&D.instanceMatrix&&(He=D.instanceMatrix),fe==="instanceColor"&&D.instanceColor&&(He=D.instanceColor));const je={};je.attribute=He,He&&He.data&&(je.data=He.data),ie[fe]=je,me++}s.attributes=ie,s.attributesNum=me,s.index=Z}function R(){const D=s.newAttributes;for(let G=0,j=D.length;G<j;G++)D[G]=0}function O(D){P(D,0)}function P(D,G){const j=s.newAttributes,Z=s.enabledAttributes,ie=s.attributeDivisors;j[D]=1,Z[D]===0&&(t.enableVertexAttribArray(D),Z[D]=1),ie[D]!==G&&(t.vertexAttribDivisor(D,G),ie[D]=G)}function N(){const D=s.newAttributes,G=s.enabledAttributes;for(let j=0,Z=G.length;j<Z;j++)G[j]!==D[j]&&(t.disableVertexAttribArray(j),G[j]=0)}function F(D,G,j,Z,ie,le,me){me===!0?t.vertexAttribIPointer(D,G,j,ie,le):t.vertexAttribPointer(D,G,j,Z,ie,le)}function k(D,G,j,Z){R();const ie=Z.attributes,le=j.getAttributes(),me=G.defaultAttributeValues;for(const be in le){const fe=le[be];if(fe.location>=0){let Fe=ie[be];if(Fe===void 0&&(be==="instanceMatrix"&&D.instanceMatrix&&(Fe=D.instanceMatrix),be==="instanceColor"&&D.instanceColor&&(Fe=D.instanceColor)),Fe!==void 0){const He=Fe.normalized,je=Fe.itemSize,qe=e.get(Fe);if(qe===void 0)continue;const ct=qe.buffer,Ge=qe.type,Je=qe.bytesPerElement,mt=Ge===t.INT||Ge===t.UNSIGNED_INT||Fe.gpuType===oL;if(Fe.isInterleavedBufferAttribute){const wt=Fe.data,Ot=wt.stride,Qt=Fe.offset;if(wt.isInstancedInterleavedBuffer){for(let ei=0;ei<fe.locationSize;ei++)P(fe.location+ei,wt.meshPerAttribute);D.isInstancedMesh!==!0&&Z._maxInstanceCount===void 0&&(Z._maxInstanceCount=wt.meshPerAttribute*wt.count)}else for(let ei=0;ei<fe.locationSize;ei++)O(fe.location+ei);t.bindBuffer(t.ARRAY_BUFFER,ct);for(let ei=0;ei<fe.locationSize;ei++)F(fe.location+ei,je/fe.locationSize,Ge,He,Ot*Je,(Qt+je/fe.locationSize*ei)*Je,mt)}else{if(Fe.isInstancedBufferAttribute){for(let wt=0;wt<fe.locationSize;wt++)P(fe.location+wt,Fe.meshPerAttribute);D.isInstancedMesh!==!0&&Z._maxInstanceCount===void 0&&(Z._maxInstanceCount=Fe.meshPerAttribute*Fe.count)}else for(let wt=0;wt<fe.locationSize;wt++)O(fe.location+wt);t.bindBuffer(t.ARRAY_BUFFER,ct);for(let wt=0;wt<fe.locationSize;wt++)F(fe.location+wt,je/fe.locationSize,Ge,He,je*Je,je/fe.locationSize*wt*Je,mt)}}else if(me!==void 0){const He=me[be];if(He!==void 0)switch(He.length){case 2:t.vertexAttrib2fv(fe.location,He);break;case 3:t.vertexAttrib3fv(fe.location,He);break;case 4:t.vertexAttrib4fv(fe.location,He);break;default:t.vertexAttrib1fv(fe.location,He)}}}}N()}function $(){Y();for(const D in n){const G=n[D];for(const j in G){const Z=G[j];for(const ie in Z)d(Z[ie].object),delete Z[ie];delete G[j]}delete n[D]}}function W(D){if(n[D.id]===void 0)return;const G=n[D.id];for(const j in G){const Z=G[j];for(const ie in Z)d(Z[ie].object),delete Z[ie];delete G[j]}delete n[D.id]}function Q(D){for(const G in n){const j=n[G];if(j[D.id]===void 0)continue;const Z=j[D.id];for(const ie in Z)d(Z[ie].object),delete Z[ie];delete j[D.id]}}function Y(){M(),o=!0,s!==r&&(s=r,u(s.object))}function M(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:a,reset:Y,resetDefaultState:M,dispose:$,releaseStatesOfGeometry:W,releaseStatesOfProgram:Q,initAttributes:R,enableAttribute:O,disableUnusedAttributes:N}}function rJe(t,e,i){let n;function r(u){n=u}function s(u,d){t.drawArrays(n,u,d),i.update(d,n,1)}function o(u,d,p){p!==0&&(t.drawArraysInstanced(n,u,d,p),i.update(d,n,p))}function a(u,d,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,u,0,d,0,p);let y=0;for(let w=0;w<p;w++)y+=d[w];i.update(y,n,1)}function l(u,d,p,v){if(p===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let w=0;w<u.length;w++)o(u[w],d[w],v[w]);else{y.multiDrawArraysInstancedWEBGL(n,u,0,d,0,v,0,p);let w=0;for(let R=0;R<p;R++)w+=d[R]*v[R];i.update(w,n,1)}}this.setMode=r,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function sJe(t,e,i,n){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const Q=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(Q.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(Q){return!(Q!==za&&n.convert(Q)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(Q){const Y=Q===mx&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(Q!==Dh&&n.convert(Q)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&Q!==gl&&!Y)}function l(Q){if(Q==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";Q="mediump"}return Q==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=i.precision!==void 0?i.precision:"highp";const d=l(u);d!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",d,"instead."),u=d);const p=i.logarithmicDepthBuffer===!0,v=i.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),y=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),w=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),R=t.getParameter(t.MAX_TEXTURE_SIZE),O=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),P=t.getParameter(t.MAX_VERTEX_ATTRIBS),N=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),F=t.getParameter(t.MAX_VARYING_VECTORS),k=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),$=w>0,W=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:o,textureTypeReadable:a,precision:u,logarithmicDepthBuffer:p,reverseDepthBuffer:v,maxTextures:y,maxVertexTextures:w,maxTextureSize:R,maxCubemapSize:O,maxAttributes:P,maxVertexUniforms:N,maxVaryings:F,maxFragmentUniforms:k,vertexTextures:$,maxSamples:W}}function oJe(t){const e=this;let i=null,n=0,r=!1,s=!1;const o=new ep,a=new wn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(p,v){const y=p.length!==0||v||n!==0||r;return r=v,n=p.length,y},this.beginShadows=function(){s=!0,d(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(p,v){i=d(p,v,0)},this.setState=function(p,v,y){const w=p.clippingPlanes,R=p.clipIntersection,O=p.clipShadows,P=t.get(p);if(!r||w===null||w.length===0||s&&!O)s?d(null):u();else{const N=s?0:n,F=N*4;let k=P.clippingState||null;l.value=k,k=d(w,v,F,y);for(let $=0;$!==F;++$)k[$]=i[$];P.clippingState=k,this.numIntersection=R?this.numPlanes:0,this.numPlanes+=N}};function u(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function d(p,v,y,w){const R=p!==null?p.length:0;let O=null;if(R!==0){if(O=l.value,w!==!0||O===null){const P=y+R*4,N=v.matrixWorldInverse;a.getNormalMatrix(N),(O===null||O.length<P)&&(O=new Float32Array(P));for(let F=0,k=y;F!==R;++F,k+=4)o.copy(p[F]).applyMatrix4(N,a),o.normal.toArray(O,k),O[k+3]=o.constant}l.value=O,l.needsUpdate=!0}return e.numPlanes=R,e.numIntersection=0,O}}function aJe(t){let e=new WeakMap;function i(o,a){return a===oC?o.mapping=Xd:a===aC&&(o.mapping=Ep),o}function n(o){if(o&&o.isTexture){const a=o.mapping;if(a===oC||a===aC)if(e.has(o)){const l=e.get(o).texture;return i(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const u=new Ore(l.height);return u.fromEquirectangularTexture(t,o),e.set(o,u),o.addEventListener("dispose",r),i(u.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}const Wy=4,X9=[.125,.215,.35,.446,.526,.582],Zm=20,NB=new bx,K9=new Si;let BB=null,zB=0,VB=0,GB=!1;const Um=(1+Math.sqrt(5))/2,Ry=1/Um,Y9=[new Ie(-Um,Ry,0),new Ie(Um,Ry,0),new Ie(-Ry,0,Um),new Ie(Ry,0,Um),new Ie(0,Um,-Ry),new Ie(0,Um,Ry),new Ie(-1,1,-1),new Ie(1,1,-1),new Ie(-1,1,1),new Ie(1,1,1)],lJe=new Ie;class LV{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,i=0,n=.1,r=100,s={}){const{size:o=256,position:a=lJe}=s;BB=this._renderer.getRenderTarget(),zB=this._renderer.getActiveCubeFace(),VB=this._renderer.getActiveMipmapLevel(),GB=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,n,r,l,a),i>0&&this._blur(l,0,0,i),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=tQ(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=eQ(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(BB,zB,VB),this._renderer.xr.enabled=GB,e.scissorTest=!1,eM(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===Xd||e.mapping===Ep?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),BB=this._renderer.getRenderTarget(),zB=this._renderer.getActiveCubeFace(),VB=this._renderer.getActiveMipmapLevel(),GB=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=i||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,n={magFilter:Ps,minFilter:Ps,generateMipmaps:!1,type:mx,format:za,colorSpace:ma,depthBuffer:!1},r=J9(e,i,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=J9(e,i,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=cJe(s)),this._blurMaterial=uJe(s,e,i)}return r}_compileMaterial(e){const i=new us(this._lodPlanes[0],e);this._renderer.compile(i,NB)}_sceneToCubeUV(e,i,n,r,s){const l=new ho(90,1,i,n),u=[1,-1,1,1,1,1],d=[1,1,1,-1,-1,-1],p=this._renderer,v=p.autoClear,y=p.toneMapping;p.getClearColor(K9),p.toneMapping=Fd,p.autoClear=!1;const w=new vl({name:"PMREM.Background",side:Ha,depthWrite:!1,depthTest:!1}),R=new us(new Hp,w);let O=!1;const P=e.background;P?P.isColor&&(w.color.copy(P),e.background=null,O=!0):(w.color.copy(K9),O=!0);for(let N=0;N<6;N++){const F=N%3;F===0?(l.up.set(0,u[N],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x+d[N],s.y,s.z)):F===1?(l.up.set(0,0,u[N]),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y+d[N],s.z)):(l.up.set(0,u[N],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y,s.z+d[N]));const k=this._cubeSize;eM(r,F*k,N>2?k:0,k,k),p.setRenderTarget(r),O&&p.render(R,l),p.render(e,l)}R.geometry.dispose(),R.material.dispose(),p.toneMapping=y,p.autoClear=v,e.background=P}_textureToCubeUV(e,i){const n=this._renderer,r=e.mapping===Xd||e.mapping===Ep;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=tQ()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=eQ());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new us(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;eM(i,0,0,3*l,2*l),n.setRenderTarget(i),n.render(o,NB)}_applyPMREM(e){const i=this._renderer,n=i.autoClear;i.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=Y9[(r-s-1)%Y9.length];this._blur(e,s-1,s,o,a)}i.autoClear=n}_blur(e,i,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,i,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,i,n,r,s,o,a){const l=this._renderer,u=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const d=3,p=new us(this._lodPlanes[r],u),v=u.uniforms,y=this._sizeLods[n]-1,w=isFinite(s)?Math.PI/(2*y):2*Math.PI/(2*Zm-1),R=s/w,O=isFinite(s)?1+Math.floor(d*R):Zm;O>Zm&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${O} samples when the maximum is set to ${Zm}`);const P=[];let N=0;for(let Q=0;Q<Zm;++Q){const Y=Q/R,M=Math.exp(-Y*Y/2);P.push(M),Q===0?N+=M:Q<O&&(N+=2*M)}for(let Q=0;Q<P.length;Q++)P[Q]=P[Q]/N;v.envMap.value=e.texture,v.samples.value=O,v.weights.value=P,v.latitudinal.value=o==="latitudinal",a&&(v.poleAxis.value=a);const{_lodMax:F}=this;v.dTheta.value=w,v.mipInt.value=F-n;const k=this._sizeLods[r],$=3*k*(r>F-Wy?r-F+Wy:0),W=4*(this._cubeSize-k);eM(i,$,W,3*k,2*k),l.setRenderTarget(i),l.render(p,NB)}}function cJe(t){const e=[],i=[],n=[];let r=t;const s=t-Wy+1+X9.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);i.push(a);let l=1/a;o>t-Wy?l=X9[o-t+Wy-1]:o===0&&(l=0),n.push(l);const u=1/(a-2),d=-u,p=1+u,v=[d,d,p,d,p,p,d,d,p,p,d,p],y=6,w=6,R=3,O=2,P=1,N=new Float32Array(R*w*y),F=new Float32Array(O*w*y),k=new Float32Array(P*w*y);for(let W=0;W<y;W++){const Q=W%3*2/3-1,Y=W>2?0:-1,M=[Q,Y,0,Q+2/3,Y,0,Q+2/3,Y+1,0,Q,Y,0,Q+2/3,Y+1,0,Q,Y+1,0];N.set(M,R*w*W),F.set(v,O*w*W);const D=[W,W,W,W,W,W];k.set(D,P*w*W)}const $=new Rn;$.setAttribute("position",new xr(N,R)),$.setAttribute("uv",new xr(F,O)),$.setAttribute("faceIndex",new xr(k,P)),e.push($),r>Wy&&r--}return{lodPlanes:e,sizeLods:i,sigmas:n}}function J9(t,e,i){const n=new Lh(t,e,i);return n.texture.mapping=px,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function eM(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function uJe(t,e,i){const n=new Float32Array(Zm),r=new Ie(0,1,0);return new Qc({name:"SphericalGaussianBlur",defines:{n:Zm,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:C5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ld,depthTest:!1,depthWrite:!1})}function eQ(){return new Qc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:C5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ld,depthTest:!1,depthWrite:!1})}function tQ(){return new Qc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:C5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ld,depthTest:!1,depthWrite:!1})}function C5(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function hJe(t){let e=new WeakMap,i=null;function n(a){if(a&&a.isTexture){const l=a.mapping,u=l===oC||l===aC,d=l===Xd||l===Ep;if(u||d){let p=e.get(a);const v=p!==void 0?p.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==v)return i===null&&(i=new LV(t)),p=u?i.fromEquirectangular(a,p):i.fromCubemap(a,p),p.texture.pmremVersion=a.pmremVersion,e.set(a,p),p.texture;if(p!==void 0)return p.texture;{const y=a.image;return u&&y&&y.height>0||d&&y&&r(y)?(i===null&&(i=new LV(t)),p=u?i.fromEquirectangular(a):i.fromCubemap(a),p.texture.pmremVersion=a.pmremVersion,e.set(a,p),a.addEventListener("dispose",s),p.texture):null}}}return a}function r(a){let l=0;const u=6;for(let d=0;d<u;d++)a[d]!==void 0&&l++;return l===u}function s(a){const l=a.target;l.removeEventListener("dispose",s);const u=e.get(l);u!==void 0&&(e.delete(l),u.dispose())}function o(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:n,dispose:o}}function dJe(t){const e={};function i(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,r}return{has:function(n){return i(n)!==null},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(n){const r=i(n);return r===null&&zM("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function fJe(t,e,i,n){const r={},s=new WeakMap;function o(p){const v=p.target;v.index!==null&&e.remove(v.index);for(const w in v.attributes)e.remove(v.attributes[w]);v.removeEventListener("dispose",o),delete r[v.id];const y=s.get(v);y&&(e.remove(y),s.delete(v)),n.releaseStatesOfGeometry(v),v.isInstancedBufferGeometry===!0&&delete v._maxInstanceCount,i.memory.geometries--}function a(p,v){return r[v.id]===!0||(v.addEventListener("dispose",o),r[v.id]=!0,i.memory.geometries++),v}function l(p){const v=p.attributes;for(const y in v)e.update(v[y],t.ARRAY_BUFFER)}function u(p){const v=[],y=p.index,w=p.attributes.position;let R=0;if(y!==null){const N=y.array;R=y.version;for(let F=0,k=N.length;F<k;F+=3){const $=N[F+0],W=N[F+1],Q=N[F+2];v.push($,W,W,Q,Q,$)}}else if(w!==void 0){const N=w.array;R=w.version;for(let F=0,k=N.length/3-1;F<k;F+=3){const $=F+0,W=F+1,Q=F+2;v.push($,W,W,Q,Q,$)}}else return;const O=new(xre(v)?qH:WH)(v,1);O.version=R;const P=s.get(p);P&&e.remove(P),s.set(p,O)}function d(p){const v=s.get(p);if(v){const y=p.index;y!==null&&v.version<y.version&&u(p)}else u(p);return s.get(p)}return{get:a,update:l,getWireframeAttribute:d}}function pJe(t,e,i){let n;function r(v){n=v}let s,o;function a(v){s=v.type,o=v.bytesPerElement}function l(v,y){t.drawElements(n,y,s,v*o),i.update(y,n,1)}function u(v,y,w){w!==0&&(t.drawElementsInstanced(n,y,s,v*o,w),i.update(y,n,w))}function d(v,y,w){if(w===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,y,0,s,v,0,w);let O=0;for(let P=0;P<w;P++)O+=y[P];i.update(O,n,1)}function p(v,y,w,R){if(w===0)return;const O=e.get("WEBGL_multi_draw");if(O===null)for(let P=0;P<v.length;P++)u(v[P]/o,y[P],R[P]);else{O.multiDrawElementsInstancedWEBGL(n,y,0,s,v,0,R,0,w);let P=0;for(let N=0;N<w;N++)P+=y[N]*R[N];i.update(P,n,1)}}this.setMode=r,this.setIndex=a,this.render=l,this.renderInstances=u,this.renderMultiDraw=d,this.renderMultiDrawInstances=p}function mJe(t){const e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(i.calls++,o){case t.TRIANGLES:i.triangles+=a*(s/3);break;case t.LINES:i.lines+=a*(s/2);break;case t.LINE_STRIP:i.lines+=a*(s-1);break;case t.LINE_LOOP:i.lines+=a*s;break;case t.POINTS:i.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:r,update:n}}function gJe(t,e,i){const n=new WeakMap,r=new Mn;function s(o,a,l){const u=o.morphTargetInfluences,d=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,p=d!==void 0?d.length:0;let v=n.get(a);if(v===void 0||v.count!==p){let M=function(){Q.dispose(),n.delete(a),a.removeEventListener("dispose",M)};v!==void 0&&v.texture.dispose();const y=a.morphAttributes.position!==void 0,w=a.morphAttributes.normal!==void 0,R=a.morphAttributes.color!==void 0,O=a.morphAttributes.position||[],P=a.morphAttributes.normal||[],N=a.morphAttributes.color||[];let F=0;y===!0&&(F=1),w===!0&&(F=2),R===!0&&(F=3);let k=a.attributes.position.count*F,$=1;k>e.maxTextureSize&&($=Math.ceil(k/e.maxTextureSize),k=e.maxTextureSize);const W=new Float32Array(k*$*4*p),Q=new eS(W,k,$,p);Q.type=gl,Q.needsUpdate=!0;const Y=F*4;for(let D=0;D<p;D++){const G=O[D],j=P[D],Z=N[D],ie=k*$*4*D;for(let le=0;le<G.count;le++){const me=le*Y;y===!0&&(r.fromBufferAttribute(G,le),W[ie+me+0]=r.x,W[ie+me+1]=r.y,W[ie+me+2]=r.z,W[ie+me+3]=0),w===!0&&(r.fromBufferAttribute(j,le),W[ie+me+4]=r.x,W[ie+me+5]=r.y,W[ie+me+6]=r.z,W[ie+me+7]=0),R===!0&&(r.fromBufferAttribute(Z,le),W[ie+me+8]=r.x,W[ie+me+9]=r.y,W[ie+me+10]=r.z,W[ie+me+11]=Z.itemSize===4?r.w:1)}}v={count:p,texture:Q,size:new Xt(k,$)},n.set(a,v),a.addEventListener("dispose",M)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)l.getUniforms().setValue(t,"morphTexture",o.morphTexture,i);else{let y=0;for(let R=0;R<u.length;R++)y+=u[R];const w=a.morphTargetsRelative?1:1-y;l.getUniforms().setValue(t,"morphTargetBaseInfluence",w),l.getUniforms().setValue(t,"morphTargetInfluences",u)}l.getUniforms().setValue(t,"morphTargetsTexture",v.texture,i),l.getUniforms().setValue(t,"morphTargetsTextureSize",v.size)}return{update:s}}function vJe(t,e,i,n){let r=new WeakMap;function s(l){const u=n.render.frame,d=l.geometry,p=e.get(l,d);if(r.get(p)!==u&&(e.update(p),r.set(p,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==u&&(i.update(l.instanceMatrix,t.ARRAY_BUFFER),l.instanceColor!==null&&i.update(l.instanceColor,t.ARRAY_BUFFER),r.set(l,u))),l.isSkinnedMesh){const v=l.skeleton;r.get(v)!==u&&(v.update(),r.set(v,u))}return p}function o(){r=new WeakMap}function a(l){const u=l.target;u.removeEventListener("dispose",a),i.remove(u.instanceMatrix),u.instanceColor!==null&&i.remove(u.instanceColor)}return{update:s,dispose:o}}const mse=new ds,iQ=new YH(1,1),gse=new eS,vse=new pL,yse=new iS,nQ=[],rQ=[],sQ=new Float32Array(16),oQ=new Float32Array(9),aQ=new Float32Array(4);function wx(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let s=nQ[r];if(s===void 0&&(s=new Float32Array(r),nQ[r]=s),e!==0){n.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=i,t[o].toArray(s,a)}return s}function vo(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function yo(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function BL(t,e){let i=rQ[e];i===void 0&&(i=new Int32Array(e),rQ[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function yJe(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function xJe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(vo(i,e))return;t.uniform2fv(this.addr,e),yo(i,e)}}function bJe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(vo(i,e))return;t.uniform3fv(this.addr,e),yo(i,e)}}function wJe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(vo(i,e))return;t.uniform4fv(this.addr,e),yo(i,e)}}function _Je(t,e){const i=this.cache,n=e.elements;if(n===void 0){if(vo(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),yo(i,e)}else{if(vo(i,n))return;aQ.set(n),t.uniformMatrix2fv(this.addr,!1,aQ),yo(i,n)}}function CJe(t,e){const i=this.cache,n=e.elements;if(n===void 0){if(vo(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),yo(i,e)}else{if(vo(i,n))return;oQ.set(n),t.uniformMatrix3fv(this.addr,!1,oQ),yo(i,n)}}function SJe(t,e){const i=this.cache,n=e.elements;if(n===void 0){if(vo(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),yo(i,e)}else{if(vo(i,n))return;sQ.set(n),t.uniformMatrix4fv(this.addr,!1,sQ),yo(i,n)}}function OJe(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function MJe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(vo(i,e))return;t.uniform2iv(this.addr,e),yo(i,e)}}function TJe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(vo(i,e))return;t.uniform3iv(this.addr,e),yo(i,e)}}function RJe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(vo(i,e))return;t.uniform4iv(this.addr,e),yo(i,e)}}function PJe(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function EJe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(vo(i,e))return;t.uniform2uiv(this.addr,e),yo(i,e)}}function AJe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(vo(i,e))return;t.uniform3uiv(this.addr,e),yo(i,e)}}function IJe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(vo(i,e))return;t.uniform4uiv(this.addr,e),yo(i,e)}}function kJe(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r);let s;this.type===t.SAMPLER_2D_SHADOW?(iQ.compareFunction=UH,s=iQ):s=mse,i.setTexture2D(e||s,r)}function DJe(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||vse,r)}function LJe(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(e||yse,r)}function FJe(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||gse,r)}function NJe(t){switch(t){case 5126:return yJe;case 35664:return xJe;case 35665:return bJe;case 35666:return wJe;case 35674:return _Je;case 35675:return CJe;case 35676:return SJe;case 5124:case 35670:return OJe;case 35667:case 35671:return MJe;case 35668:case 35672:return TJe;case 35669:case 35673:return RJe;case 5125:return PJe;case 36294:return EJe;case 36295:return AJe;case 36296:return IJe;case 35678:case 36198:case 36298:case 36306:case 35682:return kJe;case 35679:case 36299:case 36307:return DJe;case 35680:case 36300:case 36308:case 36293:return LJe;case 36289:case 36303:case 36311:case 36292:return FJe}}function BJe(t,e){t.uniform1fv(this.addr,e)}function zJe(t,e){const i=wx(e,this.size,2);t.uniform2fv(this.addr,i)}function VJe(t,e){const i=wx(e,this.size,3);t.uniform3fv(this.addr,i)}function GJe(t,e){const i=wx(e,this.size,4);t.uniform4fv(this.addr,i)}function UJe(t,e){const i=wx(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function HJe(t,e){const i=wx(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function $Je(t,e){const i=wx(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function WJe(t,e){t.uniform1iv(this.addr,e)}function qJe(t,e){t.uniform2iv(this.addr,e)}function jJe(t,e){t.uniform3iv(this.addr,e)}function QJe(t,e){t.uniform4iv(this.addr,e)}function ZJe(t,e){t.uniform1uiv(this.addr,e)}function XJe(t,e){t.uniform2uiv(this.addr,e)}function KJe(t,e){t.uniform3uiv(this.addr,e)}function YJe(t,e){t.uniform4uiv(this.addr,e)}function JJe(t,e,i){const n=this.cache,r=e.length,s=BL(i,r);vo(n,s)||(t.uniform1iv(this.addr,s),yo(n,s));for(let o=0;o!==r;++o)i.setTexture2D(e[o]||mse,s[o])}function eet(t,e,i){const n=this.cache,r=e.length,s=BL(i,r);vo(n,s)||(t.uniform1iv(this.addr,s),yo(n,s));for(let o=0;o!==r;++o)i.setTexture3D(e[o]||vse,s[o])}function tet(t,e,i){const n=this.cache,r=e.length,s=BL(i,r);vo(n,s)||(t.uniform1iv(this.addr,s),yo(n,s));for(let o=0;o!==r;++o)i.setTextureCube(e[o]||yse,s[o])}function iet(t,e,i){const n=this.cache,r=e.length,s=BL(i,r);vo(n,s)||(t.uniform1iv(this.addr,s),yo(n,s));for(let o=0;o!==r;++o)i.setTexture2DArray(e[o]||gse,s[o])}function net(t){switch(t){case 5126:return BJe;case 35664:return zJe;case 35665:return VJe;case 35666:return GJe;case 35674:return UJe;case 35675:return HJe;case 35676:return $Je;case 5124:case 35670:return WJe;case 35667:case 35671:return qJe;case 35668:case 35672:return jJe;case 35669:case 35673:return QJe;case 5125:return ZJe;case 36294:return XJe;case 36295:return KJe;case 36296:return YJe;case 35678:case 36198:case 36298:case 36306:case 35682:return JJe;case 35679:case 36299:case 36307:return eet;case 35680:case 36300:case 36308:case 36293:return tet;case 36289:case 36303:case 36311:case 36292:return iet}}class ret{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.type=i.type,this.setValue=NJe(i.type)}}class set{constructor(e,i,n){this.id=e,this.addr=n,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=net(i.type)}}class oet{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,n){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,i[a.id],n)}}}const UB=/(\w+)(\])?(\[|\.)?/g;function lQ(t,e){t.seq.push(e),t.map[e.id]=e}function aet(t,e,i){const n=t.name,r=n.length;for(UB.lastIndex=0;;){const s=UB.exec(n),o=UB.lastIndex;let a=s[1];const l=s[2]==="]",u=s[3];if(l&&(a=a|0),u===void 0||u==="["&&o+2===r){lQ(i,u===void 0?new ret(a,t,e):new set(a,t,e));break}else{let p=i.map[a];p===void 0&&(p=new oet(a),lQ(i,p)),i=p}}}class GM{constructor(e,i){this.seq=[],this.map={};const n=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const s=e.getActiveUniform(i,r),o=e.getUniformLocation(i,s.name);aet(s,o,this)}}setValue(e,i,n,r){const s=this.map[i];s!==void 0&&s.setValue(e,n,r)}setOptional(e,i,n){const r=i[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,i,n,r){for(let s=0,o=i.length;s!==o;++s){const a=i[s],l=n[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,i){const n=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in i&&n.push(o)}return n}}function cQ(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}const cet=37297;let uet=0;function het(t,e){const i=t.split(`
`),n=[],r=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let o=r;o<s;o++){const a=o+1;n.push(`${a===e?">":" "} ${a}: ${i[o]}`)}return n.join(`
`)}const uQ=new wn;function det(t){Xn._getMatrix(uQ,Xn.workingColorSpace,t);const e=`mat3( ${uQ.elements.map(i=>i.toFixed(4))} )`;switch(Xn.getTransfer(t)){case cC:return[e,"LinearTransferOETF"];case Or:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}function hQ(t,e,i){const n=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(n&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return i.toUpperCase()+`

`+r+`

`+het(t.getShaderSource(e),o)}else return r}function fet(t,e){const i=det(e);return[`vec4 ${t}( vec4 value ) {`,`	return ${i[1]}( vec4( value.rgb * ${i[0]}, value.a ) );`,"}"].join(`
`)}function pet(t,e){let i;switch(e){case Kne:i="Linear";break;case Yne:i="Reinhard";break;case Jne:i="Cineon";break;case ere:i="ACESFilmic";break;case gR:i="AgX";break;case ire:i="Neutral";break;case tre:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const tM=new Ie;function met(){Xn.getLuminanceCoefficients(tM);const t=tM.x.toFixed(4),e=tM.y.toFixed(4),i=tM.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${i} );`,"	return dot( weights, rgb );","}"].join(`
`)}function get(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Iw).join(`
`)}function vet(t){const e=[];for(const i in t){const n=t[i];n!==!1&&e.push("#define "+i+" "+n)}return e.join(`
`)}function yet(t,e){const i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const s=t.getActiveAttrib(e,r),o=s.name;let a=1;s.type===t.FLOAT_MAT2&&(a=2),s.type===t.FLOAT_MAT3&&(a=3),s.type===t.FLOAT_MAT4&&(a=4),i[o]={type:s.type,location:t.getAttribLocation(e,o),locationSize:a}}return i}function Iw(t){return t!==""}function dQ(t,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function fQ(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const xet=/^[ \t]*#include +<([\w\d./]+)>/gm;function FV(t){return t.replace(xet,wet)}const bet=new Map;function wet(t,e){let i=mn[e];if(i===void 0){const n=bet.get(e);if(n!==void 0)i=mn[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return FV(i)}const _et=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function pQ(t){return t.replace(_et,Cet)}function Cet(t,e,i,n){let r="";for(let s=parseInt(e);s<parseInt(i);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function mQ(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Oet(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===EH?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===c_?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===th&&(e="SHADOWMAP_TYPE_VSM"),e}function Met(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Xd:case Ep:e="ENVMAP_TYPE_CUBE";break;case px:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Tet(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Ep:e="ENVMAP_MODE_REFRACTION";break}return e}function Ret(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case YC:e="ENVMAP_BLENDING_MULTIPLY";break;case Zne:e="ENVMAP_BLENDING_MIX";break;case Xne:e="ENVMAP_BLENDING_ADD";break}return e}function Pet(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:n,maxMip:i}}function Eet(t,e,i,n){const r=t.getContext(),s=i.defines;let o=i.vertexShader,a=i.fragmentShader;const l=Oet(i),u=Met(i),d=Tet(i),p=Ret(i),v=Pet(i),y=get(i),w=vet(s),R=r.createProgram();let O,P,N=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(O=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,w].filter(Iw).join(`
`),O.length>0&&(O+=`
`),P=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,w].filter(Iw).join(`
`),P.length>0&&(P+=`
`)):(O=[mQ(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,w,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Iw).join(`
`),P=[mQ(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,w,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.envMap?"#define "+d:"",i.envMap?"#define "+p:"",v?"#define CUBEUV_TEXEL_WIDTH "+v.texelWidth:"",v?"#define CUBEUV_TEXEL_HEIGHT "+v.texelHeight:"",v?"#define CUBEUV_MAX_MIP "+v.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Fd?"#define TONE_MAPPING":"",i.toneMapping!==Fd?mn.tonemapping_pars_fragment:"",i.toneMapping!==Fd?pet("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",mn.colorspace_pars_fragment,fet("linearToOutputTexel",i.outputColorSpace),met(),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Iw).join(`
`)),o=FV(o),o=dQ(o,i),o=fQ(o,i),a=FV(a),a=dQ(a,i),a=fQ(a,i),o=pQ(o),a=pQ(a),i.isRawShaderMaterial!==!0&&(N=`#version 300 es
`,O=[y,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+O,P=["#define varying in",i.glslVersion===RV?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===RV?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+P);const F=N+O+o,k=N+P+a,$=cQ(r,r.VERTEX_SHADER,F),W=cQ(r,r.FRAGMENT_SHADER,k);r.attachShader(R,$),r.attachShader(R,W),i.index0AttributeName!==void 0?r.bindAttribLocation(R,0,i.index0AttributeName):i.morphTargets===!0&&r.bindAttribLocation(R,0,"position"),r.linkProgram(R);function Q(G){if(t.debug.checkShaderErrors){const j=r.getProgramInfoLog(R).trim(),Z=r.getShaderInfoLog($).trim(),ie=r.getShaderInfoLog(W).trim();let le=!0,me=!0;if(r.getProgramParameter(R,r.LINK_STATUS)===!1)if(le=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(r,R,$,W);else{const be=hQ(r,$,"vertex"),fe=hQ(r,W,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(R,r.VALIDATE_STATUS)+`

Material Name: `+G.name+`
Material Type: `+G.type+`

Program Info Log: `+j+`
`+be+`
`+fe)}else j!==""?console.warn("THREE.WebGLProgram: Program Info Log:",j):(Z===""||ie==="")&&(me=!1);me&&(G.diagnostics={runnable:le,programLog:j,vertexShader:{log:Z,prefix:O},fragmentShader:{log:ie,prefix:P}})}r.deleteShader($),r.deleteShader(W),Y=new GM(r,R),M=yet(r,R)}let Y;this.getUniforms=function(){return Y===void 0&&Q(this),Y};let M;this.getAttributes=function(){return M===void 0&&Q(this),M};let D=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return D===!1&&(D=r.getProgramParameter(R,cet)),D},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(R),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=uet++,this.cacheKey=e,this.usedTimes=1,this.program=R,this.vertexShader=$,this.fragmentShader=W,this}let Aet=0;class Iet{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(i),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const i=this.materialCache.get(e);for(const n of i)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const i=this.materialCache;let n=i.get(e);return n===void 0&&(n=new Set,i.set(e,n)),n}_getShaderStage(e){const i=this.shaderCache;let n=i.get(e);return n===void 0&&(n=new ket(e),i.set(e,n)),n}}class ket{constructor(e){this.id=Aet++,this.code=e,this.usedTimes=0}}function Det(t,e,i,n,r,s,o){const a=new mL,l=new Iet,u=new Set,d=[],p=r.logarithmicDepthBuffer,v=r.vertexTextures;let y=r.precision;const w={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function R(M){return u.add(M),M===0?"uv":`uv${M}`}function O(M,D,G,j,Z){const ie=j.fog,le=Z.geometry,me=M.isMeshStandardMaterial?j.environment:null,be=(M.isMeshStandardMaterial?i:e).get(M.envMap||me),fe=be&&be.mapping===px?be.image.height:null,Fe=w[M.type];M.precision!==null&&(y=r.getMaxPrecision(M.precision),y!==M.precision&&console.warn("THREE.WebGLProgram.getParameters:",M.precision,"not supported, using",y,"instead."));const He=le.morphAttributes.position||le.morphAttributes.normal||le.morphAttributes.color,je=He!==void 0?He.length:0;let qe=0;le.morphAttributes.position!==void 0&&(qe=1),le.morphAttributes.normal!==void 0&&(qe=2),le.morphAttributes.color!==void 0&&(qe=3);let ct,Ge,Je,mt;if(Fe){const zt=ca[Fe];ct=zt.vertexShader,Ge=zt.fragmentShader}else ct=M.vertexShader,Ge=M.fragmentShader,l.update(M),Je=l.getVertexShaderID(M),mt=l.getFragmentShaderID(M);const wt=t.getRenderTarget(),Ot=t.state.buffers.depth.getReversed(),Qt=Z.isInstancedMesh===!0,ei=Z.isBatchedMesh===!0,Jt=!!M.map,Yt=!!M.matcap,Ut=!!be,Re=!!M.aoMap,gi=!!M.lightMap,it=!!M.bumpMap,Pe=!!M.normalMap,Ye=!!M.displacementMap,Ct=!!M.emissiveMap,st=!!M.metalnessMap,we=!!M.roughnessMap,he=M.anisotropy>0,xe=M.clearcoat>0,Be=M.dispersion>0,$e=M.iridescence>0,Ze=M.sheen>0,Lt=M.transmission>0,ot=he&&!!M.anisotropyMap,Nt=xe&&!!M.clearcoatMap,fi=xe&&!!M.clearcoatNormalMap,Pt=xe&&!!M.clearcoatRoughnessMap,ni=$e&&!!M.iridescenceMap,ti=$e&&!!M.iridescenceThicknessMap,nt=Ze&&!!M.sheenColorMap,Ce=Ze&&!!M.sheenRoughnessMap,oe=!!M.specularMap,re=!!M.specularColorMap,ee=!!M.specularIntensityMap,te=Lt&&!!M.transmissionMap,Se=Lt&&!!M.thicknessMap,ve=!!M.gradientMap,Ae=!!M.alphaMap,ke=M.alphaTest>0,Xe=!!M.alphaHash,ut=!!M.extensions;let lt=Fd;M.toneMapped&&(wt===null||wt.isXRRenderTarget===!0)&&(lt=t.toneMapping);const Tt={shaderID:Fe,shaderType:M.type,shaderName:M.name,vertexShader:ct,fragmentShader:Ge,defines:M.defines,customVertexShaderID:Je,customFragmentShaderID:mt,isRawShaderMaterial:M.isRawShaderMaterial===!0,glslVersion:M.glslVersion,precision:y,batching:ei,batchingColor:ei&&Z._colorsTexture!==null,instancing:Qt,instancingColor:Qt&&Z.instanceColor!==null,instancingMorph:Qt&&Z.morphTexture!==null,supportsVertexTextures:v,outputColorSpace:wt===null?t.outputColorSpace:wt.isXRRenderTarget===!0?wt.texture.colorSpace:ma,alphaToCoverage:!!M.alphaToCoverage,map:Jt,matcap:Yt,envMap:Ut,envMapMode:Ut&&be.mapping,envMapCubeUVHeight:fe,aoMap:Re,lightMap:gi,bumpMap:it,normalMap:Pe,displacementMap:v&&Ye,emissiveMap:Ct,normalMapObjectSpace:Pe&&M.normalMapType===ure,normalMapTangentSpace:Pe&&M.normalMapType===Up,metalnessMap:st,roughnessMap:we,anisotropy:he,anisotropyMap:ot,clearcoat:xe,clearcoatMap:Nt,clearcoatNormalMap:fi,clearcoatRoughnessMap:Pt,dispersion:Be,iridescence:$e,iridescenceMap:ni,iridescenceThicknessMap:ti,sheen:Ze,sheenColorMap:nt,sheenRoughnessMap:Ce,specularMap:oe,specularColorMap:re,specularIntensityMap:ee,transmission:Lt,transmissionMap:te,thicknessMap:Se,gradientMap:ve,opaque:M.transparent===!1&&M.blending===wg&&M.alphaToCoverage===!1,alphaMap:Ae,alphaTest:ke,alphaHash:Xe,combine:M.combine,mapUv:Jt&&R(M.map.channel),aoMapUv:Re&&R(M.aoMap.channel),lightMapUv:gi&&R(M.lightMap.channel),bumpMapUv:it&&R(M.bumpMap.channel),normalMapUv:Pe&&R(M.normalMap.channel),displacementMapUv:Ye&&R(M.displacementMap.channel),emissiveMapUv:Ct&&R(M.emissiveMap.channel),metalnessMapUv:st&&R(M.metalnessMap.channel),roughnessMapUv:we&&R(M.roughnessMap.channel),anisotropyMapUv:ot&&R(M.anisotropyMap.channel),clearcoatMapUv:Nt&&R(M.clearcoatMap.channel),clearcoatNormalMapUv:fi&&R(M.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Pt&&R(M.clearcoatRoughnessMap.channel),iridescenceMapUv:ni&&R(M.iridescenceMap.channel),iridescenceThicknessMapUv:ti&&R(M.iridescenceThicknessMap.channel),sheenColorMapUv:nt&&R(M.sheenColorMap.channel),sheenRoughnessMapUv:Ce&&R(M.sheenRoughnessMap.channel),specularMapUv:oe&&R(M.specularMap.channel),specularColorMapUv:re&&R(M.specularColorMap.channel),specularIntensityMapUv:ee&&R(M.specularIntensityMap.channel),transmissionMapUv:te&&R(M.transmissionMap.channel),thicknessMapUv:Se&&R(M.thicknessMap.channel),alphaMapUv:Ae&&R(M.alphaMap.channel),vertexTangents:!!le.attributes.tangent&&(Pe||he),vertexColors:M.vertexColors,vertexAlphas:M.vertexColors===!0&&!!le.attributes.color&&le.attributes.color.itemSize===4,pointsUvs:Z.isPoints===!0&&!!le.attributes.uv&&(Jt||Ae),fog:!!ie,useFog:M.fog===!0,fogExp2:!!ie&&ie.isFogExp2,flatShading:M.flatShading===!0,sizeAttenuation:M.sizeAttenuation===!0,logarithmicDepthBuffer:p,reverseDepthBuffer:Ot,skinning:Z.isSkinnedMesh===!0,morphTargets:le.morphAttributes.position!==void 0,morphNormals:le.morphAttributes.normal!==void 0,morphColors:le.morphAttributes.color!==void 0,morphTargetsCount:je,morphTextureStride:qe,numDirLights:D.directional.length,numPointLights:D.point.length,numSpotLights:D.spot.length,numSpotLightMaps:D.spotLightMap.length,numRectAreaLights:D.rectArea.length,numHemiLights:D.hemi.length,numDirLightShadows:D.directionalShadowMap.length,numPointLightShadows:D.pointShadowMap.length,numSpotLightShadows:D.spotShadowMap.length,numSpotLightShadowsWithMaps:D.numSpotLightShadowsWithMaps,numLightProbes:D.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:M.dithering,shadowMapEnabled:t.shadowMap.enabled&&G.length>0,shadowMapType:t.shadowMap.type,toneMapping:lt,decodeVideoTexture:Jt&&M.map.isVideoTexture===!0&&Xn.getTransfer(M.map.colorSpace)===Or,decodeVideoTextureEmissive:Ct&&M.emissiveMap.isVideoTexture===!0&&Xn.getTransfer(M.emissiveMap.colorSpace)===Or,premultipliedAlpha:M.premultipliedAlpha,doubleSided:M.side===Pc,flipSided:M.side===Ha,useDepthPacking:M.depthPacking>=0,depthPacking:M.depthPacking||0,index0AttributeName:M.index0AttributeName,extensionClipCullDistance:ut&&M.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(ut&&M.extensions.multiDraw===!0||ei)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:M.customProgramCacheKey()};return Tt.vertexUv1s=u.has(1),Tt.vertexUv2s=u.has(2),Tt.vertexUv3s=u.has(3),u.clear(),Tt}function P(M){const D=[];if(M.shaderID?D.push(M.shaderID):(D.push(M.customVertexShaderID),D.push(M.customFragmentShaderID)),M.defines!==void 0)for(const G in M.defines)D.push(G),D.push(M.defines[G]);return M.isRawShaderMaterial===!1&&(N(D,M),F(D,M),D.push(t.outputColorSpace)),D.push(M.customProgramCacheKey),D.join()}function N(M,D){M.push(D.precision),M.push(D.outputColorSpace),M.push(D.envMapMode),M.push(D.envMapCubeUVHeight),M.push(D.mapUv),M.push(D.alphaMapUv),M.push(D.lightMapUv),M.push(D.aoMapUv),M.push(D.bumpMapUv),M.push(D.normalMapUv),M.push(D.displacementMapUv),M.push(D.emissiveMapUv),M.push(D.metalnessMapUv),M.push(D.roughnessMapUv),M.push(D.anisotropyMapUv),M.push(D.clearcoatMapUv),M.push(D.clearcoatNormalMapUv),M.push(D.clearcoatRoughnessMapUv),M.push(D.iridescenceMapUv),M.push(D.iridescenceThicknessMapUv),M.push(D.sheenColorMapUv),M.push(D.sheenRoughnessMapUv),M.push(D.specularMapUv),M.push(D.specularColorMapUv),M.push(D.specularIntensityMapUv),M.push(D.transmissionMapUv),M.push(D.thicknessMapUv),M.push(D.combine),M.push(D.fogExp2),M.push(D.sizeAttenuation),M.push(D.morphTargetsCount),M.push(D.morphAttributeCount),M.push(D.numDirLights),M.push(D.numPointLights),M.push(D.numSpotLights),M.push(D.numSpotLightMaps),M.push(D.numHemiLights),M.push(D.numRectAreaLights),M.push(D.numDirLightShadows),M.push(D.numPointLightShadows),M.push(D.numSpotLightShadows),M.push(D.numSpotLightShadowsWithMaps),M.push(D.numLightProbes),M.push(D.shadowMapType),M.push(D.toneMapping),M.push(D.numClippingPlanes),M.push(D.numClipIntersection),M.push(D.depthPacking)}function F(M,D){a.disableAll(),D.supportsVertexTextures&&a.enable(0),D.instancing&&a.enable(1),D.instancingColor&&a.enable(2),D.instancingMorph&&a.enable(3),D.matcap&&a.enable(4),D.envMap&&a.enable(5),D.normalMapObjectSpace&&a.enable(6),D.normalMapTangentSpace&&a.enable(7),D.clearcoat&&a.enable(8),D.iridescence&&a.enable(9),D.alphaTest&&a.enable(10),D.vertexColors&&a.enable(11),D.vertexAlphas&&a.enable(12),D.vertexUv1s&&a.enable(13),D.vertexUv2s&&a.enable(14),D.vertexUv3s&&a.enable(15),D.vertexTangents&&a.enable(16),D.anisotropy&&a.enable(17),D.alphaHash&&a.enable(18),D.batching&&a.enable(19),D.dispersion&&a.enable(20),D.batchingColor&&a.enable(21),M.push(a.mask),a.disableAll(),D.fog&&a.enable(0),D.useFog&&a.enable(1),D.flatShading&&a.enable(2),D.logarithmicDepthBuffer&&a.enable(3),D.reverseDepthBuffer&&a.enable(4),D.skinning&&a.enable(5),D.morphTargets&&a.enable(6),D.morphNormals&&a.enable(7),D.morphColors&&a.enable(8),D.premultipliedAlpha&&a.enable(9),D.shadowMapEnabled&&a.enable(10),D.doubleSided&&a.enable(11),D.flipSided&&a.enable(12),D.useDepthPacking&&a.enable(13),D.dithering&&a.enable(14),D.transmission&&a.enable(15),D.sheen&&a.enable(16),D.opaque&&a.enable(17),D.pointsUvs&&a.enable(18),D.decodeVideoTexture&&a.enable(19),D.decodeVideoTextureEmissive&&a.enable(20),D.alphaToCoverage&&a.enable(21),M.push(a.mask)}function k(M){const D=w[M.type];let G;if(D){const j=ca[D];G=tS.clone(j.uniforms)}else G=M.uniforms;return G}function $(M,D){let G;for(let j=0,Z=d.length;j<Z;j++){const ie=d[j];if(ie.cacheKey===D){G=ie,++G.usedTimes;break}}return G===void 0&&(G=new Eet(t,D,M,s),d.push(G)),G}function W(M){if(--M.usedTimes===0){const D=d.indexOf(M);d[D]=d[d.length-1],d.pop(),M.destroy()}}function Q(M){l.remove(M)}function Y(){l.dispose()}return{getParameters:O,getProgramCacheKey:P,getUniforms:k,acquireProgram:$,releaseProgram:W,releaseShaderCache:Q,programs:d,dispose:Y}}function Let(){let t=new WeakMap;function e(o){return t.has(o)}function i(o){let a=t.get(o);return a===void 0&&(a={},t.set(o,a)),a}function n(o){t.delete(o)}function r(o,a,l){t.get(o)[a]=l}function s(){t=new WeakMap}return{has:e,get:i,remove:n,update:r,dispose:s}}function Fet(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function gQ(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function vQ(){const t=[];let e=0;const i=[],n=[],r=[];function s(){e=0,i.length=0,n.length=0,r.length=0}function o(p,v,y,w,R,O){let P=t[e];return P===void 0?(P={id:p.id,object:p,geometry:v,material:y,groupOrder:w,renderOrder:p.renderOrder,z:R,group:O},t[e]=P):(P.id=p.id,P.object=p,P.geometry=v,P.material=y,P.groupOrder=w,P.renderOrder=p.renderOrder,P.z=R,P.group=O),e++,P}function a(p,v,y,w,R,O){const P=o(p,v,y,w,R,O);y.transmission>0?n.push(P):y.transparent===!0?r.push(P):i.push(P)}function l(p,v,y,w,R,O){const P=o(p,v,y,w,R,O);y.transmission>0?n.unshift(P):y.transparent===!0?r.unshift(P):i.unshift(P)}function u(p,v){i.length>1&&i.sort(p||Fet),n.length>1&&n.sort(v||gQ),r.length>1&&r.sort(v||gQ)}function d(){for(let p=e,v=t.length;p<v;p++){const y=t[p];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:i,transmissive:n,transparent:r,init:s,push:a,unshift:l,finish:d,sort:u}}function Net(){let t=new WeakMap;function e(n,r){const s=t.get(n);let o;return s===void 0?(o=new vQ,t.set(n,[o])):r>=s.length?(o=new vQ,s.push(o)):o=s[r],o}function i(){t=new WeakMap}return{get:e,dispose:i}}function Bet(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new Ie,color:new Si};break;case"SpotLight":i={position:new Ie,direction:new Ie,color:new Si,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Ie,color:new Si,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Ie,skyColor:new Si,groundColor:new Si};break;case"RectAreaLight":i={color:new Si,position:new Ie,halfWidth:new Ie,halfHeight:new Ie};break}return t[e.id]=i,i}}}function zet(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xt};break;case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xt};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xt,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=i,i}}}let Vet=0;function Get(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function Uet(t){const e=new Bet,i=zet(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)n.probe.push(new Ie);const r=new Ie,s=new sn,o=new sn;function a(u){let d=0,p=0,v=0;for(let M=0;M<9;M++)n.probe[M].set(0,0,0);let y=0,w=0,R=0,O=0,P=0,N=0,F=0,k=0,$=0,W=0,Q=0;u.sort(Get);for(let M=0,D=u.length;M<D;M++){const G=u[M],j=G.color,Z=G.intensity,ie=G.distance,le=G.shadow&&G.shadow.map?G.shadow.map.texture:null;if(G.isAmbientLight)d+=j.r*Z,p+=j.g*Z,v+=j.b*Z;else if(G.isLightProbe){for(let me=0;me<9;me++)n.probe[me].addScaledVector(G.sh.coefficients[me],Z);Q++}else if(G.isDirectionalLight){const me=e.get(G);if(me.color.copy(G.color).multiplyScalar(G.intensity),G.castShadow){const be=G.shadow,fe=i.get(G);fe.shadowIntensity=be.intensity,fe.shadowBias=be.bias,fe.shadowNormalBias=be.normalBias,fe.shadowRadius=be.radius,fe.shadowMapSize=be.mapSize,n.directionalShadow[y]=fe,n.directionalShadowMap[y]=le,n.directionalShadowMatrix[y]=G.shadow.matrix,N++}n.directional[y]=me,y++}else if(G.isSpotLight){const me=e.get(G);me.position.setFromMatrixPosition(G.matrixWorld),me.color.copy(j).multiplyScalar(Z),me.distance=ie,me.coneCos=Math.cos(G.angle),me.penumbraCos=Math.cos(G.angle*(1-G.penumbra)),me.decay=G.decay,n.spot[R]=me;const be=G.shadow;if(G.map&&(n.spotLightMap[$]=G.map,$++,be.updateMatrices(G),G.castShadow&&W++),n.spotLightMatrix[R]=be.matrix,G.castShadow){const fe=i.get(G);fe.shadowIntensity=be.intensity,fe.shadowBias=be.bias,fe.shadowNormalBias=be.normalBias,fe.shadowRadius=be.radius,fe.shadowMapSize=be.mapSize,n.spotShadow[R]=fe,n.spotShadowMap[R]=le,k++}R++}else if(G.isRectAreaLight){const me=e.get(G);me.color.copy(j).multiplyScalar(Z),me.halfWidth.set(G.width*.5,0,0),me.halfHeight.set(0,G.height*.5,0),n.rectArea[O]=me,O++}else if(G.isPointLight){const me=e.get(G);if(me.color.copy(G.color).multiplyScalar(G.intensity),me.distance=G.distance,me.decay=G.decay,G.castShadow){const be=G.shadow,fe=i.get(G);fe.shadowIntensity=be.intensity,fe.shadowBias=be.bias,fe.shadowNormalBias=be.normalBias,fe.shadowRadius=be.radius,fe.shadowMapSize=be.mapSize,fe.shadowCameraNear=be.camera.near,fe.shadowCameraFar=be.camera.far,n.pointShadow[w]=fe,n.pointShadowMap[w]=le,n.pointShadowMatrix[w]=G.shadow.matrix,F++}n.point[w]=me,w++}else if(G.isHemisphereLight){const me=e.get(G);me.skyColor.copy(G.color).multiplyScalar(Z),me.groundColor.copy(G.groundColor).multiplyScalar(Z),n.hemi[P]=me,P++}}O>0&&(t.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=mi.LTC_FLOAT_1,n.rectAreaLTC2=mi.LTC_FLOAT_2):(n.rectAreaLTC1=mi.LTC_HALF_1,n.rectAreaLTC2=mi.LTC_HALF_2)),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=v;const Y=n.hash;(Y.directionalLength!==y||Y.pointLength!==w||Y.spotLength!==R||Y.rectAreaLength!==O||Y.hemiLength!==P||Y.numDirectionalShadows!==N||Y.numPointShadows!==F||Y.numSpotShadows!==k||Y.numSpotMaps!==$||Y.numLightProbes!==Q)&&(n.directional.length=y,n.spot.length=R,n.rectArea.length=O,n.point.length=w,n.hemi.length=P,n.directionalShadow.length=N,n.directionalShadowMap.length=N,n.pointShadow.length=F,n.pointShadowMap.length=F,n.spotShadow.length=k,n.spotShadowMap.length=k,n.directionalShadowMatrix.length=N,n.pointShadowMatrix.length=F,n.spotLightMatrix.length=k+$-W,n.spotLightMap.length=$,n.numSpotLightShadowsWithMaps=W,n.numLightProbes=Q,Y.directionalLength=y,Y.pointLength=w,Y.spotLength=R,Y.rectAreaLength=O,Y.hemiLength=P,Y.numDirectionalShadows=N,Y.numPointShadows=F,Y.numSpotShadows=k,Y.numSpotMaps=$,Y.numLightProbes=Q,n.version=Vet++)}function l(u,d){let p=0,v=0,y=0,w=0,R=0;const O=d.matrixWorldInverse;for(let P=0,N=u.length;P<N;P++){const F=u[P];if(F.isDirectionalLight){const k=n.directional[p];k.direction.setFromMatrixPosition(F.matrixWorld),r.setFromMatrixPosition(F.target.matrixWorld),k.direction.sub(r),k.direction.transformDirection(O),p++}else if(F.isSpotLight){const k=n.spot[y];k.position.setFromMatrixPosition(F.matrixWorld),k.position.applyMatrix4(O),k.direction.setFromMatrixPosition(F.matrixWorld),r.setFromMatrixPosition(F.target.matrixWorld),k.direction.sub(r),k.direction.transformDirection(O),y++}else if(F.isRectAreaLight){const k=n.rectArea[w];k.position.setFromMatrixPosition(F.matrixWorld),k.position.applyMatrix4(O),o.identity(),s.copy(F.matrixWorld),s.premultiply(O),o.extractRotation(s),k.halfWidth.set(F.width*.5,0,0),k.halfHeight.set(0,F.height*.5,0),k.halfWidth.applyMatrix4(o),k.halfHeight.applyMatrix4(o),w++}else if(F.isPointLight){const k=n.point[v];k.position.setFromMatrixPosition(F.matrixWorld),k.position.applyMatrix4(O),v++}else if(F.isHemisphereLight){const k=n.hemi[R];k.direction.setFromMatrixPosition(F.matrixWorld),k.direction.transformDirection(O),R++}}}return{setup:a,setupView:l,state:n}}function yQ(t){const e=new Uet(t),i=[],n=[];function r(d){u.camera=d,i.length=0,n.length=0}function s(d){i.push(d)}function o(d){n.push(d)}function a(){e.setup(i)}function l(d){e.setupView(i,d)}const u={lightsArray:i,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:u,setupLights:a,setupLightsView:l,pushLight:s,pushShadow:o}}function Het(t){let e=new WeakMap;function i(r,s=0){const o=e.get(r);let a;return o===void 0?(a=new yQ(t),e.set(r,[a])):s>=o.length?(a=new yQ(t),o.push(a)):a=o[s],a}function n(){e=new WeakMap}return{get:i,dispose:n}}const $et=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Wet=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function qet(t,e,i){let n=new sS;const r=new Xt,s=new Xt,o=new Mn,a=new o5({depthPacking:cre}),l=new a5,u={},d=i.maxTextureSize,p={[kh]:Ha,[Ha]:kh,[Pc]:Pc},v=new Qc({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Xt},radius:{value:4}},vertexShader:$et,fragmentShader:Wet}),y=v.clone();y.defines.HORIZONTAL_PASS=1;const w=new Rn;w.setAttribute("position",new xr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const R=new us(w,v),O=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=EH;let P=this.type;this.render=function(W,Q,Y){if(O.enabled===!1||O.autoUpdate===!1&&O.needsUpdate===!1||W.length===0)return;const M=t.getRenderTarget(),D=t.getActiveCubeFace(),G=t.getActiveMipmapLevel(),j=t.state;j.setBlending(Ld),j.buffers.color.setClear(1,1,1,1),j.buffers.depth.setTest(!0),j.setScissorTest(!1);const Z=P!==th&&this.type===th,ie=P===th&&this.type!==th;for(let le=0,me=W.length;le<me;le++){const be=W[le],fe=be.shadow;if(fe===void 0){console.warn("THREE.WebGLShadowMap:",be,"has no shadow.");continue}if(fe.autoUpdate===!1&&fe.needsUpdate===!1)continue;r.copy(fe.mapSize);const Fe=fe.getFrameExtents();if(r.multiply(Fe),s.copy(fe.mapSize),(r.x>d||r.y>d)&&(r.x>d&&(s.x=Math.floor(d/Fe.x),r.x=s.x*Fe.x,fe.mapSize.x=s.x),r.y>d&&(s.y=Math.floor(d/Fe.y),r.y=s.y*Fe.y,fe.mapSize.y=s.y)),fe.map===null||Z===!0||ie===!0){const je=this.type!==th?{minFilter:fo,magFilter:fo}:{};fe.map!==null&&fe.map.dispose(),fe.map=new Lh(r.x,r.y,je),fe.map.texture.name=be.name+".shadowMap",fe.camera.updateProjectionMatrix()}t.setRenderTarget(fe.map),t.clear();const He=fe.getViewportCount();for(let je=0;je<He;je++){const qe=fe.getViewport(je);o.set(s.x*qe.x,s.y*qe.y,s.x*qe.z,s.y*qe.w),j.viewport(o),fe.updateMatrices(be,je),n=fe.getFrustum(),k(Q,Y,fe.camera,be,this.type)}fe.isPointLightShadow!==!0&&this.type===th&&N(fe,Y),fe.needsUpdate=!1}P=this.type,O.needsUpdate=!1,t.setRenderTarget(M,D,G)};function N(W,Q){const Y=e.update(R);v.defines.VSM_SAMPLES!==W.blurSamples&&(v.defines.VSM_SAMPLES=W.blurSamples,y.defines.VSM_SAMPLES=W.blurSamples,v.needsUpdate=!0,y.needsUpdate=!0),W.mapPass===null&&(W.mapPass=new Lh(r.x,r.y)),v.uniforms.shadow_pass.value=W.map.texture,v.uniforms.resolution.value=W.mapSize,v.uniforms.radius.value=W.radius,t.setRenderTarget(W.mapPass),t.clear(),t.renderBufferDirect(Q,null,Y,v,R,null),y.uniforms.shadow_pass.value=W.mapPass.texture,y.uniforms.resolution.value=W.mapSize,y.uniforms.radius.value=W.radius,t.setRenderTarget(W.map),t.clear(),t.renderBufferDirect(Q,null,Y,y,R,null)}function F(W,Q,Y,M){let D=null;const G=Y.isPointLight===!0?W.customDistanceMaterial:W.customDepthMaterial;if(G!==void 0)D=G;else if(D=Y.isPointLight===!0?l:a,t.localClippingEnabled&&Q.clipShadows===!0&&Array.isArray(Q.clippingPlanes)&&Q.clippingPlanes.length!==0||Q.displacementMap&&Q.displacementScale!==0||Q.alphaMap&&Q.alphaTest>0||Q.map&&Q.alphaTest>0){const j=D.uuid,Z=Q.uuid;let ie=u[j];ie===void 0&&(ie={},u[j]=ie);let le=ie[Z];le===void 0&&(le=D.clone(),ie[Z]=le,Q.addEventListener("dispose",$)),D=le}if(D.visible=Q.visible,D.wireframe=Q.wireframe,M===th?D.side=Q.shadowSide!==null?Q.shadowSide:Q.side:D.side=Q.shadowSide!==null?Q.shadowSide:p[Q.side],D.alphaMap=Q.alphaMap,D.alphaTest=Q.alphaTest,D.map=Q.map,D.clipShadows=Q.clipShadows,D.clippingPlanes=Q.clippingPlanes,D.clipIntersection=Q.clipIntersection,D.displacementMap=Q.displacementMap,D.displacementScale=Q.displacementScale,D.displacementBias=Q.displacementBias,D.wireframeLinewidth=Q.wireframeLinewidth,D.linewidth=Q.linewidth,Y.isPointLight===!0&&D.isMeshDistanceMaterial===!0){const j=t.properties.get(D);j.light=Y}return D}function k(W,Q,Y,M,D){if(W.visible===!1)return;if(W.layers.test(Q.layers)&&(W.isMesh||W.isLine||W.isPoints)&&(W.castShadow||W.receiveShadow&&D===th)&&(!W.frustumCulled||n.intersectsObject(W))){W.modelViewMatrix.multiplyMatrices(Y.matrixWorldInverse,W.matrixWorld);const Z=e.update(W),ie=W.material;if(Array.isArray(ie)){const le=Z.groups;for(let me=0,be=le.length;me<be;me++){const fe=le[me],Fe=ie[fe.materialIndex];if(Fe&&Fe.visible){const He=F(W,Fe,M,D);W.onBeforeShadow(t,W,Q,Y,Z,He,fe),t.renderBufferDirect(Y,null,Z,He,W,fe),W.onAfterShadow(t,W,Q,Y,Z,He,fe)}}}else if(ie.visible){const le=F(W,ie,M,D);W.onBeforeShadow(t,W,Q,Y,Z,le,null),t.renderBufferDirect(Y,null,Z,le,W,null),W.onAfterShadow(t,W,Q,Y,Z,le,null)}}const j=W.children;for(let Z=0,ie=j.length;Z<ie;Z++)k(j[Z],Q,Y,M,D)}function $(W){W.target.removeEventListener("dispose",$);for(const Y in u){const M=u[Y],D=W.target.uuid;D in M&&(M[D].dispose(),delete M[D])}}}const jet={[cR]:uR,[hR]:pR,[dR]:mR,[Ug]:fR,[uR]:cR,[pR]:hR,[mR]:dR,[fR]:Ug};function Qet(t,e){function i(){let te=!1;const Se=new Mn;let ve=null;const Ae=new Mn(0,0,0,0);return{setMask:function(ke){ve!==ke&&!te&&(t.colorMask(ke,ke,ke,ke),ve=ke)},setLocked:function(ke){te=ke},setClear:function(ke,Xe,ut,lt,Tt){Tt===!0&&(ke*=lt,Xe*=lt,ut*=lt),Se.set(ke,Xe,ut,lt),Ae.equals(Se)===!1&&(t.clearColor(ke,Xe,ut,lt),Ae.copy(Se))},reset:function(){te=!1,ve=null,Ae.set(-1,0,0,0)}}}function n(){let te=!1,Se=!1,ve=null,Ae=null,ke=null;return{setReversed:function(Xe){if(Se!==Xe){const ut=e.get("EXT_clip_control");Xe?ut.clipControlEXT(ut.LOWER_LEFT_EXT,ut.ZERO_TO_ONE_EXT):ut.clipControlEXT(ut.LOWER_LEFT_EXT,ut.NEGATIVE_ONE_TO_ONE_EXT),Se=Xe;const lt=ke;ke=null,this.setClear(lt)}},getReversed:function(){return Se},setTest:function(Xe){Xe?wt(t.DEPTH_TEST):Ot(t.DEPTH_TEST)},setMask:function(Xe){ve!==Xe&&!te&&(t.depthMask(Xe),ve=Xe)},setFunc:function(Xe){if(Se&&(Xe=jet[Xe]),Ae!==Xe){switch(Xe){case cR:t.depthFunc(t.NEVER);break;case uR:t.depthFunc(t.ALWAYS);break;case hR:t.depthFunc(t.LESS);break;case Ug:t.depthFunc(t.LEQUAL);break;case dR:t.depthFunc(t.EQUAL);break;case fR:t.depthFunc(t.GEQUAL);break;case pR:t.depthFunc(t.GREATER);break;case mR:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}Ae=Xe}},setLocked:function(Xe){te=Xe},setClear:function(Xe){ke!==Xe&&(Se&&(Xe=1-Xe),t.clearDepth(Xe),ke=Xe)},reset:function(){te=!1,ve=null,Ae=null,ke=null,Se=!1}}}function r(){let te=!1,Se=null,ve=null,Ae=null,ke=null,Xe=null,ut=null,lt=null,Tt=null;return{setTest:function(zt){te||(zt?wt(t.STENCIL_TEST):Ot(t.STENCIL_TEST))},setMask:function(zt){Se!==zt&&!te&&(t.stencilMask(zt),Se=zt)},setFunc:function(zt,ii,xt){(ve!==zt||Ae!==ii||ke!==xt)&&(t.stencilFunc(zt,ii,xt),ve=zt,Ae=ii,ke=xt)},setOp:function(zt,ii,xt){(Xe!==zt||ut!==ii||lt!==xt)&&(t.stencilOp(zt,ii,xt),Xe=zt,ut=ii,lt=xt)},setLocked:function(zt){te=zt},setClear:function(zt){Tt!==zt&&(t.clearStencil(zt),Tt=zt)},reset:function(){te=!1,Se=null,ve=null,Ae=null,ke=null,Xe=null,ut=null,lt=null,Tt=null}}}const s=new i,o=new n,a=new r,l=new WeakMap,u=new WeakMap;let d={},p={},v=new WeakMap,y=[],w=null,R=!1,O=null,P=null,N=null,F=null,k=null,$=null,W=null,Q=new Si(0,0,0),Y=0,M=!1,D=null,G=null,j=null,Z=null,ie=null;const le=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let me=!1,be=0;const fe=t.getParameter(t.VERSION);fe.indexOf("WebGL")!==-1?(be=parseFloat(/^WebGL (\d)/.exec(fe)[1]),me=be>=1):fe.indexOf("OpenGL ES")!==-1&&(be=parseFloat(/^OpenGL ES (\d)/.exec(fe)[1]),me=be>=2);let Fe=null,He={};const je=t.getParameter(t.SCISSOR_BOX),qe=t.getParameter(t.VIEWPORT),ct=new Mn().fromArray(je),Ge=new Mn().fromArray(qe);function Je(te,Se,ve,Ae){const ke=new Uint8Array(4),Xe=t.createTexture();t.bindTexture(te,Xe),t.texParameteri(te,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(te,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let ut=0;ut<ve;ut++)te===t.TEXTURE_3D||te===t.TEXTURE_2D_ARRAY?t.texImage3D(Se,0,t.RGBA,1,1,Ae,0,t.RGBA,t.UNSIGNED_BYTE,ke):t.texImage2D(Se+ut,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,ke);return Xe}const mt={};mt[t.TEXTURE_2D]=Je(t.TEXTURE_2D,t.TEXTURE_2D,1),mt[t.TEXTURE_CUBE_MAP]=Je(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),mt[t.TEXTURE_2D_ARRAY]=Je(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),mt[t.TEXTURE_3D]=Je(t.TEXTURE_3D,t.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),wt(t.DEPTH_TEST),o.setFunc(Ug),it(!1),Pe(_V),wt(t.CULL_FACE),Re(Ld);function wt(te){d[te]!==!0&&(t.enable(te),d[te]=!0)}function Ot(te){d[te]!==!1&&(t.disable(te),d[te]=!1)}function Qt(te,Se){return p[te]!==Se?(t.bindFramebuffer(te,Se),p[te]=Se,te===t.DRAW_FRAMEBUFFER&&(p[t.FRAMEBUFFER]=Se),te===t.FRAMEBUFFER&&(p[t.DRAW_FRAMEBUFFER]=Se),!0):!1}function ei(te,Se){let ve=y,Ae=!1;if(te){ve=v.get(Se),ve===void 0&&(ve=[],v.set(Se,ve));const ke=te.textures;if(ve.length!==ke.length||ve[0]!==t.COLOR_ATTACHMENT0){for(let Xe=0,ut=ke.length;Xe<ut;Xe++)ve[Xe]=t.COLOR_ATTACHMENT0+Xe;ve.length=ke.length,Ae=!0}}else ve[0]!==t.BACK&&(ve[0]=t.BACK,Ae=!0);Ae&&t.drawBuffers(ve)}function Jt(te){return w!==te?(t.useProgram(te),w=te,!0):!1}const Yt={[rp]:t.FUNC_ADD,[Ine]:t.FUNC_SUBTRACT,[kne]:t.FUNC_REVERSE_SUBTRACT};Yt[Dne]=t.MIN,Yt[Lne]=t.MAX;const Ut={[Fne]:t.ZERO,[Nne]:t.ONE,[Bne]:t.SRC_COLOR,[aR]:t.SRC_ALPHA,[$ne]:t.SRC_ALPHA_SATURATE,[Une]:t.DST_COLOR,[Vne]:t.DST_ALPHA,[zne]:t.ONE_MINUS_SRC_COLOR,[lR]:t.ONE_MINUS_SRC_ALPHA,[Hne]:t.ONE_MINUS_DST_COLOR,[Gne]:t.ONE_MINUS_DST_ALPHA,[Wne]:t.CONSTANT_COLOR,[qne]:t.ONE_MINUS_CONSTANT_COLOR,[jne]:t.CONSTANT_ALPHA,[Qne]:t.ONE_MINUS_CONSTANT_ALPHA};function Re(te,Se,ve,Ae,ke,Xe,ut,lt,Tt,zt){if(te===Ld){R===!0&&(Ot(t.BLEND),R=!1);return}if(R===!1&&(wt(t.BLEND),R=!0),te!==Ane){if(te!==O||zt!==M){if((P!==rp||k!==rp)&&(t.blendEquation(t.FUNC_ADD),P=rp,k=rp),zt)switch(te){case wg:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case CV:t.blendFunc(t.ONE,t.ONE);break;case SV:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case OV:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",te);break}else switch(te){case wg:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case CV:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case SV:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case OV:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",te);break}N=null,F=null,$=null,W=null,Q.set(0,0,0),Y=0,O=te,M=zt}return}ke=ke||Se,Xe=Xe||ve,ut=ut||Ae,(Se!==P||ke!==k)&&(t.blendEquationSeparate(Yt[Se],Yt[ke]),P=Se,k=ke),(ve!==N||Ae!==F||Xe!==$||ut!==W)&&(t.blendFuncSeparate(Ut[ve],Ut[Ae],Ut[Xe],Ut[ut]),N=ve,F=Ae,$=Xe,W=ut),(lt.equals(Q)===!1||Tt!==Y)&&(t.blendColor(lt.r,lt.g,lt.b,Tt),Q.copy(lt),Y=Tt),O=te,M=!1}function gi(te,Se){te.side===Pc?Ot(t.CULL_FACE):wt(t.CULL_FACE);let ve=te.side===Ha;Se&&(ve=!ve),it(ve),te.blending===wg&&te.transparent===!1?Re(Ld):Re(te.blending,te.blendEquation,te.blendSrc,te.blendDst,te.blendEquationAlpha,te.blendSrcAlpha,te.blendDstAlpha,te.blendColor,te.blendAlpha,te.premultipliedAlpha),o.setFunc(te.depthFunc),o.setTest(te.depthTest),o.setMask(te.depthWrite),s.setMask(te.colorWrite);const Ae=te.stencilWrite;a.setTest(Ae),Ae&&(a.setMask(te.stencilWriteMask),a.setFunc(te.stencilFunc,te.stencilRef,te.stencilFuncMask),a.setOp(te.stencilFail,te.stencilZFail,te.stencilZPass)),Ct(te.polygonOffset,te.polygonOffsetFactor,te.polygonOffsetUnits),te.alphaToCoverage===!0?wt(t.SAMPLE_ALPHA_TO_COVERAGE):Ot(t.SAMPLE_ALPHA_TO_COVERAGE)}function it(te){D!==te&&(te?t.frontFace(t.CW):t.frontFace(t.CCW),D=te)}function Pe(te){te!==Pne?(wt(t.CULL_FACE),te!==G&&(te===_V?t.cullFace(t.BACK):te===Ene?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):Ot(t.CULL_FACE),G=te}function Ye(te){te!==j&&(me&&t.lineWidth(te),j=te)}function Ct(te,Se,ve){te?(wt(t.POLYGON_OFFSET_FILL),(Z!==Se||ie!==ve)&&(t.polygonOffset(Se,ve),Z=Se,ie=ve)):Ot(t.POLYGON_OFFSET_FILL)}function st(te){te?wt(t.SCISSOR_TEST):Ot(t.SCISSOR_TEST)}function we(te){te===void 0&&(te=t.TEXTURE0+le-1),Fe!==te&&(t.activeTexture(te),Fe=te)}function he(te,Se,ve){ve===void 0&&(Fe===null?ve=t.TEXTURE0+le-1:ve=Fe);let Ae=He[ve];Ae===void 0&&(Ae={type:void 0,texture:void 0},He[ve]=Ae),(Ae.type!==te||Ae.texture!==Se)&&(Fe!==ve&&(t.activeTexture(ve),Fe=ve),t.bindTexture(te,Se||mt[te]),Ae.type=te,Ae.texture=Se)}function xe(){const te=He[Fe];te!==void 0&&te.type!==void 0&&(t.bindTexture(te.type,null),te.type=void 0,te.texture=void 0)}function Be(){try{t.compressedTexImage2D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function $e(){try{t.compressedTexImage3D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function Ze(){try{t.texSubImage2D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function Lt(){try{t.texSubImage3D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function ot(){try{t.compressedTexSubImage2D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function Nt(){try{t.compressedTexSubImage3D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function fi(){try{t.texStorage2D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function Pt(){try{t.texStorage3D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function ni(){try{t.texImage2D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function ti(){try{t.texImage3D(...arguments)}catch(te){console.error("THREE.WebGLState:",te)}}function nt(te){ct.equals(te)===!1&&(t.scissor(te.x,te.y,te.z,te.w),ct.copy(te))}function Ce(te){Ge.equals(te)===!1&&(t.viewport(te.x,te.y,te.z,te.w),Ge.copy(te))}function oe(te,Se){let ve=u.get(Se);ve===void 0&&(ve=new WeakMap,u.set(Se,ve));let Ae=ve.get(te);Ae===void 0&&(Ae=t.getUniformBlockIndex(Se,te.name),ve.set(te,Ae))}function re(te,Se){const Ae=u.get(Se).get(te);l.get(Se)!==Ae&&(t.uniformBlockBinding(Se,Ae,te.__bindingPointIndex),l.set(Se,Ae))}function ee(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),o.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),d={},Fe=null,He={},p={},v=new WeakMap,y=[],w=null,R=!1,O=null,P=null,N=null,F=null,k=null,$=null,W=null,Q=new Si(0,0,0),Y=0,M=!1,D=null,G=null,j=null,Z=null,ie=null,ct.set(0,0,t.canvas.width,t.canvas.height),Ge.set(0,0,t.canvas.width,t.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:wt,disable:Ot,bindFramebuffer:Qt,drawBuffers:ei,useProgram:Jt,setBlending:Re,setMaterial:gi,setFlipSided:it,setCullFace:Pe,setLineWidth:Ye,setPolygonOffset:Ct,setScissorTest:st,activeTexture:we,bindTexture:he,unbindTexture:xe,compressedTexImage2D:Be,compressedTexImage3D:$e,texImage2D:ni,texImage3D:ti,updateUBOMapping:oe,uniformBlockBinding:re,texStorage2D:fi,texStorage3D:Pt,texSubImage2D:Ze,texSubImage3D:Lt,compressedTexSubImage2D:ot,compressedTexSubImage3D:Nt,scissor:nt,viewport:Ce,reset:ee}}function Zet(t,e,i,n,r,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new Xt,d=new WeakMap;let p;const v=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function w(we,he){return y?new OffscreenCanvas(we,he):dC("canvas")}function R(we,he,xe){let Be=1;const $e=st(we);if(($e.width>xe||$e.height>xe)&&(Be=xe/Math.max($e.width,$e.height)),Be<1)if(typeof HTMLImageElement<"u"&&we instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&we instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&we instanceof ImageBitmap||typeof VideoFrame<"u"&&we instanceof VideoFrame){const Ze=Math.floor(Be*$e.width),Lt=Math.floor(Be*$e.height);p===void 0&&(p=w(Ze,Lt));const ot=he?w(Ze,Lt):p;return ot.width=Ze,ot.height=Lt,ot.getContext("2d").drawImage(we,0,0,Ze,Lt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+$e.width+"x"+$e.height+") to ("+Ze+"x"+Lt+")."),ot}else return"data"in we&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+$e.width+"x"+$e.height+")."),we;return we}function O(we){return we.generateMipmaps}function P(we){t.generateMipmap(we)}function N(we){return we.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:we.isWebGL3DRenderTarget?t.TEXTURE_3D:we.isWebGLArrayRenderTarget||we.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function F(we,he,xe,Be,$e=!1){if(we!==null){if(t[we]!==void 0)return t[we];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+we+"'")}let Ze=he;if(he===t.RED&&(xe===t.FLOAT&&(Ze=t.R32F),xe===t.HALF_FLOAT&&(Ze=t.R16F),xe===t.UNSIGNED_BYTE&&(Ze=t.R8)),he===t.RED_INTEGER&&(xe===t.UNSIGNED_BYTE&&(Ze=t.R8UI),xe===t.UNSIGNED_SHORT&&(Ze=t.R16UI),xe===t.UNSIGNED_INT&&(Ze=t.R32UI),xe===t.BYTE&&(Ze=t.R8I),xe===t.SHORT&&(Ze=t.R16I),xe===t.INT&&(Ze=t.R32I)),he===t.RG&&(xe===t.FLOAT&&(Ze=t.RG32F),xe===t.HALF_FLOAT&&(Ze=t.RG16F),xe===t.UNSIGNED_BYTE&&(Ze=t.RG8)),he===t.RG_INTEGER&&(xe===t.UNSIGNED_BYTE&&(Ze=t.RG8UI),xe===t.UNSIGNED_SHORT&&(Ze=t.RG16UI),xe===t.UNSIGNED_INT&&(Ze=t.RG32UI),xe===t.BYTE&&(Ze=t.RG8I),xe===t.SHORT&&(Ze=t.RG16I),xe===t.INT&&(Ze=t.RG32I)),he===t.RGB_INTEGER&&(xe===t.UNSIGNED_BYTE&&(Ze=t.RGB8UI),xe===t.UNSIGNED_SHORT&&(Ze=t.RGB16UI),xe===t.UNSIGNED_INT&&(Ze=t.RGB32UI),xe===t.BYTE&&(Ze=t.RGB8I),xe===t.SHORT&&(Ze=t.RGB16I),xe===t.INT&&(Ze=t.RGB32I)),he===t.RGBA_INTEGER&&(xe===t.UNSIGNED_BYTE&&(Ze=t.RGBA8UI),xe===t.UNSIGNED_SHORT&&(Ze=t.RGBA16UI),xe===t.UNSIGNED_INT&&(Ze=t.RGBA32UI),xe===t.BYTE&&(Ze=t.RGBA8I),xe===t.SHORT&&(Ze=t.RGBA16I),xe===t.INT&&(Ze=t.RGBA32I)),he===t.RGB&&xe===t.UNSIGNED_INT_5_9_9_9_REV&&(Ze=t.RGB9_E5),he===t.RGBA){const Lt=$e?cC:Xn.getTransfer(Be);xe===t.FLOAT&&(Ze=t.RGBA32F),xe===t.HALF_FLOAT&&(Ze=t.RGBA16F),xe===t.UNSIGNED_BYTE&&(Ze=Lt===Or?t.SRGB8_ALPHA8:t.RGBA8),xe===t.UNSIGNED_SHORT_4_4_4_4&&(Ze=t.RGBA4),xe===t.UNSIGNED_SHORT_5_5_5_1&&(Ze=t.RGB5_A1)}return(Ze===t.R16F||Ze===t.R32F||Ze===t.RG16F||Ze===t.RG32F||Ze===t.RGBA16F||Ze===t.RGBA32F)&&e.get("EXT_color_buffer_float"),Ze}function k(we,he){let xe;return we?he===null||he===Kd||he===V0?xe=t.DEPTH24_STENCIL8:he===gl?xe=t.DEPTH32F_STENCIL8:he===z0&&(xe=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):he===null||he===Kd||he===V0?xe=t.DEPTH_COMPONENT24:he===gl?xe=t.DEPTH_COMPONENT32F:he===z0&&(xe=t.DEPTH_COMPONENT16),xe}function $(we,he){return O(we)===!0||we.isFramebufferTexture&&we.minFilter!==fo&&we.minFilter!==Ps?Math.log2(Math.max(he.width,he.height))+1:we.mipmaps!==void 0&&we.mipmaps.length>0?we.mipmaps.length:we.isCompressedTexture&&Array.isArray(we.image)?he.mipmaps.length:1}function W(we){const he=we.target;he.removeEventListener("dispose",W),Y(he),he.isVideoTexture&&d.delete(he)}function Q(we){const he=we.target;he.removeEventListener("dispose",Q),D(he)}function Y(we){const he=n.get(we);if(he.__webglInit===void 0)return;const xe=we.source,Be=v.get(xe);if(Be){const $e=Be[he.__cacheKey];$e.usedTimes--,$e.usedTimes===0&&M(we),Object.keys(Be).length===0&&v.delete(xe)}n.remove(we)}function M(we){const he=n.get(we);t.deleteTexture(he.__webglTexture);const xe=we.source,Be=v.get(xe);delete Be[he.__cacheKey],o.memory.textures--}function D(we){const he=n.get(we);if(we.depthTexture&&(we.depthTexture.dispose(),n.remove(we.depthTexture)),we.isWebGLCubeRenderTarget)for(let Be=0;Be<6;Be++){if(Array.isArray(he.__webglFramebuffer[Be]))for(let $e=0;$e<he.__webglFramebuffer[Be].length;$e++)t.deleteFramebuffer(he.__webglFramebuffer[Be][$e]);else t.deleteFramebuffer(he.__webglFramebuffer[Be]);he.__webglDepthbuffer&&t.deleteRenderbuffer(he.__webglDepthbuffer[Be])}else{if(Array.isArray(he.__webglFramebuffer))for(let Be=0;Be<he.__webglFramebuffer.length;Be++)t.deleteFramebuffer(he.__webglFramebuffer[Be]);else t.deleteFramebuffer(he.__webglFramebuffer);if(he.__webglDepthbuffer&&t.deleteRenderbuffer(he.__webglDepthbuffer),he.__webglMultisampledFramebuffer&&t.deleteFramebuffer(he.__webglMultisampledFramebuffer),he.__webglColorRenderbuffer)for(let Be=0;Be<he.__webglColorRenderbuffer.length;Be++)he.__webglColorRenderbuffer[Be]&&t.deleteRenderbuffer(he.__webglColorRenderbuffer[Be]);he.__webglDepthRenderbuffer&&t.deleteRenderbuffer(he.__webglDepthRenderbuffer)}const xe=we.textures;for(let Be=0,$e=xe.length;Be<$e;Be++){const Ze=n.get(xe[Be]);Ze.__webglTexture&&(t.deleteTexture(Ze.__webglTexture),o.memory.textures--),n.remove(xe[Be])}n.remove(we)}let G=0;function j(){G=0}function Z(){const we=G;return we>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+we+" texture units while this GPU supports only "+r.maxTextures),G+=1,we}function ie(we){const he=[];return he.push(we.wrapS),he.push(we.wrapT),he.push(we.wrapR||0),he.push(we.magFilter),he.push(we.minFilter),he.push(we.anisotropy),he.push(we.internalFormat),he.push(we.format),he.push(we.type),he.push(we.generateMipmaps),he.push(we.premultiplyAlpha),he.push(we.flipY),he.push(we.unpackAlignment),he.push(we.colorSpace),he.join()}function le(we,he){const xe=n.get(we);if(we.isVideoTexture&&Ye(we),we.isRenderTargetTexture===!1&&we.version>0&&xe.__version!==we.version){const Be=we.image;if(Be===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Be.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Ge(xe,we,he);return}}i.bindTexture(t.TEXTURE_2D,xe.__webglTexture,t.TEXTURE0+he)}function me(we,he){const xe=n.get(we);if(we.version>0&&xe.__version!==we.version){Ge(xe,we,he);return}i.bindTexture(t.TEXTURE_2D_ARRAY,xe.__webglTexture,t.TEXTURE0+he)}function be(we,he){const xe=n.get(we);if(we.version>0&&xe.__version!==we.version){Ge(xe,we,he);return}i.bindTexture(t.TEXTURE_3D,xe.__webglTexture,t.TEXTURE0+he)}function fe(we,he){const xe=n.get(we);if(we.version>0&&xe.__version!==we.version){Je(xe,we,he);return}i.bindTexture(t.TEXTURE_CUBE_MAP,xe.__webglTexture,t.TEXTURE0+he)}const Fe={[Ap]:t.REPEAT,[Zl]:t.CLAMP_TO_EDGE,[B0]:t.MIRRORED_REPEAT},He={[fo]:t.NEAREST,[sL]:t.NEAREST_MIPMAP_NEAREST,[tg]:t.NEAREST_MIPMAP_LINEAR,[Ps]:t.LINEAR,[o0]:t.LINEAR_MIPMAP_NEAREST,[Fc]:t.LINEAR_MIPMAP_LINEAR},je={[hre]:t.NEVER,[vre]:t.ALWAYS,[dre]:t.LESS,[UH]:t.LEQUAL,[fre]:t.EQUAL,[gre]:t.GEQUAL,[pre]:t.GREATER,[mre]:t.NOTEQUAL};function qe(we,he){if(he.type===gl&&e.has("OES_texture_float_linear")===!1&&(he.magFilter===Ps||he.magFilter===o0||he.magFilter===tg||he.magFilter===Fc||he.minFilter===Ps||he.minFilter===o0||he.minFilter===tg||he.minFilter===Fc)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(we,t.TEXTURE_WRAP_S,Fe[he.wrapS]),t.texParameteri(we,t.TEXTURE_WRAP_T,Fe[he.wrapT]),(we===t.TEXTURE_3D||we===t.TEXTURE_2D_ARRAY)&&t.texParameteri(we,t.TEXTURE_WRAP_R,Fe[he.wrapR]),t.texParameteri(we,t.TEXTURE_MAG_FILTER,He[he.magFilter]),t.texParameteri(we,t.TEXTURE_MIN_FILTER,He[he.minFilter]),he.compareFunction&&(t.texParameteri(we,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(we,t.TEXTURE_COMPARE_FUNC,je[he.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(he.magFilter===fo||he.minFilter!==tg&&he.minFilter!==Fc||he.type===gl&&e.has("OES_texture_float_linear")===!1)return;if(he.anisotropy>1||n.get(he).__currentAnisotropy){const xe=e.get("EXT_texture_filter_anisotropic");t.texParameterf(we,xe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(he.anisotropy,r.getMaxAnisotropy())),n.get(he).__currentAnisotropy=he.anisotropy}}}function ct(we,he){let xe=!1;we.__webglInit===void 0&&(we.__webglInit=!0,he.addEventListener("dispose",W));const Be=he.source;let $e=v.get(Be);$e===void 0&&($e={},v.set(Be,$e));const Ze=ie(he);if(Ze!==we.__cacheKey){$e[Ze]===void 0&&($e[Ze]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,xe=!0),$e[Ze].usedTimes++;const Lt=$e[we.__cacheKey];Lt!==void 0&&($e[we.__cacheKey].usedTimes--,Lt.usedTimes===0&&M(he)),we.__cacheKey=Ze,we.__webglTexture=$e[Ze].texture}return xe}function Ge(we,he,xe){let Be=t.TEXTURE_2D;(he.isDataArrayTexture||he.isCompressedArrayTexture)&&(Be=t.TEXTURE_2D_ARRAY),he.isData3DTexture&&(Be=t.TEXTURE_3D);const $e=ct(we,he),Ze=he.source;i.bindTexture(Be,we.__webglTexture,t.TEXTURE0+xe);const Lt=n.get(Ze);if(Ze.version!==Lt.__version||$e===!0){i.activeTexture(t.TEXTURE0+xe);const ot=Xn.getPrimaries(Xn.workingColorSpace),Nt=he.colorSpace===_d?null:Xn.getPrimaries(he.colorSpace),fi=he.colorSpace===_d||ot===Nt?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,he.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,he.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,he.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,fi);let Pt=R(he.image,!1,r.maxTextureSize);Pt=Ct(he,Pt);const ni=s.convert(he.format,he.colorSpace),ti=s.convert(he.type);let nt=F(he.internalFormat,ni,ti,he.colorSpace,he.isVideoTexture);qe(Be,he);let Ce;const oe=he.mipmaps,re=he.isVideoTexture!==!0,ee=Lt.__version===void 0||$e===!0,te=Ze.dataReady,Se=$(he,Pt);if(he.isDepthTexture)nt=k(he.format===U0,he.type),ee&&(re?i.texStorage2D(t.TEXTURE_2D,1,nt,Pt.width,Pt.height):i.texImage2D(t.TEXTURE_2D,0,nt,Pt.width,Pt.height,0,ni,ti,null));else if(he.isDataTexture)if(oe.length>0){re&&ee&&i.texStorage2D(t.TEXTURE_2D,Se,nt,oe[0].width,oe[0].height);for(let ve=0,Ae=oe.length;ve<Ae;ve++)Ce=oe[ve],re?te&&i.texSubImage2D(t.TEXTURE_2D,ve,0,0,Ce.width,Ce.height,ni,ti,Ce.data):i.texImage2D(t.TEXTURE_2D,ve,nt,Ce.width,Ce.height,0,ni,ti,Ce.data);he.generateMipmaps=!1}else re?(ee&&i.texStorage2D(t.TEXTURE_2D,Se,nt,Pt.width,Pt.height),te&&i.texSubImage2D(t.TEXTURE_2D,0,0,0,Pt.width,Pt.height,ni,ti,Pt.data)):i.texImage2D(t.TEXTURE_2D,0,nt,Pt.width,Pt.height,0,ni,ti,Pt.data);else if(he.isCompressedTexture)if(he.isCompressedArrayTexture){re&&ee&&i.texStorage3D(t.TEXTURE_2D_ARRAY,Se,nt,oe[0].width,oe[0].height,Pt.depth);for(let ve=0,Ae=oe.length;ve<Ae;ve++)if(Ce=oe[ve],he.format!==za)if(ni!==null)if(re){if(te)if(he.layerUpdates.size>0){const ke=DV(Ce.width,Ce.height,he.format,he.type);for(const Xe of he.layerUpdates){const ut=Ce.data.subarray(Xe*ke/Ce.data.BYTES_PER_ELEMENT,(Xe+1)*ke/Ce.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,ve,0,0,Xe,Ce.width,Ce.height,1,ni,ut)}he.clearLayerUpdates()}else i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,ve,0,0,0,Ce.width,Ce.height,Pt.depth,ni,Ce.data)}else i.compressedTexImage3D(t.TEXTURE_2D_ARRAY,ve,nt,Ce.width,Ce.height,Pt.depth,0,Ce.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else re?te&&i.texSubImage3D(t.TEXTURE_2D_ARRAY,ve,0,0,0,Ce.width,Ce.height,Pt.depth,ni,ti,Ce.data):i.texImage3D(t.TEXTURE_2D_ARRAY,ve,nt,Ce.width,Ce.height,Pt.depth,0,ni,ti,Ce.data)}else{re&&ee&&i.texStorage2D(t.TEXTURE_2D,Se,nt,oe[0].width,oe[0].height);for(let ve=0,Ae=oe.length;ve<Ae;ve++)Ce=oe[ve],he.format!==za?ni!==null?re?te&&i.compressedTexSubImage2D(t.TEXTURE_2D,ve,0,0,Ce.width,Ce.height,ni,Ce.data):i.compressedTexImage2D(t.TEXTURE_2D,ve,nt,Ce.width,Ce.height,0,Ce.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):re?te&&i.texSubImage2D(t.TEXTURE_2D,ve,0,0,Ce.width,Ce.height,ni,ti,Ce.data):i.texImage2D(t.TEXTURE_2D,ve,nt,Ce.width,Ce.height,0,ni,ti,Ce.data)}else if(he.isDataArrayTexture)if(re){if(ee&&i.texStorage3D(t.TEXTURE_2D_ARRAY,Se,nt,Pt.width,Pt.height,Pt.depth),te)if(he.layerUpdates.size>0){const ve=DV(Pt.width,Pt.height,he.format,he.type);for(const Ae of he.layerUpdates){const ke=Pt.data.subarray(Ae*ve/Pt.data.BYTES_PER_ELEMENT,(Ae+1)*ve/Pt.data.BYTES_PER_ELEMENT);i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,Ae,Pt.width,Pt.height,1,ni,ti,ke)}he.clearLayerUpdates()}else i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,Pt.width,Pt.height,Pt.depth,ni,ti,Pt.data)}else i.texImage3D(t.TEXTURE_2D_ARRAY,0,nt,Pt.width,Pt.height,Pt.depth,0,ni,ti,Pt.data);else if(he.isData3DTexture)re?(ee&&i.texStorage3D(t.TEXTURE_3D,Se,nt,Pt.width,Pt.height,Pt.depth),te&&i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,Pt.width,Pt.height,Pt.depth,ni,ti,Pt.data)):i.texImage3D(t.TEXTURE_3D,0,nt,Pt.width,Pt.height,Pt.depth,0,ni,ti,Pt.data);else if(he.isFramebufferTexture){if(ee)if(re)i.texStorage2D(t.TEXTURE_2D,Se,nt,Pt.width,Pt.height);else{let ve=Pt.width,Ae=Pt.height;for(let ke=0;ke<Se;ke++)i.texImage2D(t.TEXTURE_2D,ke,nt,ve,Ae,0,ni,ti,null),ve>>=1,Ae>>=1}}else if(oe.length>0){if(re&&ee){const ve=st(oe[0]);i.texStorage2D(t.TEXTURE_2D,Se,nt,ve.width,ve.height)}for(let ve=0,Ae=oe.length;ve<Ae;ve++)Ce=oe[ve],re?te&&i.texSubImage2D(t.TEXTURE_2D,ve,0,0,ni,ti,Ce):i.texImage2D(t.TEXTURE_2D,ve,nt,ni,ti,Ce);he.generateMipmaps=!1}else if(re){if(ee){const ve=st(Pt);i.texStorage2D(t.TEXTURE_2D,Se,nt,ve.width,ve.height)}te&&i.texSubImage2D(t.TEXTURE_2D,0,0,0,ni,ti,Pt)}else i.texImage2D(t.TEXTURE_2D,0,nt,ni,ti,Pt);O(he)&&P(Be),Lt.__version=Ze.version,he.onUpdate&&he.onUpdate(he)}we.__version=he.version}function Je(we,he,xe){if(he.image.length!==6)return;const Be=ct(we,he),$e=he.source;i.bindTexture(t.TEXTURE_CUBE_MAP,we.__webglTexture,t.TEXTURE0+xe);const Ze=n.get($e);if($e.version!==Ze.__version||Be===!0){i.activeTexture(t.TEXTURE0+xe);const Lt=Xn.getPrimaries(Xn.workingColorSpace),ot=he.colorSpace===_d?null:Xn.getPrimaries(he.colorSpace),Nt=he.colorSpace===_d||Lt===ot?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,he.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,he.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,he.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Nt);const fi=he.isCompressedTexture||he.image[0].isCompressedTexture,Pt=he.image[0]&&he.image[0].isDataTexture,ni=[];for(let Ae=0;Ae<6;Ae++)!fi&&!Pt?ni[Ae]=R(he.image[Ae],!0,r.maxCubemapSize):ni[Ae]=Pt?he.image[Ae].image:he.image[Ae],ni[Ae]=Ct(he,ni[Ae]);const ti=ni[0],nt=s.convert(he.format,he.colorSpace),Ce=s.convert(he.type),oe=F(he.internalFormat,nt,Ce,he.colorSpace),re=he.isVideoTexture!==!0,ee=Ze.__version===void 0||Be===!0,te=$e.dataReady;let Se=$(he,ti);qe(t.TEXTURE_CUBE_MAP,he);let ve;if(fi){re&&ee&&i.texStorage2D(t.TEXTURE_CUBE_MAP,Se,oe,ti.width,ti.height);for(let Ae=0;Ae<6;Ae++){ve=ni[Ae].mipmaps;for(let ke=0;ke<ve.length;ke++){const Xe=ve[ke];he.format!==za?nt!==null?re?te&&i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,ke,0,0,Xe.width,Xe.height,nt,Xe.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,ke,oe,Xe.width,Xe.height,0,Xe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):re?te&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,ke,0,0,Xe.width,Xe.height,nt,Ce,Xe.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,ke,oe,Xe.width,Xe.height,0,nt,Ce,Xe.data)}}}else{if(ve=he.mipmaps,re&&ee){ve.length>0&&Se++;const Ae=st(ni[0]);i.texStorage2D(t.TEXTURE_CUBE_MAP,Se,oe,Ae.width,Ae.height)}for(let Ae=0;Ae<6;Ae++)if(Pt){re?te&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,0,0,0,ni[Ae].width,ni[Ae].height,nt,Ce,ni[Ae].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,0,oe,ni[Ae].width,ni[Ae].height,0,nt,Ce,ni[Ae].data);for(let ke=0;ke<ve.length;ke++){const ut=ve[ke].image[Ae].image;re?te&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,ke+1,0,0,ut.width,ut.height,nt,Ce,ut.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,ke+1,oe,ut.width,ut.height,0,nt,Ce,ut.data)}}else{re?te&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,0,0,0,nt,Ce,ni[Ae]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,0,oe,nt,Ce,ni[Ae]);for(let ke=0;ke<ve.length;ke++){const Xe=ve[ke];re?te&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,ke+1,0,0,nt,Ce,Xe.image[Ae]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,ke+1,oe,nt,Ce,Xe.image[Ae])}}}O(he)&&P(t.TEXTURE_CUBE_MAP),Ze.__version=$e.version,he.onUpdate&&he.onUpdate(he)}we.__version=he.version}function mt(we,he,xe,Be,$e,Ze){const Lt=s.convert(xe.format,xe.colorSpace),ot=s.convert(xe.type),Nt=F(xe.internalFormat,Lt,ot,xe.colorSpace),fi=n.get(he),Pt=n.get(xe);if(Pt.__renderTarget=he,!fi.__hasExternalTextures){const ni=Math.max(1,he.width>>Ze),ti=Math.max(1,he.height>>Ze);$e===t.TEXTURE_3D||$e===t.TEXTURE_2D_ARRAY?i.texImage3D($e,Ze,Nt,ni,ti,he.depth,0,Lt,ot,null):i.texImage2D($e,Ze,Nt,ni,ti,0,Lt,ot,null)}i.bindFramebuffer(t.FRAMEBUFFER,we),Pe(he)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,Be,$e,Pt.__webglTexture,0,it(he)):($e===t.TEXTURE_2D||$e>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&$e<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,Be,$e,Pt.__webglTexture,Ze),i.bindFramebuffer(t.FRAMEBUFFER,null)}function wt(we,he,xe){if(t.bindRenderbuffer(t.RENDERBUFFER,we),he.depthBuffer){const Be=he.depthTexture,$e=Be&&Be.isDepthTexture?Be.type:null,Ze=k(he.stencilBuffer,$e),Lt=he.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,ot=it(he);Pe(he)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,ot,Ze,he.width,he.height):xe?t.renderbufferStorageMultisample(t.RENDERBUFFER,ot,Ze,he.width,he.height):t.renderbufferStorage(t.RENDERBUFFER,Ze,he.width,he.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,Lt,t.RENDERBUFFER,we)}else{const Be=he.textures;for(let $e=0;$e<Be.length;$e++){const Ze=Be[$e],Lt=s.convert(Ze.format,Ze.colorSpace),ot=s.convert(Ze.type),Nt=F(Ze.internalFormat,Lt,ot,Ze.colorSpace),fi=it(he);xe&&Pe(he)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,fi,Nt,he.width,he.height):Pe(he)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,fi,Nt,he.width,he.height):t.renderbufferStorage(t.RENDERBUFFER,Nt,he.width,he.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function Ot(we,he){if(he&&he.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,we),!(he.depthTexture&&he.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Be=n.get(he.depthTexture);Be.__renderTarget=he,(!Be.__webglTexture||he.depthTexture.image.width!==he.width||he.depthTexture.image.height!==he.height)&&(he.depthTexture.image.width=he.width,he.depthTexture.image.height=he.height,he.depthTexture.needsUpdate=!0),le(he.depthTexture,0);const $e=Be.__webglTexture,Ze=it(he);if(he.depthTexture.format===G0)Pe(he)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,$e,0,Ze):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,$e,0);else if(he.depthTexture.format===U0)Pe(he)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,$e,0,Ze):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,$e,0);else throw new Error("Unknown depthTexture format")}function Qt(we){const he=n.get(we),xe=we.isWebGLCubeRenderTarget===!0;if(he.__boundDepthTexture!==we.depthTexture){const Be=we.depthTexture;if(he.__depthDisposeCallback&&he.__depthDisposeCallback(),Be){const $e=()=>{delete he.__boundDepthTexture,delete he.__depthDisposeCallback,Be.removeEventListener("dispose",$e)};Be.addEventListener("dispose",$e),he.__depthDisposeCallback=$e}he.__boundDepthTexture=Be}if(we.depthTexture&&!he.__autoAllocateDepthBuffer){if(xe)throw new Error("target.depthTexture not supported in Cube render targets");Ot(he.__webglFramebuffer,we)}else if(xe){he.__webglDepthbuffer=[];for(let Be=0;Be<6;Be++)if(i.bindFramebuffer(t.FRAMEBUFFER,he.__webglFramebuffer[Be]),he.__webglDepthbuffer[Be]===void 0)he.__webglDepthbuffer[Be]=t.createRenderbuffer(),wt(he.__webglDepthbuffer[Be],we,!1);else{const $e=we.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Ze=he.__webglDepthbuffer[Be];t.bindRenderbuffer(t.RENDERBUFFER,Ze),t.framebufferRenderbuffer(t.FRAMEBUFFER,$e,t.RENDERBUFFER,Ze)}}else if(i.bindFramebuffer(t.FRAMEBUFFER,he.__webglFramebuffer),he.__webglDepthbuffer===void 0)he.__webglDepthbuffer=t.createRenderbuffer(),wt(he.__webglDepthbuffer,we,!1);else{const Be=we.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,$e=he.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,$e),t.framebufferRenderbuffer(t.FRAMEBUFFER,Be,t.RENDERBUFFER,$e)}i.bindFramebuffer(t.FRAMEBUFFER,null)}function ei(we,he,xe){const Be=n.get(we);he!==void 0&&mt(Be.__webglFramebuffer,we,we.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),xe!==void 0&&Qt(we)}function Jt(we){const he=we.texture,xe=n.get(we),Be=n.get(he);we.addEventListener("dispose",Q);const $e=we.textures,Ze=we.isWebGLCubeRenderTarget===!0,Lt=$e.length>1;if(Lt||(Be.__webglTexture===void 0&&(Be.__webglTexture=t.createTexture()),Be.__version=he.version,o.memory.textures++),Ze){xe.__webglFramebuffer=[];for(let ot=0;ot<6;ot++)if(he.mipmaps&&he.mipmaps.length>0){xe.__webglFramebuffer[ot]=[];for(let Nt=0;Nt<he.mipmaps.length;Nt++)xe.__webglFramebuffer[ot][Nt]=t.createFramebuffer()}else xe.__webglFramebuffer[ot]=t.createFramebuffer()}else{if(he.mipmaps&&he.mipmaps.length>0){xe.__webglFramebuffer=[];for(let ot=0;ot<he.mipmaps.length;ot++)xe.__webglFramebuffer[ot]=t.createFramebuffer()}else xe.__webglFramebuffer=t.createFramebuffer();if(Lt)for(let ot=0,Nt=$e.length;ot<Nt;ot++){const fi=n.get($e[ot]);fi.__webglTexture===void 0&&(fi.__webglTexture=t.createTexture(),o.memory.textures++)}if(we.samples>0&&Pe(we)===!1){xe.__webglMultisampledFramebuffer=t.createFramebuffer(),xe.__webglColorRenderbuffer=[],i.bindFramebuffer(t.FRAMEBUFFER,xe.__webglMultisampledFramebuffer);for(let ot=0;ot<$e.length;ot++){const Nt=$e[ot];xe.__webglColorRenderbuffer[ot]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,xe.__webglColorRenderbuffer[ot]);const fi=s.convert(Nt.format,Nt.colorSpace),Pt=s.convert(Nt.type),ni=F(Nt.internalFormat,fi,Pt,Nt.colorSpace,we.isXRRenderTarget===!0),ti=it(we);t.renderbufferStorageMultisample(t.RENDERBUFFER,ti,ni,we.width,we.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+ot,t.RENDERBUFFER,xe.__webglColorRenderbuffer[ot])}t.bindRenderbuffer(t.RENDERBUFFER,null),we.depthBuffer&&(xe.__webglDepthRenderbuffer=t.createRenderbuffer(),wt(xe.__webglDepthRenderbuffer,we,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}}if(Ze){i.bindTexture(t.TEXTURE_CUBE_MAP,Be.__webglTexture),qe(t.TEXTURE_CUBE_MAP,he);for(let ot=0;ot<6;ot++)if(he.mipmaps&&he.mipmaps.length>0)for(let Nt=0;Nt<he.mipmaps.length;Nt++)mt(xe.__webglFramebuffer[ot][Nt],we,he,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+ot,Nt);else mt(xe.__webglFramebuffer[ot],we,he,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+ot,0);O(he)&&P(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(Lt){for(let ot=0,Nt=$e.length;ot<Nt;ot++){const fi=$e[ot],Pt=n.get(fi);i.bindTexture(t.TEXTURE_2D,Pt.__webglTexture),qe(t.TEXTURE_2D,fi),mt(xe.__webglFramebuffer,we,fi,t.COLOR_ATTACHMENT0+ot,t.TEXTURE_2D,0),O(fi)&&P(t.TEXTURE_2D)}i.unbindTexture()}else{let ot=t.TEXTURE_2D;if((we.isWebGL3DRenderTarget||we.isWebGLArrayRenderTarget)&&(ot=we.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),i.bindTexture(ot,Be.__webglTexture),qe(ot,he),he.mipmaps&&he.mipmaps.length>0)for(let Nt=0;Nt<he.mipmaps.length;Nt++)mt(xe.__webglFramebuffer[Nt],we,he,t.COLOR_ATTACHMENT0,ot,Nt);else mt(xe.__webglFramebuffer,we,he,t.COLOR_ATTACHMENT0,ot,0);O(he)&&P(ot),i.unbindTexture()}we.depthBuffer&&Qt(we)}function Yt(we){const he=we.textures;for(let xe=0,Be=he.length;xe<Be;xe++){const $e=he[xe];if(O($e)){const Ze=N(we),Lt=n.get($e).__webglTexture;i.bindTexture(Ze,Lt),P(Ze),i.unbindTexture()}}}const Ut=[],Re=[];function gi(we){if(we.samples>0){if(Pe(we)===!1){const he=we.textures,xe=we.width,Be=we.height;let $e=t.COLOR_BUFFER_BIT;const Ze=we.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Lt=n.get(we),ot=he.length>1;if(ot)for(let Nt=0;Nt<he.length;Nt++)i.bindFramebuffer(t.FRAMEBUFFER,Lt.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Nt,t.RENDERBUFFER,null),i.bindFramebuffer(t.FRAMEBUFFER,Lt.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Nt,t.TEXTURE_2D,null,0);i.bindFramebuffer(t.READ_FRAMEBUFFER,Lt.__webglMultisampledFramebuffer),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,Lt.__webglFramebuffer);for(let Nt=0;Nt<he.length;Nt++){if(we.resolveDepthBuffer&&(we.depthBuffer&&($e|=t.DEPTH_BUFFER_BIT),we.stencilBuffer&&we.resolveStencilBuffer&&($e|=t.STENCIL_BUFFER_BIT)),ot){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,Lt.__webglColorRenderbuffer[Nt]);const fi=n.get(he[Nt]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,fi,0)}t.blitFramebuffer(0,0,xe,Be,0,0,xe,Be,$e,t.NEAREST),l===!0&&(Ut.length=0,Re.length=0,Ut.push(t.COLOR_ATTACHMENT0+Nt),we.depthBuffer&&we.resolveDepthBuffer===!1&&(Ut.push(Ze),Re.push(Ze),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,Re)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,Ut))}if(i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),ot)for(let Nt=0;Nt<he.length;Nt++){i.bindFramebuffer(t.FRAMEBUFFER,Lt.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Nt,t.RENDERBUFFER,Lt.__webglColorRenderbuffer[Nt]);const fi=n.get(he[Nt]).__webglTexture;i.bindFramebuffer(t.FRAMEBUFFER,Lt.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Nt,t.TEXTURE_2D,fi,0)}i.bindFramebuffer(t.DRAW_FRAMEBUFFER,Lt.__webglMultisampledFramebuffer)}else if(we.depthBuffer&&we.resolveDepthBuffer===!1&&l){const he=we.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[he])}}}function it(we){return Math.min(r.maxSamples,we.samples)}function Pe(we){const he=n.get(we);return we.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&he.__useRenderToTexture!==!1}function Ye(we){const he=o.render.frame;d.get(we)!==he&&(d.set(we,he),we.update())}function Ct(we,he){const xe=we.colorSpace,Be=we.format,$e=we.type;return we.isCompressedTexture===!0||we.isVideoTexture===!0||xe!==ma&&xe!==_d&&(Xn.getTransfer(xe)===Or?(Be!==za||$e!==Dh)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",xe)),he}function st(we){return typeof HTMLImageElement<"u"&&we instanceof HTMLImageElement?(u.width=we.naturalWidth||we.width,u.height=we.naturalHeight||we.height):typeof VideoFrame<"u"&&we instanceof VideoFrame?(u.width=we.displayWidth,u.height=we.displayHeight):(u.width=we.width,u.height=we.height),u}this.allocateTextureUnit=Z,this.resetTextureUnits=j,this.setTexture2D=le,this.setTexture2DArray=me,this.setTexture3D=be,this.setTextureCube=fe,this.rebindTextures=ei,this.setupRenderTarget=Jt,this.updateRenderTargetMipmap=Yt,this.updateMultisampleRenderTarget=gi,this.setupDepthRenderbuffer=Qt,this.setupFrameBufferTexture=mt,this.useMultisampledRTT=Pe}function xse(t,e){function i(n,r=_d){let s;const o=Xn.getTransfer(r);if(n===Dh)return t.UNSIGNED_BYTE;if(n===aL)return t.UNSIGNED_SHORT_4_4_4_4;if(n===lL)return t.UNSIGNED_SHORT_5_5_5_1;if(n===kH)return t.UNSIGNED_INT_5_9_9_9_REV;if(n===AH)return t.BYTE;if(n===IH)return t.SHORT;if(n===z0)return t.UNSIGNED_SHORT;if(n===oL)return t.INT;if(n===Kd)return t.UNSIGNED_INT;if(n===gl)return t.FLOAT;if(n===mx)return t.HALF_FLOAT;if(n===DH)return t.ALPHA;if(n===LH)return t.RGB;if(n===za)return t.RGBA;if(n===FH)return t.LUMINANCE;if(n===NH)return t.LUMINANCE_ALPHA;if(n===G0)return t.DEPTH_COMPONENT;if(n===U0)return t.DEPTH_STENCIL;if(n===cL)return t.RED;if(n===JC)return t.RED_INTEGER;if(n===BH)return t.RG;if(n===uL)return t.RG_INTEGER;if(n===hL)return t.RGBA_INTEGER;if(n===u_||n===h_||n===d_||n===f_)if(o===Or)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===u_)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===h_)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===d_)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===f_)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===u_)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===h_)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===d_)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===f_)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===vR||n===yR||n===xR||n===bR)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===vR)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===yR)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===xR)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===bR)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===wR||n===_R||n===CR)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(n===wR||n===_R)return o===Or?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===CR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===SR||n===OR||n===MR||n===TR||n===RR||n===PR||n===ER||n===AR||n===IR||n===kR||n===DR||n===LR||n===FR||n===NR)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(n===SR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===OR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===MR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===TR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===RR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===PR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===ER)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===AR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===IR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===kR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===DR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===LR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===FR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===NR)return o===Or?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===p_||n===BR||n===zR)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(n===p_)return o===Or?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===BR)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===zR)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===zH||n===VR||n===GR||n===UR)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(n===p_)return s.COMPRESSED_RED_RGTC1_EXT;if(n===VR)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===GR)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===UR)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===V0?t.UNSIGNED_INT_24_8:t[n]!==void 0?t[n]:null}return{convert:i}}const Xet=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Ket=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Yet{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,i,n){if(this.texture===null){const r=new ds,s=e.properties.get(r);s.__webglTexture=i.texture,(i.depthNear!==n.depthNear||i.depthFar!==n.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const i=e.cameras[0].viewport,n=new Qc({vertexShader:Xet,fragmentShader:Ket,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new us(new vx(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Jet extends Uh{constructor(e,i){super();const n=this;let r=null,s=1,o=null,a="local-floor",l=1,u=null,d=null,p=null,v=null,y=null,w=null;const R=new Yet,O=i.getContextAttributes();let P=null,N=null;const F=[],k=[],$=new Xt;let W=null;const Q=new ho;Q.viewport=new Mn;const Y=new ho;Y.viewport=new Mn;const M=[Q,Y],D=new ase;let G=null,j=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Ge){let Je=F[Ge];return Je===void 0&&(Je=new VM,F[Ge]=Je),Je.getTargetRaySpace()},this.getControllerGrip=function(Ge){let Je=F[Ge];return Je===void 0&&(Je=new VM,F[Ge]=Je),Je.getGripSpace()},this.getHand=function(Ge){let Je=F[Ge];return Je===void 0&&(Je=new VM,F[Ge]=Je),Je.getHandSpace()};function Z(Ge){const Je=k.indexOf(Ge.inputSource);if(Je===-1)return;const mt=F[Je];mt!==void 0&&(mt.update(Ge.inputSource,Ge.frame,u||o),mt.dispatchEvent({type:Ge.type,data:Ge.inputSource}))}function ie(){r.removeEventListener("select",Z),r.removeEventListener("selectstart",Z),r.removeEventListener("selectend",Z),r.removeEventListener("squeeze",Z),r.removeEventListener("squeezestart",Z),r.removeEventListener("squeezeend",Z),r.removeEventListener("end",ie),r.removeEventListener("inputsourceschange",le);for(let Ge=0;Ge<F.length;Ge++){const Je=k[Ge];Je!==null&&(k[Ge]=null,F[Ge].disconnect(Je))}G=null,j=null,R.reset(),e.setRenderTarget(P),y=null,v=null,p=null,r=null,N=null,ct.stop(),n.isPresenting=!1,e.setPixelRatio(W),e.setSize($.width,$.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Ge){s=Ge,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Ge){a=Ge,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||o},this.setReferenceSpace=function(Ge){u=Ge},this.getBaseLayer=function(){return v!==null?v:y},this.getBinding=function(){return p},this.getFrame=function(){return w},this.getSession=function(){return r},this.setSession=async function(Ge){if(r=Ge,r!==null){if(P=e.getRenderTarget(),r.addEventListener("select",Z),r.addEventListener("selectstart",Z),r.addEventListener("selectend",Z),r.addEventListener("squeeze",Z),r.addEventListener("squeezestart",Z),r.addEventListener("squeezeend",Z),r.addEventListener("end",ie),r.addEventListener("inputsourceschange",le),O.xrCompatible!==!0&&await i.makeXRCompatible(),W=e.getPixelRatio(),e.getSize($),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let mt=null,wt=null,Ot=null;O.depth&&(Ot=O.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,mt=O.stencil?U0:G0,wt=O.stencil?V0:Kd);const Qt={colorFormat:i.RGBA8,depthFormat:Ot,scaleFactor:s};p=new XRWebGLBinding(r,i),v=p.createProjectionLayer(Qt),r.updateRenderState({layers:[v]}),e.setPixelRatio(1),e.setSize(v.textureWidth,v.textureHeight,!1),N=new Lh(v.textureWidth,v.textureHeight,{format:za,type:Dh,depthTexture:new YH(v.textureWidth,v.textureHeight,wt,void 0,void 0,void 0,void 0,void 0,void 0,mt),stencilBuffer:O.stencil,colorSpace:e.outputColorSpace,samples:O.antialias?4:0,resolveDepthBuffer:v.ignoreDepthValues===!1,resolveStencilBuffer:v.ignoreDepthValues===!1})}else{const mt={antialias:O.antialias,alpha:!0,depth:O.depth,stencil:O.stencil,framebufferScaleFactor:s};y=new XRWebGLLayer(r,i,mt),r.updateRenderState({baseLayer:y}),e.setPixelRatio(1),e.setSize(y.framebufferWidth,y.framebufferHeight,!1),N=new Lh(y.framebufferWidth,y.framebufferHeight,{format:za,type:Dh,colorSpace:e.outputColorSpace,stencilBuffer:O.stencil,resolveDepthBuffer:y.ignoreDepthValues===!1,resolveStencilBuffer:y.ignoreDepthValues===!1})}N.isXRRenderTarget=!0,this.setFoveation(l),u=null,o=await r.requestReferenceSpace(a),ct.setContext(r),ct.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return R.getDepthTexture()};function le(Ge){for(let Je=0;Je<Ge.removed.length;Je++){const mt=Ge.removed[Je],wt=k.indexOf(mt);wt>=0&&(k[wt]=null,F[wt].disconnect(mt))}for(let Je=0;Je<Ge.added.length;Je++){const mt=Ge.added[Je];let wt=k.indexOf(mt);if(wt===-1){for(let Qt=0;Qt<F.length;Qt++)if(Qt>=k.length){k.push(mt),wt=Qt;break}else if(k[Qt]===null){k[Qt]=mt,wt=Qt;break}if(wt===-1)break}const Ot=F[wt];Ot&&Ot.connect(mt)}}const me=new Ie,be=new Ie;function fe(Ge,Je,mt){me.setFromMatrixPosition(Je.matrixWorld),be.setFromMatrixPosition(mt.matrixWorld);const wt=me.distanceTo(be),Ot=Je.projectionMatrix.elements,Qt=mt.projectionMatrix.elements,ei=Ot[14]/(Ot[10]-1),Jt=Ot[14]/(Ot[10]+1),Yt=(Ot[9]+1)/Ot[5],Ut=(Ot[9]-1)/Ot[5],Re=(Ot[8]-1)/Ot[0],gi=(Qt[8]+1)/Qt[0],it=ei*Re,Pe=ei*gi,Ye=wt/(-Re+gi),Ct=Ye*-Re;if(Je.matrixWorld.decompose(Ge.position,Ge.quaternion,Ge.scale),Ge.translateX(Ct),Ge.translateZ(Ye),Ge.matrixWorld.compose(Ge.position,Ge.quaternion,Ge.scale),Ge.matrixWorldInverse.copy(Ge.matrixWorld).invert(),Ot[10]===-1)Ge.projectionMatrix.copy(Je.projectionMatrix),Ge.projectionMatrixInverse.copy(Je.projectionMatrixInverse);else{const st=ei+Ye,we=Jt+Ye,he=it-Ct,xe=Pe+(wt-Ct),Be=Yt*Jt/we*st,$e=Ut*Jt/we*st;Ge.projectionMatrix.makePerspective(he,xe,Be,$e,st,we),Ge.projectionMatrixInverse.copy(Ge.projectionMatrix).invert()}}function Fe(Ge,Je){Je===null?Ge.matrixWorld.copy(Ge.matrix):Ge.matrixWorld.multiplyMatrices(Je.matrixWorld,Ge.matrix),Ge.matrixWorldInverse.copy(Ge.matrixWorld).invert()}this.updateCamera=function(Ge){if(r===null)return;let Je=Ge.near,mt=Ge.far;R.texture!==null&&(R.depthNear>0&&(Je=R.depthNear),R.depthFar>0&&(mt=R.depthFar)),D.near=Y.near=Q.near=Je,D.far=Y.far=Q.far=mt,(G!==D.near||j!==D.far)&&(r.updateRenderState({depthNear:D.near,depthFar:D.far}),G=D.near,j=D.far),Q.layers.mask=Ge.layers.mask|2,Y.layers.mask=Ge.layers.mask|4,D.layers.mask=Q.layers.mask|Y.layers.mask;const wt=Ge.parent,Ot=D.cameras;Fe(D,wt);for(let Qt=0;Qt<Ot.length;Qt++)Fe(Ot[Qt],wt);Ot.length===2?fe(D,Q,Y):D.projectionMatrix.copy(Q.projectionMatrix),He(Ge,D,wt)};function He(Ge,Je,mt){mt===null?Ge.matrix.copy(Je.matrixWorld):(Ge.matrix.copy(mt.matrixWorld),Ge.matrix.invert(),Ge.matrix.multiply(Je.matrixWorld)),Ge.matrix.decompose(Ge.position,Ge.quaternion,Ge.scale),Ge.updateMatrixWorld(!0),Ge.projectionMatrix.copy(Je.projectionMatrix),Ge.projectionMatrixInverse.copy(Je.projectionMatrixInverse),Ge.isPerspectiveCamera&&(Ge.fov=W0*2*Math.atan(1/Ge.projectionMatrix.elements[5]),Ge.zoom=1)}this.getCamera=function(){return D},this.getFoveation=function(){if(!(v===null&&y===null))return l},this.setFoveation=function(Ge){l=Ge,v!==null&&(v.fixedFoveation=Ge),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=Ge)},this.hasDepthSensing=function(){return R.texture!==null},this.getDepthSensingMesh=function(){return R.getMesh(D)};let je=null;function qe(Ge,Je){if(d=Je.getViewerPose(u||o),w=Je,d!==null){const mt=d.views;y!==null&&(e.setRenderTargetFramebuffer(N,y.framebuffer),e.setRenderTarget(N));let wt=!1;mt.length!==D.cameras.length&&(D.cameras.length=0,wt=!0);for(let ei=0;ei<mt.length;ei++){const Jt=mt[ei];let Yt=null;if(y!==null)Yt=y.getViewport(Jt);else{const Re=p.getViewSubImage(v,Jt);Yt=Re.viewport,ei===0&&(e.setRenderTargetTextures(N,Re.colorTexture,Re.depthStencilTexture),e.setRenderTarget(N))}let Ut=M[ei];Ut===void 0&&(Ut=new ho,Ut.layers.enable(ei),Ut.viewport=new Mn,M[ei]=Ut),Ut.matrix.fromArray(Jt.transform.matrix),Ut.matrix.decompose(Ut.position,Ut.quaternion,Ut.scale),Ut.projectionMatrix.fromArray(Jt.projectionMatrix),Ut.projectionMatrixInverse.copy(Ut.projectionMatrix).invert(),Ut.viewport.set(Yt.x,Yt.y,Yt.width,Yt.height),ei===0&&(D.matrix.copy(Ut.matrix),D.matrix.decompose(D.position,D.quaternion,D.scale)),wt===!0&&D.cameras.push(Ut)}const Ot=r.enabledFeatures;if(Ot&&Ot.includes("depth-sensing")&&r.depthUsage=="gpu-optimized"&&p){const ei=p.getDepthInformation(mt[0]);ei&&ei.isValid&&ei.texture&&R.init(e,ei,r.renderState)}}for(let mt=0;mt<F.length;mt++){const wt=k[mt],Ot=F[mt];wt!==null&&Ot!==void 0&&Ot.update(wt,Je,u||o)}je&&je(Ge,Je),Je.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Je}),w=null}const ct=new pse;ct.setAnimationLoop(qe),this.setAnimationLoop=function(Ge){je=Ge},this.dispose=function(){}}}const Dm=new sc,ett=new sn;function ttt(t,e){function i(O,P){O.matrixAutoUpdate===!0&&O.updateMatrix(),P.value.copy(O.matrix)}function n(O,P){P.color.getRGB(O.fogColor.value,Cre(t)),P.isFog?(O.fogNear.value=P.near,O.fogFar.value=P.far):P.isFogExp2&&(O.fogDensity.value=P.density)}function r(O,P,N,F,k){P.isMeshBasicMaterial||P.isMeshLambertMaterial?s(O,P):P.isMeshToonMaterial?(s(O,P),p(O,P)):P.isMeshPhongMaterial?(s(O,P),d(O,P)):P.isMeshStandardMaterial?(s(O,P),v(O,P),P.isMeshPhysicalMaterial&&y(O,P,k)):P.isMeshMatcapMaterial?(s(O,P),w(O,P)):P.isMeshDepthMaterial?s(O,P):P.isMeshDistanceMaterial?(s(O,P),R(O,P)):P.isMeshNormalMaterial?s(O,P):P.isLineBasicMaterial?(o(O,P),P.isLineDashedMaterial&&a(O,P)):P.isPointsMaterial?l(O,P,N,F):P.isSpriteMaterial?u(O,P):P.isShadowMaterial?(O.color.value.copy(P.color),O.opacity.value=P.opacity):P.isShaderMaterial&&(P.uniformsNeedUpdate=!1)}function s(O,P){O.opacity.value=P.opacity,P.color&&O.diffuse.value.copy(P.color),P.emissive&&O.emissive.value.copy(P.emissive).multiplyScalar(P.emissiveIntensity),P.map&&(O.map.value=P.map,i(P.map,O.mapTransform)),P.alphaMap&&(O.alphaMap.value=P.alphaMap,i(P.alphaMap,O.alphaMapTransform)),P.bumpMap&&(O.bumpMap.value=P.bumpMap,i(P.bumpMap,O.bumpMapTransform),O.bumpScale.value=P.bumpScale,P.side===Ha&&(O.bumpScale.value*=-1)),P.normalMap&&(O.normalMap.value=P.normalMap,i(P.normalMap,O.normalMapTransform),O.normalScale.value.copy(P.normalScale),P.side===Ha&&O.normalScale.value.negate()),P.displacementMap&&(O.displacementMap.value=P.displacementMap,i(P.displacementMap,O.displacementMapTransform),O.displacementScale.value=P.displacementScale,O.displacementBias.value=P.displacementBias),P.emissiveMap&&(O.emissiveMap.value=P.emissiveMap,i(P.emissiveMap,O.emissiveMapTransform)),P.specularMap&&(O.specularMap.value=P.specularMap,i(P.specularMap,O.specularMapTransform)),P.alphaTest>0&&(O.alphaTest.value=P.alphaTest);const N=e.get(P),F=N.envMap,k=N.envMapRotation;F&&(O.envMap.value=F,Dm.copy(k),Dm.x*=-1,Dm.y*=-1,Dm.z*=-1,F.isCubeTexture&&F.isRenderTargetTexture===!1&&(Dm.y*=-1,Dm.z*=-1),O.envMapRotation.value.setFromMatrix4(ett.makeRotationFromEuler(Dm)),O.flipEnvMap.value=F.isCubeTexture&&F.isRenderTargetTexture===!1?-1:1,O.reflectivity.value=P.reflectivity,O.ior.value=P.ior,O.refractionRatio.value=P.refractionRatio),P.lightMap&&(O.lightMap.value=P.lightMap,O.lightMapIntensity.value=P.lightMapIntensity,i(P.lightMap,O.lightMapTransform)),P.aoMap&&(O.aoMap.value=P.aoMap,O.aoMapIntensity.value=P.aoMapIntensity,i(P.aoMap,O.aoMapTransform))}function o(O,P){O.diffuse.value.copy(P.color),O.opacity.value=P.opacity,P.map&&(O.map.value=P.map,i(P.map,O.mapTransform))}function a(O,P){O.dashSize.value=P.dashSize,O.totalSize.value=P.dashSize+P.gapSize,O.scale.value=P.scale}function l(O,P,N,F){O.diffuse.value.copy(P.color),O.opacity.value=P.opacity,O.size.value=P.size*N,O.scale.value=F*.5,P.map&&(O.map.value=P.map,i(P.map,O.uvTransform)),P.alphaMap&&(O.alphaMap.value=P.alphaMap,i(P.alphaMap,O.alphaMapTransform)),P.alphaTest>0&&(O.alphaTest.value=P.alphaTest)}function u(O,P){O.diffuse.value.copy(P.color),O.opacity.value=P.opacity,O.rotation.value=P.rotation,P.map&&(O.map.value=P.map,i(P.map,O.mapTransform)),P.alphaMap&&(O.alphaMap.value=P.alphaMap,i(P.alphaMap,O.alphaMapTransform)),P.alphaTest>0&&(O.alphaTest.value=P.alphaTest)}function d(O,P){O.specular.value.copy(P.specular),O.shininess.value=Math.max(P.shininess,1e-4)}function p(O,P){P.gradientMap&&(O.gradientMap.value=P.gradientMap)}function v(O,P){O.metalness.value=P.metalness,P.metalnessMap&&(O.metalnessMap.value=P.metalnessMap,i(P.metalnessMap,O.metalnessMapTransform)),O.roughness.value=P.roughness,P.roughnessMap&&(O.roughnessMap.value=P.roughnessMap,i(P.roughnessMap,O.roughnessMapTransform)),P.envMap&&(O.envMapIntensity.value=P.envMapIntensity)}function y(O,P,N){O.ior.value=P.ior,P.sheen>0&&(O.sheenColor.value.copy(P.sheenColor).multiplyScalar(P.sheen),O.sheenRoughness.value=P.sheenRoughness,P.sheenColorMap&&(O.sheenColorMap.value=P.sheenColorMap,i(P.sheenColorMap,O.sheenColorMapTransform)),P.sheenRoughnessMap&&(O.sheenRoughnessMap.value=P.sheenRoughnessMap,i(P.sheenRoughnessMap,O.sheenRoughnessMapTransform))),P.clearcoat>0&&(O.clearcoat.value=P.clearcoat,O.clearcoatRoughness.value=P.clearcoatRoughness,P.clearcoatMap&&(O.clearcoatMap.value=P.clearcoatMap,i(P.clearcoatMap,O.clearcoatMapTransform)),P.clearcoatRoughnessMap&&(O.clearcoatRoughnessMap.value=P.clearcoatRoughnessMap,i(P.clearcoatRoughnessMap,O.clearcoatRoughnessMapTransform)),P.clearcoatNormalMap&&(O.clearcoatNormalMap.value=P.clearcoatNormalMap,i(P.clearcoatNormalMap,O.clearcoatNormalMapTransform),O.clearcoatNormalScale.value.copy(P.clearcoatNormalScale),P.side===Ha&&O.clearcoatNormalScale.value.negate())),P.dispersion>0&&(O.dispersion.value=P.dispersion),P.iridescence>0&&(O.iridescence.value=P.iridescence,O.iridescenceIOR.value=P.iridescenceIOR,O.iridescenceThicknessMinimum.value=P.iridescenceThicknessRange[0],O.iridescenceThicknessMaximum.value=P.iridescenceThicknessRange[1],P.iridescenceMap&&(O.iridescenceMap.value=P.iridescenceMap,i(P.iridescenceMap,O.iridescenceMapTransform)),P.iridescenceThicknessMap&&(O.iridescenceThicknessMap.value=P.iridescenceThicknessMap,i(P.iridescenceThicknessMap,O.iridescenceThicknessMapTransform))),P.transmission>0&&(O.transmission.value=P.transmission,O.transmissionSamplerMap.value=N.texture,O.transmissionSamplerSize.value.set(N.width,N.height),P.transmissionMap&&(O.transmissionMap.value=P.transmissionMap,i(P.transmissionMap,O.transmissionMapTransform)),O.thickness.value=P.thickness,P.thicknessMap&&(O.thicknessMap.value=P.thicknessMap,i(P.thicknessMap,O.thicknessMapTransform)),O.attenuationDistance.value=P.attenuationDistance,O.attenuationColor.value.copy(P.attenuationColor)),P.anisotropy>0&&(O.anisotropyVector.value.set(P.anisotropy*Math.cos(P.anisotropyRotation),P.anisotropy*Math.sin(P.anisotropyRotation)),P.anisotropyMap&&(O.anisotropyMap.value=P.anisotropyMap,i(P.anisotropyMap,O.anisotropyMapTransform))),O.specularIntensity.value=P.specularIntensity,O.specularColor.value.copy(P.specularColor),P.specularColorMap&&(O.specularColorMap.value=P.specularColorMap,i(P.specularColorMap,O.specularColorMapTransform)),P.specularIntensityMap&&(O.specularIntensityMap.value=P.specularIntensityMap,i(P.specularIntensityMap,O.specularIntensityMapTransform))}function w(O,P){P.matcap&&(O.matcap.value=P.matcap)}function R(O,P){const N=e.get(P).light;O.referencePosition.value.setFromMatrixPosition(N.matrixWorld),O.nearDistance.value=N.shadow.camera.near,O.farDistance.value=N.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function itt(t,e,i,n){let r={},s={},o=[];const a=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function l(N,F){const k=F.program;n.uniformBlockBinding(N,k)}function u(N,F){let k=r[N.id];k===void 0&&(w(N),k=d(N),r[N.id]=k,N.addEventListener("dispose",O));const $=F.program;n.updateUBOMapping(N,$);const W=e.render.frame;s[N.id]!==W&&(v(N),s[N.id]=W)}function d(N){const F=p();N.__bindingPointIndex=F;const k=t.createBuffer(),$=N.__size,W=N.usage;return t.bindBuffer(t.UNIFORM_BUFFER,k),t.bufferData(t.UNIFORM_BUFFER,$,W),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,F,k),k}function p(){for(let N=0;N<a;N++)if(o.indexOf(N)===-1)return o.push(N),N;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function v(N){const F=r[N.id],k=N.uniforms,$=N.__cache;t.bindBuffer(t.UNIFORM_BUFFER,F);for(let W=0,Q=k.length;W<Q;W++){const Y=Array.isArray(k[W])?k[W]:[k[W]];for(let M=0,D=Y.length;M<D;M++){const G=Y[M];if(y(G,W,M,$)===!0){const j=G.__offset,Z=Array.isArray(G.value)?G.value:[G.value];let ie=0;for(let le=0;le<Z.length;le++){const me=Z[le],be=R(me);typeof me=="number"||typeof me=="boolean"?(G.__data[0]=me,t.bufferSubData(t.UNIFORM_BUFFER,j+ie,G.__data)):me.isMatrix3?(G.__data[0]=me.elements[0],G.__data[1]=me.elements[1],G.__data[2]=me.elements[2],G.__data[3]=0,G.__data[4]=me.elements[3],G.__data[5]=me.elements[4],G.__data[6]=me.elements[5],G.__data[7]=0,G.__data[8]=me.elements[6],G.__data[9]=me.elements[7],G.__data[10]=me.elements[8],G.__data[11]=0):(me.toArray(G.__data,ie),ie+=be.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,j,G.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function y(N,F,k,$){const W=N.value,Q=F+"_"+k;if($[Q]===void 0)return typeof W=="number"||typeof W=="boolean"?$[Q]=W:$[Q]=W.clone(),!0;{const Y=$[Q];if(typeof W=="number"||typeof W=="boolean"){if(Y!==W)return $[Q]=W,!0}else if(Y.equals(W)===!1)return Y.copy(W),!0}return!1}function w(N){const F=N.uniforms;let k=0;const $=16;for(let Q=0,Y=F.length;Q<Y;Q++){const M=Array.isArray(F[Q])?F[Q]:[F[Q]];for(let D=0,G=M.length;D<G;D++){const j=M[D],Z=Array.isArray(j.value)?j.value:[j.value];for(let ie=0,le=Z.length;ie<le;ie++){const me=Z[ie],be=R(me),fe=k%$,Fe=fe%be.boundary,He=fe+Fe;k+=Fe,He!==0&&$-He<be.storage&&(k+=$-He),j.__data=new Float32Array(be.storage/Float32Array.BYTES_PER_ELEMENT),j.__offset=k,k+=be.storage}}}const W=k%$;return W>0&&(k+=$-W),N.__size=k,N.__cache={},this}function R(N){const F={boundary:0,storage:0};return typeof N=="number"||typeof N=="boolean"?(F.boundary=4,F.storage=4):N.isVector2?(F.boundary=8,F.storage=8):N.isVector3||N.isColor?(F.boundary=16,F.storage=12):N.isVector4?(F.boundary=16,F.storage=16):N.isMatrix3?(F.boundary=48,F.storage=48):N.isMatrix4?(F.boundary=64,F.storage=64):N.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",N),F}function O(N){const F=N.target;F.removeEventListener("dispose",O);const k=o.indexOf(F.__bindingPointIndex);o.splice(k,1),t.deleteBuffer(r[F.id]),delete r[F.id],delete s[F.id]}function P(){for(const N in r)t.deleteBuffer(r[N]);o=[],r={},s={}}return{bind:l,update:u,dispose:P}}class bse{constructor(e={}){const{canvas:i=bre(),context:n=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:d="default",failIfMajorPerformanceCaveat:p=!1,reverseDepthBuffer:v=!1}=e;this.isWebGLRenderer=!0;let y;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");y=n.getContextAttributes().alpha}else y=o;const w=new Uint32Array(4),R=new Int32Array(4);let O=null,P=null;const N=[],F=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Fd,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const k=this;let $=!1;this._outputColorSpace=co;let W=0,Q=0,Y=null,M=-1,D=null;const G=new Mn,j=new Mn;let Z=null;const ie=new Si(0);let le=0,me=i.width,be=i.height,fe=1,Fe=null,He=null;const je=new Mn(0,0,me,be),qe=new Mn(0,0,me,be);let ct=!1;const Ge=new sS;let Je=!1,mt=!1;const wt=new sn,Ot=new sn,Qt=new Ie,ei=new Mn,Jt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Yt=!1;function Ut(){return Y===null?fe:1}let Re=n;function gi(Oe,pt){return i.getContext(Oe,pt)}try{const Oe={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:d,failIfMajorPerformanceCaveat:p};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${nL}`),i.addEventListener("webglcontextlost",Ae,!1),i.addEventListener("webglcontextrestored",ke,!1),i.addEventListener("webglcontextcreationerror",Xe,!1),Re===null){const pt="webgl2";if(Re=gi(pt,Oe),Re===null)throw gi(pt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Oe){throw console.error("THREE.WebGLRenderer: "+Oe.message),Oe}let it,Pe,Ye,Ct,st,we,he,xe,Be,$e,Ze,Lt,ot,Nt,fi,Pt,ni,ti,nt,Ce,oe,re,ee,te;function Se(){it=new dJe(Re),it.init(),re=new xse(Re,it),Pe=new sJe(Re,it,e,re),Ye=new Qet(Re,it),Pe.reverseDepthBuffer&&v&&Ye.buffers.depth.setReversed(!0),Ct=new mJe(Re),st=new Let,we=new Zet(Re,it,Ye,st,Pe,re,Ct),he=new aJe(k),xe=new hJe(k),Be=new wXe(Re),ee=new nJe(Re,Be),$e=new fJe(Re,Be,Ct,ee),Ze=new vJe(Re,$e,Be,Ct),nt=new gJe(Re,Pe,we),Pt=new oJe(st),Lt=new Det(k,he,xe,it,Pe,ee,Pt),ot=new ttt(k,st),Nt=new Net,fi=new Het(it),ti=new iJe(k,he,xe,Ye,Ze,y,l),ni=new qet(k,Ze,Pe),te=new itt(Re,Ct,Pe,Ye),Ce=new rJe(Re,it,Ct),oe=new pJe(Re,it,Ct),Ct.programs=Lt.programs,k.capabilities=Pe,k.extensions=it,k.properties=st,k.renderLists=Nt,k.shadowMap=ni,k.state=Ye,k.info=Ct}Se();const ve=new Jet(k,Re);this.xr=ve,this.getContext=function(){return Re},this.getContextAttributes=function(){return Re.getContextAttributes()},this.forceContextLoss=function(){const Oe=it.get("WEBGL_lose_context");Oe&&Oe.loseContext()},this.forceContextRestore=function(){const Oe=it.get("WEBGL_lose_context");Oe&&Oe.restoreContext()},this.getPixelRatio=function(){return fe},this.setPixelRatio=function(Oe){Oe!==void 0&&(fe=Oe,this.setSize(me,be,!1))},this.getSize=function(Oe){return Oe.set(me,be)},this.setSize=function(Oe,pt,Mt=!0){if(ve.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}me=Oe,be=pt,i.width=Math.floor(Oe*fe),i.height=Math.floor(pt*fe),Mt===!0&&(i.style.width=Oe+"px",i.style.height=pt+"px"),this.setViewport(0,0,Oe,pt)},this.getDrawingBufferSize=function(Oe){return Oe.set(me*fe,be*fe).floor()},this.setDrawingBufferSize=function(Oe,pt,Mt){me=Oe,be=pt,fe=Mt,i.width=Math.floor(Oe*Mt),i.height=Math.floor(pt*Mt),this.setViewport(0,0,Oe,pt)},this.getCurrentViewport=function(Oe){return Oe.copy(G)},this.getViewport=function(Oe){return Oe.copy(je)},this.setViewport=function(Oe,pt,Mt,Rt){Oe.isVector4?je.set(Oe.x,Oe.y,Oe.z,Oe.w):je.set(Oe,pt,Mt,Rt),Ye.viewport(G.copy(je).multiplyScalar(fe).round())},this.getScissor=function(Oe){return Oe.copy(qe)},this.setScissor=function(Oe,pt,Mt,Rt){Oe.isVector4?qe.set(Oe.x,Oe.y,Oe.z,Oe.w):qe.set(Oe,pt,Mt,Rt),Ye.scissor(j.copy(qe).multiplyScalar(fe).round())},this.getScissorTest=function(){return ct},this.setScissorTest=function(Oe){Ye.setScissorTest(ct=Oe)},this.setOpaqueSort=function(Oe){Fe=Oe},this.setTransparentSort=function(Oe){He=Oe},this.getClearColor=function(Oe){return Oe.copy(ti.getClearColor())},this.setClearColor=function(){ti.setClearColor(...arguments)},this.getClearAlpha=function(){return ti.getClearAlpha()},this.setClearAlpha=function(){ti.setClearAlpha(...arguments)},this.clear=function(Oe=!0,pt=!0,Mt=!0){let Rt=0;if(Oe){let ft=!1;if(Y!==null){const ci=Y.texture.format;ft=ci===hL||ci===uL||ci===JC}if(ft){const ci=Y.texture.type,Mi=ci===Dh||ci===Kd||ci===z0||ci===V0||ci===aL||ci===lL,ki=ti.getClearColor(),Bi=ti.getClearAlpha(),un=ki.r,pn=ki.g,ln=ki.b;Mi?(w[0]=un,w[1]=pn,w[2]=ln,w[3]=Bi,Re.clearBufferuiv(Re.COLOR,0,w)):(R[0]=un,R[1]=pn,R[2]=ln,R[3]=Bi,Re.clearBufferiv(Re.COLOR,0,R))}else Rt|=Re.COLOR_BUFFER_BIT}pt&&(Rt|=Re.DEPTH_BUFFER_BIT),Mt&&(Rt|=Re.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Re.clear(Rt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",Ae,!1),i.removeEventListener("webglcontextrestored",ke,!1),i.removeEventListener("webglcontextcreationerror",Xe,!1),ti.dispose(),Nt.dispose(),fi.dispose(),st.dispose(),he.dispose(),xe.dispose(),Ze.dispose(),ee.dispose(),te.dispose(),Lt.dispose(),ve.dispose(),ve.removeEventListener("sessionstart",tn),ve.removeEventListener("sessionend",Ni),ji.stop()};function Ae(Oe){Oe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),$=!0}function ke(){console.log("THREE.WebGLRenderer: Context Restored."),$=!1;const Oe=Ct.autoReset,pt=ni.enabled,Mt=ni.autoUpdate,Rt=ni.needsUpdate,ft=ni.type;Se(),Ct.autoReset=Oe,ni.enabled=pt,ni.autoUpdate=Mt,ni.needsUpdate=Rt,ni.type=ft}function Xe(Oe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Oe.statusMessage)}function ut(Oe){const pt=Oe.target;pt.removeEventListener("dispose",ut),lt(pt)}function lt(Oe){Tt(Oe),st.remove(Oe)}function Tt(Oe){const pt=st.get(Oe).programs;pt!==void 0&&(pt.forEach(function(Mt){Lt.releaseProgram(Mt)}),Oe.isShaderMaterial&&Lt.releaseShaderCache(Oe))}this.renderBufferDirect=function(Oe,pt,Mt,Rt,ft,ci){pt===null&&(pt=Jt);const Mi=ft.isMesh&&ft.matrixWorld.determinant()<0,ki=fs(Oe,pt,Mt,Rt,ft);Ye.setMaterial(Rt,Mi);let Bi=Mt.index,un=1;if(Rt.wireframe===!0){if(Bi=$e.getWireframeAttribute(Mt),Bi===void 0)return;un=2}const pn=Mt.drawRange,ln=Mt.attributes.position;let Un=pn.start*un,Hn=(pn.start+pn.count)*un;ci!==null&&(Un=Math.max(Un,ci.start*un),Hn=Math.min(Hn,(ci.start+ci.count)*un)),Bi!==null?(Un=Math.max(Un,0),Hn=Math.min(Hn,Bi.count)):ln!=null&&(Un=Math.max(Un,0),Hn=Math.min(Hn,ln.count));const $r=Hn-Un;if($r<0||$r===1/0)return;ee.setup(ft,Rt,ki,Mt,Bi);let Er,En=Ce;if(Bi!==null&&(Er=Be.get(Bi),En=oe,En.setIndex(Er)),ft.isMesh)Rt.wireframe===!0?(Ye.setLineWidth(Rt.wireframeLinewidth*Ut()),En.setMode(Re.LINES)):En.setMode(Re.TRIANGLES);else if(ft.isLine){let on=Rt.linewidth;on===void 0&&(on=1),Ye.setLineWidth(on*Ut()),ft.isLineSegments?En.setMode(Re.LINES):ft.isLineLoop?En.setMode(Re.LINE_LOOP):En.setMode(Re.LINE_STRIP)}else ft.isPoints?En.setMode(Re.POINTS):ft.isSprite&&En.setMode(Re.TRIANGLES);if(ft.isBatchedMesh)if(ft._multiDrawInstances!==null)zM("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),En.renderMultiDrawInstances(ft._multiDrawStarts,ft._multiDrawCounts,ft._multiDrawCount,ft._multiDrawInstances);else if(it.get("WEBGL_multi_draw"))En.renderMultiDraw(ft._multiDrawStarts,ft._multiDrawCounts,ft._multiDrawCount);else{const on=ft._multiDrawStarts,ws=ft._multiDrawCounts,Jn=ft._multiDrawCount,bo=Bi?Be.get(Bi).bytesPerElement:1,Ya=st.get(Rt).currentProgram.getUniforms();for(let Ar=0;Ar<Jn;Ar++)Ya.setValue(Re,"_gl_DrawID",Ar),En.render(on[Ar]/bo,ws[Ar])}else if(ft.isInstancedMesh)En.renderInstances(Un,$r,ft.count);else if(Mt.isInstancedBufferGeometry){const on=Mt._maxInstanceCount!==void 0?Mt._maxInstanceCount:1/0,ws=Math.min(Mt.instanceCount,on);En.renderInstances(Un,$r,ws)}else En.render(Un,$r)};function zt(Oe,pt,Mt){Oe.transparent===!0&&Oe.side===Pc&&Oe.forceSinglePass===!1?(Oe.side=Ha,Oe.needsUpdate=!0,br(Oe,pt,Mt),Oe.side=kh,Oe.needsUpdate=!0,br(Oe,pt,Mt),Oe.side=Pc):br(Oe,pt,Mt)}this.compile=function(Oe,pt,Mt=null){Mt===null&&(Mt=Oe),P=fi.get(Mt),P.init(pt),F.push(P),Mt.traverseVisible(function(ft){ft.isLight&&ft.layers.test(pt.layers)&&(P.pushLight(ft),ft.castShadow&&P.pushShadow(ft))}),Oe!==Mt&&Oe.traverseVisible(function(ft){ft.isLight&&ft.layers.test(pt.layers)&&(P.pushLight(ft),ft.castShadow&&P.pushShadow(ft))}),P.setupLights();const Rt=new Set;return Oe.traverse(function(ft){if(!(ft.isMesh||ft.isPoints||ft.isLine||ft.isSprite))return;const ci=ft.material;if(ci)if(Array.isArray(ci))for(let Mi=0;Mi<ci.length;Mi++){const ki=ci[Mi];zt(ki,Mt,ft),Rt.add(ki)}else zt(ci,Mt,ft),Rt.add(ci)}),P=F.pop(),Rt},this.compileAsync=function(Oe,pt,Mt=null){const Rt=this.compile(Oe,pt,Mt);return new Promise(ft=>{function ci(){if(Rt.forEach(function(Mi){st.get(Mi).currentProgram.isReady()&&Rt.delete(Mi)}),Rt.size===0){ft(Oe);return}setTimeout(ci,10)}it.get("KHR_parallel_shader_compile")!==null?ci():setTimeout(ci,10)})};let ii=null;function xt(Oe){ii&&ii(Oe)}function tn(){ji.stop()}function Ni(){ji.start()}const ji=new pse;ji.setAnimationLoop(xt),typeof self<"u"&&ji.setContext(self),this.setAnimationLoop=function(Oe){ii=Oe,ve.setAnimationLoop(Oe),Oe===null?ji.stop():ji.start()},ve.addEventListener("sessionstart",tn),ve.addEventListener("sessionend",Ni),this.render=function(Oe,pt){if(pt!==void 0&&pt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if($===!0)return;if(Oe.matrixWorldAutoUpdate===!0&&Oe.updateMatrixWorld(),pt.parent===null&&pt.matrixWorldAutoUpdate===!0&&pt.updateMatrixWorld(),ve.enabled===!0&&ve.isPresenting===!0&&(ve.cameraAutoUpdate===!0&&ve.updateCamera(pt),pt=ve.getCamera()),Oe.isScene===!0&&Oe.onBeforeRender(k,Oe,pt,Y),P=fi.get(Oe,F.length),P.init(pt),F.push(P),Ot.multiplyMatrices(pt.projectionMatrix,pt.matrixWorldInverse),Ge.setFromProjectionMatrix(Ot),mt=this.localClippingEnabled,Je=Pt.init(this.clippingPlanes,mt),O=Nt.get(Oe,N.length),O.init(),N.push(O),ve.enabled===!0&&ve.isPresenting===!0){const ci=k.xr.getDepthSensingMesh();ci!==null&&Pn(ci,pt,-1/0,k.sortObjects)}Pn(Oe,pt,0,k.sortObjects),O.finish(),k.sortObjects===!0&&O.sort(Fe,He),Yt=ve.enabled===!1||ve.isPresenting===!1||ve.hasDepthSensing()===!1,Yt&&ti.addToRenderList(O,Oe),this.info.render.frame++,Je===!0&&Pt.beginShadows();const Mt=P.state.shadowsArray;ni.render(Mt,Oe,pt),Je===!0&&Pt.endShadows(),this.info.autoReset===!0&&this.info.reset();const Rt=O.opaque,ft=O.transmissive;if(P.setupLights(),pt.isArrayCamera){const ci=pt.cameras;if(ft.length>0)for(let Mi=0,ki=ci.length;Mi<ki;Mi++){const Bi=ci[Mi];Oi(Rt,ft,Oe,Bi)}Yt&&ti.render(Oe);for(let Mi=0,ki=ci.length;Mi<ki;Mi++){const Bi=ci[Mi];qt(O,Oe,Bi,Bi.viewport)}}else ft.length>0&&Oi(Rt,ft,Oe,pt),Yt&&ti.render(Oe),qt(O,Oe,pt);Y!==null&&Q===0&&(we.updateMultisampleRenderTarget(Y),we.updateRenderTargetMipmap(Y)),Oe.isScene===!0&&Oe.onAfterRender(k,Oe,pt),ee.resetDefaultState(),M=-1,D=null,F.pop(),F.length>0?(P=F[F.length-1],Je===!0&&Pt.setGlobalState(k.clippingPlanes,P.state.camera)):P=null,N.pop(),N.length>0?O=N[N.length-1]:O=null};function Pn(Oe,pt,Mt,Rt){if(Oe.visible===!1)return;if(Oe.layers.test(pt.layers)){if(Oe.isGroup)Mt=Oe.renderOrder;else if(Oe.isLOD)Oe.autoUpdate===!0&&Oe.update(pt);else if(Oe.isLight)P.pushLight(Oe),Oe.castShadow&&P.pushShadow(Oe);else if(Oe.isSprite){if(!Oe.frustumCulled||Ge.intersectsSprite(Oe)){Rt&&ei.setFromMatrixPosition(Oe.matrixWorld).applyMatrix4(Ot);const Mi=Ze.update(Oe),ki=Oe.material;ki.visible&&O.push(Oe,Mi,ki,Mt,ei.z,null)}}else if((Oe.isMesh||Oe.isLine||Oe.isPoints)&&(!Oe.frustumCulled||Ge.intersectsObject(Oe))){const Mi=Ze.update(Oe),ki=Oe.material;if(Rt&&(Oe.boundingSphere!==void 0?(Oe.boundingSphere===null&&Oe.computeBoundingSphere(),ei.copy(Oe.boundingSphere.center)):(Mi.boundingSphere===null&&Mi.computeBoundingSphere(),ei.copy(Mi.boundingSphere.center)),ei.applyMatrix4(Oe.matrixWorld).applyMatrix4(Ot)),Array.isArray(ki)){const Bi=Mi.groups;for(let un=0,pn=Bi.length;un<pn;un++){const ln=Bi[un],Un=ki[ln.materialIndex];Un&&Un.visible&&O.push(Oe,Mi,Un,Mt,ei.z,ln)}}else ki.visible&&O.push(Oe,Mi,ki,Mt,ei.z,null)}}const ci=Oe.children;for(let Mi=0,ki=ci.length;Mi<ki;Mi++)Pn(ci[Mi],pt,Mt,Rt)}function qt(Oe,pt,Mt,Rt){const ft=Oe.opaque,ci=Oe.transmissive,Mi=Oe.transparent;P.setupLightsView(Mt),Je===!0&&Pt.setGlobalState(k.clippingPlanes,Mt),Rt&&Ye.viewport(G.copy(Rt)),ft.length>0&&li(ft,pt,Mt),ci.length>0&&li(ci,pt,Mt),Mi.length>0&&li(Mi,pt,Mt),Ye.buffers.depth.setTest(!0),Ye.buffers.depth.setMask(!0),Ye.buffers.color.setMask(!0),Ye.setPolygonOffset(!1)}function Oi(Oe,pt,Mt,Rt){if((Mt.isScene===!0?Mt.overrideMaterial:null)!==null)return;P.state.transmissionRenderTarget[Rt.id]===void 0&&(P.state.transmissionRenderTarget[Rt.id]=new Lh(1,1,{generateMipmaps:!0,type:it.has("EXT_color_buffer_half_float")||it.has("EXT_color_buffer_float")?mx:Dh,minFilter:Fc,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Xn.workingColorSpace}));const ci=P.state.transmissionRenderTarget[Rt.id],Mi=Rt.viewport||G;ci.setSize(Mi.z*k.transmissionResolutionScale,Mi.w*k.transmissionResolutionScale);const ki=k.getRenderTarget();k.setRenderTarget(ci),k.getClearColor(ie),le=k.getClearAlpha(),le<1&&k.setClearColor(16777215,.5),k.clear(),Yt&&ti.render(Mt);const Bi=k.toneMapping;k.toneMapping=Fd;const un=Rt.viewport;if(Rt.viewport!==void 0&&(Rt.viewport=void 0),P.setupLightsView(Rt),Je===!0&&Pt.setGlobalState(k.clippingPlanes,Rt),li(Oe,Mt,Rt),we.updateMultisampleRenderTarget(ci),we.updateRenderTargetMipmap(ci),it.has("WEBGL_multisampled_render_to_texture")===!1){let pn=!1;for(let ln=0,Un=pt.length;ln<Un;ln++){const Hn=pt[ln],$r=Hn.object,Er=Hn.geometry,En=Hn.material,on=Hn.group;if(En.side===Pc&&$r.layers.test(Rt.layers)){const ws=En.side;En.side=Ha,En.needsUpdate=!0,dn($r,Mt,Rt,Er,En,on),En.side=ws,En.needsUpdate=!0,pn=!0}}pn===!0&&(we.updateMultisampleRenderTarget(ci),we.updateRenderTargetMipmap(ci))}k.setRenderTarget(ki),k.setClearColor(ie,le),un!==void 0&&(Rt.viewport=un),k.toneMapping=Bi}function li(Oe,pt,Mt){const Rt=pt.isScene===!0?pt.overrideMaterial:null;for(let ft=0,ci=Oe.length;ft<ci;ft++){const Mi=Oe[ft],ki=Mi.object,Bi=Mi.geometry,un=Mi.group;let pn=Mi.material;pn.allowOverride===!0&&Rt!==null&&(pn=Rt),ki.layers.test(Mt.layers)&&dn(ki,pt,Mt,Bi,pn,un)}}function dn(Oe,pt,Mt,Rt,ft,ci){Oe.onBeforeRender(k,pt,Mt,Rt,ft,ci),Oe.modelViewMatrix.multiplyMatrices(Mt.matrixWorldInverse,Oe.matrixWorld),Oe.normalMatrix.getNormalMatrix(Oe.modelViewMatrix),ft.onBeforeRender(k,pt,Mt,Rt,Oe,ci),ft.transparent===!0&&ft.side===Pc&&ft.forceSinglePass===!1?(ft.side=Ha,ft.needsUpdate=!0,k.renderBufferDirect(Mt,pt,Rt,ft,Oe,ci),ft.side=kh,ft.needsUpdate=!0,k.renderBufferDirect(Mt,pt,Rt,ft,Oe,ci),ft.side=Pc):k.renderBufferDirect(Mt,pt,Rt,ft,Oe,ci),Oe.onAfterRender(k,pt,Mt,Rt,ft,ci)}function br(Oe,pt,Mt){pt.isScene!==!0&&(pt=Jt);const Rt=st.get(Oe),ft=P.state.lights,ci=P.state.shadowsArray,Mi=ft.state.version,ki=Lt.getParameters(Oe,ft.state,ci,pt,Mt),Bi=Lt.getProgramCacheKey(ki);let un=Rt.programs;Rt.environment=Oe.isMeshStandardMaterial?pt.environment:null,Rt.fog=pt.fog,Rt.envMap=(Oe.isMeshStandardMaterial?xe:he).get(Oe.envMap||Rt.environment),Rt.envMapRotation=Rt.environment!==null&&Oe.envMap===null?pt.environmentRotation:Oe.envMapRotation,un===void 0&&(Oe.addEventListener("dispose",ut),un=new Map,Rt.programs=un);let pn=un.get(Bi);if(pn!==void 0){if(Rt.currentProgram===pn&&Rt.lightsStateVersion===Mi)return Qi(Oe,ki),pn}else ki.uniforms=Lt.getUniforms(Oe),Oe.onBeforeCompile(ki,k),pn=Lt.acquireProgram(ki,Bi),un.set(Bi,pn),Rt.uniforms=ki.uniforms;const ln=Rt.uniforms;return(!Oe.isShaderMaterial&&!Oe.isRawShaderMaterial||Oe.clipping===!0)&&(ln.clippingPlanes=Pt.uniform),Qi(Oe,ki),Rt.needsLights=sf(Oe),Rt.lightsStateVersion=Mi,Rt.needsLights&&(ln.ambientLightColor.value=ft.state.ambient,ln.lightProbe.value=ft.state.probe,ln.directionalLights.value=ft.state.directional,ln.directionalLightShadows.value=ft.state.directionalShadow,ln.spotLights.value=ft.state.spot,ln.spotLightShadows.value=ft.state.spotShadow,ln.rectAreaLights.value=ft.state.rectArea,ln.ltc_1.value=ft.state.rectAreaLTC1,ln.ltc_2.value=ft.state.rectAreaLTC2,ln.pointLights.value=ft.state.point,ln.pointLightShadows.value=ft.state.pointShadow,ln.hemisphereLights.value=ft.state.hemi,ln.directionalShadowMap.value=ft.state.directionalShadowMap,ln.directionalShadowMatrix.value=ft.state.directionalShadowMatrix,ln.spotShadowMap.value=ft.state.spotShadowMap,ln.spotLightMatrix.value=ft.state.spotLightMatrix,ln.spotLightMap.value=ft.state.spotLightMap,ln.pointShadowMap.value=ft.state.pointShadowMap,ln.pointShadowMatrix.value=ft.state.pointShadowMatrix),Rt.currentProgram=pn,Rt.uniformsList=null,pn}function Ka(Oe){if(Oe.uniformsList===null){const pt=Oe.currentProgram.getUniforms();Oe.uniformsList=GM.seqWithValue(pt.seq,Oe.uniforms)}return Oe.uniformsList}function Qi(Oe,pt){const Mt=st.get(Oe);Mt.outputColorSpace=pt.outputColorSpace,Mt.batching=pt.batching,Mt.batchingColor=pt.batchingColor,Mt.instancing=pt.instancing,Mt.instancingColor=pt.instancingColor,Mt.instancingMorph=pt.instancingMorph,Mt.skinning=pt.skinning,Mt.morphTargets=pt.morphTargets,Mt.morphNormals=pt.morphNormals,Mt.morphColors=pt.morphColors,Mt.morphTargetsCount=pt.morphTargetsCount,Mt.numClippingPlanes=pt.numClippingPlanes,Mt.numIntersection=pt.numClipIntersection,Mt.vertexAlphas=pt.vertexAlphas,Mt.vertexTangents=pt.vertexTangents,Mt.toneMapping=pt.toneMapping}function fs(Oe,pt,Mt,Rt,ft){pt.isScene!==!0&&(pt=Jt),we.resetTextureUnits();const ci=pt.fog,Mi=Rt.isMeshStandardMaterial?pt.environment:null,ki=Y===null?k.outputColorSpace:Y.isXRRenderTarget===!0?Y.texture.colorSpace:ma,Bi=(Rt.isMeshStandardMaterial?xe:he).get(Rt.envMap||Mi),un=Rt.vertexColors===!0&&!!Mt.attributes.color&&Mt.attributes.color.itemSize===4,pn=!!Mt.attributes.tangent&&(!!Rt.normalMap||Rt.anisotropy>0),ln=!!Mt.morphAttributes.position,Un=!!Mt.morphAttributes.normal,Hn=!!Mt.morphAttributes.color;let $r=Fd;Rt.toneMapped&&(Y===null||Y.isXRRenderTarget===!0)&&($r=k.toneMapping);const Er=Mt.morphAttributes.position||Mt.morphAttributes.normal||Mt.morphAttributes.color,En=Er!==void 0?Er.length:0,on=st.get(Rt),ws=P.state.lights;if(Je===!0&&(mt===!0||Oe!==D)){const ns=Oe===D&&Rt.id===M;Pt.setState(Rt,Oe,ns)}let Jn=!1;Rt.version===on.__version?(on.needsLights&&on.lightsStateVersion!==ws.state.version||on.outputColorSpace!==ki||ft.isBatchedMesh&&on.batching===!1||!ft.isBatchedMesh&&on.batching===!0||ft.isBatchedMesh&&on.batchingColor===!0&&ft.colorTexture===null||ft.isBatchedMesh&&on.batchingColor===!1&&ft.colorTexture!==null||ft.isInstancedMesh&&on.instancing===!1||!ft.isInstancedMesh&&on.instancing===!0||ft.isSkinnedMesh&&on.skinning===!1||!ft.isSkinnedMesh&&on.skinning===!0||ft.isInstancedMesh&&on.instancingColor===!0&&ft.instanceColor===null||ft.isInstancedMesh&&on.instancingColor===!1&&ft.instanceColor!==null||ft.isInstancedMesh&&on.instancingMorph===!0&&ft.morphTexture===null||ft.isInstancedMesh&&on.instancingMorph===!1&&ft.morphTexture!==null||on.envMap!==Bi||Rt.fog===!0&&on.fog!==ci||on.numClippingPlanes!==void 0&&(on.numClippingPlanes!==Pt.numPlanes||on.numIntersection!==Pt.numIntersection)||on.vertexAlphas!==un||on.vertexTangents!==pn||on.morphTargets!==ln||on.morphNormals!==Un||on.morphColors!==Hn||on.toneMapping!==$r||on.morphTargetsCount!==En)&&(Jn=!0):(Jn=!0,on.__version=Rt.version);let bo=on.currentProgram;Jn===!0&&(bo=br(Rt,pt,ft));let Ya=!1,Ar=!1,gn=!1;const lr=bo.getUniforms(),ps=on.uniforms;if(Ye.useProgram(bo.program)&&(Ya=!0,Ar=!0,gn=!0),Rt.id!==M&&(M=Rt.id,Ar=!0),Ya||D!==Oe){Ye.buffers.depth.getReversed()?(wt.copy(Oe.projectionMatrix),qQe(wt),jQe(wt),lr.setValue(Re,"projectionMatrix",wt)):lr.setValue(Re,"projectionMatrix",Oe.projectionMatrix),lr.setValue(Re,"viewMatrix",Oe.matrixWorldInverse);const hn=lr.map.cameraPosition;hn!==void 0&&hn.setValue(Re,Qt.setFromMatrixPosition(Oe.matrixWorld)),Pe.logarithmicDepthBuffer&&lr.setValue(Re,"logDepthBufFC",2/(Math.log(Oe.far+1)/Math.LN2)),(Rt.isMeshPhongMaterial||Rt.isMeshToonMaterial||Rt.isMeshLambertMaterial||Rt.isMeshBasicMaterial||Rt.isMeshStandardMaterial||Rt.isShaderMaterial)&&lr.setValue(Re,"isOrthographic",Oe.isOrthographicCamera===!0),D!==Oe&&(D=Oe,Ar=!0,gn=!0)}if(ft.isSkinnedMesh){lr.setOptional(Re,ft,"bindMatrix"),lr.setOptional(Re,ft,"bindMatrixInverse");const ns=ft.skeleton;ns&&(ns.boneTexture===null&&ns.computeBoneTexture(),lr.setValue(Re,"boneTexture",ns.boneTexture,we))}ft.isBatchedMesh&&(lr.setOptional(Re,ft,"batchingTexture"),lr.setValue(Re,"batchingTexture",ft._matricesTexture,we),lr.setOptional(Re,ft,"batchingIdTexture"),lr.setValue(Re,"batchingIdTexture",ft._indirectTexture,we),lr.setOptional(Re,ft,"batchingColorTexture"),ft._colorsTexture!==null&&lr.setValue(Re,"batchingColorTexture",ft._colorsTexture,we));const is=Mt.morphAttributes;if((is.position!==void 0||is.normal!==void 0||is.color!==void 0)&&nt.update(ft,Mt,bo),(Ar||on.receiveShadow!==ft.receiveShadow)&&(on.receiveShadow=ft.receiveShadow,lr.setValue(Re,"receiveShadow",ft.receiveShadow)),Rt.isMeshGouraudMaterial&&Rt.envMap!==null&&(ps.envMap.value=Bi,ps.flipEnvMap.value=Bi.isCubeTexture&&Bi.isRenderTargetTexture===!1?-1:1),Rt.isMeshStandardMaterial&&Rt.envMap===null&&pt.environment!==null&&(ps.envMapIntensity.value=pt.environmentIntensity),Ar&&(lr.setValue(Re,"toneMappingExposure",k.toneMappingExposure),on.needsLights&&wr(ps,gn),ci&&Rt.fog===!0&&ot.refreshFogUniforms(ps,ci),ot.refreshMaterialUniforms(ps,Rt,fe,be,P.state.transmissionRenderTarget[Oe.id]),GM.upload(Re,Ka(on),ps,we)),Rt.isShaderMaterial&&Rt.uniformsNeedUpdate===!0&&(GM.upload(Re,Ka(on),ps,we),Rt.uniformsNeedUpdate=!1),Rt.isSpriteMaterial&&lr.setValue(Re,"center",ft.center),lr.setValue(Re,"modelViewMatrix",ft.modelViewMatrix),lr.setValue(Re,"normalMatrix",ft.normalMatrix),lr.setValue(Re,"modelMatrix",ft.matrixWorld),Rt.isShaderMaterial||Rt.isRawShaderMaterial){const ns=Rt.uniformsGroups;for(let hn=0,wo=ns.length;hn<wo;hn++){const ba=ns[hn];te.update(ba,bo),te.bind(ba,bo)}}return bo}function wr(Oe,pt){Oe.ambientLightColor.needsUpdate=pt,Oe.lightProbe.needsUpdate=pt,Oe.directionalLights.needsUpdate=pt,Oe.directionalLightShadows.needsUpdate=pt,Oe.pointLights.needsUpdate=pt,Oe.pointLightShadows.needsUpdate=pt,Oe.spotLights.needsUpdate=pt,Oe.spotLightShadows.needsUpdate=pt,Oe.rectAreaLights.needsUpdate=pt,Oe.hemisphereLights.needsUpdate=pt}function sf(Oe){return Oe.isMeshLambertMaterial||Oe.isMeshToonMaterial||Oe.isMeshPhongMaterial||Oe.isMeshStandardMaterial||Oe.isShadowMaterial||Oe.isShaderMaterial&&Oe.lights===!0}this.getActiveCubeFace=function(){return W},this.getActiveMipmapLevel=function(){return Q},this.getRenderTarget=function(){return Y},this.setRenderTargetTextures=function(Oe,pt,Mt){const Rt=st.get(Oe);Rt.__autoAllocateDepthBuffer=Oe.resolveDepthBuffer===!1,Rt.__autoAllocateDepthBuffer===!1&&(Rt.__useRenderToTexture=!1),st.get(Oe.texture).__webglTexture=pt,st.get(Oe.depthTexture).__webglTexture=Rt.__autoAllocateDepthBuffer?void 0:Mt,Rt.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(Oe,pt){const Mt=st.get(Oe);Mt.__webglFramebuffer=pt,Mt.__useDefaultFramebuffer=pt===void 0};const ku=Re.createFramebuffer();this.setRenderTarget=function(Oe,pt=0,Mt=0){Y=Oe,W=pt,Q=Mt;let Rt=!0,ft=null,ci=!1,Mi=!1;if(Oe){const Bi=st.get(Oe);if(Bi.__useDefaultFramebuffer!==void 0)Ye.bindFramebuffer(Re.FRAMEBUFFER,null),Rt=!1;else if(Bi.__webglFramebuffer===void 0)we.setupRenderTarget(Oe);else if(Bi.__hasExternalTextures)we.rebindTextures(Oe,st.get(Oe.texture).__webglTexture,st.get(Oe.depthTexture).__webglTexture);else if(Oe.depthBuffer){const ln=Oe.depthTexture;if(Bi.__boundDepthTexture!==ln){if(ln!==null&&st.has(ln)&&(Oe.width!==ln.image.width||Oe.height!==ln.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");we.setupDepthRenderbuffer(Oe)}}const un=Oe.texture;(un.isData3DTexture||un.isDataArrayTexture||un.isCompressedArrayTexture)&&(Mi=!0);const pn=st.get(Oe).__webglFramebuffer;Oe.isWebGLCubeRenderTarget?(Array.isArray(pn[pt])?ft=pn[pt][Mt]:ft=pn[pt],ci=!0):Oe.samples>0&&we.useMultisampledRTT(Oe)===!1?ft=st.get(Oe).__webglMultisampledFramebuffer:Array.isArray(pn)?ft=pn[Mt]:ft=pn,G.copy(Oe.viewport),j.copy(Oe.scissor),Z=Oe.scissorTest}else G.copy(je).multiplyScalar(fe).floor(),j.copy(qe).multiplyScalar(fe).floor(),Z=ct;if(Mt!==0&&(ft=ku),Ye.bindFramebuffer(Re.FRAMEBUFFER,ft)&&Rt&&Ye.drawBuffers(Oe,ft),Ye.viewport(G),Ye.scissor(j),Ye.setScissorTest(Z),ci){const Bi=st.get(Oe.texture);Re.framebufferTexture2D(Re.FRAMEBUFFER,Re.COLOR_ATTACHMENT0,Re.TEXTURE_CUBE_MAP_POSITIVE_X+pt,Bi.__webglTexture,Mt)}else if(Mi){const Bi=st.get(Oe.texture),un=pt;Re.framebufferTextureLayer(Re.FRAMEBUFFER,Re.COLOR_ATTACHMENT0,Bi.__webglTexture,Mt,un)}else if(Oe!==null&&Mt!==0){const Bi=st.get(Oe.texture);Re.framebufferTexture2D(Re.FRAMEBUFFER,Re.COLOR_ATTACHMENT0,Re.TEXTURE_2D,Bi.__webglTexture,Mt)}M=-1},this.readRenderTargetPixels=function(Oe,pt,Mt,Rt,ft,ci,Mi){if(!(Oe&&Oe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ki=st.get(Oe).__webglFramebuffer;if(Oe.isWebGLCubeRenderTarget&&Mi!==void 0&&(ki=ki[Mi]),ki){Ye.bindFramebuffer(Re.FRAMEBUFFER,ki);try{const Bi=Oe.texture,un=Bi.format,pn=Bi.type;if(!Pe.textureFormatReadable(un)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Pe.textureTypeReadable(pn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}pt>=0&&pt<=Oe.width-Rt&&Mt>=0&&Mt<=Oe.height-ft&&Re.readPixels(pt,Mt,Rt,ft,re.convert(un),re.convert(pn),ci)}finally{const Bi=Y!==null?st.get(Y).__webglFramebuffer:null;Ye.bindFramebuffer(Re.FRAMEBUFFER,Bi)}}},this.readRenderTargetPixelsAsync=async function(Oe,pt,Mt,Rt,ft,ci,Mi){if(!(Oe&&Oe.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ki=st.get(Oe).__webglFramebuffer;if(Oe.isWebGLCubeRenderTarget&&Mi!==void 0&&(ki=ki[Mi]),ki)if(pt>=0&&pt<=Oe.width-Rt&&Mt>=0&&Mt<=Oe.height-ft){Ye.bindFramebuffer(Re.FRAMEBUFFER,ki);const Bi=Oe.texture,un=Bi.format,pn=Bi.type;if(!Pe.textureFormatReadable(un))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Pe.textureTypeReadable(pn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const ln=Re.createBuffer();Re.bindBuffer(Re.PIXEL_PACK_BUFFER,ln),Re.bufferData(Re.PIXEL_PACK_BUFFER,ci.byteLength,Re.STREAM_READ),Re.readPixels(pt,Mt,Rt,ft,re.convert(un),re.convert(pn),0);const Un=Y!==null?st.get(Y).__webglFramebuffer:null;Ye.bindFramebuffer(Re.FRAMEBUFFER,Un);const Hn=Re.fenceSync(Re.SYNC_GPU_COMMANDS_COMPLETE,0);return Re.flush(),await WQe(Re,Hn,4),Re.bindBuffer(Re.PIXEL_PACK_BUFFER,ln),Re.getBufferSubData(Re.PIXEL_PACK_BUFFER,0,ci),Re.deleteBuffer(ln),Re.deleteSync(Hn),ci}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(Oe,pt=null,Mt=0){const Rt=Math.pow(2,-Mt),ft=Math.floor(Oe.image.width*Rt),ci=Math.floor(Oe.image.height*Rt),Mi=pt!==null?pt.x:0,ki=pt!==null?pt.y:0;we.setTexture2D(Oe,0),Re.copyTexSubImage2D(Re.TEXTURE_2D,Mt,0,0,Mi,ki,ft,ci),Ye.unbindTexture()};const ac=Re.createFramebuffer(),xo=Re.createFramebuffer();this.copyTextureToTexture=function(Oe,pt,Mt=null,Rt=null,ft=0,ci=null){ci===null&&(ft!==0?(zM("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),ci=ft,ft=0):ci=0);let Mi,ki,Bi,un,pn,ln,Un,Hn,$r;const Er=Oe.isCompressedTexture?Oe.mipmaps[ci]:Oe.image;if(Mt!==null)Mi=Mt.max.x-Mt.min.x,ki=Mt.max.y-Mt.min.y,Bi=Mt.isBox3?Mt.max.z-Mt.min.z:1,un=Mt.min.x,pn=Mt.min.y,ln=Mt.isBox3?Mt.min.z:0;else{const is=Math.pow(2,-ft);Mi=Math.floor(Er.width*is),ki=Math.floor(Er.height*is),Oe.isDataArrayTexture?Bi=Er.depth:Oe.isData3DTexture?Bi=Math.floor(Er.depth*is):Bi=1,un=0,pn=0,ln=0}Rt!==null?(Un=Rt.x,Hn=Rt.y,$r=Rt.z):(Un=0,Hn=0,$r=0);const En=re.convert(pt.format),on=re.convert(pt.type);let ws;pt.isData3DTexture?(we.setTexture3D(pt,0),ws=Re.TEXTURE_3D):pt.isDataArrayTexture||pt.isCompressedArrayTexture?(we.setTexture2DArray(pt,0),ws=Re.TEXTURE_2D_ARRAY):(we.setTexture2D(pt,0),ws=Re.TEXTURE_2D),Re.pixelStorei(Re.UNPACK_FLIP_Y_WEBGL,pt.flipY),Re.pixelStorei(Re.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pt.premultiplyAlpha),Re.pixelStorei(Re.UNPACK_ALIGNMENT,pt.unpackAlignment);const Jn=Re.getParameter(Re.UNPACK_ROW_LENGTH),bo=Re.getParameter(Re.UNPACK_IMAGE_HEIGHT),Ya=Re.getParameter(Re.UNPACK_SKIP_PIXELS),Ar=Re.getParameter(Re.UNPACK_SKIP_ROWS),gn=Re.getParameter(Re.UNPACK_SKIP_IMAGES);Re.pixelStorei(Re.UNPACK_ROW_LENGTH,Er.width),Re.pixelStorei(Re.UNPACK_IMAGE_HEIGHT,Er.height),Re.pixelStorei(Re.UNPACK_SKIP_PIXELS,un),Re.pixelStorei(Re.UNPACK_SKIP_ROWS,pn),Re.pixelStorei(Re.UNPACK_SKIP_IMAGES,ln);const lr=Oe.isDataArrayTexture||Oe.isData3DTexture,ps=pt.isDataArrayTexture||pt.isData3DTexture;if(Oe.isDepthTexture){const is=st.get(Oe),ns=st.get(pt),hn=st.get(is.__renderTarget),wo=st.get(ns.__renderTarget);Ye.bindFramebuffer(Re.READ_FRAMEBUFFER,hn.__webglFramebuffer),Ye.bindFramebuffer(Re.DRAW_FRAMEBUFFER,wo.__webglFramebuffer);for(let ba=0;ba<Bi;ba++)lr&&(Re.framebufferTextureLayer(Re.READ_FRAMEBUFFER,Re.COLOR_ATTACHMENT0,st.get(Oe).__webglTexture,ft,ln+ba),Re.framebufferTextureLayer(Re.DRAW_FRAMEBUFFER,Re.COLOR_ATTACHMENT0,st.get(pt).__webglTexture,ci,$r+ba)),Re.blitFramebuffer(un,pn,Mi,ki,Un,Hn,Mi,ki,Re.DEPTH_BUFFER_BIT,Re.NEAREST);Ye.bindFramebuffer(Re.READ_FRAMEBUFFER,null),Ye.bindFramebuffer(Re.DRAW_FRAMEBUFFER,null)}else if(ft!==0||Oe.isRenderTargetTexture||st.has(Oe)){const is=st.get(Oe),ns=st.get(pt);Ye.bindFramebuffer(Re.READ_FRAMEBUFFER,ac),Ye.bindFramebuffer(Re.DRAW_FRAMEBUFFER,xo);for(let hn=0;hn<Bi;hn++)lr?Re.framebufferTextureLayer(Re.READ_FRAMEBUFFER,Re.COLOR_ATTACHMENT0,is.__webglTexture,ft,ln+hn):Re.framebufferTexture2D(Re.READ_FRAMEBUFFER,Re.COLOR_ATTACHMENT0,Re.TEXTURE_2D,is.__webglTexture,ft),ps?Re.framebufferTextureLayer(Re.DRAW_FRAMEBUFFER,Re.COLOR_ATTACHMENT0,ns.__webglTexture,ci,$r+hn):Re.framebufferTexture2D(Re.DRAW_FRAMEBUFFER,Re.COLOR_ATTACHMENT0,Re.TEXTURE_2D,ns.__webglTexture,ci),ft!==0?Re.blitFramebuffer(un,pn,Mi,ki,Un,Hn,Mi,ki,Re.COLOR_BUFFER_BIT,Re.NEAREST):ps?Re.copyTexSubImage3D(ws,ci,Un,Hn,$r+hn,un,pn,Mi,ki):Re.copyTexSubImage2D(ws,ci,Un,Hn,un,pn,Mi,ki);Ye.bindFramebuffer(Re.READ_FRAMEBUFFER,null),Ye.bindFramebuffer(Re.DRAW_FRAMEBUFFER,null)}else ps?Oe.isDataTexture||Oe.isData3DTexture?Re.texSubImage3D(ws,ci,Un,Hn,$r,Mi,ki,Bi,En,on,Er.data):pt.isCompressedArrayTexture?Re.compressedTexSubImage3D(ws,ci,Un,Hn,$r,Mi,ki,Bi,En,Er.data):Re.texSubImage3D(ws,ci,Un,Hn,$r,Mi,ki,Bi,En,on,Er):Oe.isDataTexture?Re.texSubImage2D(Re.TEXTURE_2D,ci,Un,Hn,Mi,ki,En,on,Er.data):Oe.isCompressedTexture?Re.compressedTexSubImage2D(Re.TEXTURE_2D,ci,Un,Hn,Er.width,Er.height,En,Er.data):Re.texSubImage2D(Re.TEXTURE_2D,ci,Un,Hn,Mi,ki,En,on,Er);Re.pixelStorei(Re.UNPACK_ROW_LENGTH,Jn),Re.pixelStorei(Re.UNPACK_IMAGE_HEIGHT,bo),Re.pixelStorei(Re.UNPACK_SKIP_PIXELS,Ya),Re.pixelStorei(Re.UNPACK_SKIP_ROWS,Ar),Re.pixelStorei(Re.UNPACK_SKIP_IMAGES,gn),ci===0&&pt.generateMipmaps&&Re.generateMipmap(ws),Ye.unbindTexture()},this.copyTextureToTexture3D=function(Oe,pt,Mt=null,Rt=null,ft=0){return zM('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(Oe,pt,Mt,Rt,ft)},this.initRenderTarget=function(Oe){st.get(Oe).__webglFramebuffer===void 0&&we.setupRenderTarget(Oe)},this.initTexture=function(Oe){Oe.isCubeTexture?we.setTextureCube(Oe,0):Oe.isData3DTexture?we.setTexture3D(Oe,0):Oe.isDataArrayTexture||Oe.isCompressedArrayTexture?we.setTexture2DArray(Oe,0):we.setTexture2D(Oe,0),Ye.unbindTexture()},this.resetState=function(){W=0,Q=0,Y=null,Ye.reset(),ee.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return wu}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const i=this.getContext();i.drawingBufferColorSpace=Xn._getDrawingBufferColorSpace(e),i.unpackColorSpace=Xn._getUnpackColorSpace()}}const ntt=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:ere,AddEquation:rp,AddOperation:Xne,AdditiveAnimationBlendMode:VH,AdditiveBlending:CV,AgXToneMapping:gR,AlphaFormat:DH,AlwaysCompare:vre,AlwaysDepth:uR,AlwaysStencilFunc:TV,AmbientLight:tse,AnimationAction:hse,AnimationClip:Q0,AnimationLoader:y7e,AnimationMixer:W7e,AnimationObjectGroup:H7e,AnimationUtils:p7e,ArcCurve:Are,ArrayCamera:ase,ArrowHelper:dXe,AttachedBindMode:MV,Audio:cse,AudioAnalyser:k7e,AudioContext:v5,AudioListener:E7e,AudioLoader:T7e,AxesHelper:fXe,BackSide:Ha,BasicDepthPacking:lre,BasicShadowMap:K9e,BatchedMesh:Pre,Bone:xL,BooleanKeyframeTrack:av,Box2:J7e,Box3:Es,Box3Helper:uXe,BoxGeometry:Hp,BoxHelper:cXe,BufferAttribute:xr,BufferGeometry:Rn,BufferGeometryLoader:sse,ByteType:AH,Cache:Md,Camera:gL,CameraHelper:lXe,CanvasTexture:NZe,CapsuleGeometry:OL,CatmullRomCurve3:Ire,CineonToneMapping:Jne,CircleGeometry:ML,ClampToEdgeWrapping:Zl,Clock:lse,Color:Si,ColorKeyframeTrack:u5,ColorManagement:Xn,CompressedArrayTexture:LZe,CompressedCubeTexture:FZe,CompressedTexture:_L,CompressedTextureLoader:x7e,ConeGeometry:TL,ConstantAlphaFactor:jne,ConstantColorFactor:Wne,Controls:mXe,CubeCamera:Sre,CubeReflectionMapping:Xd,CubeRefractionMapping:Ep,CubeTexture:iS,CubeTextureLoader:b7e,CubeUVReflectionMapping:px,CubicBezierCurve:e5,CubicBezierCurve3:kre,CubicInterpolant:Xre,CullFaceBack:_V,CullFaceFront:Ene,CullFaceFrontBack:X9e,CullFaceNone:Pne,Curve:Au,CurvePath:Lre,CustomBlending:Ane,CustomToneMapping:tre,CylinderGeometry:gx,Cylindrical:Y7e,Data3DTexture:pL,DataArrayTexture:eS,DataTexture:bh,DataTextureLoader:w7e,DataUtils:lZe,DecrementStencilOp:lQe,DecrementWrapStencilOp:uQe,DefaultLoadingManager:cv,DepthFormat:G0,DepthStencilFormat:U0,DepthTexture:YH,DetachedBindMode:nre,DirectionalLight:m5,DirectionalLightHelper:aXe,DiscreteInterpolant:Kre,DodecahedronGeometry:RL,DoubleSide:Pc,DstAlphaFactor:Vne,DstColorFactor:Une,DynamicCopyUsage:SQe,DynamicDrawUsage:yre,DynamicReadUsage:wQe,EdgesGeometry:Fre,EllipseCurve:CL,EqualCompare:fre,EqualDepth:dR,EqualStencilFunc:pQe,EquirectangularReflectionMapping:oC,EquirectangularRefractionMapping:aC,Euler:sc,EventDispatcher:Uh,ExtrudeGeometry:PL,FileLoader:Tu,Float16BufferAttribute:mZe,Float32BufferAttribute:Hi,FloatType:gl,Fog:yL,FogExp2:vL,FramebufferTexture:DZe,FrontSide:kh,Frustum:sS,GLBufferAttribute:X7e,GLSL1:MQe,GLSL3:RV,GreaterCompare:pre,GreaterDepth:pR,GreaterEqualCompare:gre,GreaterEqualDepth:fR,GreaterEqualStencilFunc:yQe,GreaterStencilFunc:gQe,GridHelper:sXe,Group:Xl,HalfFloatType:mx,HemisphereLight:ese,HemisphereLightHelper:rXe,IcosahedronGeometry:EL,ImageBitmapLoader:ose,ImageLoader:vC,ImageUtils:wre,IncrementStencilOp:aQe,IncrementWrapStencilOp:cQe,InstancedBufferAttribute:Hg,InstancedBufferGeometry:g5,InstancedInterleavedBuffer:jR,InstancedMesh:bL,Int16BufferAttribute:fZe,Int32BufferAttribute:pZe,Int8BufferAttribute:uZe,IntType:oL,InterleavedBuffer:nS,InterleavedBufferAttribute:yl,Interpolant:xx,InterpolateDiscrete:H0,InterpolateLinear:$0,InterpolateSmooth:BM,InvertStencilOp:hQe,KeepStencilOp:Gm,KeyframeTrack:Jc,LOD:Rre,LatheGeometry:oS,Layers:mL,LessCompare:dre,LessDepth:hR,LessEqualCompare:UH,LessEqualDepth:Ug,LessEqualStencilFunc:mQe,LessStencilFunc:fQe,Light:Wp,LightProbe:rse,Line:Yd,Line3:_5,LineBasicMaterial:xa,LineCurve:t5,LineCurve3:Dre,LineDashedMaterial:jre,LineLoop:XH,LineSegments:Eu,LinearFilter:Ps,LinearInterpolant:c5,LinearMipMapLinearFilter:tQe,LinearMipMapNearestFilter:eQe,LinearMipmapLinearFilter:Fc,LinearMipmapNearestFilter:o0,LinearSRGBColorSpace:ma,LinearToneMapping:Kne,LinearTransfer:cC,Loader:Xa,LoaderUtils:wp,LoadingManager:h5,LoopOnce:rre,LoopPingPong:ore,LoopRepeat:sre,LuminanceAlphaFormat:NH,LuminanceFormat:FH,MOUSE:Q9e,Material:po,MaterialLoader:NL,MathUtils:$H,Matrix2:w5,Matrix3:wn,Matrix4:sn,MaxEquation:Lne,Mesh:us,MeshBasicMaterial:vl,MeshDepthMaterial:o5,MeshDistanceMaterial:a5,MeshLambertMaterial:Wre,MeshMatcapMaterial:qre,MeshNormalMaterial:$re,MeshPhongMaterial:Ure,MeshPhysicalMaterial:Yc,MeshStandardMaterial:yx,MeshToonMaterial:Hre,MinEquation:Dne,MirroredRepeatWrapping:B0,MixOperation:Zne,MultiplyBlending:OV,MultiplyOperation:YC,NearestFilter:fo,NearestMipMapLinearFilter:J9e,NearestMipMapNearestFilter:Y9e,NearestMipmapLinearFilter:tg,NearestMipmapNearestFilter:sL,NeutralToneMapping:ire,NeverCompare:hre,NeverDepth:cR,NeverStencilFunc:dQe,NoBlending:Ld,NoColorSpace:_d,NoToneMapping:Fd,NormalAnimationBlendMode:dL,NormalBlending:wg,NotEqualCompare:mre,NotEqualDepth:mR,NotEqualStencilFunc:vQe,NumberKeyframeTrack:Wg,Object3D:Qn,ObjectLoader:O7e,ObjectSpaceNormalMap:ure,OctahedronGeometry:aS,OneFactor:Nne,OneMinusConstantAlphaFactor:Qne,OneMinusConstantColorFactor:qne,OneMinusDstAlphaFactor:Gne,OneMinusDstColorFactor:Hne,OneMinusSrcAlphaFactor:lR,OneMinusSrcColorFactor:zne,OrthographicCamera:bx,PCFShadowMap:EH,PCFSoftShadowMap:c_,PMREMGenerator:LV,Path:fC,PerspectiveCamera:ho,Plane:ep,PlaneGeometry:vx,PlaneHelper:hXe,PointLight:p5,PointLightHelper:iXe,Points:KH,PointsMaterial:wL,PolarGridHelper:oXe,PolyhedronGeometry:$p,PositionalAudio:I7e,PropertyBinding:cr,PropertyMixer:use,QuadraticBezierCurve:i5,QuadraticBezierCurve3:SL,Quaternion:pa,QuaternionKeyframeTrack:qg,QuaternionLinearInterpolant:Yre,RED_GREEN_RGTC2_Format:GR,RED_RGTC1_Format:zH,REVISION:nL,RGBADepthPacking:cre,RGBAFormat:za,RGBAIntegerFormat:hL,RGBA_ASTC_10x10_Format:LR,RGBA_ASTC_10x5_Format:IR,RGBA_ASTC_10x6_Format:kR,RGBA_ASTC_10x8_Format:DR,RGBA_ASTC_12x10_Format:FR,RGBA_ASTC_12x12_Format:NR,RGBA_ASTC_4x4_Format:SR,RGBA_ASTC_5x4_Format:OR,RGBA_ASTC_5x5_Format:MR,RGBA_ASTC_6x5_Format:TR,RGBA_ASTC_6x6_Format:RR,RGBA_ASTC_8x5_Format:PR,RGBA_ASTC_8x6_Format:ER,RGBA_ASTC_8x8_Format:AR,RGBA_BPTC_Format:p_,RGBA_ETC2_EAC_Format:CR,RGBA_PVRTC_2BPPV1_Format:bR,RGBA_PVRTC_4BPPV1_Format:xR,RGBA_S3TC_DXT1_Format:h_,RGBA_S3TC_DXT3_Format:d_,RGBA_S3TC_DXT5_Format:f_,RGBDepthPacking:nQe,RGBFormat:LH,RGBIntegerFormat:iQe,RGB_BPTC_SIGNED_Format:BR,RGB_BPTC_UNSIGNED_Format:zR,RGB_ETC1_Format:wR,RGB_ETC2_Format:_R,RGB_PVRTC_2BPPV1_Format:yR,RGB_PVRTC_4BPPV1_Format:vR,RGB_S3TC_DXT1_Format:u_,RGDepthPacking:rQe,RGFormat:BH,RGIntegerFormat:uL,RawShaderMaterial:s5,Ray:sv,Raycaster:dse,RectAreaLight:ise,RedFormat:cL,RedIntegerFormat:JC,ReinhardToneMapping:Yne,RenderTarget:fL,RenderTarget3D:q7e,RenderTargetArray:j7e,RepeatWrapping:Ap,ReplaceStencilOp:oQe,ReverseSubtractEquation:kne,RingGeometry:AL,SIGNED_RED_GREEN_RGTC2_Format:UR,SIGNED_RED_RGTC1_Format:VR,SRGBColorSpace:co,SRGBTransfer:Or,Scene:jH,ShaderChunk:mn,ShaderLib:ca,ShaderMaterial:Qc,ShadowMaterial:Gre,Shape:Cg,ShapeGeometry:IL,ShapePath:pXe,ShapeUtils:wh,ShortType:IH,Skeleton:rS,SkeletonHelper:tXe,SkinnedMesh:ZH,Source:dp,Sphere:Hs,SphereGeometry:ov,Spherical:K7e,SphericalHarmonics3:nse,SplineCurve:n5,SpotLight:f5,SpotLightHelper:eXe,Sprite:Tre,SpriteMaterial:QH,SrcAlphaFactor:aR,SrcAlphaSaturateFactor:$ne,SrcColorFactor:Bne,StaticCopyUsage:CQe,StaticDrawUsage:uC,StaticReadUsage:bQe,StereoCamera:R7e,StreamCopyUsage:OQe,StreamDrawUsage:xQe,StreamReadUsage:_Qe,StringKeyframeTrack:lv,SubtractEquation:Ine,SubtractiveBlending:SV,TOUCH:Z9e,TangentSpaceNormalMap:Up,TetrahedronGeometry:kL,Texture:ds,TextureLoader:Jre,TextureUtils:bXe,TimestampQuery:TQe,TorusGeometry:DL,TorusKnotGeometry:LL,Triangle:hl,TriangleFanDrawMode:HR,TriangleStripDrawMode:GH,TrianglesDrawMode:are,TubeGeometry:FL,UVMapping:rL,Uint16BufferAttribute:WH,Uint32BufferAttribute:qH,Uint8BufferAttribute:hZe,Uint8ClampedBufferAttribute:dZe,Uniform:b5,UniformsGroup:Z7e,UniformsLib:mi,UniformsUtils:tS,UnsignedByteType:Dh,UnsignedInt248Type:V0,UnsignedInt5999Type:kH,UnsignedIntType:Kd,UnsignedShort4444Type:aL,UnsignedShort5551Type:lL,UnsignedShortType:z0,VSMShadowMap:th,Vector2:Xt,Vector3:Ie,Vector4:Mn,VectorKeyframeTrack:jg,VideoFrameTexture:kZe,VideoTexture:Ere,WebGL3DRenderTarget:YQe,WebGLArrayRenderTarget:KQe,WebGLCoordinateSystem:wu,WebGLCubeRenderTarget:Ore,WebGLRenderTarget:Lh,WebGLRenderer:bse,WebGLUtils:xse,WebGPUCoordinateSystem:hC,WebXRController:VM,WireframeGeometry:r5,WrapAroundEnding:lC,ZeroCurvatureEnding:ig,ZeroFactor:Fne,ZeroSlopeEnding:ng,ZeroStencilOp:sQe,createCanvasElement:bre},Symbol.toStringTag,{value:"Module"})),xQ=(t,e)=>{if(t===e)return!0;if(!t||!e)return!1;const i=t.length;if(e.length!==i)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0},rtt=()=>{const t=[],n={items:t,remember:(r,s)=>{for(let a=0;a<t.length;a++){const l=t[a];if(xQ(s,l.keys)&&l.promise)return l.promise}const o={promise:r(),keys:s};return t.push(o),o.promise},clear:r=>{for(let s=0;s<t.length;s++){const o=t[s];if(xQ(r,o.keys)){t.splice(s,1);return}}}};return ks("threlte-cache",n),n},stt=()=>{const t=Xi("threlte-cache");if(!t)throw new Error("No cache found. The cache can only be used in a child component to <Canvas>.");return t},bQ=Symbol(),ott=t=>typeof t?.subscribe=="function",wse=(t,e,i)=>{const n=t().map(o=>ott(o)?Fle(o):bQ),r=Vt(()=>t().map((o,a)=>n[a]===bQ?o:n[a].current)),s=()=>{B(r);let o;return Og(()=>{o=e(B(r))}),o};i?as(s):On(s)},att=(t,e)=>wse(t,e,!1),ltt=(t,e)=>wse(t,e,!0),ctt=Object.assign(att,{pre:ltt}),Mc=(t,e)=>t?.[`is${e}`]===!0,HB=t=>{const e=gr(void 0),i=gr(void 0);return t.then(n=>{e.set(n)}).catch(n=>{console.error("Error in asyncWritable:",n.message),i.set(n)}),Object.assign(Object.assign(t,e),{error:i,promise:t})},utt=typeof window<"u",Ro=(t,e)=>{const i=ga(t,s=>s);let n;const r=i.subscribe(async s=>{n&&n();const o=await e(s);o&&(n=o)});As(()=>{r(),n&&n()})},Dn=t=>{const e=gr(t),i={set:n=>{i.current=n,e.set(n)},subscribe:e.subscribe,update:n=>{const r=n(i.current);i.current=r,e.set(r)},current:t};return i},htt=t=>({subscribe:t.subscribe,get current(){return t.current}}),_se=(t,e)=>{if(e.includes(".")){const i=e.split("."),n=i.pop();for(let r=0;r<i.length;r+=1)t=t[i[r]];return{target:t,key:n}}else return{target:t,key:e}},dtt=t=>{const{dom:e,canvas:i}=t,n=Dn({width:e.offsetWidth,height:e.offsetHeight});Xo(()=>{const s=new ResizeObserver(()=>{const{offsetWidth:o,offsetHeight:a}=e;(n.current.width!==o||n.current.height!==a)&&n.set({width:o,height:a})});return s.observe(e),()=>{s.disconnect()}});const r={dom:e,canvas:i,size:htt(n)};return ks("threlte-dom-context",r),r},zL=()=>{const t=Xi("threlte-dom-context");if(!t)throw new Error("useDOM can only be used in a child component to <Canvas>.");return t};function ftt(t){return{all:t=t||new Map,on:function(e,i){var n=t.get(e);n?n.push(i):t.set(e,[i])},off:function(e,i){var n=t.get(e);n&&(i?n.splice(n.indexOf(i)>>>0,1):t.set(e,[]))},emit:function(e,i){var n=t.get(e);n&&n.slice().map(function(r){r(i)}),(n=t.get("*"))&&n.slice().map(function(r){r(e,i)})}}}class tp{allVertices={};isolatedVertices={};connectedVertices={};sortedConnectedValues=[];needsSort=!1;emitter=ftt();emit=this.emitter.emit.bind(this.emitter);on=this.emitter.on.bind(this.emitter);off=this.emitter.off.bind(this.emitter);get sortedVertices(){return this.mapNodes(e=>e)}moveToIsolated(e){const i=this.connectedVertices[e];i&&(this.isolatedVertices[e]=i,delete this.connectedVertices[e])}moveToConnected(e){const i=this.isolatedVertices[e];i&&(this.connectedVertices[e]=i,delete this.isolatedVertices[e])}getKey=e=>typeof e=="object"?e.key:e;add(e,i,n){if(this.allVertices[e]&&this.allVertices[e].value!==void 0)throw new Error(`A node with the key ${e.toString()} already exists`);let r=this.allVertices[e];r?r.value===void 0&&(r.value=i):(r={value:i,previous:new Set,next:new Set},this.allVertices[e]=r);const s=r.next.size>0||r.previous.size>0;if(!n?.after&&!n?.before&&!s){this.isolatedVertices[e]=r,this.emit("node:added",{key:e,type:"isolated",value:i});return}else this.connectedVertices[e]=r;if(n?.after){const o=Array.isArray(n.after)?n.after:[n.after];o.forEach(a=>{r.previous.add(this.getKey(a))}),o.forEach(a=>{const l=this.getKey(a),u=this.allVertices[l];u?(u.next.add(e),this.moveToConnected(l)):(this.allVertices[l]={value:void 0,previous:new Set,next:new Set([e])},this.connectedVertices[l]=this.allVertices[l])})}if(n?.before){const o=Array.isArray(n.before)?n.before:[n.before];o.forEach(a=>{r.next.add(this.getKey(a))}),o.forEach(a=>{const l=this.getKey(a),u=this.allVertices[l];u?(u.previous.add(e),this.moveToConnected(l)):(this.allVertices[l]={value:void 0,previous:new Set([e]),next:new Set},this.connectedVertices[l]=this.allVertices[l])})}this.emit("node:added",{key:e,type:"connected",value:i}),this.needsSort=!0}remove(e){const i=this.getKey(e);if(this.isolatedVertices[i]){delete this.isolatedVertices[i],delete this.allVertices[i],this.emit("node:removed",{key:i,type:"isolated"});return}const r=this.connectedVertices[i];r&&(r.next.forEach(s=>{const o=this.connectedVertices[s];o&&(o.previous.delete(i),o.previous.size===0&&o.next.size===0&&this.moveToIsolated(s))}),r.previous.forEach(s=>{const o=this.connectedVertices[s];o&&(o.next.delete(i),o.previous.size===0&&o.next.size===0&&this.moveToIsolated(s))}),delete this.connectedVertices[i],delete this.allVertices[i],this.emit("node:removed",{key:i,type:"connected"}),this.needsSort=!0)}mapNodes(e){this.needsSort&&this.sort();const i=[];return this.forEachNode((n,r)=>{i.push(e(n,r))}),i}forEachNode(e){this.needsSort&&this.sort();let i=0;for(;i<this.sortedConnectedValues.length;i++)e(this.sortedConnectedValues[i],i);Reflect.ownKeys(this.isolatedVertices).forEach(n=>{const r=this.isolatedVertices[n];r.value!==void 0&&e(r.value,i++)})}getValueByKey(e){return this.allVertices[e]?.value}getKeyByValue(e){return Reflect.ownKeys(this.connectedVertices).find(i=>this.connectedVertices[i].value===e)??Reflect.ownKeys(this.isolatedVertices).find(i=>this.isolatedVertices[i].value===e)}sort(){const e=new Map,i=[],n=[],r=Reflect.ownKeys(this.connectedVertices).filter(o=>this.connectedVertices[o].value!==void 0);for(r.forEach(o=>{e.set(o,0)}),r.forEach(o=>{this.connectedVertices[o].next.forEach(l=>{this.connectedVertices[l]&&e.set(l,(e.get(l)||0)+1)})}),e.forEach((o,a)=>{o===0&&i.push(a)});i.length>0;){const o=i.shift();n.push(o);const a=r.find(l=>l===o);a&&this.connectedVertices[a]?.next.forEach(l=>{const u=(e.get(l)||0)-1;e.set(l,u),u===0&&i.push(l)})}if(n.length!==r.length)throw new Error("The graph contains a cycle, and thus can not be sorted topologically.");const s=o=>o!==void 0;this.sortedConnectedValues=n.map(o=>this.connectedVertices[o].value).filter(s),this.needsSort=!1}clear(){this.allVertices={},this.isolatedVertices={},this.connectedVertices={},this.sortedConnectedValues=[],this.needsSort=!1}static isKey(e){return typeof e=="string"||typeof e=="symbol"}static isValue(e){return typeof e=="object"&&"key"in e}}class ptt{key;stage;callback;runTask=!0;stop(){this.runTask=!1}start(){this.runTask=!0}constructor(e,i,n){this.stage=e,this.key=i,this.callback=n}run(e){this.runTask&&this.callback(e)}}class mtt extends tp{key;scheduler;runTask=!0;stop(){this.runTask=!1}start(){this.runTask=!0}get tasks(){return this.sortedVertices}callback=(e,i)=>i();constructor(e,i,n){super(),this.scheduler=e,this.key=i,this.start=this.start.bind(this),this.stop=this.stop.bind(this),n&&(this.callback=n.bind(this))}createTask(e,i,n){const r=new ptt(this,e,i);return this.add(e,r,n),r}getTask(e){return this.getValueByKey(e)}removeTask=this.remove.bind(this);run(e){this.runTask&&this.callback(e,i=>{this.forEachNode(n=>{n.run(i??e)})})}runWithTiming(e){if(!this.runTask)return{};const i={};return this.callback(e,n=>{this.forEachNode(r=>{const s=performance.now();r.run(n??e);const o=performance.now()-s;i[r.key]=o})}),i}getSchedule(){return this.mapNodes(e=>e.key.toString())}}class gtt extends tp{lastTime=performance.now();clampDeltaTo=.1;get stages(){return this.sortedVertices}constructor(e){super(),e?.clampDeltaTo&&(this.clampDeltaTo=e.clampDeltaTo),this.run=this.run.bind(this)}createStage(e,i){const n=new mtt(this,e,i?.callback);return this.add(e,n,{after:i?.after,before:i?.before}),n}getStage(e){return this.getValueByKey(e)}removeStage=this.remove.bind(this);run(e){const i=e-this.lastTime;this.forEachNode(n=>{n.run(Math.min(i/1e3,this.clampDeltaTo))}),this.lastTime=e}runWithTiming(e){const i=e-this.lastTime,n={},r=performance.now();return this.forEachNode(s=>{const o=performance.now(),a=s.runWithTiming(Math.min(i/1e3,this.clampDeltaTo)),l=performance.now()-o;n[s.key.toString()]={duration:l,tasks:a}}),{total:performance.now()-r,stages:n}}getSchedule(e={tasks:!0}){return{stages:this.mapNodes(i=>{if(i===void 0)throw new Error("Stage not found");return{key:i.key.toString(),tasks:e.tasks?i.getSchedule():void 0}})}}dispose(){this.clear()}}const vtt=t=>{const e=new gtt,i=e.createStage(Symbol("threlte-main-stage")),n={scheduler:e,frameInvalidated:!0,autoInvalidations:new Set,shouldAdvance:!1,advance:()=>{n.shouldAdvance=!0},autoRender:Dn(t.autoRender??!0),renderMode:Dn(t.renderMode??"on-demand"),invalidate(){n.frameInvalidated=!0},mainStage:i,shouldRender:()=>n.renderMode.current==="always"||n.renderMode.current==="on-demand"&&(n.frameInvalidated||n.autoInvalidations.size>0)||n.renderMode.current==="manual"&&n.shouldAdvance,renderStage:e.createStage(Symbol("threlte-render-stage"),{after:i,callback(r,s){n.shouldRender()&&s()}}),resetFrameInvalidation(){n.frameInvalidated=!1,n.shouldAdvance=!1}};return On(()=>{n.autoRender.set(t.autoRender??!0)}),On(()=>{n.renderMode.set(t.renderMode??"on-demand")}),As(()=>{n.scheduler.dispose()}),ks("threlte-scheduler-context",n),n},VL=()=>{const t=Xi("threlte-scheduler-context");if(!t)throw new Error("useScheduler can only be used in a child component to <Canvas>.");return t},ytt=()=>{const{size:t}=zL(),{invalidate:e}=VL(),i=new ho(75,0,.1,1e3);i.position.z=5,i.lookAt(0,0,0);const n=Dn(i);Ro(t,s=>{if(n.current===i){const o=n.current;o.aspect=s.width/s.height,o.updateProjectionMatrix(),e()}});const r={camera:n};return ks("threlte-camera-context",r),r},Cse=()=>{const t=Xi("threlte-camera-context");if(!t)throw new Error("useCamera can only be used in a child component to <Canvas>.");return t},xtt=()=>{const t={removeObjectFromDisposal:e=>{t.disposableObjects.delete(e)},disposableObjectMounted:e=>{const i=t.disposableObjects.get(e);i?t.disposableObjects.set(e,i+1):t.disposableObjects.set(e,1)},disposableObjectUnmounted:e=>{const i=t.disposableObjects.get(e);i&&i>0&&(t.disposableObjects.set(e,i-1),i-1<=0&&(t.shouldDispose=!0))},disposableObjects:new Map,shouldDispose:!1,dispose:async(e=!1)=>{await Hc(),!(!t.shouldDispose&&!e)&&(t.disposableObjects.forEach((i,n)=>{(i===0||e)&&(n?.dispose?.(),t.disposableObjects.delete(n))}),t.shouldDispose=!1)}};return As(()=>{t.dispose(!0)}),ks("threlte-disposal-context",t),t},Sse=()=>{const t=Xi("threlte-disposal-context");if(!t)throw new Error("useDisposal can only be used in a child component to <Canvas>.");return t},Ose=Symbol("threlte-parent-context"),Mse=t=>{const e=Dn(t);return ks(Ose,e),e},btt=()=>Xi(Ose),QR=Symbol("threlte-parent-object3d-context"),wtt=t=>{const e=KV(t);return ks(QR,e),e},_tt=t=>{const e=Xi(QR),i=gr(t),n=ga([i,e],([r,s])=>r??s);return ks(QR,n),i},Ctt=()=>Xi(QR);function Ip(t,e,i){if(!utt)return{task:void 0,start:()=>{},stop:()=>{},started:KV(!1)};let n,r,s;tp.isKey(t)?(n=t,r=e,s=i):(n=Symbol("useTask"),r=t,s=e);const o=VL();let a=o.mainStage;if(s){if(s.stage)if(tp.isValue(s.stage))a=s.stage;else{const v=o.scheduler.getStage(s.stage);if(!v)throw new Error(`No stage found with key ${s.stage.toString()}`);a=v}else if(s.after)if(Array.isArray(s.after))for(let v=0;v<s.after.length;v++){const y=s.after[v];if(tp.isValue(y)){a=y.stage;break}}else tp.isValue(s.after)&&(a=s.after.stage);else if(s.before)if(Array.isArray(s.before))for(let v=0;v<s.before.length;v++){const y=s.before[v];if(tp.isValue(y)){a=y.stage;break}}else tp.isValue(s.before)&&(a=s.before.stage)}const l=gr(!1),u=a.createTask(n,r,s),d=()=>{l.set(!0),(s?.autoInvalidate??!0)&&o.autoInvalidations.add(r),u.start()},p=()=>{l.set(!1),(s?.autoInvalidate??!0)&&o.autoInvalidations.delete(r),u.stop()};return s?.autoStart??!0?d():p(),As(()=>{p(),a.removeTask(n)}),{task:u,start:d,stop:p,started:{subscribe:l.subscribe}}}const Stt=t=>{const e={scene:new jH};return ks("threlte-scene-context",e),e},Tse=()=>{const t=Xi("threlte-scene-context");if(!t)throw new Error("useScene can only be used in a child component to <Canvas>.");return t},Ott=t=>{const{dispose:e}=Sse(),{camera:i}=Cse(),{scene:n}=Tse(),{invalidate:r,renderStage:s,autoRender:o,scheduler:a,resetFrameInvalidation:l}=VL(),{size:u,canvas:d}=zL(),p=t.createRenderer?t.createRenderer(d):new bse({canvas:d,powerPreference:"high-performance",antialias:!0,alpha:!0}),v=s.createTask(Symbol("threlte-auto-render-task"),()=>{p.render(n,i.current)}),y={renderer:p,colorManagementEnabled:Dn(t.colorManagementEnabled??!0),colorSpace:Dn(t.colorSpace??"srgb"),dpr:Dn(t.dpr??window.devicePixelRatio),shadows:Dn(t.shadows??c_),toneMapping:Dn(t.toneMapping??gR),autoRenderTask:v};ks("threlte-renderer-context",y),Ro([y.colorManagementEnabled],([O])=>{Xn.enabled=O}),Ro([y.colorSpace],([O])=>{"outputColorSpace"in p&&(p.outputColorSpace=O)}),Ro([y.dpr],([O])=>{"setPixelRatio"in p&&p.setPixelRatio(O)});const{start:w,stop:R}=Ip(()=>{!("xr"in p)||p.xr?.isPresenting||(p.setSize(u.current.width,u.current.height),r(),R())},{before:v,autoStart:!1,autoInvalidate:!1});return Ro([u],()=>{w()}),Ro([y.shadows],([O])=>{"shadowMap"in p&&(p.shadowMap.enabled=!!O,O&&O!==!0?p.shadowMap.type=O:O===!0&&(p.shadowMap.type=c_))}),Ro([y.toneMapping],([O])=>{"toneMapping"in p&&(p.toneMapping=O)}),Ro([o],([O])=>(O?y.autoRenderTask.start():y.autoRenderTask.stop(),()=>{y.autoRenderTask.stop()})),"setAnimationLoop"in y.renderer&&y.renderer.setAnimationLoop(P=>{e(),a.run(P),l()}),As(()=>{if("dispose"in y.renderer){const O=y.renderer.dispose;O()}}),On(()=>{y.colorManagementEnabled.set(t.colorManagementEnabled??!0)}),On(()=>{y.colorSpace.set(t.colorSpace??"srgb")}),On(()=>{y.toneMapping.set(t.toneMapping??gR)}),On(()=>{y.shadows.set(t.shadows??c_)}),On(()=>{y.dpr.set(t.dpr??window.devicePixelRatio)}),y},Mtt=()=>{const t=Xi("threlte-renderer-context");if(!t)throw new Error("useRenderer can only be used in a child component to <Canvas>.");return t},Ttt=()=>{const t=Dn({});return ks("threlte-user-context",t),t},Rtt=t=>{const{scene:e}=Stt();return{scene:e,...dtt(t),...rtt(),...Mse(e),...wtt(e),...xtt(),...vtt(t),...ytt(),...Ott(t),...Ttt()}};function Ptt(t,e){Pi(e,!0);let i=_C(e,["$$slots","$$events","$$legacy","children"]);Rtt(i);var n=nn(),r=pi(n);hs(r,()=>e.children),bt(t,n),Ei()}var Ett=hi('<div class="svelte-1osucwe"><canvas class="svelte-1osucwe"><!></canvas></div>');function Att(t,e){let i=_C(e,["$$slots","$$events","$$legacy","children"]),n=Fn(void 0),r=Fn(void 0);var s=Ett(),o=Di(s),a=Di(o);{var l=u=>{Ptt(u,iZ({get dom(){return B(r)},get canvas(){return B(n)}},()=>i,{children:(d,p)=>{var v=nn(),y=pi(v);hs(y,()=>e.children??to),bt(d,v)},$$slots:{default:!0}}))};Yi(a,u=>{B(n)&&B(r)&&u(l)})}_i(o),es(o,u=>rt(n,u),()=>B(n)),_i(s),es(s,u=>rt(r,u),()=>B(r)),bt(t,s)}const Iu=()=>{const t=VL(),e=Mtt(),i=Cse(),n=Tse(),r=zL();return{advance:t.advance,autoRender:t.autoRender,autoRenderTask:e.autoRenderTask,camera:i.camera,colorManagementEnabled:e.colorManagementEnabled,colorSpace:e.colorSpace,dpr:e.dpr,invalidate:t.invalidate,mainStage:t.mainStage,renderer:e.renderer,renderMode:t.renderMode,renderStage:t.renderStage,scheduler:t.scheduler,shadows:e.shadows,shouldRender:t.shouldRender,dom:r.dom,canvas:r.canvas,size:r.size,toneMapping:e.toneMapping,get scene(){return n.scene},set scene(o){n.scene=o}}},Itt=t=>typeof t=="object"&&t!==null,ktt=()=>{const{invalidate:t}=Iu();let e;const i=gr(),n=btt(),r=Ctt(),s=Mse(),o=_tt();Ro([i,s,n,r],([u,d,p,v])=>{if(e?.(),e=void 0,!d){t();return}if(u!==void 0){if(u){if(typeof u=="function")e=u({ref:d,parent:p,parentObject3D:v});else if(Mc(u,"Object3D")&&Mc(d,"Object3D"))e=()=>u?.remove(d),u?.add(d);else if(typeof u=="string"){const{target:y,key:w}=_se(p,u),R=y[w];e=()=>y[w]=R,y[w]=d}}}else Mc(d,"Object3D")?(e=()=>v?.remove(d),v?.add(d)):Itt(p)&&(Mc(d,"Material")?p.material=d:Mc(d,"BufferGeometry")&&(p.geometry=d));t()});const a=u=>{i.set(u)},l=u=>{s.set(u),Mc(u,"Object3D")&&o.set(u)};return As(()=>{e?.(),t()}),{updateRef:l,updateAttach:a}},Dtt=t=>Mc(t,"PerspectiveCamera")||Mc(t,"OrthographicCamera"),Ltt=()=>{const{invalidate:t,size:e,camera:i}=Iu(),n=gr(),r=gr(!0),s=gr(!1);return Ro([n,s],([u,d])=>{!u||!d||(i.set(u),t())}),Ro([n,r,e],([u,d,p])=>{!u||d||(Mc(u,"OrthographicCamera")?(u.left=p.width/-2,u.right=p.width/2,u.top=p.height/2,u.bottom=p.height/-2,u.updateProjectionMatrix(),u.updateMatrixWorld(),t()):Mc(u,"PerspectiveCamera")&&(u.aspect=p.width/p.height,u.updateProjectionMatrix(),u.updateMatrixWorld(),t()))}),{updateRef:u=>{Dtt(u)&&n.set(u)},updateManual:u=>{r.set(u)},updateMakeDefault:u=>{s.set(u)}}},Ftt=t=>{let e,i,n=!1;const r=()=>{e?.(),e=t?.(i)},s=o=>{i=o,n&&r()};return Xo(()=>{r(),n=!0}),As(()=>e?.()),{updateRef:s}},wQ=Symbol("threlte-disposable-object-context"),Ntt=t=>typeof t?.dispose=="function"&&!Mc(t,"Scene"),Btt=t=>{let e;const i=gr(void 0),n=gr(t),{disposableObjectMounted:r,disposableObjectUnmounted:s,removeObjectFromDisposal:o}=Sse(),a=Xi(wQ),l=ga([n,a??gr(!0)],([p,v])=>p??v??!0);return ks(wQ,l),Ro([i,l],([p,v])=>{p===e?v?e&&r(e):e&&o(e):v&&(e&&s(e),p&&r(p)),e=p}),As(()=>{if(!Mg(l))return;const p=Mg(i);p&&s(p)}),{updateRef:p=>{Ntt(p)&&i.set(p)},updateDispose:p=>{n.set(p)}}},ztt=t=>t!==null&&typeof t=="object"&&"addEventListener"in t&&"removeEventListener"in t,Vtt=(t={})=>{const e=r=>{r?.type&&t[`on${r.type}`]?.(r)},i=(r,s)=>{const o=[];for(const a of Object.keys(s))a.startsWith("on")&&(r.addEventListener(a.slice(2),e),o.push(a));return()=>{for(let a=0;a<o.length;a++)r.removeEventListener(o[a],e)}};return{updateRef:r=>{if(ztt(r))return i(r,t)}}};let NV;const Gtt=t=>{NV=t},Utt=()=>{const t=NV;return NV=void 0,t},Htt=t=>{const i=Xi("threlte-plugin-context");if(!i)return;const n=[],r=Object.values(i);if(r.length){const s=t();for(let o=0;o<r.length;o++){const a=r[o],l=a(s);l&&l.pluginProps&&n.push(...l.pluginProps)}}return{pluginsProps:n}},$tt=new Set(["$$scope","$$slots","type","args","attach","instance"]),Wtt=new Set(["fov","aspect","near","far","left","right","top","bottom","zoom"]),qtt=t=>typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t>"u"||t===null,_Q=(t,e,i)=>!Array.isArray(i)&&typeof i=="number"&&typeof t[e]?.setScalar=="function"&&!t[e]?.isColor?(n,r,s)=>{n[r].setScalar(s)}:typeof t[e]?.set=="function"?Array.isArray(i)?(n,r,s)=>{n[r].set(...s)}:(n,r,s)=>{n[r].set(s)}:(n,r,s)=>{n[r]=s},jtt=()=>{const{invalidate:t}=Iu(),e=new Map,i=new Map,n=(s,o,a,l)=>{if(qtt(a)){const p=e.get(o);if(p&&p.instance===s&&p.value===a)return;e.set(o,{instance:s,value:a})}const{key:u,target:d}=_se(s,o);if(a!=null){const p=i.get(o);if(p)p(d,u,a);else{const v=_Q(d,u,a);i.set(o,v),v(d,u,a)}}else _Q(d,u,a)(d,u,a);l.manualCamera||Wtt.has(u)&&(d.isPerspectiveCamera||d.isOrthographicCamera)&&d.updateProjectionMatrix()};return{updateProp:(s,o,a,l)=>{!$tt.has(o)&&!l.pluginsProps?.includes(o)&&n(s,o,a,l),t()}}},Qtt=/^\s*class\s+/,Ztt=t=>typeof t!="function"?!1:Qtt.test(t.toString()),Xtt=t=>Array.isArray(t),Ktt=(t,e)=>Ztt(t)?Xtt(e)?new t(...e):new t:t;function $B(t,e){Pi(e,!0);let i=ht(e,"is",19,Utt),n=ht(e,"manual",3,!1),r=ht(e,"makeDefault",3,!1),s=ht(e,"ref",15),o=_C(e,["$$slots","$$events","$$legacy","is","args","attach","manual","makeDefault","dispose","ref","oncreate","children"]),a=Vt(()=>Ktt(i(),e.args));const l=Ftt(e.oncreate);as(()=>{s()!==B(a)&&(s(B(a)),l.updateRef(B(a)))});const u=Htt(()=>({get ref(){return B(a)},get args(){return e.args},get attach(){return e.attach},get manual(){return n()},get makeDefault(){return r()},get dispose(){return e.dispose},get props(){return o}})),{updateProp:d}=jtt();Object.keys(o).forEach(P=>{as(()=>{d(B(a),P,o[P],{manualCamera:n(),pluginsProps:u?.pluginsProps})})});const p=ktt();as(()=>p.updateAttach(e.attach)),as(()=>p.updateRef(B(a)));const v=Ltt();as(()=>v.updateRef(B(a))),as(()=>v.updateManual(n())),as(()=>v.updateMakeDefault(r()));const y=Btt(e.dispose);as(()=>y.updateRef(B(a))),as(()=>y.updateDispose(e.dispose));const w=Vtt(o);as(()=>w.updateRef(B(a)));var R=nn(),O=pi(R);hs(O,()=>e.children??to,()=>({ref:B(a)})),bt(t,R),Ei()}const Ytt={},Nr=new Proxy(function(){},{apply(t,e,i){return $B(...i)},get(t,e){if(typeof e!="string")return $B;const i=Ytt[e]||ntt[e];if(i===void 0)throw new Error(`No Three.js module found for ${e}. Did you forget to extend the catalogue?`);return Gtt(i),$B}});function Jtt(t,e){const i="threlte-plugin-context";e&&ks(i,{...Xi(i),[t]:e})}function eit(t,e){const{remember:i,clear:n}=stt();let r;const s=()=>{const l=new t(...e?.args??[]);return e?.extend?.(l),l};return{load:(l,u)=>{const d=async p=>{if(r||(r=s()),"loadAsync"in r){const v=await r.loadAsync(p,u?.onProgress);return u?.transform?.(v)??v}else return new Promise((v,y)=>{r.load(p,w=>v(u?.transform?.(w)??w),w=>u?.onProgress?.(w),y)})};if(Array.isArray(l)){const p=l.map(y=>i(()=>d(y),[t,y]));return HB(Promise.all(p))}else if(typeof l=="string"){const p=i(()=>d(l),[t,l]);return HB(p)}else{const p=Object.values(l).map(y=>i(()=>d(y),[t,y]));return HB(Promise.all(p).then(y=>Object.fromEntries(Object.entries(l).map(([w],R)=>[w,y[R]]))))}},clear:l=>{Array.isArray(l)?l.forEach(u=>{n([t,u])}):typeof l=="string"?n([t,l]):Object.entries(l).forEach(([u,d])=>{n([t,u,d])})},loader:r}}function CQ(t,e){if(e===are)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===HR||e===GH){let i=t.getIndex();if(i===null){const o=[],a=t.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);t.setIndex(o),i=t.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t}const n=i.count-2,r=[];if(e===HR)for(let o=1;o<=n;o++)r.push(i.getX(0)),r.push(i.getX(o)),r.push(i.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(r.push(i.getX(o)),r.push(i.getX(o+1)),r.push(i.getX(o+2))):(r.push(i.getX(o+2)),r.push(i.getX(o+1)),r.push(i.getX(o)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=t.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}class S5 extends Xa{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new sit(i)}),this.register(function(i){return new oit(i)}),this.register(function(i){return new mit(i)}),this.register(function(i){return new git(i)}),this.register(function(i){return new vit(i)}),this.register(function(i){return new lit(i)}),this.register(function(i){return new cit(i)}),this.register(function(i){return new uit(i)}),this.register(function(i){return new hit(i)}),this.register(function(i){return new rit(i)}),this.register(function(i){return new dit(i)}),this.register(function(i){return new ait(i)}),this.register(function(i){return new pit(i)}),this.register(function(i){return new fit(i)}),this.register(function(i){return new iit(i)}),this.register(function(i){return new yit(i)}),this.register(function(i){return new xit(i)})}load(e,i,n,r){const s=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const u=wp.extractUrlBase(e);o=wp.resolveURL(u,this.path)}else o=wp.extractUrlBase(e);this.manager.itemStart(e);const a=function(u){r?r(u):console.error(u),s.manager.itemError(e),s.manager.itemEnd(e)},l=new Tu(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(u){try{s.parse(u,o,function(d){i(d),s.manager.itemEnd(e)},a)}catch(d){a(d)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,n,r){let s;const o={},a={},l=new TextDecoder;if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===Rse){try{o[Kn.KHR_BINARY_GLTF]=new bit(e)}catch(p){r&&r(p);return}s=JSON.parse(o[Kn.KHR_BINARY_GLTF].content)}else s=JSON.parse(l.decode(e));else s=e;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new kit(s,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const p=this.pluginCallbacks[d](u);p.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[p.name]=p,o[p.name]=!0}if(s.extensionsUsed)for(let d=0;d<s.extensionsUsed.length;++d){const p=s.extensionsUsed[d],v=s.extensionsRequired||[];switch(p){case Kn.KHR_MATERIALS_UNLIT:o[p]=new nit;break;case Kn.KHR_DRACO_MESH_COMPRESSION:o[p]=new wit(s,this.dracoLoader);break;case Kn.KHR_TEXTURE_TRANSFORM:o[p]=new _it;break;case Kn.KHR_MESH_QUANTIZATION:o[p]=new Cit;break;default:v.indexOf(p)>=0&&a[p]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+p+'".')}}u.setExtensions(o),u.setPlugins(a),u.parse(n,r)}parseAsync(e,i){const n=this;return new Promise(function(r,s){n.parse(e,i,r,s)})}}function tit(){let t={};return{get:function(e){return t[e]},add:function(e,i){t[e]=i},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const Kn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class iit{constructor(e){this.parser=e,this.name=Kn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let n=0,r=i.length;n<r;n++){const s=i[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const i=this.parser,n="light:"+e;let r=i.cache.get(n);if(r)return r;const s=i.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let u;const d=new Si(16777215);l.color!==void 0&&d.setRGB(l.color[0],l.color[1],l.color[2],ma);const p=l.range!==void 0?l.range:0;switch(l.type){case"directional":u=new m5(d),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new p5(d),u.distance=p;break;case"spot":u=new f5(d),u.distance=p,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,u.angle=l.spot.outerConeAngle,u.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return u.position.set(0,0,0),gd(u,l),l.intensity!==void 0&&(u.intensity=l.intensity),u.name=i.createUniqueName(l.name||"light_"+e),r=Promise.resolve(u),i.cache.add(n,r),r}getDependency(e,i){if(e==="light")return this._loadLight(i)}createNodeAttachment(e){const i=this,n=this.parser,s=n.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return n._getNodeRef(i.cache,a,l)})}}class nit{constructor(){this.name=Kn.KHR_MATERIALS_UNLIT}getMaterialType(){return vl}extendParams(e,i,n){const r=[];e.color=new Si(1,1,1),e.opacity=1;const s=i.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],ma),e.opacity=o[3]}s.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",s.baseColorTexture,co))}return Promise.all(r)}}class rit{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,i){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(i.emissiveIntensity=s),Promise.resolve()}}class sit{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Yc}extendMaterialParams(e,i){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(i.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(n.assignTexture(i,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(i,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(i,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new Xt(a,a)}return Promise.all(s)}}class oit{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Yc}extendMaterialParams(e,i){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return i.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class ait{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Yc}extendMaterialParams(e,i){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(i.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(n.assignTexture(i,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(i.iridescenceIOR=o.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(i,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class lit{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Yc}extendMaterialParams(e,i){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];i.sheenColor=new Si(0,0,0),i.sheenRoughness=0,i.sheen=1;const o=r.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;i.sheenColor.setRGB(a[0],a[1],a[2],ma)}return o.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(n.assignTexture(i,"sheenColorMap",o.sheenColorTexture,co)),o.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(i,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class cit{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Yc}extendMaterialParams(e,i){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(i.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(n.assignTexture(i,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class uit{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Yc}extendMaterialParams(e,i){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];i.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(n.assignTexture(i,"thicknessMap",o.thicknessTexture)),i.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return i.attenuationColor=new Si().setRGB(a[0],a[1],a[2],ma),Promise.all(s)}}class hit{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Yc}extendMaterialParams(e,i){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return i.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class dit{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Yc}extendMaterialParams(e,i){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];i.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(n.assignTexture(i,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return i.specularColor=new Si().setRGB(a[0],a[1],a[2],ma),o.specularColorTexture!==void 0&&s.push(n.assignTexture(i,"specularColorMap",o.specularColorTexture,co)),Promise.all(s)}}class fit{constructor(e){this.parser=e,this.name=Kn.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Yc}extendMaterialParams(e,i){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return i.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(n.assignTexture(i,"bumpMap",o.bumpTexture)),Promise.all(s)}}class pit{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Yc}extendMaterialParams(e,i){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.anisotropyStrength!==void 0&&(i.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(i.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(n.assignTexture(i,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class mit{constructor(e){this.parser=e,this.name=Kn.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=i.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,s.source,o)}}class git{constructor(e){this.parser=e,this.name=Kn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const i=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[i])return null;const o=s.extensions[i],a=r.images[o.source];let l=n.textureLoader;if(a.uri){const u=n.options.manager.getHandler(a.uri);u!==null&&(l=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class vit{constructor(e){this.parser=e,this.name=Kn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const i=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[i])return null;const o=s.extensions[i],a=r.images[o.source];let l=n.textureLoader;if(a.uri){const u=n.options.manager.getHandler(a.uri);u!==null&&(l=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class yit{constructor(e){this.name=Kn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,n=i.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const l=r.byteOffset||0,u=r.byteLength||0,d=r.count,p=r.byteStride,v=new Uint8Array(a,l,u);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(d,p,v,r.mode,r.filter).then(function(y){return y.buffer}):o.ready.then(function(){const y=new ArrayBuffer(d*p);return o.decodeGltfBuffer(new Uint8Array(y),d,p,v,r.mode,r.filter),y})})}else return null}}class xit{constructor(e){this.name=Kn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const i=this.parser.json,n=i.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const r=i.meshes[n.mesh];for(const u of r.primitives)if(u.mode!==wc.TRIANGLES&&u.mode!==wc.TRIANGLE_STRIP&&u.mode!==wc.TRIANGLE_FAN&&u.mode!==void 0)return null;const o=n.extensions[this.name].attributes,a=[],l={};for(const u in o)a.push(this.parser.getDependency("accessor",o[u]).then(d=>(l[u]=d,l[u])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(u=>{const d=u.pop(),p=d.isGroup?d.children:[d],v=u[0].count,y=[];for(const w of p){const R=new sn,O=new Ie,P=new pa,N=new Ie(1,1,1),F=new bL(w.geometry,w.material,v);for(let k=0;k<v;k++)l.TRANSLATION&&O.fromBufferAttribute(l.TRANSLATION,k),l.ROTATION&&P.fromBufferAttribute(l.ROTATION,k),l.SCALE&&N.fromBufferAttribute(l.SCALE,k),F.setMatrixAt(k,R.compose(O,P,N));for(const k in l)if(k==="_COLOR_0"){const $=l[k];F.instanceColor=new Hg($.array,$.itemSize,$.normalized)}else k!=="TRANSLATION"&&k!=="ROTATION"&&k!=="SCALE"&&w.geometry.setAttribute(k,l[k]);Qn.prototype.copy.call(F,w),this.parser.assignFinalMaterial(F),y.push(F)}return d.isGroup?(d.clear(),d.add(...y),d):y[0]}))}}const Rse="glTF",hw=12,SQ={JSON:1313821514,BIN:5130562};class bit{constructor(e){this.name=Kn.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,hw),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==Rse)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-hw,s=new DataView(e,hw);let o=0;for(;o<r;){const a=s.getUint32(o,!0);o+=4;const l=s.getUint32(o,!0);if(o+=4,l===SQ.JSON){const u=new Uint8Array(e,hw+o,a);this.content=n.decode(u)}else if(l===SQ.BIN){const u=hw+o;this.body=e.slice(u,u+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class wit{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Kn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const n=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},u={};for(const d in o){const p=BV[d]||d.toLowerCase();a[p]=o[d]}for(const d in e.attributes){const p=BV[d]||d.toLowerCase();if(o[d]!==void 0){const v=n.accessors[e.attributes[d]],y=l0[v.componentType];u[p]=y.name,l[p]=v.normalized===!0}}return i.getDependency("bufferView",s).then(function(d){return new Promise(function(p,v){r.decodeDracoFile(d,function(y){for(const w in y.attributes){const R=y.attributes[w],O=l[w];O!==void 0&&(R.normalized=O)}p(y)},a,u,ma,v)})})}}class _it{constructor(){this.name=Kn.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return(i.texCoord===void 0||i.texCoord===e.channel)&&i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(e=e.clone(),i.texCoord!==void 0&&(e.channel=i.texCoord),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class Cit{constructor(){this.name=Kn.KHR_MESH_QUANTIZATION}}class Pse extends xx{constructor(e,i,n,r){super(e,i,n,r)}copySampleValue_(e){const i=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)i[o]=n[s+o];return i}interpolate_(e,i,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,u=a*3,d=r-i,p=(n-i)/d,v=p*p,y=v*p,w=e*u,R=w-u,O=-2*y+3*v,P=y-v,N=1-O,F=P-v+p;for(let k=0;k!==a;k++){const $=o[R+k+a],W=o[R+k+l]*d,Q=o[w+k+a],Y=o[w+k]*d;s[k]=N*$+F*W+O*Q+P*Y}return s}}const Sit=new pa;class Oit extends Pse{interpolate_(e,i,n,r){const s=super.interpolate_(e,i,n,r);return Sit.fromArray(s).normalize().toArray(s),s}}const wc={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},l0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},OQ={9728:fo,9729:Ps,9984:sL,9985:o0,9986:tg,9987:Fc},MQ={33071:Zl,33648:B0,10497:Ap},WB={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},BV={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Hf={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Mit={CUBICSPLINE:void 0,LINEAR:$0,STEP:H0},qB={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Tit(t){return t.DefaultMaterial===void 0&&(t.DefaultMaterial=new yx({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:kh})),t.DefaultMaterial}function Lm(t,e,i){for(const n in i.extensions)t[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=i.extensions[n])}function gd(t,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Rit(t,e,i){let n=!1,r=!1,s=!1;for(let u=0,d=e.length;u<d;u++){const p=e[u];if(p.POSITION!==void 0&&(n=!0),p.NORMAL!==void 0&&(r=!0),p.COLOR_0!==void 0&&(s=!0),n&&r&&s)break}if(!n&&!r&&!s)return Promise.resolve(t);const o=[],a=[],l=[];for(let u=0,d=e.length;u<d;u++){const p=e[u];if(n){const v=p.POSITION!==void 0?i.getDependency("accessor",p.POSITION):t.attributes.position;o.push(v)}if(r){const v=p.NORMAL!==void 0?i.getDependency("accessor",p.NORMAL):t.attributes.normal;a.push(v)}if(s){const v=p.COLOR_0!==void 0?i.getDependency("accessor",p.COLOR_0):t.attributes.color;l.push(v)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(u){const d=u[0],p=u[1],v=u[2];return n&&(t.morphAttributes.position=d),r&&(t.morphAttributes.normal=p),s&&(t.morphAttributes.color=v),t.morphTargetsRelative=!0,t})}function Pit(t,e){if(t.updateMorphTargets(),e.weights!==void 0)for(let i=0,n=e.weights.length;i<n;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(let n=0,r=i.length;n<r;n++)t.morphTargetDictionary[i[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Eit(t){let e;const i=t.extensions&&t.extensions[Kn.KHR_DRACO_MESH_COMPRESSION];if(i?e="draco:"+i.bufferView+":"+i.indices+":"+jB(i.attributes):e=t.indices+":"+jB(t.attributes)+":"+t.mode,t.targets!==void 0)for(let n=0,r=t.targets.length;n<r;n++)e+=":"+jB(t.targets[n]);return e}function jB(t){let e="";const i=Object.keys(t).sort();for(let n=0,r=i.length;n<r;n++)e+=i[n]+":"+t[i[n]]+";";return e}function zV(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Ait(t){return t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0?"image/jpeg":t.search(/\.webp($|\?)/i)>0||t.search(/^data\:image\/webp/)===0?"image/webp":t.search(/\.ktx2($|\?)/i)>0||t.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Iit=new sn;class kit{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new tit,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=-1,s=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;n=/^((?!chrome|android).)*safari/i.test(a)===!0;const l=a.match(/Version\/(\d+)/);r=n&&l?parseInt(l[1],10):-1,s=a.indexOf("Firefox")>-1,o=s?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&r<17||s&&o<98?this.textureLoader=new Jre(this.options.manager):this.textureLoader=new ose(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Tu(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const n=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:n,userData:{}};return Lm(s,a,r),gd(a,r),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],n=this.json.meshes||[];for(let r=0,s=i.length;r<s;r++){const o=i[r].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,n){if(e.refs[i]<=1)return n;const r=n.clone(),s=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[u,d]of o.children.entries())s(d,a.children[u])};return s(n,r),r.name+="_instance_"+e.uses[i]++,r}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let n=0;n<i.length;n++){const r=e(i[n]);if(r)return r}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const n=[];for(let r=0;r<i.length;r++){const s=e(i[r]);s&&n.push(s)}return n}getDependency(e,i){const n=e+":"+i;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(i);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(i)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(i)});break;case"accessor":r=this.loadAccessor(i);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(i)});break;case"buffer":r=this.loadBuffer(i);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(i)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(i)});break;case"skin":r=this.loadSkin(i);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(i)});break;case"camera":r=this.loadCamera(i);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,i)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(n,r)}return r}getDependencies(e){let i=this.cache.get(e);if(!i){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(r.map(function(s,o){return n.getDependency(e,o)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],n=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[Kn.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){n.load(wp.resolveURL(i.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(n){const r=i.byteLength||0,s=i.byteOffset||0;return n.slice(s,s+r)})}loadAccessor(e){const i=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const o=WB[r.type],a=l0[r.componentType],l=r.normalized===!0,u=new a(r.count*o);return Promise.resolve(new xr(u,o,l))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=WB[r.type],u=l0[r.componentType],d=u.BYTES_PER_ELEMENT,p=d*l,v=r.byteOffset||0,y=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,w=r.normalized===!0;let R,O;if(y&&y!==p){const P=Math.floor(v/y),N="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+P+":"+r.count;let F=i.cache.get(N);F||(R=new u(a,P*y,r.count*y/d),F=new nS(R,y/d),i.cache.add(N,F)),O=new yl(F,l,v%y/d,w)}else a===null?R=new u(r.count*l):R=new u(a,v,r.count*l),O=new xr(R,l,w);if(r.sparse!==void 0){const P=WB.SCALAR,N=l0[r.sparse.indices.componentType],F=r.sparse.indices.byteOffset||0,k=r.sparse.values.byteOffset||0,$=new N(o[1],F,r.sparse.count*P),W=new u(o[2],k,r.sparse.count*l);a!==null&&(O=new xr(O.array.slice(),O.itemSize,O.normalized)),O.normalized=!1;for(let Q=0,Y=$.length;Q<Y;Q++){const M=$[Q];if(O.setX(M,W[Q*l]),l>=2&&O.setY(M,W[Q*l+1]),l>=3&&O.setZ(M,W[Q*l+2]),l>=4&&O.setW(M,W[Q*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}O.normalized=w}return O})}loadTexture(e){const i=this.json,n=this.options,s=i.textures[e].source,o=i.images[s];let a=this.textureLoader;if(o.uri){const l=n.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,i,n){const r=this,s=this.json,o=s.textures[e],a=s.images[i],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const u=this.loadImageSource(i,n).then(function(d){d.flipY=!1,d.name=o.name||a.name||"",d.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(d.name=a.uri);const v=(s.samplers||{})[o.sampler]||{};return d.magFilter=OQ[v.magFilter]||Ps,d.minFilter=OQ[v.minFilter]||Fc,d.wrapS=MQ[v.wrapS]||Ap,d.wrapT=MQ[v.wrapT]||Ap,d.generateMipmaps=!d.isCompressedTexture&&d.minFilter!==fo&&d.minFilter!==Ps,r.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[l]=u,u}loadImageSource(e,i){const n=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(p=>p.clone());const o=r.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",u=!1;if(o.bufferView!==void 0)l=n.getDependency("bufferView",o.bufferView).then(function(p){u=!0;const v=new Blob([p],{type:o.mimeType});return l=a.createObjectURL(v),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(l).then(function(p){return new Promise(function(v,y){let w=v;i.isImageBitmapLoader===!0&&(w=function(R){const O=new ds(R);O.needsUpdate=!0,v(O)}),i.load(wp.resolveURL(p,s.path),w,void 0,y)})}).then(function(p){return u===!0&&a.revokeObjectURL(l),gd(p,o),p.userData.mimeType=o.mimeType||Ait(o.uri),p}).catch(function(p){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),p});return this.sourceCache[e]=d,d}assignTexture(e,i,n,r){const s=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(o=o.clone(),o.channel=n.texCoord),s.extensions[Kn.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[Kn.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[Kn.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return r!==void 0&&(o.colorSpace=r),e[i]=o,o})}assignFinalMaterial(e){const i=e.geometry;let n=e.material;const r=i.attributes.tangent===void 0,s=i.attributes.color!==void 0,o=i.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let l=this.cache.get(a);l||(l=new wL,po.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(a,l)),n=l}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let l=this.cache.get(a);l||(l=new xa,po.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(a,l)),n=l}if(r||s||o){let a="ClonedMaterial:"+n.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=n.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(n))),n=l}e.material=n}getMaterialType(){return yx}loadMaterial(e){const i=this,n=this.json,r=this.extensions,s=n.materials[e];let o;const a={},l=s.extensions||{},u=[];if(l[Kn.KHR_MATERIALS_UNLIT]){const p=r[Kn.KHR_MATERIALS_UNLIT];o=p.getMaterialType(),u.push(p.extendParams(a,s,i))}else{const p=s.pbrMetallicRoughness||{};if(a.color=new Si(1,1,1),a.opacity=1,Array.isArray(p.baseColorFactor)){const v=p.baseColorFactor;a.color.setRGB(v[0],v[1],v[2],ma),a.opacity=v[3]}p.baseColorTexture!==void 0&&u.push(i.assignTexture(a,"map",p.baseColorTexture,co)),a.metalness=p.metallicFactor!==void 0?p.metallicFactor:1,a.roughness=p.roughnessFactor!==void 0?p.roughnessFactor:1,p.metallicRoughnessTexture!==void 0&&(u.push(i.assignTexture(a,"metalnessMap",p.metallicRoughnessTexture)),u.push(i.assignTexture(a,"roughnessMap",p.metallicRoughnessTexture))),o=this._invokeOne(function(v){return v.getMaterialType&&v.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(v){return v.extendMaterialParams&&v.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=Pc);const d=s.alphaMode||qB.OPAQUE;if(d===qB.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,d===qB.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==vl&&(u.push(i.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Xt(1,1),s.normalTexture.scale!==void 0)){const p=s.normalTexture.scale;a.normalScale.set(p,p)}if(s.occlusionTexture!==void 0&&o!==vl&&(u.push(i.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==vl){const p=s.emissiveFactor;a.emissive=new Si().setRGB(p[0],p[1],p[2],ma)}return s.emissiveTexture!==void 0&&o!==vl&&u.push(i.assignTexture(a,"emissiveMap",s.emissiveTexture,co)),Promise.all(u).then(function(){const p=new o(a);return s.name&&(p.name=s.name),gd(p,s),i.associations.set(p,{materials:e}),s.extensions&&Lm(r,p,s),p})}createUniqueName(e){const i=cr.sanitizeNodeName(e||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(e){const i=this,n=this.extensions,r=this.primitiveCache;function s(a){return n[Kn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,i).then(function(l){return TQ(l,a,i)})}const o=[];for(let a=0,l=e.length;a<l;a++){const u=e[a],d=Eit(u),p=r[d];if(p)o.push(p.promise);else{let v;u.extensions&&u.extensions[Kn.KHR_DRACO_MESH_COMPRESSION]?v=s(u):v=TQ(new Rn,u,i),r[d]={primitive:u,promise:v},o.push(v)}}return Promise.all(o)}loadMesh(e){const i=this,n=this.json,r=this.extensions,s=n.meshes[e],o=s.primitives,a=[];for(let l=0,u=o.length;l<u;l++){const d=o[l].material===void 0?Tit(this.cache):this.getDependency("material",o[l].material);a.push(d)}return a.push(i.loadGeometries(o)),Promise.all(a).then(function(l){const u=l.slice(0,l.length-1),d=l[l.length-1],p=[];for(let y=0,w=d.length;y<w;y++){const R=d[y],O=o[y];let P;const N=u[y];if(O.mode===wc.TRIANGLES||O.mode===wc.TRIANGLE_STRIP||O.mode===wc.TRIANGLE_FAN||O.mode===void 0)P=s.isSkinnedMesh===!0?new ZH(R,N):new us(R,N),P.isSkinnedMesh===!0&&P.normalizeSkinWeights(),O.mode===wc.TRIANGLE_STRIP?P.geometry=CQ(P.geometry,GH):O.mode===wc.TRIANGLE_FAN&&(P.geometry=CQ(P.geometry,HR));else if(O.mode===wc.LINES)P=new Eu(R,N);else if(O.mode===wc.LINE_STRIP)P=new Yd(R,N);else if(O.mode===wc.LINE_LOOP)P=new XH(R,N);else if(O.mode===wc.POINTS)P=new KH(R,N);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+O.mode);Object.keys(P.geometry.morphAttributes).length>0&&Pit(P,s),P.name=i.createUniqueName(s.name||"mesh_"+e),gd(P,s),O.extensions&&Lm(r,P,O),i.assignFinalMaterial(P),p.push(P)}for(let y=0,w=p.length;y<w;y++)i.associations.set(p[y],{meshes:e,primitives:y});if(p.length===1)return s.extensions&&Lm(r,p[0],s),p[0];const v=new Xl;s.extensions&&Lm(r,v,s),i.associations.set(v,{meshes:e});for(let y=0,w=p.length;y<w;y++)v.add(p[y]);return v})}loadCamera(e){let i;const n=this.json.cameras[e],r=n[n.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?i=new ho($H.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(i=new bx(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(i.name=this.createUniqueName(n.name)),gd(i,n),Promise.resolve(i)}loadSkin(e){const i=this.json.skins[e],n=[];for(let r=0,s=i.joints.length;r<s;r++)n.push(this._loadNodeShallow(i.joints[r]));return i.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",i.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(r){const s=r.pop(),o=r,a=[],l=[];for(let u=0,d=o.length;u<d;u++){const p=o[u];if(p){a.push(p);const v=new sn;s!==null&&v.fromArray(s.array,u*16),l.push(v)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[u])}return new rS(a,l)})}loadAnimation(e){const i=this.json,n=this,r=i.animations[e],s=r.name?r.name:"animation_"+e,o=[],a=[],l=[],u=[],d=[];for(let p=0,v=r.channels.length;p<v;p++){const y=r.channels[p],w=r.samplers[y.sampler],R=y.target,O=R.node,P=r.parameters!==void 0?r.parameters[w.input]:w.input,N=r.parameters!==void 0?r.parameters[w.output]:w.output;R.node!==void 0&&(o.push(this.getDependency("node",O)),a.push(this.getDependency("accessor",P)),l.push(this.getDependency("accessor",N)),u.push(w),d.push(R))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(u),Promise.all(d)]).then(function(p){const v=p[0],y=p[1],w=p[2],R=p[3],O=p[4],P=[];for(let N=0,F=v.length;N<F;N++){const k=v[N],$=y[N],W=w[N],Q=R[N],Y=O[N];if(k===void 0)continue;k.updateMatrix&&k.updateMatrix();const M=n._createAnimationTracks(k,$,W,Q,Y);if(M)for(let D=0;D<M.length;D++)P.push(M[D])}return new Q0(s,void 0,P)})}createNodeMesh(e){const i=this.json,n=this,r=i.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(s){const o=n._getNodeRef(n.meshCache,r.mesh,s);return r.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,u=r.weights.length;l<u;l++)a.morphTargetInfluences[l]=r.weights[l]}),o})}loadNode(e){const i=this.json,n=this,r=i.nodes[e],s=n._loadNodeShallow(e),o=[],a=r.children||[];for(let u=0,d=a.length;u<d;u++)o.push(n.getDependency("node",a[u]));const l=r.skin===void 0?Promise.resolve(null):n.getDependency("skin",r.skin);return Promise.all([s,Promise.all(o),l]).then(function(u){const d=u[0],p=u[1],v=u[2];v!==null&&d.traverse(function(y){y.isSkinnedMesh&&y.bind(v,Iit)});for(let y=0,w=p.length;y<w;y++)d.add(p[y]);return d})}_loadNodeShallow(e){const i=this.json,n=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=i.nodes[e],o=s.name?r.createUniqueName(s.name):"",a=[],l=r._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return l&&a.push(l),s.camera!==void 0&&a.push(r.getDependency("camera",s.camera).then(function(u){return r._getNodeRef(r.cameraCache,s.camera,u)})),r._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){a.push(u)}),this.nodeCache[e]=Promise.all(a).then(function(u){let d;if(s.isBone===!0?d=new xL:u.length>1?d=new Xl:u.length===1?d=u[0]:d=new Qn,d!==u[0])for(let p=0,v=u.length;p<v;p++)d.add(u[p]);if(s.name&&(d.userData.name=s.name,d.name=o),gd(d,s),s.extensions&&Lm(n,d,s),s.matrix!==void 0){const p=new sn;p.fromArray(s.matrix),d.applyMatrix4(p)}else s.translation!==void 0&&d.position.fromArray(s.translation),s.rotation!==void 0&&d.quaternion.fromArray(s.rotation),s.scale!==void 0&&d.scale.fromArray(s.scale);return r.associations.has(d)||r.associations.set(d,{}),r.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const i=this.extensions,n=this.json.scenes[e],r=this,s=new Xl;n.name&&(s.name=r.createUniqueName(n.name)),gd(s,n),n.extensions&&Lm(i,s,n);const o=n.nodes||[],a=[];for(let l=0,u=o.length;l<u;l++)a.push(r.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let d=0,p=l.length;d<p;d++)s.add(l[d]);const u=d=>{const p=new Map;for(const[v,y]of r.associations)(v instanceof po||v instanceof ds)&&p.set(v,y);return d.traverse(v=>{const y=r.associations.get(v);y!=null&&p.set(v,y)}),p};return r.associations=u(s),s})}_createAnimationTracks(e,i,n,r,s){const o=[],a=e.name?e.name:e.uuid,l=[];Hf[s.path]===Hf.weights?e.traverse(function(v){v.morphTargetInfluences&&l.push(v.name?v.name:v.uuid)}):l.push(a);let u;switch(Hf[s.path]){case Hf.weights:u=Wg;break;case Hf.rotation:u=qg;break;case Hf.translation:case Hf.scale:u=jg;break;default:switch(n.itemSize){case 1:u=Wg;break;case 2:case 3:default:u=jg;break}break}const d=r.interpolation!==void 0?Mit[r.interpolation]:$0,p=this._getArrayFromAccessor(n);for(let v=0,y=l.length;v<y;v++){const w=new u(l[v]+"."+Hf[s.path],i.array,p,d);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(w),o.push(w)}return o}_getArrayFromAccessor(e){let i=e.array;if(e.normalized){const n=zV(i.constructor),r=new Float32Array(i.length);for(let s=0,o=i.length;s<o;s++)r[s]=i[s]*n;i=r}return i}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const r=this instanceof qg?Oit:Pse;return new r(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Dit(t,e,i){const n=e.attributes,r=new Es;if(n.POSITION!==void 0){const a=i.json.accessors[n.POSITION],l=a.min,u=a.max;if(l!==void 0&&u!==void 0){if(r.set(new Ie(l[0],l[1],l[2]),new Ie(u[0],u[1],u[2])),a.normalized){const d=zV(l0[a.componentType]);r.min.multiplyScalar(d),r.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new Ie,l=new Ie;for(let u=0,d=s.length;u<d;u++){const p=s[u];if(p.POSITION!==void 0){const v=i.json.accessors[p.POSITION],y=v.min,w=v.max;if(y!==void 0&&w!==void 0){if(l.setX(Math.max(Math.abs(y[0]),Math.abs(w[0]))),l.setY(Math.max(Math.abs(y[1]),Math.abs(w[1]))),l.setZ(Math.max(Math.abs(y[2]),Math.abs(w[2]))),v.normalized){const R=zV(l0[v.componentType]);l.multiplyScalar(R)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}t.boundingBox=r;const o=new Hs;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=o}function TQ(t,e,i){const n=e.attributes,r=[];function s(o,a){return i.getDependency("accessor",o).then(function(l){t.setAttribute(a,l)})}for(const o in n){const a=BV[o]||o.toLowerCase();a in t.attributes||r.push(s(n[o],a))}if(e.indices!==void 0&&!t.index){const o=i.getDependency("accessor",e.indices).then(function(a){t.setIndex(a)});r.push(o)}return Xn.workingColorSpace!==ma&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Xn.workingColorSpace}" not supported.`),gd(t,e),Dit(t,e,i),Promise.all(r).then(function(){return e.targets!==void 0?Rit(t,e.targets,i):t})}const Lit=t=>{const e={nodes:{},materials:{}};return t&&t.traverse(i=>{i.name&&(e.nodes[i.name]=i),i.material&&!e.materials[i.material.name]&&(e.materials[i.material.name]=i.material)}),e};function Fit(t,e){const i=typeof t=="string"?e:t,n=eit(S5,{extend(o){i?.dracoLoader&&o.setDRACOLoader(i.dracoLoader),i?.meshoptDecoder&&o.setMeshoptDecoder(i.meshoptDecoder),i?.ktx2Loader&&o.setKTX2Loader(i.ktx2Loader)}}),r=o=>n.load(o,{transform(a){return{...a,...Lit(a.scene)}}}),s=typeof t=="string"?t:void 0;return s?r(s):{load:r}}const Fm=t=>({subscribe:t.subscribe,get current(){return t.current}});let y_=0;const O5=Dn(!1),GL=Dn(!1),M5=Dn(void 0),T5=Dn(0),R5=Dn(0),Ese=Dn([]),P5=Dn(0),{onStart:Nit,onLoad:Bit,onError:zit}=cv;cv.onStart=(t,e,i)=>{Nit?.(t,e,i),GL.set(!0),M5.set(t),T5.set(e),R5.set(i);const n=(e-y_)/(i-y_);P5.set(n),n===1&&O5.set(!0)};cv.onLoad=()=>{Bit?.(),GL.set(!1)};cv.onError=t=>{zit?.(t),Ese.update(e=>[...e,t])};cv.onProgress=(t,e,i)=>{e===i&&(y_=i),GL.set(!0),M5.set(t),T5.set(e),R5.set(i);const n=(e-y_)/(i-y_)||1;P5.set(n),n===1&&O5.set(!0)};Fm(GL),Fm(M5),Fm(T5),Fm(R5),Fm(Ese),Fm(P5),Fm(O5);new Ie;new Ie;new Ie;new Hs;new sn;new sv;new Ie;new Ie;new Ie;new Ie;new Xt;const Vit="Right",Git="Top",Uit="Front",Hit="Left",$it="Bottom",Wit="Back";[Vit,Git,Uit,Hit,$it,Wit].map(t=>t.toLocaleLowerCase());new Es;new Ie;mi.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Xt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};ca.line={uniforms:tS.merge([mi.common,mi.fog,mi.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};new Mn;new Ie;new Ie;new Mn;new Mn;new Mn;new Ie;new sn;new _5;new Ie;new Es;new Hs;new Mn;new sn;new sn;new us;`${mn.logdepthbuf_pars_vertex}${mn.fog_pars_vertex}${mn.logdepthbuf_vertex}${mn.fog_vertex}`;`${mn.tonemapping_fragment}${mn.colorspace_fragment}`;`${mn.tonemapping_fragment}${mn.colorspace_fragment}`;const qit=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,jit=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,Qit=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,Zit=Qit,Xit=`
	${qit}
	${jit}
`;`${Zit}${Xit}${mn.tonemapping_fragment}${mn.colorspace_fragment}`;new Es;new Si;typeof window<"u"&&document.createElement("div");const Kit=t=>{const{camera:e}=Iu();let i=t.current.clientWidth,n=t.current.clientHeight;const r=new ResizeObserver(([s])=>{i=s.contentRect.width,n=s.contentRect.height});return Ro(t,s=>(s&&r.observe(s),()=>{s&&r.unobserve(s)})),(s,o)=>{o.pointer.update(a=>(a.set(s.offsetX/i*2-1,-(s.offsetY/n)*2+1),a)),o.raycaster.setFromCamera(o.pointer.current,e.current)}},Ase=Symbol("interactivity-context"),Yit=()=>Xi(Ase),Jit=t=>{const e=Dn(zL().dom),i={enabled:Dn(!0),pointer:Dn(new Xt),pointerOverTarget:Dn(!1),lastEvent:void 0,raycaster:new dse,initialClick:[0,0],initialHits:[],hovered:new Map,interactiveObjects:[],target:e,handlers:new WeakMap,compute:Kit(e),filter:t?.filter,addInteractiveObject:(n,r)=>{i.interactiveObjects.indexOf(n)>-1||(i.handlers.set(n,r),i.interactiveObjects.push(n))},removeInteractiveObject:n=>{const r=i.interactiveObjects.indexOf(n);i.interactiveObjects.splice(r,1),i.handlers.delete(n)}};return ks(Ase,i),i},Ise=()=>{const t=Yit();if(!t)throw new Error("No interactivity context found. Did you forget to implement interactivity()?");return t},RQ=["onclick","oncontextmenu","ondblclick","onwheel","onpointerup","onpointerdown","onpointerover","onpointerout","onpointerenter","onpointerleave","onpointermove","onpointermissed"],ent=()=>{Jtt("interactivity",t=>{if(!Mc(t.ref,"Object3D")||!Object.entries(t.props).some(([r,s])=>s!==void 0&&RQ.includes(r)))return;const{addInteractiveObject:i,removeInteractiveObject:n}=Ise();return ctt.pre(()=>[t.ref],([r])=>(i(r,t.props),()=>{n(r)})),{pluginProps:RQ}})};function PQ(t){return`${(t.eventObject||t.object).uuid}/${t.index}${t.instanceId}`}const EQ=[["click",!1],["contextmenu",!1],["dblclick",!1],["wheel",!1],["pointerdown",!0],["pointerup",!0],["pointerleave",!0],["pointerenter",!0],["pointermove",!0],["pointercancel",!0]],tnt=t=>{const{handlers:e}=Ise(),i=u=>{const d=u.offsetX-t.initialClick[0],p=u.offsetY-t.initialClick[1];return Math.round(Math.hypot(d,p))},n=u=>{for(const d of t.hovered.values())if(u.length===0||!u.some(p=>p.object===d.object&&p.index===d.index&&p.instanceId===d.instanceId)){const{eventObject:p}=d;t.hovered.delete(PQ(d));const v=e.get(p);if(v){const y={...d,intersections:u};v.onpointerout?.(y),v.onpointerleave?.(y)}}},r=()=>{if(!t.enabled.current)return[];const u=[],d=t.raycaster.intersectObjects(t.interactiveObjects,!0),p=t.filter===void 0?d:t.filter(d,t);for(const v of p){let y=v.object;for(;y;)e.has(y)&&u.push({...v,eventObject:y}),y=y.parent}return u},s=(u,d)=>{for(const p of d)e.get(p)?.onpointermissed?.(u)},o=u=>u==="pointerleave"||u==="pointercancel"?()=>{t.pointerOverTarget.set(!1),n([])}:u==="pointerenter"?()=>{t.pointerOverTarget.set(!0)}:d=>{const p=u==="pointermove",v=u==="click"||u==="contextmenu"||u==="dblclick";t.compute(d,t);const y=r(),w=v?i(d):0;u==="pointerdown"&&(t.initialClick=[d.offsetX,d.offsetY],t.initialHits=y.map(O=>O.eventObject)),v&&y.length===0&&w<=2&&s(d,t.interactiveObjects),p&&n(y);let R=!1;e:for(const O of y){const P={stopped:R,...O,intersections:y,stopPropagation(){if(R=!0,P.stopped=!0,t.hovered.size>0&&Array.from(t.hovered.values()).some(F=>F.eventObject===O.eventObject)){const F=y.slice(0,y.indexOf(O));n([...F,O])}},camera:t.raycaster.camera,delta:w,nativeEvent:d,pointer:t.pointer.current,ray:t.raycaster.ray},N=e.get(O.eventObject);if(!N)return;if(p){if(N.onpointerover||N.onpointerenter||N.onpointerout||N.onpointerleave){const F=PQ(P),k=t.hovered.get(F);k?k.stopped&&P.stopPropagation():(t.hovered.set(F,P),N.onpointerover?.(P),N.onpointerenter?.(P))}N.onpointermove?.(P)}else N[`on${u}`]?(!v||t.initialHits.includes(O.eventObject))&&(s(d,t.interactiveObjects.filter(F=>!t.initialHits.includes(F))),N[`on${u}`]?.(P)):v&&t.initialHits.includes(O.eventObject)&&s(d,t.interactiveObjects.filter(F=>!t.initialHits.includes(F)));if(R)break e}},a=u=>{EQ.forEach(([d])=>{u.removeEventListener(d,o(d))})},l=u=>{EQ.forEach(([d,p])=>{u.addEventListener(d,o(d),{passive:p})})};Ro(t.target,u=>(u&&l(u),()=>{u&&a(u)}))},int=t=>{const e=Jit(t);return ent(),tnt(e),e};for(let t=0;t<256;t++)(t<16?"0":"")+t.toString(16);new bx(-1,1,1,-1,0,1);class nnt extends Rn{constructor(){super(),this.setAttribute("position",new Hi([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Hi([0,2,0,0,2,0],2))}}new nnt;var kse={exports:{}};kse.exports=UL;kse.exports.default=UL;function UL(t,e,i){i=i||2;var n=e&&e.length,r=n?e[0]*i:t.length,s=Dse(t,0,r,i,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,u,d,p,v,y;if(n&&(s=lnt(t,e,s,i)),t.length>80*i){a=u=t[0],l=d=t[1];for(var w=i;w<r;w+=i)p=t[w],v=t[w+1],p<a&&(a=p),v<l&&(l=v),p>u&&(u=p),v>d&&(d=v);y=Math.max(u-a,d-l),y=y!==0?32767/y:0}return yC(s,o,i,a,l,y,0),o}function Dse(t,e,i,n,r){var s,o;if(r===UV(t,e,i,n)>0)for(s=e;s<i;s+=n)o=AQ(s,t[s],t[s+1],o);else for(s=i-n;s>=e;s-=n)o=AQ(s,t[s],t[s+1],o);return o&&HL(o,o.next)&&(bC(o),o=o.next),o}function Qg(t,e){if(!t)return t;e||(e=t);var i=t,n;do if(n=!1,!i.steiner&&(HL(i,i.next)||ys(i.prev,i,i.next)===0)){if(bC(i),i=e=i.prev,i===i.next)break;n=!0}else i=i.next;while(n||i!==e);return e}function yC(t,e,i,n,r,s,o){if(t){!o&&s&&fnt(t,n,r,s);for(var a=t,l,u;t.prev!==t.next;){if(l=t.prev,u=t.next,s?snt(t,n,r,s):rnt(t)){e.push(l.i/i|0),e.push(t.i/i|0),e.push(u.i/i|0),bC(t),t=u.next,a=u.next;continue}if(t=u,t===a){o?o===1?(t=ont(Qg(t),e,i),yC(t,e,i,n,r,s,2)):o===2&&ant(t,e,i,n,r,s):yC(Qg(t),e,i,n,r,s,1);break}}}}function rnt(t){var e=t.prev,i=t,n=t.next;if(ys(e,i,n)>=0)return!1;for(var r=e.x,s=i.x,o=n.x,a=e.y,l=i.y,u=n.y,d=r<s?r<o?r:o:s<o?s:o,p=a<l?a<u?a:u:l<u?l:u,v=r>s?r>o?r:o:s>o?s:o,y=a>l?a>u?a:u:l>u?l:u,w=n.next;w!==e;){if(w.x>=d&&w.x<=v&&w.y>=p&&w.y<=y&&qy(r,a,s,l,o,u,w.x,w.y)&&ys(w.prev,w,w.next)>=0)return!1;w=w.next}return!0}function snt(t,e,i,n){var r=t.prev,s=t,o=t.next;if(ys(r,s,o)>=0)return!1;for(var a=r.x,l=s.x,u=o.x,d=r.y,p=s.y,v=o.y,y=a<l?a<u?a:u:l<u?l:u,w=d<p?d<v?d:v:p<v?p:v,R=a>l?a>u?a:u:l>u?l:u,O=d>p?d>v?d:v:p>v?p:v,P=VV(y,w,e,i,n),N=VV(R,O,e,i,n),F=t.prevZ,k=t.nextZ;F&&F.z>=P&&k&&k.z<=N;){if(F.x>=y&&F.x<=R&&F.y>=w&&F.y<=O&&F!==r&&F!==o&&qy(a,d,l,p,u,v,F.x,F.y)&&ys(F.prev,F,F.next)>=0||(F=F.prevZ,k.x>=y&&k.x<=R&&k.y>=w&&k.y<=O&&k!==r&&k!==o&&qy(a,d,l,p,u,v,k.x,k.y)&&ys(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;F&&F.z>=P;){if(F.x>=y&&F.x<=R&&F.y>=w&&F.y<=O&&F!==r&&F!==o&&qy(a,d,l,p,u,v,F.x,F.y)&&ys(F.prev,F,F.next)>=0)return!1;F=F.prevZ}for(;k&&k.z<=N;){if(k.x>=y&&k.x<=R&&k.y>=w&&k.y<=O&&k!==r&&k!==o&&qy(a,d,l,p,u,v,k.x,k.y)&&ys(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function ont(t,e,i){var n=t;do{var r=n.prev,s=n.next.next;!HL(r,s)&&Lse(r,n,n.next,s)&&xC(r,s)&&xC(s,r)&&(e.push(r.i/i|0),e.push(n.i/i|0),e.push(s.i/i|0),bC(n),bC(n.next),n=t=s),n=n.next}while(n!==t);return Qg(n)}function ant(t,e,i,n,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&gnt(o,a)){var l=Fse(o,a);o=Qg(o,o.next),l=Qg(l,l.next),yC(o,e,i,n,r,s,0),yC(l,e,i,n,r,s,0);return}a=a.next}o=o.next}while(o!==t)}function lnt(t,e,i,n){var r=[],s,o,a,l,u;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:t.length,u=Dse(t,a,l,n,!1),u===u.next&&(u.steiner=!0),r.push(mnt(u));for(r.sort(cnt),s=0;s<r.length;s++)i=unt(r[s],i);return i}function cnt(t,e){return t.x-e.x}function unt(t,e){var i=hnt(t,e);if(!i)return e;var n=Fse(i,t);return Qg(n,n.next),Qg(i,i.next)}function hnt(t,e){var i=e,n=t.x,r=t.y,s=-1/0,o;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var a=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>s&&(s=a,o=i.x<i.next.x?i:i.next,a===n))return o}i=i.next}while(i!==e);if(!o)return null;var l=o,u=o.x,d=o.y,p=1/0,v;i=o;do n>=i.x&&i.x>=u&&n!==i.x&&qy(r<d?n:s,r,u,d,r<d?s:n,r,i.x,i.y)&&(v=Math.abs(r-i.y)/(n-i.x),xC(i,t)&&(v<p||v===p&&(i.x>o.x||i.x===o.x&&dnt(o,i)))&&(o=i,p=v)),i=i.next;while(i!==l);return o}function dnt(t,e){return ys(t.prev,t,e.prev)<0&&ys(e.next,t,t.next)<0}function fnt(t,e,i,n){var r=t;do r.z===0&&(r.z=VV(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,pnt(r)}function pnt(t){var e,i,n,r,s,o,a,l,u=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;e<u&&(a++,n=n.nextZ,!!n);e++);for(l=u;a>0||l>0&&n;)a!==0&&(l===0||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,u*=2}while(o>1);return t}function VV(t,e,i,n,r){return t=(t-i)*r|0,e=(e-n)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function mnt(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function qy(t,e,i,n,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(n-a)>=(i-o)*(e-a)&&(i-o)*(s-a)>=(r-o)*(n-a)}function gnt(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!vnt(t,e)&&(xC(t,e)&&xC(e,t)&&ynt(t,e)&&(ys(t.prev,t,e.prev)||ys(t,e.prev,e))||HL(t,e)&&ys(t.prev,t,t.next)>0&&ys(e.prev,e,e.next)>0)}function ys(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function HL(t,e){return t.x===e.x&&t.y===e.y}function Lse(t,e,i,n){var r=nM(ys(t,e,i)),s=nM(ys(t,e,n)),o=nM(ys(i,n,t)),a=nM(ys(i,n,e));return!!(r!==s&&o!==a||r===0&&iM(t,i,e)||s===0&&iM(t,n,e)||o===0&&iM(i,t,n)||a===0&&iM(i,e,n))}function iM(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function nM(t){return t>0?1:t<0?-1:0}function vnt(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Lse(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function xC(t,e){return ys(t.prev,t,t.next)<0?ys(t,e,t.next)>=0&&ys(t,t.prev,e)>=0:ys(t,e,t.prev)<0||ys(t,t.next,e)<0}function ynt(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==t);return n}function Fse(t,e){var i=new GV(t.i,t.x,t.y),n=new GV(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function AQ(t,e,i,n){var r=new GV(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function bC(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function GV(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}UL.deviation=function(t,e,i,n){var r=e&&e.length,s=r?e[0]*i:t.length,o=Math.abs(UV(t,0,s,i));if(r)for(var a=0,l=e.length;a<l;a++){var u=e[a]*i,d=a<l-1?e[a+1]*i:t.length;o-=Math.abs(UV(t,u,d,i))}var p=0;for(a=0;a<n.length;a+=3){var v=n[a]*i,y=n[a+1]*i,w=n[a+2]*i;p+=Math.abs((t[v]-t[w])*(t[y+1]-t[v+1])-(t[v]-t[y])*(t[w+1]-t[v+1]))}return o===0&&p===0?0:Math.abs((p-o)/o)};function UV(t,e,i,n){for(var r=0,s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}UL.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[r][s][o]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i};new Xt;new Xt;var IQ;(t=>{function e(r){let s=r.slice();return s.sort(t.POINT_COMPARATOR),t.makeHullPresorted(s)}t.makeHull=e;function i(r){if(r.length<=1)return r.slice();let s=[];for(let a=0;a<r.length;a++){const l=r[a];for(;s.length>=2;){const u=s[s.length-1],d=s[s.length-2];if((u.x-d.x)*(l.y-d.y)>=(u.y-d.y)*(l.x-d.x))s.pop();else break}s.push(l)}s.pop();let o=[];for(let a=r.length-1;a>=0;a--){const l=r[a];for(;o.length>=2;){const u=o[o.length-1],d=o[o.length-2];if((u.x-d.x)*(l.y-d.y)>=(u.y-d.y)*(l.x-d.x))o.pop();else break}o.push(l)}return o.pop(),s.length==1&&o.length==1&&s[0].x==o[0].x&&s[0].y==o[0].y?s:s.concat(o)}t.makeHullPresorted=i;function n(r,s){return r.x<s.x?-1:r.x>s.x?1:r.y<s.y?-1:r.y>s.y?1:0}t.POINT_COMPARATOR=n})(IQ||(IQ={}));function kQ(t){return Object.prototype.toString.call(t)==="[object Date]"}function ZR(t,e,i,n){if(typeof i=="number"||kQ(i)){const r=n-i,s=(i-e)/(t.dt||1/60),o=t.opts.stiffness*r,a=t.opts.damping*s,l=(o-a)*t.inv_mass,u=(s+l)*t.dt;return Math.abs(u)<t.opts.precision&&Math.abs(r)<t.opts.precision?n:(t.settled=!1,kQ(i)?new Date(i.getTime()+u):i+u)}else{if(Array.isArray(i))return i.map((r,s)=>ZR(t,e[s],i[s],n[s]));if(typeof i=="object"){const r={};for(const s in i)r[s]=ZR(t,e[s],i[s],n[s]);return r}else throw new Error(`Cannot spring ${typeof i} values`)}}function xnt(t,e={}){const i=gr(t),{stiffness:n=.15,damping:r=.8,precision:s=.01}=e;let o,a,l,u=t,d=t,p=1,v=0,y=!1;function w(O,P={}){d=O;const N=l={};return t==null||P.hard||R.stiffness>=1&&R.damping>=1?(y=!0,o=Ia.now(),u=O,i.set(t=d),Promise.resolve()):(P.soft&&(v=1/((P.soft===!0?.5:+P.soft)*60),p=0),a||(o=Ia.now(),y=!1,a=pZ(F=>{if(y)return y=!1,a=null,!1;p=Math.min(p+v,1);const k=Math.min(F-o,1e3/30),$={inv_mass:p,opts:R,settled:!0,dt:k*60/1e3},W=ZR($,u,t,d);return o=F,u=t,i.set(t=W),$.settled&&(a=null),!$.settled})),new Promise(F=>{a.promise.then(()=>{N===l&&F()})}))}const R={set:w,update:(O,P)=>w(O(d,t),P),subscribe:i.subscribe,stiffness:n,damping:r,precision:s};return R}class E5{#e=$l(.15);#t=$l(.8);#n=$l(.01);#i=$l(void 0);#s=$l(void 0);#o=void 0;#l=0;#a=1;#u=0;#r=null;#c=null;constructor(e,i={}){this.#i.v=this.#s.v=e,typeof i.stiffness=="number"&&(this.#e.v=rM(i.stiffness,0,1)),typeof i.damping=="number"&&(this.#t.v=rM(i.damping,0,1)),typeof i.precision=="number"&&(this.#n.v=i.precision)}static of(e,i){const n=new E5(e(),i);return wC(()=>{n.set(e())}),n}#h(e){if(rt(this.#s,e),this.#i.v??=e,this.#o??=this.#i.v,!this.#r){this.#l=Ia.now();var i=1e3/(this.#u*60);this.#r??=pZ(n=>{this.#a=Math.min(this.#a+i,1);const r=Math.min(n-this.#l,1e3/30),s={inv_mass:this.#a,opts:{stiffness:this.#e.v,damping:this.#t.v,precision:this.#n.v},settled:!0,dt:r*60/1e3};var o=ZR(s,this.#o,this.#i.v,this.#s.v);return this.#o=this.#i.v,this.#l=n,rt(this.#i,o),s.settled&&(this.#r=null),!s.settled})}return this.#r.promise}set(e,i){if(this.#c?.reject(new Error("Aborted")),i?.instant||this.#i.v===void 0)return this.#r?.abort(),this.#r=null,rt(this.#i,rt(this.#s,e)),this.#o=e,Promise.resolve();i?.preserveMomentum&&(this.#a=0,this.#u=i.preserveMomentum);var n=this.#c=ale();return n.promise.catch(to),this.#h(e).then(()=>{n===this.#c&&n.resolve(void 0)}),n.promise}get current(){return B(this.#i)}get damping(){return B(this.#t)}set damping(e){rt(this.#t,rM(e,0,1))}get precision(){return B(this.#n)}set precision(e){rt(this.#n,e)}get stiffness(){return B(this.#e)}set stiffness(e){rt(this.#e,rM(e,0,1))}get target(){return B(this.#s)}set target(e){this.set(e)}}function rM(t,e,i){return Math.max(e,Math.min(i,t))}const kw=Dn(!1),$L=Dn(!1),x_=Dn(void 0),bnt=Dn(void 0),HV=Dn(void 0),Nse={left:Dn(void 0),right:Dn(void 0)},Bse={left:Dn(void 0),right:Dn(void 0)},zse=Dn({left:{enabled:!1,hovering:!1},right:{enabled:!1,hovering:!1}}),A5={left:Dn(void 0),right:Dn(void 0)},I5=Dn({left:{enabled:!1,hovering:!1},right:{enabled:!1,hovering:!1}}),wnt={left:Dn(void 0),right:Dn(void 0)},k5=Dn(void 0),D5=Dn(void 0),Vse=Dn(void 0),XR=t=>{switch(t){case"left":return k5;case"right":return D5;case"none":return Vse;default:throw new Error("useController handedness must be left, right, or none.")}};var _nt=hi("<!> <!>",1);function Gse(t,e){Pi(e,!0);let i=ht(e,"color",19,()=>new Si("white")),n=ht(e,"size",3,.03),r=ht(e,"thickness",3,.035);const s=`
    uniform mat4 projectionMatrix;
    uniform mat4 modelViewMatrix;
    attribute vec2 uv;
    attribute vec3 position;
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }
  `,o=`
    precision mediump float;
    uniform float thickness;
    uniform vec3 color;
    varying vec2 vUv;
    void main() {
      float radius = 0.1;
      float dist = length(vUv - vec2(0.5));
      float alpha = 1.0 - step(thickness, abs(distance(vUv, vec2(0.5)) - 0.25));
      gl_FragColor = vec4(color, alpha);
    }
  `,a={thickness:{value:r()},color:{value:i()}},l=new s5({vertexShader:s,fragmentShader:o,uniforms:a,side:Pc,transparent:!0,depthTest:!1});as(()=>{a.thickness.value=r()}),as(()=>{a.color.value=i()});var u=nn(),d=pi(u);dl(d,()=>Nr.Mesh,(p,v)=>{v(p,{get scale(){return n()},children:(y,w)=>{var R=_nt(),O=pi(R);dl(O,()=>Nr.PlaneGeometry,(N,F)=>{F(N,{})});var P=vi(O,2);Nr(P,{is:l}),bt(y,R)},$$slots:{default:!0}})}),bt(t,u),Ei()}function Cnt(t,e){Pi(e,!0);const[i,n]=Hr(),r=()=>dt(I5,"$pointerState",i),s=new Xl,o=new Ie,a=new wn,l=new Ie;let u=Vt(()=>r()[e.handedness].hovering),d=Vt(()=>wnt[e.handedness]);const{start:p,stop:v}=Ip(()=>{if(B(d).current===void 0)return;const{point:y,face:w,object:R}=B(d).current;s.position.lerp(y,.4),w&&(a.getNormalMatrix(R.matrixWorld),l.copy(w.normal).applyMatrix3(a).normalize(),s.lookAt(o.addVectors(y,l)))},{autoStart:!1});as(()=>{B(u)?(s.position.copy(B(d).current.point),p()):v()}),Nr(t,{is:s,get visible(){return B(u)},children:(y,w)=>{var R=nn(),O=pi(R);{var P=F=>{var k=nn(),$=pi(k);hs($,()=>e.children),bt(F,k)},N=F=>{Gse(F,{})};Yi(O,F=>{e.children?F(P):F(N,!1)})}bt(y,R)},$$slots:{default:!0}}),Ei(),n()}var Snt=hi("<!> <!>",1);function Ont(t,e){Pi(e,!0);const[i,n]=Hr(),r=()=>dt(zse,"$teleportState",i),s=()=>dt(I5,"$pointerState",i),o=()=>dt(B(l),"$intersection",i);let a=Vt(()=>r()[e.handedness].hovering),l=Vt(()=>A5[e.handedness]),u=Vt(()=>s()[e.handedness].enabled||B(a)&&o()===void 0);const d=`
    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;
    attribute vec2 uv;
    attribute vec3 position;
    varying vec2 vUv;
    void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
    }`,p=`
    precision mediump float;
    varying vec2 vUv;
    void main() {
      gl_FragColor = vec4(1.0, 1.0, 1.0, pow(vUv.y - 1.0, 2.0));
    }`;var v=nn(),y=pi(v);dl(y,()=>Nr.Group,(w,R)=>{R(w,{get visible(){return B(u)},children:(O,P)=>{var N=nn(),F=pi(N);{var k=W=>{var Q=nn(),Y=pi(Q);hs(Y,()=>e.children),bt(W,Q)},$=W=>{var Q=nn(),Y=pi(Q);dl(Y,()=>Nr.Mesh,(M,D)=>{D(M,{"rotation.x":-Math.PI/2,"position.z":-.1,children:(G,j)=>{var Z=Snt(),ie=pi(Z);dl(ie,()=>Nr.CylinderGeometry,(me,be)=>{be(me,{args:[.002,.002,.2,16,1,!1]})});var le=vi(ie,2);dl(le,()=>Nr.RawShaderMaterial,(me,be)=>{be(me,{transparent:!0,vertexShader:d,fragmentShader:p})}),bt(G,Z)},$$slots:{default:!0}})}),bt(W,Q)};Yi(F,W=>{e.children?W(k):W($,!1)})}bt(O,N)},$$slots:{default:!0}})}),bt(t,v),Ei(),n()}function Use(t,e){Pi(e,!1);const{scene:i}=Iu(),n=Gt(new Qn);xl(n,B(n).add=r=>(i.add(r),r)),xl(n,B(n).remove=r=>(i.remove(r),r)),ts(),Nr(t,{get is(){return B(n)},attach:!1,children:(r,s)=>{var o=nn(),a=pi(o);c0(a,e,"default",{},null),bt(r,o)},$$slots:{default:!0}}),Ei()}function Mnt(t,e){Pi(e,!0);const[i,n]=Hr(),r=()=>dt(B(d),"$intersection",i),s=()=>dt(y,"$size",i),o=new Xl,a=new Ie,l=new wn,u=new Ie;let d=Vt(()=>A5[e.handedness]);const{start:p,stop:v}=Ip(()=>{if(B(d).current===void 0)return;const{point:R,face:O,object:P}=B(d).current;o.position.lerp(R,.4),O&&(l.getNormalMatrix(P.matrixWorld),u.copy(O.normal).applyMatrix3(l).normalize(),o.lookAt(a.addVectors(R,u)))},{autoStart:!1}),y=xnt(.1,{stiffness:.2});as(()=>{r()===void 0?(y.set(.1),v()):(y.set(1),o.position.copy(r().point),p())});const w=Vt(()=>r()!==void 0);Nr(t,{is:o,get visible(){return B(w)},children:(R,O)=>{var P=nn(),N=pi(P);{var F=$=>{var W=nn(),Q=pi(W);hs(Q,()=>e.children),bt($,W)},k=$=>{Gse($,{get size(){return s()},thickness:.015})};Yi(N,$=>{e.children?$(F):$(k,!1)})}bt(R,P)},$$slots:{default:!0}}),Ei(),n()}const DQ=new Es,sM=new Ie;class Hse extends g5{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],i=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new Hi(e,3)),this.setAttribute("uv",new Hi(i,2))}applyMatrix4(e){const i=this.attributes.instanceStart,n=this.attributes.instanceEnd;return i!==void 0&&(i.applyMatrix4(e),n.applyMatrix4(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const n=new jR(i,6,1);return this.setAttribute("instanceStart",new yl(n,3,0)),this.setAttribute("instanceEnd",new yl(n,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const n=new jR(i,6,1);return this.setAttribute("instanceColorStart",new yl(n,3,0)),this.setAttribute("instanceColorEnd",new yl(n,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new r5(e.geometry)),this}fromLineSegments(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Es);const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;e!==void 0&&i!==void 0&&(this.boundingBox.setFromBufferAttribute(e),DQ.setFromBufferAttribute(i),this.boundingBox.union(DQ))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Hs),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(e!==void 0&&i!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)sM.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(sM)),sM.fromBufferAttribute(i,s),r=Math.max(r,n.distanceToSquared(sM));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}}mi.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Xt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};ca.line={uniforms:tS.merge([mi.common,mi.fog,mi.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class L5 extends Qc{constructor(e){super({type:"LineMaterial",uniforms:tS.clone(ca.line.uniforms),vertexShader:ca.line.vertexShader,fragmentShader:ca.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const QB=new Mn,LQ=new Ie,FQ=new Ie,zo=new Mn,Vo=new Mn,Zu=new Mn,ZB=new Ie,XB=new sn,Uo=new _5,NQ=new Ie,oM=new Es,aM=new Hs,Xu=new Mn;let lh,Sg;function BQ(t,e,i){return Xu.set(0,0,-e,1).applyMatrix4(t.projectionMatrix),Xu.multiplyScalar(1/Xu.w),Xu.x=Sg/i.width,Xu.y=Sg/i.height,Xu.applyMatrix4(t.projectionMatrixInverse),Xu.multiplyScalar(1/Xu.w),Math.abs(Math.max(Xu.x,Xu.y))}function Tnt(t,e){const i=t.matrixWorld,n=t.geometry,r=n.attributes.instanceStart,s=n.attributes.instanceEnd,o=Math.min(n.instanceCount,r.count);for(let a=0,l=o;a<l;a++){Uo.start.fromBufferAttribute(r,a),Uo.end.fromBufferAttribute(s,a),Uo.applyMatrix4(i);const u=new Ie,d=new Ie;lh.distanceSqToSegment(Uo.start,Uo.end,d,u),d.distanceTo(u)<Sg*.5&&e.push({point:d,pointOnLine:u,distance:lh.origin.distanceTo(d),object:t,face:null,faceIndex:a,uv:null,uv1:null})}}function Rnt(t,e,i){const n=e.projectionMatrix,s=t.material.resolution,o=t.matrixWorld,a=t.geometry,l=a.attributes.instanceStart,u=a.attributes.instanceEnd,d=Math.min(a.instanceCount,l.count),p=-e.near;lh.at(1,Zu),Zu.w=1,Zu.applyMatrix4(e.matrixWorldInverse),Zu.applyMatrix4(n),Zu.multiplyScalar(1/Zu.w),Zu.x*=s.x/2,Zu.y*=s.y/2,Zu.z=0,ZB.copy(Zu),XB.multiplyMatrices(e.matrixWorldInverse,o);for(let v=0,y=d;v<y;v++){if(zo.fromBufferAttribute(l,v),Vo.fromBufferAttribute(u,v),zo.w=1,Vo.w=1,zo.applyMatrix4(XB),Vo.applyMatrix4(XB),zo.z>p&&Vo.z>p)continue;if(zo.z>p){const F=zo.z-Vo.z,k=(zo.z-p)/F;zo.lerp(Vo,k)}else if(Vo.z>p){const F=Vo.z-zo.z,k=(Vo.z-p)/F;Vo.lerp(zo,k)}zo.applyMatrix4(n),Vo.applyMatrix4(n),zo.multiplyScalar(1/zo.w),Vo.multiplyScalar(1/Vo.w),zo.x*=s.x/2,zo.y*=s.y/2,Vo.x*=s.x/2,Vo.y*=s.y/2,Uo.start.copy(zo),Uo.start.z=0,Uo.end.copy(Vo),Uo.end.z=0;const R=Uo.closestPointToPointParameter(ZB,!0);Uo.at(R,NQ);const O=$H.lerp(zo.z,Vo.z,R),P=O>=-1&&O<=1,N=ZB.distanceTo(NQ)<Sg*.5;if(P&&N){Uo.start.fromBufferAttribute(l,v),Uo.end.fromBufferAttribute(u,v),Uo.start.applyMatrix4(o),Uo.end.applyMatrix4(o);const F=new Ie,k=new Ie;lh.distanceSqToSegment(Uo.start,Uo.end,k,F),i.push({point:k,pointOnLine:F,distance:lh.origin.distanceTo(k),object:t,face:null,faceIndex:v,uv:null,uv1:null})}}}class Pnt extends us{constructor(e=new Hse,i=new L5({color:Math.random()*16777215})){super(e,i),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*i.count);for(let o=0,a=0,l=i.count;o<l;o++,a+=2)LQ.fromBufferAttribute(i,o),FQ.fromBufferAttribute(n,o),r[a]=a===0?0:r[a-1],r[a+1]=r[a]+LQ.distanceTo(FQ);const s=new jR(r,2,1);return e.setAttribute("instanceDistanceStart",new yl(s,1,0)),e.setAttribute("instanceDistanceEnd",new yl(s,1,1)),this}raycast(e,i){const n=this.material.worldUnits,r=e.camera;r===null&&!n&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;lh=e.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;Sg=l.linewidth+s,a.boundingSphere===null&&a.computeBoundingSphere(),aM.copy(a.boundingSphere).applyMatrix4(o);let u;if(n)u=Sg*.5;else{const p=Math.max(r.near,aM.distanceToPoint(lh.origin));u=BQ(r,p,l.resolution)}if(aM.radius+=u,lh.intersectsSphere(aM)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),oM.copy(a.boundingBox).applyMatrix4(o);let d;if(n)d=Sg*.5;else{const p=Math.max(r.near,oM.distanceToPoint(lh.origin));d=BQ(r,p,l.resolution)}oM.expandByScalar(d),lh.intersectsBox(oM)!==!1&&(n?Tnt(this,i):Rnt(this,r,i))}onBeforeRender(e){const i=this.material.uniforms;i&&i.resolution&&(e.getViewport(QB),this.material.uniforms.resolution.value.set(QB.z,QB.w))}}class $se extends Hse{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const i=e.length-3,n=new Float32Array(2*i);for(let r=0;r<i;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setPositions(n),this}setColors(e){const i=e.length-3,n=new Float32Array(2*i);for(let r=0;r<i;r+=3)n[2*r]=e[r],n[2*r+1]=e[r+1],n[2*r+2]=e[r+2],n[2*r+3]=e[r+3],n[2*r+4]=e[r+4],n[2*r+5]=e[r+5];return super.setColors(n),this}setFromPoints(e){const i=e.length-1,n=new Float32Array(6*i);for(let r=0;r<i;r++)n[6*r]=e[r].x,n[6*r+1]=e[r].y,n[6*r+2]=e[r].z||0,n[6*r+3]=e[r+1].x,n[6*r+4]=e[r+1].y,n[6*r+5]=e[r+1].z||0;return super.setPositions(n),this}fromLine(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}}class Ent extends Pnt{constructor(e=new $se,i=new L5({color:Math.random()*16777215})){super(e,i),this.isLine2=!0,this.type="Line2"}}var Ant=hi("<!> <!>",1);function Int(t,e){Pi(e,!0);const[i,n]=Hr(),r=()=>dt(B(w),"$intersection",i);let s=new $se;const o=new Ie,a=new Ie,l=new SL,u=40,d=new Float32Array(u*3),p=new Ie,v=new Xt,y=new Xt;let w=Vt(()=>A5[e.handedness]);const R=(W=.3)=>{if(B(w).current===void 0)return;const Q=B(w).current.point;e.targetRay.getWorldPosition(o),a.x=(o.x+Q.x)/2,a.y=(o.y+Q.y)/2,a.z=(o.z+Q.z)/2;const Y=Math.log1p(v.set(o.x,o.z).distanceTo(y.set(Q.x,Q.z)));a.y+=Y,l.v0.lerp(o,W),l.v1.lerp(a,W),l.v2.lerp(Q,W);for(let M=0,D=0;M<u;M+=1,D+=3){const G=M/u;l.getPoint(G,p),d[D+0]=p.x,d[D+1]=p.y,d[D+2]=p.z}s.setPositions(d)},{start:O,stop:P}=Ip(()=>{R()},{autoStart:!1});as(()=>{r()===void 0?P():(R(1),O())});var N=nn(),F=pi(N);{var k=W=>{var Q=nn(),Y=pi(Q);hs(Y,()=>e.children),bt(W,Q)},$=W=>{const Q=Vt(()=>r()!==void 0);Nr(W,{is:Ent,get visible(){return B(Q)},"position.z":-.01,children:(Y,M)=>{var D=Ant(),G=pi(D);Nr(G,{is:s});var j=vi(G,2);Nr(j,{is:L5,linewidth:3}),bt(Y,D)},$$slots:{default:!0}})};Yi(F,W=>{e.children?W(k):W($,!1)})}bt(t,N),Ei(),n()}const knt={left:k5,right:D5};var Dnt=hi("<!> <!>",1),Lnt=hi("<!> <!>",1),Fnt=hi("<!> <!>",1),Nnt=hi("<!> <!>",1),Bnt=hi("<!> <!>",1),znt=hi("<!> <!>",1);function zQ(t,e){Pi(e,!0);const[i,n]=Hr(),r=()=>dt(u,"$handedness",i),s=()=>dt(B(d),"$store",i),o=()=>dt(I5,"$pointerState",i),a=()=>dt(zse,"$teleportState",i),l=()=>dt($L,"$isHandTracking",i),u=gr(e.left?"left":e.right?"right":e.hand);as(()=>u.set(e.left?"left":e.right?"right":e.hand)),as(()=>Nse[r()].set({onconnected:e.onconnected,ondisconnected:e.ondisconnected,onselect:e.onselect,onselectend:e.onselectend,onselectstart:e.onselectstart,onsqueeze:e.onsqueeze,onsqueezeend:e.onsqueezeend,onsqueezestart:e.onsqueezestart}));let d=Vt(()=>knt[r()]),p=Vt(()=>s()?.grip),v=Vt(()=>s()?.targetRay),y=Vt(()=>s()?.model),w=Vt(()=>o()[r()].enabled),R=Vt(()=>a()[r()].enabled);var O=znt(),P=pi(O);{var N=k=>{var $=Fnt(),W=pi($);{var Q=D=>{Nr(D,{get is(){return B(p)},children:(G,j)=>{var Z=Dnt(),ie=pi(Z);{var le=fe=>{var Fe=nn(),He=pi(Fe);hs(He,()=>e.children??to),bt(fe,Fe)},me=fe=>{Nr(fe,{get is(){return B(y)}})};Yi(ie,fe=>{e.children?fe(le):fe(me,!1)})}var be=vi(ie,2);hs(be,()=>e.grip??to),bt(G,Z)},$$slots:{default:!0}})};Yi(W,D=>{B(p)&&D(Q)})}var Y=vi(W,2);{var M=D=>{Nr(D,{get is(){return B(v)},children:(G,j)=>{var Z=Lnt(),ie=pi(Z);hs(ie,()=>e.targetRay??to);var le=vi(ie,2);{var me=be=>{Ont(be,{get handedness(){return r()},get children(){return e.pointerRay}})};Yi(le,be=>{(B(w)||B(R))&&be(me)})}bt(G,Z)},$$slots:{default:!0}})};Yi(Y,D=>{B(v)&&D(M)})}bt(k,$)};Yi(P,k=>{l()||k(N)})}var F=vi(P,2);Use(F,{children:(k,$)=>{var W=Bnt(),Q=pi(W);{var Y=G=>{Cnt(G,{get handedness(){return r()},get children(){return e.pointerCursor}})};Yi(Q,G=>{B(w)&&G(Y)})}var M=vi(Q,2);{var D=G=>{var j=Nnt(),Z=pi(j);Int(Z,{get targetRay(){return B(v)},get handedness(){return r()},get children(){return e.teleportRay}});var ie=vi(Z,2);Mnt(ie,{get handedness(){return r()},get children(){return e.teleportCursor}}),bt(G,j)};Yi(M,G=>{B(R)&&B(v)!==void 0&&G(D)})}bt(k,W)},$$slots:{default:!0}}),bt(t,O),Ei(),n()}const Wse=Dn(void 0),qse=Dn(void 0),Vnt={left:Wse,right:qse};var Gnt=hi("<!> <!>",1),Unt=hi("<!> <!>",1),Hnt=hi("<!> <!>",1);function VQ(t,e){Pi(e,!0);const[i,n]=Hr(),r=()=>dt(v,"$handedness",i),s=()=>dt($L,"$isHandTracking",i),o=()=>dt(B(O),"$store",i),{renderer:a,scheduler:l,renderStage:u}=Iu(),{xr:d}=a,p=d.getReferenceSpace(),v=gr(e.left?"left":e.right?"right":e.hand);as(()=>v.set(e.left?"left":e.right?"right":e.hand)),as(()=>Bse[r()].set({onconnected:e.onconnected,ondisconnected:e.ondisconnected,onpinchend:e.onpinchend,onpinchstart:e.onpinchstart}));let y=new Xl;const{start:w,stop:R}=Ip(()=>{const Y=d.getFrame(),M=B(P)?.get("wrist");if(M===void 0||p===null)return;const D=Y.getJointPose?.(M,p);if(D==null)return;const{position:G,orientation:j}=D.transform;y.position.set(G.x,G.y,G.z),y.quaternion.set(j.x,j.y,j.z,j.w)},{autoStart:!1,stage:l.createStage(Symbol("xr-hand-stage"),{before:u})});as(()=>{s()&&(e.wrist!==void 0||e.children!==void 0)&&B(P)?w():R()});let O=Vt(()=>Vnt[r()]),P=Vt(()=>o()?.inputSource),N=Vt(()=>o()?.model);var F=Hnt(),k=pi(F);{var $=Y=>{var M=Gnt(),D=pi(M);Nr(D,{get is(){return o().hand},children:(Z,ie)=>{var le=nn(),me=pi(le);{var be=fe=>{Nr(fe,{get is(){return B(N)}})};Yi(me,fe=>{e.children===void 0&&fe(be)})}bt(Z,le)},$$slots:{default:!0}});var G=vi(D,2);{var j=Z=>{Nr(Z,{get is(){return o().targetRay},children:(ie,le)=>{var me=nn(),be=pi(me);hs(be,()=>e.targetRay),bt(ie,me)},$$slots:{default:!0}})};Yi(G,Z=>{e.targetRay!==void 0&&Z(j)})}bt(Y,M)};Yi(k,Y=>{o()?.hand&&s()&&Y($)})}var W=vi(k,2);{var Q=Y=>{Use(Y,{children:(M,D)=>{Nr(M,{is:y,children:(G,j)=>{var Z=Unt(),ie=pi(Z);hs(ie,()=>e.wrist??to);var le=vi(ie,2);hs(le,()=>e.children??to),bt(G,Z)},$$slots:{default:!0}})},$$slots:{default:!0}})};Yi(W,Y=>{s()&&Y(Q)})}bt(t,F),Ei(),n()}const $nt={isPresenting:kw,isHandTracking:$L,session:x_,xrFrame:{get current(){return HV.current.getFrame()}}},Wnt=()=>$nt,lM=new Xl,qnt=()=>{const{renderer:t,camera:e,scheduler:i,renderStage:n}=Iu(),{xr:r}=t,s=i.createStage(Symbol("xr-headset-stage"),{before:n}),o=Ip(()=>{const l=r.getReferenceSpace();if(l===null)return;const u=r.getFrame().getViewerPose(l);if(u==null)return;const{position:d,orientation:p}=u.transform;lM.position.set(d.x,d.y,d.z),lM.quaternion.set(p.x,p.y,p.z,p.w)},{autoStart:!1,autoInvalidate:!1,stage:s}),a=Ip(()=>{lM.position.copy(e.current.position),lM.quaternion.copy(e.current.quaternion)},{autoStart:!1,autoInvalidate:!1,stage:s});Ro(Wnt().isPresenting,l=>{l?(o.start(),a.stop()):(o.stop(),a.start())})},jnt=()=>{if(typeof window>"u")return;const t=Ia.tick;Ro(x_,e=>{Ia.tick=e===void 0?t:i=>e.requestAnimationFrame(i)}),As(()=>Ia.tick=t)},Ms={ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function jse(t){const e=await fetch(t);if(e.ok)return e.json();throw new Error(e.statusText)}async function Qnt(t){if(!t)throw new Error("No basePath supplied");return await jse(`${t}/profilesList.json`)}async function Znt(t,e,i=null,n=!0){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const r=await Qnt(e);let s;if(t.profiles.some(l=>{const u=r[l];return u&&(s={profileId:l,profilePath:`${e}/${u.path}`,deprecated:!!u.deprecated}),!!s}),!s){if(!i)throw new Error("No matching profile name found");const l=r[i];if(!l)throw new Error(`No matching profile name found and default profile "${i}" missing.`);s={profileId:i,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}const o=await jse(s.profilePath);let a;if(n){let l;if(t.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[t.handedness],!l)throw new Error(`No matching handedness, ${t.handedness}, in profile ${s.profileId}`);l.assetPath&&(a=s.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const Xnt={xAxis:0,yAxis:0,button:0,state:Ms.ComponentState.DEFAULT};function Knt(t=0,e=0){let i=t,n=e;if(Math.sqrt(t*t+e*e)>1){const o=Math.atan2(e,t);i=Math.cos(o),n=Math.sin(o)}return{normalizedXAxis:i*.5+.5,normalizedYAxis:n*.5+.5}}class Ynt{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Ms.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(Xnt)}updateFromComponent({xAxis:e,yAxis:i,button:n,state:r}){const{normalizedXAxis:s,normalizedYAxis:o}=Knt(e,i);switch(this.componentProperty){case Ms.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?s:.5;break;case Ms.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?o:.5;break;case Ms.ComponentProperty.BUTTON:this.value=this.states.includes(r)?n:0;break;case Ms.ComponentProperty.STATE:this.valueNodeProperty===Ms.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Jnt{constructor(e,i){if(!e||!i||!i.visualResponses||!i.gamepadIndices||Object.keys(i.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=i.type,this.rootNodeName=i.rootNodeName,this.touchPointNodeName=i.touchPointNodeName,this.visualResponses={},Object.keys(i.visualResponses).forEach(n=>{const r=new Ynt(i.visualResponses[n]);this.visualResponses[n]=r}),this.gamepadIndices=Object.assign({},i.gamepadIndices),this.values={state:Ms.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Ms.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const i=e.buttons[this.gamepadIndices.button];this.values.button=i.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,i.pressed||this.values.button===1?this.values.state=Ms.ComponentState.PRESSED:(i.touched||this.values.button>Ms.ButtonTouchThreshold)&&(this.values.state=Ms.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Ms.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Ms.AxisTouchThreshold&&(this.values.state=Ms.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Ms.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Ms.AxisTouchThreshold&&(this.values.state=Ms.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(i=>{i.updateFromComponent(this.values)})}}class ert{constructor(e,i,n){if(!e)throw new Error("No xrInputSource supplied");if(!i)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=i.profileId,this.layoutDescription=i.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(r=>{const s=this.layoutDescription.components[r];this.components[r]=new Jnt(r,s)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(i=>{e.push(i.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const trt="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",irt="generic-trigger";class nrt extends Qn{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(i=>{i.isMesh&&(i.material.envMap=this.envMap,i.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(i=>{Object.values(i.visualResponses).forEach(n=>{const{valueNode:r,minNode:s,maxNode:o,value:a,valueNodeProperty:l}=n;r&&(l===Ms.VisualResponseProperty.VISIBILITY?r.visible=a:l===Ms.VisualResponseProperty.TRANSFORM&&(r.quaternion.slerpQuaternions(s.quaternion,o.quaternion,a),r.position.lerpVectors(s.position,o.position,a)))})}))}}function rrt(t,e){Object.values(t.components).forEach(i=>{const{type:n,touchPointNodeName:r,visualResponses:s}=i;if(n===Ms.ComponentType.TOUCHPAD)if(i.touchPointNode=e.getObjectByName(r),i.touchPointNode){const o=new ov(.001),a=new vl({color:255}),l=new us(o,a);i.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${i.touchPointNodeName}, in touchpad component ${i.id}`);Object.values(s).forEach(o=>{const{valueNodeName:a,minNodeName:l,maxNodeName:u,valueNodeProperty:d}=o;if(d===Ms.VisualResponseProperty.TRANSFORM){if(o.minNode=e.getObjectByName(l),o.maxNode=e.getObjectByName(u),!o.minNode){console.warn(`Could not find ${l} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${u} in the model`);return}}o.valueNode=e.getObjectByName(a),o.valueNode||console.warn(`Could not find ${a} in the model`)})})}function GQ(t,e){rrt(t.motionController,e),t.envMap&&e.traverse(i=>{i.isMesh&&(i.material.envMap=t.envMap,i.material.needsUpdate=!0)}),t.add(e)}class srt{constructor(e=null,i=null){this.gltfLoader=e,this.path=trt,this._assetCache={},this.onLoad=i,this.gltfLoader||(this.gltfLoader=new S5)}setPath(e){return this.path=e,this}createControllerModel(e){const i=new nrt;let n=null;return e.addEventListener("connected",r=>{const s=r.data;s.targetRayMode!=="tracked-pointer"||!s.gamepad||s.hand||Znt(s,this.path,irt).then(({profile:o,assetPath:a})=>{i.motionController=new ert(s,o,a);const l=this._assetCache[i.motionController.assetUrl];if(l)n=l.scene.clone(),GQ(i,n),this.onLoad&&this.onLoad(n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(i.motionController.assetUrl,u=>{this._assetCache[i.motionController.assetUrl]=u,n=u.scene.clone(),GQ(i,n),this.onLoad&&this.onLoad(n)},null,()=>{throw new Error(`Asset ${i.motionController.assetUrl} missing or malformed.`)})}}).catch(o=>{console.warn(o)})}),e.addEventListener("disconnected",()=>{i.motionController=null,i.remove(n),n=null}),i}}const Qse=()=>{const{xr:t}=Iu().renderer;return()=>{let e=!1;return t.getSession()?.inputSources?.forEach(i=>{i.hand&&(e=!0)}),e}},ort=()=>{const t=new srt,e={left:k5,right:D5,none:Vse},{xr:i}=Iu().renderer,n=Qse(),r=[i.getController(0),i.getController(1)],s=new Map;r.forEach((o,a)=>{s.set(o,{targetRay:o,grip:i.getControllerGrip(a),model:t.createControllerModel(o)})}),Xo(()=>{const o=u=>{if(n())return;const{data:d}=u;Nse[d.handedness]?.current?.[`on${u.type}`]?.(u)};function a(u){const{model:d,targetRay:p,grip:v}=s.get(this),{data:y}=u;e[u.data.handedness].set({inputSource:y,targetRay:p,grip:v,model:d}),o(u)}const l=u=>{o(u),e[u.data.handedness].set(void 0)};for(const u of r)u.addEventListener("connected",a),u.addEventListener("disconnected",l),u.addEventListener("select",o),u.addEventListener("selectstart",o),u.addEventListener("selectend",o),u.addEventListener("squeeze",o),u.addEventListener("squeezestart",o),u.addEventListener("squeezeend",o);return()=>{for(const u of r)u.removeEventListener("connected",a),u.removeEventListener("disconnected",l),u.removeEventListener("select",o),u.removeEventListener("selectstart",o),u.removeEventListener("selectend",o),u.removeEventListener("squeeze",o),u.removeEventListener("squeezestart",o),u.removeEventListener("squeezeend",o);e.left.set(void 0),e.right.set(void 0),e.none.set(void 0)}})},UQ=new sn,HQ=new Ie;class $Q{constructor(e,i,n,r,s){this.controller=i,this.handModel=e,this.envMap=null;let o;!s||!s.primitive||s.primitive==="sphere"?o=new ov(1,10,10):s.primitive==="box"&&(o=new Hp(1,1,1));const a=new yx;this.handMesh=new bL(o,a,30),this.handMesh.frustumCulled=!1,this.handMesh.instanceMatrix.setUsage(yre),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){const i=this.controller.joints;let n=0;for(let r=0;r<this.joints.length;r++){const s=i[this.joints[r]];s.visible&&(HQ.setScalar(s.jointRadius||.008),UQ.compose(s.position,s.quaternion,HQ),this.handMesh.setMatrixAt(r,UQ),n++)}this.handMesh.count=n,this.handMesh.instanceMatrix.needsUpdate=!0}}const art="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class lrt{constructor(e,i,n,r,s=null,o=null){this.controller=i,this.handModel=e,this.bones=[],s===null&&(s=new S5,s.setPath(n||art)),s.load(`${r}.glb`,a=>{const l=a.scene.children[0];this.handModel.add(l);const u=l.getObjectByProperty("type","SkinnedMesh");u.frustumCulled=!1,u.castShadow=!0,u.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(p=>{const v=l.getObjectByName(p);v!==void 0?v.jointName=p:console.warn(`Couldn't find ${p} in ${r} hand mesh`),this.bones.push(v)}),o&&o(l)})}updateMesh(){const e=this.controller.joints;for(let i=0;i<this.bones.length;i++){const n=this.bones[i];if(n){const r=e[n.jointName];if(r.visible){const s=r.position;n.position.copy(s),n.quaternion.copy(r.quaternion)}}}}}class crt extends Qn{constructor(e){super(),this.controller=e,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&this.motionController.updateMesh()}}class urt{constructor(e=null,i=null){this.gltfLoader=e,this.path=null,this.onLoad=i}setPath(e){return this.path=e,this}createHandModel(e,i){const n=new crt(e);return e.addEventListener("connected",r=>{const s=r.data;s.hand&&!n.motionController&&(n.xrInputSource=s,i===void 0||i==="spheres"?n.motionController=new $Q(n,e,this.path,s.handedness,{primitive:"sphere"}):i==="boxes"?n.motionController=new $Q(n,e,this.path,s.handedness,{primitive:"box"}):i==="mesh"&&(n.motionController=new lrt(n,e,this.path,s.handedness,this.gltfLoader,this.onLoad))),e.visible=!0}),e.addEventListener("disconnected",()=>{e.visible=!1}),n}}const hrt=()=>{const t=new urt,e={left:Wse,right:qse},{xr:i}=Iu().renderer,n=Qse(),r=[i.getHand(0),i.getHand(1)],s=new Map;r.forEach((o,a)=>{s.set(o,{hand:o,targetRay:i.getController(a),model:t.createHandModel(o,"mesh")})}),Xo(()=>{const o=u=>{if(!n())return;const d=u,p="handedness"in d?d.handedness:d.data.handedness;Bse[p]?.current?.[`on${u.type}`]?.(u)};function a(u){const d=this,{model:p,targetRay:v}=s.get(this),{data:y}=u,{handedness:w,hand:R}=y;e[w].set({hand:d,model:p,inputSource:R,targetRay:v}),o(u)}const l=u=>{o(u),e[u.data.handedness].set(void 0)};for(const u of r)u.addEventListener("connected",a),u.addEventListener("disconnected",l),u.addEventListener("pinchstart",o),u.addEventListener("pinchend",o);return()=>{for(const u of r)u.removeEventListener("connected",a),u.removeEventListener("disconnected",l),u.removeEventListener("pinchstart",o),u.removeEventListener("pinchend",o);e.left.set(void 0),e.right.set(void 0)}})};function drt(t,e){Pi(e,!0);const[i,n]=Hr(),r=()=>dt(d,"$renderMode",i),s=()=>dt(x_,"$session",i),o=()=>dt(kw,"$isPresenting",i);let a=ht(e,"foveation",3,1),l=ht(e,"referenceSpace",3,"local-floor");const{renderer:u,renderMode:d}=Iu(),{xr:p}=u;let v=r();jnt(),qnt(),ort(),hrt();const y=()=>{kw.set(!0),e.onsessionstart?.({type:"sessionstart",target:s()})},w=()=>{e.onsessionend?.({type:"sessionend",target:s()}),kw.set(!1),x_.set(void 0)},R=Q=>{e.onvisibilitychange?.({...Q,target:s()})},O=Q=>{Lr($L,Object.values(Q.session.inputSources).some(Y=>Y.hand)),e.oninputsourceschange?.({...Q,target:s()})},P=Q=>{e.onvisibilitychange?.({...Q,target:s()})},N=Q=>{if(Q!==void 0)try{s()?.updateTargetFrameRate(Q)}catch{}};Ro(x_,Q=>{if(Q!==void 0)return Q.addEventListener("visibilitychange",R),Q.addEventListener("inputsourceschange",O),Q.addEventListener("frameratechange",P),p.setFoveation(a()),N(e.frameRate),()=>{Q.removeEventListener("visibilitychange",R),Q.removeEventListener("inputsourceschange",O),Q.removeEventListener("frameratechange",P)}}),Ro(kw,Q=>{Q?(v=d.current,d.set("always")):d.set(v)}),Xo(()=>(Lr(HV,p),p.enabled=!0,p.addEventListener("sessionstart",y),p.addEventListener("sessionend",w),()=>{Lr(HV,void 0),p.enabled=!1,p.removeEventListener("sessionstart",y),p.removeEventListener("sessionend",w)})),as(()=>N(e.frameRate)),as(()=>p.setFoveation(a())),as(()=>{p.setReferenceSpaceType(l()),Lr(bnt,l())});var F=nn(),k=pi(F);{var $=Q=>{var Y=nn(),M=pi(Y);hs(M,()=>e.children??to),bt(Q,Y)},W=Q=>{var Y=nn(),M=pi(Y);hs(M,()=>e.fallback??to),bt(Q,Y)};Yi(k,Q=>{o()?Q($):Q(W,!1)})}bt(t,F),Ei(),n()}XR("left"),XR("right");new Ie;XR("left"),XR("right");new Ie;var frt=hi("<!> <!> <!> <!>",1),prt=hi("<!> <!>",1),mrt=hi("<!> <!> <!> <!> <!>",1);function grt(t,e){Pi(e,!1);let i=ht(e,"gltfURL",8),n=ht(e,"scale",8,30),r=ht(e,"rotation",8,0);int();const s=Gt(new E5(1));Ip(v=>{}),ts();var o=mrt(),a=pi(o);drt(a,{children:(v,y)=>{var w=frt(),R=pi(w);zQ(R,{left:!0});var O=vi(R,2);zQ(O,{right:!0});var P=vi(O,2);VQ(P,{left:!0});var N=vi(P,2);VQ(N,{right:!0}),bt(v,w)},$$slots:{default:!0}});var l=vi(a,2);Nr.PerspectiveCamera(l,{makeDefault:!0,position:[10,10,10],oncreate:v=>{v.lookAt(0,1,0)}});var u=vi(l,2);Nr.DirectionalLight(u,{position:[0,10,10],castShadow:!0});var d=vi(u,2);Nr.Mesh(d,{get"rotation.y"(){return r()},"position.y":1,get springScale(){return B(s).current},onpointerenter:()=>{xl(s,B(s).target=1.5)},onpointerleave:()=>{xl(s,B(s).target=1)},castShadow:!0,children:(v,y)=>{var w=nn(),R=pi(w);_le(R,()=>Fit(i()),null,(O,P)=>{Nr(O,{get scale(){return n()},get is(){return B(P).scene}})}),bt(v,w)},$$slots:{default:!0}});var p=vi(d,2);Nr.Mesh(p,{"rotation.x":-Math.PI/2,receiveShadow:!0,children:(v,y)=>{var w=prt(),R=pi(w);Nr.CircleGeometry(R,{args:[4,40]});var O=vi(R,2);Nr.MeshStandardMaterial(O,{color:"white"}),bt(v,w)},$$slots:{default:!0}}),bt(t,o),Ei()}var vrt=hi("<div><!></div>");function lst(t,e){Pi(e,!0);function i(){return e.layoutStructure}function n(){return[{name:"assetURL",type:"string"},{name:"rotation",type:"string"},{name:"scale",type:"string"}]}var r=vrt(),s=Di(r);return Att(s,{children:(o,a)=>{const l=Vt(()=>e.layoutStructure.props?.assetURL),u=Vt(()=>e.layoutStructure.props?.scale),d=Vt(()=>e.layoutStructure.props?.rotation);grt(o,{get gltfURL(){return B(l)},get scale(){return B(u)},get rotation(){return B(d)}})},$$slots:{default:!0}}),_i(r),Gi(()=>xi(r,1,Ol(e.layoutStructure?.props?.class))),bt(t,r),Ei({getLayout:i,getProps:n})}export{I4e as $,Grt as A,Nrt as B,Urt as C,u4e as D,Ol as E,Pge as F,Zve as G,Qge as H,Wrt as I,Hve as J,hZ as K,kg as L,Zrt as M,ist as N,Dle as O,Yrt as P,ZG as Q,nst as R,Jrt as S,lst as T,gZ as U,$n as V,ex as W,D4e as X,F4e as Y,N4e as Z,L4e as _,Hrt as a,k4e as a0,jM as a1,$rt as b,Xrt as c,Krt as d,Qrt as e,O4e as f,ost as g,rst as h,est as i,tst as j,wle as k,Ch as l,Us as m,xi as n,yr as o,Jd as p,Ny as q,Trt as r,c0 as s,lF as t,Mrt as u,Ur as v,Sl as w,Rrt as x,JV as y,Ile as z};
